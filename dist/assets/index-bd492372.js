function Q4(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mA(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ti(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var eK={exports:{}},dO={},tK={exports:{}},ci={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _E=Symbol.for("react.element"),ppe=Symbol.for("react.portal"),gpe=Symbol.for("react.fragment"),mpe=Symbol.for("react.strict_mode"),Ape=Symbol.for("react.profiler"),_pe=Symbol.for("react.provider"),ype=Symbol.for("react.context"),vpe=Symbol.for("react.forward_ref"),xpe=Symbol.for("react.suspense"),bpe=Symbol.for("react.memo"),wpe=Symbol.for("react.lazy"),Xj=Symbol.iterator;function Epe(t){return t===null||typeof t!="object"?null:(t=Xj&&t[Xj]||t["@@iterator"],typeof t=="function"?t:null)}var nK={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rK=Object.assign,iK={};function P1(t,e,n){this.props=t,this.context=e,this.refs=iK,this.updater=n||nK}P1.prototype.isReactComponent={};P1.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};P1.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function oK(){}oK.prototype=P1.prototype;function K4(t,e,n){this.props=t,this.context=e,this.refs=iK,this.updater=n||nK}var J4=K4.prototype=new oK;J4.constructor=K4;rK(J4,P1.prototype);J4.isPureReactComponent=!0;var Zj=Array.isArray,sK=Object.prototype.hasOwnProperty,ez={current:null},aK={key:!0,ref:!0,__self:!0,__source:!0};function lK(t,e,n){var r,i={},o=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(o=""+e.key),e)sK.call(e,r)&&!aK.hasOwnProperty(r)&&(i[r]=e[r]);var s=arguments.length-2;if(s===1)i.children=n;else if(1<s){for(var u=Array(s),d=0;d<s;d++)u[d]=arguments[d+2];i.children=u}if(t&&t.defaultProps)for(r in s=t.defaultProps,s)i[r]===void 0&&(i[r]=s[r]);return{$$typeof:_E,type:t,key:o,ref:a,props:i,_owner:ez.current}}function Spe(t,e){return{$$typeof:_E,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function tz(t){return typeof t=="object"&&t!==null&&t.$$typeof===_E}function Tpe(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Yj=/\/+/g;function eD(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Tpe(""+t.key):e.toString(36)}function zT(t,e,n,r,i){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case _E:case ppe:a=!0}}if(a)return a=t,i=i(a),t=r===""?"."+eD(a,0):r,Zj(i)?(n="",t!=null&&(n=t.replace(Yj,"$&/")+"/"),zT(i,e,n,"",function(d){return d})):i!=null&&(tz(i)&&(i=Spe(i,n+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(Yj,"$&/")+"/")+t)),e.push(i)),1;if(a=0,r=r===""?".":r+":",Zj(t))for(var s=0;s<t.length;s++){o=t[s];var u=r+eD(o,s);a+=zT(o,e,n,u,i)}else if(u=Epe(t),typeof u=="function")for(t=u.call(t),s=0;!(o=t.next()).done;)o=o.value,u=r+eD(o,s++),a+=zT(o,e,n,u,i);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function iS(t,e,n){if(t==null)return t;var r=[],i=0;return zT(t,r,"","",function(o){return e.call(n,o,i++)}),r}function Cpe(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var iu={current:null},UT={transition:null},Ppe={ReactCurrentDispatcher:iu,ReactCurrentBatchConfig:UT,ReactCurrentOwner:ez};ci.Children={map:iS,forEach:function(t,e,n){iS(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return iS(t,function(){e++}),e},toArray:function(t){return iS(t,function(e){return e})||[]},only:function(t){if(!tz(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ci.Component=P1;ci.Fragment=gpe;ci.Profiler=Ape;ci.PureComponent=K4;ci.StrictMode=mpe;ci.Suspense=xpe;ci.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ppe;ci.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=rK({},t.props),i=t.key,o=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,a=ez.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(u in e)sK.call(e,u)&&!aK.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&s!==void 0?s[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){s=Array(u);for(var d=0;d<u;d++)s[d]=arguments[d+2];r.children=s}return{$$typeof:_E,type:t.type,key:i,ref:o,props:r,_owner:a}};ci.createContext=function(t){return t={$$typeof:ype,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:_pe,_context:t},t.Consumer=t};ci.createElement=lK;ci.createFactory=function(t){var e=lK.bind(null,t);return e.type=t,e};ci.createRef=function(){return{current:null}};ci.forwardRef=function(t){return{$$typeof:vpe,render:t}};ci.isValidElement=tz;ci.lazy=function(t){return{$$typeof:wpe,_payload:{_status:-1,_result:t},_init:Cpe}};ci.memo=function(t,e){return{$$typeof:bpe,type:t,compare:e===void 0?null:e}};ci.startTransition=function(t){var e=UT.transition;UT.transition={};try{t()}finally{UT.transition=e}};ci.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ci.useCallback=function(t,e){return iu.current.useCallback(t,e)};ci.useContext=function(t){return iu.current.useContext(t)};ci.useDebugValue=function(){};ci.useDeferredValue=function(t){return iu.current.useDeferredValue(t)};ci.useEffect=function(t,e){return iu.current.useEffect(t,e)};ci.useId=function(){return iu.current.useId()};ci.useImperativeHandle=function(t,e,n){return iu.current.useImperativeHandle(t,e,n)};ci.useInsertionEffect=function(t,e){return iu.current.useInsertionEffect(t,e)};ci.useLayoutEffect=function(t,e){return iu.current.useLayoutEffect(t,e)};ci.useMemo=function(t,e){return iu.current.useMemo(t,e)};ci.useReducer=function(t,e,n){return iu.current.useReducer(t,e,n)};ci.useRef=function(t){return iu.current.useRef(t)};ci.useState=function(t){return iu.current.useState(t)};ci.useSyncExternalStore=function(t,e,n){return iu.current.useSyncExternalStore(t,e,n)};ci.useTransition=function(){return iu.current.useTransition()};ci.version="18.2.0";tK.exports=ci;var we=tK.exports;const ut=mA(we),wP=Q4({__proto__:null,default:ut},[we]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ipe=we,Mpe=Symbol.for("react.element"),Ope=Symbol.for("react.fragment"),Rpe=Object.prototype.hasOwnProperty,Lpe=Ipe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Dpe={key:!0,ref:!0,__self:!0,__source:!0};function uK(t,e,n){var r,i={},o=null,a=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)Rpe.call(e,r)&&!Dpe.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:Mpe,type:t,key:o,ref:a,props:i,_owner:Lpe.current}}dO.Fragment=Ope;dO.jsx=uK;dO.jsxs=uK;eK.exports=dO;var Un=eK.exports,SN={},cK={exports:{}},Pc={},fK={exports:{}},hK={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Ee,Ne){var Be=Ee.length;Ee.push(Ne);e:for(;0<Be;){var qe=Be-1>>>1,ct=Ee[qe];if(0<i(ct,Ne))Ee[qe]=Ne,Ee[Be]=ct,Be=qe;else break e}}function n(Ee){return Ee.length===0?null:Ee[0]}function r(Ee){if(Ee.length===0)return null;var Ne=Ee[0],Be=Ee.pop();if(Be!==Ne){Ee[0]=Be;e:for(var qe=0,ct=Ee.length,Ct=ct>>>1;qe<Ct;){var Dt=2*(qe+1)-1,In=Ee[Dt],Mn=Dt+1,Tn=Ee[Mn];if(0>i(In,Be))Mn<ct&&0>i(Tn,In)?(Ee[qe]=Tn,Ee[Mn]=Be,qe=Mn):(Ee[qe]=In,Ee[Dt]=Be,qe=Dt);else if(Mn<ct&&0>i(Tn,Be))Ee[qe]=Tn,Ee[Mn]=Be,qe=Mn;else break e}}return Ne}function i(Ee,Ne){var Be=Ee.sortIndex-Ne.sortIndex;return Be!==0?Be:Ee.id-Ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();t.unstable_now=function(){return a.now()-s}}var u=[],d=[],g=1,_=null,E=3,P=!1,R=!1,B=!1,V=typeof setTimeout=="function"?setTimeout:null,z=typeof clearTimeout=="function"?clearTimeout:null,F=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(Ee){for(var Ne=n(d);Ne!==null;){if(Ne.callback===null)r(d);else if(Ne.startTime<=Ee)r(d),Ne.sortIndex=Ne.expirationTime,e(u,Ne);else break;Ne=n(d)}}function X(Ee){if(B=!1,k(Ee),!R)if(n(u)!==null)R=!0,tt(Y);else{var Ne=n(d);Ne!==null&&pt(X,Ne.startTime-Ee)}}function Y(Ee,Ne){R=!1,B&&(B=!1,z(ce),ce=-1),P=!0;var Be=E;try{for(k(Ne),_=n(u);_!==null&&(!(_.expirationTime>Ne)||Ee&&!se());){var qe=_.callback;if(typeof qe=="function"){_.callback=null,E=_.priorityLevel;var ct=qe(_.expirationTime<=Ne);Ne=t.unstable_now(),typeof ct=="function"?_.callback=ct:_===n(u)&&r(u),k(Ne)}else r(u);_=n(u)}if(_!==null)var Ct=!0;else{var Dt=n(d);Dt!==null&&pt(X,Dt.startTime-Ne),Ct=!1}return Ct}finally{_=null,E=Be,P=!1}}var J=!1,ie=null,ce=-1,re=5,ue=-1;function se(){return!(t.unstable_now()-ue<re)}function me(){if(ie!==null){var Ee=t.unstable_now();ue=Ee;var Ne=!0;try{Ne=ie(!0,Ee)}finally{Ne?Ce():(J=!1,ie=null)}}else J=!1}var Ce;if(typeof F=="function")Ce=function(){F(me)};else if(typeof MessageChannel<"u"){var be=new MessageChannel,Ye=be.port2;be.port1.onmessage=me,Ce=function(){Ye.postMessage(null)}}else Ce=function(){V(me,0)};function tt(Ee){ie=Ee,J||(J=!0,Ce())}function pt(Ee,Ne){ce=V(function(){Ee(t.unstable_now())},Ne)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Ee){Ee.callback=null},t.unstable_continueExecution=function(){R||P||(R=!0,tt(Y))},t.unstable_forceFrameRate=function(Ee){0>Ee||125<Ee?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):re=0<Ee?Math.floor(1e3/Ee):5},t.unstable_getCurrentPriorityLevel=function(){return E},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(Ee){switch(E){case 1:case 2:case 3:var Ne=3;break;default:Ne=E}var Be=E;E=Ne;try{return Ee()}finally{E=Be}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Ee,Ne){switch(Ee){case 1:case 2:case 3:case 4:case 5:break;default:Ee=3}var Be=E;E=Ee;try{return Ne()}finally{E=Be}},t.unstable_scheduleCallback=function(Ee,Ne,Be){var qe=t.unstable_now();switch(typeof Be=="object"&&Be!==null?(Be=Be.delay,Be=typeof Be=="number"&&0<Be?qe+Be:qe):Be=qe,Ee){case 1:var ct=-1;break;case 2:ct=250;break;case 5:ct=1073741823;break;case 4:ct=1e4;break;default:ct=5e3}return ct=Be+ct,Ee={id:g++,callback:Ne,priorityLevel:Ee,startTime:Be,expirationTime:ct,sortIndex:-1},Be>qe?(Ee.sortIndex=Be,e(d,Ee),n(u)===null&&Ee===n(d)&&(B?(z(ce),ce=-1):B=!0,pt(X,Be-qe))):(Ee.sortIndex=ct,e(u,Ee),R||P||(R=!0,tt(Y))),Ee},t.unstable_shouldYield=se,t.unstable_wrapCallback=function(Ee){var Ne=E;return function(){var Be=E;E=Ne;try{return Ee.apply(this,arguments)}finally{E=Be}}}})(hK);fK.exports=hK;var Bpe=fK.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dK=we,vc=Bpe;function vn(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var pK=new Set,Aw={};function i_(t,e){Cv(t,e),Cv(t+"Capture",e)}function Cv(t,e){for(Aw[t]=e,t=0;t<e.length;t++)pK.add(e[t])}var rg=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),TN=Object.prototype.hasOwnProperty,Npe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Qj={},Kj={};function Fpe(t){return TN.call(Kj,t)?!0:TN.call(Qj,t)?!1:Npe.test(t)?Kj[t]=!0:(Qj[t]=!0,!1)}function kpe(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function zpe(t,e,n,r){if(e===null||typeof e>"u"||kpe(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ou(t,e,n,r,i,o,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=a}var Ka={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ka[t]=new ou(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ka[e]=new ou(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ka[t]=new ou(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ka[t]=new ou(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ka[t]=new ou(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ka[t]=new ou(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ka[t]=new ou(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ka[t]=new ou(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ka[t]=new ou(t,5,!1,t.toLowerCase(),null,!1,!1)});var nz=/[\-:]([a-z])/g;function rz(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(nz,rz);Ka[e]=new ou(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(nz,rz);Ka[e]=new ou(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(nz,rz);Ka[e]=new ou(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ka[t]=new ou(t,1,!1,t.toLowerCase(),null,!1,!1)});Ka.xlinkHref=new ou("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ka[t]=new ou(t,1,!1,t.toLowerCase(),null,!0,!0)});function iz(t,e,n,r){var i=Ka.hasOwnProperty(e)?Ka[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(zpe(e,n,i,r)&&(n=null),r||i===null?Fpe(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var bg=dK.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,oS=Symbol.for("react.element"),Gy=Symbol.for("react.portal"),jy=Symbol.for("react.fragment"),oz=Symbol.for("react.strict_mode"),CN=Symbol.for("react.profiler"),gK=Symbol.for("react.provider"),mK=Symbol.for("react.context"),sz=Symbol.for("react.forward_ref"),PN=Symbol.for("react.suspense"),IN=Symbol.for("react.suspense_list"),az=Symbol.for("react.memo"),vm=Symbol.for("react.lazy"),AK=Symbol.for("react.offscreen"),Jj=Symbol.iterator;function Yx(t){return t===null||typeof t!="object"?null:(t=Jj&&t[Jj]||t["@@iterator"],typeof t=="function"?t:null)}var ls=Object.assign,tD;function Ub(t){if(tD===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);tD=e&&e[1]||""}return`
`+tD+t}var nD=!1;function rD(t,e){if(!t||nD)return"";nD=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var i=d.stack.split(`
`),o=r.stack.split(`
`),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(a!==1||s!==1)do if(a--,s--,0>s||i[a]!==o[s]){var u=`
`+i[a].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=a&&0<=s);break}}}finally{nD=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ub(t):""}function Upe(t){switch(t.tag){case 5:return Ub(t.type);case 16:return Ub("Lazy");case 13:return Ub("Suspense");case 19:return Ub("SuspenseList");case 0:case 2:case 15:return t=rD(t.type,!1),t;case 11:return t=rD(t.type.render,!1),t;case 1:return t=rD(t.type,!0),t;default:return""}}function MN(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case jy:return"Fragment";case Gy:return"Portal";case CN:return"Profiler";case oz:return"StrictMode";case PN:return"Suspense";case IN:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case mK:return(t.displayName||"Context")+".Consumer";case gK:return(t._context.displayName||"Context")+".Provider";case sz:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case az:return e=t.displayName||null,e!==null?e:MN(t.type)||"Memo";case vm:e=t._payload,t=t._init;try{return MN(t(e))}catch{}}return null}function Gpe(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return MN(e);case 8:return e===oz?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function qm(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function _K(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function jpe(t){var e=_K(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,o.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function sS(t){t._valueTracker||(t._valueTracker=jpe(t))}function yK(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=_K(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function EP(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ON(t,e){var n=e.checked;return ls({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function eV(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=qm(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function vK(t,e){e=e.checked,e!=null&&iz(t,"checked",e,!1)}function RN(t,e){vK(t,e);var n=qm(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?LN(t,e.type,n):e.hasOwnProperty("defaultValue")&&LN(t,e.type,qm(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function tV(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function LN(t,e,n){(e!=="number"||EP(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Gb=Array.isArray;function cv(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+qm(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function DN(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(vn(91));return ls({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function nV(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(vn(92));if(Gb(n)){if(1<n.length)throw Error(vn(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:qm(n)}}function xK(t,e){var n=qm(e.value),r=qm(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function rV(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function bK(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function BN(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?bK(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var aS,wK=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(aS=aS||document.createElement("div"),aS.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=aS.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function _w(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Kb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Vpe=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(t){Vpe.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Kb[e]=Kb[t]})});function EK(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Kb.hasOwnProperty(t)&&Kb[t]?(""+e).trim():e+"px"}function SK(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=EK(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var $pe=ls({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function NN(t,e){if(e){if($pe[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(vn(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(vn(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(vn(61))}if(e.style!=null&&typeof e.style!="object")throw Error(vn(62))}}function FN(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kN=null;function lz(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var zN=null,fv=null,hv=null;function iV(t){if(t=xE(t)){if(typeof zN!="function")throw Error(vn(280));var e=t.stateNode;e&&(e=_O(e),zN(t.stateNode,t.type,e))}}function TK(t){fv?hv?hv.push(t):hv=[t]:fv=t}function CK(){if(fv){var t=fv,e=hv;if(hv=fv=null,iV(t),e)for(t=0;t<e.length;t++)iV(e[t])}}function PK(t,e){return t(e)}function IK(){}var iD=!1;function MK(t,e,n){if(iD)return t(e,n);iD=!0;try{return PK(t,e,n)}finally{iD=!1,(fv!==null||hv!==null)&&(IK(),CK())}}function yw(t,e){var n=t.stateNode;if(n===null)return null;var r=_O(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(vn(231,e,typeof n));return n}var UN=!1;if(rg)try{var Qx={};Object.defineProperty(Qx,"passive",{get:function(){UN=!0}}),window.addEventListener("test",Qx,Qx),window.removeEventListener("test",Qx,Qx)}catch{UN=!1}function Hpe(t,e,n,r,i,o,a,s,u){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(g){this.onError(g)}}var Jb=!1,SP=null,TP=!1,GN=null,Wpe={onError:function(t){Jb=!0,SP=t}};function qpe(t,e,n,r,i,o,a,s,u){Jb=!1,SP=null,Hpe.apply(Wpe,arguments)}function Xpe(t,e,n,r,i,o,a,s,u){if(qpe.apply(this,arguments),Jb){if(Jb){var d=SP;Jb=!1,SP=null}else throw Error(vn(198));TP||(TP=!0,GN=d)}}function o_(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function OK(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function oV(t){if(o_(t)!==t)throw Error(vn(188))}function Zpe(t){var e=t.alternate;if(!e){if(e=o_(t),e===null)throw Error(vn(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return oV(i),t;if(o===r)return oV(i),e;o=o.sibling}throw Error(vn(188))}if(n.return!==r.return)n=i,r=o;else{for(var a=!1,s=i.child;s;){if(s===n){a=!0,n=i,r=o;break}if(s===r){a=!0,r=i,n=o;break}s=s.sibling}if(!a){for(s=o.child;s;){if(s===n){a=!0,n=o,r=i;break}if(s===r){a=!0,r=o,n=i;break}s=s.sibling}if(!a)throw Error(vn(189))}}if(n.alternate!==r)throw Error(vn(190))}if(n.tag!==3)throw Error(vn(188));return n.stateNode.current===n?t:e}function RK(t){return t=Zpe(t),t!==null?LK(t):null}function LK(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=LK(t);if(e!==null)return e;t=t.sibling}return null}var DK=vc.unstable_scheduleCallback,sV=vc.unstable_cancelCallback,Ype=vc.unstable_shouldYield,Qpe=vc.unstable_requestPaint,Ss=vc.unstable_now,Kpe=vc.unstable_getCurrentPriorityLevel,uz=vc.unstable_ImmediatePriority,BK=vc.unstable_UserBlockingPriority,CP=vc.unstable_NormalPriority,Jpe=vc.unstable_LowPriority,NK=vc.unstable_IdlePriority,pO=null,Nd=null;function ege(t){if(Nd&&typeof Nd.onCommitFiberRoot=="function")try{Nd.onCommitFiberRoot(pO,t,void 0,(t.current.flags&128)===128)}catch{}}var Ah=Math.clz32?Math.clz32:rge,tge=Math.log,nge=Math.LN2;function rge(t){return t>>>=0,t===0?32:31-(tge(t)/nge|0)|0}var lS=64,uS=4194304;function jb(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function PP(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,o=t.pingedLanes,a=n&268435455;if(a!==0){var s=a&~i;s!==0?r=jb(s):(o&=a,o!==0&&(r=jb(o)))}else a=n&~i,a!==0?r=jb(a):o!==0&&(r=jb(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Ah(e),i=1<<n,r|=t[n],e&=~i;return r}function ige(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oge(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,o=t.pendingLanes;0<o;){var a=31-Ah(o),s=1<<a,u=i[a];u===-1?(!(s&n)||s&r)&&(i[a]=ige(s,e)):u<=e&&(t.expiredLanes|=s),o&=~s}}function jN(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function FK(){var t=lS;return lS<<=1,!(lS&4194240)&&(lS=64),t}function oD(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function yE(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ah(e),t[e]=n}function sge(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Ah(n),o=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~o}}function cz(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Ah(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Ki=0;function kK(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var zK,fz,UK,GK,jK,VN=!1,cS=[],Rm=null,Lm=null,Dm=null,vw=new Map,xw=new Map,bm=[],age="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function aV(t,e){switch(t){case"focusin":case"focusout":Rm=null;break;case"dragenter":case"dragleave":Lm=null;break;case"mouseover":case"mouseout":Dm=null;break;case"pointerover":case"pointerout":vw.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":xw.delete(e.pointerId)}}function Kx(t,e,n,r,i,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=xE(e),e!==null&&fz(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function lge(t,e,n,r,i){switch(e){case"focusin":return Rm=Kx(Rm,t,e,n,r,i),!0;case"dragenter":return Lm=Kx(Lm,t,e,n,r,i),!0;case"mouseover":return Dm=Kx(Dm,t,e,n,r,i),!0;case"pointerover":var o=i.pointerId;return vw.set(o,Kx(vw.get(o)||null,t,e,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,xw.set(o,Kx(xw.get(o)||null,t,e,n,r,i)),!0}return!1}function VK(t){var e=_0(t.target);if(e!==null){var n=o_(e);if(n!==null){if(e=n.tag,e===13){if(e=OK(n),e!==null){t.blockedOn=e,jK(t.priority,function(){UK(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function GT(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=$N(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);kN=r,n.target.dispatchEvent(r),kN=null}else return e=xE(n),e!==null&&fz(e),t.blockedOn=n,!1;e.shift()}return!0}function lV(t,e,n){GT(t)&&n.delete(e)}function uge(){VN=!1,Rm!==null&&GT(Rm)&&(Rm=null),Lm!==null&&GT(Lm)&&(Lm=null),Dm!==null&&GT(Dm)&&(Dm=null),vw.forEach(lV),xw.forEach(lV)}function Jx(t,e){t.blockedOn===e&&(t.blockedOn=null,VN||(VN=!0,vc.unstable_scheduleCallback(vc.unstable_NormalPriority,uge)))}function bw(t){function e(i){return Jx(i,t)}if(0<cS.length){Jx(cS[0],t);for(var n=1;n<cS.length;n++){var r=cS[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Rm!==null&&Jx(Rm,t),Lm!==null&&Jx(Lm,t),Dm!==null&&Jx(Dm,t),vw.forEach(e),xw.forEach(e),n=0;n<bm.length;n++)r=bm[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<bm.length&&(n=bm[0],n.blockedOn===null);)VK(n),n.blockedOn===null&&bm.shift()}var dv=bg.ReactCurrentBatchConfig,IP=!0;function cge(t,e,n,r){var i=Ki,o=dv.transition;dv.transition=null;try{Ki=1,hz(t,e,n,r)}finally{Ki=i,dv.transition=o}}function fge(t,e,n,r){var i=Ki,o=dv.transition;dv.transition=null;try{Ki=4,hz(t,e,n,r)}finally{Ki=i,dv.transition=o}}function hz(t,e,n,r){if(IP){var i=$N(t,e,n,r);if(i===null)gD(t,e,r,MP,n),aV(t,r);else if(lge(i,t,e,n,r))r.stopPropagation();else if(aV(t,r),e&4&&-1<age.indexOf(t)){for(;i!==null;){var o=xE(i);if(o!==null&&zK(o),o=$N(t,e,n,r),o===null&&gD(t,e,r,MP,n),o===i)break;i=o}i!==null&&r.stopPropagation()}else gD(t,e,r,null,n)}}var MP=null;function $N(t,e,n,r){if(MP=null,t=lz(r),t=_0(t),t!==null)if(e=o_(t),e===null)t=null;else if(n=e.tag,n===13){if(t=OK(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return MP=t,null}function $K(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Kpe()){case uz:return 1;case BK:return 4;case CP:case Jpe:return 16;case NK:return 536870912;default:return 16}default:return 16}}var Sm=null,dz=null,jT=null;function HK(){if(jT)return jT;var t,e=dz,n=e.length,r,i="value"in Sm?Sm.value:Sm.textContent,o=i.length;for(t=0;t<n&&e[t]===i[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===i[o-r];r++);return jT=i.slice(t,1<r?1-r:void 0)}function VT(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function fS(){return!0}function uV(){return!1}function Ic(t){function e(n,r,i,o,a){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=a,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(n=t[s],this[s]=n?n(o):o[s]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?fS:uV,this.isPropagationStopped=uV,this}return ls(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=fS)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=fS)},persist:function(){},isPersistent:fS}),e}var I1={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pz=Ic(I1),vE=ls({},I1,{view:0,detail:0}),hge=Ic(vE),sD,aD,eb,gO=ls({},vE,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gz,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==eb&&(eb&&t.type==="mousemove"?(sD=t.screenX-eb.screenX,aD=t.screenY-eb.screenY):aD=sD=0,eb=t),sD)},movementY:function(t){return"movementY"in t?t.movementY:aD}}),cV=Ic(gO),dge=ls({},gO,{dataTransfer:0}),pge=Ic(dge),gge=ls({},vE,{relatedTarget:0}),lD=Ic(gge),mge=ls({},I1,{animationName:0,elapsedTime:0,pseudoElement:0}),Age=Ic(mge),_ge=ls({},I1,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),yge=Ic(_ge),vge=ls({},I1,{data:0}),fV=Ic(vge),xge={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bge={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wge={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ege(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=wge[t])?!!e[t]:!1}function gz(){return Ege}var Sge=ls({},vE,{key:function(t){if(t.key){var e=xge[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=VT(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?bge[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gz,charCode:function(t){return t.type==="keypress"?VT(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?VT(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Tge=Ic(Sge),Cge=ls({},gO,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hV=Ic(Cge),Pge=ls({},vE,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gz}),Ige=Ic(Pge),Mge=ls({},I1,{propertyName:0,elapsedTime:0,pseudoElement:0}),Oge=Ic(Mge),Rge=ls({},gO,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Lge=Ic(Rge),Dge=[9,13,27,32],mz=rg&&"CompositionEvent"in window,ew=null;rg&&"documentMode"in document&&(ew=document.documentMode);var Bge=rg&&"TextEvent"in window&&!ew,WK=rg&&(!mz||ew&&8<ew&&11>=ew),dV=String.fromCharCode(32),pV=!1;function qK(t,e){switch(t){case"keyup":return Dge.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function XK(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Vy=!1;function Nge(t,e){switch(t){case"compositionend":return XK(e);case"keypress":return e.which!==32?null:(pV=!0,dV);case"textInput":return t=e.data,t===dV&&pV?null:t;default:return null}}function Fge(t,e){if(Vy)return t==="compositionend"||!mz&&qK(t,e)?(t=HK(),jT=dz=Sm=null,Vy=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return WK&&e.locale!=="ko"?null:e.data;default:return null}}var kge={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gV(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!kge[t.type]:e==="textarea"}function ZK(t,e,n,r){TK(r),e=OP(e,"onChange"),0<e.length&&(n=new pz("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var tw=null,ww=null;function zge(t){sJ(t,0)}function mO(t){var e=Wy(t);if(yK(e))return t}function Uge(t,e){if(t==="change")return e}var YK=!1;if(rg){var uD;if(rg){var cD="oninput"in document;if(!cD){var mV=document.createElement("div");mV.setAttribute("oninput","return;"),cD=typeof mV.oninput=="function"}uD=cD}else uD=!1;YK=uD&&(!document.documentMode||9<document.documentMode)}function AV(){tw&&(tw.detachEvent("onpropertychange",QK),ww=tw=null)}function QK(t){if(t.propertyName==="value"&&mO(ww)){var e=[];ZK(e,ww,t,lz(t)),MK(zge,e)}}function Gge(t,e,n){t==="focusin"?(AV(),tw=e,ww=n,tw.attachEvent("onpropertychange",QK)):t==="focusout"&&AV()}function jge(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return mO(ww)}function Vge(t,e){if(t==="click")return mO(e)}function $ge(t,e){if(t==="input"||t==="change")return mO(e)}function Hge(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var xh=typeof Object.is=="function"?Object.is:Hge;function Ew(t,e){if(xh(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!TN.call(e,i)||!xh(t[i],e[i]))return!1}return!0}function _V(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function yV(t,e){var n=_V(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=_V(n)}}function KK(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?KK(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function JK(){for(var t=window,e=EP();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=EP(t.document)}return e}function Az(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Wge(t){var e=JK(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&KK(n.ownerDocument.documentElement,n)){if(r!==null&&Az(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!t.extend&&o>r&&(i=r,r=o,o=i),i=yV(n,o);var a=yV(n,r);i&&a&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),o>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var qge=rg&&"documentMode"in document&&11>=document.documentMode,$y=null,HN=null,nw=null,WN=!1;function vV(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;WN||$y==null||$y!==EP(r)||(r=$y,"selectionStart"in r&&Az(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),nw&&Ew(nw,r)||(nw=r,r=OP(HN,"onSelect"),0<r.length&&(e=new pz("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=$y)))}function hS(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Hy={animationend:hS("Animation","AnimationEnd"),animationiteration:hS("Animation","AnimationIteration"),animationstart:hS("Animation","AnimationStart"),transitionend:hS("Transition","TransitionEnd")},fD={},eJ={};rg&&(eJ=document.createElement("div").style,"AnimationEvent"in window||(delete Hy.animationend.animation,delete Hy.animationiteration.animation,delete Hy.animationstart.animation),"TransitionEvent"in window||delete Hy.transitionend.transition);function AO(t){if(fD[t])return fD[t];if(!Hy[t])return t;var e=Hy[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in eJ)return fD[t]=e[n];return t}var tJ=AO("animationend"),nJ=AO("animationiteration"),rJ=AO("animationstart"),iJ=AO("transitionend"),oJ=new Map,xV="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function AA(t,e){oJ.set(t,e),i_(e,[t])}for(var hD=0;hD<xV.length;hD++){var dD=xV[hD],Xge=dD.toLowerCase(),Zge=dD[0].toUpperCase()+dD.slice(1);AA(Xge,"on"+Zge)}AA(tJ,"onAnimationEnd");AA(nJ,"onAnimationIteration");AA(rJ,"onAnimationStart");AA("dblclick","onDoubleClick");AA("focusin","onFocus");AA("focusout","onBlur");AA(iJ,"onTransitionEnd");Cv("onMouseEnter",["mouseout","mouseover"]);Cv("onMouseLeave",["mouseout","mouseover"]);Cv("onPointerEnter",["pointerout","pointerover"]);Cv("onPointerLeave",["pointerout","pointerover"]);i_("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));i_("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));i_("onBeforeInput",["compositionend","keypress","textInput","paste"]);i_("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));i_("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));i_("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yge=new Set("cancel close invalid load scroll toggle".split(" ").concat(Vb));function bV(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Xpe(r,e,void 0,t),t.currentTarget=null}function sJ(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var a=r.length-1;0<=a;a--){var s=r[a],u=s.instance,d=s.currentTarget;if(s=s.listener,u!==o&&i.isPropagationStopped())break e;bV(i,s,d),o=u}else for(a=0;a<r.length;a++){if(s=r[a],u=s.instance,d=s.currentTarget,s=s.listener,u!==o&&i.isPropagationStopped())break e;bV(i,s,d),o=u}}}if(TP)throw t=GN,TP=!1,GN=null,t}function Po(t,e){var n=e[QN];n===void 0&&(n=e[QN]=new Set);var r=t+"__bubble";n.has(r)||(aJ(e,t,2,!1),n.add(r))}function pD(t,e,n){var r=0;e&&(r|=4),aJ(n,t,r,e)}var dS="_reactListening"+Math.random().toString(36).slice(2);function Sw(t){if(!t[dS]){t[dS]=!0,pK.forEach(function(n){n!=="selectionchange"&&(Yge.has(n)||pD(n,!1,t),pD(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[dS]||(e[dS]=!0,pD("selectionchange",!1,e))}}function aJ(t,e,n,r){switch($K(e)){case 1:var i=cge;break;case 4:i=fge;break;default:i=hz}n=i.bind(null,e,n,t),i=void 0,!UN||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function gD(t,e,n,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var s=r.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(a===4)for(a=r.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;a=a.return}for(;s!==null;){if(a=_0(s),a===null)return;if(u=a.tag,u===5||u===6){r=o=a;continue e}s=s.parentNode}}r=r.return}MK(function(){var d=o,g=lz(n),_=[];e:{var E=oJ.get(t);if(E!==void 0){var P=pz,R=t;switch(t){case"keypress":if(VT(n)===0)break e;case"keydown":case"keyup":P=Tge;break;case"focusin":R="focus",P=lD;break;case"focusout":R="blur",P=lD;break;case"beforeblur":case"afterblur":P=lD;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":P=cV;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":P=pge;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":P=Ige;break;case tJ:case nJ:case rJ:P=Age;break;case iJ:P=Oge;break;case"scroll":P=hge;break;case"wheel":P=Lge;break;case"copy":case"cut":case"paste":P=yge;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":P=hV}var B=(e&4)!==0,V=!B&&t==="scroll",z=B?E!==null?E+"Capture":null:E;B=[];for(var F=d,k;F!==null;){k=F;var X=k.stateNode;if(k.tag===5&&X!==null&&(k=X,z!==null&&(X=yw(F,z),X!=null&&B.push(Tw(F,X,k)))),V)break;F=F.return}0<B.length&&(E=new P(E,R,null,n,g),_.push({event:E,listeners:B}))}}if(!(e&7)){e:{if(E=t==="mouseover"||t==="pointerover",P=t==="mouseout"||t==="pointerout",E&&n!==kN&&(R=n.relatedTarget||n.fromElement)&&(_0(R)||R[ig]))break e;if((P||E)&&(E=g.window===g?g:(E=g.ownerDocument)?E.defaultView||E.parentWindow:window,P?(R=n.relatedTarget||n.toElement,P=d,R=R?_0(R):null,R!==null&&(V=o_(R),R!==V||R.tag!==5&&R.tag!==6)&&(R=null)):(P=null,R=d),P!==R)){if(B=cV,X="onMouseLeave",z="onMouseEnter",F="mouse",(t==="pointerout"||t==="pointerover")&&(B=hV,X="onPointerLeave",z="onPointerEnter",F="pointer"),V=P==null?E:Wy(P),k=R==null?E:Wy(R),E=new B(X,F+"leave",P,n,g),E.target=V,E.relatedTarget=k,X=null,_0(g)===d&&(B=new B(z,F+"enter",R,n,g),B.target=k,B.relatedTarget=V,X=B),V=X,P&&R)t:{for(B=P,z=R,F=0,k=B;k;k=cy(k))F++;for(k=0,X=z;X;X=cy(X))k++;for(;0<F-k;)B=cy(B),F--;for(;0<k-F;)z=cy(z),k--;for(;F--;){if(B===z||z!==null&&B===z.alternate)break t;B=cy(B),z=cy(z)}B=null}else B=null;P!==null&&wV(_,E,P,B,!1),R!==null&&V!==null&&wV(_,V,R,B,!0)}}e:{if(E=d?Wy(d):window,P=E.nodeName&&E.nodeName.toLowerCase(),P==="select"||P==="input"&&E.type==="file")var Y=Uge;else if(gV(E))if(YK)Y=$ge;else{Y=jge;var J=Gge}else(P=E.nodeName)&&P.toLowerCase()==="input"&&(E.type==="checkbox"||E.type==="radio")&&(Y=Vge);if(Y&&(Y=Y(t,d))){ZK(_,Y,n,g);break e}J&&J(t,E,d),t==="focusout"&&(J=E._wrapperState)&&J.controlled&&E.type==="number"&&LN(E,"number",E.value)}switch(J=d?Wy(d):window,t){case"focusin":(gV(J)||J.contentEditable==="true")&&($y=J,HN=d,nw=null);break;case"focusout":nw=HN=$y=null;break;case"mousedown":WN=!0;break;case"contextmenu":case"mouseup":case"dragend":WN=!1,vV(_,n,g);break;case"selectionchange":if(qge)break;case"keydown":case"keyup":vV(_,n,g)}var ie;if(mz)e:{switch(t){case"compositionstart":var ce="onCompositionStart";break e;case"compositionend":ce="onCompositionEnd";break e;case"compositionupdate":ce="onCompositionUpdate";break e}ce=void 0}else Vy?qK(t,n)&&(ce="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(ce="onCompositionStart");ce&&(WK&&n.locale!=="ko"&&(Vy||ce!=="onCompositionStart"?ce==="onCompositionEnd"&&Vy&&(ie=HK()):(Sm=g,dz="value"in Sm?Sm.value:Sm.textContent,Vy=!0)),J=OP(d,ce),0<J.length&&(ce=new fV(ce,t,null,n,g),_.push({event:ce,listeners:J}),ie?ce.data=ie:(ie=XK(n),ie!==null&&(ce.data=ie)))),(ie=Bge?Nge(t,n):Fge(t,n))&&(d=OP(d,"onBeforeInput"),0<d.length&&(g=new fV("onBeforeInput","beforeinput",null,n,g),_.push({event:g,listeners:d}),g.data=ie))}sJ(_,e)})}function Tw(t,e,n){return{instance:t,listener:e,currentTarget:n}}function OP(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=yw(t,n),o!=null&&r.unshift(Tw(t,o,i)),o=yw(t,e),o!=null&&r.push(Tw(t,o,i))),t=t.return}return r}function cy(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function wV(t,e,n,r,i){for(var o=e._reactName,a=[];n!==null&&n!==r;){var s=n,u=s.alternate,d=s.stateNode;if(u!==null&&u===r)break;s.tag===5&&d!==null&&(s=d,i?(u=yw(n,o),u!=null&&a.unshift(Tw(n,u,s))):i||(u=yw(n,o),u!=null&&a.push(Tw(n,u,s)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var Qge=/\r\n?/g,Kge=/\u0000|\uFFFD/g;function EV(t){return(typeof t=="string"?t:""+t).replace(Qge,`
`).replace(Kge,"")}function pS(t,e,n){if(e=EV(e),EV(t)!==e&&n)throw Error(vn(425))}function RP(){}var qN=null,XN=null;function ZN(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var YN=typeof setTimeout=="function"?setTimeout:void 0,Jge=typeof clearTimeout=="function"?clearTimeout:void 0,SV=typeof Promise=="function"?Promise:void 0,eme=typeof queueMicrotask=="function"?queueMicrotask:typeof SV<"u"?function(t){return SV.resolve(null).then(t).catch(tme)}:YN;function tme(t){setTimeout(function(){throw t})}function mD(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),bw(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);bw(e)}function Bm(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function TV(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var M1=Math.random().toString(36).slice(2),Pd="__reactFiber$"+M1,Cw="__reactProps$"+M1,ig="__reactContainer$"+M1,QN="__reactEvents$"+M1,nme="__reactListeners$"+M1,rme="__reactHandles$"+M1;function _0(t){var e=t[Pd];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ig]||n[Pd]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=TV(t);t!==null;){if(n=t[Pd])return n;t=TV(t)}return e}t=n,n=t.parentNode}return null}function xE(t){return t=t[Pd]||t[ig],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Wy(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(vn(33))}function _O(t){return t[Cw]||null}var KN=[],qy=-1;function _A(t){return{current:t}}function Io(t){0>qy||(t.current=KN[qy],KN[qy]=null,qy--)}function xo(t,e){qy++,KN[qy]=t.current,t.current=e}var Xm={},Cl=_A(Xm),Cu=_A(!1),C0=Xm;function Pv(t,e){var n=t.type.contextTypes;if(!n)return Xm;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in n)i[o]=e[o];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Pu(t){return t=t.childContextTypes,t!=null}function LP(){Io(Cu),Io(Cl)}function CV(t,e,n){if(Cl.current!==Xm)throw Error(vn(168));xo(Cl,e),xo(Cu,n)}function lJ(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(vn(108,Gpe(t)||"Unknown",i));return ls({},n,r)}function DP(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Xm,C0=Cl.current,xo(Cl,t),xo(Cu,Cu.current),!0}function PV(t,e,n){var r=t.stateNode;if(!r)throw Error(vn(169));n?(t=lJ(t,e,C0),r.__reactInternalMemoizedMergedChildContext=t,Io(Cu),Io(Cl),xo(Cl,t)):Io(Cu),xo(Cu,n)}var jp=null,yO=!1,AD=!1;function uJ(t){jp===null?jp=[t]:jp.push(t)}function ime(t){yO=!0,uJ(t)}function yA(){if(!AD&&jp!==null){AD=!0;var t=0,e=Ki;try{var n=jp;for(Ki=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}jp=null,yO=!1}catch(i){throw jp!==null&&(jp=jp.slice(t+1)),DK(uz,yA),i}finally{Ki=e,AD=!1}}return null}var Xy=[],Zy=0,BP=null,NP=0,af=[],lf=0,P0=null,qp=1,Xp="";function p0(t,e){Xy[Zy++]=NP,Xy[Zy++]=BP,BP=t,NP=e}function cJ(t,e,n){af[lf++]=qp,af[lf++]=Xp,af[lf++]=P0,P0=t;var r=qp;t=Xp;var i=32-Ah(r)-1;r&=~(1<<i),n+=1;var o=32-Ah(e)+i;if(30<o){var a=i-i%5;o=(r&(1<<a)-1).toString(32),r>>=a,i-=a,qp=1<<32-Ah(e)+i|n<<i|r,Xp=o+t}else qp=1<<o|n<<i|r,Xp=t}function _z(t){t.return!==null&&(p0(t,1),cJ(t,1,0))}function yz(t){for(;t===BP;)BP=Xy[--Zy],Xy[Zy]=null,NP=Xy[--Zy],Xy[Zy]=null;for(;t===P0;)P0=af[--lf],af[lf]=null,Xp=af[--lf],af[lf]=null,qp=af[--lf],af[lf]=null}var hc=null,lc=null,ko=!1,lh=null;function fJ(t,e){var n=ff(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function IV(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,hc=t,lc=Bm(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,hc=t,lc=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=P0!==null?{id:qp,overflow:Xp}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ff(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,hc=t,lc=null,!0):!1;default:return!1}}function JN(t){return(t.mode&1)!==0&&(t.flags&128)===0}function eF(t){if(ko){var e=lc;if(e){var n=e;if(!IV(t,e)){if(JN(t))throw Error(vn(418));e=Bm(n.nextSibling);var r=hc;e&&IV(t,e)?fJ(r,n):(t.flags=t.flags&-4097|2,ko=!1,hc=t)}}else{if(JN(t))throw Error(vn(418));t.flags=t.flags&-4097|2,ko=!1,hc=t}}}function MV(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;hc=t}function gS(t){if(t!==hc)return!1;if(!ko)return MV(t),ko=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!ZN(t.type,t.memoizedProps)),e&&(e=lc)){if(JN(t))throw hJ(),Error(vn(418));for(;e;)fJ(t,e),e=Bm(e.nextSibling)}if(MV(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(vn(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){lc=Bm(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}lc=null}}else lc=hc?Bm(t.stateNode.nextSibling):null;return!0}function hJ(){for(var t=lc;t;)t=Bm(t.nextSibling)}function Iv(){lc=hc=null,ko=!1}function vz(t){lh===null?lh=[t]:lh.push(t)}var ome=bg.ReactCurrentBatchConfig;function sh(t,e){if(t&&t.defaultProps){e=ls({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var FP=_A(null),kP=null,Yy=null,xz=null;function bz(){xz=Yy=kP=null}function wz(t){var e=FP.current;Io(FP),t._currentValue=e}function tF(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function pv(t,e){kP=t,xz=Yy=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Eu=!0),t.firstContext=null)}function _f(t){var e=t._currentValue;if(xz!==t)if(t={context:t,memoizedValue:e,next:null},Yy===null){if(kP===null)throw Error(vn(308));Yy=t,kP.dependencies={lanes:0,firstContext:t}}else Yy=Yy.next=t;return e}var y0=null;function Ez(t){y0===null?y0=[t]:y0.push(t)}function dJ(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,Ez(e)):(n.next=i.next,i.next=n),e.interleaved=n,og(t,r)}function og(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var xm=!1;function Sz(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function pJ(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Qp(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Nm(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,vi&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,og(t,n)}return i=r.interleaved,i===null?(e.next=e,Ez(r)):(e.next=i.next,i.next=e),r.interleaved=e,og(t,n)}function $T(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,cz(t,n)}}function OV(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?i=o=a:o=o.next=a,n=n.next}while(n!==null);o===null?i=o=e:o=o.next=e}else i=o=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function zP(t,e,n,r){var i=t.updateQueue;xm=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var u=s,d=u.next;u.next=null,a===null?o=d:a.next=d,a=u;var g=t.alternate;g!==null&&(g=g.updateQueue,s=g.lastBaseUpdate,s!==a&&(s===null?g.firstBaseUpdate=d:s.next=d,g.lastBaseUpdate=u))}if(o!==null){var _=i.baseState;a=0,g=d=u=null,s=o;do{var E=s.lane,P=s.eventTime;if((r&E)===E){g!==null&&(g=g.next={eventTime:P,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var R=t,B=s;switch(E=e,P=n,B.tag){case 1:if(R=B.payload,typeof R=="function"){_=R.call(P,_,E);break e}_=R;break e;case 3:R.flags=R.flags&-65537|128;case 0:if(R=B.payload,E=typeof R=="function"?R.call(P,_,E):R,E==null)break e;_=ls({},_,E);break e;case 2:xm=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,E=i.effects,E===null?i.effects=[s]:E.push(s))}else P={eventTime:P,lane:E,tag:s.tag,payload:s.payload,callback:s.callback,next:null},g===null?(d=g=P,u=_):g=g.next=P,a|=E;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;E=s,s=E.next,E.next=null,i.lastBaseUpdate=E,i.shared.pending=null}}while(1);if(g===null&&(u=_),i.baseState=u,i.firstBaseUpdate=d,i.lastBaseUpdate=g,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);M0|=a,t.lanes=a,t.memoizedState=_}}function RV(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(vn(191,i));i.call(r)}}}var gJ=new dK.Component().refs;function nF(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ls({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var vO={isMounted:function(t){return(t=t._reactInternals)?o_(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Zl(),i=km(t),o=Qp(r,i);o.payload=e,n!=null&&(o.callback=n),e=Nm(t,o,i),e!==null&&(_h(e,t,i,r),$T(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Zl(),i=km(t),o=Qp(r,i);o.tag=1,o.payload=e,n!=null&&(o.callback=n),e=Nm(t,o,i),e!==null&&(_h(e,t,i,r),$T(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Zl(),r=km(t),i=Qp(n,r);i.tag=2,e!=null&&(i.callback=e),e=Nm(t,i,r),e!==null&&(_h(e,t,r,n),$T(e,t,r))}};function LV(t,e,n,r,i,o,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,o,a):e.prototype&&e.prototype.isPureReactComponent?!Ew(n,r)||!Ew(i,o):!0}function mJ(t,e,n){var r=!1,i=Xm,o=e.contextType;return typeof o=="object"&&o!==null?o=_f(o):(i=Pu(e)?C0:Cl.current,r=e.contextTypes,o=(r=r!=null)?Pv(t,i):Xm),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=vO,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=o),e}function DV(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&vO.enqueueReplaceState(e,e.state,null)}function rF(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs=gJ,Sz(t);var o=e.contextType;typeof o=="object"&&o!==null?i.context=_f(o):(o=Pu(e)?C0:Cl.current,i.context=Pv(t,o)),i.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(nF(t,e,o,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&vO.enqueueReplaceState(i,i.state,null),zP(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function tb(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(vn(309));var r=n.stateNode}if(!r)throw Error(vn(147,t));var i=r,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(a){var s=i.refs;s===gJ&&(s=i.refs={}),a===null?delete s[o]:s[o]=a},e._stringRef=o,e)}if(typeof t!="string")throw Error(vn(284));if(!n._owner)throw Error(vn(290,t))}return t}function mS(t,e){throw t=Object.prototype.toString.call(e),Error(vn(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function BV(t){var e=t._init;return e(t._payload)}function AJ(t){function e(z,F){if(t){var k=z.deletions;k===null?(z.deletions=[F],z.flags|=16):k.push(F)}}function n(z,F){if(!t)return null;for(;F!==null;)e(z,F),F=F.sibling;return null}function r(z,F){for(z=new Map;F!==null;)F.key!==null?z.set(F.key,F):z.set(F.index,F),F=F.sibling;return z}function i(z,F){return z=zm(z,F),z.index=0,z.sibling=null,z}function o(z,F,k){return z.index=k,t?(k=z.alternate,k!==null?(k=k.index,k<F?(z.flags|=2,F):k):(z.flags|=2,F)):(z.flags|=1048576,F)}function a(z){return t&&z.alternate===null&&(z.flags|=2),z}function s(z,F,k,X){return F===null||F.tag!==6?(F=ED(k,z.mode,X),F.return=z,F):(F=i(F,k),F.return=z,F)}function u(z,F,k,X){var Y=k.type;return Y===jy?g(z,F,k.props.children,X,k.key):F!==null&&(F.elementType===Y||typeof Y=="object"&&Y!==null&&Y.$$typeof===vm&&BV(Y)===F.type)?(X=i(F,k.props),X.ref=tb(z,F,k),X.return=z,X):(X=YT(k.type,k.key,k.props,null,z.mode,X),X.ref=tb(z,F,k),X.return=z,X)}function d(z,F,k,X){return F===null||F.tag!==4||F.stateNode.containerInfo!==k.containerInfo||F.stateNode.implementation!==k.implementation?(F=SD(k,z.mode,X),F.return=z,F):(F=i(F,k.children||[]),F.return=z,F)}function g(z,F,k,X,Y){return F===null||F.tag!==7?(F=S0(k,z.mode,X,Y),F.return=z,F):(F=i(F,k),F.return=z,F)}function _(z,F,k){if(typeof F=="string"&&F!==""||typeof F=="number")return F=ED(""+F,z.mode,k),F.return=z,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case oS:return k=YT(F.type,F.key,F.props,null,z.mode,k),k.ref=tb(z,null,F),k.return=z,k;case Gy:return F=SD(F,z.mode,k),F.return=z,F;case vm:var X=F._init;return _(z,X(F._payload),k)}if(Gb(F)||Yx(F))return F=S0(F,z.mode,k,null),F.return=z,F;mS(z,F)}return null}function E(z,F,k,X){var Y=F!==null?F.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return Y!==null?null:s(z,F,""+k,X);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case oS:return k.key===Y?u(z,F,k,X):null;case Gy:return k.key===Y?d(z,F,k,X):null;case vm:return Y=k._init,E(z,F,Y(k._payload),X)}if(Gb(k)||Yx(k))return Y!==null?null:g(z,F,k,X,null);mS(z,k)}return null}function P(z,F,k,X,Y){if(typeof X=="string"&&X!==""||typeof X=="number")return z=z.get(k)||null,s(F,z,""+X,Y);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case oS:return z=z.get(X.key===null?k:X.key)||null,u(F,z,X,Y);case Gy:return z=z.get(X.key===null?k:X.key)||null,d(F,z,X,Y);case vm:var J=X._init;return P(z,F,k,J(X._payload),Y)}if(Gb(X)||Yx(X))return z=z.get(k)||null,g(F,z,X,Y,null);mS(F,X)}return null}function R(z,F,k,X){for(var Y=null,J=null,ie=F,ce=F=0,re=null;ie!==null&&ce<k.length;ce++){ie.index>ce?(re=ie,ie=null):re=ie.sibling;var ue=E(z,ie,k[ce],X);if(ue===null){ie===null&&(ie=re);break}t&&ie&&ue.alternate===null&&e(z,ie),F=o(ue,F,ce),J===null?Y=ue:J.sibling=ue,J=ue,ie=re}if(ce===k.length)return n(z,ie),ko&&p0(z,ce),Y;if(ie===null){for(;ce<k.length;ce++)ie=_(z,k[ce],X),ie!==null&&(F=o(ie,F,ce),J===null?Y=ie:J.sibling=ie,J=ie);return ko&&p0(z,ce),Y}for(ie=r(z,ie);ce<k.length;ce++)re=P(ie,z,ce,k[ce],X),re!==null&&(t&&re.alternate!==null&&ie.delete(re.key===null?ce:re.key),F=o(re,F,ce),J===null?Y=re:J.sibling=re,J=re);return t&&ie.forEach(function(se){return e(z,se)}),ko&&p0(z,ce),Y}function B(z,F,k,X){var Y=Yx(k);if(typeof Y!="function")throw Error(vn(150));if(k=Y.call(k),k==null)throw Error(vn(151));for(var J=Y=null,ie=F,ce=F=0,re=null,ue=k.next();ie!==null&&!ue.done;ce++,ue=k.next()){ie.index>ce?(re=ie,ie=null):re=ie.sibling;var se=E(z,ie,ue.value,X);if(se===null){ie===null&&(ie=re);break}t&&ie&&se.alternate===null&&e(z,ie),F=o(se,F,ce),J===null?Y=se:J.sibling=se,J=se,ie=re}if(ue.done)return n(z,ie),ko&&p0(z,ce),Y;if(ie===null){for(;!ue.done;ce++,ue=k.next())ue=_(z,ue.value,X),ue!==null&&(F=o(ue,F,ce),J===null?Y=ue:J.sibling=ue,J=ue);return ko&&p0(z,ce),Y}for(ie=r(z,ie);!ue.done;ce++,ue=k.next())ue=P(ie,z,ce,ue.value,X),ue!==null&&(t&&ue.alternate!==null&&ie.delete(ue.key===null?ce:ue.key),F=o(ue,F,ce),J===null?Y=ue:J.sibling=ue,J=ue);return t&&ie.forEach(function(me){return e(z,me)}),ko&&p0(z,ce),Y}function V(z,F,k,X){if(typeof k=="object"&&k!==null&&k.type===jy&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case oS:e:{for(var Y=k.key,J=F;J!==null;){if(J.key===Y){if(Y=k.type,Y===jy){if(J.tag===7){n(z,J.sibling),F=i(J,k.props.children),F.return=z,z=F;break e}}else if(J.elementType===Y||typeof Y=="object"&&Y!==null&&Y.$$typeof===vm&&BV(Y)===J.type){n(z,J.sibling),F=i(J,k.props),F.ref=tb(z,J,k),F.return=z,z=F;break e}n(z,J);break}else e(z,J);J=J.sibling}k.type===jy?(F=S0(k.props.children,z.mode,X,k.key),F.return=z,z=F):(X=YT(k.type,k.key,k.props,null,z.mode,X),X.ref=tb(z,F,k),X.return=z,z=X)}return a(z);case Gy:e:{for(J=k.key;F!==null;){if(F.key===J)if(F.tag===4&&F.stateNode.containerInfo===k.containerInfo&&F.stateNode.implementation===k.implementation){n(z,F.sibling),F=i(F,k.children||[]),F.return=z,z=F;break e}else{n(z,F);break}else e(z,F);F=F.sibling}F=SD(k,z.mode,X),F.return=z,z=F}return a(z);case vm:return J=k._init,V(z,F,J(k._payload),X)}if(Gb(k))return R(z,F,k,X);if(Yx(k))return B(z,F,k,X);mS(z,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,F!==null&&F.tag===6?(n(z,F.sibling),F=i(F,k),F.return=z,z=F):(n(z,F),F=ED(k,z.mode,X),F.return=z,z=F),a(z)):n(z,F)}return V}var Mv=AJ(!0),_J=AJ(!1),bE={},Fd=_A(bE),Pw=_A(bE),Iw=_A(bE);function v0(t){if(t===bE)throw Error(vn(174));return t}function Tz(t,e){switch(xo(Iw,e),xo(Pw,t),xo(Fd,bE),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:BN(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=BN(e,t)}Io(Fd),xo(Fd,e)}function Ov(){Io(Fd),Io(Pw),Io(Iw)}function yJ(t){v0(Iw.current);var e=v0(Fd.current),n=BN(e,t.type);e!==n&&(xo(Pw,t),xo(Fd,n))}function Cz(t){Pw.current===t&&(Io(Fd),Io(Pw))}var Ko=_A(0);function UP(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var _D=[];function Pz(){for(var t=0;t<_D.length;t++)_D[t]._workInProgressVersionPrimary=null;_D.length=0}var HT=bg.ReactCurrentDispatcher,yD=bg.ReactCurrentBatchConfig,I0=0,as=null,ra=null,xa=null,GP=!1,rw=!1,Mw=0,sme=0;function pl(){throw Error(vn(321))}function Iz(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!xh(t[n],e[n]))return!1;return!0}function Mz(t,e,n,r,i,o){if(I0=o,as=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,HT.current=t===null||t.memoizedState===null?cme:fme,t=n(r,i),rw){o=0;do{if(rw=!1,Mw=0,25<=o)throw Error(vn(301));o+=1,xa=ra=null,e.updateQueue=null,HT.current=hme,t=n(r,i)}while(rw)}if(HT.current=jP,e=ra!==null&&ra.next!==null,I0=0,xa=ra=as=null,GP=!1,e)throw Error(vn(300));return t}function Oz(){var t=Mw!==0;return Mw=0,t}function xd(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xa===null?as.memoizedState=xa=t:xa=xa.next=t,xa}function yf(){if(ra===null){var t=as.alternate;t=t!==null?t.memoizedState:null}else t=ra.next;var e=xa===null?as.memoizedState:xa.next;if(e!==null)xa=e,ra=t;else{if(t===null)throw Error(vn(310));ra=t,t={memoizedState:ra.memoizedState,baseState:ra.baseState,baseQueue:ra.baseQueue,queue:ra.queue,next:null},xa===null?as.memoizedState=xa=t:xa=xa.next=t}return xa}function Ow(t,e){return typeof e=="function"?e(t):e}function vD(t){var e=yf(),n=e.queue;if(n===null)throw Error(vn(311));n.lastRenderedReducer=t;var r=ra,i=r.baseQueue,o=n.pending;if(o!==null){if(i!==null){var a=i.next;i.next=o.next,o.next=a}r.baseQueue=i=o,n.pending=null}if(i!==null){o=i.next,r=r.baseState;var s=a=null,u=null,d=o;do{var g=d.lane;if((I0&g)===g)u!==null&&(u=u.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var _={lane:g,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};u===null?(s=u=_,a=r):u=u.next=_,as.lanes|=g,M0|=g}d=d.next}while(d!==null&&d!==o);u===null?a=r:u.next=s,xh(r,e.memoizedState)||(Eu=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do o=i.lane,as.lanes|=o,M0|=o,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function xD(t){var e=yf(),n=e.queue;if(n===null)throw Error(vn(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,o=e.memoizedState;if(i!==null){n.pending=null;var a=i=i.next;do o=t(o,a.action),a=a.next;while(a!==i);xh(o,e.memoizedState)||(Eu=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,r]}function vJ(){}function xJ(t,e){var n=as,r=yf(),i=e(),o=!xh(r.memoizedState,i);if(o&&(r.memoizedState=i,Eu=!0),r=r.queue,Rz(EJ.bind(null,n,r,t),[t]),r.getSnapshot!==e||o||xa!==null&&xa.memoizedState.tag&1){if(n.flags|=2048,Rw(9,wJ.bind(null,n,r,i,e),void 0,null),Pa===null)throw Error(vn(349));I0&30||bJ(n,e,i)}return i}function bJ(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=as.updateQueue,e===null?(e={lastEffect:null,stores:null},as.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function wJ(t,e,n,r){e.value=n,e.getSnapshot=r,SJ(e)&&TJ(t)}function EJ(t,e,n){return n(function(){SJ(e)&&TJ(t)})}function SJ(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!xh(t,n)}catch{return!0}}function TJ(t){var e=og(t,1);e!==null&&_h(e,t,1,-1)}function NV(t){var e=xd();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ow,lastRenderedState:t},e.queue=t,t=t.dispatch=ume.bind(null,as,t),[e.memoizedState,t]}function Rw(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=as.updateQueue,e===null?(e={lastEffect:null,stores:null},as.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function CJ(){return yf().memoizedState}function WT(t,e,n,r){var i=xd();as.flags|=t,i.memoizedState=Rw(1|e,n,void 0,r===void 0?null:r)}function xO(t,e,n,r){var i=yf();r=r===void 0?null:r;var o=void 0;if(ra!==null){var a=ra.memoizedState;if(o=a.destroy,r!==null&&Iz(r,a.deps)){i.memoizedState=Rw(e,n,o,r);return}}as.flags|=t,i.memoizedState=Rw(1|e,n,o,r)}function FV(t,e){return WT(8390656,8,t,e)}function Rz(t,e){return xO(2048,8,t,e)}function PJ(t,e){return xO(4,2,t,e)}function IJ(t,e){return xO(4,4,t,e)}function MJ(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function OJ(t,e,n){return n=n!=null?n.concat([t]):null,xO(4,4,MJ.bind(null,e,t),n)}function Lz(){}function RJ(t,e){var n=yf();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Iz(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function LJ(t,e){var n=yf();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Iz(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function DJ(t,e,n){return I0&21?(xh(n,e)||(n=FK(),as.lanes|=n,M0|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Eu=!0),t.memoizedState=n)}function ame(t,e){var n=Ki;Ki=n!==0&&4>n?n:4,t(!0);var r=yD.transition;yD.transition={};try{t(!1),e()}finally{Ki=n,yD.transition=r}}function BJ(){return yf().memoizedState}function lme(t,e,n){var r=km(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},NJ(t))FJ(e,n);else if(n=dJ(t,e,n,r),n!==null){var i=Zl();_h(n,t,r,i),kJ(n,e,r)}}function ume(t,e,n){var r=km(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(NJ(t))FJ(e,i);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var a=e.lastRenderedState,s=o(a,n);if(i.hasEagerState=!0,i.eagerState=s,xh(s,a)){var u=e.interleaved;u===null?(i.next=i,Ez(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}n=dJ(t,e,i,r),n!==null&&(i=Zl(),_h(n,t,r,i),kJ(n,e,r))}}function NJ(t){var e=t.alternate;return t===as||e!==null&&e===as}function FJ(t,e){rw=GP=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function kJ(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,cz(t,n)}}var jP={readContext:_f,useCallback:pl,useContext:pl,useEffect:pl,useImperativeHandle:pl,useInsertionEffect:pl,useLayoutEffect:pl,useMemo:pl,useReducer:pl,useRef:pl,useState:pl,useDebugValue:pl,useDeferredValue:pl,useTransition:pl,useMutableSource:pl,useSyncExternalStore:pl,useId:pl,unstable_isNewReconciler:!1},cme={readContext:_f,useCallback:function(t,e){return xd().memoizedState=[t,e===void 0?null:e],t},useContext:_f,useEffect:FV,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,WT(4194308,4,MJ.bind(null,e,t),n)},useLayoutEffect:function(t,e){return WT(4194308,4,t,e)},useInsertionEffect:function(t,e){return WT(4,2,t,e)},useMemo:function(t,e){var n=xd();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=xd();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=lme.bind(null,as,t),[r.memoizedState,t]},useRef:function(t){var e=xd();return t={current:t},e.memoizedState=t},useState:NV,useDebugValue:Lz,useDeferredValue:function(t){return xd().memoizedState=t},useTransition:function(){var t=NV(!1),e=t[0];return t=ame.bind(null,t[1]),xd().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=as,i=xd();if(ko){if(n===void 0)throw Error(vn(407));n=n()}else{if(n=e(),Pa===null)throw Error(vn(349));I0&30||bJ(r,e,n)}i.memoizedState=n;var o={value:n,getSnapshot:e};return i.queue=o,FV(EJ.bind(null,r,o,t),[t]),r.flags|=2048,Rw(9,wJ.bind(null,r,o,n,e),void 0,null),n},useId:function(){var t=xd(),e=Pa.identifierPrefix;if(ko){var n=Xp,r=qp;n=(r&~(1<<32-Ah(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Mw++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=sme++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},fme={readContext:_f,useCallback:RJ,useContext:_f,useEffect:Rz,useImperativeHandle:OJ,useInsertionEffect:PJ,useLayoutEffect:IJ,useMemo:LJ,useReducer:vD,useRef:CJ,useState:function(){return vD(Ow)},useDebugValue:Lz,useDeferredValue:function(t){var e=yf();return DJ(e,ra.memoizedState,t)},useTransition:function(){var t=vD(Ow)[0],e=yf().memoizedState;return[t,e]},useMutableSource:vJ,useSyncExternalStore:xJ,useId:BJ,unstable_isNewReconciler:!1},hme={readContext:_f,useCallback:RJ,useContext:_f,useEffect:Rz,useImperativeHandle:OJ,useInsertionEffect:PJ,useLayoutEffect:IJ,useMemo:LJ,useReducer:xD,useRef:CJ,useState:function(){return xD(Ow)},useDebugValue:Lz,useDeferredValue:function(t){var e=yf();return ra===null?e.memoizedState=t:DJ(e,ra.memoizedState,t)},useTransition:function(){var t=xD(Ow)[0],e=yf().memoizedState;return[t,e]},useMutableSource:vJ,useSyncExternalStore:xJ,useId:BJ,unstable_isNewReconciler:!1};function Rv(t,e){try{var n="",r=e;do n+=Upe(r),r=r.return;while(r);var i=n}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:i,digest:null}}function bD(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function iF(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var dme=typeof WeakMap=="function"?WeakMap:Map;function zJ(t,e,n){n=Qp(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){$P||($P=!0,pF=r),iF(t,e)},n}function UJ(t,e,n){n=Qp(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){iF(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){iF(t,e),typeof r!="function"&&(Fm===null?Fm=new Set([this]):Fm.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function kV(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new dme;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=Cme.bind(null,t,e,n),e.then(t,t))}function zV(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function UV(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Qp(-1,1),e.tag=2,Nm(n,e,1))),n.lanes|=1),t)}var pme=bg.ReactCurrentOwner,Eu=!1;function Hl(t,e,n,r){e.child=t===null?_J(e,null,n,r):Mv(e,t.child,n,r)}function GV(t,e,n,r,i){n=n.render;var o=e.ref;return pv(e,i),r=Mz(t,e,n,r,o,i),n=Oz(),t!==null&&!Eu?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,sg(t,e,i)):(ko&&n&&_z(e),e.flags|=1,Hl(t,e,r,i),e.child)}function jV(t,e,n,r,i){if(t===null){var o=n.type;return typeof o=="function"&&!Gz(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,GJ(t,e,o,r,i)):(t=YT(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&i)){var a=o.memoizedProps;if(n=n.compare,n=n!==null?n:Ew,n(a,r)&&t.ref===e.ref)return sg(t,e,i)}return e.flags|=1,t=zm(o,r),t.ref=e.ref,t.return=e,e.child=t}function GJ(t,e,n,r,i){if(t!==null){var o=t.memoizedProps;if(Ew(o,r)&&t.ref===e.ref)if(Eu=!1,e.pendingProps=r=o,(t.lanes&i)!==0)t.flags&131072&&(Eu=!0);else return e.lanes=t.lanes,sg(t,e,i)}return oF(t,e,n,r,i)}function jJ(t,e,n){var r=e.pendingProps,i=r.children,o=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},xo(Ky,sc),sc|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,xo(Ky,sc),sc|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:n,xo(Ky,sc),sc|=r}else o!==null?(r=o.baseLanes|n,e.memoizedState=null):r=n,xo(Ky,sc),sc|=r;return Hl(t,e,i,n),e.child}function VJ(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function oF(t,e,n,r,i){var o=Pu(n)?C0:Cl.current;return o=Pv(e,o),pv(e,i),n=Mz(t,e,n,r,o,i),r=Oz(),t!==null&&!Eu?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,sg(t,e,i)):(ko&&r&&_z(e),e.flags|=1,Hl(t,e,n,i),e.child)}function VV(t,e,n,r,i){if(Pu(n)){var o=!0;DP(e)}else o=!1;if(pv(e,i),e.stateNode===null)qT(t,e),mJ(e,n,r),rF(e,n,r,i),r=!0;else if(t===null){var a=e.stateNode,s=e.memoizedProps;a.props=s;var u=a.context,d=n.contextType;typeof d=="object"&&d!==null?d=_f(d):(d=Pu(n)?C0:Cl.current,d=Pv(e,d));var g=n.getDerivedStateFromProps,_=typeof g=="function"||typeof a.getSnapshotBeforeUpdate=="function";_||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==r||u!==d)&&DV(e,a,r,d),xm=!1;var E=e.memoizedState;a.state=E,zP(e,r,a,i),u=e.memoizedState,s!==r||E!==u||Cu.current||xm?(typeof g=="function"&&(nF(e,n,g,r),u=e.memoizedState),(s=xm||LV(e,n,s,r,E,u,d))?(_||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),a.props=r,a.state=u,a.context=d,r=s):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,pJ(t,e),s=e.memoizedProps,d=e.type===e.elementType?s:sh(e.type,s),a.props=d,_=e.pendingProps,E=a.context,u=n.contextType,typeof u=="object"&&u!==null?u=_f(u):(u=Pu(n)?C0:Cl.current,u=Pv(e,u));var P=n.getDerivedStateFromProps;(g=typeof P=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==_||E!==u)&&DV(e,a,r,u),xm=!1,E=e.memoizedState,a.state=E,zP(e,r,a,i);var R=e.memoizedState;s!==_||E!==R||Cu.current||xm?(typeof P=="function"&&(nF(e,n,P,r),R=e.memoizedState),(d=xm||LV(e,n,d,r,E,R,u)||!1)?(g||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,R,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,R,u)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===t.memoizedProps&&E===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&E===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=R),a.props=r,a.state=R,a.context=u,r=d):(typeof a.componentDidUpdate!="function"||s===t.memoizedProps&&E===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&E===t.memoizedState||(e.flags|=1024),r=!1)}return sF(t,e,n,r,o,i)}function sF(t,e,n,r,i,o){VJ(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return i&&PV(e,n,!1),sg(t,e,o);r=e.stateNode,pme.current=e;var s=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=Mv(e,t.child,null,o),e.child=Mv(e,null,s,o)):Hl(t,e,s,o),e.memoizedState=r.state,i&&PV(e,n,!0),e.child}function $J(t){var e=t.stateNode;e.pendingContext?CV(t,e.pendingContext,e.pendingContext!==e.context):e.context&&CV(t,e.context,!1),Tz(t,e.containerInfo)}function $V(t,e,n,r,i){return Iv(),vz(i),e.flags|=256,Hl(t,e,n,r),e.child}var aF={dehydrated:null,treeContext:null,retryLane:0};function lF(t){return{baseLanes:t,cachePool:null,transitions:null}}function HJ(t,e,n){var r=e.pendingProps,i=Ko.current,o=!1,a=(e.flags&128)!==0,s;if((s=a)||(s=t!==null&&t.memoizedState===null?!1:(i&2)!==0),s?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),xo(Ko,i&1),t===null)return eF(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,o?(r=e.mode,o=e.child,a={mode:"hidden",children:a},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=a):o=EO(a,r,0,null),t=S0(t,r,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=lF(n),e.memoizedState=aF,t):Dz(e,a));if(i=t.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return gme(t,e,a,r,s,i,n);if(o){o=r.fallback,a=e.mode,i=t.child,s=i.sibling;var u={mode:"hidden",children:r.children};return!(a&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=zm(i,u),r.subtreeFlags=i.subtreeFlags&14680064),s!==null?o=zm(s,o):(o=S0(o,a,n,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,a=t.child.memoizedState,a=a===null?lF(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=t.childLanes&~n,e.memoizedState=aF,r}return o=t.child,t=o.sibling,r=zm(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Dz(t,e){return e=EO({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function AS(t,e,n,r){return r!==null&&vz(r),Mv(e,t.child,null,n),t=Dz(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function gme(t,e,n,r,i,o,a){if(n)return e.flags&256?(e.flags&=-257,r=bD(Error(vn(422))),AS(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=EO({mode:"visible",children:r.children},i,0,null),o=S0(o,i,a,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&Mv(e,t.child,null,a),e.child.memoizedState=lF(a),e.memoizedState=aF,o);if(!(e.mode&1))return AS(t,e,a,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var s=r.dgst;return r=s,o=Error(vn(419)),r=bD(o,r,void 0),AS(t,e,a,r)}if(s=(a&t.childLanes)!==0,Eu||s){if(r=Pa,r!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|a)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,og(t,i),_h(r,t,i,-1))}return Uz(),r=bD(Error(vn(421))),AS(t,e,a,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=Pme.bind(null,t),i._reactRetry=e,null):(t=o.treeContext,lc=Bm(i.nextSibling),hc=e,ko=!0,lh=null,t!==null&&(af[lf++]=qp,af[lf++]=Xp,af[lf++]=P0,qp=t.id,Xp=t.overflow,P0=e),e=Dz(e,r.children),e.flags|=4096,e)}function HV(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),tF(t.return,e,n)}function wD(t,e,n,r,i){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function WJ(t,e,n){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(Hl(t,e,r.children,n),r=Ko.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&HV(t,n,e);else if(t.tag===19)HV(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(xo(Ko,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&UP(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),wD(e,!1,i,n,o);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&UP(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}wD(e,!0,n,null,o);break;case"together":wD(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function qT(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function sg(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),M0|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(vn(153));if(e.child!==null){for(t=e.child,n=zm(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=zm(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function mme(t,e,n){switch(e.tag){case 3:$J(e),Iv();break;case 5:yJ(e);break;case 1:Pu(e.type)&&DP(e);break;case 4:Tz(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;xo(FP,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(xo(Ko,Ko.current&1),e.flags|=128,null):n&e.child.childLanes?HJ(t,e,n):(xo(Ko,Ko.current&1),t=sg(t,e,n),t!==null?t.sibling:null);xo(Ko,Ko.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return WJ(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),xo(Ko,Ko.current),r)break;return null;case 22:case 23:return e.lanes=0,jJ(t,e,n)}return sg(t,e,n)}var qJ,uF,XJ,ZJ;qJ=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};uF=function(){};XJ=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,v0(Fd.current);var o=null;switch(n){case"input":i=ON(t,i),r=ON(t,r),o=[];break;case"select":i=ls({},i,{value:void 0}),r=ls({},r,{value:void 0}),o=[];break;case"textarea":i=DN(t,i),r=DN(t,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=RP)}NN(n,r);var a;n=null;for(d in i)if(!r.hasOwnProperty(d)&&i.hasOwnProperty(d)&&i[d]!=null)if(d==="style"){var s=i[d];for(a in s)s.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Aw.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in r){var u=r[d];if(s=i!=null?i[d]:void 0,r.hasOwnProperty(d)&&u!==s&&(u!=null||s!=null))if(d==="style")if(s){for(a in s)!s.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in u)u.hasOwnProperty(a)&&s[a]!==u[a]&&(n||(n={}),n[a]=u[a])}else n||(o||(o=[]),o.push(d,n)),n=u;else d==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(o=o||[]).push(d,u)):d==="children"?typeof u!="string"&&typeof u!="number"||(o=o||[]).push(d,""+u):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Aw.hasOwnProperty(d)?(u!=null&&d==="onScroll"&&Po("scroll",t),o||s===u||(o=[])):(o=o||[]).push(d,u))}n&&(o=o||[]).push("style",n);var d=o;(e.updateQueue=d)&&(e.flags|=4)}};ZJ=function(t,e,n,r){n!==r&&(e.flags|=4)};function nb(t,e){if(!ko)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function gl(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Ame(t,e,n){var r=e.pendingProps;switch(yz(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return gl(e),null;case 1:return Pu(e.type)&&LP(),gl(e),null;case 3:return r=e.stateNode,Ov(),Io(Cu),Io(Cl),Pz(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(gS(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,lh!==null&&(AF(lh),lh=null))),uF(t,e),gl(e),null;case 5:Cz(e);var i=v0(Iw.current);if(n=e.type,t!==null&&e.stateNode!=null)XJ(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(vn(166));return gl(e),null}if(t=v0(Fd.current),gS(e)){r=e.stateNode,n=e.type;var o=e.memoizedProps;switch(r[Pd]=e,r[Cw]=o,t=(e.mode&1)!==0,n){case"dialog":Po("cancel",r),Po("close",r);break;case"iframe":case"object":case"embed":Po("load",r);break;case"video":case"audio":for(i=0;i<Vb.length;i++)Po(Vb[i],r);break;case"source":Po("error",r);break;case"img":case"image":case"link":Po("error",r),Po("load",r);break;case"details":Po("toggle",r);break;case"input":eV(r,o),Po("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Po("invalid",r);break;case"textarea":nV(r,o),Po("invalid",r)}NN(n,o),i=null;for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];a==="children"?typeof s=="string"?r.textContent!==s&&(o.suppressHydrationWarning!==!0&&pS(r.textContent,s,t),i=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(o.suppressHydrationWarning!==!0&&pS(r.textContent,s,t),i=["children",""+s]):Aw.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&Po("scroll",r)}switch(n){case"input":sS(r),tV(r,o,!0);break;case"textarea":sS(r),rV(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=RP)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=bK(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[Pd]=e,t[Cw]=r,qJ(t,e,!1,!1),e.stateNode=t;e:{switch(a=FN(n,r),n){case"dialog":Po("cancel",t),Po("close",t),i=r;break;case"iframe":case"object":case"embed":Po("load",t),i=r;break;case"video":case"audio":for(i=0;i<Vb.length;i++)Po(Vb[i],t);i=r;break;case"source":Po("error",t),i=r;break;case"img":case"image":case"link":Po("error",t),Po("load",t),i=r;break;case"details":Po("toggle",t),i=r;break;case"input":eV(t,r),i=ON(t,r),Po("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=ls({},r,{value:void 0}),Po("invalid",t);break;case"textarea":nV(t,r),i=DN(t,r),Po("invalid",t);break;default:i=r}NN(n,i),s=i;for(o in s)if(s.hasOwnProperty(o)){var u=s[o];o==="style"?SK(t,u):o==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&wK(t,u)):o==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&_w(t,u):typeof u=="number"&&_w(t,""+u):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Aw.hasOwnProperty(o)?u!=null&&o==="onScroll"&&Po("scroll",t):u!=null&&iz(t,o,u,a))}switch(n){case"input":sS(t),tV(t,r,!1);break;case"textarea":sS(t),rV(t);break;case"option":r.value!=null&&t.setAttribute("value",""+qm(r.value));break;case"select":t.multiple=!!r.multiple,o=r.value,o!=null?cv(t,!!r.multiple,o,!1):r.defaultValue!=null&&cv(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=RP)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return gl(e),null;case 6:if(t&&e.stateNode!=null)ZJ(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(vn(166));if(n=v0(Iw.current),v0(Fd.current),gS(e)){if(r=e.stateNode,n=e.memoizedProps,r[Pd]=e,(o=r.nodeValue!==n)&&(t=hc,t!==null))switch(t.tag){case 3:pS(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&pS(r.nodeValue,n,(t.mode&1)!==0)}o&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Pd]=e,e.stateNode=r}return gl(e),null;case 13:if(Io(Ko),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ko&&lc!==null&&e.mode&1&&!(e.flags&128))hJ(),Iv(),e.flags|=98560,o=!1;else if(o=gS(e),r!==null&&r.dehydrated!==null){if(t===null){if(!o)throw Error(vn(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(vn(317));o[Pd]=e}else Iv(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;gl(e),o=!1}else lh!==null&&(AF(lh),lh=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Ko.current&1?oa===0&&(oa=3):Uz())),e.updateQueue!==null&&(e.flags|=4),gl(e),null);case 4:return Ov(),uF(t,e),t===null&&Sw(e.stateNode.containerInfo),gl(e),null;case 10:return wz(e.type._context),gl(e),null;case 17:return Pu(e.type)&&LP(),gl(e),null;case 19:if(Io(Ko),o=e.memoizedState,o===null)return gl(e),null;if(r=(e.flags&128)!==0,a=o.rendering,a===null)if(r)nb(o,!1);else{if(oa!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=UP(t),a!==null){for(e.flags|=128,nb(o,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)o=n,t=r,o.flags&=14680066,a=o.alternate,a===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,t=a.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return xo(Ko,Ko.current&1|2),e.child}t=t.sibling}o.tail!==null&&Ss()>Lv&&(e.flags|=128,r=!0,nb(o,!1),e.lanes=4194304)}else{if(!r)if(t=UP(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),nb(o,!0),o.tail===null&&o.tailMode==="hidden"&&!a.alternate&&!ko)return gl(e),null}else 2*Ss()-o.renderingStartTime>Lv&&n!==1073741824&&(e.flags|=128,r=!0,nb(o,!1),e.lanes=4194304);o.isBackwards?(a.sibling=e.child,e.child=a):(n=o.last,n!==null?n.sibling=a:e.child=a,o.last=a)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Ss(),e.sibling=null,n=Ko.current,xo(Ko,r?n&1|2:n&1),e):(gl(e),null);case 22:case 23:return zz(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?sc&1073741824&&(gl(e),e.subtreeFlags&6&&(e.flags|=8192)):gl(e),null;case 24:return null;case 25:return null}throw Error(vn(156,e.tag))}function _me(t,e){switch(yz(e),e.tag){case 1:return Pu(e.type)&&LP(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ov(),Io(Cu),Io(Cl),Pz(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Cz(e),null;case 13:if(Io(Ko),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(vn(340));Iv()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Io(Ko),null;case 4:return Ov(),null;case 10:return wz(e.type._context),null;case 22:case 23:return zz(),null;case 24:return null;default:return null}}var _S=!1,xl=!1,yme=typeof WeakSet=="function"?WeakSet:Set,Zn=null;function Qy(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){As(t,e,r)}else n.current=null}function cF(t,e,n){try{n()}catch(r){As(t,e,r)}}var WV=!1;function vme(t,e){if(qN=IP,t=JK(),Az(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var a=0,s=-1,u=-1,d=0,g=0,_=t,E=null;t:for(;;){for(var P;_!==n||i!==0&&_.nodeType!==3||(s=a+i),_!==o||r!==0&&_.nodeType!==3||(u=a+r),_.nodeType===3&&(a+=_.nodeValue.length),(P=_.firstChild)!==null;)E=_,_=P;for(;;){if(_===t)break t;if(E===n&&++d===i&&(s=a),E===o&&++g===r&&(u=a),(P=_.nextSibling)!==null)break;_=E,E=_.parentNode}_=P}n=s===-1||u===-1?null:{start:s,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(XN={focusedElem:t,selectionRange:n},IP=!1,Zn=e;Zn!==null;)if(e=Zn,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Zn=t;else for(;Zn!==null;){e=Zn;try{var R=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(R!==null){var B=R.memoizedProps,V=R.memoizedState,z=e.stateNode,F=z.getSnapshotBeforeUpdate(e.elementType===e.type?B:sh(e.type,B),V);z.__reactInternalSnapshotBeforeUpdate=F}break;case 3:var k=e.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(vn(163))}}catch(X){As(e,e.return,X)}if(t=e.sibling,t!==null){t.return=e.return,Zn=t;break}Zn=e.return}return R=WV,WV=!1,R}function iw(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var o=i.destroy;i.destroy=void 0,o!==void 0&&cF(e,n,o)}i=i.next}while(i!==r)}}function bO(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function fF(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function YJ(t){var e=t.alternate;e!==null&&(t.alternate=null,YJ(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Pd],delete e[Cw],delete e[QN],delete e[nme],delete e[rme])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function QJ(t){return t.tag===5||t.tag===3||t.tag===4}function qV(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||QJ(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function hF(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=RP));else if(r!==4&&(t=t.child,t!==null))for(hF(t,e,n),t=t.sibling;t!==null;)hF(t,e,n),t=t.sibling}function dF(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(dF(t,e,n),t=t.sibling;t!==null;)dF(t,e,n),t=t.sibling}var $a=null,ah=!1;function am(t,e,n){for(n=n.child;n!==null;)KJ(t,e,n),n=n.sibling}function KJ(t,e,n){if(Nd&&typeof Nd.onCommitFiberUnmount=="function")try{Nd.onCommitFiberUnmount(pO,n)}catch{}switch(n.tag){case 5:xl||Qy(n,e);case 6:var r=$a,i=ah;$a=null,am(t,e,n),$a=r,ah=i,$a!==null&&(ah?(t=$a,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):$a.removeChild(n.stateNode));break;case 18:$a!==null&&(ah?(t=$a,n=n.stateNode,t.nodeType===8?mD(t.parentNode,n):t.nodeType===1&&mD(t,n),bw(t)):mD($a,n.stateNode));break;case 4:r=$a,i=ah,$a=n.stateNode.containerInfo,ah=!0,am(t,e,n),$a=r,ah=i;break;case 0:case 11:case 14:case 15:if(!xl&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,a=o.destroy;o=o.tag,a!==void 0&&(o&2||o&4)&&cF(n,e,a),i=i.next}while(i!==r)}am(t,e,n);break;case 1:if(!xl&&(Qy(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){As(n,e,s)}am(t,e,n);break;case 21:am(t,e,n);break;case 22:n.mode&1?(xl=(r=xl)||n.memoizedState!==null,am(t,e,n),xl=r):am(t,e,n);break;default:am(t,e,n)}}function XV(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new yme),e.forEach(function(r){var i=Ime.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function rh(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var o=t,a=e,s=a;e:for(;s!==null;){switch(s.tag){case 5:$a=s.stateNode,ah=!1;break e;case 3:$a=s.stateNode.containerInfo,ah=!0;break e;case 4:$a=s.stateNode.containerInfo,ah=!0;break e}s=s.return}if($a===null)throw Error(vn(160));KJ(o,a,i),$a=null,ah=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(d){As(i,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)JJ(e,t),e=e.sibling}function JJ(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(rh(e,t),fd(t),r&4){try{iw(3,t,t.return),bO(3,t)}catch(B){As(t,t.return,B)}try{iw(5,t,t.return)}catch(B){As(t,t.return,B)}}break;case 1:rh(e,t),fd(t),r&512&&n!==null&&Qy(n,n.return);break;case 5:if(rh(e,t),fd(t),r&512&&n!==null&&Qy(n,n.return),t.flags&32){var i=t.stateNode;try{_w(i,"")}catch(B){As(t,t.return,B)}}if(r&4&&(i=t.stateNode,i!=null)){var o=t.memoizedProps,a=n!==null?n.memoizedProps:o,s=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{s==="input"&&o.type==="radio"&&o.name!=null&&vK(i,o),FN(s,a);var d=FN(s,o);for(a=0;a<u.length;a+=2){var g=u[a],_=u[a+1];g==="style"?SK(i,_):g==="dangerouslySetInnerHTML"?wK(i,_):g==="children"?_w(i,_):iz(i,g,_,d)}switch(s){case"input":RN(i,o);break;case"textarea":xK(i,o);break;case"select":var E=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var P=o.value;P!=null?cv(i,!!o.multiple,P,!1):E!==!!o.multiple&&(o.defaultValue!=null?cv(i,!!o.multiple,o.defaultValue,!0):cv(i,!!o.multiple,o.multiple?[]:"",!1))}i[Cw]=o}catch(B){As(t,t.return,B)}}break;case 6:if(rh(e,t),fd(t),r&4){if(t.stateNode===null)throw Error(vn(162));i=t.stateNode,o=t.memoizedProps;try{i.nodeValue=o}catch(B){As(t,t.return,B)}}break;case 3:if(rh(e,t),fd(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{bw(e.containerInfo)}catch(B){As(t,t.return,B)}break;case 4:rh(e,t),fd(t);break;case 13:rh(e,t),fd(t),i=t.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(Fz=Ss())),r&4&&XV(t);break;case 22:if(g=n!==null&&n.memoizedState!==null,t.mode&1?(xl=(d=xl)||g,rh(e,t),xl=d):rh(e,t),fd(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!g&&t.mode&1)for(Zn=t,g=t.child;g!==null;){for(_=Zn=g;Zn!==null;){switch(E=Zn,P=E.child,E.tag){case 0:case 11:case 14:case 15:iw(4,E,E.return);break;case 1:Qy(E,E.return);var R=E.stateNode;if(typeof R.componentWillUnmount=="function"){r=E,n=E.return;try{e=r,R.props=e.memoizedProps,R.state=e.memoizedState,R.componentWillUnmount()}catch(B){As(r,n,B)}}break;case 5:Qy(E,E.return);break;case 22:if(E.memoizedState!==null){YV(_);continue}}P!==null?(P.return=E,Zn=P):YV(_)}g=g.sibling}e:for(g=null,_=t;;){if(_.tag===5){if(g===null){g=_;try{i=_.stateNode,d?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(s=_.stateNode,u=_.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,s.style.display=EK("display",a))}catch(B){As(t,t.return,B)}}}else if(_.tag===6){if(g===null)try{_.stateNode.nodeValue=d?"":_.memoizedProps}catch(B){As(t,t.return,B)}}else if((_.tag!==22&&_.tag!==23||_.memoizedState===null||_===t)&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===t)break e;for(;_.sibling===null;){if(_.return===null||_.return===t)break e;g===_&&(g=null),_=_.return}g===_&&(g=null),_.sibling.return=_.return,_=_.sibling}}break;case 19:rh(e,t),fd(t),r&4&&XV(t);break;case 21:break;default:rh(e,t),fd(t)}}function fd(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(QJ(n)){var r=n;break e}n=n.return}throw Error(vn(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(_w(i,""),r.flags&=-33);var o=qV(t);dF(t,o,i);break;case 3:case 4:var a=r.stateNode.containerInfo,s=qV(t);hF(t,s,a);break;default:throw Error(vn(161))}}catch(u){As(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function xme(t,e,n){Zn=t,eee(t)}function eee(t,e,n){for(var r=(t.mode&1)!==0;Zn!==null;){var i=Zn,o=i.child;if(i.tag===22&&r){var a=i.memoizedState!==null||_S;if(!a){var s=i.alternate,u=s!==null&&s.memoizedState!==null||xl;s=_S;var d=xl;if(_S=a,(xl=u)&&!d)for(Zn=i;Zn!==null;)a=Zn,u=a.child,a.tag===22&&a.memoizedState!==null?QV(i):u!==null?(u.return=a,Zn=u):QV(i);for(;o!==null;)Zn=o,eee(o),o=o.sibling;Zn=i,_S=s,xl=d}ZV(t)}else i.subtreeFlags&8772&&o!==null?(o.return=i,Zn=o):ZV(t)}}function ZV(t){for(;Zn!==null;){var e=Zn;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:xl||bO(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!xl)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:sh(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&RV(e,o,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}RV(e,a,n)}break;case 5:var s=e.stateNode;if(n===null&&e.flags&4){n=s;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var g=d.memoizedState;if(g!==null){var _=g.dehydrated;_!==null&&bw(_)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(vn(163))}xl||e.flags&512&&fF(e)}catch(E){As(e,e.return,E)}}if(e===t){Zn=null;break}if(n=e.sibling,n!==null){n.return=e.return,Zn=n;break}Zn=e.return}}function YV(t){for(;Zn!==null;){var e=Zn;if(e===t){Zn=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Zn=n;break}Zn=e.return}}function QV(t){for(;Zn!==null;){var e=Zn;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{bO(4,e)}catch(u){As(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(u){As(e,i,u)}}var o=e.return;try{fF(e)}catch(u){As(e,o,u)}break;case 5:var a=e.return;try{fF(e)}catch(u){As(e,a,u)}}}catch(u){As(e,e.return,u)}if(e===t){Zn=null;break}var s=e.sibling;if(s!==null){s.return=e.return,Zn=s;break}Zn=e.return}}var bme=Math.ceil,VP=bg.ReactCurrentDispatcher,Bz=bg.ReactCurrentOwner,pf=bg.ReactCurrentBatchConfig,vi=0,Pa=null,Vs=null,Qa=0,sc=0,Ky=_A(0),oa=0,Lw=null,M0=0,wO=0,Nz=0,ow=null,bu=null,Fz=0,Lv=1/0,Gp=null,$P=!1,pF=null,Fm=null,yS=!1,Tm=null,HP=0,sw=0,gF=null,XT=-1,ZT=0;function Zl(){return vi&6?Ss():XT!==-1?XT:XT=Ss()}function km(t){return t.mode&1?vi&2&&Qa!==0?Qa&-Qa:ome.transition!==null?(ZT===0&&(ZT=FK()),ZT):(t=Ki,t!==0||(t=window.event,t=t===void 0?16:$K(t.type)),t):1}function _h(t,e,n,r){if(50<sw)throw sw=0,gF=null,Error(vn(185));yE(t,n,r),(!(vi&2)||t!==Pa)&&(t===Pa&&(!(vi&2)&&(wO|=n),oa===4&&wm(t,Qa)),Iu(t,r),n===1&&vi===0&&!(e.mode&1)&&(Lv=Ss()+500,yO&&yA()))}function Iu(t,e){var n=t.callbackNode;oge(t,e);var r=PP(t,t===Pa?Qa:0);if(r===0)n!==null&&sV(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&sV(n),e===1)t.tag===0?ime(KV.bind(null,t)):uJ(KV.bind(null,t)),eme(function(){!(vi&6)&&yA()}),n=null;else{switch(kK(r)){case 1:n=uz;break;case 4:n=BK;break;case 16:n=CP;break;case 536870912:n=NK;break;default:n=CP}n=lee(n,tee.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function tee(t,e){if(XT=-1,ZT=0,vi&6)throw Error(vn(327));var n=t.callbackNode;if(gv()&&t.callbackNode!==n)return null;var r=PP(t,t===Pa?Qa:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=WP(t,r);else{e=r;var i=vi;vi|=2;var o=ree();(Pa!==t||Qa!==e)&&(Gp=null,Lv=Ss()+500,E0(t,e));do try{Sme();break}catch(s){nee(t,s)}while(1);bz(),VP.current=o,vi=i,Vs!==null?e=0:(Pa=null,Qa=0,e=oa)}if(e!==0){if(e===2&&(i=jN(t),i!==0&&(r=i,e=mF(t,i))),e===1)throw n=Lw,E0(t,0),wm(t,r),Iu(t,Ss()),n;if(e===6)wm(t,r);else{if(i=t.current.alternate,!(r&30)&&!wme(i)&&(e=WP(t,r),e===2&&(o=jN(t),o!==0&&(r=o,e=mF(t,o))),e===1))throw n=Lw,E0(t,0),wm(t,r),Iu(t,Ss()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(vn(345));case 2:g0(t,bu,Gp);break;case 3:if(wm(t,r),(r&130023424)===r&&(e=Fz+500-Ss(),10<e)){if(PP(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){Zl(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=YN(g0.bind(null,t,bu,Gp),e);break}g0(t,bu,Gp);break;case 4:if(wm(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var a=31-Ah(r);o=1<<a,a=e[a],a>i&&(i=a),r&=~o}if(r=i,r=Ss()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*bme(r/1960))-r,10<r){t.timeoutHandle=YN(g0.bind(null,t,bu,Gp),r);break}g0(t,bu,Gp);break;case 5:g0(t,bu,Gp);break;default:throw Error(vn(329))}}}return Iu(t,Ss()),t.callbackNode===n?tee.bind(null,t):null}function mF(t,e){var n=ow;return t.current.memoizedState.isDehydrated&&(E0(t,e).flags|=256),t=WP(t,e),t!==2&&(e=bu,bu=n,e!==null&&AF(e)),t}function AF(t){bu===null?bu=t:bu.push.apply(bu,t)}function wme(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!xh(o(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function wm(t,e){for(e&=~Nz,e&=~wO,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ah(e),r=1<<n;t[n]=-1,e&=~r}}function KV(t){if(vi&6)throw Error(vn(327));gv();var e=PP(t,0);if(!(e&1))return Iu(t,Ss()),null;var n=WP(t,e);if(t.tag!==0&&n===2){var r=jN(t);r!==0&&(e=r,n=mF(t,r))}if(n===1)throw n=Lw,E0(t,0),wm(t,e),Iu(t,Ss()),n;if(n===6)throw Error(vn(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,g0(t,bu,Gp),Iu(t,Ss()),null}function kz(t,e){var n=vi;vi|=1;try{return t(e)}finally{vi=n,vi===0&&(Lv=Ss()+500,yO&&yA())}}function O0(t){Tm!==null&&Tm.tag===0&&!(vi&6)&&gv();var e=vi;vi|=1;var n=pf.transition,r=Ki;try{if(pf.transition=null,Ki=1,t)return t()}finally{Ki=r,pf.transition=n,vi=e,!(vi&6)&&yA()}}function zz(){sc=Ky.current,Io(Ky)}function E0(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Jge(n)),Vs!==null)for(n=Vs.return;n!==null;){var r=n;switch(yz(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&LP();break;case 3:Ov(),Io(Cu),Io(Cl),Pz();break;case 5:Cz(r);break;case 4:Ov();break;case 13:Io(Ko);break;case 19:Io(Ko);break;case 10:wz(r.type._context);break;case 22:case 23:zz()}n=n.return}if(Pa=t,Vs=t=zm(t.current,null),Qa=sc=e,oa=0,Lw=null,Nz=wO=M0=0,bu=ow=null,y0!==null){for(e=0;e<y0.length;e++)if(n=y0[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,o=n.pending;if(o!==null){var a=o.next;o.next=i,r.next=a}n.pending=r}y0=null}return t}function nee(t,e){do{var n=Vs;try{if(bz(),HT.current=jP,GP){for(var r=as.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}GP=!1}if(I0=0,xa=ra=as=null,rw=!1,Mw=0,Bz.current=null,n===null||n.return===null){oa=1,Lw=e,Vs=null;break}e:{var o=t,a=n.return,s=n,u=e;if(e=Qa,s.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var d=u,g=s,_=g.tag;if(!(g.mode&1)&&(_===0||_===11||_===15)){var E=g.alternate;E?(g.updateQueue=E.updateQueue,g.memoizedState=E.memoizedState,g.lanes=E.lanes):(g.updateQueue=null,g.memoizedState=null)}var P=zV(a);if(P!==null){P.flags&=-257,UV(P,a,s,o,e),P.mode&1&&kV(o,d,e),e=P,u=d;var R=e.updateQueue;if(R===null){var B=new Set;B.add(u),e.updateQueue=B}else R.add(u);break e}else{if(!(e&1)){kV(o,d,e),Uz();break e}u=Error(vn(426))}}else if(ko&&s.mode&1){var V=zV(a);if(V!==null){!(V.flags&65536)&&(V.flags|=256),UV(V,a,s,o,e),vz(Rv(u,s));break e}}o=u=Rv(u,s),oa!==4&&(oa=2),ow===null?ow=[o]:ow.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var z=zJ(o,u,e);OV(o,z);break e;case 1:s=u;var F=o.type,k=o.stateNode;if(!(o.flags&128)&&(typeof F.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(Fm===null||!Fm.has(k)))){o.flags|=65536,e&=-e,o.lanes|=e;var X=UJ(o,s,e);OV(o,X);break e}}o=o.return}while(o!==null)}oee(n)}catch(Y){e=Y,Vs===n&&n!==null&&(Vs=n=n.return);continue}break}while(1)}function ree(){var t=VP.current;return VP.current=jP,t===null?jP:t}function Uz(){(oa===0||oa===3||oa===2)&&(oa=4),Pa===null||!(M0&268435455)&&!(wO&268435455)||wm(Pa,Qa)}function WP(t,e){var n=vi;vi|=2;var r=ree();(Pa!==t||Qa!==e)&&(Gp=null,E0(t,e));do try{Eme();break}catch(i){nee(t,i)}while(1);if(bz(),vi=n,VP.current=r,Vs!==null)throw Error(vn(261));return Pa=null,Qa=0,oa}function Eme(){for(;Vs!==null;)iee(Vs)}function Sme(){for(;Vs!==null&&!Ype();)iee(Vs)}function iee(t){var e=aee(t.alternate,t,sc);t.memoizedProps=t.pendingProps,e===null?oee(t):Vs=e,Bz.current=null}function oee(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=_me(n,e),n!==null){n.flags&=32767,Vs=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{oa=6,Vs=null;return}}else if(n=Ame(n,e,sc),n!==null){Vs=n;return}if(e=e.sibling,e!==null){Vs=e;return}Vs=e=t}while(e!==null);oa===0&&(oa=5)}function g0(t,e,n){var r=Ki,i=pf.transition;try{pf.transition=null,Ki=1,Tme(t,e,n,r)}finally{pf.transition=i,Ki=r}return null}function Tme(t,e,n,r){do gv();while(Tm!==null);if(vi&6)throw Error(vn(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(vn(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(sge(t,o),t===Pa&&(Vs=Pa=null,Qa=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||yS||(yS=!0,lee(CP,function(){return gv(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=pf.transition,pf.transition=null;var a=Ki;Ki=1;var s=vi;vi|=4,Bz.current=null,vme(t,n),JJ(n,t),Wge(XN),IP=!!qN,XN=qN=null,t.current=n,xme(n),Qpe(),vi=s,Ki=a,pf.transition=o}else t.current=n;if(yS&&(yS=!1,Tm=t,HP=i),o=t.pendingLanes,o===0&&(Fm=null),ege(n.stateNode),Iu(t,Ss()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if($P)throw $P=!1,t=pF,pF=null,t;return HP&1&&t.tag!==0&&gv(),o=t.pendingLanes,o&1?t===gF?sw++:(sw=0,gF=t):sw=0,yA(),null}function gv(){if(Tm!==null){var t=kK(HP),e=pf.transition,n=Ki;try{if(pf.transition=null,Ki=16>t?16:t,Tm===null)var r=!1;else{if(t=Tm,Tm=null,HP=0,vi&6)throw Error(vn(331));var i=vi;for(vi|=4,Zn=t.current;Zn!==null;){var o=Zn,a=o.child;if(Zn.flags&16){var s=o.deletions;if(s!==null){for(var u=0;u<s.length;u++){var d=s[u];for(Zn=d;Zn!==null;){var g=Zn;switch(g.tag){case 0:case 11:case 15:iw(8,g,o)}var _=g.child;if(_!==null)_.return=g,Zn=_;else for(;Zn!==null;){g=Zn;var E=g.sibling,P=g.return;if(YJ(g),g===d){Zn=null;break}if(E!==null){E.return=P,Zn=E;break}Zn=P}}}var R=o.alternate;if(R!==null){var B=R.child;if(B!==null){R.child=null;do{var V=B.sibling;B.sibling=null,B=V}while(B!==null)}}Zn=o}}if(o.subtreeFlags&2064&&a!==null)a.return=o,Zn=a;else e:for(;Zn!==null;){if(o=Zn,o.flags&2048)switch(o.tag){case 0:case 11:case 15:iw(9,o,o.return)}var z=o.sibling;if(z!==null){z.return=o.return,Zn=z;break e}Zn=o.return}}var F=t.current;for(Zn=F;Zn!==null;){a=Zn;var k=a.child;if(a.subtreeFlags&2064&&k!==null)k.return=a,Zn=k;else e:for(a=F;Zn!==null;){if(s=Zn,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:bO(9,s)}}catch(Y){As(s,s.return,Y)}if(s===a){Zn=null;break e}var X=s.sibling;if(X!==null){X.return=s.return,Zn=X;break e}Zn=s.return}}if(vi=i,yA(),Nd&&typeof Nd.onPostCommitFiberRoot=="function")try{Nd.onPostCommitFiberRoot(pO,t)}catch{}r=!0}return r}finally{Ki=n,pf.transition=e}}return!1}function JV(t,e,n){e=Rv(n,e),e=zJ(t,e,1),t=Nm(t,e,1),e=Zl(),t!==null&&(yE(t,1,e),Iu(t,e))}function As(t,e,n){if(t.tag===3)JV(t,t,n);else for(;e!==null;){if(e.tag===3){JV(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Fm===null||!Fm.has(r))){t=Rv(n,t),t=UJ(e,t,1),e=Nm(e,t,1),t=Zl(),e!==null&&(yE(e,1,t),Iu(e,t));break}}e=e.return}}function Cme(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Zl(),t.pingedLanes|=t.suspendedLanes&n,Pa===t&&(Qa&n)===n&&(oa===4||oa===3&&(Qa&130023424)===Qa&&500>Ss()-Fz?E0(t,0):Nz|=n),Iu(t,e)}function see(t,e){e===0&&(t.mode&1?(e=uS,uS<<=1,!(uS&130023424)&&(uS=4194304)):e=1);var n=Zl();t=og(t,e),t!==null&&(yE(t,e,n),Iu(t,n))}function Pme(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),see(t,n)}function Ime(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(vn(314))}r!==null&&r.delete(e),see(t,n)}var aee;aee=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Cu.current)Eu=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Eu=!1,mme(t,e,n);Eu=!!(t.flags&131072)}else Eu=!1,ko&&e.flags&1048576&&cJ(e,NP,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;qT(t,e),t=e.pendingProps;var i=Pv(e,Cl.current);pv(e,n),i=Mz(null,e,r,t,i,n);var o=Oz();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Pu(r)?(o=!0,DP(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Sz(e),i.updater=vO,e.stateNode=i,i._reactInternals=e,rF(e,r,t,n),e=sF(null,e,r,!0,o,n)):(e.tag=0,ko&&o&&_z(e),Hl(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(qT(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=Ome(r),t=sh(r,t),i){case 0:e=oF(null,e,r,t,n);break e;case 1:e=VV(null,e,r,t,n);break e;case 11:e=GV(null,e,r,t,n);break e;case 14:e=jV(null,e,r,sh(r.type,t),n);break e}throw Error(vn(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:sh(r,i),oF(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:sh(r,i),VV(t,e,r,i,n);case 3:e:{if($J(e),t===null)throw Error(vn(387));r=e.pendingProps,o=e.memoizedState,i=o.element,pJ(t,e),zP(e,r,null,n);var a=e.memoizedState;if(r=a.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=Rv(Error(vn(423)),e),e=$V(t,e,r,n,i);break e}else if(r!==i){i=Rv(Error(vn(424)),e),e=$V(t,e,r,n,i);break e}else for(lc=Bm(e.stateNode.containerInfo.firstChild),hc=e,ko=!0,lh=null,n=_J(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Iv(),r===i){e=sg(t,e,n);break e}Hl(t,e,r,n)}e=e.child}return e;case 5:return yJ(e),t===null&&eF(e),r=e.type,i=e.pendingProps,o=t!==null?t.memoizedProps:null,a=i.children,ZN(r,i)?a=null:o!==null&&ZN(r,o)&&(e.flags|=32),VJ(t,e),Hl(t,e,a,n),e.child;case 6:return t===null&&eF(e),null;case 13:return HJ(t,e,n);case 4:return Tz(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Mv(e,null,r,n):Hl(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:sh(r,i),GV(t,e,r,i,n);case 7:return Hl(t,e,e.pendingProps,n),e.child;case 8:return Hl(t,e,e.pendingProps.children,n),e.child;case 12:return Hl(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,a=i.value,xo(FP,r._currentValue),r._currentValue=a,o!==null)if(xh(o.value,a)){if(o.children===i.children&&!Cu.current){e=sg(t,e,n);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var s=o.dependencies;if(s!==null){a=o.child;for(var u=s.firstContext;u!==null;){if(u.context===r){if(o.tag===1){u=Qp(-1,n&-n),u.tag=2;var d=o.updateQueue;if(d!==null){d=d.shared;var g=d.pending;g===null?u.next=u:(u.next=g.next,g.next=u),d.pending=u}}o.lanes|=n,u=o.alternate,u!==null&&(u.lanes|=n),tF(o.return,n,e),s.lanes|=n;break}u=u.next}}else if(o.tag===10)a=o.type===e.type?null:o.child;else if(o.tag===18){if(a=o.return,a===null)throw Error(vn(341));a.lanes|=n,s=a.alternate,s!==null&&(s.lanes|=n),tF(a,n,e),a=o.sibling}else a=o.child;if(a!==null)a.return=o;else for(a=o;a!==null;){if(a===e){a=null;break}if(o=a.sibling,o!==null){o.return=a.return,a=o;break}a=a.return}o=a}Hl(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,pv(e,n),i=_f(i),r=r(i),e.flags|=1,Hl(t,e,r,n),e.child;case 14:return r=e.type,i=sh(r,e.pendingProps),i=sh(r.type,i),jV(t,e,r,i,n);case 15:return GJ(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:sh(r,i),qT(t,e),e.tag=1,Pu(r)?(t=!0,DP(e)):t=!1,pv(e,n),mJ(e,r,i),rF(e,r,i,n),sF(null,e,r,!0,t,n);case 19:return WJ(t,e,n);case 22:return jJ(t,e,n)}throw Error(vn(156,e.tag))};function lee(t,e){return DK(t,e)}function Mme(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ff(t,e,n,r){return new Mme(t,e,n,r)}function Gz(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Ome(t){if(typeof t=="function")return Gz(t)?1:0;if(t!=null){if(t=t.$$typeof,t===sz)return 11;if(t===az)return 14}return 2}function zm(t,e){var n=t.alternate;return n===null?(n=ff(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function YT(t,e,n,r,i,o){var a=2;if(r=t,typeof t=="function")Gz(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case jy:return S0(n.children,i,o,e);case oz:a=8,i|=8;break;case CN:return t=ff(12,n,e,i|2),t.elementType=CN,t.lanes=o,t;case PN:return t=ff(13,n,e,i),t.elementType=PN,t.lanes=o,t;case IN:return t=ff(19,n,e,i),t.elementType=IN,t.lanes=o,t;case AK:return EO(n,i,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case gK:a=10;break e;case mK:a=9;break e;case sz:a=11;break e;case az:a=14;break e;case vm:a=16,r=null;break e}throw Error(vn(130,t==null?t:typeof t,""))}return e=ff(a,n,e,i),e.elementType=t,e.type=r,e.lanes=o,e}function S0(t,e,n,r){return t=ff(7,t,r,e),t.lanes=n,t}function EO(t,e,n,r){return t=ff(22,t,r,e),t.elementType=AK,t.lanes=n,t.stateNode={isHidden:!1},t}function ED(t,e,n){return t=ff(6,t,null,e),t.lanes=n,t}function SD(t,e,n){return e=ff(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Rme(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=oD(0),this.expirationTimes=oD(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=oD(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function jz(t,e,n,r,i,o,a,s,u){return t=new Rme(t,e,n,s,u),e===1?(e=1,o===!0&&(e|=8)):e=0,o=ff(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Sz(o),t}function Lme(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Gy,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function uee(t){if(!t)return Xm;t=t._reactInternals;e:{if(o_(t)!==t||t.tag!==1)throw Error(vn(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Pu(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(vn(171))}if(t.tag===1){var n=t.type;if(Pu(n))return lJ(t,n,e)}return e}function cee(t,e,n,r,i,o,a,s,u){return t=jz(n,r,!0,t,i,o,a,s,u),t.context=uee(null),n=t.current,r=Zl(),i=km(n),o=Qp(r,i),o.callback=e??null,Nm(n,o,i),t.current.lanes=i,yE(t,i,r),Iu(t,r),t}function SO(t,e,n,r){var i=e.current,o=Zl(),a=km(i);return n=uee(n),e.context===null?e.context=n:e.pendingContext=n,e=Qp(o,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Nm(i,e,a),t!==null&&(_h(t,i,a,o),$T(t,i,a)),a}function qP(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function e9(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Vz(t,e){e9(t,e),(t=t.alternate)&&e9(t,e)}function Dme(){return null}var fee=typeof reportError=="function"?reportError:function(t){console.error(t)};function $z(t){this._internalRoot=t}TO.prototype.render=$z.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(vn(409));SO(t,e,null,null)};TO.prototype.unmount=$z.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;O0(function(){SO(null,t,null,null)}),e[ig]=null}};function TO(t){this._internalRoot=t}TO.prototype.unstable_scheduleHydration=function(t){if(t){var e=GK();t={blockedOn:null,target:t,priority:e};for(var n=0;n<bm.length&&e!==0&&e<bm[n].priority;n++);bm.splice(n,0,t),n===0&&VK(t)}};function Hz(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function CO(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function t9(){}function Bme(t,e,n,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var d=qP(a);o.call(d)}}var a=cee(e,r,t,0,null,!1,!1,"",t9);return t._reactRootContainer=a,t[ig]=a.current,Sw(t.nodeType===8?t.parentNode:t),O0(),a}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var s=r;r=function(){var d=qP(u);s.call(d)}}var u=jz(t,0,!1,null,null,!1,!1,"",t9);return t._reactRootContainer=u,t[ig]=u.current,Sw(t.nodeType===8?t.parentNode:t),O0(function(){SO(e,u,n,r)}),u}function PO(t,e,n,r,i){var o=n._reactRootContainer;if(o){var a=o;if(typeof i=="function"){var s=i;i=function(){var u=qP(a);s.call(u)}}SO(e,a,t,i)}else a=Bme(n,e,t,i,r);return qP(a)}zK=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=jb(e.pendingLanes);n!==0&&(cz(e,n|1),Iu(e,Ss()),!(vi&6)&&(Lv=Ss()+500,yA()))}break;case 13:O0(function(){var r=og(t,1);if(r!==null){var i=Zl();_h(r,t,1,i)}}),Vz(t,1)}};fz=function(t){if(t.tag===13){var e=og(t,134217728);if(e!==null){var n=Zl();_h(e,t,134217728,n)}Vz(t,134217728)}};UK=function(t){if(t.tag===13){var e=km(t),n=og(t,e);if(n!==null){var r=Zl();_h(n,t,e,r)}Vz(t,e)}};GK=function(){return Ki};jK=function(t,e){var n=Ki;try{return Ki=t,e()}finally{Ki=n}};zN=function(t,e,n){switch(e){case"input":if(RN(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=_O(r);if(!i)throw Error(vn(90));yK(r),RN(r,i)}}}break;case"textarea":xK(t,n);break;case"select":e=n.value,e!=null&&cv(t,!!n.multiple,e,!1)}};PK=kz;IK=O0;var Nme={usingClientEntryPoint:!1,Events:[xE,Wy,_O,TK,CK,kz]},rb={findFiberByHostInstance:_0,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Fme={bundleType:rb.bundleType,version:rb.version,rendererPackageName:rb.rendererPackageName,rendererConfig:rb.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:bg.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=RK(t),t===null?null:t.stateNode},findFiberByHostInstance:rb.findFiberByHostInstance||Dme,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vS=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vS.isDisabled&&vS.supportsFiber)try{pO=vS.inject(Fme),Nd=vS}catch{}}Pc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Nme;Pc.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Hz(e))throw Error(vn(200));return Lme(t,e,null,n)};Pc.createRoot=function(t,e){if(!Hz(t))throw Error(vn(299));var n=!1,r="",i=fee;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=jz(t,1,!1,null,null,n,!1,r,i),t[ig]=e.current,Sw(t.nodeType===8?t.parentNode:t),new $z(e)};Pc.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(vn(188)):(t=Object.keys(t).join(","),Error(vn(268,t)));return t=RK(e),t=t===null?null:t.stateNode,t};Pc.flushSync=function(t){return O0(t)};Pc.hydrate=function(t,e,n){if(!CO(e))throw Error(vn(200));return PO(null,t,e,!0,n)};Pc.hydrateRoot=function(t,e,n){if(!Hz(t))throw Error(vn(405));var r=n!=null&&n.hydratedSources||null,i=!1,o="",a=fee;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=cee(e,null,t,1,n??null,i,!1,o,a),t[ig]=e.current,Sw(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new TO(e)};Pc.render=function(t,e,n){if(!CO(e))throw Error(vn(200));return PO(null,t,e,!1,n)};Pc.unmountComponentAtNode=function(t){if(!CO(t))throw Error(vn(40));return t._reactRootContainer?(O0(function(){PO(null,null,t,!1,function(){t._reactRootContainer=null,t[ig]=null})}),!0):!1};Pc.unstable_batchedUpdates=kz;Pc.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!CO(n))throw Error(vn(200));if(t==null||t._reactInternals===void 0)throw Error(vn(38));return PO(t,e,n,!1,r)};Pc.version="18.2.0-next-9e3b772b8-20220608";function hee(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(hee)}catch(t){console.error(t)}}hee(),cK.exports=Pc;var wE=cK.exports,n9=wE;SN.createRoot=n9.createRoot,SN.hydrateRoot=n9.hydrateRoot;function co(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const IO=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),r9=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);r9&&parseFloat(r9[1]);function kme(t,e){const n={...t};for(const[r,i]of Object.entries(e))i&&typeof i=="object"?(n[r]=n[r]||{},Object.assign(n[r],e[r])):n[r]=e[r];return n}const zme="3.4.14";function Gd(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const TD={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},Ume=TD.global||TD.self||TD.window||{},Kp=typeof process!="object"||String(process)!=="[object process]"||process.browser,Wz=typeof importScripts=="function",Gme=typeof window<"u"&&typeof window.orientation<"u",i9=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);i9&&parseFloat(i9[1]);function Dw(t){"@babel/helpers - typeof";return Dw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dw(t)}function jme(t,e){if(Dw(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Dw(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Vme(t){var e=jme(t,"string");return Dw(e)==="symbol"?e:String(e)}function q(t,e,n){return e=Vme(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class $me{constructor(e,n){q(this,"name",void 0),q(this,"workerThread",void 0),q(this,"isRunning",!0),q(this,"result",void 0),q(this,"_resolve",()=>{}),q(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Gd(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Gd(this.isRunning),this.isRunning=!1,this._reject(e)}}let CD=class{terminate(){}};const PD=new Map;function Hme(t){Gd(t.source&&!t.url||!t.source&&t.url);let e=PD.get(t.source||t.url);return e||(t.url&&(e=Wme(t.url),PD.set(t.url,e)),t.source&&(e=dee(t.source),PD.set(t.source,e))),Gd(e),e}function Wme(t){if(!t.startsWith("http"))return t;const e=qme(t);return dee(e)}function dee(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function qme(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function pee(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const r=n||new Set;if(t){if(o9(t))r.add(t);else if(o9(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)pee(t[i],e,r)}}return n===void 0?Array.from(r):[]}function o9(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const ID=()=>{};class _F{static isSupported(){return typeof Worker<"u"&&Kp||typeof CD<"u"&&!Kp}constructor(e){q(this,"name",void 0),q(this,"source",void 0),q(this,"url",void 0),q(this,"terminated",!1),q(this,"worker",void 0),q(this,"onMessage",void 0),q(this,"onError",void 0),q(this,"_loadableURL","");const{name:n,source:r,url:i}=e;Gd(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=ID,this.onError=o=>console.log(o),this.worker=Kp?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=ID,this.onError=ID,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||pee(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=Hme({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new CD(r,{eval:!1})}else if(this.source)e=new CD(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class Xme{static isSupported(){return _F.isSupported()}constructor(e){q(this,"name","unnamed"),q(this,"source",void 0),q(this,"url",void 0),q(this,"maxConcurrency",1),q(this,"maxMobileConcurrency",1),q(this,"onDebug",()=>{}),q(this,"reuseWorkers",!0),q(this,"props",{}),q(this,"jobQueue",[]),q(this,"idleQueue",[]),q(this,"count",0),q(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(o,a,s)=>o.done(s),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(o,a)=>o.error(a);const i=new Promise(o=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:o}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new $me(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new _F({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Gme?this.maxMobileConcurrency:this.maxConcurrency}}const Zme={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class $p{static isSupported(){return _F.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return $p._workerFarm=$p._workerFarm||new $p({}),$p._workerFarm.setProps(e),$p._workerFarm}constructor(e){q(this,"props",void 0),q(this,"workerPools",new Map),this.props={...Zme},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let o=this.workerPools.get(n);return o||(o=new Xme({name:n,source:r,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}q($p,"_workerFarm",void 0);const Yme="latest";function Qme(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},r="".concat(t.id,"-worker.js");let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(i="modules/".concat(t.module,"/dist/").concat(r)),!i){let o=t.version;o==="latest"&&(o=Yme);const a=o?"@".concat(o):"";i="https://unpkg.com/@loaders.gl/".concat(t.module).concat(a,"/dist/").concat(r)}return Gd(i),i}function Kme(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:zme;Gd(t,"no worker provided");const n=t.version;return!(!e||!n)}const Jme=null,eAe=null,yF=null,gee=null,tAe=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:Jme,readFileAsText:eAe,requireFromFile:yF,requireFromString:gee},Symbol.toStringTag,{value:"Module"})),nAe="3.4.14",MD={};async function T0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e&&(t=rAe(t,e,n)),MD[t]=MD[t]||iAe(t),await MD[t]}function rAe(t,e,n){if(t.startsWith("http"))return t;const r=n.modules||{};return r[t]?r[t]:Kp?n.CDN?(Gd(n.CDN.startsWith("http")),"".concat(n.CDN,"/").concat(e,"@").concat(nAe,"/dist/libs/").concat(t)):Wz?"../src/libs/".concat(t):"modules/".concat(e,"/src/libs/").concat(t):"modules/".concat(e,"/dist/libs/").concat(t)}async function iAe(t){if(t.endsWith("wasm"))return await(await fetch(t)).arrayBuffer();if(!Kp)try{return tAe&&yF&&await yF(t)}catch{return null}if(Wz)return importScripts(t);const n=await(await fetch(t)).text();return oAe(n,t)}function oAe(t,e){if(!Kp)return gee;if(Wz)return eval.call(Ume,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch{n.text=t}return document.body.appendChild(n),null}function sAe(t,e){return!$p.isSupported()||!Kp&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function aAe(t,e,n,r,i){const o=t.id,a=Qme(t,n),u=$p.getWorkerFarm(n).getWorkerPool({name:o,url:a});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const d=await u.startJob("process-on-worker",lAe.bind(null,i));return d.postMessage("process",{input:e,options:n,context:r}),await(await d.result).result}async function lAe(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:o,options:a}=r;try{const s=await t(o,a);e.postMessage("done",{id:i,result:s})}catch(s){const u=s instanceof Error?s.message:"unknown error";e.postMessage("error",{id:i,error:u})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function uAe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?s9(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?s9(t,0,e):""}function s9(t,e,n){if(t.byteLength<=e+n)return"";const r=new DataView(t);let i="";for(let o=0;o<n;o++)i+=String.fromCharCode(r.getUint8(e+o));return i}function cAe(t){try{return JSON.parse(t)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(uAe(t),'"'))}}function fAe(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}function hAe(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),i=r.reduce((s,u)=>s+u.byteLength,0),o=new Uint8Array(i);let a=0;for(const s of r)o.set(s,a),a+=s.byteLength;return o.buffer}function OD(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=e,i=r&&r.length>1&&r[0].constructor||null;if(!i)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');const o=r.reduce((u,d)=>u+d.length,0),a=new i(o);let s=0;for(const u of r)a.set(u,s),s+=u.length;return a}function qz(t,e,n){const r=n!==void 0?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(r).buffer}function EE(t,e){return co(t>=0),co(e>0),t+(e-1)&~(e-1)}function dAe(t,e,n){let r;if(t instanceof ArrayBuffer)r=new Uint8Array(t);else{const i=t.byteOffset,o=t.byteLength;r=new Uint8Array(t.buffer||t.arrayBuffer,i,o)}return e.set(r,n),n+EE(r.byteLength,4)}async function pAe(t){const e=[];for await(const n of t)e.push(n);return hAe(...e)}function a9(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let l9=class{constructor(e,n){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=a9(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(a9()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},gAe=class{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof l9?i=e:i=new l9(n,r),this.stats[n]=i),i}};const mAe="Queued Requests",AAe="Active Requests",_Ae="Cancelled Requests",yAe="Queued Requests Ever",vAe="Active Requests Ever",xAe={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class mee{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};q(this,"props",void 0),q(this,"stats",void 0),q(this,"activeRequestCount",0),q(this,"requestQueue",[]),q(this,"requestMap",new Map),q(this,"deferredUpdate",null),this.props={...xAe,...e},this.stats=new gAe({id:this.props.id}),this.stats.get(mAe),this.stats.get(AAe),this.stats.get(_Ae),this.stats.get(yAe),this.stats.get(vAe)}scheduleRequest(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:n},i=new Promise(o=>(r.resolve=o,r));return this.requestQueue.push(r),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:n,resolve:r}=e;let i=!1;const o=()=>{i||(i=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const r=e[n];this._updateRequest(r)||(e.splice(n,1),this.requestMap.delete(r.handle),n--)}e.sort((n,r)=>n.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let bAe="";const u9={};function wAe(t){for(const e in u9)if(t.startsWith(e)){const n=u9[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(bAe).concat(t)),t}function EAe(t){return t&&typeof t=="object"&&t.isBuffer}function Aee(t){if(EAe(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function _ee(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function Xz(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const SAe=t=>typeof t=="boolean",aw=t=>typeof t=="function",SE=t=>t!==null&&typeof t=="object",c9=t=>SE(t)&&t.constructor==={}.constructor,TAe=t=>t&&typeof t[Symbol.iterator]=="function",CAe=t=>t&&typeof t[Symbol.asyncIterator]=="function",s_=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,a_=t=>typeof Blob<"u"&&t instanceof Blob,PAe=t=>t&&typeof t=="object"&&t.isBuffer,IAe=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||SE(t)&&aw(t.tee)&&aw(t.cancel)&&aw(t.getReader),MAe=t=>SE(t)&&aw(t.read)&&aw(t.pipe)&&SAe(t.readable),yee=t=>IAe(t)||MAe(t),OAe=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,RAe=/^([-\w.]+\/[-\w.+]+)/;function LAe(t){const e=RAe.exec(t);return e?e[1]:t}function f9(t){const e=OAe.exec(t);return e?e[1]:""}const vee=/\?.*/;function DAe(t){const e=t.match(vee);return e&&e[0]}function Zz(t){return t.replace(vee,"")}function MO(t){return s_(t)?t.url:a_(t)?t.name||"":typeof t=="string"?t:""}function Yz(t){if(s_(t)){const e=t,n=e.headers.get("content-type")||"",r=Zz(e.url);return LAe(n)||f9(r)}return a_(t)?t.type||"":typeof t=="string"?f9(t):""}function BAe(t){return s_(t)?t.headers["content-length"]||-1:a_(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function xee(t){if(s_(t))return t;const e={},n=BAe(t);n>=0&&(e["content-length"]=String(n));const r=MO(t),i=Yz(t);i&&(e["content-type"]=i);const o=await kAe(t);o&&(e["x-first-bytes"]=o),typeof t=="string"&&(t=new TextEncoder().encode(t));const a=new Response(t,{headers:e});return Object.defineProperty(a,"url",{value:r}),a}async function NAe(t){if(!t.ok){const e=await FAe(t);throw new Error(e)}}async function FAe(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let r=t.statusText;n.includes("application/json")&&(r+=" ".concat(await t.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function kAe(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=o=>{var a;return r(o==null||(a=o.target)===null||a===void 0?void 0:a.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),r=zAe(n);return"data:base64,".concat(r)}return null}function zAe(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}async function h9(t,e){if(typeof t=="string"){t=wAe(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await xee(t)}function UAe(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function TE(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||UAe()}const xS=globalThis.window||globalThis.self||globalThis.global,ib=globalThis.process||{},bee=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";TE();function GAe(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}let jAe=class{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=GAe(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}};function VAe(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function $Ae(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function RD(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(n=Math.min(n,r/t.width));const o=t.width*n,a=t.height*n,s=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(o,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}let XP;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(XP||(XP={}));const HAe=10;function d9(t){return typeof t!="string"?t:(t=t.toUpperCase(),XP[t]||XP.WHITE)}function WAe(t,e,n){if(!TE&&typeof t=="string"){if(e){const r=d9(e);t="\x1B[".concat(r,"m").concat(t,"\x1B[39m")}if(n){const r=d9(n);t="\x1B[".concat(r+HAe,"m").concat(t,"\x1B[49m")}}return t}function qAe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const o of r){const a=i[o];typeof a=="function"&&(e.find(s=>o===s)||(i[o]=a.bind(t)))}}function ZP(t,e){if(!t)throw new Error(e||"Assertion failed")}function fy(){let t;if(TE()&&xS.performance){var e,n;t=xS==null||(e=xS.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in ib){var r;const i=ib==null||(r=ib.hrtime)===null||r===void 0?void 0:r.call(ib);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const hy={debug:TE()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},XAe={enabled:!0,level:0};function of(){}const p9={},g9={once:!0};let Qz=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=bee,this._startTs=fy(),this._deltaTs=fy(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new jAe("__probe-".concat(this.id,"__"),XAe),this.timeStamp("".concat(this.id," started")),qAe(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((fy()-this._startTs).toPrecision(10))}getDelta(){return Number((fy()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){ZP(e,n)}warn(e){return this._getLogFunction(0,e,hy.warn,arguments,g9)}error(e){return this._getLogFunction(0,e,hy.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,hy.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,hy.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,hy.debug||hy.info,arguments,g9)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||of,r&&[r],{tag:KAe(n)}):of}image(e){let{logLevel:n,priority:r,image:i,message:o="",scale:a=1}=e;return this._shouldLog(n||r)?TE()?QAe({image:i,message:o,scale:a}):YAe():of}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||of)}group(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=m9({logLevel:e,message:n,opts:r}),{collapsed:o}=r;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||of)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=wee(e)}_getLogFunction(e,n,r,i,o){if(this._shouldLog(e)){o=m9({logLevel:e,message:n,args:i,opts:o}),r=r||o.method,ZP(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=fy();const a=o.tag||o.message;if(o.once&&a)if(!p9[a])p9[a]=fy();else return of;return n=ZAe(this.id,o.message,o),r.bind(console,n,...o.args)}return of}};Qz.VERSION=bee;function wee(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return ZP(Number.isFinite(e)&&e>=0),e}function m9(t){const{logLevel:e,message:n}=t;t.logLevel=wee(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return ZP(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function ZAe(t,e,n){if(typeof e=="string"){const r=n.time?$Ae(VAe(n.total)):"";e=n.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),e=WAe(e,n.color,n.background)}return e}function YAe(t){return console.warn("removed"),of}function QAe(t){let{image:e,message:n="",scale:r=1}=t;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const a=RD(o,n,r);console.log(...a)},o.src=e,of}const i=e.nodeName||"";if(i.toLowerCase()==="img")return console.log(...RD(e,n,r)),of;if(i.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...RD(o,n,r)),o.src=e.toDataURL(),of}return of}function KAe(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const A9=new Qz({id:"loaders.gl"});class JAe{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class e0e{constructor(){q(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.error.bind(this.console,...n)}}const Eee={fetch:null,mimeType:void 0,nothrow:!1,log:new e0e,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:IO,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},t0e={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function See(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const Tee=()=>{const t=See();return t.globalOptions=t.globalOptions||{...Eee},t.globalOptions};function n0e(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],r0e(t,n),o0e(e,t,r)}function r0e(t,e){_9(t,null,Eee,t0e,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},o=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};_9(r,n.id,i,o,e)}}function _9(t,e,n,r,i){const o=e||"Top level",a=e?"".concat(e,"."):"";for(const s in t){const u=!e&&SE(t[s]),d=s==="baseUri"&&!e,g=s==="workerUrl"&&e;if(!(s in n)&&!d&&!g){if(s in r)A9.warn("".concat(o," loader option '").concat(a).concat(s,"' no longer supported, use '").concat(r[s],"'"))();else if(!u){const _=i0e(s,i);A9.warn("".concat(o," loader option '").concat(a).concat(s,"' not recognized. ").concat(_))()}}}}function i0e(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const o in i.options){if(t===o)return"Did you mean '".concat(i.id,".").concat(o,"'?");const a=o.toLowerCase();(n.startsWith(a)||a.startsWith(n))&&(r=r||"Did you mean '".concat(i.id,".").concat(o,"'?"))}return r}function o0e(t,e,n){const i={...t.options||{}};return s0e(i,n),i.log===null&&(i.log=new JAe),y9(i,Tee()),y9(i,e),i}function y9(t,e){for(const n in e)if(n in e){const r=e[n];c9(r)&&c9(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function s0e(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Kz(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Jz(t){var e,n;co(t,"null loader"),co(Kz(t),"invalid loader");let r;return Array.isArray(t)&&(r=t[1],t=t[0],t={...t,options:{...t.options,...r}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Cee=()=>{const t=See();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function a0e(t){const e=Cee();t=Array.isArray(t)?t:[t];for(const n of t){const r=Jz(n);e.find(i=>r===i)||e.unshift(r)}}function l0e(){return Cee()}const u0e=new Qz({id:"loaders.gl"}),c0e=/\.([^.]+)$/;async function f0e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Pee(t))return null;let i=v9(t,e,{...n,nothrow:!0},r);if(i)return i;if(a_(t)&&(t=await t.slice(0,10).arrayBuffer(),i=v9(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(Iee(t));return i}function v9(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Pee(t))return null;if(e&&!Array.isArray(e))return Jz(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...l0e()),d0e(i);const o=h0e(t,i,n,r);if(!o&&!(n!=null&&n.nothrow))throw new Error(Iee(t));return o}function h0e(t,e,n,r){const i=MO(t),o=Yz(t),a=Zz(i)||(r==null?void 0:r.url);let s=null,u="";if(n!=null&&n.mimeType&&(s=LD(e,n==null?void 0:n.mimeType),u="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),s=s||p0e(e,a),u=u||(s?"matched url ".concat(a):""),s=s||LD(e,o),u=u||(s?"matched MIME type ".concat(o):""),s=s||m0e(e,t),u=u||(s?"matched initial data ".concat(Mee(t)):""),s=s||LD(e,n==null?void 0:n.fallbackMimeType),u=u||(s?"matched fallback MIME type ".concat(o):""),u){var d;u0e.log(1,"selectLoader selected ".concat((d=s)===null||d===void 0?void 0:d.name,": ").concat(u,"."))}return s}function Pee(t){return!(t instanceof Response&&t.status===204)}function Iee(t){const e=MO(t),n=Yz(t);let r="No valid loader found (";r+=e?"".concat(_ee(e),", "):"no url provided, ",r+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const i=t?Mee(t):"";return r+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",r+=")",r}function d0e(t){for(const e of t)Jz(e)}function p0e(t,e){const n=e&&c0e.exec(e),r=n&&n[1];return r?g0e(t,r):null}function g0e(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function LD(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function m0e(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(A0e(e,n))return n}else if(ArrayBuffer.isView(e)){if(x9(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&x9(e,0,n))return n;return null}function A0e(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function x9(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>_0e(t,e,n,i))}function _0e(t,e,n,r){if(r instanceof ArrayBuffer)return fAe(r,t,r.byteLength);switch(typeof r){case"function":return r(t,n);case"string":const i=vF(t,e,r.length);return r===i;default:return!1}}function Mee(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?vF(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?vF(t,0,e):""}function vF(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let o=0;o<n;o++)i+=String.fromCharCode(r.getUint8(e+o));return i}const y0e=256*1024;function*v0e(t,e){const n=(e==null?void 0:e.chunkSize)||y0e;let r=0;const i=new TextEncoder;for(;r<t.length;){const o=Math.min(t.length-r,n),a=t.slice(r,r+o);r+=o,yield i.encode(a)}}const x0e=256*1024;function b0e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=x0e}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),o=new ArrayBuffer(i),a=new Uint8Array(t,r,i);new Uint8Array(o).set(a),r+=i,yield o}}()}const w0e=1024*1024;async function*E0e(t,e){const n=(e==null?void 0:e.chunkSize)||w0e;let r=0;for(;r<t.size;){const i=r+n,o=await t.slice(r,i).arrayBuffer();r=i,yield o}}function b9(t,e){return IO?S0e(t,e):T0e(t)}async function*S0e(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:o,value:a}=await i;if(o)return;yield Aee(a)}}catch{n.releaseLock()}}async function*T0e(t,e){for await(const n of t)yield Aee(n)}function C0e(t,e){if(typeof t=="string")return v0e(t,e);if(t instanceof ArrayBuffer)return b0e(t,e);if(a_(t))return E0e(t,e);if(yee(t))return b9(t,e);if(s_(t))return b9(t.body,e);throw new Error("makeIterator")}const Oee="Cannot convert supplied data type";function P0e(t,e,n){if(e.text&&typeof t=="string")return t;if(PAe(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(Oee)}async function I0e(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return P0e(t,e);if(a_(t)&&(t=await xee(t)),s_(t)){const i=t;return await NAe(i),e.binary?await i.arrayBuffer():await i.text()}if(yee(t)&&(t=C0e(t,n)),TAe(t)||CAe(t))return pAe(t);throw new Error(Oee)}function Ree(t,e){const n=Tee(),r=t||n;return typeof r.fetch=="function"?r.fetch:SE(r.fetch)?i=>h9(i,r):e!=null&&e.fetch?e==null?void 0:e.fetch:h9}function M0e(t,e,n){if(n)return n;const r={fetch:Ree(e,t),...t};if(r.url){const i=Zz(r.url);r.baseUrl=i,r.queryString=DAe(r.url),r.filename=_ee(i),r.baseUrl=Xz(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function O0e(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:null}async function e5(t,e,n,r){Gd(!r||typeof r=="object"),e&&!Array.isArray(e)&&!Kz(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=MO(t),a=O0e(e,r),s=await f0e(t,a,n);return s?(n=n0e(n,s,a,i),r=M0e({url:i,parse:e5,loaders:a},n,r||null),await R0e(s,t,n,r)):null}async function R0e(t,e,n,r){if(Kme(t),s_(e)){const i=e,{ok:o,redirected:a,status:s,statusText:u,type:d,url:g}=i,_=Object.fromEntries(i.headers.entries());r.response={headers:_,ok:o,redirected:a,status:s,statusText:u,type:d,url:g}}if(e=await I0e(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,r,t);if(sAe(t,n))return await aAe(t,e,n,r,e5);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,r,t);if(t.parse)return await t.parse(e,n,r,t);throw Gd(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function ag(t,e,n,r){!Array.isArray(e)&&!Kz(e)&&(n=e,e=void 0);const i=Ree(n);let o=t;return typeof t=="string"&&(o=await i(t)),a_(t)&&(o=await i(t)),await e5(o,e,n)}const L0e="3.4.14",{_parseImageNode:D0e}=globalThis,xF=typeof Image<"u",bF=typeof ImageBitmap<"u",B0e=!!D0e,wF=IO?!0:B0e;function N0e(t){switch(t){case"auto":return bF||xF||wF;case"imagebitmap":return bF;case"image":return xF;case"data":return wF;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function F0e(){if(bF)return"imagebitmap";if(xF)return"image";if(wF)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function k0e(t){const e=U0e(t);if(!e)throw new Error("Not an image");return e}function z0e(t){switch(k0e(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function U0e(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const G0e=/^data:image\/svg\+xml/,j0e=/\.svg((\?|#).*)?$/;function t5(t){return t&&(G0e.test(t)||j0e.test(t))}function V0e(t,e){if(t5(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(o){throw new Error(o.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return Lee(t,e)}function Lee(t,e){if(t5(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Dee(t,e,n){const r=V0e(t,n),i=self.URL||self.webkitURL,o=typeof r!="string"&&i.createObjectURL(r);try{return await $0e(o||r,e)}finally{o&&i.revokeObjectURL(o)}}async function $0e(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=o=>i(new Error("Could not load image ".concat(t,": ").concat(o)))}catch(o){i(o)}})}const H0e={};let w9=!0;async function W0e(t,e,n){let r;t5(n)?r=await Dee(t,e,n):r=Lee(t,n);const i=e&&e.imagebitmap;return await q0e(r,i)}async function q0e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((X0e(e)||!w9)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),w9=!1}return await createImageBitmap(t)}function X0e(t){for(const e in t||H0e)return!1;return!0}function Z0e(t){return!J0e(t,"ftyp",4)||!(t[8]&96)?null:Y0e(t)}function Y0e(t){switch(Q0e(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Q0e(t,e,n){return String.fromCharCode(...t.slice(e,n))}function K0e(t){return[...t].map(e=>e.charCodeAt(0))}function J0e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=K0e(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const Id=!1,lw=!0;function n5(t){const e=CE(t);return t_e(e)||i_e(e)||n_e(e)||r_e(e)||e_e(e)}function e_e(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=Z0e(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function t_e(t){const e=CE(t);return e.byteLength>=24&&e.getUint32(0,Id)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Id),height:e.getUint32(20,Id)}:null}function n_e(t){const e=CE(t);return e.byteLength>=10&&e.getUint32(0,Id)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,lw),height:e.getUint16(8,lw)}:null}function r_e(t){const e=CE(t);return e.byteLength>=14&&e.getUint16(0,Id)===16973&&e.getUint32(2,lw)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,lw),height:e.getUint32(22,lw)}:null}function i_e(t){const e=CE(t);if(!(e.byteLength>=3&&e.getUint16(0,Id)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=o_e();let o=2;for(;o+9<e.byteLength;){const a=e.getUint16(o,Id);if(i.has(a))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Id),width:e.getUint16(o+7,Id)};if(!r.has(a))return null;o+=2,o+=e.getUint16(o,Id)}return null}function o_e(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function CE(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function s_e(t,e){const{mimeType:n}=n5(t)||{},r=globalThis._parseImageNode;return co(r),await r(t,n)}async function a_e(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:o}=n||{},a=l_e(i);let s;switch(a){case"imagebitmap":s=await W0e(t,e,o);break;case"image":s=await Dee(t,e,o);break;case"data":s=await s_e(t);break;default:co(!1)}return i==="data"&&(s=z0e(s)),s}function l_e(t){switch(t){case"auto":case"data":return F0e();default:return N0e(t),t}}const u_e=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],c_e=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],f_e={image:{type:"auto",decode:!0}},Bw={id:"image",module:"images",name:"Images",version:L0e,mimeTypes:c_e,extensions:u_e,parse:a_e,tests:[t=>!!n5(new DataView(t))],options:f_e},DD={};function h_e(t){if(DD[t]===void 0){const e=IO?p_e(t):d_e(t);DD[t]=e}return DD[t]}function d_e(t){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:n,_imageFormatsNode:r=e}=globalThis;return!!n&&r.includes(t)}function p_e(t){switch(t){case"image/avif":case"image/webp":return g_e(t);default:return!0}}function g_e(t){try{return document.createElement("canvas").toDataURL(t).indexOf("data:".concat(t))===0}catch{return!1}}function Bee(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function wg(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Bee()}const QT={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},bS=QT.window||QT.self||QT.global,ob=QT.process||{},Nee=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";wg();const BD=globalThis;function Fee(t){if(!t&&!wg())return"Node";if(Bee(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const r=n.indexOf("MSIE ")!==-1,i=n.indexOf("Trident/")!==-1;return r||i?"IE":BD.chrome?"Chrome":BD.safari?"Safari":BD.mozInnerScreenX?"Firefox":"Unknown"}function m_e(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class A_e{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";q(this,"storage",void 0),q(this,"id",void 0),q(this,"config",void 0),this.storage=m_e(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function __e(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function y_e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function ND(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(n=Math.min(n,r/t.width));const o=t.width*n,a=t.height*n,s=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(o,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}let YP;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(YP||(YP={}));function E9(t){return typeof t=="string"?YP[t.toUpperCase()]||YP.WHITE:t}function v_e(t,e,n){return!wg&&typeof t=="string"&&(e&&(e=E9(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=E9(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function x_e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n);for(const i of r)typeof t[i]=="function"&&(e.find(o=>i===o)||(t[i]=t[i].bind(t)))}function QP(t,e){if(!t)throw new Error(e||"Assertion failed")}function dy(){let t;if(wg&&"performance"in bS){var e,n;t=bS==null||(e=bS.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in ob){var r;const i=ob==null||(r=ob.hrtime)===null||r===void 0?void 0:r.call(ob);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const py={debug:wg&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},b_e={enabled:!0,level:0};function sf(){}const S9={},T9={once:!0};class r5{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};q(this,"id",void 0),q(this,"VERSION",Nee),q(this,"_startTs",dy()),q(this,"_deltaTs",dy()),q(this,"_storage",void 0),q(this,"userData",{}),q(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new A_e("__probe-".concat(this.id,"__"),b_e),this.timeStamp("".concat(this.id," started")),x_e(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((dy()-this._startTs).toPrecision(10))}getDelta(){return Number((dy()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){QP(e,n)}warn(e){return this._getLogFunction(0,e,py.warn,arguments,T9)}error(e){return this._getLogFunction(0,e,py.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,py.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,py.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return this._getLogFunction(e,n,py.debug||py.info,arguments,T9)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||sf,r&&[r],{tag:T_e(n)}):sf}image(e){let{logLevel:n,priority:r,image:i,message:o="",scale:a=1}=e;return this._shouldLog(n||r)?wg?S_e({image:i,message:o,scale:a}):E_e():sf}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||sf)}group(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=C9({logLevel:e,message:n,opts:r}),{collapsed:o}=r;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||sf)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=kee(e)}_getLogFunction(e,n,r,i,o){if(this._shouldLog(e)){o=C9({logLevel:e,message:n,args:i,opts:o}),r=r||o.method,QP(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=dy();const a=o.tag||o.message;if(o.once)if(!S9[a])S9[a]=dy();else return sf;return n=w_e(this.id,o.message,o),r.bind(console,n,...o.args)}return sf}}q(r5,"VERSION",Nee);function kee(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return QP(Number.isFinite(e)&&e>=0),e}function C9(t){const{logLevel:e,message:n}=t;t.logLevel=kee(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return QP(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function w_e(t,e,n){if(typeof e=="string"){const r=n.time?y_e(__e(n.total)):"";e=n.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),e=v_e(e,n.color,n.background)}return e}function E_e(t){return console.warn("removed"),sf}function S_e(t){let{image:e,message:n="",scale:r=1}=t;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const a=ND(o,n,r);console.log(...a)},o.src=e,sf}const i=e.nodeName||"";if(i.toLowerCase()==="img")return console.log(...ND(e,n,r)),sf;if(i.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...ND(o,n,r)),o.src=e.toDataURL(),sf}return sf}function T_e(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const Or=new r5({id:"deck"});let EF={};function C_e(t){EF=t}function _l(t,e,n,r){Or.level>0&&EF[t]&&EF[t].call(null,e,n,r)}function P_e(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const I_e={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:P_e,parseTextSync:JSON.parse};function M_e(){const t="8.9.32",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(Or.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Or,_registerLoggers:C_e},a0e([I_e,[Bw,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const zee=M_e(),Br={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Br,"IDENTITY",{get:()=>(Or.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const hh={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Bu={common:0,meters:1,pixels:2},P9={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},O_e={DRAW:"draw",MASK:"mask",TERRAIN:"terrain"},Yn=new r5({id:"luma.gl"});function Wl(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const R_e="Invalid WebGLRenderingContext",L_e="Requires WebGL2";function PE(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function Hr(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function D_e(t){return Hr(t)?t:null}function OO(t){return Wl(PE(t),R_e),t}function Xa(t){return Wl(Hr(t),L_e),t}const $b={};function B_e(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function N_e(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function F_e(t,e){$b[t]=!0,e!==void 0&&B_e(e)}function k_e(t){const e=t.getError;t.getError=function(){let r;do r=e.apply(t),r!==0&&($b[r]=!0);while(r!==0);for(r in $b)if($b[r])return delete $b[r],parseInt(r,10);return 0}}const IE=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const i=new t.VertexAttrib(n);this.attribs[r]=i}this.maxAttrib=0};IE.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};IE.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const l_=function(e){const n=this;this.gl=e,k_e(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(o){return o===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(o){const a=n.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,o);const s=a.attribs[o];return s.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(o){const a=n.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,o);const s=a.attribs[o];return s.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(o,a){switch(o){case 34962:n.currentArrayBuffer=a;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=a;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(o,a){const u=n.currentVertexArrayObject.attribs[o];switch(a){case 34975:return u.buffer;case 34338:return u.enabled;case 34339:return u.size;case 34340:return u.stride;case 34341:return u.type;case 34922:return u.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(o,a,s,u,d,g){const _=n.currentVertexArrayObject;_.maxAttrib=Math.max(_.maxAttrib,o);const E=_.attribs[o];return E.buffer=n.currentArrayBuffer,E.size=a,E.type=s,E.normalized=u,E.stride=d,E.offset=g,E.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{N_e("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};l_.prototype.VERTEX_ARRAY_BINDING_OES=34229;l_.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new IE(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};l_.prototype.createVertexArrayOES=function(){const e=new IE(this);return this.vertexArrayObjects.push(e),e};l_.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};l_.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof IE&&e.hasBeenBound&&e.ext===this)};l_.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){F_e(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const o=this.currentVertexArrayObject;if(i===o)return;(!i||o.elementArrayBuffer!==i.elementArrayBuffer)&&r.bindBuffer.call(n,34963,o.elementArrayBuffer);let a=this.currentArrayBuffer;const s=Math.max(i?i.maxAttrib:0,o.maxAttrib);for(let u=0;u<=s;u++){const d=o.attribs[u],g=i?i.attribs[u]:null;if((!i||d.enabled!==g.enabled)&&(d.enabled?r.enableVertexAttribArray.call(n,u):r.disableVertexAttribArray.call(n,u)),d.enabled){let _=!1;(!i||d.buffer!==g.buffer)&&(a!==d.buffer&&(r.bindBuffer.call(n,34962,d.buffer),a=d.buffer),_=!0),(_||d.cached!==g.cached)&&r.vertexAttribPointer.call(n,u,d.size,d.type,d.normalized,d.stride,d.offset)}}this.currentArrayBuffer!==a&&r.bindBuffer.call(n,34962,this.currentArrayBuffer)};function z_e(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=e.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};const n=t.getExtension;t.getExtension=function(i){const o=n.call(this,i);return o||(i!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new l_(this)),this.__OESVertexArrayObject))}}const I9="OES_element_index",M9="WEBGL_draw_buffers",U_e="EXT_disjoint_timer_query",G_e="EXT_disjoint_timer_query_webgl2",j_e="EXT_texture_filter_anisotropic",O9="WEBGL_debug_renderer_info",V_e=35723,$_e=4352,H_e=36795,W_e=34047,q_e=37445,X_e=37446,yo=t=>Hr(t)?void 0:0,Z_e={3074:t=>Hr(t)?void 0:36064,[V_e]:t=>Hr(t)?void 0:$_e,35977:yo,32937:yo,[H_e]:(t,e)=>{const n=Hr(t)?t.getExtension(G_e):t.getExtension(U_e);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[q_e]:(t,e)=>{const n=t.getExtension(O9);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[X_e]:(t,e)=>{const n=t.getExtension(O9);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[W_e]:(t,e)=>{const n=t.luma.extensions[j_e];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:yo,35071:yo,37447:yo,36063:(t,e)=>{if(!Hr(t)){const n=t.getExtension(M9);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:yo,35374:yo,35377:yo,34852:t=>{if(!Hr(t)){const e=t.getExtension(M9);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(I9)?2147483647:65535,33001:t=>t.getExtension(I9)?16777216:65535,33e3:t=>16777216,37157:yo,35373:yo,35657:yo,36183:yo,37137:yo,34045:yo,35978:yo,35979:yo,35968:yo,35376:yo,35375:yo,35659:yo,37154:yo,35371:yo,35658:yo,35076:yo,35077:yo,35380:yo};function Y_e(t,e,n){const r=Z_e[n],i=typeof r=="function"?r(t,e,n):r;return i!==void 0?i:e(n)}const Q_e="OES_vertex_array_object",Uee="ANGLE_instanced_arrays",K_e="WEBGL_draw_buffers",J_e="EXT_disjoint_timer_query",eye="EXT_texture_filter_anisotropic",tye="VertexArray requires WebGL2 or OES_vertex_array_object extension";function nye(t,e){return{webgl2:Hr(t),ext:t.getExtension(e)}}const Gee={[Q_e]:{meta:{suffix:"OES"},createVertexArray:()=>{Wl(!1,tye)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[Uee]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Wl(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[K_e]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Wl(!1)}},[J_e]:{meta:{suffix:"EXT"},createQuery:()=>{Wl(!1)},deleteQuery:()=>{Wl(!1)},beginQuery:()=>{Wl(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},FD={readBuffer:(t,e,n)=>{Hr(t)&&e(n)},getVertexAttrib:(t,e,n,r)=>{const{webgl2:i,ext:o}=nye(t,Uee);let a;switch(r){case 35069:a=i?void 0:!1;break;case 35070:a=!i&&!o?0:void 0;break}return a!==void 0?a:e(n,r)},getProgramParameter:(t,e,n,r)=>{if(!Hr(t))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,r)},getInternalformatParameter:(t,e,n,r,i)=>{if(!Hr(t))switch(i){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,r,i)},getTexParameter(t,e,n,r){switch(r){case 34046:const{extensions:i}=t.luma,o=i[eye];r=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,r)},getParameter:Y_e,hint(t,e,n,r){return e(n,r)}};function rye(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(z_e(t),iye(t),sye(t,Gee),oye(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=rye;function iye(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function oye(t,e){let{target:n,target2:r}=e;Object.keys(FD).forEach(i=>{if(typeof FD[i]=="function"){const o=t[i]?t[i].bind(t):()=>{},a=FD[i].bind(null,t,o);n[i]=a,r[i]=a}})}function sye(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&aye(t,{extension:n,target:t.luma,target2:t})}function aye(t,e){let{extension:n,target:r,target2:i}=e;const o=Gee[n];Wl(o);const{meta:a={}}=o,{suffix:s=""}=a,u=t.getExtension(n);for(const d of Object.keys(o)){const g="".concat(d).concat(s);let _=null;d==="meta"||typeof t[d]=="function"||(u&&typeof u[g]=="function"?_=function(){return u[g](...arguments)}:typeof o[d]=="function"&&(_=o[d].bind(r))),_&&(r[d]=_,i[d]=_)}}const i5={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},lm=(t,e,n)=>e?t.enable(n):t.disable(n),R9=(t,e,n)=>t.hint(n,e),tc=(t,e,n)=>t.pixelStorei(n,e),lye=(t,e)=>{const n=Hr(t)?36009:36160;return t.bindFramebuffer(n,e)},uye=(t,e)=>t.bindFramebuffer(36008,e);function sb(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const cye={3042:lm,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:lm,2885:(t,e)=>t.cullFace(e),2929:lm,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:lm,35723:R9,36006:lye,2886:(t,e)=>t.frontFace(e),33170:R9,2849:(t,e)=>t.lineWidth(e),32823:lm,32824:"polygonOffset",10752:"polygonOffset",35977:lm,32938:"sampleCoverage",32939:"sampleCoverage",3089:lm,3088:(t,e)=>t.scissor(...e),2960:lm,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:tc,3317:tc,37440:tc,37441:tc,37443:tc,3330:tc,3332:tc,3331:tc,36010:uye,3314:tc,32878:tc,3316:tc,3315:tc,32877:tc,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=sb(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=sb(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=sb(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=sb(e)&&e.length===3?[...e,...e]:e;const[n,r,i,o,a,s]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,o,a,s)},stencilOp:(t,e)=>{e=sb(e)&&e.length===3?[...e,...e]:e;const[n,r,i,o,a,s]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,o,a,s)},viewport:(t,e)=>t.viewport(...e)};function ps(t,e,n){return e[t]!==void 0?e[t]:n[t]}const fye={blendEquation:(t,e,n)=>t.blendEquationSeparate(ps(32777,e,n),ps(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(ps(32969,e,n),ps(32968,e,n),ps(32971,e,n),ps(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(ps(32824,e,n),ps(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(ps(32938,e,n),ps(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,ps(2962,e,n),ps(2967,e,n),ps(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,ps(34816,e,n),ps(36003,e,n),ps(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,ps(2964,e,n),ps(2965,e,n),ps(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,ps(34817,e,n),ps(34818,e,n),ps(34819,e,n))},L9={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},hd=(t,e)=>t.isEnabled(e),D9={3042:hd,2884:hd,2929:hd,3024:hd,32823:hd,32926:hd,32928:hd,3089:hd,2960:hd,35977:hd};function jee(t){for(const e in t)return!1;return!0}function hye(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}function B9(t,e){const n=t[e].bind(t);t[e]=function(){const i=arguments.length<=0?void 0:arguments[0];return i in t.state.cache?t.state.enable?t.state.cache[i]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function dye(t,e,n){const r=t[e].bind(t);t[e]=function(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];const{valueChanged:u,oldValue:d}=n(t.state._updateCache,...a);return u&&r(...a),d},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function pye(t){const e=t.useProgram.bind(t);t.useProgram=function(r){t.state.program!==r&&(e(r),t.state.program=r)}}class gye{constructor(e){let{copyState:n=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?$ee(e):Object.assign({},i5),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Wl(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];bh(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const o in e){Wl(o!==void 0);const a=e[o],s=this.cache[o];hye(a,s)||(n=!0,r=s,i&&!(o in i)&&(i[o]=s),this.cache[o]=a)}return{valueChanged:n,oldValue:r}}}function Vee(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:r}=e;if(Wl(r!==void 0),!t.state){const{polyfillContext:i}=globalThis;i&&i(t),t.state=new gye(t,{copyState:r}),pye(t);for(const o in L9){const a=L9[o];dye(t,o,a)}B9(t,"getParameter"),B9(t,"isEnabled")}return t.state.enable=n,t}function mye(t){t.state||Vee(t,{copyState:!1}),t.state.push()}function N9(t){Wl(t.state),t.state.pop()}function bh(t,e){if(Wl(PE(t),"setParameters requires a WebGL context"),jee(e))return;const n={};for(const i in e){const o=Number(i),a=cye[i];a&&(typeof a=="string"?n[a]=!0:a(t,e[i],o))}const r=t.state&&t.state.cache;if(r)for(const i in n){const o=fye[i];o(t,e,r)}}function $ee(t,e){if(e=e||i5,typeof e=="number"){const i=e,o=D9[i];return o?o(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const o=D9[i];r[i]=o?o(t,Number(i)):t.getParameter(Number(i))}return r}function Hee(t){bh(t,i5)}function Mu(t,e,n){if(jee(e))return n(t);const{nocatch:r=!0}=e;mye(t),bh(t,e);let i;if(r)i=n(t),N9(t);else try{i=n(t)}finally{N9(t)}return i}function R0(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,r="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return r?t.drawingBufferWidth/r:1}return 1}function KT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=R0(t),i=t.drawingBufferWidth,o=t.drawingBufferHeight;return _ye(e,r,i,o,n)}function Aye(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function _ye(t,e,n,r,i){const o=F9(t[0],e,n);let a=k9(t[1],e,r,i),s=F9(t[0]+1,e,n);const u=s===n-1?s:s-1;s=k9(t[1]+1,e,r,i);let d;return i?(s=s===0?s:s+1,d=a,a=s):d=s===r-1?s:s-1,{x:o,y:a,width:Math.max(u-o+1,1),height:Math.max(d-a+1,1)}}function F9(t,e,n){return Math.min(Math.round(t*e),n-1)}function k9(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const o5=wg(),yye=o5&&typeof document<"u",Wee={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function s5(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Wl(o5,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},Wee,t);const{width:e,height:n}=t;function r(s){if(t.throwOnError)throw new Error(s);return console.error(s),null}t.onError=r;let i;const{canvas:o}=t,a=wye({canvas:o,width:e,height:n,onError:r});return i=bye(a,t),i?(i=RO(i,t),Eye(i),i):null}function RO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||Sye(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},Wee,e);const{manageState:n,debug:r}=e;return n&&Vee(t,{copyState:!1,log:function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Yn.log(1,...o)()}}),o5&&r&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Yn.level=Math.max(Yn.level,1)):Yn.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function vye(t){const e=t.getParameter(7936),n=t.getParameter(7937),r=t.getExtension("WEBGL_debug_renderer_info"),i=r&&t.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),o=r&&t.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||e,renderer:o||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function xye(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const r=Aye(e.useDevicePixels);Tye(t,r,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function bye(t,e){const{onError:n}=e;let r=null;const i=u=>r=u.statusMessage||r;t.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:o=!0,webgl2:a=!0}=e;let s=null;return a&&(s=s||t.getContext("webgl2",e),s=s||t.getContext("experimental-webgl2",e)),o&&(s=s||t.getContext("webgl",e),s=s||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",i,!1),s?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),s):n("Failed to create ".concat(a&&!o?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function wye(t){let{canvas:e,width:n=800,height:r=600,onError:i}=t,o;return typeof e=="string"?(yye&&document.readyState==="complete"||i("createGLContext called on canvas '".concat(e,"' before page was loaded")),o=document.getElementById(e)):e?o=e:(o=document.createElement("canvas"),o.id="lumagl-canvas",o.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",o.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(o,document.body.firstChild)),o}function Eye(t){const e=Hr(t)?"WebGL2":"WebGL1",n=vye(t),r=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",i=t.debug?" debug":"";Yn.info(1,"".concat(e).concat(i," context ").concat(r))()}function Sye(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function Tye(t,e,n){let r="width"in n?n.width:t.canvas.clientWidth,i="height"in n?n.height:t.canvas.clientHeight;(!r||!i)&&(Yn.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=t.canvas.width||1,i=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const o=t.luma.canvasSizeInfo;if(o.clientWidth!==r||o.clientHeight!==i||o.devicePixelRatio!==e){let a=e;const s=Math.floor(r*a),u=Math.floor(i*a);t.canvas.width=s,t.canvas.height=u,(t.drawingBufferWidth!==s||t.drawingBufferHeight!==u)&&(Yn.warn("Device pixel ratio clamped")(),a=Math.min(t.drawingBufferWidth/r,t.drawingBufferHeight/i),t.canvas.width=Math.floor(r*a),t.canvas.height=Math.floor(i*a)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:r,clientHeight:i,devicePixelRatio:e})}}function z9(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let U9=class{constructor(e,n){q(this,"name",void 0),q(this,"type",void 0),q(this,"sampleSize",1),q(this,"time",void 0),q(this,"count",void 0),q(this,"samples",void 0),q(this,"lastTiming",void 0),q(this,"lastSampleTime",void 0),q(this,"lastSampleCount",void 0),q(this,"_count",0),q(this,"_time",0),q(this,"_samples",0),q(this,"_startTime",0),q(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=z9(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(z9()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},a5=class{constructor(e){q(this,"id",void 0),q(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:r}=e;return this.stats[n]||(e instanceof U9?this.stats[n]=e:this.stats[n]=new U9(n,r)),this.stats[n]}};const uw="8.5.21",Cye="set luma.log.level=1 (or higher) to trace rendering";class Pye{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new a5({id:e})),this.stats.get(e)}}const Cm=new Pye;if(globalThis.luma&&globalThis.luma.VERSION!==uw)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(uw));globalThis.luma||(wg()&&Yn.log(1,"luma.gl ".concat(uw," - ").concat(Cye))(),globalThis.luma=globalThis.luma||{VERSION:uw,version:uw,log:Yn,stats:Cm,globals:{modules:{},nodeIO:{}}});function Iye(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function Mye(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function Nn(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function kD(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const r=t[e];return Nn(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function Um(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const zD={};function Ma(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";zD[t]=zD[t]||1;const e=zD[t]++;return"".concat(t,"-").concat(e)}function G9(t){return Nn(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Dv(t){let e=!0;for(const n in t){e=!1;break}return e}function qee(t,e,n,r){const i="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),o=Object.getPrototypeOf(t);r.forEach(a=>{o.methodName||(o[a]=()=>{throw Yn.removed("Calling removed method ".concat(e,".").concat(a,": "),i)(),new Error(a)})})}const gy="Resource subclass must define virtual methods";let Eg=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};OO(e);const{id:r,userData:i={}}=n;this.gl=e,this.gl2=e,this.id=r||Ma(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=kD(this.gl,e),Nn(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const o=Hr(this.gl);if(!((!("webgl2"in i)||o)&&(!("extension"in i)||this.gl.getExtension(i.extension)))){const s=i.webgl1,u="webgl2"in i?i.webgl2:i.webgl1;return o?u:s}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:r}=e,i=this.constructor.PARAMETERS||{},o=Hr(this.gl),a={},s=n||Object.keys(i);for(const u of s){const d=i[u];if(d&&(!("webgl2"in d)||o)&&(!("extension"in d)||this.gl.getExtension(d.extension))){const _=r?Um(this.gl,u):u;a[_]=this.getParameter(u,e),r&&d.type==="GLenum"&&(a[_]=Um(this.gl,a[_]))}}return a}setParameter(e,n){e=kD(this.gl,e),Nn(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const o=Hr(this.gl);if(!((!("webgl2"in i)||o)&&(!("extension"in i)||this.gl.getExtension(i.extension))))throw new Error("Parameter not available on this platform");i.type==="GLenum"&&(n=kD(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,r){return qee(this,e,n,r)}initialize(e){}_createHandle(){throw new Error(gy)}_deleteHandle(){throw new Error(gy)}_bindHandle(e){throw new Error(gy)}_getOptsFromHandle(){throw new Error(gy)}_getParameter(e,n){throw new Error(gy)}_setParameter(e,n){throw new Error(gy)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=Cm.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Cm.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const i=Cm.get("Memory Usage".concat(r));i.get("GPU Memory").addCount(e),i.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=Cm.get("Memory Usage".concat(n));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const Oye="Failed to deduce GL constant from typed array";function SF(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Oye)}}function Nw(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Rye(t){let{data:e,width:n,height:r,bytesPerPixel:i=4,temp:o}=t;const a=n*i;o=o||new Uint8Array(a);for(let s=0;s<r/2;++s){const u=s*a,d=(r-s-1)*a;o.set(e.subarray(u,u+a)),e.copyWithin(u,d,d+a),e.set(o,d)}}function Lye(t){let{data:e,width:n,height:r}=t;const i=Math.round(n/2),o=Math.round(r/2),a=new Uint8Array(i*o*4);for(let s=0;s<o;s++)for(let u=0;u<i;u++)for(let d=0;d<4;d++)a[(s*i+u)*4+d]=e[(s*2*n+u*2)*4+d];return{data:a,width:i,height:o}}function TF(t,e,n){const{removedProps:r={},deprecatedProps:i={},replacedProps:o={}}=n;for(const s in r)if(s in e){const d=r[s]?"".concat(t,".").concat(r[s]):"N/A";Yn.removed("".concat(t,".").concat(s),d)()}for(const s in i)if(s in e){const u=i[s];Yn.deprecated("".concat(t,".").concat(s),"".concat(t,".").concat(u))()}let a=null;for(const s in o)if(s in e){const u=o[s];Yn.deprecated("".concat(t,".").concat(s),"".concat(t,".").concat(u))(),a=a||Object.assign({},e),a[u]=e[s],delete a[s]}return a||e}const Dye={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},Bye={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class wu{static getBytesPerElement(e){return Nw(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Nn(e.size),Nw(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new wu(Dye,...n)}constructor(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(i=>this._assign(i)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return wu.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return wu.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=TF("Accessor",e,Bye),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const j9=10,Xee={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},Nye={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:Xee},Fye={removedProps:Xee};class ji extends Eg{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/wu.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/wu.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=TF("Buffer",e,Nye),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=TF("Buffer",e,Fye),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new wu(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:r=0,srcOffset:i=0}=e,o=e.byteLength||e.length;Nn(n);const a=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(a,this.handle),i!==0||o!==void 0?(Xa(this.gl),this.gl.bufferSubData(this.target,r,n,i,o)):this.gl.bufferSubData(a,r,n),this.gl.bindBuffer(a,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:r=0,writeOffset:i=0,size:o}=e;const{gl:a}=this;return Xa(a),a.bindBuffer(36662,n.handle),a.bindBuffer(36663,this.handle),a.copyBufferSubData(36662,36663,r,i,o),a.bindBuffer(36662,null),a.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:r=0,length:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Xa(this.gl);const o=Nw(this.accessor.type||5126,{clamped:!1}),a=this._getAvailableElementCount(n),s=r;let u,d;e?(d=e.length,u=d-s):(u=Math.min(a,i||a),d=s+u);const g=Math.min(a,u);return i=i||g,Nn(i<=g),e=e||new o(d),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,r,i),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:r=0,size:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?i!==void 0?this.gl.bindBufferRange(e,n,this.handle,r,i):(Nn(r===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(j9,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;Nn(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.usage),this.gl.bufferSubData(i,n,e),this.gl.bindBuffer(i,null),this.debugData=e.slice(0,j9),this.bytesUsed=r,this._trackAllocatedMemory(r);const o=SF(e);return Nn(o),this.setAccessor(new wu(this.accessor,{type:o})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Nn(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,n),this.gl.bindBuffer(i,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=Nw(this.accessor.type||5126,{clamped:!1}),r=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new wu(this.accessor,{type:SF(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return Yn.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Yn.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Yn.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Yn.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new wu(this.accessor,e),this}}const l5={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},Zee={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},Yee={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function kye(t,e){const n=l5[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const r=Hr(t)&&n.gl2||n.gl1;return typeof r=="string"?t.getExtension(r):r}function zye(t,e){const n=l5[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const Uye=[9729,9728],V9=globalThis.WebGLBuffer||function(){};class L0 extends Eg{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:i}=n;let o=!0;return r&&(o=o&&kye(e,r),o=o&&(!i||zye(e,r))),o}constructor(e,n){const{id:r=Ma("texture"),handle:i,target:o}=n;super(e,{id:r,handle:i}),this.target=o,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(F=>this.initialize(Object.assign({},e,{pixels:F,data:F}))),this;const r=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(r&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:i=null,format:o=6408,border:a=0,recreate:s=!1,parameters:u={},pixelStore:d={},textureUnit:g=void 0}=e;n||(n=i);let{width:_,height:E,dataFormat:P,type:R,compressed:B=!1,mipmaps:V=!0}=e;const{depth:z=0}=e;return{width:_,height:E,compressed:B,dataFormat:P,type:R}=this._deduceParameters({format:o,type:R,dataFormat:P,compressed:B,data:n,width:_,height:E}),this.width=_,this.height=E,this.depth=z,this.format=o,this.type=R,this.dataFormat=P,this.border=a,this.textureUnit=g,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),V&&this._isNPOT()&&(Yn.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),V=!1,this._updateForNPOT(u)),this.mipmaps=V,this.setImageData({data:n,width:_,height:E,depth:z,format:o,type:R,dataFormat:P,border:a,mipmaps:V,parameters:d,compressed:B}),V&&this.generateMipmap(),this.setParameters(u),s&&(this.data=n),r&&(this._video={video:n,parameters:u,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:r,mipmaps:i=!1}=e;return r!==this.width||n!==this.height?this.initialize({width:r,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Yn.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Mu(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:r=null,level:i=0,format:o=this.format,border:a=this.border,offset:s=0,parameters:u={}}=e;let{data:d=null,type:g=this.type,width:_=this.width,height:E=this.height,dataFormat:P=this.dataFormat,compressed:R=!1}=e;d||(d=r),{type:g,dataFormat:P,compressed:R,width:_,height:E}=this._deduceParameters({format:o,type:g,dataFormat:P,compressed:R,data:d,width:_,height:E});const{gl:B}=this;B.bindTexture(this.target,this.handle);let V=null;({data:d,dataType:V}=this._getDataType({data:d,compressed:R}));let z,F=0;if(Mu(this.gl,u,()=>{switch(V){case"null":B.texImage2D(n,i,o,_,E,a,P,g,d);break;case"typed-array":B.texImage2D(n,i,o,_,E,a,P,g,d,s);break;case"buffer":z=Xa(B),z.bindBuffer(35052,d.handle||d),z.texImage2D(n,i,o,_,E,a,P,g,s),z.bindBuffer(35052,null);break;case"browser-object":Hr(B)?B.texImage2D(n,i,o,_,E,a,P,g,d):B.texImage2D(n,i,o,P,g,d);break;case"compressed":for(const[k,X]of d.entries())B.compressedTexImage2D(n,k,X.format,X.width,X.height,a,X.data),F+=X.levelSize;break;default:Nn(!1,"Unknown image data type")}}),V==="compressed")this._trackAllocatedMemory(F,"Texture");else if(d&&d.byteLength)this._trackAllocatedMemory(d.byteLength,"Texture");else{const k=Zee[this.dataFormat]||4,X=Yee[this.type]||1;this._trackAllocatedMemory(this.width*this.height*k*X,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:r=null,data:i=null,x:o=0,y:a=0,width:s=this.width,height:u=this.height,level:d=0,format:g=this.format,type:_=this.type,dataFormat:E=this.dataFormat,compressed:P=!1,offset:R=0,border:B=this.border,parameters:V={}}=e;if({type:_,dataFormat:E,compressed:P,width:s,height:u}=this._deduceParameters({format:g,type:_,dataFormat:E,compressed:P,data:i,width:s,height:u}),Nn(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const z=i;i=z.data,s=z.shape[0],u=z.shape[1]}i instanceof ji&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Mu(this.gl,V,()=>{if(P)this.gl.compressedTexSubImage2D(n,d,o,a,s,u,g,i);else if(i===null)this.gl.texSubImage2D(n,d,o,a,s,u,E,_,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(n,d,o,a,s,u,E,_,i,R);else if(i instanceof V9){const z=Xa(this.gl);z.bindBuffer(35052,i),z.texSubImage2D(n,d,o,a,s,u,E,_,R),z.bindBuffer(35052,null)}else Hr(this.gl)?Xa(this.gl).texSubImage2D(n,d,o,a,s,u,E,_,i):this.gl.texSubImage2D(n,d,o,a,E,_,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Yn.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:r=!1}=e;return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof ji?{data:n.handle,dataType:"buffer"}:n instanceof V9?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:r}=e;let{width:i,height:o,dataFormat:a,type:s,compressed:u}=e;const d=l5[n];return a=a||d&&d.dataFormat,s=s||d&&d.types[0],u=u||d&&d.compressed,{width:i,height:o}=this._deduceImageSize(r,i,o),{dataFormat:a,type:s,compressed:u,width:i,height:o,format:n,data:r}}_deduceImageSize(e,n,r){let i;return typeof ImageData<"u"&&e instanceof ImageData?i={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?i={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?i={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?i={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?i={width:e.videoWidth,height:e.videoHeight}:e?i={width:n,height:r}:i={width:n>=0?n:1,height:r>=0?r:1},Nn(i,"Could not deduced texture size"),Nn(n===void 0||i.width===n,"Deduced texture width does not match supplied width"),Nn(r===void 0||i.height===r,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:Nn(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Hr(this.gl)||!this.width||!this.height?!1:!G9(this.width)||!G9(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:Uye.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let Gye="";function jye(t,e){return Nn(typeof t=="string"),t=Gye+t,new Promise((n,r)=>{try{const i=new Image;i.onload=()=>n(i),i.onerror=()=>r(new Error("Could not load image ".concat(t,"."))),i.crossOrigin=e&&e.crossOrigin||"anonymous",i.src=t}catch(i){r(i)}})}class Pl extends L0{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return L0.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};OO(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:jye(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const CF=[34069,34070,34071,34072,34073,34074];class u5 extends L0{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};OO(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:n,data:r,x:i=0,y:o=0,mipmapLevel:a=0}=e;return this._subImage({target:n,data:r,x:i,y:o,mipmapLevel:a})}async setCubeMapImageData(e){let{width:n,height:r,pixels:i,data:o,border:a=0,format:s=6408,type:u=5121}=e;const{gl:d}=this,g=i||o,_=await Promise.all(CF.map(E=>{const P=g[E];return Promise.all(Array.isArray(P)?P:[P])}));this.bind(),CF.forEach((E,P)=>{_[P].length>1&&this.opts.mipmaps!==!1&&Yn.warn("".concat(this.id," has mipmap and multiple LODs."))(),_[P].forEach((R,B)=>{n&&r?d.texImage2D(E,B,s,n,r,a,s,u,R):d.texImage2D(E,B,s,s,u,R)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:r,height:i,pixels:o,data:a,border:s=0,format:u=6408,type:d=5121}=e,{gl:g}=this,_=o||a;return this.bind(),_ instanceof Promise?_.then(E=>this.setImageDataForFace(Object.assign({},e,{face:n,data:E,pixels:E}))):this.width||this.height?g.texImage2D(n,0,u,r,i,s,u,d,_):g.texImage2D(n,0,u,u,d,_),this}}u5.FACES=CF;class Qee extends L0{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Hr(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Xa(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:r=6408,width:i,height:o,depth:a=1,border:s=0,format:u,type:d=5121,offset:g=0,data:_,parameters:E={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Mu(this.gl,E,()=>{ArrayBuffer.isView(_)&&this.gl.texImage3D(this.target,n,r,i,o,a,s,u,d,_),_ instanceof ji&&(this.gl.bindBuffer(35052,_.handle),this.gl.texImage3D(this.target,n,r,i,o,a,s,u,d,g))}),_&&_.byteLength)this._trackAllocatedMemory(_.byteLength,"Texture");else{const P=Zee[this.dataFormat]||4,R=Yee[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*P*R,"Texture")}return this.loaded=!0,this}}const o0="EXT_color_buffer_float",$9={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:o0,bpp:2},33327:{gl2:o0,bpp:4},34842:{gl2:o0,bpp:8},33326:{gl2:o0,bpp:4},33328:{gl2:o0,bpp:8},34836:{gl2:o0,bpp:16},35898:{gl2:o0,bpp:4}};function Vye(t,e,n){const r=n[e];if(!r)return!1;const i=Hr(t)&&r.gl2||r.gl1;return typeof i=="string"?t.getExtension(i):i}class x0 extends Eg{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||Vye(e,n,$9)}static getSamplesForFormat(e,n){let{format:r}=n;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:r=1,height:i=1,samples:o=0}=e;return Nn(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),o!==0&&Hr(this.gl)?this.gl.renderbufferStorageMultisample(36161,o,n,r,i):this.gl.renderbufferStorage(36161,n,r,i),this.format=n,this.width=r,this.height=i,this.samples=o,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*$9[this.format].bpp),this}resize(e){let{width:n,height:r}=e;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const $ye=256,Hye=1024,Wye=16384,H9=6144,W9=6145,q9=6146,X9=34041,Kee="clear: bad arguments";function ME(t){let{framebuffer:e=null,color:n=null,depth:r=null,stencil:i=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};e&&(o.framebuffer=e);let a=0;n&&(a|=Wye,n!==!0&&(o.clearColor=n)),r&&(a|=$ye,r!==!0&&(o.clearDepth=r)),i&&(a|=Hye,r!==!0&&(o.clearStencil=r)),Nn(a!==0,Kee),Mu(t,o,()=>{t.clear(a)})}function qye(t){let{framebuffer:e=null,buffer:n=H9,drawBuffer:r=0,value:i=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Xa(t),Mu(t,{framebuffer:e},()=>{switch(n){case H9:switch(i.constructor){case Int32Array:t.clearBufferiv(n,r,i);break;case Uint32Array:t.clearBufferuiv(n,r,i);break;case Float32Array:default:t.clearBufferfv(n,r,i)}break;case W9:t.clearBufferfv(W9,0,[i]);break;case q9:t.clearBufferiv(q9,0,[i]);break;case X9:const[o,a]=i;t.clearBufferfi(X9,0,o,a);break;default:Nn(!1,Kee)}})}function Jee(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Nn(!1),0}}function Xye(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return Nn(!1),0}}function OE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:r=0,sourceFormat:i=6408}=e;let{sourceAttachment:o=36064,target:a=null,sourceWidth:s,sourceHeight:u,sourceType:d}=e;const{framebuffer:g,deleteFramebuffer:_}=c5(t);Nn(g);const{gl:E,handle:P,attachments:R}=g;s=s||g.width,u=u||g.height,o===36064&&P===null&&(o=1028),Nn(R[o]),d=d||R[o].type,a=Yye(a,d,i,s,u),d=d||SF(a);const B=E.bindFramebuffer(36160,P);return E.readPixels(n,r,s,u,i,d,a),E.bindFramebuffer(36160,B||null),_&&g.delete(),a}function Zye(t,e){let{sourceX:n=0,sourceY:r=0,sourceFormat:i=6408,target:o=null,targetByteOffset:a=0,sourceWidth:s,sourceHeight:u,sourceType:d}=e;const{framebuffer:g,deleteFramebuffer:_}=c5(t);Nn(g),s=s||g.width,u=u||g.height;const E=Xa(g.gl);if(d=d||(o?o.type:5121),!o){const P=Jee(i),R=Xye(d),B=a+s*u*P*R;o=new ji(E,{byteLength:B,accessor:{type:d,size:P}})}return o.bind({target:35051}),Mu(E,{framebuffer:g},()=>{E.readPixels(n,r,s,u,i,d,a)}),o.unbind({target:35051}),_&&g.delete(),o}function Z9(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=OE(t,{sourceAttachment:e}),{width:i,height:o}=t;for(;o>n;)({data:r,width:i,height:o}=Lye({data:r,width:i,height:o}));Rye({data:r,width:i,height:o});const a=document.createElement("canvas");a.width=i,a.height=o;const s=a.getContext("2d"),u=s.createImageData(i,o);return u.data.set(r),s.putImageData(u,0,0),a.toDataURL()}function ete(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:r=0,sourceY:i=0,targetMipmaplevel:o=0,targetInternalFormat:a=6408}=n;let{targetX:s,targetY:u,targetZ:d,width:g,height:_}=n;const{framebuffer:E,deleteFramebuffer:P}=c5(t);Nn(E);const{gl:R,handle:B}=E,V=typeof s<"u"||typeof u<"u"||typeof d<"u";s=s||0,u=u||0,d=d||0;const z=R.bindFramebuffer(36160,B);Nn(e);let F=null;if(e instanceof L0&&(F=e,g=Number.isFinite(g)?g:F.width,_=Number.isFinite(_)?_:F.height,F.bind(0),e=F.target),!V)R.copyTexImage2D(e,o,a,r,i,g,_,0);else switch(e){case 3553:case 34067:R.copyTexSubImage2D(e,o,s,u,r,i,g,_);break;case 35866:case 32879:Xa(R).copyTexSubImage3D(e,o,s,u,d,r,i,g,_);break}return F&&F.unbind(),R.bindFramebuffer(36160,z||null),P&&E.delete(),F}function c5(t){return t instanceof Ws?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:ive(t),deleteFramebuffer:!0}}function Yye(t,e,n,r,i){if(t)return t;e=e||5121;const o=Nw(e,{clamped:!1}),a=Jee(n);return new o(r*i*a)}const Qi={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function Qye(t){const e=new Pl(t,{format:6408,type:5126,dataFormat:6408}),n=new Ws(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),r=n.getStatus();return e.delete(),n.delete(),r===36053}const tte={[Qi.WEBGL2]:[!1,!0],[Qi.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Qi.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Qi.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Qi.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Qi.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Qi.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Qi.FLOAT_BLEND]:["EXT_float_blend"],[Qi.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Qi.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Qi.TEXTURE_FLOAT]:["OES_texture_float",!0],[Qi.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Qi.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Qi.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Qi.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Qi.COLOR_ATTACHMENT_RGBA32F]:[Qye,"EXT_color_buffer_float"],[Qi.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Qi.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Qi.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Qi.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Qi.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Qi.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},Kye=2;function RE(t,e){return LO(t,e)}function LO(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>nte(t,n))}function Jye(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in tte)t.luma.caps[e]===void 0&&(t.luma.caps[e]=nte(t,e));return t.luma.caps}function nte(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=eve(t,e)),t.luma.caps[e]||Yn.log(Kye,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function eve(t,e){const n=tte[e];Nn(n,e);let r;const i=Hr(t)&&n[1]||n[0];if(typeof i=="function")r=i(t);else if(Array.isArray(i)){r=!0;for(const o of i)r=r&&!!t.getExtension(o)}else typeof i=="string"?r=!!t.getExtension(i):typeof i=="boolean"?r=i:Nn(!1);return r}const Y9="Multiple render targets not supported";class Ws extends Eg{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:i}=n;let o=!0;return r&&(o=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),i&&(o=o&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),o}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Ws(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Xa(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Xa(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:r=1,attachments:i=null,color:o=!0,depth:a=!0,stencil:s=!1,check:u=!0,readBuffer:d=void 0,drawBuffers:g=void 0}=e;if(Nn(n>=0&&r>=0,"Width and height need to be integers"),this.width=n,this.height=r,i)for(const _ in i){const E=i[_];(Array.isArray(E)?E[0]:E).resize({width:n,height:r})}else i=this._createDefaultAttachments(o,a,s,n,r);this.update({clearAttachments:!0,attachments:i,readBuffer:d,drawBuffers:g}),i&&u&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:r,drawBuffers:i,clearAttachments:o=!1,resizeAttachments:a=!0}=e;this.attach(n,{clearAttachments:o,resizeAttachments:a});const{gl:s}=this,u=s.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),i&&this._setDrawBuffers(i),s.bindFramebuffer(36160,u||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:r}=e;if(this.handle===null)return Nn(n===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),n!==this.width&&r!==this.height&&Yn.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(r))();for(const i in this.attachments)this.attachments[i].resize({width:n,height:r});return this.width=n,this.height=r,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i={};n&&Object.keys(this.attachments).forEach(a=>{i[a]=null}),Object.assign(i,e);const o=this.gl.bindFramebuffer(36160,this.handle);for(const a in i){Nn(a!==void 0,"Misspelled framebuffer binding point?");const s=Number(a),u=i[s];let d=u;if(!d)this._unattach(s);else if(d instanceof x0)this._attachRenderbuffer({attachment:s,renderbuffer:d});else if(Array.isArray(u)){const[g,_=0,E=0]=u;d=g,this._attachTexture({attachment:s,texture:g,layer:_,level:E})}else this._attachTexture({attachment:s,texture:d,layer:0,level:0});r&&d&&d.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,o||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(a=>!this.attachments[a]).forEach(a=>{delete this.attachments[a]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(nve(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:r,stencil:i,drawBuffers:o=[]}=e,a=this.gl.bindFramebuffer(36160,this.handle);return(n||r||i)&&ME(this.gl,{color:n,depth:r,stencil:i}),o.forEach((s,u)=>{qye(this.gl,{drawBuffer:u,value:s})}),this.gl.bindFramebuffer(36160,a||null),this}readPixels(){return Yn.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Yn.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Yn.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Yn.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Yn.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Yn.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:r=0,y:i=0,width:o,height:a}=e;const s=Xa(this.gl),u=s.bindFramebuffer(36008,this.handle);return r===0&&i===0&&o===void 0&&a===void 0?s.invalidateFramebuffer(36008,n):s.invalidateFramebuffer(36008,n,r,i,o,a),s.bindFramebuffer(36008,u),this}getAttachmentParameter(e,n,r){let i=this._getAttachmentParameterFallback(n);return i===null&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),r&&i>1e3&&(i=Um(this.gl,i)),i}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const i={};for(const o of r){const a=n?Um(this.gl,o):o;i[a]=this.getAttachmentParameter(e,o,n)}return i}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),r={};for(const i of n){const o=Number(i),a=e?Um(this.gl,o):o;r[a]=this.getAttachmentParameters(o,e)}return r}show(){return typeof window<"u"&&window.open(Z9(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Yn.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const r=Z9(this,{targetMaxHeight:100});return Yn.image({logLevel:e,message:n,image:r},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,r,i,o){let a=null;return e&&(a=a||{},a[36064]=new Pl(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:o,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(a[36064])),n&&r?(a=a||{},a[33306]=new x0(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(a[33306])):n?(a=a||{},a[36096]=new x0(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:o}),this.ownResources.push(a[36096])):r&&Nn(!1),a}_unattach(e){const n=this.attachments[e];n&&(n instanceof x0?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:r}=e;const{gl:i}=this;i.framebufferRenderbuffer(36160,n,36161,r.handle),this.attachments[n]=r}_attachTexture(e){let{attachment:n=36064,texture:r,layer:i,level:o}=e;const{gl:a}=this;switch(a.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:Xa(a).framebufferTextureLayer(36160,n,r.target,o,i);break;case 34067:const u=tve(i);a.framebufferTexture2D(36160,n,u,r.handle,o);break;case 3553:a.framebufferTexture2D(36160,n,3553,r.handle,o);break;default:Nn(!1,"Illegal texture type")}a.bindTexture(r.target,null),this.attachments[n]=r}_setReadBuffer(e){const n=D_e(this.gl);n?n.readBuffer(e):Nn(e===36064||e===1029,Y9),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,r=Xa(n);if(r)r.drawBuffers(e);else{const i=n.getExtension("WEBGL_draw_buffers");i?i.drawBuffersWEBGL(e):Nn(e.length===1&&(e[0]===36064||e[0]===1029),Y9)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=Jye(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function tve(t){return t<34069?t+34069:t}function nve(t){return(Ws.STATUS||{})[t]||"Framebuffer error ".concat(t)}const rve=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Ws.ATTACHMENT_PARAMETERS=rve;function rte(t,e){Nn(t instanceof Pl||t instanceof u5||t instanceof Qee);const n=t.constructor,{gl:r,width:i,height:o,format:a,type:s,dataFormat:u,border:d,mipmaps:g}=t,_=Object.assign({width:i,height:o,format:a,type:s,dataFormat:u,border:d,mipmaps:g},e);return new n(r,_)}function ive(t,e){const{gl:n,width:r,height:i,id:o}=t;return new Ws(n,Object.assign({},e,{id:"framebuffer-for-".concat(o),width:r,height:i,attachments:{36064:t}}))}function JT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=t.match(n);return r?r[1]:e}const ove=35632,sve=35633;function ave(t){switch(t){case ove:return"fragment";case sve:return"vertex";default:return"unknown type"}}function lve(t,e,n,r){const i=t.split(/\r?\n/),o={},a={},s=r||JT(e)||"(unnamed)",u="".concat(ave(n)," shader ").concat(s);for(let g=0;g<i.length;g++){const _=i[g];if(_.length<=1)continue;const E=_.split(":"),P=E[0],R=parseInt(E[2],10);if(isNaN(R))throw new Error("GLSL compilation error in ".concat(u,": ").concat(t));P!=="WARNING"?o[R]=_:a[R]=_}const d=uve(e);return{shaderName:u,errors:Q9(o,d),warnings:Q9(a,d)}}function Q9(t,e){let n="";for(let r=0;r<e.length;r++){const i=e[r];if(!(!t[r+3]&&!t[r+2]&&!t[r+1])&&(n+="".concat(i,`
`),t[r+1])){const o=t[r+1],a=o.split(":",3),s=a[0],u=parseInt(a[1],10)||0,d=o.substring(a.join(":").length+1).trim();n+=ite("^^^ ".concat(s,": ").concat(d,`

`),u)}}return n}function uve(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=t.split(/\r?\n/),i=String(r.length+e-1).length;return r.map((o,a)=>{const s=String(a+e),u=s.length;return ite(s,i-u)+n+o})}function ite(t,e){let n="";for(let r=0;r<e;++r)n+=" ";return"".concat(n).concat(t)}function ote(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const cve="Shader: GLSL source code must be a JavaScript string";class Fw extends Eg{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Nn(!1),"unknown"}}constructor(e,n){OO(e),Nn(typeof n.source=="string",cve);const r=JT(n.source,null)||n.id||Ma("unnamed ".concat(Fw.getTypeName(n.shaderType)));super(e,{id:r}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const r=JT(n,null);r&&(this.id=Ma(r)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Fw.getTypeName(this.shaderType),":").concat(this.id)}getName(){return JT(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:i,errors:o,warnings:a}=lve(r,this.source,this.shaderType,this.id);throw Yn.error("GLSL compilation errors in ".concat(i,`
`).concat(o))(),Yn.warn("GLSL compilation warnings in ".concat(i,`
`).concat(a))(),new Error("GLSL compilation errors in ".concat(i))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class eC extends Fw{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class tC extends Fw{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const fve={5126:Co.bind(null,"uniform1fv",nc,1,ml),35664:Co.bind(null,"uniform2fv",nc,2,ml),35665:Co.bind(null,"uniform3fv",nc,3,ml),35666:Co.bind(null,"uniform4fv",nc,4,ml),5124:Co.bind(null,"uniform1iv",um,1,ml),35667:Co.bind(null,"uniform2iv",um,2,ml),35668:Co.bind(null,"uniform3iv",um,3,ml),35669:Co.bind(null,"uniform4iv",um,4,ml),35670:Co.bind(null,"uniform1iv",um,1,ml),35671:Co.bind(null,"uniform2iv",um,2,ml),35672:Co.bind(null,"uniform3iv",um,3,ml),35673:Co.bind(null,"uniform4iv",um,4,ml),35674:Co.bind(null,"uniformMatrix2fv",nc,4,kp),35675:Co.bind(null,"uniformMatrix3fv",nc,9,kp),35676:Co.bind(null,"uniformMatrix4fv",nc,16,kp),35678:Va,35680:Va,5125:Co.bind(null,"uniform1uiv",wS,1,ml),36294:Co.bind(null,"uniform2uiv",wS,2,ml),36295:Co.bind(null,"uniform3uiv",wS,3,ml),36296:Co.bind(null,"uniform4uiv",wS,4,ml),35685:Co.bind(null,"uniformMatrix2x3fv",nc,6,kp),35686:Co.bind(null,"uniformMatrix2x4fv",nc,8,kp),35687:Co.bind(null,"uniformMatrix3x2fv",nc,6,kp),35688:Co.bind(null,"uniformMatrix3x4fv",nc,12,kp),35689:Co.bind(null,"uniformMatrix4x2fv",nc,8,kp),35690:Co.bind(null,"uniformMatrix4x3fv",nc,12,kp),35678:Va,35680:Va,35679:Va,35682:Va,36289:Va,36292:Va,36293:Va,36298:Va,36299:Va,36300:Va,36303:Va,36306:Va,36307:Va,36308:Va,36311:Va},hve={},dve={},pve={},K9=[0];function f5(t,e,n,r){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(K9[0]=t,t=K9);const i=t.length;if(i%e&&Yn.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let o=r[i];o||(o=new n(i),r[i]=o);for(let a=0;a<i;a++)o[a]=t[a];return o}function nc(t,e){return f5(t,e,Float32Array,hve)}function um(t,e){return f5(t,e,Int32Array,dve)}function wS(t,e){return f5(t,e,Uint32Array,pve)}function J9(t,e,n){const r=fve[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,t,e)}function gve(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function mve(t,e,n){for(const r in t){const i=t[r];if((!n||!!n[r])&&!Ave(i))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),i),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function Ave(t){return Array.isArray(t)||ArrayBuffer.isView(t)?yve(t):isFinite(t)||t===!0||t===!1||t instanceof L0||t instanceof x0?!0:t instanceof Ws?!!t.texture:!1}function _ve(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const r=t[e];for(let i=0,o=n.length;i<o;++i)r[i]=n[i]}else t[e]=n.slice();else t[e]=n}function yve(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Va(){let t=null;return(e,n,r)=>{const i=t!==r;return i&&(e.uniform1i(n,r),t=r),i}}function Co(t,e,n,r){let i=null,o=null;return(a,s,u)=>{const d=e(u,n),g=d.length;let _=!1;if(i===null)i=new Float32Array(g),o=g,_=!0;else{Nn(o===g,"Uniform length cannot change.");for(let E=0;E<g;++E)if(d[E]!==i[E]){_=!0;break}}return _&&(r(a,t,s,d),i.set(d)),_}}function ml(t,e,n,r){t[e](n,r)}function kp(t,e,n,r){t[e](n,!1,r)}const vve=5120,xve=5121,bve=5122,wve=5123,e$=0,ES=1,Eve=2,Sve=3,SS=4,Tve=5,Cve=6,ea=5126,Pve=35664,Ive=35665,Mve=35666,ab=5124,Ove=35667,Rve=35668,Lve=35669,lb=5125,Dve=36294,Bve=36295,Nve=36296,Fve=35670,kve=35671,zve=35672,Uve=35673,Gve=35674,jve=35675,Vve=35676,$ve=35685,Hve=35686,Wve=35687,qve=35688,Xve=35689,Zve=35690,PF={[ea]:[ea,1,"float"],[Pve]:[ea,2,"vec2"],[Ive]:[ea,3,"vec3"],[Mve]:[ea,4,"vec4"],[ab]:[ab,1,"int"],[Ove]:[ab,2,"ivec2"],[Rve]:[ab,3,"ivec3"],[Lve]:[ab,4,"ivec4"],[lb]:[lb,1,"uint"],[Dve]:[lb,2,"uvec2"],[Bve]:[lb,3,"uvec3"],[Nve]:[lb,4,"uvec4"],[Fve]:[ea,1,"bool"],[kve]:[ea,2,"bvec2"],[zve]:[ea,3,"bvec3"],[Uve]:[ea,4,"bvec4"],[Gve]:[ea,8,"mat2"],[$ve]:[ea,8,"mat2x3"],[Hve]:[ea,8,"mat2x4"],[jve]:[ea,12,"mat3"],[Wve]:[ea,12,"mat3x2"],[qve]:[ea,12,"mat3x4"],[Vve]:[ea,16,"mat4"],[Xve]:[ea,16,"mat4x2"],[Zve]:[ea,16,"mat4x3"]};function Yve(t){switch(t){case e$:return e$;case ES:return ES;case Sve:return ES;case Eve:return ES;case SS:return SS;case Tve:return SS;case Cve:return SS;default:return Nn(!1),0}}function t$(t){const e=PF[t];if(!e)return null;const[n,r]=e;return{type:n,components:r}}function ste(t,e){switch(t){case vve:case xve:case bve:case wve:t=ea;break}for(const n in PF){const[r,i,o]=PF[n];if(r===t&&i===e)return{glType:n,name:o}}return null}class Qve{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,r=n.getProgramParameter(e.handle,35721);for(let i=0;i<r;i++){const{name:o,type:a,size:s}=n.getActiveAttrib(e.handle,i),u=n.getAttribLocation(e.handle,o);u>=0&&this._addAttribute(u,o,a,s)}this.attributeInfos.sort((i,o)=>i.location-o.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Hr(n))return;const r=n.getProgramParameter(e.handle,35971);for(let i=0;i<r;i++){const{name:o,type:a,size:s}=n.getTransformFeedbackVarying(e.handle,i);this._addVarying(i,o,a,s)}this.varyingInfos.sort((i,o)=>i.location-o.location)}_addAttribute(e,n,r,i){const{type:o,components:a}=t$(r),s={type:o,size:i*a};this._inferProperties(e,n,s);const u={location:e,name:n,accessor:new wu(s)};this.attributeInfos.push(u),this.attributeInfosByLocation[e]=u,this.attributeInfosByName[u.name]=u}_inferProperties(e,n,r){/instance/i.test(n)&&(r.divisor=1)}_addVarying(e,n,r,i){const{type:o,components:a}=t$(r),s=new wu({type:o,size:i*a}),u={location:e,name:n,accessor:s};this.varyingInfos.push(u),this.varyingInfosByName[u.name]=u}}const n$=4,Kve=35981,Jve=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class h5 extends Eg{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",Jve),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:r,fs:i,varyings:o,bufferMode:a=Kve}=e;return this.hash=n||"",this.vs=typeof r=="string"?new eC(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof i=="string"?new tC(this.gl,{id:"".concat(e.id,"-fs"),source:i}):i,Nn(this.vs instanceof eC),Nn(this.fs instanceof tC),this.uniforms={},this._textureUniforms={},o&&o.length>0&&(Xa(this.gl),this.varyings=o,this.gl2.transformFeedbackVaryings(this.handle,o,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new Qve(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:r=4,vertexCount:i,offset:o=0,start:a,end:s,isIndexed:u=!1,indexType:d=5123,instanceCount:g=0,isInstanced:_=g>0,vertexArray:E=null,transformFeedback:P,framebuffer:R,parameters:B={},uniforms:V,samplers:z}=e;if((V||z)&&(Yn.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(V||{})),Yn.priority>=n){const F=R?R.id:"default",k="mode=".concat(Um(this.gl,r)," verts=").concat(i," ")+"instances=".concat(g," indexType=").concat(Um(this.gl,d)," ")+"isInstanced=".concat(_," isIndexed=").concat(u," ")+"Framebuffer=".concat(F);Yn.log(n,k)()}return Nn(E),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||_&&g===0?!1:(E.bindForDraw(i,g,()=>{if(R!==void 0&&(B=Object.assign({},B,{framebuffer:R})),P){const F=Yve(r);P.begin(F)}this._bindTextures(),Mu(this.gl,B,()=>{u&&_?this.gl2.drawElementsInstanced(r,i,d,o,g):u&&Hr(this.gl)&&!isNaN(a)&&!isNaN(s)?this.gl2.drawRangeElements(r,a,s,i,d,o):u?this.gl.drawElements(r,i,d,o):_?this.gl2.drawArraysInstanced(r,o,i,g):this.gl.drawArrays(r,o,i)}),P&&P.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Yn.priority>=2&&mve(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const r=e[n],i=this._uniformSetters[n];if(i){let o=r,a=!1;if(o instanceof Ws&&(o=o.texture),o instanceof L0)if(a=this.uniforms[n]!==r,a){i.textureIndex===void 0&&(i.textureIndex=this._textureIndexCounter++);const s=o,{textureIndex:u}=i;s.bind(u),o=u,this._textureUniforms[n]=s}else o=i.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(i(o)||a)&&_ve(this.uniforms,n,r)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const r=this._textureUniforms[n];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),r={};for(const i of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new eC({handle:i});break;case 35632:r.fs=new tC({handle:i});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=Ma(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Yn.time(n$,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Yn.timeEnd(n$,"linkProgram for ".concat(this._getName()))(),e.debug||Yn.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const r=this.gl.getActiveUniform(this.handle,n),{name:i}=gve(r.name);let o=e.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=J9(e,o,r),r.size>1)for(let a=0;a<r.size;a++)o=e.getUniformLocation(this.handle,"".concat(i,"[").concat(a,"]")),this._uniformSetters["".concat(i,"[").concat(a,"]")]=J9(e,o,r)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const e1e=34918,t1e=34919,n1e=35007,r1e=36795,i1e=35976,o1e=35887,s1e=36202;class KP extends Eg{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=Hr(e),i=LO(e,Qi.TIMER_QUERY);let o=r||i;for(const a of n)switch(a){case"queries":o=o&&r;break;case"timers":o=o&&i;break;default:Nn(!1)}return o}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(n1e)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?s1e:o1e)}beginTransformFeedbackQuery(){return this.begin(i1e)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,t1e);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(r1e)}getResult(){return this.gl2.getQueryParameter(this.handle,e1e)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((r,i)=>{const o=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):n++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}_createHandle(){return KP.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class d5 extends Eg{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Hr(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Xa(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Dv(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const r=this._getVaryingIndex(e),{buffer:i,byteSize:o,byteOffset:a}=this._getBufferParams(n);return r<0?(this.unused[e]=i,Yn.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=n,this.bindOnUse||this._bindBuffer(r,i,a,o),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,r,i;return e instanceof ji?i=e:(i=e.buffer,r=e.byteSize,n=e.byteOffset),(n!==void 0||r!==void 0)&&(n=n||0,r=r||i.byteLength-n),{buffer:i,byteOffset:n,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:r,byteOffset:i}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,i,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const o=n&&n.handle;return!o||i===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,r,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let TS=null;function a1e(t){return(!TS||TS.byteLength<t)&&(TS=new ArrayBuffer(t)),TS}function l1e(t,e){const n=a1e(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function u1e(t){let{target:e,source:n,start:r=0,count:i=1}=t;const o=n.length,a=i*o;let s=0;for(let u=r;s<o;s++)e[u++]=n[s];for(;s<a;)s<a-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+a-s),s=a);return e}const c1e="elements must be GL.ELEMENT_ARRAY_BUFFER";class oc extends Eg{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Hr(e)||Fee()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new oc(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return oc.MAX_ATTRIBUTES=oc.MAX_ATTRIBUTES||e.getParameter(34921),oc.MAX_ATTRIBUTES}static setConstant(e,n,r){switch(r.constructor){case Float32Array:oc._setConstantFloatArray(e,n,r);break;case Int32Array:oc._setConstantIntArray(e,n,r);break;case Uint32Array:oc._setConstantUintArray(e,n,r);break;default:Nn(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return oc.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Nn(!e||e.target===34963,c1e),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,r){if(n.target===34963)return this.setElementBuffer(n,r);const{size:i,type:o,stride:a,offset:s,normalized:u,integer:d,divisor:g}=r,{gl:_,gl2:E}=this;return e=Number(e),this.bind(()=>{_.bindBuffer(34962,n.handle),d?(Nn(Hr(_)),E.vertexAttribIPointer(e,i,o,a,s)):_.vertexAttribPointer(e,i,o,u,a,s),_.enableVertexAttribArray(e),E.vertexAttribDivisor(e,g||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!oc.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const r=this._normalizeConstantArrayValue(n),i=r.byteLength*e,o=r.length*e;let a=!this.buffer;if(this.buffer=this.buffer||new ji(this.gl,i),a=a||this.buffer.reallocate(i),a=a||!this._compareConstantArrayValues(r,this.bufferValue),a){const s=l1e(n.constructor,o);u1e({target:s,source:r,start:0,count:o}),this.buffer.subData(s),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==n[r])return!1;return!0}static _setConstantFloatArray(e,n,r){switch(r.length){case 1:e.vertexAttrib1fv(n,r);break;case 2:e.vertexAttrib2fv(n,r);break;case 3:e.vertexAttrib3fv(n,r);break;case 4:e.vertexAttrib4fv(n,r);break;default:Nn(!1)}}static _setConstantIntArray(e,n,r){switch(Nn(Hr(e)),r.length){case 1:e.vertexAttribI1iv(n,r);break;case 2:e.vertexAttribI2iv(n,r);break;case 3:e.vertexAttribI3iv(n,r);break;case 4:e.vertexAttribI4iv(n,r);break;default:Nn(!1)}}static _setConstantUintArray(e,n,r){switch(Nn(Hr(e)),r.length){case 1:e.vertexAttribI1uiv(n,r);break;case 2:e.vertexAttribI2uiv(n,r);break;case 3:e.vertexAttribI3uiv(n,r);break;case 4:e.vertexAttribI4uiv(n,r);break;default:Nn(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:r}=n;return Nn(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const f1e="VertexArray: attributes must be Buffers or constants (i.e. typed array)",h1e=/^(.+)__LOCATION_([0-9]+)$/,d1e=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class p1e{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new oc(e),qee(this,"VertexArray","v6.0",d1e),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const r=e[n];this._setAttribute(n,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,r);const{location:i,accessor:o}=this._resolveLocationAndAccessor(e,n,n.accessor,r);return i>=0&&(this.values[i]=n,this.accessors[i]=o,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,n,o)),this}setConstant(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:i,accessor:o}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},r));return i>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[i]=n,this.accessors[i]=o,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new ji(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof ji&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof ji&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,r){let i;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),i=r()}),i}_resolveLocationAndAccessor(e,n,r,i){const o={location:-1,accessor:null},{location:a,name:s}=this._getAttributeIndex(e);if(!Number.isFinite(a)||a<0)return this.unused[e]=n,Yn.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),o;const u=this._getAttributeInfo(s||a);if(!u)return o;const d=this.accessors[a]||{},g=wu.resolve(u.accessor,d,r,i),{size:_,type:E}=g;return Nn(Number.isFinite(_)&&Number.isFinite(E)),{location:a,accessor:g}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const r=h1e.exec(e),i=r?r[1]:e,o=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+o,name:i}:{location:-1}}_setAttribute(e,n){if(n instanceof ji)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof ji){const r=n[0],i=n[1];this.setBuffer(e,r,i)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const r=n;this.setConstant(e,r)}else if(n.buffer instanceof ji){const r=n;this.setBuffer(e,r.buffer,r)}else throw new Error(f1e)}_setConstantAttributes(e,n){const r=Math.max(e|0,n|0);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,r);for(let o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)i=this.values[o],ArrayBuffer.isView(i)&&this._setConstantAttribute(o,i)}_setConstantAttributeZero(e,n){if(oc.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,n){oc.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const r=this.values[n],i=this.accessors[n];if(!r)return;const{divisor:o}=i,a=o>0;if(e.isInstanced=e.isInstanced||a,r instanceof ji){const s=r;if(a){const u=s.getVertexCount(i);e.instanceCount=Math.min(e.instanceCount,u)}else{const u=s.getVertexCount(i);e.vertexCount=Math.min(e.vertexCount,u)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Yn.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function g1e(t,e){const{maxElts:n=16,size:r=1}=e;let i="[";for(let a=0;a<t.length&&a<n;++a)a>0&&(i+=",".concat(a%r===0?" ":"")),i+=kw(t[a],e);const o=t.length>n?"...":"]";return"".concat(i).concat(o)}function kw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:r=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return g1e(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return r?"0":"0.";if(r||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const i=t.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function r$(t){let{header:e="Uniforms",program:n,uniforms:r,undefinedOnly:i=!1}=t;Nn(n);const o=".*_.*",a=".*Matrix",s=n._uniformSetters,u={},d=Object.keys(s).sort();let g=0;for(const P of d)!P.match(o)&&!P.match(a)&&UD({table:u,header:e,uniforms:r,uniformName:P,undefinedOnly:i})&&g++;for(const P of d)P.match(a)&&UD({table:u,header:e,uniforms:r,uniformName:P,undefinedOnly:i})&&g++;for(const P of d)u[P]||UD({table:u,header:e,uniforms:r,uniformName:P,undefinedOnly:i})&&g++;let _=0;const E={};if(!i)for(const P in r){const R=r[P];u[P]||(_++,E[P]={Type:"NOT USED: ".concat(R),[e]:kw(R)})}return{table:u,count:g,unusedTable:E,unusedCount:_}}function UD(t){let{table:e,header:n,uniforms:r,uniformName:i,undefinedOnly:o}=t;const a=r[i],s=m1e(a);return!o||!s?(e[i]={[n]:s?kw(a):"N/A","Uniform Type":s?a:"NOT PROVIDED"},!0):!1}function m1e(t){return t!=null}function A1e(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=i$(e,e.elements,null,n));const i=e.values;for(const o in i){const a=e._getAttributeInfo(o);if(a){let s="".concat(o,": ").concat(a.name);const u=e.accessors[a.location];u&&(s="".concat(o,": ").concat(_1e(a.name,u))),r[s]=i$(e,i[o],u,n)}}return r}function i$(t,e,n,r){const{gl:i}=t;if(!e)return{[r]:"null","Format ":"N/A"};let o="NOT PROVIDED",a=1,s=0,u=0,d,g,_;if(n&&(o=n.type,a=n.size,o=String(o).replace("Array",""),d=o.indexOf("nt")!==-1),e instanceof ji){const E=e,{data:P,changed:R}=E.getDebugData();g=R?"*":"",_=P,u=E.byteLength,s=u/P.BYTES_PER_ELEMENT/a;let B;if(n){const V=n.divisor>0;B="".concat(V?"I ":"P "," ").concat(s," (x").concat(a,"=").concat(u," bytes ").concat(Um(i,o),")")}else d=!0,B="".concat(u," bytes");return{[r]:"".concat(g).concat(kw(_,{size:a,isInteger:d})),"Format ":B}}return _=e,a=e.length,o=String(e.constructor.name).replace("Array",""),d=o.indexOf("nt")!==-1,{[r]:"".concat(kw(_,{size:a,isInteger:d})," (constant)"),"Format ":"".concat(a,"x").concat(o," (constant)")}}function _1e(t,e){const{type:n,size:r}=e,i=ste(n,r);return i?"".concat(t," (").concat(i.name,")"):t}function y1e(t){const e={},n="Accessors for ".concat(t.id);for(const r of t.attributeInfos)if(r){const i=o$(r);e["in ".concat(i)]={[n]:JSON.stringify(r.accessor)}}for(const r of t.varyingInfos)if(r){const i=o$(r);e["out ".concat(i)]={[n]:JSON.stringify(r.accessor)}}return e}function o$(t){const{type:e,size:n}=t.accessor,r=ste(e,n);return r?"".concat(r.name," ").concat(t.name):t.name}const s$=wg()&&typeof document<"u";let v1e=0;class ate{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=V=>s5(V),onAddHTML:r=null,onInitialize:i=()=>{},onRender:o=()=>{},onFinalize:a=()=>{},onError:s,gl:u=null,glOptions:d={},debug:g=!1,createFramebuffer:_=!1,autoResizeViewport:E=!0,autoResizeDrawingBuffer:P=!0,stats:R=Cm.get("animation-loop-".concat(v1e++))}=e;let{useDevicePixels:B=!0}=e;"useDevicePixelRatio"in e&&(Yn.deprecated("useDevicePixelRatio","useDevicePixels")(),B=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:r,onInitialize:i,onRender:o,onFinalize:a,onError:s,gl:u,glOptions:d,debug:g,createFramebuffer:_},this.gl=u,this.needsRedraw=null,this.timeline=null,this.stats=R,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:E,autoResizeDrawingBuffer:P,useDevicePixels:B}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return Nn(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=KP.isSupported(this.gl,["timers"])?new KP(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):n}setViewParameters(){return Yn.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=s$?new Promise((e,n)=>{if(s$&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):Mye(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):Iye(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?RO(this.props.gl,e):this.onCreateContext(e),!PE(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Hee(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let r=1;const{canvas:i}=this.gl;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&xye(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Ws(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const LE="vs",p5="fs";function dc(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const GD={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function x1e(t){const e={};for(const n in t){const r=t[n],i=b1e(r);e[n]=i}return e}function b1e(t){let e=a$(t);return e==="object"?t?"type"in t?Object.assign({},t,GD[t.type]):"value"in t?(e=a$(t.value),Object.assign({type:e},t,GD[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},GD[e])}function a$(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const w1e="vs",E1e="fs";class IF{constructor(e){let{name:n,vs:r,fs:i,dependencies:o=[],uniforms:a,getUniforms:s,deprecations:u=[],defines:d={},inject:g={},vertexShader:_,fragmentShader:E}=e;dc(typeof n=="string"),this.name=n,this.vs=r||_,this.fs=i||E,this.getModuleUniforms=s,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(u),this.defines=d,this.injections=S1e(g),a&&(this.uniforms=x1e(a))}getModuleSource(e){let n;switch(e){case w1e:n=this.vs||"";break;case E1e:n=this.fs||"";break;default:dc(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},r=this.uniforms;for(const i in r){const o=r[i];i in e&&!o.private?(o.validate&&dc(o.validate(e[i],o),"".concat(this.name,": invalid ").concat(i)),n[i]=e[i]):n[i]=o.value}return n}}function lte(t){if(!t.normalized&&(t.normalized=!0,t.uniforms&&!t.getUniforms)){const e=new IF(t);t.getUniforms=e.getUniforms.bind(e)}return t}function S1e(t){const e={vs:{},fs:{}};for(const n in t){let r=t[n];const i=n.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function T1e(t){return C1e(cte(t))}function C1e(t){const e={},n={};return ute({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,i)=>n[i]-n[r]).map(r=>e[r])}function ute(t){let{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)r[o.name]=o,(i[o.name]===void 0||i[o.name]<n)&&(i[o.name]=n);for(const o of e)o.dependencies&&ute({modules:o.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function cte(t,e){return t.map(n=>(n instanceof IF||(dc(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),dc(n.name,"shader module has no name"),n=new IF(n),n.dependencies=cte(n.dependencies)),n))}function P1e(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",r=n.indexOf("MSIE ")!==-1,i=n.indexOf("Trident/")!==-1;return r||i}const I1e=7936,M1e=7937,O1e=7938,R1e=35724,g5={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},m0={};Object.keys(g5).forEach(t=>{m0[t]=t});function L1e(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function D1e(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||I1e),r=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||M1e);return{gpuVendor:B1e(n,r),vendor:n,renderer:r,version:t.getParameter(O1e),shadingLanguageVersion:t.getParameter(R1e)}}function B1e(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const jD={};function l$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=g5[e];if(dc(r,e),!P1e(n))return!0;if(e in jD)return jD[e];const i=r[0],o=n.behavior||"enable",a="#extension GL_".concat(i," : ").concat(o,`
void main(void) {}`),s=t.createShader(35633);t.shaderSource(s,a),t.compileShader(s);const u=t.getShaderParameter(s,35713);return t.deleteShader(s),jD[e]=u,u}function N1e(t,e){const n=g5[e];dc(n,e);const r=L1e(t)&&n[1]||n[0],i=typeof r=="string"?!!t.getExtension(r):r;return dc(i===!1||i===!0),i}function CS(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>N1e(t,n))}function F1e(t){switch(D1e(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function k1e(t,e,n){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return CS(t,m0.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),CS(t,m0.GLSL_DERIVATIVES)&&l$(t,m0.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),CS(t,m0.GLSL_FRAG_DATA)&&l$(t,m0.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),CS(t,m0.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const z1e=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,U1e=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,G1e={[LE]:z1e,[p5]:U1e},nC="__LUMA_INJECT_DECLARATIONS__",u$=/void\s+main\s*\([^)]*\)\s*\{\n?/,c$=/}\n?[^{}]*$/,VD=[];function f$(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=e===LE;for(const o in n){const a=n[o];a.sort((u,d)=>u.order-d.order),VD.length=a.length;for(let u=0,d=a.length;u<d;++u)VD[u]=a[u].injection;const s="".concat(VD.join(`
`),`
`);switch(o){case"vs:#decl":i&&(t=t.replace(nC,s));break;case"vs:#main-start":i&&(t=t.replace(u$,u=>u+s));break;case"vs:#main-end":i&&(t=t.replace(c$,u=>s+u));break;case"fs:#decl":i||(t=t.replace(nC,s));break;case"fs:#main-start":i||(t=t.replace(u$,u=>u+s));break;case"fs:#main-end":i||(t=t.replace(c$,u=>s+u));break;default:t=t.replace(o,u=>u+s)}}return t=t.replace(nC,""),r&&(t=t.replace(/\}\s*$/,o=>o+G1e[e])),t}function MF(t){const e={};return dc(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const r in n)e[r]=e[r]?"".concat(e[r],`
`).concat(n[r]):n[r]}),e}function Bv(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const fte=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],j1e=[...fte,[Bv("attribute"),"in $1"],[Bv("varying"),"out $1"]],V1e=[...fte,[Bv("varying"),"in $1"]],hte=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],$1e=[...hte,[Bv("in"),"attribute $1"],[Bv("out"),"varying $1"]],H1e=[...hte,[Bv("in"),"varying $1"]],OF="gl_FragColor",RF=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,W1e=/void\s+main\s*\([^)]*\)\s*\{\n?/;function q1e(t,e,n){switch(e){case 300:return n?JP(t,j1e):X1e(t);case 100:return n?JP(t,$1e):Z1e(t);default:throw new Error("unknown GLSL version ".concat(e))}}function JP(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function X1e(t){t=JP(t,V1e);const e=t.match(RF);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(OF,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(W1e,r=>"out vec4 ".concat(n,`;
`).concat(r)).replace(new RegExp("\\b".concat(OF,"\\b"),"g"),n)}return t}function Z1e(t){t=JP(t,H1e);const e=t.match(RF);if(e){const n=e[1];t=t.replace(RF,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),OF)}return t}const Y1e=`

`.concat(nC,`

`),dte={[LE]:"vertex",[p5]:"fragment"},Q1e=`precision highp float;

`;function K1e(t,e){const{vs:n,fs:r}=e,i=T1e(e.modules||[]);return{gl:t,vs:h$(t,Object.assign({},e,{source:n,type:LE,modules:i})),fs:h$(t,Object.assign({},e,{source:r,type:p5,modules:i})),getUniforms:J1e(i)}}function h$(t,e){let{id:n,source:r,type:i,modules:o,defines:a={},hookFunctions:s=[],inject:u={},transpileToGLSL100:d=!1,prologue:g=!0,log:_}=e;dc(typeof r=="string","shader source must be a string");const E=i===LE,P=r.split(`
`);let R=100,B="",V=r;P[0].indexOf("#version ")===0?(R=300,B=P[0],V=P.slice(1).join(`
`)):B="#version ".concat(R);const z={};o.forEach(ie=>{Object.assign(z,ie.getDefines())}),Object.assign(z,a);let F=g?"".concat(B,`
`).concat(txe({id:n,source:r,type:i}),`
`).concat(exe({type:i}),`
`).concat(F1e(t),`
`).concat(k1e(t),`
`).concat(nxe(z),`
`).concat(E?"":Q1e,`
`):"".concat(B,`
`);const k=ixe(s),X={},Y={},J={};for(const ie in u){const ce=typeof u[ie]=="string"?{injection:u[ie],order:0}:u[ie],re=ie.match(/^(v|f)s:(#)?([\w-]+)$/);if(re){const ue=re[2],se=re[3];ue?se==="decl"?Y[ie]=[ce]:J[ie]=[ce]:X[ie]=[ce]}else J[ie]=[ce]}for(const ie of o){_&&ie.checkDeprecations(V,_);const ce=ie.getModuleSource(i,R);F+=ce;const re=ie.injections[i];for(const ue in re){const se=ue.match(/^(v|f)s:#([\w-]+)$/);if(se){const Ce=se[2]==="decl"?Y:J;Ce[ue]=Ce[ue]||[],Ce[ue].push(re[ue])}else X[ue]=X[ue]||[],X[ue].push(re[ue])}}return F+=Y1e,F=f$(F,i,Y),F+=rxe(k[i],X),F+=V,F=f$(F,i,J),F=q1e(F,d?100:R,E),F}function J1e(t){return function(n){const r={};for(const i of t){const o=i.getUniforms(n,r);Object.assign(r,o)}return r}}function exe(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(dte[e].toUpperCase(),`
`)}function txe(t){let{id:e,source:n,type:r}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(dte[r],`

`):""}function nxe(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const r in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const i=t[r];(i||Number.isFinite(i))&&(n+="#define ".concat(r.toUpperCase()," ").concat(t[r],`
`))}return e===0&&(n+=`
`),n}function rxe(t,e){let n="";for(const r in t){const i=t[r];if(n+="void ".concat(i.signature,` {
`),i.header&&(n+="  ".concat(i.header)),e[r]){const o=e[r];o.sort((a,s)=>a.order-s.order);for(const a of o)n+="  ".concat(a.injection,`
`)}i.footer&&(n+="  ".concat(i.footer)),n+=`}
`}return n}function ixe(t){const e={vs:{},fs:{}};return t.forEach(n=>{let r;typeof n!="string"?(r=n,n=r.hook):r={},n=n.trim();const[i,o]=n.split(":"),a=n.replace(/\(.+/,"");e[i][a]=Object.assign(r,{signature:o})}),e}const oxe="void main() {gl_FragColor = vec4(0);}",pte=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,sxe=`#version 300 es
`.concat(pte);function gte(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[r,i,o]=n;if(!e.includes(r)||!i||!o)return null;const a=o.split(";")[0];return{qualifier:r,type:i,name:a}}function mte(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:r,output:i}=t;if(!n)return e===300?sxe:e>300?"#version ".concat(e,`
`).concat(pte):oxe;const o=uxe(n,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(n,`;
out vec4 `).concat(i,`;
void main() {
  `).concat(i," = ").concat(o,`;
}`):"varying ".concat(r," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function axe(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return dc(!1),null}}function lxe(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return dc(!1),null}}function uxe(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return dc(!1),null}}const cxe=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Ate={name:"fp32",vs:cxe,fs:null};function m5(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function _te(t){return t-Math.fround(t)}function yte(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;m5(t[r*4+n],e,i*2)}return e}const fxe=`uniform float ONE;
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * ONE - (t - a);
  float a_lo = a * ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * ONE;
  float err = b - (sum - a) * ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * ONE - a) * ONE;
  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * ONE - a) * ONE;
  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,hxe=`const vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);
const vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);
const vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);
const vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);
const vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);
const vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);
const vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);
const vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);
const vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);
const vec2 PI_180_FP64 = vec2(0.01745329238474369, 1.3519960498364902e-10);

const vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);
const vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);
const vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);
const vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);

const vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);
const vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);
const vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);
const vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);

const vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09);
const vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09);
const vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10);
const vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11);
const vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12);
const vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13);
const vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14);
const vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15);

float nint(float d) {
    if (d == floor(d)) return d;
    return floor(d + 0.5);
}

vec2 nint_fp64(vec2 a) {
    float hi = nint(a.x);
    float lo;
    vec2 tmp;
    if (hi == a.x) {
        lo = nint(a.y);
        tmp = quickTwoSum(hi, lo);
    } else {
        lo = 0.0;
        if (abs(hi - a.x) == 0.5 && a.y < 0.0) {
            hi -= 1.0;
        }
        tmp = vec2(hi, lo);
    }
    return tmp;
}

vec2 exp_fp64(vec2 a) {

  const int k_power = 4;
  const float k = 16.0;

  const float inv_k = 1.0 / k;

  if (a.x <= -88.0) return vec2(0.0, 0.0);
  if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);
  if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);
  if (a.x == 1.0 && a.y == 0.0) return E_FP64;

  float m = floor(a.x / LOG2_FP64.x + 0.5);
  vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;
  vec2 s, t, p;

  p = mul_fp64(r, r);
  s = sum_fp64(r, p * 0.5);
  p = mul_fp64(p, r);
  t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);

  s = sum_fp64(s, t);
  p = mul_fp64(p, r);
  t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);

  s = sum_fp64(s, t);
  p = mul_fp64(p, r);
  t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);






  s = sum_fp64(s, t);
  for (int i = 0; i < k_power; i++) {
    s = sum_fp64(s * 2.0, mul_fp64(s, s));
  }

#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
  s = sum_fp64(s, vec2(ONE, 0.0));
#else
  s = sum_fp64(s, vec2(1.0, 0.0));
#endif

  return s * pow(2.0, m);
}

vec2 log_fp64(vec2 a)
{
  if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
  vec2 x = vec2(log(a.x), 0.0);
  vec2 s;
#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
  s = vec2(ONE, 0.0);
#else
  s = vec2(1.0, 0.0);
#endif

  x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);
  return x;
}

vec2 sin_taylor_fp64(vec2 a) {
  vec2 r, s, t, x;

  if (a.x == 0.0 && a.y == 0.0) {
    return vec2(0.0, 0.0);
  }

  x = -mul_fp64(a, a);
  s = a;
  r = a;

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);
  s = sum_fp64(s, t);

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);
  s = sum_fp64(s, t);






  return s;
}

vec2 cos_taylor_fp64(vec2 a) {
  vec2 r, s, t, x;

  if (a.x == 0.0 && a.y == 0.0) {
    return vec2(1.0, 0.0);
  }

  x = -mul_fp64(a, a);
  r = x;
  s = sum_fp64(vec2(1.0, 0.0), r * 0.5);

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);
  s = sum_fp64(s, t);

  r = mul_fp64(r, x);
  t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);
  s = sum_fp64(s, t);






  return s;
}

void sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {
  if (a.x == 0.0 && a.y == 0.0) {
    sin_t = vec2(0.0, 0.0);
    cos_t = vec2(1.0, 0.0);
  }

  sin_t = sin_taylor_fp64(a);
  cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));
}

vec2 sin_fp64(vec2 a) {
    if (a.x == 0.0 && a.y == 0.0) {
        return vec2(0.0, 0.0);
    }
    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));

    vec2 t;
    float q = floor(r.x / PI_2_FP64.x + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    }

    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));

    q = floor(t.x / PI_16_FP64.x + 0.5);
    int k = int(q);

    if (k == 0) {
        if (j == 0) {
            return sin_taylor_fp64(t);
        } else if (j == 1) {
            return cos_taylor_fp64(t);
        } else if (j == -1) {
            return -cos_taylor_fp64(t);
        } else {
            return -sin_taylor_fp64(t);
        }
    }

    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    } else {
        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
    }

    vec2 u = vec2(0.0, 0.0);
    vec2 v = vec2(0.0, 0.0);

#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
    if (abs(float(abs_k) - 1.0) < 0.5) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs(float(abs_k) - 2.0) < 0.5) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs(float(abs_k) - 3.0) < 0.5) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs(float(abs_k) - 4.0) < 0.5) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#else
    if (abs_k == 1) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs_k == 2) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs_k == 3) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs_k == 4) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#endif

    vec2 sin_t, cos_t;
    sincos_taylor_fp64(t, sin_t, cos_t);



    vec2 result = vec2(0.0, 0.0);
    if (j == 0) {
        if (k > 0) {
            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        }
    } else if (j == 1) {
        if (k > 0) {
            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        } else {
            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    } else if (j == -1) {
        if (k > 0) {
            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
        } else {
            result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
        }
    } else {
        if (k > 0) {
            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));
        }
    }

    return result;
}

vec2 cos_fp64(vec2 a) {
    if (a.x == 0.0 && a.y == 0.0) {
        return vec2(1.0, 0.0);
    }
    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));

    vec2 t;
    float q = floor(r.x / PI_2_FP64.x + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    }

    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));

    q = floor(t.x / PI_16_FP64.x + 0.5);
    int k = int(q);

    if (k == 0) {
        if (j == 0) {
            return cos_taylor_fp64(t);
        } else if (j == 1) {
            return -sin_taylor_fp64(t);
        } else if (j == -1) {
            return sin_taylor_fp64(t);
        } else {
            return -cos_taylor_fp64(t);
        }
    }

    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    } else {
        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
    }

    vec2 u = vec2(0.0, 0.0);
    vec2 v = vec2(0.0, 0.0);

#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
    if (abs(float(abs_k) - 1.0) < 0.5) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs(float(abs_k) - 2.0) < 0.5) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs(float(abs_k) - 3.0) < 0.5) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs(float(abs_k) - 4.0) < 0.5) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#else
    if (abs_k == 1) {
        u = COS_TABLE_0_FP64;
        v = SIN_TABLE_0_FP64;
    } else if (abs_k == 2) {
        u = COS_TABLE_1_FP64;
        v = SIN_TABLE_1_FP64;
    } else if (abs_k == 3) {
        u = COS_TABLE_2_FP64;
        v = SIN_TABLE_2_FP64;
    } else if (abs_k == 4) {
        u = COS_TABLE_3_FP64;
        v = SIN_TABLE_3_FP64;
    }
#endif

    vec2 sin_t, cos_t;
    sincos_taylor_fp64(t, sin_t, cos_t);

    vec2 result = vec2(0.0, 0.0);
    if (j == 0) {
        if (k > 0) {
            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        } else {
            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    } else if (j == 1) {
        if (k > 0) {
            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));
        }
    } else if (j == -1) {
        if (k > 0) {
            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        } else {
            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
        }
    } else {
        if (k > 0) {
            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
        } else {
            result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    }

    return result;
}

vec2 tan_fp64(vec2 a) {
    vec2 sin_a;
    vec2 cos_a;

    if (a.x == 0.0 && a.y == 0.0) {
        return vec2(0.0, 0.0);
    }
    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));

    vec2 t;
    float q = floor(r.x / PI_2_FP64.x + 0.5);
    int j = int(q);


    if (j < -2 || j > 2) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    }

    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));

    q = floor(t.x / PI_16_FP64.x + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return vec2(0.0 / 0.0, 0.0 / 0.0);
    } else {
        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
    }


    vec2 u = vec2(0.0, 0.0);
    vec2 v = vec2(0.0, 0.0);

    vec2 sin_t, cos_t;
    vec2 s, c;
    sincos_taylor_fp64(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0_FP64;
            v = SIN_TABLE_0_FP64;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1_FP64;
            v = SIN_TABLE_1_FP64;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2_FP64;
            v = SIN_TABLE_2_FP64;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3_FP64;
            v = SIN_TABLE_3_FP64;
        }
#else
        if (abs_k == 1) {
            u = COS_TABLE_0_FP64;
            v = SIN_TABLE_0_FP64;
        } else if (abs_k == 2) {
            u = COS_TABLE_1_FP64;
            v = SIN_TABLE_1_FP64;
        } else if (abs_k == 3) {
            u = COS_TABLE_2_FP64;
            v = SIN_TABLE_2_FP64;
        } else if (abs_k == 4) {
            u = COS_TABLE_3_FP64;
            v = SIN_TABLE_3_FP64;
        }
#endif
        if (k > 0) {
            s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
            c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        } else {
            s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
            c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return div_fp64(sin_a, cos_a);
}

vec2 radians_fp64(vec2 degree) {
  return mul_fp64(degree, PI_180_FP64);
}

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = sum_fp64(a[0], b[0]);
    out_val[1] = sum_fp64(a[1], b[1]);
}

void vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = sub_fp64(a[0], b[0]);
    out_val[1] = sub_fp64(a[1], b[1]);
}

void vec2_mul_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = mul_fp64(a[0], b[0]);
    out_val[1] = mul_fp64(a[1], b[1]);
}

void vec2_div_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
    out_val[0] = div_fp64(a[0], b[0]);
    out_val[1] = div_fp64(a[1], b[1]);
}

void vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {
  vec2 range[2];
  vec2_sub_fp64(y, x, range);
  vec2 portion[2];
  portion[0] = range[0] * a;
  portion[1] = range[1] * a;
  vec2_sum_fp64(x, portion, out_val);
}

vec2 vec2_length_fp64(vec2 x[2]) {
  return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));
}

void vec2_normalize_fp64(vec2 x[2], out vec2 out_val[2]) {
  vec2 length = vec2_length_fp64(x);
  vec2 length_vec2[2];
  length_vec2[0] = length;
  length_vec2[1] = length;

  vec2_div_fp64(x, length_vec2, out_val);
}

vec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {
  vec2 diff[2];
  vec2_sub_fp64(x, y, diff);
  return vec2_length_fp64(diff);
}

vec2 vec2_dot_fp64(vec2 a[2], vec2 b[2]) {
  vec2 v[2];

  v[0] = mul_fp64(a[0], b[0]);
  v[1] = mul_fp64(a[1], b[1]);

  return sum_fp64(v[0], v[1]);
}
void vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {
  for (int i = 0; i < 3; i++) {
    out_val[i] = sum_fp64(a[i], b[i]);
  }
}

void vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {
  for (int i = 0; i < 3; i++) {
    out_val[i] = sum_fp64(a[i], b[i]);
  }
}

vec2 vec3_length_fp64(vec2 x[3]) {
  return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])),
    mul_fp64(x[2], x[2])));
}

vec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {
  vec2 diff[3];
  vec3_sub_fp64(x, y, diff);
  return vec3_length_fp64(diff);
}
void vec4_fp64(vec4 a, out vec2 out_val[4]) {
  out_val[0].x = a[0];
  out_val[0].y = 0.0;

  out_val[1].x = a[1];
  out_val[1].y = 0.0;

  out_val[2].x = a[2];
  out_val[2].y = 0.0;

  out_val[3].x = a[3];
  out_val[3].y = 0.0;
}

void vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {
  out_val[0] = mul_fp64(a[0], b);
  out_val[1] = mul_fp64(a[1], b);
  out_val[2] = mul_fp64(a[2], b);
  out_val[3] = mul_fp64(a[3], b);
}

void vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {
  for (int i = 0; i < 4; i++) {
    out_val[i] = sum_fp64(a[i], b[i]);
  }
}

void vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {
  vec2 v[4];

  v[0] = mul_fp64(a[0], b[0]);
  v[1] = mul_fp64(a[1], b[1]);
  v[2] = mul_fp64(a[2], b[2]);
  v[3] = mul_fp64(a[3], b[3]);

  out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));
}

void mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {
  vec2 tmp[4];

  for (int i = 0; i < 4; i++)
  {
    for (int j = 0; j < 4; j++)
    {
      tmp[j] = b[j + i * 4];
    }
    vec4_dot_fp64(a, tmp, out_val[i]);
  }
}
`,dxe={ONE:1};function pxe(){return dxe}const gxe={name:"fp64-arithmetic",vs:fxe,fs:null,getUniforms:pxe,fp64ify:m5,fp64LowPart:_te,fp64ifyMatrix4:yte},mxe={name:"fp64",vs:hxe,fs:null,dependencies:[gxe],fp64ify:m5,fp64LowPart:_te,fp64ifyMatrix4:yte};function ac(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Axe=1/Math.PI*180,_xe=1/180*Math.PI,fo={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function yxe(t){for(const e in t)ac(e in fo),fo[e]=t[e];return fo}function A5(t,{precision:e=fo.precision}={}){return t=Pxe(t),"".concat(parseFloat(t.toPrecision(e)))}function wh(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function vxe(t){return"clone"in t?t.clone():t.slice()}function vte(t){return Jy(t)}function xte(t){return bl(t)}function Jy(t,e){return Sg(t,n=>n*_xe,e)}function bl(t,e){return Sg(t,n=>n*Axe,e)}function xxe(t,e){return Sg(t,n=>Math.sin(n),e)}function bxe(t,e){return Sg(t,n=>Math.cos(n),e)}function wxe(t,e){return Sg(t,n=>Math.tan(n),e)}function Exe(t,e){return Sg(t,n=>Math.asin(n),e)}function Sxe(t,e){return Sg(t,n=>Math.acos(n),e)}function Txe(t,e){return Sg(t,n=>Math.atan(n),e)}function Wi(t,e,n){return Sg(t,r=>Math.max(e,Math.min(n,r)))}function pc(t,e,n){return wh(t)?t.map((r,i)=>pc(r,e[i],n)):n*e+(1-n)*t}function Sl(t,e,n){const r=fo.EPSILON;n&&(fo.EPSILON=n);try{if(t===e)return!0;if(wh(t)&&wh(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!Sl(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=fo.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{fo.EPSILON=r}}function bte(t,e){if(t===e)return!0;if(t&&typeof t=="object"&&e&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;if(t.exactEquals)return t.exactEquals(e)}if(wh(t)&&wh(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!bte(t[n],e[n]))return!1;return!0}return!1}function Cxe(t,e){const n=fo.EPSILON;fo.EPSILON=t;let r;try{r=e()}finally{fo.EPSILON=n}return r}function Pxe(t){return Math.round(t/fo.EPSILON)*fo.EPSILON}function Ixe(t){return t.clone?t.clone():new Array(t.length)}function Sg(t,e,n){if(wh(t)){const r=t;n=n||Ixe(r);for(let i=0;i<n.length&&i<r.length;++i)n[i]=e(t[i],i,n);return n}return e(t)}function Mxe(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class DO extends Mxe(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:wh(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(fo)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+A5(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Sl(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const o=e[i];this[i]=o+r*(n[i]-o)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(fo.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function Oxe(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ur(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function cw(t,e,n=""){if(fo.debug&&!Oxe(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class _5 extends DO{get x(){return this[0]}set x(e){this[0]=Ur(e)}get y(){return this[1]}set y(e){this[1]=Ur(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return Ur(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return Ur(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return ac(e>=0&&e<this.ELEMENTS,"index is out of range"),Ur(this[e])}setComponent(e,n){return ac(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Es=1e-6,Eh=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function Rxe(){var t=new Eh(2);return Eh!=Float32Array&&(t[0]=0,t[1]=0),t}function D0(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Lxe(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Dxe(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function Bxe(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function y5(t,e){return t[0]=-e[0],t[1]=-e[1],t}function wte(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}function Nxe(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function Fxe(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function Ete(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function Ste(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}var kxe=Lxe;(function(){var t=Rxe();return function(e,n,r,i,o,a){var s,u;for(n||(n=2),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],o(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}})();function Tte(t,e,n){const r=e[0],i=e[1],o=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/o,t[1]=(n[1]*r+n[5]*i)/o,t}function Cte(t,e,n){const r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o||1;return t[0]=(n[0]*r+n[4]*i+n[8]*o)/a,t[1]=(n[1]*r+n[5]*i+n[9]*o)/a,t[2]=(n[2]*r+n[6]*i+n[10]*o)/a,t}function zxe(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function Uxe(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t[3]=e[3],t}function Pte(t,e,n){const r=e[0],i=e[1],o=e[2];return t[0]=n[0]*r+n[3]*i+n[6]*o,t[1]=n[1]*r+n[4]*i+n[7]*o,t[2]=n[2]*r+n[5]*i+n[8]*o,t[3]=e[3],t}class BO extends _5{constructor(e=0,n=0){super(2),wh(e)&&arguments.length===1?this.copy(e):(fo.debug&&(Ur(e),Ur(n)),this[0]=e,this[1]=n)}set(e,n){return this[0]=e,this[1]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return fo.debug&&(Ur(e.x),Ur(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Ste(this,this,e),this.check()}transformAsVector(e){return Tte(this,this,e),this.check()}transformByMatrix3(e){return Ete(this,this,e),this.check()}transformByMatrix2x3(e){return Fxe(this,this,e),this.check()}transformByMatrix2(e){return Nxe(this,this,e),this.check()}}function Ite(){var t=new Eh(3);return Eh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function v5(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function d$(t,e,n){var r=new Eh(3);return r[0]=t,r[1]=e,r[2]=n,r}function Gxe(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function jxe(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Vxe(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function $xe(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function Hxe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Wxe(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function x5(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function rC(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function qxe(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t}function b5(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function Mte(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function Ote(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],d=e[2],g=i*d-o*u,_=o*s-r*d,E=r*u-i*s,P=i*E-o*_,R=o*g-r*E,B=r*_-i*g,V=a*2;return g*=V,_*=V,E*=V,P*=2,R*=2,B*=2,t[0]=s+g+P,t[1]=u+_+R,t[2]=d+E+B,t}function Xxe(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Zxe(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Yxe(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Qxe(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i),d=Math.sqrt(o*o+a*a+s*s),g=u*d,_=g&&x5(t,e)/g;return Math.acos(Math.min(Math.max(_,-1),1))}var Rte=jxe,Kxe=Vxe,Lte=v5,$D=$xe;(function(){var t=Ite();return function(e,n,r,i,o,a){var s,u;for(n||(n=3),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();const HD=[0,0,0];let PS;class yt extends _5{static get ZERO(){return PS||(PS=new yt(0,0,0),Object.freeze(PS)),PS}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&wh(e)?this.copy(e):(fo.debug&&(Ur(e),Ur(n),Ur(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return fo.debug&&(Ur(e.x),Ur(e.y),Ur(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ur(e)}angle(e){return Qxe(this,e)}cross(e){return rC(this,this,e),this.check()}rotateX({radians:e,origin:n=HD}){return Xxe(this,this,n,e),this.check()}rotateY({radians:e,origin:n=HD}){return Zxe(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=HD}){return Yxe(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return b5(this,this,e),this.check()}transformAsVector(e){return Cte(this,this,e),this.check()}transformByMatrix3(e){return Mte(this,this,e),this.check()}transformByMatrix2(e){return zxe(this,this,e),this.check()}transformByQuaternion(e){return Ote(this,this,e),this.check()}}let IS;class NO extends _5{static get ZERO(){return IS||(IS=new NO(0,0,0,0),Object.freeze(IS)),IS}constructor(e=0,n=0,r=0,i=0){super(-0,-0,-0,-0),wh(e)&&arguments.length===1?this.copy(e):(fo.debug&&(Ur(e),Ur(n),Ur(r),Ur(i)),this[0]=e,this[1]=n,this[2]=r,this[3]=i)}set(e,n,r,i){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return fo.debug&&(Ur(e.x),Ur(e.y),Ur(e.z),Ur(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Ur(e)}get w(){return this[3]}set w(e){this[3]=Ur(e)}transform(e){return b5(this,this,e),this.check()}transformByMatrix3(e){return Pte(this,this,e),this.check()}transformByMatrix2(e){return Uxe(this,this,e),this.check()}transformByQuaternion(e){return Ote(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class Dte extends DO{toString(){let e="[";if(fo.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=Ur(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function Jxe(){var t=new Eh(9);return Eh!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ebe(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function tbe(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],d=e[7],g=e[8],_=g*a-s*d,E=-g*o+s*u,P=d*o-a*u,R=n*_+r*E+i*P;return R?(R=1/R,t[0]=_*R,t[1]=(-g*r+i*d)*R,t[2]=(s*r-i*a)*R,t[3]=E*R,t[4]=(g*n-i*u)*R,t[5]=(-s*n+i*o)*R,t[6]=P*R,t[7]=(-d*n+r*u)*R,t[8]=(a*n-r*o)*R,t):null}function nbe(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],d=t[8];return e*(d*o-a*u)+n*(-d*i+a*s)+r*(u*i-o*s)}function p$(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],d=e[6],g=e[7],_=e[8],E=n[0],P=n[1],R=n[2],B=n[3],V=n[4],z=n[5],F=n[6],k=n[7],X=n[8];return t[0]=E*r+P*a+R*d,t[1]=E*i+P*s+R*g,t[2]=E*o+P*u+R*_,t[3]=B*r+V*a+z*d,t[4]=B*i+V*s+z*g,t[5]=B*o+V*u+z*_,t[6]=F*r+k*a+X*d,t[7]=F*i+k*s+X*g,t[8]=F*o+k*u+X*_,t}function rbe(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],d=e[6],g=e[7],_=e[8],E=n[0],P=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=E*r+P*a+d,t[7]=E*i+P*s+g,t[8]=E*o+P*u+_,t}function ibe(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],d=e[6],g=e[7],_=e[8],E=Math.sin(n),P=Math.cos(n);return t[0]=P*r+E*a,t[1]=P*i+E*s,t[2]=P*o+E*u,t[3]=P*a-E*r,t[4]=P*s-E*i,t[5]=P*u-E*o,t[6]=d,t[7]=g,t[8]=_,t}function g$(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function obe(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,d=n*a,g=r*a,_=r*s,E=i*a,P=i*s,R=i*u,B=o*a,V=o*s,z=o*u;return t[0]=1-_-R,t[3]=g-z,t[6]=E+V,t[1]=g+z,t[4]=1-d-R,t[7]=P-B,t[2]=E-V,t[5]=P+B,t[8]=1-d-_,t}var LF;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(LF||(LF={}));const sbe=Object.freeze([1,0,0,0,1,0,0,0,1]);class is extends Dte{static get IDENTITY(){return lbe()}static get ZERO(){return abe()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return LF}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(sbe)}fromObject(e){return this.check()}fromQuaternion(e){return obe(this,e),this.check()}set(e,n,r,i,o,a,s,u,d){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=o,this[5]=a,this[6]=s,this[7]=u,this[8]=d,this.check()}setRowMajor(e,n,r,i,o,a,s,u,d){return this[0]=e,this[1]=i,this[2]=s,this[3]=n,this[4]=o,this[5]=u,this[6]=r,this[7]=a,this[8]=d,this.check()}determinant(){return nbe(this)}transpose(){return ebe(this,this),this.check()}invert(){return tbe(this,this),this.check()}multiplyLeft(e){return p$(this,e,this),this.check()}multiplyRight(e){return p$(this,this,e),this.check()}rotate(e){return ibe(this,this,e),this.check()}scale(e){return Array.isArray(e)?g$(this,this,e):g$(this,this,[e,e]),this.check()}translate(e){return rbe(this,this,e),this.check()}transform(e,n){let r;switch(e.length){case 2:r=Ete(n||[-0,-0],e,this);break;case 3:r=Mte(n||[-0,-0,-0],e,this);break;case 4:r=Pte(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return cw(r,e.length),r}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let MS,OS;function abe(){return MS||(MS=new is([0,0,0,0,0,0,0,0,0]),Object.freeze(MS)),MS}function lbe(){return OS||(OS=new is,Object.freeze(OS)),OS}function ube(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cbe(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function eI(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],d=e[7],g=e[8],_=e[9],E=e[10],P=e[11],R=e[12],B=e[13],V=e[14],z=e[15],F=n*s-r*a,k=n*u-i*a,X=n*d-o*a,Y=r*u-i*s,J=r*d-o*s,ie=i*d-o*u,ce=g*B-_*R,re=g*V-E*R,ue=g*z-P*R,se=_*V-E*B,me=_*z-P*B,Ce=E*z-P*V,be=F*Ce-k*me+X*se+Y*ue-J*re+ie*ce;return be?(be=1/be,t[0]=(s*Ce-u*me+d*se)*be,t[1]=(i*me-r*Ce-o*se)*be,t[2]=(B*ie-V*J+z*Y)*be,t[3]=(E*J-_*ie-P*Y)*be,t[4]=(u*ue-a*Ce-d*re)*be,t[5]=(n*Ce-i*ue+o*re)*be,t[6]=(V*X-R*ie-z*k)*be,t[7]=(g*ie-E*X+P*k)*be,t[8]=(a*me-s*ue+d*ce)*be,t[9]=(r*ue-n*me-o*ce)*be,t[10]=(R*J-B*X+z*F)*be,t[11]=(_*X-g*J-P*F)*be,t[12]=(s*re-a*se-u*ce)*be,t[13]=(n*se-r*re+i*ce)*be,t[14]=(B*k-R*Y-V*F)*be,t[15]=(g*Y-_*k+E*F)*be,t):null}function fbe(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],d=t[8],g=t[9],_=t[10],E=t[11],P=t[12],R=t[13],B=t[14],V=t[15],z=e*a-n*o,F=e*s-r*o,k=e*u-i*o,X=n*s-r*a,Y=n*u-i*a,J=r*u-i*s,ie=d*R-g*P,ce=d*B-_*P,re=d*V-E*P,ue=g*B-_*R,se=g*V-E*R,me=_*V-E*B;return z*me-F*se+k*ue+X*re-Y*ce+J*ie}function kd(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],d=e[6],g=e[7],_=e[8],E=e[9],P=e[10],R=e[11],B=e[12],V=e[13],z=e[14],F=e[15],k=n[0],X=n[1],Y=n[2],J=n[3];return t[0]=k*r+X*s+Y*_+J*B,t[1]=k*i+X*u+Y*E+J*V,t[2]=k*o+X*d+Y*P+J*z,t[3]=k*a+X*g+Y*R+J*F,k=n[4],X=n[5],Y=n[6],J=n[7],t[4]=k*r+X*s+Y*_+J*B,t[5]=k*i+X*u+Y*E+J*V,t[6]=k*o+X*d+Y*P+J*z,t[7]=k*a+X*g+Y*R+J*F,k=n[8],X=n[9],Y=n[10],J=n[11],t[8]=k*r+X*s+Y*_+J*B,t[9]=k*i+X*u+Y*E+J*V,t[10]=k*o+X*d+Y*P+J*z,t[11]=k*a+X*g+Y*R+J*F,k=n[12],X=n[13],Y=n[14],J=n[15],t[12]=k*r+X*s+Y*_+J*B,t[13]=k*i+X*u+Y*E+J*V,t[14]=k*o+X*d+Y*P+J*z,t[15]=k*a+X*g+Y*R+J*F,t}function zw(t,e,n){var r=n[0],i=n[1],o=n[2],a,s,u,d,g,_,E,P,R,B,V,z;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*o+e[12],t[13]=e[1]*r+e[5]*i+e[9]*o+e[13],t[14]=e[2]*r+e[6]*i+e[10]*o+e[14],t[15]=e[3]*r+e[7]*i+e[11]*o+e[15]):(a=e[0],s=e[1],u=e[2],d=e[3],g=e[4],_=e[5],E=e[6],P=e[7],R=e[8],B=e[9],V=e[10],z=e[11],t[0]=a,t[1]=s,t[2]=u,t[3]=d,t[4]=g,t[5]=_,t[6]=E,t[7]=P,t[8]=R,t[9]=B,t[10]=V,t[11]=z,t[12]=a*r+g*i+R*o+e[12],t[13]=s*r+_*i+B*o+e[13],t[14]=u*r+E*i+V*o+e[14],t[15]=d*r+P*i+z*o+e[15]),t}function FO(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function hbe(t,e,n,r){var i=r[0],o=r[1],a=r[2],s=Math.hypot(i,o,a),u,d,g,_,E,P,R,B,V,z,F,k,X,Y,J,ie,ce,re,ue,se,me,Ce,be,Ye;return s<Es?null:(s=1/s,i*=s,o*=s,a*=s,u=Math.sin(n),d=Math.cos(n),g=1-d,_=e[0],E=e[1],P=e[2],R=e[3],B=e[4],V=e[5],z=e[6],F=e[7],k=e[8],X=e[9],Y=e[10],J=e[11],ie=i*i*g+d,ce=o*i*g+a*u,re=a*i*g-o*u,ue=i*o*g-a*u,se=o*o*g+d,me=a*o*g+i*u,Ce=i*a*g+o*u,be=o*a*g-i*u,Ye=a*a*g+d,t[0]=_*ie+B*ce+k*re,t[1]=E*ie+V*ce+X*re,t[2]=P*ie+z*ce+Y*re,t[3]=R*ie+F*ce+J*re,t[4]=_*ue+B*se+k*me,t[5]=E*ue+V*se+X*me,t[6]=P*ue+z*se+Y*me,t[7]=R*ue+F*se+J*me,t[8]=_*Ce+B*be+k*Ye,t[9]=E*Ce+V*be+X*Ye,t[10]=P*Ce+z*be+Y*Ye,t[11]=R*Ce+F*be+J*Ye,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Bte(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],d=e[8],g=e[9],_=e[10],E=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+d*r,t[5]=a*i+g*r,t[6]=s*i+_*r,t[7]=u*i+E*r,t[8]=d*i-o*r,t[9]=g*i-a*r,t[10]=_*i-s*r,t[11]=E*i-u*r,t}function dbe(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],d=e[8],g=e[9],_=e[10],E=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-d*r,t[1]=a*i-g*r,t[2]=s*i-_*r,t[3]=u*i-E*r,t[8]=o*r+d*i,t[9]=a*r+g*i,t[10]=s*r+_*i,t[11]=u*r+E*i,t}function Nte(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],d=e[4],g=e[5],_=e[6],E=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+d*r,t[1]=a*i+g*r,t[2]=s*i+_*r,t[3]=u*i+E*r,t[4]=d*i-o*r,t[5]=g*i-a*r,t[6]=_*i-s*r,t[7]=E*i-u*r,t}function pbe(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],d=e[9],g=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,d,g),t}function gbe(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,d=n*a,g=r*a,_=r*s,E=i*a,P=i*s,R=i*u,B=o*a,V=o*s,z=o*u;return t[0]=1-_-R,t[1]=g+z,t[2]=E-V,t[3]=0,t[4]=g-z,t[5]=1-d-R,t[6]=P+B,t[7]=0,t[8]=E+V,t[9]=P-B,t[10]=1-d-_,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mbe(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),d=1/(o-a);return t[0]=o*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o*2*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*d,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*d,t[15]=0,t}function Abe(t,e,n,r,i){var o=1/Math.tan(e/2),a;return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(a=1/(r-i),t[10]=(i+r)*a,t[14]=2*i*r*a):(t[10]=-1,t[14]=-2*r),t}var Fte=Abe;function _be(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),d=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*d,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*d,t[15]=1,t}var ybe=_be;function vbe(t,e,n,r){var i,o,a,s,u,d,g,_,E,P,R=e[0],B=e[1],V=e[2],z=r[0],F=r[1],k=r[2],X=n[0],Y=n[1],J=n[2];return Math.abs(R-X)<Es&&Math.abs(B-Y)<Es&&Math.abs(V-J)<Es?ube(t):(g=R-X,_=B-Y,E=V-J,P=1/Math.hypot(g,_,E),g*=P,_*=P,E*=P,i=F*E-k*_,o=k*g-z*E,a=z*_-F*g,P=Math.hypot(i,o,a),P?(P=1/P,i*=P,o*=P,a*=P):(i=0,o=0,a=0),s=_*a-E*o,u=E*i-g*a,d=g*o-_*i,P=Math.hypot(s,u,d),P?(P=1/P,s*=P,u*=P,d*=P):(s=0,u=0,d=0),t[0]=i,t[1]=s,t[2]=g,t[3]=0,t[4]=o,t[5]=u,t[6]=_,t[7]=0,t[8]=a,t[9]=d,t[10]=E,t[11]=0,t[12]=-(i*R+o*B+a*V),t[13]=-(s*R+u*B+d*V),t[14]=-(g*R+_*B+E*V),t[15]=1,t)}function m$(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],d=t[7],g=t[8],_=t[9],E=t[10],P=t[11],R=t[12],B=t[13],V=t[14],z=t[15],F=e[0],k=e[1],X=e[2],Y=e[3],J=e[4],ie=e[5],ce=e[6],re=e[7],ue=e[8],se=e[9],me=e[10],Ce=e[11],be=e[12],Ye=e[13],tt=e[14],pt=e[15];return Math.abs(n-F)<=Es*Math.max(1,Math.abs(n),Math.abs(F))&&Math.abs(r-k)<=Es*Math.max(1,Math.abs(r),Math.abs(k))&&Math.abs(i-X)<=Es*Math.max(1,Math.abs(i),Math.abs(X))&&Math.abs(o-Y)<=Es*Math.max(1,Math.abs(o),Math.abs(Y))&&Math.abs(a-J)<=Es*Math.max(1,Math.abs(a),Math.abs(J))&&Math.abs(s-ie)<=Es*Math.max(1,Math.abs(s),Math.abs(ie))&&Math.abs(u-ce)<=Es*Math.max(1,Math.abs(u),Math.abs(ce))&&Math.abs(d-re)<=Es*Math.max(1,Math.abs(d),Math.abs(re))&&Math.abs(g-ue)<=Es*Math.max(1,Math.abs(g),Math.abs(ue))&&Math.abs(_-se)<=Es*Math.max(1,Math.abs(_),Math.abs(se))&&Math.abs(E-me)<=Es*Math.max(1,Math.abs(E),Math.abs(me))&&Math.abs(P-Ce)<=Es*Math.max(1,Math.abs(P),Math.abs(Ce))&&Math.abs(R-be)<=Es*Math.max(1,Math.abs(R),Math.abs(be))&&Math.abs(B-Ye)<=Es*Math.max(1,Math.abs(B),Math.abs(Ye))&&Math.abs(V-tt)<=Es*Math.max(1,Math.abs(V),Math.abs(tt))&&Math.abs(z-pt)<=Es*Math.max(1,Math.abs(z),Math.abs(pt))}function xbe(){var t=new Eh(4);return Eh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function bbe(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function w5(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function wbe(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function Ebe(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function Sbe(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t}function Tbe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Cbe(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t}function O1(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}function Pbe(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2],d=n[3],g=d*r+s*o-u*i,_=d*i+u*r-a*o,E=d*o+a*i-s*r,P=-a*r-s*i-u*o;return t[0]=g*d+P*-a+_*-u-E*-s,t[1]=_*d+P*-s+E*-a-g*-u,t[2]=E*d+P*-u+g*-s-_*-a,t[3]=e[3],t}(function(){var t=xbe();return function(e,n,r,i,o,a){var s,u;for(n||(n=4),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();var DF;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(DF||(DF={}));const Ibe=45*Math.PI/180,Mbe=1,WD=.1,qD=500,Obe=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class vr extends Dte{static get IDENTITY(){return Lbe()}static get ZERO(){return Rbe()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return DF}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,o,a,s,u,d,g,_,E,P,R,B,V){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=o,this[5]=a,this[6]=s,this[7]=u,this[8]=d,this[9]=g,this[10]=_,this[11]=E,this[12]=P,this[13]=R,this[14]=B,this[15]=V,this.check()}setRowMajor(e,n,r,i,o,a,s,u,d,g,_,E,P,R,B,V){return this[0]=e,this[1]=o,this[2]=d,this[3]=P,this[4]=n,this[5]=a,this[6]=g,this[7]=R,this[8]=r,this[9]=s,this[10]=_,this[11]=B,this[12]=i,this[13]=u,this[14]=E,this[15]=V,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Obe)}fromObject(e){return this.check()}fromQuaternion(e){return gbe(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:o,near:a=WD,far:s=qD}=e;return s===1/0?Dbe(this,n,r,i,o,a):mbe(this,n,r,i,o,a,s),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return vbe(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:o,near:a=WD,far:s=qD}=e;return ybe(this,n,r,i,o,a,s),this.check()}orthographic(e){const{fovy:n=Ibe,aspect:r=Mbe,focalDistance:i=1,near:o=WD,far:a=qD}=e;A$(n);const s=n/2,u=i*Math.tan(s),d=u*r;return this.ortho({left:-d,right:d,bottom:-u,top:u,near:o,far:a})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:o=500}=e;return A$(n),Fte(this,n,r,i,o),this.check()}determinant(){return fbe(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],o=1/r[1],a=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*o,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*o,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],o=1/r[1],a=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*a,e[3]=this[4]*i,e[4]=this[5]*o,e[5]=this[6]*a,e[6]=this[8]*i,e[7]=this[9]*o,e[8]=this[10]*a,e}transpose(){return cbe(this,this),this.check()}invert(){return eI(this,this),this.check()}multiplyLeft(e){return kd(this,e,this),this.check()}multiplyRight(e){return kd(this,this,e),this.check()}rotateX(e){return Bte(this,this,e),this.check()}rotateY(e){return dbe(this,this,e),this.check()}rotateZ(e){return Nte(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return hbe(this,this,e,n),this.check()}scale(e){return FO(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return zw(this,this,e),this.check()}transform(e,n){return e.length===4?(n=O1(n||[-0,-0,-0,-0],e,this),cw(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=Ste(n||[-0,-0],e,this);break;case 3:i=b5(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return cw(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=Tte(n||[-0,-0],e,this);break;case 3:r=Cte(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return cw(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let RS,LS;function Rbe(){return RS||(RS=new vr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(RS)),RS}function Lbe(){return LS||(LS=new vr,Object.freeze(LS)),LS}function A$(t){if(t>Math.PI*2)throw Error("expected radians")}function Dbe(t,e,n,r,i,o){const a=2*o/(n-e),s=2*o/(i-r),u=(n+e)/(n-e),d=(i+r)/(i-r),g=-1,_=-1,E=-2*o;return t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=d,t[10]=g,t[11]=_,t[12]=0,t[13]=0,t[14]=E,t[15]=0,t}function _$(){var t=new Eh(4);return Eh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Bbe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function kte(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function y$(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],d=n[2],g=n[3];return t[0]=r*g+a*s+i*d-o*u,t[1]=i*g+a*u+o*s-r*d,t[2]=o*g+a*d+r*u-i*s,t[3]=a*g-r*s-i*u-o*d,t}function Nbe(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*s,t[1]=i*u+o*s,t[2]=o*u-i*s,t[3]=a*u-r*s,t}function Fbe(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-o*s,t[1]=i*u+a*s,t[2]=o*u+r*s,t[3]=a*u-i*s,t}function kbe(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=o*u+a*s,t[3]=a*u-o*s,t}function zbe(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function iC(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=n[0],d=n[1],g=n[2],_=n[3],E,P,R,B,V;return P=i*u+o*d+a*g+s*_,P<0&&(P=-P,u=-u,d=-d,g=-g,_=-_),1-P>Es?(E=Math.acos(P),R=Math.sin(E),B=Math.sin((1-r)*E)/R,V=Math.sin(r*E)/R):(B=1-r,V=r),t[0]=B*i+V*u,t[1]=B*o+V*d,t[2]=B*a+V*g,t[3]=B*s+V*_,t}function Ube(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=o*s,t}function Gbe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function zte(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[o*3+o]-e[a*3+a]+1),t[i]=.5*r,r=.5/r,t[3]=(e[o*3+a]-e[a*3+o])*r,t[o]=(e[o*3+i]+e[i*3+o])*r,t[a]=(e[a*3+i]+e[i*3+a])*r}return t}var jbe=bbe,Vbe=w5,$be=Tbe,Hbe=Cbe,Wbe=wbe,qbe=Ebe,Ute=Sbe,Xbe=function(){var t=Ite(),e=d$(1,0,0),n=d$(0,1,0);return function(r,i,o){var a=x5(i,o);return a<-.999999?(rC(t,e,i),Lte(t)<1e-6&&rC(t,n,i),Wxe(t,t),kte(r,t,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(rC(t,i,o),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+a,Ute(r,r))}}();(function(){var t=_$(),e=_$();return function(n,r,i,o,a,s){return iC(t,r,a,s),iC(e,i,o,s),iC(n,t,e,2*s*(1-s)),n}})();(function(){var t=Jxe();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],Ute(e,zte(e,t))}})();const Zbe=[0,0,0,1];class Zm extends DO{constructor(e=0,n=0,r=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,r,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,r,i){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return zte(this,e),this.check()}fromAxisRotation(e,n){return kte(this,e,n),this.check()}identity(){return Bbe(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Ur(e)}get y(){return this[1]}set y(e){this[1]=Ur(e)}get z(){return this[2]}set z(e){this[2]=Ur(e)}get w(){return this[3]}set w(e){this[3]=Ur(e)}len(){return Wbe(this)}lengthSquared(){return qbe(this)}dot(e){return $be(this,e)}rotationTo(e,n){return Xbe(this,e,n),this.check()}add(e){return jbe(this,this,e),this.check()}calculateW(){return zbe(this,this),this.check()}conjugate(){return Gbe(this,this),this.check()}invert(){return Ube(this,this),this.check()}lerp(e,n,r){return r===void 0?this.lerp(this,e,n):(Hbe(this,e,n,r),this.check())}multiplyRight(e){return y$(this,this,e),this.check()}multiplyLeft(e){return y$(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return Nbe(this,this,e),this.check()}rotateY(e){return Fbe(this,this,e),this.check()}rotateZ(e){return kbe(this,this,e),this.check()}scale(e){return Vbe(this,this,e),this.check()}slerp(e,n,r){let i,o,a;switch(arguments.length){case 1:({start:i=Zbe,target:o,ratio:a}=e);break;case 2:i=this,o=e,a=n;break;default:i=e,o=n,a=r}return iC(this,i,o,a),this.check()}transformVector4(e,n=new NO){return Pbe(n,e,this),cw(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const v$=1e-6,Ybe=6371e3;class Nv{constructor({phi:e=0,theta:n=0,radius:r=1,bearing:i,pitch:o,altitude:a,radiusScale:s=Ybe}={}){q(this,"phi",void 0),q(this,"theta",void 0),q(this,"radius",void 0),q(this,"radiusScale",void 0),this.phi=e,this.theta=n,this.radius=r||a||1,this.radiusScale=s||1,i!==void 0&&(this.bearing=i),o!==void 0&&(this.pitch=o),this.check()}toString(){return this.formatString(fo)}formatString({printTypes:e=!1}){const n=A5;return"".concat(e?"Spherical":"","[rho:").concat(n(this.radius),",theta:").concat(n(this.theta),",phi:").concat(n(this.phi),"]")}equals(e){return Sl(this.radius,e.radius)&&Sl(this.theta,e.theta)&&Sl(this.phi,e.phi)}exactEquals(e){return this.radius===e.radius&&this.theta===e.theta&&this.phi===e.phi}get bearing(){return 180-bl(this.phi)}set bearing(e){this.phi=Math.PI-Jy(e)}get pitch(){return bl(this.theta)}set pitch(e){this.theta=Jy(e)}get longitude(){return bl(this.phi)}get latitude(){return bl(this.theta)}get lng(){return bl(this.phi)}get lat(){return bl(this.theta)}get z(){return(this.radius-1)*this.radiusScale}set(e,n,r){return this.radius=e,this.phi=n,this.theta=r,this.check()}clone(){return new Nv().copy(this)}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this.check()}fromLngLatZ([e,n,r]){return this.radius=1+r/this.radiusScale,this.phi=Jy(n),this.theta=Jy(e),this.check()}fromVector3(e){return this.radius=v5(e),this.radius>0&&(this.theta=Math.atan2(e[0],e[1]),this.phi=Math.acos(Wi(e[2]/this.radius,-1,1))),this.check()}toVector3(){return new yt(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}makeSafe(){return this.phi=Math.max(v$,Math.min(Math.PI-v$,this.phi)),this}check(){if(!Number.isFinite(this.phi)||!Number.isFinite(this.theta)||!(this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}const oC="Unknown Euler angle order",my=.99999;var ta;(function(t){t[t.ZYX=0]="ZYX",t[t.YXZ=1]="YXZ",t[t.XZY=2]="XZY",t[t.ZXY=3]="ZXY",t[t.YZX=4]="YZX",t[t.XYZ=5]="XYZ"})(ta||(ta={}));class ms extends DO{static get ZYX(){return ta.ZYX}static get YXZ(){return ta.YXZ}static get XZY(){return ta.XZY}static get ZXY(){return ta.ZXY}static get YZX(){return ta.YZX}static get XYZ(){return ta.XYZ}static get RollPitchYaw(){return ta.ZYX}static get DefaultOrder(){return ta.ZYX}static get RotationOrders(){return ta}static rotationOrder(e){return ta[e]}get ELEMENTS(){return 4}constructor(e=0,n=0,r=0,i=ms.DefaultOrder){super(-0,-0,-0,-0),arguments.length>0&&Array.isArray(arguments[0])?this.fromVector3(...arguments):this.set(e,n,r,i)}fromQuaternion(e){const[n,r,i,o]=e,a=r*r,s=-2*(a+i*i)+1,u=2*(n*r+o*i);let d=-2*(n*i-o*r);const g=2*(r*i+o*n),_=-2*(n*n+a)+1;d=d>1?1:d,d=d<-1?-1:d;const E=Math.atan2(g,_),P=Math.asin(d),R=Math.atan2(u,s);return this.set(E,P,R,ms.RollPitchYaw)}fromObject(e){throw new Error("not implemented")}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=Number.isFinite(e[3])||this.order,this.check()}set(e=0,n=0,r=0,i){return this[0]=e,this[1]=n,this[2]=r,this[3]=Number.isFinite(i)?i:this[3],this.check()}validate(){return Qbe(this[3])&&Number.isFinite(this[0])&&Number.isFinite(this[1])&&Number.isFinite(this[2])}toArray(e=[],n=0){return e[n]=this[0],e[n+1]=this[1],e[n+2]=this[2],e}toArray4(e=[],n=0){return e[n]=this[0],e[n+1]=this[1],e[n+2]=this[2],e[n+3]=this[3],e}toVector3(e=[-0,-0,-0]){return e[0]=this[0],e[1]=this[1],e[2]=this[2],e}get x(){return this[0]}set x(e){this[0]=Ur(e)}get y(){return this[1]}set y(e){this[1]=Ur(e)}get z(){return this[2]}set z(e){this[2]=Ur(e)}get alpha(){return this[0]}set alpha(e){this[0]=Ur(e)}get beta(){return this[1]}set beta(e){this[1]=Ur(e)}get gamma(){return this[2]}set gamma(e){this[2]=Ur(e)}get phi(){return this[0]}set phi(e){this[0]=Ur(e)}get theta(){return this[1]}set theta(e){this[1]=Ur(e)}get psi(){return this[2]}set psi(e){this[2]=Ur(e)}get roll(){return this[0]}set roll(e){this[0]=Ur(e)}get pitch(){return this[1]}set pitch(e){this[1]=Ur(e)}get yaw(){return this[2]}set yaw(e){this[2]=Ur(e)}get order(){return this[3]}set order(e){this[3]=Kbe(e)}fromVector3(e,n){return this.set(e[0],e[1],e[2],Number.isFinite(n)?n:this[3])}fromArray(e,n=0){return this[0]=e[0+n],this[1]=e[1+n],this[2]=e[2+n],e[3]!==void 0&&(this[3]=e[3]),this.check()}fromRollPitchYaw(e,n,r){return this.set(e,n,r,ta.ZYX)}fromRotationMatrix(e,n=ms.DefaultOrder){return this._fromRotationMatrix(e,n),this.check()}getRotationMatrix(e){return this._getRotationMatrix(e)}getQuaternion(){const e=new Zm;switch(this[4]){case ta.XYZ:return e.rotateX(this[0]).rotateY(this[1]).rotateZ(this[2]);case ta.YXZ:return e.rotateY(this[0]).rotateX(this[1]).rotateZ(this[2]);case ta.ZXY:return e.rotateZ(this[0]).rotateX(this[1]).rotateY(this[2]);case ta.ZYX:return e.rotateZ(this[0]).rotateY(this[1]).rotateX(this[2]);case ta.YZX:return e.rotateY(this[0]).rotateZ(this[1]).rotateX(this[2]);case ta.XZY:return e.rotateX(this[0]).rotateZ(this[1]).rotateY(this[2]);default:throw new Error(oC)}}_fromRotationMatrix(e,n=ms.DefaultOrder){const r=e[0],i=e[4],o=e[8],a=e[1],s=e[5],u=e[9],d=e[2],g=e[6],_=e[10];switch(n=n||this[3],n){case ms.XYZ:this[1]=Math.asin(Wi(o,-1,1)),Math.abs(o)<my?(this[0]=Math.atan2(-u,_),this[2]=Math.atan2(-i,r)):(this[0]=Math.atan2(g,s),this[2]=0);break;case ms.YXZ:this[0]=Math.asin(-Wi(u,-1,1)),Math.abs(u)<my?(this[1]=Math.atan2(o,_),this[2]=Math.atan2(a,s)):(this[1]=Math.atan2(-d,r),this[2]=0);break;case ms.ZXY:this[0]=Math.asin(Wi(g,-1,1)),Math.abs(g)<my?(this[1]=Math.atan2(-d,_),this[2]=Math.atan2(-i,s)):(this[1]=0,this[2]=Math.atan2(a,r));break;case ms.ZYX:this[1]=Math.asin(-Wi(d,-1,1)),Math.abs(d)<my?(this[0]=Math.atan2(g,_),this[2]=Math.atan2(a,r)):(this[0]=0,this[2]=Math.atan2(-i,s));break;case ms.YZX:this[2]=Math.asin(Wi(a,-1,1)),Math.abs(a)<my?(this[0]=Math.atan2(-u,s),this[1]=Math.atan2(-d,r)):(this[0]=0,this[1]=Math.atan2(o,_));break;case ms.XZY:this[2]=Math.asin(-Wi(i,-1,1)),Math.abs(i)<my?(this[0]=Math.atan2(g,s),this[1]=Math.atan2(o,r)):(this[0]=Math.atan2(-u,_),this[1]=0);break;default:throw new Error(oC)}return this[3]=n,this}_getRotationMatrix(e){const n=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=this.x,i=this.y,o=this.z,a=Math.cos(r),s=Math.cos(i),u=Math.cos(o),d=Math.sin(r),g=Math.sin(i),_=Math.sin(o);switch(this[3]){case ms.XYZ:{const E=a*u,P=a*_,R=d*u,B=d*_;n[0]=s*u,n[4]=-s*_,n[8]=g,n[1]=P+R*g,n[5]=E-B*g,n[9]=-d*s,n[2]=B-E*g,n[6]=R+P*g,n[10]=a*s;break}case ms.YXZ:{const E=s*u,P=s*_,R=g*u,B=g*_;n[0]=E+B*d,n[4]=R*d-P,n[8]=a*g,n[1]=a*_,n[5]=a*u,n[9]=-d,n[2]=P*d-R,n[6]=B+E*d,n[10]=a*s;break}case ms.ZXY:{const E=s*u,P=s*_,R=g*u,B=g*_;n[0]=E-B*d,n[4]=-a*_,n[8]=R+P*d,n[1]=P+R*d,n[5]=a*u,n[9]=B-E*d,n[2]=-a*g,n[6]=d,n[10]=a*s;break}case ms.ZYX:{const E=a*u,P=a*_,R=d*u,B=d*_;n[0]=s*u,n[4]=R*g-P,n[8]=E*g+B,n[1]=s*_,n[5]=B*g+E,n[9]=P*g-R,n[2]=-g,n[6]=d*s,n[10]=a*s;break}case ms.YZX:{const E=a*s,P=a*g,R=d*s,B=d*g;n[0]=s*u,n[4]=B-E*_,n[8]=R*_+P,n[1]=_,n[5]=a*u,n[9]=-d*u,n[2]=-g*u,n[6]=P*_+R,n[10]=E-B*_;break}case ms.XZY:{const E=a*s,P=a*g,R=d*s,B=d*g;n[0]=s*u,n[4]=-_,n[8]=g*u,n[1]=E*_+B,n[5]=a*u,n[9]=P*_-R,n[2]=R*_-P,n[6]=d*u,n[10]=B*_+E;break}default:throw new Error(oC)}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}toQuaternion(){const e=Math.cos(this.yaw*.5),n=Math.sin(this.yaw*.5),r=Math.cos(this.roll*.5),i=Math.sin(this.roll*.5),o=Math.cos(this.pitch*.5),a=Math.sin(this.pitch*.5),s=e*r*o+n*i*a,u=e*i*o-n*r*a,d=e*r*a+n*i*o,g=n*r*o-e*i*a;return new Zm(u,d,g,s)}}function Qbe(t){return t>=0&&t<6}function Kbe(t){if(t<0&&t>=6)throw new Error(oC);return t}class x${constructor({x:e=0,y:n=0,z:r=0,roll:i=0,pitch:o=0,yaw:a=0,position:s,orientation:u}={}){q(this,"position",void 0),q(this,"orientation",void 0),Array.isArray(s)&&s.length===3?this.position=new yt(s):this.position=new yt(e,n,r),Array.isArray(u)&&u.length===4?this.orientation=new ms(u,u[3]):this.orientation=new ms(i,o,a,ms.RollPitchYaw)}get x(){return this.position.x}set x(e){this.position.x=e}get y(){return this.position.y}set y(e){this.position.y=e}get z(){return this.position.z}set z(e){this.position.z=e}get roll(){return this.orientation.roll}set roll(e){this.orientation.roll=e}get pitch(){return this.orientation.pitch}set pitch(e){this.orientation.pitch=e}get yaw(){return this.orientation.yaw}set yaw(e){this.orientation.yaw=e}getPosition(){return this.position}getOrientation(){return this.orientation}equals(e){return e?this.position.equals(e.position)&&this.orientation.equals(e.orientation):!1}exactEquals(e){return e?this.position.exactEquals(e.position)&&this.orientation.exactEquals(e.orientation):!1}getTransformationMatrix(){const e=Math.sin(this.roll),n=Math.sin(this.pitch),r=Math.sin(this.yaw),i=Math.cos(this.roll),o=Math.cos(this.pitch),a=Math.cos(this.yaw);return new vr().setRowMajor(a*o,-r*i+a*n*e,r*e+a*n*i,this.x,r*o,a*i+r*n*e,-a*e+r*n*i,this.y,-n,o*e,o*i,this.z,0,0,0,1)}getTransformationMatrixFromPose(e){return new vr().multiplyRight(this.getTransformationMatrix()).multiplyRight(e.getTransformationMatrix().invert())}getTransformationMatrixToPose(e){return new vr().multiplyRight(e.getTransformationMatrix()).multiplyRight(this.getTransformationMatrix().invert())}}const Fv={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},XD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Jbe={modelMatrix:XD,viewMatrix:XD,projectionMatrix:XD,cameraPositionWorld:[0,0,0]};function ewe(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Jbe;const e={};return t.modelMatrix!==void 0&&(e.modelMatrix=t.modelMatrix),t.viewMatrix!==void 0&&(e.viewMatrix=t.viewMatrix),t.projectionMatrix!==void 0&&(e.projectionMatrix=t.projectionMatrix),t.cameraPositionWorld!==void 0&&(e.cameraPositionWorld=t.cameraPositionWorld),(t.projectionMatrix!==void 0||t.viewMatrix!==void 0)&&(e.viewProjectionMatrix=new vr(t.projectionMatrix).multiplyRight(t.viewMatrix)),e}const Gte=`varying vec4 project_vPositionWorld;
varying vec3 project_vNormalWorld;

vec4 project_getPosition_World() {
  return project_vPositionWorld;
}

vec3 project_getNormal_World() {
  return project_vNormalWorld;
}
`,twe="".concat(Gte,`
uniform mat4 modelMatrix;
uniform mat4 viewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewProjectionMatrix;
uniform vec3 cameraPositionWorld;

struct World {
  vec3 position;
  vec3 normal;
};

World world;

void project_setPosition(vec4 position) {
  project_vPositionWorld = position;
}

void project_setNormal(vec3 normal) {
  project_vNormalWorld = normal;
}

void project_setPositionAndNormal_World(vec3 position, vec3 normal) {
  world.position = position;
  world.normal = normal;
}

void project_setPositionAndNormal_Model(vec3 position, vec3 normal) {
  world.position = (modelMatrix * vec4(position, 1.)).xyz;
  world.normal = mat3(modelMatrix) * normal;
}

vec4 project_model_to_clipspace(vec4 position) {
  return viewProjectionMatrix * modelMatrix * position;
}

vec4 project_model_to_clipspace(vec3 position) {
  return viewProjectionMatrix * modelMatrix * vec4(position, 1.);
}

vec4 project_world_to_clipspace(vec3 position) {
  return viewProjectionMatrix * vec4(position, 1.);
}

vec4 project_view_to_clipspace(vec3 position) {
  return projectionMatrix * vec4(position, 1.);
}

vec4 project_to_clipspace(vec3 position) {
  return viewProjectionMatrix * vec4(position, 1.);
}
`),nwe=`
`.concat(Gte),jte={name:"project",getUniforms:ewe,vs:twe,fs:nwe},b$=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,rwe={lightSources:{}};function ZD(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function iwe(t){let{ambientLight:e,pointLights:n=[],directionalLights:r=[]}=t;const i={};return e?i["lighting_uAmbientLight.color"]=ZD(e):i["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((o,a)=>{i["lighting_uPointLight[".concat(a,"].color")]=ZD(o),i["lighting_uPointLight[".concat(a,"].position")]=o.position,i["lighting_uPointLight[".concat(a,"].attenuation")]=o.attenuation||[1,0,0]}),i.lighting_uPointLightCount=n.length,r.forEach((o,a)=>{i["lighting_uDirectionalLight[".concat(a,"].color")]=ZD(o),i["lighting_uDirectionalLight[".concat(a,"].direction")]=o.direction}),i.lighting_uDirectionalLightCount=r.length,i}function Vte(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:rwe;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:r}=t.lightSources||{};return e||n&&n.length>0||r&&r.length>0?Object.assign({},iwe({ambientLight:e,pointLights:n,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return Vte({lightSources:e})}return{}}const E5={name:"lights",vs:b$,fs:b$,getUniforms:Vte,defines:{MAX_LIGHTS:3}},owe=new Float32Array([1,1,2]),swe={lightDirection:owe};function awe(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:swe;const e={};return t.lightDirection&&(e.dirlight_uLightDirection=t.lightDirection),e}const lwe=null,uwe=`uniform vec3 dirlight_uLightDirection;
vec4 dirlight_filterColor(vec4 color) {
  vec3 normal = project_getNormal_World();
  float d = abs(dot(normalize(normal), normalize(dirlight_uLightDirection)));
  return vec4(color.rgb * d, color.a);
}
`,cwe={name:"dirlight",vs:lwe,fs:uwe,getUniforms:awe,dependencies:[jte]},fwe=new Uint8Array([0,255,255,255]),hwe={pickingSelectedColor:null,pickingHighlightColor:fwe,pickingActive:!1,pickingAttribute:!1};function dwe(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:hwe;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const pwe=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,gwe=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,$te={name:"picking",vs:pwe,fs:gwe,getUniforms:dwe},Hte=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,mwe={};function Awe(t){const{ambient:e=.35,diffuse:n=.6,shininess:r=32,specularColor:i=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:r,lighting_uSpecularColor:i.map(o=>o/255)}}function Wte(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:mwe;if(!("material"in t))return{};const{material:e}=t;return e?Awe(e):{lighting_uEnabled:!1}}const DE={name:"gouraud-lighting",dependencies:[E5],vs:Hte,defines:{LIGHTING_VERTEX:1},getUniforms:Wte},kO={name:"phong-lighting",dependencies:[E5],fs:Hte,defines:{LIGHTING_FRAGMENT:1},getUniforms:Wte},_we=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,ywe=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,zO={name:"pbr",vs:_we,fs:ywe,defines:{LIGHTING_FRAGMENT:1},dependencies:[E5]},vwe=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,xwe={name:"transform",vs:vwe,fs:null};class R1{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new R1(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:r="",defines:i={},inject:o={},varyings:a=[],bufferMode:s=35981,transpileToGLSL100:u=!1}=e,d=this._getModuleList(e.modules),g=this._getHash(n),_=this._getHash(r),E=d.map(k=>this._getHash(k.name)).sort(),P=a.map(k=>this._getHash(k)),R=Object.keys(i).sort(),B=Object.keys(o).sort(),V=[],z=[];for(const k of R)V.push(this._getHash(k)),V.push(this._getHash(i[k]));for(const k of B)z.push(this._getHash(k)),z.push(this._getHash(o[k]));const F="".concat(g,"/").concat(_,"D").concat(V.join("/"),"M").concat(E.join("/"),"I").concat(z.join("/"),"V").concat(P.join("/"),"H").concat(this.stateHash,"B").concat(s).concat(u?"T":"");if(!this._programCache[F]){const k=K1e(this.gl,{vs:n,fs:r,modules:d,inject:o,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:u});this._programCache[F]=new h5(this.gl,{hash:F,vs:k.vs,fs:k.fs,varyings:a,bufferMode:s}),this._getUniforms[F]=k.getUniforms||(X=>{}),this._useCounts[F]=0}return this._useCounts[F]++,this._programCache[F]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let o=0,a=this._defaultModules.length;o<a;++o){const s=this._defaultModules[o],u=s.name;n[i++]=s,r[u]=!0}for(let o=0,a=e.length;o<a;++o){const s=e[o],u=s.name;r[u]||(n[i++]=s,r[u]=!0)}return n.length=i,n}}const bwe={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function wwe(t,e,n){const r={};let i=e.indices;for(const o in e.attributes){const a=e.attributes[o],s=Ewe(o,n);if(o==="indices")i=a;else if(a.constant)r[s]=a.value;else{const u=a.value,d={...a};delete d.value,r[s]=[new ji(t,u),d],Swe(o,d)}}if(i){const o=i.value||i;Nn(o instanceof Uint16Array||o instanceof Uint32Array,'attribute array for "indices" must be of integer type');const a={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};r.indices=[new ji(t,{data:o,target:34963}),a]}return r}function Ewe(t,e){const{attributeMap:n=bwe}=e||{};return n&&n[t]||t}function Swe(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}Nn(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Ay=2,Twe=1e4,Cwe="Model needs drawMode and vertexCount",w$=()=>{},Pwe={};class Oa{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=Ma("model")}=n;Nn(PE(e)),this.id=r,this.gl=e,this.id=n.id||Ma("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||R1.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:r,fs:i,modules:o,defines:a,inject:s,varyings:u,bufferMode:d,transpileToGLSL100:g}=e;this.programProps={program:n,vs:r,fs:i,modules:o,defines:a,inject:s,varyings:u,bufferMode:d,transpileToGLSL100:g},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},Nn(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),Cwe)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:r,fs:i,modules:o,defines:a,inject:s,varyings:u,bufferMode:d,transpileToGLSL100:g}=e;this.programProps={program:n,vs:r,fs:i,modules:o,defines:a,inject:s,varyings:u,bufferMode:d,transpileToGLSL100:g},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return Nn(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return Nn(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=wwe(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Dv(e))return this;const n={};for(const r in e){const i=e[r];n[r]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return ME(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:r,uniforms:i={},attributes:o={},transformFeedback:a=this.transformFeedback,parameters:s={},vertexArray:u=this.vertexArray}=e;this.setAttributes(o),this.updateModuleSettings(n),this.setUniforms(i);let d;Yn.priority>=Ay&&(d=this._logDrawCallStart(Ay));const g=this.vertexArray.getDrawParams(),{isIndexed:_=g.isIndexed,indexType:E=g.indexType,indexOffset:P=g.indexOffset,vertexArrayInstanced:R=g.isInstanced}=this.props;R&&!this.isInstanced&&Yn.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:B,instanceCount:V}=this,{onBeforeRender:z=w$,onAfterRender:F=w$}=this.props;z(),this.program.setUniforms(this.uniforms);const k=this.program.draw(Object.assign(Pwe,e,{logPriority:d,uniforms:null,framebuffer:r,parameters:s,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:u,transformFeedback:a,isIndexed:_,indexType:E,isInstanced:B,instanceCount:V,offset:_?P:0}));return F(),Yn.priority>=Ay&&this._logDrawCallEnd(d,u,r),k}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:r,unbindModels:i=[]}=e;let{parameters:o}=e;r&&this._setFeedbackBuffers(r),n&&(o=Object.assign({},o,{35977:n})),i.forEach(a=>a.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:o}))}finally{i.forEach(a=>a.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Yn.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:r,fs:i,modules:o,inject:a,defines:s,varyings:u,bufferMode:d,transpileToGLSL100:g}=this.programProps;n=this.programManager.get({vs:r,fs:i,modules:o,inject:a,defines:s,varyings:u,bufferMode:d,transpileToGLSL100:g}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Nn(n instanceof h5,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new p1e(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof ji&&n.delete()}}_setAnimationProps(e){this.animated&&Nn(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Dv(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new d5(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:Twe;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),Yn.group(Ay,">>> DRAWING MODEL ".concat(this.id),{collapsed:Yn.level<=2})(),e}_logDrawCallEnd(e,n,r,i){if(e===void 0)return;const o=A1e({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:a,unusedTable:s,unusedCount:u}=r$({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:d,count:g}=r$({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});g>0&&Yn.log("MISSING UNIFORMS",Object.keys(d))(),u>0&&Yn.log("UNUSED UNIFORMS",Object.keys(s))();const _=y1e(this.vertexArray.configuration);Yn.table(e,o)(),Yn.table(e,a)(),Yn.table(e+1,_)(),i&&i.log({logLevel:Ay,message:"Rendered to ".concat(i.id)}),Yn.groupEnd(Ay)()}}class Iwe{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:i}=n;return{attributes:Object.assign({},r,e.attributes),transformFeedback:i}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],r=e?n[e]:null;return r?r instanceof ji?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,r=this.getBuffer(n);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Nn(Hr(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const i in this.feedbackMap){const o=this.feedbackMap[i];i in n&&(r[o]=i)}Object.assign(r,e.feedbackBuffers);for(const i in r){const o=r[i];if(typeof o=="string"){const a=n[o],{byteLength:s,usage:u,accessor:d}=a;r[i]=this._createNewBuffer(i,{byteLength:s,usage:u,accessor:d})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:r})}_setupTransformFeedback(e,n){let{model:r}=n;const{program:i}=r;e.transformFeedback=new d5(this.gl,{program:i,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:n,feedbackBuffers:r})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const i in this.feedbackMap){const o=this.feedbackMap[i];n[i]=e.feedbackBuffers[o],r[o]=e.sourceBuffers[i],Nn(r[o]instanceof ji)}return{sourceBuffers:n,feedbackBuffers:r}}_createNewBuffer(e,n){const r=new ji(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const Mwe="transform_uSampler_",tI="transform_uSize_",E$="transform_position";function Owe(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:r,targetTexture:i}=t,a=Object.keys(n).length,s=null;const u={};let d=e,g={};if(a>0||r){const _=d.split(`
`),E=_.slice();if(_.forEach((P,R,B)=>{if(a>0){const V=Nwe(P,n);if(V){const{updatedLine:z,inject:F}=V;E[R]=z,g=MF([g,F]),Object.assign(u,V.samplerTextureMap),a--}}r&&!s&&(s=Bwe(P,r))}),r){Nn(i);const P="".concat(tI).concat(r),R="uniform vec2 ".concat(P,`;
`),B="     vec2 ".concat(E$," = transform_getPos(").concat(P,`);
     gl_Position = vec4(`).concat(E$,`, 0, 1.);
`);g=MF([g,{"vs:#decl":R,"vs:#main-start":B}])}d=E.join(`
`)}return{vs:d,targetTextureType:s,inject:g,samplerTextureMap:u}}function Rwe(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:r}=t;const i={};let o,a;n&&({width:o,height:a}=r,i["".concat(tI).concat(n)]=[o,a]);for(const s in e)({width:o,height:a}=e[s]),i["".concat(tI).concat(s)]=[o,a];return i}function Lwe(t){return gte(t,["attribute","in"])}function Dwe(t){const e="".concat(Mwe).concat(t),n="".concat(tI).concat(t),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:r}}function Bwe(t,e){const n=gte(t,["varying","out"]);return n&&n.name===e?n.type:null}function Nwe(t,e){const n={},r=Lwe(t);if(!r)return null;const{type:i,name:o}=r;if(o&&e[o]){const a="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:s,sizeName:u,uniformDeclerations:d}=Dwe(o),g=axe(i),_="  ".concat(i," ").concat(o," = transform_getInput(").concat(s,", ").concat(u,").").concat(g,`;
`);return n[s]=o,{updatedLine:a,inject:{"vs:#decl":d,"vs:#main-start":_},samplerTextureMap:n}}return null}const Fwe={10241:9728,10240:9728,10242:33071,10243:33071},kwe="transform_output";class zwe{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:r,framebuffer:i,targetTexture:o}=this.bindings[this.currentIndex],a=Object.assign({},n,e.attributes),s=Object.assign({},e.uniforms),u=Object.assign({},e.parameters);let d=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){a.transform_elementID=this.elementIDBuffer;for(const _ in this.samplerTextureMap){const E=this.samplerTextureMap[_];s[_]=r[E]}this._setSourceTextureParameters();const g=Rwe({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:o});Object.assign(s,g)}return this.hasTargetTexture&&(d=!1,u.viewport=[0,0,i.width,i.height]),{attributes:a,framebuffer:i,uniforms:s,discard:d,parameters:u}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],r=OE(n);if(!e)return r;const i=r.constructor,o=lxe(this.targetTextureType),a=new i(r.length*o/4);let s=0;for(let u=0;u<r.length;u+=4)for(let d=0;d<o;d++)a[s++]=r[u+d];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:r}=e;if(r instanceof Pl)return r;const i=n[r];return i?(this._targetRefTexName=r,this._createNewTexture(i)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:r={},_targetTexture:i}=e,o=this._createTargetTexture({sourceTextures:r,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:r,targetTexture:o}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((r,i,o)=>{o[i]=i}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new ji(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:n,targetTexture:r})}}_updateBinding(e,n){const{sourceBuffers:r,sourceTextures:i,targetTexture:o}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,r),o){e.targetTexture=o;const{width:a,height:s}=o,{framebuffer:u}=e;u?(u.update({attachments:{36064:o},resizeAttachments:!1}),u.resize({width:a,height:s})):e.framebuffer=new Ws(this.gl,{id:"transform-framebuffer",width:a,height:s,attachments:{36064:o}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const r in n)n[r].setParameters(Fwe)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:r}}_createNewTexture(e){const n=rte(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:r}=this.bindings[this.currentIndex],{vs:i,uniforms:o,targetTextureType:a,inject:s,samplerTextureMap:u}=Owe({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),d=MF([e.inject||{},s]);this.targetTextureType=a,this.samplerTextureMap=u;const g=e._fs||mte({version:ote(i),input:this.targetTextureVarying,inputType:a,output:kwe}),_=this.hasSourceTextures||this.targetTextureVarying?[xwe].concat(e.modules||[]):e.modules;return{vs:i,fs:g,modules:_,uniforms:o,inject:d}}}class UO{static isSupported(e){return Hr(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:r}=this;e&&e.delete(),n&&n.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,r=this._updateDrawOptions(e);n&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)e=e||r.swap();Nn(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n){const i=r.getData(e);if(i)return i}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Oa(n,Object.assign({},e,{fs:e.fs||mte({version:ote(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)n=i.updateModelProps(n);return n}_buildResourceTransforms(e,n){Uwe(n)&&(this.bufferTransform=new Iwe(e,n)),Gwe(n)&&(this.textureTransform=new zwe(e,n)),Nn(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)n=Object.assign(n,i.getDrawOptions(n));return n}}function Uwe(t){return!!(!Dv(t.feedbackBuffers)||!Dv(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function Gwe(t){return!!(!Dv(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const S$={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};let Cs=class{static get DRAW_MODE(){return S$}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Ma("geometry"),drawMode:r=S$.TRIANGLES,attributes:i={},indices:o=null,vertexCount:a=null}=e;this.id=n,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(i,o),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const r in e){let i=e[r];i=ArrayBuffer.isView(i)?{value:i}:i,Nn(ArrayBuffer.isView(i.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!i.size&&(i.size=3),r==="indices"?(Nn(!this.indices),this.indices=i):this.attributes[r]=i}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i in e){const o=e[i],{value:a,size:s,constant:u}=o;!u&&a&&s>=1&&(r=Math.min(r,a.length/s))}return Nn(Number.isFinite(r)),r}};const jwe={x:[2,0,1],y:[0,1,2],z:[1,2,0]};class S5 extends Cs{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Ma("truncated-code-geometry")}=e,{indices:r,attributes:i}=Vwe(e);super({...e,id:n,indices:r,attributes:{...i,...e.attributes}})}}function Vwe(t){const{bottomRadius:e=0,topRadius:n=0,height:r=1,nradial:i=10,nvertical:o=10,verticalAxis:a="y",topCap:s=!1,bottomCap:u=!1}=t,d=(s?2:0)+(u?2:0),g=(i+1)*(o+1+d),_=Math.atan2(e-n,r),E=Math.sin,P=Math.cos,R=Math.PI,B=P(_),V=E(_),z=s?-2:0,F=o+(u?2:0),k=i+1,X=new Uint16Array(i*(o+d)*6),Y=jwe[a],J=new Float32Array(g*3),ie=new Float32Array(g*3),ce=new Float32Array(g*2);let re=0,ue=0;for(let se=z;se<=F;se++){let me=se/o,Ce=r*me,be;se<0?(Ce=0,me=1,be=e):se>o?(Ce=r,me=1,be=n):be=e+(n-e)*(se/o),(se===-2||se===o+2)&&(be=0,me=0),Ce-=r/2;for(let Ye=0;Ye<k;Ye++){const tt=E(Ye*R*2/i),pt=P(Ye*R*2/i);J[re+Y[0]]=tt*be,J[re+Y[1]]=Ce,J[re+Y[2]]=pt*be,ie[re+Y[0]]=se<0||se>o?0:tt*B,ie[re+Y[1]]=se<0?-1:se>o?1:V,ie[re+Y[2]]=se<0||se>o?0:pt*B,ce[ue+0]=Ye/i,ce[ue+1]=me,ue+=2,re+=3}}for(let se=0;se<o+d;se++)for(let me=0;me<i;me++){const Ce=(se*i+me)*6;X[Ce+0]=k*(se+0)+0+me,X[Ce+1]=k*(se+0)+1+me,X[Ce+2]=k*(se+1)+1+me,X[Ce+3]=k*(se+0)+0+me,X[Ce+4]=k*(se+1)+1+me,X[Ce+5]=k*(se+1)+0+me}return{indices:X,attributes:{POSITION:{size:3,value:J},NORMAL:{size:3,value:ie},TEXCOORD_0:{size:2,value:ce}}}}class $we extends S5{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Ma("cone-geometry"),radius:r=1,cap:i=!0}=e;super({...e,id:n,topRadius:0,topCap:!!i,bottomCap:!!i,bottomRadius:r})}}const Hwe=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Wwe=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),qwe=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Xwe=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),Zwe={POSITION:{size:3,value:new Float32Array(Wwe)},NORMAL:{size:3,value:new Float32Array(qwe)},TEXCOORD_0:{size:2,value:new Float32Array(Xwe)}};class qte extends Cs{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Ma("cube-geometry")}=e;super({...e,id:n,indices:{size:1,value:new Uint16Array(Hwe)},attributes:{...Zwe,...e.attributes}})}}class Ywe extends S5{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Ma("cylinder-geometry"),radius:r=1}=e;super({...e,id:n,bottomRadius:r,topRadius:r})}}const Qwe=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],Kwe=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1];class Jwe extends Cs{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Ma("ico-sphere-geometry")}=e,{indices:r,attributes:i}=eEe(e);super({...e,id:n,indices:r,attributes:{...i,...e.attributes}})}}function eEe(t){const{iterations:e=0}=t,n=Math.PI,r=n*2,i=[...Qwe];let o=[...Kwe];i.push(),o.push();const a=(()=>{const g={};return(_,E)=>{_*=3,E*=3;const P=_<E?_:E,R=_>E?_:E,B="".concat(P,"|").concat(R);if(B in g)return g[B];const V=i[_],z=i[_+1],F=i[_+2],k=i[E],X=i[E+1],Y=i[E+2];let J=(V+k)/2,ie=(z+X)/2,ce=(F+Y)/2;const re=Math.sqrt(J*J+ie*ie+ce*ce);return J/=re,ie/=re,ce/=re,i.push(J,ie,ce),g[B]=i.length/3-1}})();for(let g=0;g<e;g++){const _=[];for(let E=0;E<o.length;E+=3){const P=a(o[E+0],o[E+1]),R=a(o[E+1],o[E+2]),B=a(o[E+2],o[E+0]);_.push(B,o[E+0],P,P,o[E+1],R,R,o[E+2],B,P,R,B)}o=_}const s=new Array(i.length),u=new Array(i.length/3*2),d=o.length;for(let g=d-3;g>=0;g-=3){const _=o[g+0],E=o[g+1],P=o[g+2],R=_*3,B=E*3,V=P*3,z=_*2,F=E*2,k=P*2,X=i[R+0],Y=i[R+1],J=i[R+2],ie=Math.acos(J/Math.sqrt(X*X+Y*Y+J*J)),ce=Math.atan2(Y,X)+n,re=ie/n,ue=1-ce/r,se=i[B+0],me=i[B+1],Ce=i[B+2],be=Math.acos(Ce/Math.sqrt(se*se+me*me+Ce*Ce)),Ye=Math.atan2(me,se)+n,tt=be/n,pt=1-Ye/r,Ee=i[V+0],Ne=i[V+1],Be=i[V+2],qe=Math.acos(Be/Math.sqrt(Ee*Ee+Ne*Ne+Be*Be)),ct=Math.atan2(Ne,Ee)+n,Ct=qe/n,Dt=1-ct/r,In=[Ee-se,Ne-me,Be-Ce],Mn=[X-se,Y-me,J-Ce],Tn=new yt(In).cross(Mn).normalize();let Nt;(ue===0||pt===0||Dt===0)&&(ue===0||ue>.5)&&(pt===0||pt>.5)&&(Dt===0||Dt>.5)&&(i.push(i[R+0],i[R+1],i[R+2]),Nt=i.length/3-1,o.push(Nt),u[Nt*2+0]=1,u[Nt*2+1]=re,s[Nt*3+0]=Tn.x,s[Nt*3+1]=Tn.y,s[Nt*3+2]=Tn.z,i.push(i[B+0],i[B+1],i[B+2]),Nt=i.length/3-1,o.push(Nt),u[Nt*2+0]=1,u[Nt*2+1]=tt,s[Nt*3+0]=Tn.x,s[Nt*3+1]=Tn.y,s[Nt*3+2]=Tn.z,i.push(i[V+0],i[V+1],i[V+2]),Nt=i.length/3-1,o.push(Nt),u[Nt*2+0]=1,u[Nt*2+1]=Ct,s[Nt*3+0]=Tn.x,s[Nt*3+1]=Tn.y,s[Nt*3+2]=Tn.z),s[R+0]=s[B+0]=s[V+0]=Tn.x,s[R+1]=s[B+1]=s[V+1]=Tn.y,s[R+2]=s[B+2]=s[V+2]=Tn.z,u[z+0]=ue,u[z+1]=re,u[F+0]=pt,u[F+1]=tt,u[k+0]=Dt,u[k+1]=Ct}return{indices:{size:1,value:new Uint16Array(o)},attributes:{POSITION:{size:3,value:new Float32Array(i)},NORMAL:{size:3,value:new Float32Array(s)},TEXCOORD_0:{size:2,value:new Float32Array(u)}}}}function tEe(t){const{indices:e,attributes:n}=t;if(!e)return t;const r=e.value.length,i={};for(const o in n){const a=n[o],{constant:s,value:u,size:d}=a;if(s||!d)continue;const g=new u.constructor(r*d);for(let _=0;_<r;++_){const E=e.value[_];for(let P=0;P<d;P++)g[_*d+P]=u[E*d+P]}i[o]={size:d,value:g}}return{attributes:Object.assign({},n,i)}}class nEe extends Cs{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Ma("plane-geometry")}=e,{indices:r,attributes:i}=rEe(e);super({...e,id:n,indices:r,attributes:{...i,...e.attributes}})}}function rEe(t){const{type:e="x,y",offset:n=0,flipCull:r=!1,unpack:i=!1}=t,o=e.split(",");let a=t["".concat(o[0],"len")]||1;const s=t["".concat(o[1],"len")]||1,u=t["n".concat(o[0])]||1,d=t["n".concat(o[1])]||1,g=(u+1)*(d+1),_=new Float32Array(g*3),E=new Float32Array(g*3),P=new Float32Array(g*2);r&&(a=-a);let R=0,B=0;for(let k=0;k<=d;k++)for(let X=0;X<=u;X++){const Y=X/u,J=k/d;switch(P[R+0]=r?1-Y:Y,P[R+1]=J,e){case"x,y":_[B+0]=a*Y-a*.5,_[B+1]=s*J-s*.5,_[B+2]=n,E[B+0]=0,E[B+1]=0,E[B+2]=r?1:-1;break;case"x,z":_[B+0]=a*Y-a*.5,_[B+1]=n,_[B+2]=s*J-s*.5,E[B+0]=0,E[B+1]=r?1:-1,E[B+2]=0;break;case"y,z":_[B+0]=n,_[B+1]=a*Y-a*.5,_[B+2]=s*J-s*.5,E[B+0]=r?1:-1,E[B+1]=0,E[B+2]=0;break;default:throw new Error("PlaneGeometry: unknown type")}R+=2,B+=3}const V=u+1,z=new Uint16Array(u*d*6);for(let k=0;k<d;k++)for(let X=0;X<u;X++){const Y=(k*u+X)*6;z[Y+0]=(k+0)*V+X,z[Y+1]=(k+1)*V+X,z[Y+2]=(k+0)*V+X+1,z[Y+3]=(k+1)*V+X,z[Y+4]=(k+1)*V+X+1,z[Y+5]=(k+0)*V+X+1}const F={indices:{size:1,value:z},attributes:{POSITION:{size:3,value:_},NORMAL:{size:3,value:E},TEXCOORD_0:{size:2,value:P}}};return i?tEe(F):F}class iEe extends Cs{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Ma("sphere-geometry")}=e,{indices:r,attributes:i}=oEe(e);super({...e,id:n,indices:r,attributes:{...i,...e.attributes}})}}function oEe(t){const{nlat:e=10,nlong:n=10}=t;let{radius:r=1}=t;const a=Math.PI-0,s=0,d=2*Math.PI-s,g=(e+1)*(n+1);if(typeof r=="number"){const z=r;r=(F,k,X,Y,J)=>z}const _=new Float32Array(g*3),E=new Float32Array(g*3),P=new Float32Array(g*2),R=g>65535?Uint32Array:Uint16Array,B=new R(e*n*6);for(let z=0;z<=e;z++)for(let F=0;F<=n;F++){const k=F/n,X=z/e,Y=F+z*(n+1),J=Y*2,ie=Y*3,ce=d*k,re=a*X,ue=Math.sin(ce),se=Math.cos(ce),me=Math.sin(re),Ce=Math.cos(re),be=se*me,Ye=Ce,tt=ue*me,pt=r(be,Ye,tt,k,X);_[ie+0]=pt*be,_[ie+1]=pt*Ye,_[ie+2]=pt*tt,E[ie+0]=be,E[ie+1]=Ye,E[ie+2]=tt,P[J+0]=k,P[J+1]=1-X}const V=n+1;for(let z=0;z<n;z++)for(let F=0;F<e;F++){const k=(z*e+F)*6;B[k+0]=F*V+z,B[k+1]=F*V+z+1,B[k+2]=(F+1)*V+z,B[k+3]=(F+1)*V+z,B[k+4]=F*V+z+1,B[k+5]=(F+1)*V+z+1}return{indices:{size:1,value:B},attributes:{POSITION:{size:3,value:_},NORMAL:{size:3,value:E},TEXCOORD_0:{size:2,value:P}}}}let sEe=1,aEe=1;class T5{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:o=1}=e,a=sEe++,s={time:0,delay:n,duration:r,rate:i,repeat:o};return this._setChannelTime(s,this.time),this.channels.set(a,s),a}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:o,channel:a}=i;o.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=aEe++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const lEe=`attribute vec2 aClipSpacePosition;
attribute vec2 aTexCoord;
attribute vec2 aCoordinate;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main(void) {
  gl_Position = vec4(aClipSpacePosition, 0., 1.);
  position = aClipSpacePosition;
  coordinate = aCoordinate;
  uv = aTexCoord;
}
`,T$=[-1,-1,1,-1,-1,1,1,1];class Xte extends Oa{constructor(e,n){const r=T$.map(i=>i===-1?0:i);super(e,Object.assign({},n,{vs:lEe,geometry:new Cs({drawMode:5,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(T$)},aTexCoord:{size:2,value:new Float32Array(r)},aCoordinate:{size:2,value:new Float32Array(r)}}})})),this.setVertexCount(4)}}const uEe=Object.freeze(Object.defineProperty({__proto__:null,AnimationLoop:ate,Buffer:ji,ClipSpace:Xte,ConeGeometry:$we,CubeGeometry:qte,CylinderGeometry:Ywe,FEATURES:Qi,FragmentShader:tC,Framebuffer:Ws,Geometry:Cs,IcoSphereGeometry:Jwe,Model:Oa,PlaneGeometry:nEe,Program:h5,ProgramManager:R1,Renderbuffer:x0,SphereGeometry:iEe,Texture2D:Pl,Texture3D:Qee,TextureCube:u5,Timeline:T5,Transform:UO,TransformFeedback:d5,TruncatedConeGeometry:S5,VertexShader:eC,assert:Nn,clear:ME,cloneTextureFrom:rte,copyToTexture:ete,createGLContext:s5,cssToDevicePixels:KT,cssToDeviceRatio:R0,dirlight:cwe,fp32:Ate,fp64:mxe,getParameters:$ee,gouraudLighting:DE,hasFeature:RE,hasFeatures:LO,instrumentGLContext:RO,isWebGL:PE,isWebGL2:Hr,log:Yn,lumaStats:Cm,normalizeShaderModule:lte,pbr:zO,phongLighting:kO,picking:$te,project:jte,readPixelsToArray:OE,readPixelsToBuffer:Zye,resetParameters:Hee,setParameters:bh,uid:Ma,withParameters:Mu},Symbol.toStringTag,{value:"Module"})),cEe=[255,255,255],fEe=1;let hEe=0;class Zte{constructor(e={}){q(this,"id",void 0),q(this,"color",void 0),q(this,"intensity",void 0),q(this,"type","ambient");const{color:n=cEe}=e,{intensity:r=fEe}=e;this.id=e.id||"ambient-".concat(hEe++),this.color=n,this.intensity=r}}const dEe=[255,255,255],pEe=1,gEe=[0,0,-1];let mEe=0;class nI{constructor(e={}){q(this,"id",void 0),q(this,"color",void 0),q(this,"intensity",void 0),q(this,"type","directional"),q(this,"direction",void 0),q(this,"shadow",void 0);const{color:n=dEe}=e,{intensity:r=pEe}=e,{direction:i=gEe}=e,{_shadow:o=!1}=e;this.id=e.id||"directional-".concat(mEe++),this.color=n,this.intensity=r,this.type="directional",this.direction=new yt(i).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class Yte{constructor(e,n={id:"pass"}){q(this,"id",void 0),q(this,"gl",void 0),q(this,"props",void 0);const{id:r}=n;this.id=r,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class GO extends Yte{constructor(...e){super(...e),q(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return bh(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:r,viewports:i,views:o,onViewportActive:a,clearStack:s=!0,clearCanvas:u=!0}=e;e.pass=e.pass||"unknown";const d=this.gl;u&&_Ee(d,n),s&&(this._lastRenderIndex=-1);const g=[];for(const _ of i){const E=o&&o[_.id];a==null||a(_);const P=this._getDrawLayerParams(_,e),R=_.subViewports||[_];for(const B of R){const V=this._drawLayersInViewport(d,{target:n,moduleParameters:r,viewport:B,view:E,pass:e.pass,layers:e.layers},P);g.push(V)}}return g}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:o,cullRect:a,effects:s,moduleParameters:u},d=!1){const g=[],_=Qte(this._lastRenderIndex+1),E={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:a},P={};for(let R=0;R<n.length;R++){const B=n[R],V=this._shouldDrawLayer(B,E,o,P),z={shouldDrawLayer:V};V&&!d&&(z.layerRenderIndex=_(B,V),z.moduleParameters=this._getModuleParameters(B,s,r,u),z.layerParameters=this.getLayerParameters(B,R,e)),g[R]=z}return g}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:i,target:o,viewport:a,view:s},u){const d=AEe(e,{moduleParameters:r,target:o,viewport:a});if(s&&s.props.clear){const _=s.props.clear===!0?{color:!0,depth:!0}:s.props.clear;Mu(e,{scissorTest:!0,scissor:d},()=>ME(e,_))}const g={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};bh(e,{viewport:d});for(let _=0;_<n.length;_++){const E=n[_],{shouldDrawLayer:P,layerRenderIndex:R,moduleParameters:B,layerParameters:V}=u[_];if(P&&E.props.pickable&&g.pickableCount++,E.isComposite)g.compositeCount++;else if(P){g.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,R),B.viewport=a;try{E._drawLayer({moduleParameters:B,uniforms:{layerIndex:R},parameters:V})}catch(z){E.raiseError(z,"drawing ".concat(E," to ").concat(i))}}}return g}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let a=e.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(n))return!1;n.layer=a,a=a.parent}if(r){const s=n.layer.id;if(s in i||(i[s]=r(n)),!i[s])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,i){var o;const a=Object.assign(Object.create(((o=e.internalState)===null||o===void 0?void 0:o.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:R0(this.gl)});if(n)for(const u of n){var s;Object.assign(a,(s=u.getModuleParameters)===null||s===void 0?void 0:s.call(u,e))}return Object.assign(a,this.getModuleParameters(e,n),i)}}function Qte(t=0,e={}){const n={},r=(i,o)=>{const a=i.props._offset,s=i.id,u=i.parent&&i.parent.id;let d;if(u&&!(u in e)&&r(i.parent,!1),u in n){const g=n[u]=n[u]||Qte(e[u],e);d=g(i,o),n[s]=g}else Number.isFinite(a)?(d=a+(e[u]||0),n[s]=null):d=t;return o&&d>=t&&(t=d+1),e[s]=d,d};return r}function AEe(t,{moduleParameters:e,target:n,viewport:r}){const i=n&&n.id!=="default-framebuffer",o=e&&e.devicePixelRatio||R0(t),a=i?n.height:t.drawingBufferHeight,s=r;return[s.x*o,a-(s.y+s.height)*o,s.width*o,s.height*o]}function _Ee(t,e){const n=e?e.width:t.drawingBufferWidth,r=e?e.height:t.drawingBufferHeight;bh(t,{viewport:[0,0,n,r]}),t.clear(16640)}class yEe extends GO{constructor(e,n){super(e,n),q(this,"shadowMap",void 0),q(this,"depthBuffer",void 0),q(this,"fbo",void 0),this.shadowMap=new Pl(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new x0(e,{format:33189,width:1,height:1}),this.fbo=new Ws(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const n=this.fbo;Mu(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],i=R0(this.gl),o=r.width*i,a=r.height*i;(o!==n.width||a!==n.height)&&n.resize({width:o,height:a}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const Kte="#define SMOOTH_EDGE_RADIUS 0.5",vEe=`
`.concat(Kte,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),xEe=`
`.concat(Kte,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),bEe={name:"geometry",vs:vEe,fs:xEe},wEe=Object.keys(Br).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(Br[t],";")).join(""),EEe=Object.keys(hh).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(hh[t],";")).join(""),SEe=Object.keys(Bu).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(Bu[t],";")).join(""),TEe="".concat(wEe,`
`).concat(EEe,`
`).concat(SEe,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function CEe(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function L1(t){let e={},n;return r=>{for(const i in r)if(!CEe(r[i],e[i])){n=t(r),e=r;break}return n}}const C$=[0,0,0,0],PEe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Jte=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],IEe=[0,0,0],ene=[0,0,0],MEe=L1(REe);function tne(t,e,n=ene){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,o=!0;switch(e===Br.LNGLAT_OFFSETS||e===Br.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case hh.WEB_MERCATOR:(e===Br.LNGLAT||e===Br.CARTESIAN)&&(i=[0,0,0],o=!1);break;case hh.WEB_MERCATOR_AUTO_OFFSET:e===Br.LNGLAT?r=i:e===Br.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case hh.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case hh.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:o}}function OEe(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:o,viewProjectionMatrix:a}=t,s=C$,u=C$,d=t.cameraPosition;const{geospatialOrigin:g,shaderCoordinateOrigin:_,offsetMode:E}=tne(t,e,n);return E&&(u=t.projectPosition(g||_),d=[d[0]-u[0],d[1]-u[1],d[2]-u[2]],u[3]=1,s=O1([],u,a),o=r||o,a=kd([],i,o),a=kd([],a,PEe)),{viewMatrix:o,viewProjectionMatrix:a,projectionCenter:s,originCommon:u,cameraPosCommon:d,shaderCoordinateOrigin:_,geospatialOrigin:g}}function nne({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=Br.DEFAULT,coordinateOrigin:i=ene,autoWrapLongitude:o=!1}){r===Br.DEFAULT&&(r=t.isGeospatial?Br.LNGLAT:Br.CARTESIAN);const a=MEe({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return a.project_uWrapLongitude=o,a.project_uModelMatrix=n||Jte,a}function REe({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:o,originCommon:a,cameraPosCommon:s,shaderCoordinateOrigin:u,geospatialOrigin:d}=OEe(t,n,r),g=t.getDistanceScales(),_=[t.width*e,t.height*e],E=O1([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,P={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:u,project_uCommonOrigin:a.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:_,project_uDevicePixelRatio:e,project_uFocalDistance:E,project_uCommonUnitsPerMeter:g.unitsPerMeter,project_uCommonUnitsPerWorldUnit:g.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:IEe,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:o,project_uModelMatrix:Jte,project_uCameraPosition:s};if(d){const R=t.getDistanceScales(d);switch(n){case Br.METER_OFFSETS:P.project_uCommonUnitsPerWorldUnit=R.unitsPerMeter,P.project_uCommonUnitsPerWorldUnit2=R.unitsPerMeter2;break;case Br.LNGLAT:case Br.LNGLAT_OFFSETS:t._pseudoMeters||(P.project_uCommonUnitsPerMeter=R.unitsPerMeter),P.project_uCommonUnitsPerWorldUnit=R.unitsPerDegree,P.project_uCommonUnitsPerWorldUnit2=R.unitsPerDegree2;break;case Br.CARTESIAN:P.project_uCommonUnitsPerWorldUnit=[1,1,R.unitsPerMeter[2]],P.project_uCommonUnitsPerWorldUnit2=[0,0,R.unitsPerMeter2[2]];break}}return P}const LEe={};function DEe(t=LEe){return"viewport"in t?nne(t):{}}const jO={name:"project",dependencies:[Ate,bEe],vs:TEe,getUniforms:DEe};function sC(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function mv(t,e){const n=O1([],e,t);return w5(n,n,1/n[3]),n}function P$(t,e){const n=t%e;return n<0?e+n:n}function BEe(t,e,n){return n*e+(1-n)*t}function BF(t,e,n){return t<e?e:t>n?n:t}function NEe(t){return Math.log(t)*Math.LOG2E}const C5=Math.log2||NEe;function lg(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const dh=Math.PI,rne=dh/4,gf=dh/180,NF=180/dh,kv=512,rI=4003e4,Hb=85.051129,ine=1.5;function iI(t){return Math.pow(2,t)}function P5(t){return C5(t)}function El(t){const[e,n]=t;lg(Number.isFinite(e)),lg(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*gf,i=n*gf,o=kv*(r+dh)/(2*dh),a=kv*(dh+Math.log(Math.tan(rne+i*.5)))/(2*dh);return[o,a]}function gc(t){const[e,n]=t,r=e/kv*(2*dh)-dh,i=2*(Math.atan(Math.exp(n/kv*(2*dh)-dh))-rne);return[r*NF,i*NF]}function I5(t){const{latitude:e}=t;lg(Number.isFinite(e));const n=Math.cos(e*gf);return P5(rI*n)-9}function aC(t){const e=Math.cos(t*gf);return kv/rI/e}function Uw(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;lg(Number.isFinite(e)&&Number.isFinite(n));const i=kv,o=Math.cos(e*gf),a=i/360,s=a/o,u=i/rI/o,d={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[a,s,u],degreesPerUnit:[1/a,1/s,1/u]};if(r){const g=gf*Math.tan(e*gf)/o,_=a*g/2,E=i/rI*g,P=E/s*u;d.unitsPerDegree2=[0,_,E],d.unitsPerMeter2=[P,0,P]}return d}function M5(t,e){const[n,r,i]=t,[o,a,s]=e,{unitsPerMeter:u,unitsPerMeter2:d}=Uw({longitude:n,latitude:r,highPrecision:!0}),g=El(t);g[0]+=o*(u[0]+d[0]*a),g[1]+=a*(u[1]+d[1]*a);const _=gc(g),E=(i||0)+(s||0);return Number.isFinite(i)||Number.isFinite(s)?[_[0],_[1],E]:_}function O5(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:o,center:a}=t,s=sC();zw(s,s,[0,0,-i]),Bte(s,s,-n*gf),Nte(s,s,r*gf);const u=o/e;return FO(s,s,[u,u,u]),a&&zw(s,s,Hxe([],a)),s}function R5(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:o,center:a,scale:s,nearZMultiplier:u=1,farZMultiplier:d=1}=t;let{fovy:g=B0(ine)}=t;r!==void 0&&(g=B0(r));const _=g*gf,E=i*gf,P=BE(g);let R=P;a&&(R+=a[2]*s/Math.cos(E)/n);const B=_*(.5+(o?o[1]:0)/n),V=Math.sin(B)*R/Math.sin(BF(Math.PI/2-E-B,.01,Math.PI-.01)),z=Math.sin(E)*V+R,F=R*10,k=Math.min(z*d,F);return{fov:_,aspect:e/n,focalDistance:P,near:u,far:k}}function one(t){const{fov:e,aspect:n,near:r,far:i}=R5(t);return Fte([],e,n,r,i)}function B0(t){return 2*Math.atan(.5/t)*NF}function BE(t){return .5/Math.tan(.5*t*gf)}function VO(t,e){const[n,r,i=0]=t;return lg(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),mv(e,[n,r,i,1])}function Ym(t,e,n=0){const[r,i,o]=t;if(lg(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return mv(e,[r,i,o,1]);const a=mv(e,[r,i,0,1]),s=mv(e,[r,i,1,1]),u=a[2],d=s[2],g=u===d?0:((n||0)-u)/(d-u);return wte([],a,s,g)}function L5(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:o=24,offset:a=[0,0]}=t,[[s,u],[d,g]]=r,_=FEe(t.padding),E=El([s,BF(g,-Hb,Hb)]),P=El([d,BF(u,-Hb,Hb)]),R=[Math.max(Math.abs(P[0]-E[0]),i),Math.max(Math.abs(P[1]-E[1]),i)],B=[e-_.left-_.right-Math.abs(a[0])*2,n-_.top-_.bottom-Math.abs(a[1])*2];lg(B[0]>0&&B[1]>0);const V=B[0]/R[0],z=B[1]/R[1],F=(_.right-_.left)/2/V,k=(_.top-_.bottom)/2/z,X=[(P[0]+E[0])/2+F,(P[1]+E[1])/2+k],Y=gc(X),J=Math.min(o,C5(Math.abs(Math.min(V,z))));return lg(Number.isFinite(J)),{longitude:Y[0],latitude:Y[1],zoom:J}}function FEe(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(lg(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const I$=Math.PI/180;function D5(t,e=0){const{width:n,height:r,unproject:i}=t,o={targetZ:e},a=i([0,r],o),s=i([n,r],o);let u,d;const g=t.fovy?.5*t.fovy*I$:Math.atan(.5/t.altitude),_=(90-t.pitch)*I$;return g>_-.01?(u=M$(t,0,e),d=M$(t,n,e)):(u=i([0,0],o),d=i([n,0],o)),[a,s,d,u]}function M$(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=mv(r,[e,0,1,1]),o=mv(r,[e,t.height,1,1]),s=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),u=wte([],i,o,s),d=gc(u);return d.push(n),d}let O$=class FF{constructor(e={width:1,height:1}){q(this,"latitude",void 0),q(this,"longitude",void 0),q(this,"zoom",void 0),q(this,"pitch",void 0),q(this,"bearing",void 0),q(this,"altitude",void 0),q(this,"fovy",void 0),q(this,"meterOffset",void 0),q(this,"center",void 0),q(this,"width",void 0),q(this,"height",void 0),q(this,"scale",void 0),q(this,"distanceScales",void 0),q(this,"viewMatrix",void 0),q(this,"projectionMatrix",void 0),q(this,"viewProjectionMatrix",void 0),q(this,"pixelProjectionMatrix",void 0),q(this,"pixelUnprojectionMatrix",void 0),q(this,"equals",z=>z instanceof FF?z.width===this.width&&z.height===this.height&&m$(z.projectionMatrix,this.projectionMatrix)&&m$(z.viewMatrix,this.viewMatrix):!1),q(this,"project",(z,F={})=>{const{topLeft:k=!0}=F,X=this.projectPosition(z),Y=VO(X,this.pixelProjectionMatrix),[J,ie]=Y,ce=k?ie:this.height-ie;return z.length===2?[J,ce]:[J,ce,Y[2]]}),q(this,"unproject",(z,F={})=>{const{topLeft:k=!0,targetZ:X=void 0}=F,[Y,J,ie]=z,ce=k?J:this.height-J,re=X&&X*this.distanceScales.unitsPerMeter[2],ue=Ym([Y,ce,ie],this.pixelUnprojectionMatrix,re),[se,me,Ce]=this.unprojectPosition(ue);return Number.isFinite(ie)?[se,me,Ce]:Number.isFinite(X)?[se,me,X]:[se,me]}),q(this,"projectPosition",z=>{const[F,k]=El(z),X=(z[2]||0)*this.distanceScales.unitsPerMeter[2];return[F,k,X]}),q(this,"unprojectPosition",z=>{const[F,k]=gc(z),X=(z[2]||0)*this.distanceScales.metersPerUnit[2];return[F,k,X]});let{width:n,height:r,altitude:i=null,fovy:o=null}=e;const{latitude:a=0,longitude:s=0,zoom:u=0,pitch:d=0,bearing:g=0,position:_=null,nearZMultiplier:E=.02,farZMultiplier:P=1.01}=e;n=n||1,r=r||1,o===null&&i===null?(i=ine,o=B0(i)):o===null?o=B0(i):i===null&&(i=BE(o));const R=iI(u);i=Math.max(.75,i);const B=Uw({longitude:s,latitude:a}),V=El([s,a]);V.push(0),_&&Gxe(V,V,Kxe([],_,B.unitsPerMeter)),this.projectionMatrix=one({width:n,height:r,scale:R,center:V,pitch:d,fovy:o,nearZMultiplier:E,farZMultiplier:P}),this.viewMatrix=O5({height:r,scale:R,center:V,pitch:d,bearing:g,altitude:i}),this.width=n,this.height=r,this.scale=R,this.latitude=a,this.longitude=s,this.zoom=u,this.pitch=d,this.bearing=g,this.altitude=i,this.fovy=o,this.center=V,this.meterOffset=_||[0,0,0],this.distanceScales=B,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:e,height:n,projectionMatrix:r,viewMatrix:i}=this,o=sC();kd(o,o,r),kd(o,o,i),this.viewProjectionMatrix=o;const a=sC();FO(a,a,[e/2,-n/2,1]),zw(a,a,[1,-1,0]),kd(a,a,o);const s=eI(sC(),a);if(!s)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=a,this.pixelUnprojectionMatrix=s}projectFlat(e){return El(e)}unprojectFlat(e){return gc(e)}getMapCenterByLngLatPosition({lngLat:e,pos:n}){const r=Ym(n,this.pixelUnprojectionMatrix),i=El(e),o=D0([],i,y5([],r)),a=D0([],this.center,o);return gc(a)}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:o,latitude:a,zoom:s}=L5(Object.assign({width:r,height:i,bounds:e},n));return new FF({width:r,height:i,longitude:o,latitude:a,zoom:s})}getBounds(e){const n=this.getBoundingRegion(e),r=Math.min(...n.map(s=>s[0])),i=Math.max(...n.map(s=>s[0])),o=Math.min(...n.map(s=>s[1])),a=Math.max(...n.map(s=>s[1]));return[[r,o],[i,a]]}getBoundingRegion(e={}){return D5(this,e.z||0)}getLocationAtPoint({lngLat:e,pos:n}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}};const R$=512;function sne(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:o,zoom:a,bearing:s=0}=t;(i<-180||i>180)&&(i=P$(i+180,360)-180),(s<-180||s>180)&&(s=P$(s+180,360)-180);const u=C5(n/R$);if(a<=u)a=u,o=0;else{const d=n/2/Math.pow(2,a),g=gc([0,d])[1];if(o<g)o=g;else{const _=gc([0,R$-d])[1];o>_&&(o=_)}}return{width:e,height:n,longitude:i,latitude:o,zoom:a,pitch:r,bearing:s}}const ane=.01,kEe=["longitude","latitude","zoom"],lne={curve:1.414,speed:1.2};function une(t,e,n,r){const{startZoom:i,startCenterXY:o,uDelta:a,w0:s,u1:u,S:d,rho:g,rho2:_,r0:E}=fne(t,e,r);if(u<ane){const X={};for(const Y of kEe){const J=t[Y],ie=e[Y];X[Y]=BEe(J,ie,n)}return X}const P=n*d,R=Math.cosh(E)/Math.cosh(E+g*P),B=s*((Math.cosh(E)*Math.tanh(E+g*P)-Math.sinh(E))/_)/u,V=1/R,z=i+P5(V),F=Dxe([],a,B);D0(F,F,o);const k=gc(F);return{longitude:k[0],latitude:k[1],zoom:z}}function cne(t,e,n){const r={...lne,...n},{screenSpeed:i,speed:o,maxDuration:a}=r,{S:s,rho:u}=fne(t,e,r),d=1e3*s;let g;return Number.isFinite(i)?g=d/(i/u):g=d/o,Number.isFinite(a)&&g>a?0:g}function fne(t,e,n){n=Object.assign({},lne,n);const r=n.curve,i=t.zoom,o=[t.longitude,t.latitude],a=iI(i),s=e.zoom,u=[e.longitude,e.latitude],d=iI(s-i),g=El(o),_=El(u),E=kxe([],_,g),P=Math.max(t.width,t.height),R=P/d,B=Bxe(E)*a,V=Math.max(B,ane),z=r*r,F=(R*R-P*P+z*z*V*V)/(2*P*z*V),k=(R*R-P*P-z*z*V*V)/(2*R*z*V),X=Math.log(Math.sqrt(F*F+1)-F),Y=Math.log(Math.sqrt(k*k+1)-k),J=(Y-X)/r;return{startZoom:i,startCenterXY:g,uDelta:E,w0:P,u1:B,S:J,rho:r,rho2:z,r0:X,r1:Y}}const zEe=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,UEe=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,GEe=L1(WEe),jEe=L1(qEe),VEe=[0,0,0,1],$Ee=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function HEe(t,e){const[n,r,i]=t,o=Ym([n,r,i],e);return Number.isFinite(i)?o:[o[0],o[1],0]}function WEe({viewport:t,center:e}){return new vr(t.viewProjectionMatrix).invert().transform(e)}function qEe({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,o=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(a=>HEe(a,r));for(const a of e){const s=a.clone().translate(new yt(t.center).negate()),u=o.map(g=>s.transform(g)),d=new vr().ortho({left:Math.min(...u.map(g=>g[0])),right:Math.max(...u.map(g=>g[0])),bottom:Math.min(...u.map(g=>g[1])),top:Math.max(...u.map(g=>g[1])),near:Math.min(...u.map(g=>-g[2])),far:Math.max(...u.map(g=>-g[2]))});n.push(d.multiplyRight(a))}return n}function XEe(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||VEe,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=GEe({viewport:t.viewport,center:e.project_uCenter}),o=[],a=jEe({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let s=0;s<t.shadowMatrices.length;s++){const u=a[s],d=u.clone().translate(new yt(t.viewport.center).negate());e.project_uCoordinateSystem===Br.LNGLAT&&e.project_uProjectionMode===hh.WEB_MERCATOR?(a[s]=d,o[s]=i):(a[s]=u.clone().multiplyRight($Ee),o[s]=d.transform(i))}for(let s=0;s<a.length;s++)r["shadow_uViewProjectionMatrices[".concat(s,"]")]=a[s],r["shadow_uProjectCenters[".concat(s,"]")]=o[s],t.shadowMaps&&t.shadowMaps.length>0?r["shadow_uShadowMap".concat(s)]=t.shadowMaps[s]:r["shadow_uShadowMap".concat(s)]=t.dummyShadowMap;return r}const lC={name:"shadow",dependencies:[jO],vs:zEe,fs:UEe,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?XEe(t,e):{}},ZEe={color:[255,255,255],intensity:1},L$=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],YEe=[0,0,0,200/255];class B5{constructor(e={}){q(this,"id","lighting-effect"),q(this,"props",void 0),q(this,"shadowColor",YEe),q(this,"shadow",void 0),q(this,"ambientLight",void 0),q(this,"directionalLights",void 0),q(this,"pointLights",void 0),q(this,"shadowPasses",[]),q(this,"shadowMaps",[]),q(this,"dummyShadowMap",null),q(this,"programManager",void 0),q(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:r,viewports:i,onViewportActive:o,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=R1.getDefaultProgramManager(e),lC&&this.programManager.addDefaultModule(lC)),this.dummyShadowMap||(this.dummyShadowMap=new Pl(e,{width:1,height:1}));for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:n,layerFilter:r,viewports:i,onViewportActive:o,views:a,moduleParameters:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(lC),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new vr().lookAt({eye:new yt(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new yEe(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new Zte(ZEe),this.directionalLights.push(new nI(L$[0]),new nI(L$[1])))}}class QEe{constructor(e={}){q(this,"_pool",[]),q(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:o=0,copy:a=!1,initialize:s=!1,maxCount:u}){const d=i||e&&e.constructor||Float32Array,g=n*r+o;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,g)}let _=1/0;u&&(_=u*r+o);const E=this._allocate(d,g,s,_);return e&&a?E.set(e):s||E.fill(0,0,4),this._release(e),E}release(e){this._release(e)}_allocate(e,n,r,i){let o=Math.max(Math.ceil(n*this.opts.overAlloc),1);o>i&&(o=i);const a=this._pool,s=e.BYTES_PER_ELEMENT*o,u=a.findIndex(d=>d.byteLength>=s);if(u>=0){const d=new e(a.splice(u,1)[0],0,o);return r&&d.fill(0),d}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,o=n.findIndex(a=>a.byteLength>=i);o<0?n.push(r):(o>0||n.length<this.opts.poolSize)&&n.splice(o,0,r),n.length>this.opts.poolSize&&n.shift()}}const zv=new QEe;function Wb(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function oI(t,e){const n=t%e;return n<0?e+n:n}function KEe(t){return[t[12],t[13],t[14]]}function JEe(t){return{left:_y(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:_y(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:_y(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:_y(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:_y(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:_y(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const D$=new yt;function _y(t,e,n,r){D$.set(t,e,n);const i=D$.len();return{distance:r/i,normal:new yt(-t/i,-e/i,-n/i)}}function hne(t){return t-Math.fround(t)}let ub;function YD(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,o=(i-r)/n;ub=zv.allocate(ub,o,{type:Float32Array,size:n*2});let a=r,s=0;for(;a<i;){for(let u=0;u<n;u++){const d=t[a++];ub[s+u]=d,ub[s+u+n]=hne(d)}s+=n*2}return ub.subarray(0,o*n*2)}function e2e(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const t2e=Math.PI/180,n2e=Wb(),B$=[0,0,0],r2e={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function i2e({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:o,near:a,far:s}){const u=t/e,d=n?new vr().orthographic({fovy:r,aspect:u,focalDistance:i,near:a,far:s}):new vr().perspective({fovy:r,aspect:u,near:a,far:s});if(o){const{left:g=0,right:_=0,top:E=0,bottom:P=0}=o,R=Wi((g+t-_)/2,0,t)-t/2,B=Wi((E+e-P)/2,0,e)-e/2;d[8]-=R*2/t,d[9]+=B*2/e}return d}class zh{constructor(e={}){q(this,"id",void 0),q(this,"x",void 0),q(this,"y",void 0),q(this,"width",void 0),q(this,"height",void 0),q(this,"padding",void 0),q(this,"isGeospatial",void 0),q(this,"zoom",void 0),q(this,"focalDistance",void 0),q(this,"position",void 0),q(this,"modelMatrix",void 0),q(this,"distanceScales",void 0),q(this,"scale",void 0),q(this,"center",void 0),q(this,"cameraPosition",void 0),q(this,"projectionMatrix",void 0),q(this,"viewMatrix",void 0),q(this,"viewMatrixUncentered",void 0),q(this,"viewMatrixInverse",void 0),q(this,"viewProjectionMatrix",void 0),q(this,"pixelProjectionMatrix",void 0),q(this,"pixelUnprojectionMatrix",void 0),q(this,"resolution",void 0),q(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||r2e,this.focalDistance=e.focalDistance||1,this.position=e.position||B$,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?hh.WEB_MERCATOR:hh.WEB_MERCATOR_AUTO_OFFSET:hh.IDENTITY}equals(e){return e instanceof zh?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Sl(e.projectionMatrix,this.projectionMatrix)&&Sl(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=VO(r,this.pixelProjectionMatrix),[o,a]=i,s=n?a:this.height-a;return e.length===2?[o,s]:[o,s,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,o,a]=e,s=n?o:this.height-o,u=r&&r*this.distanceScales.unitsPerMeter[2],d=Ym([i,s,a],this.pixelUnprojectionMatrix,u),[g,_,E]=this.unprojectPosition(d);return Number.isFinite(a)?[g,_,E]:Number.isFinite(r)?[g,_,r]:[g,_]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=El(e);return n[1]=Wi(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?gc(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),o=this.unproject([0,this.height],n),a=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],o[0],a[0]),Math.min(r[1],i[1],o[1],a[1]),Math.max(r[0],i[0],o[0],a[0]),Math.max(r[1],i[1],o[1],a[1])]}getDistanceScales(e){return e?Uw({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,JEe(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=I5({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Uw({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:o,modelMatrix:a}=e;let s=B$;if(o&&(s=a?new vr(a).transformAsVector(o,[]):o),this.isGeospatial){const u=this.projectPosition([n,r,0]);this.center=new yt(s).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:n=n2e,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:o,fovy:a=75,near:s=.1,far:u=1e3,padding:d=null,focalDistance:g=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new vr().multiplyRight(n).translate(new yt(this.center).negate()),this.projectionMatrix=r||i2e({width:this.width,height:this.height,orthographic:i,fovyRadians:o||a*t2e,focalDistance:g,padding:d,near:s,far:u});const _=Wb();kd(_,_,this.projectionMatrix),kd(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=eI([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=KEe(this.viewMatrixInverse);const E=Wb(),P=Wb();FO(E,E,[this.width/2,-this.height/2,1]),zw(E,E,[1,-1,0]),kd(P,E,this.viewProjectionMatrix),this.pixelProjectionMatrix=P,this.pixelUnprojectionMatrix=eI(Wb(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Or.warn("Pixel project matrix not invertible")()}}q(zh,"displayName","Viewport");class ug extends zh{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:o=0,bearing:a=0,nearZMultiplier:s=.1,farZMultiplier:u=1.01,nearZ:d,farZ:g,orthographic:_=!1,projectionMatrix:E,repeat:P=!1,worldOffset:R=0,position:B,padding:V,legacyMeterSizes:z=!1}=e;let{width:F,height:k,altitude:X=1.5}=e;const Y=Math.pow(2,i);F=F||1,k=k||1;let J,ie=null;if(E)X=E[5]/2,J=B0(X);else{e.fovy?(J=e.fovy,X=BE(J)):J=B0(X);let re;if(V){const{top:ue=0,bottom:se=0}=V;re=[0,Wi((ue+k-se)/2,0,k)-k/2]}ie=R5({width:F,height:k,scale:Y,center:B&&[0,0,B[2]*aC(n)],offset:re,pitch:o,fovy:J,nearZMultiplier:s,farZMultiplier:u}),Number.isFinite(d)&&(ie.near=d),Number.isFinite(g)&&(ie.far=g)}let ce=O5({height:k,pitch:o,bearing:a,scale:Y,altitude:X});R&&(ce=new vr().translate([512*R,0,0]).multiplyLeft(ce)),super({...e,width:F,height:k,viewMatrix:ce,longitude:r,latitude:n,zoom:i,...ie,fovy:J,focalDistance:X}),q(this,"longitude",void 0),q(this,"latitude",void 0),q(this,"pitch",void 0),q(this,"bearing",void 0),q(this,"altitude",void 0),q(this,"fovy",void 0),q(this,"orthographic",void 0),q(this,"_subViewports",void 0),q(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=o,this.bearing=a,this.altitude=X,this.fovy=J,this.orthographic=_,this._subViewports=P?[]:null,this._pseudoMeters=z,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const o=i?new ug({...this,worldOffset:i}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*aC(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/aC(r);return[n,r,i]}addMetersToLngLat(e,n){return M5(e,n)}panByPosition(e,n){const r=Ym(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),o=D0([],i,y5([],r)),a=D0([],this.center,o),[s,u]=this.unprojectFlat(a);return{longitude:s,latitude:u}}getBounds(e={}){const n=D5(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:o,latitude:a,zoom:s}=L5({width:r,height:i,bounds:e,...n});return new ug({width:r,height:i,longitude:o,latitude:a,zoom:s})}}q(ug,"displayName","WebMercatorViewport");const N$=[0,0,0];function QD(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof ug){const[i,o,a=0]=t,s=e.getDistanceScales([i,o]);r[2]=a*s.unitsPerMeter[2]}return r}function o2e(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:o,fromCoordinateOrigin:a}=t;return i===Br.DEFAULT&&(i=e.isGeospatial?Br.LNGLAT:Br.CARTESIAN),o===void 0&&(o=i),a===void 0&&(a=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:o,fromCoordinateOrigin:a}}function dne(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:o}){let[a,s,u=0]=t;switch(n&&([a,s,u]=O1([],[a,s,u,1],n)),r){case Br.LNGLAT:return QD([a,s,u],e,o);case Br.LNGLAT_OFFSETS:return QD([a+i[0],s+i[1],u+(i[2]||0)],e,o);case Br.METER_OFFSETS:return QD(M5(i,[a,s,u]),e,o);case Br.CARTESIAN:default:return e.isGeospatial?[a+i[0],s+i[1],u+i[2]]:e.projectPosition([a,s,u])}}function pne(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:o,fromCoordinateSystem:a,fromCoordinateOrigin:s}=o2e(e),{autoOffset:u=!0}=e,{geospatialOrigin:d=N$,shaderCoordinateOrigin:g=N$,offsetMode:_=!1}=u?tne(n,r,i):{},E=dne(t,{viewport:n,modelMatrix:o,coordinateSystem:a,coordinateOrigin:s,offsetMode:_});if(_){const P=n.projectPosition(d||g);Rte(E,E,P)}return E}const s2e=[255,255,255],a2e=1,l2e=[0,0,1],u2e=[0,0,1];let c2e=0;class gne{constructor(e={}){q(this,"id",void 0),q(this,"color",void 0),q(this,"intensity",void 0),q(this,"type","point"),q(this,"position",void 0),q(this,"attenuation",void 0),q(this,"projectedLight",void 0);const{color:n=s2e}=e,{intensity:r=a2e}=e,{position:i=u2e}=e;this.id=e.id||"point-".concat(c2e++),this.color=n,this.intensity=r,this.type="point",this.position=i,this.attenuation=f2e(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:n}=this,r=e.context.viewport,{coordinateSystem:i,coordinateOrigin:o}=e.props,a=pne(this.position,{viewport:r,coordinateSystem:i,coordinateOrigin:o,fromCoordinateSystem:r.isGeospatial?Br.LNGLAT:Br.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return n.color=this.color,n.intensity=this.intensity,n.position=a,n}}function f2e(t){return t.attenuation?t.attenuation:"intensity"in t?[0,0,t.intensity||0]:l2e}class h2e extends gne{getProjectedLight({layer:e}){const{projectedLight:n}=this,r=e.context.viewport,{coordinateSystem:i,coordinateOrigin:o,modelMatrix:a}=e.props,{project_uCameraPosition:s}=nne({viewport:r,modelMatrix:a,coordinateSystem:i,coordinateOrigin:o});return n.color=this.color,n.intensity=this.intensity,n.position=s,n}}const N0=Math.PI/180,d2e=1e3*60*60*24,p2e=2440588,g2e=2451545,sI=N0*23.4397,m2e=357.5291,A2e=.98560028,_2e=280.147,y2e=360.9856235;function v2e(t,e,n){const r=N0*-n,i=N0*e,o=b2e(t),a=M2e(o),s=C2e(o,r)-a.rightAscension;return{azimuth:S2e(s,i,a.declination),altitude:T2e(s,i,a.declination)}}function F$(t,e,n){const{azimuth:r,altitude:i}=v2e(t,e,n);return[Math.sin(r)*Math.cos(i),Math.cos(r)*Math.cos(i),-Math.sin(i)]}function x2e(t){return(typeof t=="number"?t:t.getTime())/d2e-.5+p2e}function b2e(t){return x2e(t)-g2e}function w2e(t,e){const n=t;return Math.atan2(Math.sin(n)*Math.cos(sI)-Math.tan(e)*Math.sin(sI),Math.cos(n))}function E2e(t,e){const n=t;return Math.asin(Math.sin(e)*Math.cos(sI)+Math.cos(e)*Math.sin(sI)*Math.sin(n))}function S2e(t,e,n){const r=t,i=e,o=n;return Math.atan2(Math.sin(r),Math.cos(r)*Math.sin(i)-Math.tan(o)*Math.cos(i))}function T2e(t,e,n){const r=t,i=e,o=n;return Math.asin(Math.sin(i)*Math.sin(o)+Math.cos(i)*Math.cos(o)*Math.cos(r))}function C2e(t,e){return N0*(_2e+y2e*t)-e}function P2e(t){return N0*(m2e+A2e*t)}function I2e(t){const e=t,n=N0*(1.9148*Math.sin(e)+.02*Math.sin(2*e)+3e-4*Math.sin(3*e)),r=N0*102.9372;return e+n+r+Math.PI}function M2e(t){const e=P2e(t),n=I2e(e);return{declination:E2e(n,0),rightAscension:w2e(n,0)}}class O2e extends nI{constructor(e){super(e),q(this,"timestamp",void 0),this.timestamp=e.timestamp}getProjectedLight({layer:e}){const{viewport:n}=e.context;if(n.resolution&&n.resolution>0){const[i,o,a]=F$(this.timestamp,0,0);this.direction=[i,-a,o]}else{const{latitude:i,longitude:o}=n;this.direction=F$(this.timestamp,i,o)}return this}}class k$ extends Yte{constructor(e,n){super(e,n),q(this,"model",void 0);const{module:r,fs:i,id:o}=n;this.model=new Xte(e,{id:o,fs:i,modules:[r]})}render(e){const n=this.gl;bh(n,{viewport:[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}),Mu(n,{framebuffer:e.outputBuffer,clearColor:[0,0,0,0]},()=>this._renderPass(n,e))}delete(){this.model.delete(),this.model=null}_renderPass(e,n){const{inputBuffer:r}=n;ME(e,{color:!0}),this.model.draw({moduleSettings:n.moduleSettings,uniforms:{texture:r,texSize:[r.width,r.height]},parameters:{depthWrite:!1,depthTest:!1}})}}class R2e{constructor(e,n={}){q(this,"id",void 0),q(this,"props",void 0),q(this,"module",void 0),q(this,"passes",void 0),this.id="".concat(e.name,"-pass"),this.props=n,lte(e),this.module=e}setProps(e){this.props=e}preRender(){}postRender(e,n){const r=this.passes||L2e(e,this.module,this.id);this.passes=r;const{target:i}=n;let o=n.inputBuffer,a=n.swapBuffer;for(let s=0;s<this.passes.length;s++){i&&s===this.passes.length-1&&(a=i),this.passes[s].render({inputBuffer:o,outputBuffer:a,moduleSettings:this.props});const u=a;a=o,o=u}return o}cleanup(){if(this.passes){for(const e of this.passes)e.delete();this.passes=void 0}}}function L2e(t,e,n){if(!e.passes){const r=z$(e);return[new k$(t,{id:n,module:e,fs:r})]}return e.passes.map((r,i)=>{const o=z$(e,r),a="".concat(n,"-").concat(i);return new k$(t,{id:a,module:e,fs:o})})}const D2e=t=>`uniform sampler2D texture;
uniform vec2 texSize;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main() {
  vec2 texCoord = coordinate;

  gl_FragColor = texture2D(texture, texCoord);
  gl_FragColor = `.concat(t,`(gl_FragColor, texSize, texCoord);
}
`),B2e=t=>`uniform sampler2D texture;
uniform vec2 texSize;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main() {
  vec2 texCoord = coordinate;

  gl_FragColor = `.concat(t,`(texture, texSize, texCoord);
}
`);function z$(t,e=t){if(e.filter){const n=typeof e.filter=="string"?e.filter:"".concat(t.name,"_filterColor");return D2e(n)}if(e.sampler){const n=typeof e.sampler=="string"?e.sampler:"".concat(t.name,"_sampleColor");return B2e(n)}return null}const U$={blendFunc:[1,0,32771,0],blendEquation:32774};class N5 extends GO{constructor(...e){super(...e),q(this,"pickZ",void 0),q(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:o,pickingFBO:a,deviceRect:{x:s,y:u,width:d,height:g},cullRect:_,effects:E,pass:P="picking",pickZ:R,moduleParameters:B}){const V=this.gl;this.pickZ=R;const z=this._resetColorEncoder(R),F=Mu(V,{scissorTest:!0,scissor:[s,u,d,g],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...U$,blend:!R},()=>super.render({target:a,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:o,cullRect:_,effects:E==null?void 0:E.filter(X=>X.useInPicking),pass:P,isPicking:!0,moduleParameters:B}));return this._colorEncoderState=null,{decodePickingColor:z&&F2e.bind(null,z),stats:F}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,r){const i={...e.props.parameters},{pickable:o,operation:a}=e.props;return this._colorEncoderState?o&&a.includes("draw")&&(Object.assign(i,U$),i.blend=!0,i.blendColor=N2e(this._colorEncoderState,e,r)):i.blend=!1,a.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function N2e(t,e,n){const{byLayer:r,byAlpha:i}=t;let o,a=r.get(e);return a?(a.viewports.push(n),o=a.a):(o=r.size+1,o<=255?(a={a:o,layer:e,viewports:[n]},r.set(e,a),i[o]=a):(Or.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function F2e(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Ny={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},aI=Symbol.for("component"),Gm=Symbol.for("propTypes"),KD=Symbol.for("deprecatedProps"),Av=Symbol.for("asyncPropDefaults"),F0=Symbol.for("asyncPropOriginal"),Pm=Symbol.for("asyncPropResolved");function NE(t,e=()=>!0){return Array.isArray(t)?mne(t,e,[]):e(t)?[t]:[]}function mne(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?mne(i,e,n):e(i)&&n.push(i)}return n}function Ane({target:t,source:e,start:n=0,count:r=1}){const i=e.length,o=r*i;let a=0;for(let s=n;a<i;a++)t[s++]=e[a];for(;a<o;)a<o-a?(t.copyWithin(n+a,n,n+a),a*=2):(t.copyWithin(n+a,n,n+o-a),a=o);return t}class k2e{constructor(e,n,r){q(this,"id",void 0),q(this,"context",void 0),q(this,"isLoaded",void 0),q(this,"persistent",void 0),q(this,"_loadCount",0),q(this,"_subscribers",new Set),q(this,"_data",void 0),q(this,"_loader",void 0),q(this,"_error",void 0),q(this,"_content",void 0),this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=ag(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class z2e{constructor({gl:e,protocol:n}){q(this,"protocol",void 0),q(this,"_context",void 0),q(this,"_resources",void 0),q(this,"_consumers",void 0),q(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let o=this._resources[e];o?o.setData(n,r):(o=new k2e(e,n,this._context),this._resources[e]=o),o.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],o=this._resources[i.resourceId];o&&o.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:o,protocol:a}=this;e.startsWith(a)&&(e=e.replace(a,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));const s=o[e];if(this._track(r,i,s,n),s)return s.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const o=this._consumers,a=o[e]=o[e]||{},s=a[n]||{},u=s.resourceId&&this._resources[s.resourceId];u&&(u.unsubscribe(s),this.prune()),r&&(a[n]=s,s.onChange=i,s.resourceId=r.id,r.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const U2e=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Mc={name:"project32",dependencies:[jO],vs:U2e},Oc={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...$te},G2e=[jO],j2e=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function V2e(t){const e=R1.getDefaultProgramManager(t);for(const n of G2e)e.addDefaultModule(n);for(const n of j2e)e.addShaderHook(n);return e}const $2e="layerManager.setLayers",H2e="layerManager.activateViewport";class _ne{constructor(e,{deck:n,stats:r,viewport:i,timeline:o}={}){q(this,"layers",void 0),q(this,"context",void 0),q(this,"resourceManager",void 0),q(this,"_lastRenderedLayers",[]),q(this,"_needsRedraw",!1),q(this,"_needsUpdate",!1),q(this,"_nextLayers",null),q(this,"_debug",!1),q(this,"activateViewport",a=>{_l(H2e,this,a),a&&(this.context.viewport=a)}),this.layers=[],this.resourceManager=new z2e({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&V2e(e),stats:r||new a5({id:"deck.gl"}),viewport:i||new zh({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new T5,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){_l($2e,this,n,e),this._lastRenderedLayers=e;const r=NE(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,r){r.raiseError(n,"".concat(e," of ").concat(r))}_updateLayers(e,n){const r={};for(const a of e)r[a.id]?Or.warn("Multiple old layers with same id ".concat(a.id))():r[a.id]=a;const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let o=!1;for(const a of i)if(a.hasUniformTransition()){o="Uniform transition in ".concat(a);break}this._needsUpdate=o,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const o=n[i.id];o===null&&Or.warn("Multiple new layers with same id ".concat(i.id))(),n[i.id]=null;let a=null;try{this._debug&&o!==i&&i.validateProps(),o?(this._transferLayerState(o,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),a=i.isComposite?i.getSubLayers():null}catch(s){this._handleError("matching",s,i)}a&&this._updateSublayersRecursively(a,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Ny.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Ny.MATCHED,n!==e&&(e.lifecycle=Ny.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Ny.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Ny.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function uc(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!uc(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const o of r)if(!e.hasOwnProperty(o)||!uc(t[o],e[o],n-1))return!1;return!0}return!1}class W2e{constructor(e){q(this,"width",void 0),q(this,"height",void 0),q(this,"views",void 0),q(this,"viewState",void 0),q(this,"controllers",void 0),q(this,"timeline",void 0),q(this,"_viewports",void 0),q(this,"_viewportMap",void 0),q(this,"_isUpdating",void 0),q(this,"_needsRedraw",void 0),q(this,"_needsUpdate",void 0),q(this,"_eventManager",void 0),q(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let o=r.length-1;o>=0;--o){const a=r[o];if(a.containsPixel(i)){const s=e.slice();return s[0]-=a.x,s[1]-=a.y,a.unproject(s,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=NE(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!uc(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Or.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var a;return(a=this.getView(e.id))===null||a===void 0?void 0:a.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const o=e.controller;if(o&&r){const a={...n,...o,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==o.type)&&(i=this._createController(e,a)),i&&i.setProps(a),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const o=e[i],a=this.getViewState(o),s=o.makeViewport({viewState:a,width:this.width,height:this.height});let u=n[o.id];const d=!!o.controller;d&&!u&&(r=!0),(r||!d)&&u&&(u.finalize(),u=null),this.controllers[o.id]=this._updateController(o,a,s,u),s&&this._viewports.unshift(s)}for(const i in n){const o=n[i];o&&!this.controllers[i]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const q2e=/([0-9]+\.?[0-9]*)(%|px)/;function cm(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=q2e.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function fm(t,e){return t.relative?Math.round(t.position*e):t.position}function ia(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Sh{constructor(e){q(this,"id",void 0),q(this,"viewportInstance",void 0),q(this,"_x",void 0),q(this,"_y",void 0),q(this,"_width",void 0),q(this,"_height",void 0),q(this,"_padding",void 0),q(this,"props",void 0);const{id:n,x:r=0,y:i=0,width:o="100%",height:a="100%",padding:s=null,viewportInstance:u}=e||{};ia(!u||u instanceof zh),this.viewportInstance=u,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=cm(r),this._y=cm(i),this._width=cm(o),this._height=cm(a),this._padding=s&&{left:cm(s.left||0),right:cm(s.right||0),top:cm(s.top||0),bottom:cm(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&uc(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:fm(this._x,e),y:fm(this._y,n),width:fm(this._width,e),height:fm(this._height,n)};return this._padding&&(r.padding={left:fm(this._padding.left,e),top:fm(this._padding.top,n),right:fm(this._padding.right,e),bottom:fm(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}let FE=class{constructor(e){q(this,"_inProgress",void 0),q(this,"_handle",void 0),q(this,"_timeline",void 0),q(this,"time",void 0),q(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(n=(r=this.settings).onStart)===null||n===void 0||n.call(r,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}};const G$=()=>{},lI={BREAK:1,SNAP_TO_END:2,IGNORE:3},X2e=t=>t,Z2e=lI.BREAK;class Y2e{constructor(e){q(this,"getControllerState",void 0),q(this,"props",void 0),q(this,"propsInTransition",void 0),q(this,"transition",void 0),q(this,"onViewStateChange",void 0),q(this,"onStateChange",void 0),q(this,"_onTransitionUpdate",n=>{const{time:r,settings:{interpolator:i,startProps:o,endProps:a,duration:s,easing:u}}=n,d=u(r/s),g=i.interpolateProps(o,a,d);this.propsInTransition=this.getControllerState({...this.props,...g}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new FE(e.timeline),this.onViewStateChange=e.onViewStateChange||G$,this.onStateChange=e.onStateChange||G$}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:o,endProps:a}=this.transition.settings;i={...r,...o===lI.SNAP_TO_END?a:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===lI.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),o=n.transitionInterpolator,a=o.getDuration?o.getDuration(e,n):n.transitionDuration;if(a===0)return;const s=o.initializeProps(e,i);this.propsInTransition={};const u={duration:a,easing:n.transitionEasing||X2e,interpolator:o,interruption:n.transitionInterruption||Z2e,startProps:s.start,endProps:s.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class F5{constructor(e){q(this,"_propsToCompare",void 0),q(this,"_propsToExtract",void 0),q(this,"_requiredProps",void 0);const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!Sl(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const o of this._propsToExtract)(o in e||o in n)&&(r[o]=e[o],i[o]=n[o]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];ia(Number.isFinite(r)||Array.isArray(r),"".concat(n," is required for transition"))})}}const Q2e=["longitude","latitude","zoom","bearing","pitch"],K2e=["longitude","latitude","zoom"];class u_ extends F5{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:Q2e,required:K2e},super(r.transitionProps),q(this,"opts",void 0),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:o}=this.opts;if(i&&o){const a=i(e),s=i(n),u=a.unproject(o);r.start.around=o,Object.assign(r.end,{around:s.project(u),aroundPosition:u,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const o of this._propsToExtract)i[o]=pc(e[o]||0,n[o]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...n,...i});Object.assign(i,o.panByPosition(n.aroundPosition,pc(e.around,n.around,r)))}return i}}const hm={transitionDuration:0},J2e=300,DS=t=>1-(1-t)*(1-t),yy={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},s0={};class D1{constructor(e){q(this,"props",void 0),q(this,"state",{}),q(this,"transitionManager",void 0),q(this,"eventManager",void 0),q(this,"onViewStateChange",void 0),q(this,"onStateChange",void 0),q(this,"makeViewport",void 0),q(this,"_controllerState",void 0),q(this,"_events",{}),q(this,"_interactionState",{isDragging:!1}),q(this,"_customEvents",[]),q(this,"_eventStartBlocked",null),q(this,"_panMove",!1),q(this,"invertPan",!1),q(this,"dragMode","rotate"),q(this,"inertia",0),q(this,"scrollZoom",!0),q(this,"dragPan",!0),q(this,"dragRotate",!0),q(this,"doubleClickZoom",!0),q(this,"touchZoom",!0),q(this,"touchRotate",!1),q(this,"keyboard",!0),this.transitionManager=new Y2e({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const o=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return o&&n&&n.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?J2e:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:o=!0,doubleClickZoom:a=!0,touchZoom:s=!0,touchRotate:u=!1,keyboard:d=!0}=e,g=!!this.onViewStateChange;this.toggleEvents(yy.WHEEL,g&&r),this.toggleEvents(yy.PAN,g),this.toggleEvents(yy.PINCH,g&&(s||u)),this.toggleEvents(yy.TRIPLE_PAN,g&&u),this.toggleEvents(yy.DOUBLE_TAP,g&&a),this.toggleEvents(yy.KEYBOARD,g&&d),this.scrollZoom=r,this.dragPan=i,this.dragRotate=o,this.doubleClickZoom=a,this.touchZoom=s,this.touchRotate=u,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),o){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:a})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,hm,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,hm,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],o=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:DS},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,hm,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],o=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:DS},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let a=2/(1+Math.exp(-Math.abs(o*r)));o<0&&a!==0&&(a=1/a);const s=this.controllerState.zoom({pos:n,scale:a});return this.updateViewport(s,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,hm,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,hm,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],o=this.controllerState.rotate({pos:i});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:DS},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return s0._startPinchRotation=e.rotation,s0._lastPinchEvent=e,this.updateViewport(r,hm,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:s0._startPinchRotation-r})}return this.updateViewport(n,hm,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),s0._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=s0;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let o=this.controllerState.rotateEnd();const a=Math.log2(e.scale),s=(a-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),u=Math.pow(2,a+s*n/2);o=o.zoom({pos:i,scale:u}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:DS},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return s0._startPinchRotation=null,s0._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:o,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:s}=this;let u;const d={};switch(e.srcEvent.code){case"Minus":u=n?s.zoomOut(r).zoomOut(r):s.zoomOut(r),d.isZooming=!0;break;case"Equal":u=n?s.zoomIn(r).zoomIn(r):s.zoomIn(r),d.isZooming=!0;break;case"ArrowLeft":n?(u=s.rotateLeft(o),d.isRotating=!0):(u=s.moveLeft(i),d.isPanning=!0);break;case"ArrowRight":n?(u=s.rotateRight(o),d.isRotating=!0):(u=s.moveRight(i),d.isPanning=!0);break;case"ArrowUp":n?(u=s.rotateUp(a),d.isRotating=!0):(u=s.moveUp(i),d.isPanning=!0);break;case"ArrowDown":n?(u=s.rotateDown(a),d.isRotating=!0):(u=s.moveDown(i),d.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?hm:e?{...n,transitionInterpolator:new u_({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class k5{constructor(e,n){q(this,"_viewportProps",void 0),q(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const j$=5,eSe=1.2;class yne extends k5{constructor(e){const{width:n,height:r,latitude:i,longitude:o,zoom:a,bearing:s=0,pitch:u=0,altitude:d=1.5,position:g=[0,0,0],maxZoom:_=20,minZoom:E=0,maxPitch:P=60,minPitch:R=0,startPanLngLat:B,startZoomLngLat:V,startRotatePos:z,startBearing:F,startPitch:k,startZoom:X,normalize:Y=!0}=e;ia(Number.isFinite(o)),ia(Number.isFinite(i)),ia(Number.isFinite(a)),super({width:n,height:r,latitude:i,longitude:o,zoom:a,bearing:s,pitch:u,altitude:d,maxZoom:_,minZoom:E,maxPitch:P,minPitch:R,normalize:Y,position:g},{startPanLngLat:B,startZoomLngLat:V,startRotatePos:z,startBearing:F,startPitch:k,startZoom:X}),q(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:o,startPitch:a}=this.getState();if(!i||o===void 0||a===void 0)return this;let s;return e?s=this._getNewRotation(e,i,a,o):s={bearing:o+n,pitch:a+r},this._getUpdatedState(s)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:o}=this.getState();if(o||(i=this.getViewportProps().zoom,o=this._unproject(n)||this._unproject(e)),!o)return this;const{maxZoom:a,minZoom:s}=this.getViewportProps();let u=i+Math.log2(r);u=Wi(u,s,a);const d=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...d.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:o}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(o-n.longitude)>180&&(r.longitude=o<0?o+360:o-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=Wi(i,r,n);const{maxPitch:o,minPitch:a,pitch:s}=e;e.pitch=Wi(s,a,o);const{normalize:u=!0}=e;return u&&Object.assign(e,sne(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const o=e[0]-n[0],a=e[1]-n[1],s=e[1],u=n[1],{width:d,height:g}=this.getViewportProps(),_=o/d;let E=0;a>0?Math.abs(g-u)>j$&&(E=a/(u-g)*eSe):a<0&&u>j$&&(E=1-s/u),E=Wi(E,-1,1);const{minPitch:P,maxPitch:R}=this.getViewportProps(),B=i+180*_;let V=r;return E>0?V=r+E*(R-r):E<0&&(V=r-E*(P-r)),{pitch:V,bearing:B}}}class vne extends D1{constructor(...e){super(...e),q(this,"ControllerState",yne),q(this,"transition",{transitionDuration:300,transitionInterpolator:new u_({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),q(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class $O extends Sh{get ViewportType(){return ug}get ControllerType(){return vne}}q($O,"displayName","MapView");const tSe=new B5;function nSe(t,e){var n,r;const i=(n=t.order)!==null&&n!==void 0?n:1/0,o=(r=e.order)!==null&&r!==void 0?r:1/0;return i-o}class rSe{constructor(){q(this,"effects",void 0),q(this,"_resolvedEffects",[]),q(this,"_defaultEffects",[]),q(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>nSe(i,e)>0);r<0?n.push(e):n.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(uc(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const o=n[i.id];o&&o!==i?o.setProps?(o.setProps(i.props),r.push(o)):(o.cleanup(),r.push(i)):r.push(i),delete n[i.id]}for(const i in n)n[i].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof B5)||this._resolvedEffects.push(tSe),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class iSe extends GO{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const oSe="deckRenderer.renderLayers";class xne{constructor(e){q(this,"gl",void 0),q(this,"layerFilter",void 0),q(this,"drawPickingColors",void 0),q(this,"drawLayersPass",void 0),q(this,"pickLayersPass",void 0),q(this,"renderCount",void 0),q(this,"_needsRedraw",void 0),q(this,"renderBuffers",void 0),q(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new iSe(e),this.pickLayersPass=new N5(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||Ws.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,o=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,_l(oSe,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(this.gl,n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Ws(this.gl),new Ws(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const o of e)if(o.postRender){if(o.id===this.lastPostProcessEffect){i.target=n.target,o.postRender(this.gl,i);break}const a=o.postRender(this.gl,i);i.inputBuffer=a,i.swapBuffer=a===r[0]?r[1]:r[0]}}}const sSe={pickedColor:null,pickedObjectIndex:-1};function aSe({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:o}){const{x:a,y:s,width:u,height:d}=o;let g=i*i,_=-1,E=0;for(let P=0;P<d;P++){const R=P+s-r,B=R*R;if(B>g)E+=4*u;else for(let V=0;V<u;V++){if(t[E+3]-1>=0){const F=V+a-n,k=F*F+B;k<=g&&(g=k,_=E)}E+=4}}if(_>=0){const P=t.slice(_,_+4),R=e(P);if(R){const B=Math.floor(_/4/u),V=_/4-B*u;return{...R,pickedColor:P,pickedX:a+V,pickedY:s+B}}Or.error("Picked non-existent layer. Is picking buffer corrupt?")()}return sSe}function lSe({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const o=t.slice(r,r+4),a=o.join(",");if(!n.has(a)){const s=e(o);s?n.set(a,{...s,color:o}):Or.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function bne({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:o}){let a=e[0];e.length>1&&(a=cSe((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let s;if(a){const u=[r-a.x,i-a.y];o!==void 0&&(u[2]=o),s=a.unproject(u)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:s,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function uSe(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:o,pickedLayer:a,pickedObjectIndex:s}=e,u=a?[a]:[];if(r==="hover"){const _=n.index,E=n.layerId,P=a?a.props.id:null;if(P!==E||s!==_){if(P!==E){const R=i.find(B=>B.props.id===E);R&&u.unshift(R)}n.layerId=P,n.index=s,n.info=null}}const d=bne(t),g=new Map;return g.set(null,d),u.forEach(_=>{let E={...d};_===a&&(E.color=o,E.index=s,E.picked=!0),E=wne({layer:_,info:E,mode:r});const P=E.layer;_===a&&r==="hover"&&(n.info=E),g.set(P.id,E),r==="hover"&&P.updateAutoHighlight(E)}),g}function wne({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function cSe(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class fSe{constructor(e){q(this,"gl",void 0),q(this,"pickingFBO",void 0),q(this,"depthFBO",void 0),q(this,"pickLayersPass",void 0),q(this,"layerFilter",void 0),q(this,"lastPickedInfo",void 0),q(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new N5(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},o=this.lastPickedInfo.info){const a=o&&o.layer&&o.layer.id,s=o&&o.viewport&&o.viewport.id,u=a?r.find(E=>E.id===a):null,d=s&&i.find(E=>E.id===s)||i[0],g=d&&d.unproject([e-d.x,n-d.y]);return{...o,...{x:e,y:n,viewport:d,coordinate:g,layer:u}}}_resizeBuffer(){var e,n;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new Ws(r),Ws.isSupported(r,{colorBufferFloat:!0}))){const i=new Ws(r);i.attach({36064:new Pl(r,{format:Hr(r)?34836:6408,type:5126})}),this.depthFBO=i}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:o,radius:a=0,depth:s=1,mode:u="query",unproject3D:d,onViewportActive:g,effects:_}){const E=this._getPickable(e),P=R0(this.gl);if(!E)return{result:[],emptyInfo:bne({viewports:r,x:i,y:o,pixelRatio:P})};this._resizeBuffer();const R=KT(this.gl,[i,o],!0),B=[R.x+Math.floor(R.width/2),R.y+Math.floor(R.height/2)],V=Math.round(a*P),{width:z,height:F}=this.pickingFBO,k=this._getPickingRect({deviceX:B[0],deviceY:B[1],deviceRadius:V,deviceWidth:z,deviceHeight:F}),X={x:i-a,y:o-a,width:a*2+1,height:a*2+1};let Y;const J=[],ie=new Set;for(let ce=0;ce<s;ce++){let re;if(k){const se=this._drawAndSample({layers:E,views:n,viewports:r,onViewportActive:g,deviceRect:k,cullRect:X,effects:_,pass:"picking:".concat(u)});re=aSe({...se,deviceX:B[0],deviceY:B[1],deviceRadius:V,deviceRect:k})}else re={pickedColor:null,pickedObjectIndex:-1};let ue;if(re.pickedLayer&&d&&this.depthFBO){const{pickedColors:se}=this._drawAndSample({layers:[re.pickedLayer],views:n,viewports:r,onViewportActive:g,deviceRect:{x:re.pickedX,y:re.pickedY,width:1,height:1},cullRect:X,effects:_,pass:"picking:".concat(u,":z")},!0);se[3]&&(ue=se[0])}re.pickedLayer&&ce+1<s&&(ie.add(re.pickedLayer),re.pickedLayer.disablePickingIndex(re.pickedObjectIndex)),Y=uSe({pickInfo:re,lastPickedInfo:this.lastPickedInfo,mode:u,layers:E,viewports:r,x:i,y:o,z:ue,pixelRatio:P});for(const se of Y.values())se.layer&&J.push(se);if(!re.pickedColor)break}for(const ce of ie)ce.restorePickingColors();return{result:J,emptyInfo:Y.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:o,width:a=1,height:s=1,mode:u="query",maxObjects:d=null,onViewportActive:g,effects:_}){const E=this._getPickable(e);if(!E)return[];this._resizeBuffer();const P=R0(this.gl),R=KT(this.gl,[i,o],!0),B=R.x,V=R.y+R.height,z=KT(this.gl,[i+a,o+s],!0),F=z.x+z.width,k=z.y,X={x:B,y:k,width:F-B,height:V-k},Y=this._drawAndSample({layers:E,views:n,viewports:r,onViewportActive:g,deviceRect:X,cullRect:{x:i,y:o,width:a,height:s},effects:_,pass:"picking:".concat(u)}),J=lSe(Y),ie=new Map,ce=Number.isFinite(d);for(let re=0;re<J.length&&!(ce&&d&&ie.size>=d);re++){const ue=J[re];let se={color:ue.pickedColor,layer:null,index:ue.pickedObjectIndex,picked:!0,x:i,y:o,pixelRatio:P};se=wne({layer:ue.pickedLayer,info:se,mode:u}),ie.has(se.object)||ie.set(se.object,se)}return Array.from(ie.values())}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:o,cullRect:a,effects:s,pass:u},d=!1){const g=d?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:g,deviceRect:o,cullRect:a,effects:s,pass:u,pickZ:d,preRenderStats:{}};for(const F of s)F.useInPicking&&(_.preRenderStats[F.id]=F.preRender(this.gl,_));const{decodePickingColor:E}=this.pickLayersPass.render(_),{x:P,y:R,width:B,height:V}=o,z=new(d?Float32Array:Uint8Array)(B*V*4);return OE(g,{sourceX:P,sourceY:R,sourceWidth:B,sourceHeight:V,target:z}),{pickedColors:z,decodePickingColor:E}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:o}){const a=Math.max(0,e-r),s=Math.max(0,n-r),u=Math.min(i,e+r+1)-a,d=Math.min(o,n+r+1)-s;return u<=0||d<=0?null:{x:a,y:s,width:u,height:d}}}const hSe={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};let dSe=class{constructor(e){q(this,"el",null),q(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,hSe),n.appendChild(this.el))}setTooltip(e,n,r){const i=this.el;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(n,"px, ").concat(r,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}};var Ene={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,i){var o=["","webkit","Moz","MS","ms","o"],a=n.createElement("div"),s="function",u=Math.round,d=Math.abs,g=Date.now;function _(ye,Oe,He){return setTimeout(k(ye,He),Oe)}function E(ye,Oe,He){return Array.isArray(ye)?(P(ye,He[Oe],He),!0):!1}function P(ye,Oe,He){var Ot;if(ye)if(ye.forEach)ye.forEach(Oe,He);else if(ye.length!==i)for(Ot=0;Ot<ye.length;)Oe.call(He,ye[Ot],Ot,ye),Ot++;else for(Ot in ye)ye.hasOwnProperty(Ot)&&Oe.call(He,ye[Ot],Ot,ye)}function R(ye,Oe,He){var Ot="DEPRECATED METHOD: "+Oe+`
`+He+` AT 
`;return function(){var on=new Error("get-stack-trace"),Fn=on&&on.stack?on.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Rr=e.console&&(e.console.warn||e.console.log);return Rr&&Rr.call(e.console,Ot,Fn),ye.apply(this,arguments)}}var B;typeof Object.assign!="function"?B=function(Oe){if(Oe===i||Oe===null)throw new TypeError("Cannot convert undefined or null to object");for(var He=Object(Oe),Ot=1;Ot<arguments.length;Ot++){var on=arguments[Ot];if(on!==i&&on!==null)for(var Fn in on)on.hasOwnProperty(Fn)&&(He[Fn]=on[Fn])}return He}:B=Object.assign;var V=R(function(Oe,He,Ot){for(var on=Object.keys(He),Fn=0;Fn<on.length;)(!Ot||Ot&&Oe[on[Fn]]===i)&&(Oe[on[Fn]]=He[on[Fn]]),Fn++;return Oe},"extend","Use `assign`."),z=R(function(Oe,He){return V(Oe,He,!0)},"merge","Use `assign`.");function F(ye,Oe,He){var Ot=Oe.prototype,on;on=ye.prototype=Object.create(Ot),on.constructor=ye,on._super=Ot,He&&B(on,He)}function k(ye,Oe){return function(){return ye.apply(Oe,arguments)}}function X(ye,Oe){return typeof ye==s?ye.apply(Oe&&Oe[0]||i,Oe):ye}function Y(ye,Oe){return ye===i?Oe:ye}function J(ye,Oe,He){P(ue(Oe),function(Ot){ye.addEventListener(Ot,He,!1)})}function ie(ye,Oe,He){P(ue(Oe),function(Ot){ye.removeEventListener(Ot,He,!1)})}function ce(ye,Oe){for(;ye;){if(ye==Oe)return!0;ye=ye.parentNode}return!1}function re(ye,Oe){return ye.indexOf(Oe)>-1}function ue(ye){return ye.trim().split(/\s+/g)}function se(ye,Oe,He){if(ye.indexOf&&!He)return ye.indexOf(Oe);for(var Ot=0;Ot<ye.length;){if(He&&ye[Ot][He]==Oe||!He&&ye[Ot]===Oe)return Ot;Ot++}return-1}function me(ye){return Array.prototype.slice.call(ye,0)}function Ce(ye,Oe,He){for(var Ot=[],on=[],Fn=0;Fn<ye.length;){var Rr=Oe?ye[Fn][Oe]:ye[Fn];se(on,Rr)<0&&Ot.push(ye[Fn]),on[Fn]=Rr,Fn++}return He&&(Oe?Ot=Ot.sort(function(Lr,ao){return Lr[Oe]>ao[Oe]}):Ot=Ot.sort()),Ot}function be(ye,Oe){for(var He,Ot,on=Oe[0].toUpperCase()+Oe.slice(1),Fn=0;Fn<o.length;){if(He=o[Fn],Ot=He?He+on:Oe,Ot in ye)return Ot;Fn++}return i}var Ye=1;function tt(){return Ye++}function pt(ye){var Oe=ye.ownerDocument||ye;return Oe.defaultView||Oe.parentWindow||e}var Ee=/mobile|tablet|ip(ad|hone|od)|android/i,Ne="ontouchstart"in e,Be=be(e,"PointerEvent")!==i,qe=Ne&&Ee.test(navigator.userAgent),ct="touch",Ct="pen",Dt="mouse",In="kinect",Mn=25,Tn=1,Nt=2,Zt=4,Wt=8,hn=1,lr=2,It=4,Xt=8,$t=16,cn=lr|It,Jt=Xt|$t,Ln=cn|Jt,qn=["x","y"],or=["clientX","clientY"];function cr(ye,Oe){var He=this;this.manager=ye,this.callback=Oe,this.element=ye.element,this.target=ye.options.inputTarget,this.domHandler=function(Ot){X(ye.options.enable,[ye])&&He.handler(Ot)},this.init()}cr.prototype={handler:function(){},init:function(){this.evEl&&J(this.element,this.evEl,this.domHandler),this.evTarget&&J(this.target,this.evTarget,this.domHandler),this.evWin&&J(pt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ie(this.element,this.evEl,this.domHandler),this.evTarget&&ie(this.target,this.evTarget,this.domHandler),this.evWin&&ie(pt(this.element),this.evWin,this.domHandler)}};function cs(ye){var Oe,He=ye.options.inputClass;return He?Oe=He:Be?Oe=Me:qe?Oe=Qt:Ne?Oe=st:Oe=Wu,new Oe(ye,Ri)}function Ri(ye,Oe,He){var Ot=He.pointers.length,on=He.changedPointers.length,Fn=Oe&Tn&&Ot-on===0,Rr=Oe&(Zt|Wt)&&Ot-on===0;He.isFirst=!!Fn,He.isFinal=!!Rr,Fn&&(ye.session={}),He.eventType=Oe,Do(ye,He),ye.emit("hammer.input",He),ye.recognize(He),ye.session.prevInput=He}function Do(ye,Oe){var He=ye.session,Ot=Oe.pointers,on=Ot.length;He.firstInput||(He.firstInput=_s(Oe)),on>1&&!He.firstMultiple?He.firstMultiple=_s(Oe):on===1&&(He.firstMultiple=!1);var Fn=He.firstInput,Rr=He.firstMultiple,Ao=Rr?Rr.center:Fn.center,Lr=Oe.center=mo(Ot);Oe.timeStamp=g(),Oe.deltaTime=Oe.timeStamp-Fn.timeStamp,Oe.angle=au(Ao,Lr),Oe.distance=kl(Ao,Lr),Fa(He,Oe),Oe.offsetDirection=su(Oe.deltaX,Oe.deltaY);var ao=Fl(Oe.deltaTime,Oe.deltaX,Oe.deltaY);Oe.overallVelocityX=ao.x,Oe.overallVelocityY=ao.y,Oe.overallVelocity=d(ao.x)>d(ao.y)?ao.x:ao.y,Oe.scale=Rr?lu(Rr.pointers,Ot):1,Oe.rotation=Rr?$u(Rr.pointers,Ot):0,Oe.maxPointers=He.prevInput?Oe.pointers.length>He.prevInput.maxPointers?Oe.pointers.length:He.prevInput.maxPointers:Oe.pointers.length,Nl(He,Oe);var vs=ye.element;ce(Oe.srcEvent.target,vs)&&(vs=Oe.srcEvent.target),Oe.target=vs}function Fa(ye,Oe){var He=Oe.center,Ot=ye.offsetDelta||{},on=ye.prevDelta||{},Fn=ye.prevInput||{};(Oe.eventType===Tn||Fn.eventType===Zt)&&(on=ye.prevDelta={x:Fn.deltaX||0,y:Fn.deltaY||0},Ot=ye.offsetDelta={x:He.x,y:He.y}),Oe.deltaX=on.x+(He.x-Ot.x),Oe.deltaY=on.y+(He.y-Ot.y)}function Nl(ye,Oe){var He=ye.lastInterval||Oe,Ot=Oe.timeStamp-He.timeStamp,on,Fn,Rr,Ao;if(Oe.eventType!=Wt&&(Ot>Mn||He.velocity===i)){var Lr=Oe.deltaX-He.deltaX,ao=Oe.deltaY-He.deltaY,vs=Fl(Ot,Lr,ao);Fn=vs.x,Rr=vs.y,on=d(vs.x)>d(vs.y)?vs.x:vs.y,Ao=su(Lr,ao),ye.lastInterval=Oe}else on=He.velocity,Fn=He.velocityX,Rr=He.velocityY,Ao=He.direction;Oe.velocity=on,Oe.velocityX=Fn,Oe.velocityY=Rr,Oe.direction=Ao}function _s(ye){for(var Oe=[],He=0;He<ye.pointers.length;)Oe[He]={clientX:u(ye.pointers[He].clientX),clientY:u(ye.pointers[He].clientY)},He++;return{timeStamp:g(),pointers:Oe,center:mo(Oe),deltaX:ye.deltaX,deltaY:ye.deltaY}}function mo(ye){var Oe=ye.length;if(Oe===1)return{x:u(ye[0].clientX),y:u(ye[0].clientY)};for(var He=0,Ot=0,on=0;on<Oe;)He+=ye[on].clientX,Ot+=ye[on].clientY,on++;return{x:u(He/Oe),y:u(Ot/Oe)}}function Fl(ye,Oe,He){return{x:Oe/ye||0,y:He/ye||0}}function su(ye,Oe){return ye===Oe?hn:d(ye)>=d(Oe)?ye<0?lr:It:Oe<0?Xt:$t}function kl(ye,Oe,He){He||(He=qn);var Ot=Oe[He[0]]-ye[He[0]],on=Oe[He[1]]-ye[He[1]];return Math.sqrt(Ot*Ot+on*on)}function au(ye,Oe,He){He||(He=qn);var Ot=Oe[He[0]]-ye[He[0]],on=Oe[He[1]]-ye[He[1]];return Math.atan2(on,Ot)*180/Math.PI}function $u(ye,Oe){return au(Oe[1],Oe[0],or)+au(ye[1],ye[0],or)}function lu(ye,Oe){return kl(Oe[0],Oe[1],or)/kl(ye[0],ye[1],or)}var Hu={mousedown:Tn,mousemove:Nt,mouseup:Zt},uu="mousedown",Fc="mousemove mouseup";function Wu(){this.evEl=uu,this.evWin=Fc,this.pressed=!1,cr.apply(this,arguments)}F(Wu,cr,{handler:function(Oe){var He=Hu[Oe.type];He&Tn&&Oe.button===0&&(this.pressed=!0),He&Nt&&Oe.which!==1&&(He=Zt),this.pressed&&(He&Zt&&(this.pressed=!1),this.callback(this.manager,He,{pointers:[Oe],changedPointers:[Oe],pointerType:Dt,srcEvent:Oe}))}});var Ge={pointerdown:Tn,pointermove:Nt,pointerup:Zt,pointercancel:Wt,pointerout:Wt},ge={2:ct,3:Ct,4:Dt,5:In},Ae="pointerdown",ze="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Ae="MSPointerDown",ze="MSPointerMove MSPointerUp MSPointerCancel");function Me(){this.evEl=Ae,this.evWin=ze,cr.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}F(Me,cr,{handler:function(Oe){var He=this.store,Ot=!1,on=Oe.type.toLowerCase().replace("ms",""),Fn=Ge[on],Rr=ge[Oe.pointerType]||Oe.pointerType,Ao=Rr==ct,Lr=se(He,Oe.pointerId,"pointerId");Fn&Tn&&(Oe.button===0||Ao)?Lr<0&&(He.push(Oe),Lr=He.length-1):Fn&(Zt|Wt)&&(Ot=!0),!(Lr<0)&&(He[Lr]=Oe,this.callback(this.manager,Fn,{pointers:He,changedPointers:[Oe],pointerType:Rr,srcEvent:Oe}),Ot&&He.splice(Lr,1))}});var it={touchstart:Tn,touchmove:Nt,touchend:Zt,touchcancel:Wt},ht="touchstart",ft="touchstart touchmove touchend touchcancel";function rt(){this.evTarget=ht,this.evWin=ft,this.started=!1,cr.apply(this,arguments)}F(rt,cr,{handler:function(Oe){var He=it[Oe.type];if(He===Tn&&(this.started=!0),!!this.started){var Ot=wt.call(this,Oe,He);He&(Zt|Wt)&&Ot[0].length-Ot[1].length===0&&(this.started=!1),this.callback(this.manager,He,{pointers:Ot[0],changedPointers:Ot[1],pointerType:ct,srcEvent:Oe})}}});function wt(ye,Oe){var He=me(ye.touches),Ot=me(ye.changedTouches);return Oe&(Zt|Wt)&&(He=Ce(He.concat(Ot),"identifier",!0)),[He,Ot]}var sn={touchstart:Tn,touchmove:Nt,touchend:Zt,touchcancel:Wt},dn="touchstart touchmove touchend touchcancel";function Qt(){this.evTarget=dn,this.targetIds={},cr.apply(this,arguments)}F(Qt,cr,{handler:function(Oe){var He=sn[Oe.type],Ot=sr.call(this,Oe,He);Ot&&this.callback(this.manager,He,{pointers:Ot[0],changedPointers:Ot[1],pointerType:ct,srcEvent:Oe})}});function sr(ye,Oe){var He=me(ye.touches),Ot=this.targetIds;if(Oe&(Tn|Nt)&&He.length===1)return Ot[He[0].identifier]=!0,[He,He];var on,Fn,Rr=me(ye.changedTouches),Ao=[],Lr=this.target;if(Fn=He.filter(function(ao){return ce(ao.target,Lr)}),Oe===Tn)for(on=0;on<Fn.length;)Ot[Fn[on].identifier]=!0,on++;for(on=0;on<Rr.length;)Ot[Rr[on].identifier]&&Ao.push(Rr[on]),Oe&(Zt|Wt)&&delete Ot[Rr[on].identifier],on++;if(Ao.length)return[Ce(Fn.concat(Ao),"identifier",!0),Ao]}var pr=2500,tr=25;function st(){cr.apply(this,arguments);var ye=k(this.handler,this);this.touch=new Qt(this.manager,ye),this.mouse=new Wu(this.manager,ye),this.primaryTouch=null,this.lastTouches=[]}F(st,cr,{handler:function(Oe,He,Ot){var on=Ot.pointerType==ct,Fn=Ot.pointerType==Dt;if(!(Fn&&Ot.sourceCapabilities&&Ot.sourceCapabilities.firesTouchEvents)){if(on)Pt.call(this,He,Ot);else if(Fn&&Gn.call(this,Ot))return;this.callback(Oe,He,Ot)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Pt(ye,Oe){ye&Tn?(this.primaryTouch=Oe.changedPointers[0].identifier,rn.call(this,Oe)):ye&(Zt|Wt)&&rn.call(this,Oe)}function rn(ye){var Oe=ye.changedPointers[0];if(Oe.identifier===this.primaryTouch){var He={x:Oe.clientX,y:Oe.clientY};this.lastTouches.push(He);var Ot=this.lastTouches,on=function(){var Fn=Ot.indexOf(He);Fn>-1&&Ot.splice(Fn,1)};setTimeout(on,pr)}}function Gn(ye){for(var Oe=ye.srcEvent.clientX,He=ye.srcEvent.clientY,Ot=0;Ot<this.lastTouches.length;Ot++){var on=this.lastTouches[Ot],Fn=Math.abs(Oe-on.x),Rr=Math.abs(He-on.y);if(Fn<=tr&&Rr<=tr)return!0}return!1}var w=be(a.style,"touchAction"),Ue=w!==i,Ir="compute",fr="auto",rr="manipulation",Tr="none",qi="pan-x",qr="pan-y",jn=kc();function ro(ye,Oe){this.manager=ye,this.set(Oe)}ro.prototype={set:function(ye){ye==Ir&&(ye=this.compute()),Ue&&this.manager.element.style&&jn[ye]&&(this.manager.element.style[w]=ye),this.actions=ye.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ye=[];return P(this.manager.recognizers,function(Oe){X(Oe.options.enable,[Oe])&&(ye=ye.concat(Oe.getTouchAction()))}),ca(ye.join(" "))},preventDefaults:function(ye){var Oe=ye.srcEvent,He=ye.offsetDirection;if(this.manager.session.prevented){Oe.preventDefault();return}var Ot=this.actions,on=re(Ot,Tr)&&!jn[Tr],Fn=re(Ot,qr)&&!jn[qr],Rr=re(Ot,qi)&&!jn[qi];if(on){var Ao=ye.pointers.length===1,Lr=ye.distance<2,ao=ye.deltaTime<250;if(Ao&&Lr&&ao)return}if(!(Rr&&Fn)&&(on||Fn&&He&cn||Rr&&He&Jt))return this.preventSrc(Oe)},preventSrc:function(ye){this.manager.session.prevented=!0,ye.preventDefault()}};function ca(ye){if(re(ye,Tr))return Tr;var Oe=re(ye,qi),He=re(ye,qr);return Oe&&He?Tr:Oe||He?Oe?qi:qr:re(ye,rr)?rr:fr}function kc(){if(!Ue)return!1;var ye={},Oe=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(He){ye[He]=Oe?e.CSS.supports("touch-action",He):!0}),ye}var zl=1,Qr=2,Vo=4,Bo=8,ka=Bo,$o=16,Hn=32;function Ke(ye){this.options=B({},this.defaults,ye||{}),this.id=tt(),this.manager=null,this.options.enable=Y(this.options.enable,!0),this.state=zl,this.simultaneous={},this.requireFail=[]}Ke.prototype={defaults:{},set:function(ye){return B(this.options,ye),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ye){if(E(ye,"recognizeWith",this))return this;var Oe=this.simultaneous;return ye=Vi(ye,this),Oe[ye.id]||(Oe[ye.id]=ye,ye.recognizeWith(this)),this},dropRecognizeWith:function(ye){return E(ye,"dropRecognizeWith",this)?this:(ye=Vi(ye,this),delete this.simultaneous[ye.id],this)},requireFailure:function(ye){if(E(ye,"requireFailure",this))return this;var Oe=this.requireFail;return ye=Vi(ye,this),se(Oe,ye)===-1&&(Oe.push(ye),ye.requireFailure(this)),this},dropRequireFailure:function(ye){if(E(ye,"dropRequireFailure",this))return this;ye=Vi(ye,this);var Oe=se(this.requireFail,ye);return Oe>-1&&this.requireFail.splice(Oe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ye){return!!this.simultaneous[ye.id]},emit:function(ye){var Oe=this,He=this.state;function Ot(on){Oe.manager.emit(on,ye)}He<Bo&&Ot(Oe.options.event+gt(He)),Ot(Oe.options.event),ye.additionalEvent&&Ot(ye.additionalEvent),He>=Bo&&Ot(Oe.options.event+gt(He))},tryEmit:function(ye){if(this.canEmit())return this.emit(ye);this.state=Hn},canEmit:function(){for(var ye=0;ye<this.requireFail.length;){if(!(this.requireFail[ye].state&(Hn|zl)))return!1;ye++}return!0},recognize:function(ye){var Oe=B({},ye);if(!X(this.options.enable,[this,Oe])){this.reset(),this.state=Hn;return}this.state&(ka|$o|Hn)&&(this.state=zl),this.state=this.process(Oe),this.state&(Qr|Vo|Bo|$o)&&this.tryEmit(Oe)},process:function(ye){},getTouchAction:function(){},reset:function(){}};function gt(ye){return ye&$o?"cancel":ye&Bo?"end":ye&Vo?"move":ye&Qr?"start":""}function za(ye){return ye==$t?"down":ye==Xt?"up":ye==lr?"left":ye==It?"right":""}function Vi(ye,Oe){var He=Oe.manager;return He?He.get(ye):ye}function gi(){Ke.apply(this,arguments)}F(gi,Ke,{defaults:{pointers:1},attrTest:function(ye){var Oe=this.options.pointers;return Oe===0||ye.pointers.length===Oe},process:function(ye){var Oe=this.state,He=ye.eventType,Ot=Oe&(Qr|Vo),on=this.attrTest(ye);return Ot&&(He&Wt||!on)?Oe|$o:Ot||on?He&Zt?Oe|Bo:Oe&Qr?Oe|Vo:Qr:Hn}});function Nf(){gi.apply(this,arguments),this.pX=null,this.pY=null}F(Nf,gi,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ln},getTouchAction:function(){var ye=this.options.direction,Oe=[];return ye&cn&&Oe.push(qr),ye&Jt&&Oe.push(qi),Oe},directionTest:function(ye){var Oe=this.options,He=!0,Ot=ye.distance,on=ye.direction,Fn=ye.deltaX,Rr=ye.deltaY;return on&Oe.direction||(Oe.direction&cn?(on=Fn===0?hn:Fn<0?lr:It,He=Fn!=this.pX,Ot=Math.abs(ye.deltaX)):(on=Rr===0?hn:Rr<0?Xt:$t,He=Rr!=this.pY,Ot=Math.abs(ye.deltaY))),ye.direction=on,He&&Ot>Oe.threshold&&on&Oe.direction},attrTest:function(ye){return gi.prototype.attrTest.call(this,ye)&&(this.state&Qr||!(this.state&Qr)&&this.directionTest(ye))},emit:function(ye){this.pX=ye.deltaX,this.pY=ye.deltaY;var Oe=za(ye.direction);Oe&&(ye.additionalEvent=this.options.event+Oe),this._super.emit.call(this,ye)}});function fa(){gi.apply(this,arguments)}F(fa,gi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Tr]},attrTest:function(ye){return this._super.attrTest.call(this,ye)&&(Math.abs(ye.scale-1)>this.options.threshold||this.state&Qr)},emit:function(ye){if(ye.scale!==1){var Oe=ye.scale<1?"in":"out";ye.additionalEvent=this.options.event+Oe}this._super.emit.call(this,ye)}});function Ve(){Ke.apply(this,arguments),this._timer=null,this._input=null}F(Ve,Ke,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[fr]},process:function(ye){var Oe=this.options,He=ye.pointers.length===Oe.pointers,Ot=ye.distance<Oe.threshold,on=ye.deltaTime>Oe.time;if(this._input=ye,!Ot||!He||ye.eventType&(Zt|Wt)&&!on)this.reset();else if(ye.eventType&Tn)this.reset(),this._timer=_(function(){this.state=ka,this.tryEmit()},Oe.time,this);else if(ye.eventType&Zt)return ka;return Hn},reset:function(){clearTimeout(this._timer)},emit:function(ye){this.state===ka&&(ye&&ye.eventType&Zt?this.manager.emit(this.options.event+"up",ye):(this._input.timeStamp=g(),this.manager.emit(this.options.event,this._input)))}});function $h(){gi.apply(this,arguments)}F($h,gi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Tr]},attrTest:function(ye){return this._super.attrTest.call(this,ye)&&(Math.abs(ye.rotation)>this.options.threshold||this.state&Qr)}});function cu(){gi.apply(this,arguments)}F(cu,gi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:cn|Jt,pointers:1},getTouchAction:function(){return Nf.prototype.getTouchAction.call(this)},attrTest:function(ye){var Oe=this.options.direction,He;return Oe&(cn|Jt)?He=ye.overallVelocity:Oe&cn?He=ye.overallVelocityX:Oe&Jt&&(He=ye.overallVelocityY),this._super.attrTest.call(this,ye)&&Oe&ye.offsetDirection&&ye.distance>this.options.threshold&&ye.maxPointers==this.options.pointers&&d(He)>this.options.velocity&&ye.eventType&Zt},emit:function(ye){var Oe=za(ye.offsetDirection);Oe&&this.manager.emit(this.options.event+Oe,ye),this.manager.emit(this.options.event,ye)}});function _n(){Ke.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}F(_n,Ke,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[rr]},process:function(ye){var Oe=this.options,He=ye.pointers.length===Oe.pointers,Ot=ye.distance<Oe.threshold,on=ye.deltaTime<Oe.time;if(this.reset(),ye.eventType&Tn&&this.count===0)return this.failTimeout();if(Ot&&on&&He){if(ye.eventType!=Zt)return this.failTimeout();var Fn=this.pTime?ye.timeStamp-this.pTime<Oe.interval:!0,Rr=!this.pCenter||kl(this.pCenter,ye.center)<Oe.posThreshold;this.pTime=ye.timeStamp,this.pCenter=ye.center,!Rr||!Fn?this.count=1:this.count+=1,this._input=ye;var Ao=this.count%Oe.taps;if(Ao===0)return this.hasRequireFailures()?(this._timer=_(function(){this.state=ka,this.tryEmit()},Oe.interval,this),Qr):ka}return Hn},failTimeout:function(){return this._timer=_(function(){this.state=Hn},this.options.interval,this),Hn},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ka&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ur(ye,Oe){return Oe=Oe||{},Oe.recognizers=Y(Oe.recognizers,ur.defaults.preset),new Rs(ye,Oe)}ur.VERSION="2.0.7",ur.defaults={domEvents:!1,touchAction:Ir,enable:!0,inputTarget:null,inputClass:null,preset:[[$h,{enable:!1}],[fa,{enable:!1},["rotate"]],[cu,{direction:cn}],[Nf,{direction:cn},["swipe"]],[_n],[_n,{event:"doubletap",taps:2},["tap"]],[Ve]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Cr=1,Os=2;function Rs(ye,Oe){this.options=B({},ur.defaults,Oe||{}),this.options.inputTarget=this.options.inputTarget||ye,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ye,this.input=cs(this),this.touchAction=new ro(this,this.options.touchAction),xr(this,!0),P(this.options.recognizers,function(He){var Ot=this.add(new He[0](He[1]));He[2]&&Ot.recognizeWith(He[2]),He[3]&&Ot.requireFailure(He[3])},this)}Rs.prototype={set:function(ye){return B(this.options,ye),ye.touchAction&&this.touchAction.update(),ye.inputTarget&&(this.input.destroy(),this.input.target=ye.inputTarget,this.input.init()),this},stop:function(ye){this.session.stopped=ye?Os:Cr},recognize:function(ye){var Oe=this.session;if(!Oe.stopped){this.touchAction.preventDefaults(ye);var He,Ot=this.recognizers,on=Oe.curRecognizer;(!on||on&&on.state&ka)&&(on=Oe.curRecognizer=null);for(var Fn=0;Fn<Ot.length;)He=Ot[Fn],Oe.stopped!==Os&&(!on||He==on||He.canRecognizeWith(on))?He.recognize(ye):He.reset(),!on&&He.state&(Qr|Vo|Bo)&&(on=Oe.curRecognizer=He),Fn++}},get:function(ye){if(ye instanceof Ke)return ye;for(var Oe=this.recognizers,He=0;He<Oe.length;He++)if(Oe[He].options.event==ye)return Oe[He];return null},add:function(ye){if(E(ye,"add",this))return this;var Oe=this.get(ye.options.event);return Oe&&this.remove(Oe),this.recognizers.push(ye),ye.manager=this,this.touchAction.update(),ye},remove:function(ye){if(E(ye,"remove",this))return this;if(ye=this.get(ye),ye){var Oe=this.recognizers,He=se(Oe,ye);He!==-1&&(Oe.splice(He,1),this.touchAction.update())}return this},on:function(ye,Oe){if(ye!==i&&Oe!==i){var He=this.handlers;return P(ue(ye),function(Ot){He[Ot]=He[Ot]||[],He[Ot].push(Oe)}),this}},off:function(ye,Oe){if(ye!==i){var He=this.handlers;return P(ue(ye),function(Ot){Oe?He[Ot]&&He[Ot].splice(se(He[Ot],Oe),1):delete He[Ot]}),this}},emit:function(ye,Oe){this.options.domEvents&&ys(ye,Oe);var He=this.handlers[ye]&&this.handlers[ye].slice();if(!(!He||!He.length)){Oe.type=ye,Oe.preventDefault=function(){Oe.srcEvent.preventDefault()};for(var Ot=0;Ot<He.length;)He[Ot](Oe),Ot++}},destroy:function(){this.element&&xr(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function xr(ye,Oe){var He=ye.element;if(He.style){var Ot;P(ye.options.cssProps,function(on,Fn){Ot=be(He.style,Fn),Oe?(ye.oldCssProps[Ot]=He.style[Ot],He.style[Ot]=on):He.style[Ot]=ye.oldCssProps[Ot]||""}),Oe||(ye.oldCssProps={})}}function ys(ye,Oe){var He=n.createEvent("Event");He.initEvent(ye,!0,!0),He.gesture=Oe,Oe.target.dispatchEvent(He)}B(ur,{INPUT_START:Tn,INPUT_MOVE:Nt,INPUT_END:Zt,INPUT_CANCEL:Wt,STATE_POSSIBLE:zl,STATE_BEGAN:Qr,STATE_CHANGED:Vo,STATE_ENDED:Bo,STATE_RECOGNIZED:ka,STATE_CANCELLED:$o,STATE_FAILED:Hn,DIRECTION_NONE:hn,DIRECTION_LEFT:lr,DIRECTION_RIGHT:It,DIRECTION_UP:Xt,DIRECTION_DOWN:$t,DIRECTION_HORIZONTAL:cn,DIRECTION_VERTICAL:Jt,DIRECTION_ALL:Ln,Manager:Rs,Input:cr,TouchAction:ro,TouchInput:Qt,MouseInput:Wu,PointerEventInput:Me,TouchMouseInput:st,SingleTouchInput:rt,Recognizer:Ke,AttrRecognizer:gi,Tap:_n,Pan:Nf,Swipe:cu,Pinch:fa,Rotate:$h,Press:Ve,on:J,off:ie,each:P,merge:z,extend:V,assign:B,inherit:F,bindFn:k,prefixed:be});var Ls=typeof e<"u"?e:typeof self<"u"?self:{};Ls.Hammer=ur,typeof i=="function"&&i.amd?i(function(){return ur}):t.exports?t.exports=ur:e[r]=ur})(window,document,"Hammer")})(Ene);var kE=Ene.exports;const pSe=mA(kE),dd=Q4({__proto__:null,default:pSe},[kE]),Sne=1,Tne=2,kF=4,gSe={mousedown:Sne,mousemove:Tne,mouseup:kF};function mSe(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function ASe(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(mSe(i,o=>o.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function _Se(t){t.prototype.handler=function(n){let r=gSe[n.type];r&Sne&&n.button>=0&&(this.pressed=!0),r&Tne&&n.which===0&&(r=kF),this.pressed&&(r&kF&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}ASe(kE.PointerEventInput);_Se(kE.MouseInput);const ySe=kE.Manager;let HO=class{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}};const vSe=dd?[[dd.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[dd.Rotate,{enable:!1}],[dd.Pinch,{enable:!1}],[dd.Swipe,{enable:!1}],[dd.Pan,{threshold:0,enable:!1}],[dd.Press,{enable:!1}],[dd.Tap,{event:"doubletap",taps:2,enable:!1}],[dd.Tap,{event:"anytap",enable:!1}],[dd.Tap,{enable:!1}]]:null,V$={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},xSe={doubletap:["tap"]},bSe={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},z5={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},wSe={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},$$={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},ESe=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",ev=typeof window<"u"?window:global;let zF=!1;try{const t={get passive(){return zF=!0,!0}};ev.addEventListener("test",null,t),ev.removeEventListener("test",null)}catch{zF=!1}const SSe=ESe.indexOf("firefox")!==-1,{WHEEL_EVENTS:TSe}=z5,H$="wheel",W$=4.000244140625,CSe=40,PSe=.25;class ISe extends HO{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{if(!this.options.enable)return;let o=i.deltaY;ev.WheelEvent&&(SSe&&i.deltaMode===ev.WheelEvent.DOM_DELTA_PIXEL&&(o/=ev.devicePixelRatio),i.deltaMode===ev.WheelEvent.DOM_DELTA_LINE&&(o*=CSe)),o!==0&&o%W$===0&&(o=Math.floor(o/W$)),i.shiftKey&&o&&(o=o*PSe),this.callback({type:H$,center:{x:i.clientX,y:i.clientY},delta:-o,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(TSe),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,zF?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===H$&&(this.options.enable=n)}}const{MOUSE_EVENTS:MSe}=z5,q$="pointermove",X$="pointerover",Z$="pointerout",Y$="pointerenter",Q$="pointerleave";class OSe extends HO{constructor(e,n,r){super(e,n,r),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(MSe),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===q$&&(this.enableMoveEvent=n),e===X$&&(this.enableOverEvent=n),e===Z$&&(this.enableOutEvent=n),e===Y$&&(this.enableEnterEvent=n),e===Q$&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(X$,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(Z$,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(Y$,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(Q$,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(q$,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:RSe}=z5,K$="keydown",J$="keyup";class LSe extends HO{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{const o=i.target||i.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:K$,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:J$,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(RSe),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===K$&&(this.enableDownEvent=n),e===J$&&(this.enableUpEvent=n)}}const eH="contextmenu";class DSe extends HO{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:eH,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===eH&&(this.options.enable=n)}}const UF=1,uI=2,GF=4,BSe={pointerdown:UF,pointermove:uI,pointerup:GF,mousedown:UF,mousemove:uI,mouseup:GF},NSe=1,FSe=2,kSe=3,zSe=0,USe=1,GSe=2,jSe=1,VSe=2,$Se=4;function HSe(t){const e=BSe[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r,which:i}=t.srcEvent;let o=!1,a=!1,s=!1;return e===GF||e===uI&&!Number.isFinite(n)?(o=i===NSe,a=i===FSe,s=i===kSe):e===uI?(o=!!(n&jSe),a=!!(n&$Se),s=!!(n&VSe)):e===UF&&(o=r===zSe,a=r===USe,s=r===GSe),{leftButton:o,middleButton:a,rightButton:s}}function WSe(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,o=r.height/e.offsetHeight||1,a={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/o};return{center:n,offsetCenter:a}}const JD={srcElement:"root",priority:0};class qSe{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let i=n.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,o=!1){const{handlers:a,handlersByElement:s}=this;let u=JD;typeof r=="string"||r&&r.addEventListener?u={...JD,srcElement:r}:r&&(u={...JD,...r});let d=s.get(u.srcElement);d||(d=[],s.set(u.srcElement,d));const g={type:e,handler:n,srcElement:u.srcElement,priority:u.priority};i&&(g.once=!0),o&&(g.passive=!0),a.push(g),this._active=this._active||!g.passive;let _=d.length-1;for(;_>=0&&!(d[_].priority>=g.priority);)_--;d.splice(_+1,0,g)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let o=r.length-1;o>=0;o--){const a=r[o];if(a.type===e&&a.handler===n){r.splice(o,1);const s=i.get(a.srcElement);s.splice(s.indexOf(a),1),s.length===0&&i.delete(a.srcElement)}}this._active=r.some(o=>!o.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const o=()=>{e.handled=!0},a=()=>{e.handled=!0,i=!0},s=[];for(let u=0;u<r.length;u++){const{type:d,handler:g,once:_}=r[u];if(g({...e,type:d,stopPropagation:o,stopImmediatePropagation:a}),_&&s.push(r[u]),i)break}for(let u=0;u<s.length;u++){const{type:d,handler:g}=s[u];this.remove(d,g)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...HSe(e),...WSe(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const XSe={events:null,recognizers:null,recognizerOptions:{},Manager:ySe,touchAction:"none",tabIndex:0};class ZSe{constructor(e=null,n){this._onBasicInput=i=>{const{srcEvent:o}=i,a=bSe[o.type];a&&this.manager.emit(a,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...XSe,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||vSe}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(V$).forEach(i=>{const o=this.manager.get(i);o&&V$[i].forEach(a=>{o.recognizeWith(a)})});for(const i in n.recognizerOptions){const o=this.manager.get(i);if(o){const a=n.recognizerOptions[i];delete a.enable,o.set(a)}}this.wheelInput=new ISe(e,this._onOtherEvent,{enable:!1}),this.moveInput=new OSe(e,this._onOtherEvent,{enable:!1}),this.keyInput=new LSe(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new DSe(e,this._onOtherEvent,{enable:!1});for(const[i,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(i,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==n){i.set({enable:n});const o=xSe[e];o&&!this.options.recognizers&&o.forEach(a=>{const s=r.get(a);n?(s.requireFailure(e),i.dropRequireFailure(a)):s.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,i,o){if(typeof e!="string"){r=n;for(const g in e)this._addEventHandler(g,e[g],r,i,o);return}const{manager:a,events:s}=this,u=$$[e]||e;let d=s.get(u);d||(d=new qSe(this),s.set(u,d),d.recognizerName=wSe[u]||u,a&&a.on(u,d.handleEvent)),d.add(e,n,r,i,o),d.isEmpty()||this._toggleRecognizer(d.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const a in e)this._removeEventHandler(a,e[a]);return}const{events:r}=this,i=$$[e]||e,o=r.get(i);if(o&&(o.remove(e,n),o.isEmpty())){const{recognizerName:a}=o;let s=!1;for(const u of r.values())if(u.recognizerName===a&&!u.isEmpty()){s=!0;break}s||this._toggleRecognizer(a,!1)}}}function a0(){}const YSe=({isDragging:t})=>t?"grabbing":"grab",Cne={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:a0,onResize:a0,onViewStateChange:a0,onInteractionStateChange:a0,onBeforeRender:a0,onAfterRender:a0,onLoad:a0,onError:t=>Or.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:YSe,getTooltip:null,debug:!1,drawPickingColors:!1};class zE{constructor(e){q(this,"props",void 0),q(this,"width",0),q(this,"height",0),q(this,"userData",{}),q(this,"canvas",null),q(this,"viewManager",null),q(this,"layerManager",null),q(this,"effectManager",null),q(this,"deckRenderer",null),q(this,"deckPicker",null),q(this,"eventManager",null),q(this,"tooltip",null),q(this,"metrics",void 0),q(this,"animationLoop",void 0),q(this,"stats",void 0),q(this,"viewState",void 0),q(this,"cursorState",void 0),q(this,"_needsRedraw",void 0),q(this,"_pickRequest",void 0),q(this,"_lastPointerDownInfo",null),q(this,"_metricsCounter",void 0),q(this,"_onPointerMove",n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const i=n.offsetCenter;if(!i)return;r.x=i.x,r.y=i.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n}),q(this,"_onEvent",n=>{const r=P9[n.type],i=n.offsetCenter;if(!r||!i||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:o,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:s}=a,u=s&&(s[r.handler]||s.props[r.handler]),d=this.props[r.handler];let g=!1;u&&(g=u.call(s,a,n)),!g&&d&&d(a,n)}),q(this,"_onPointerDown",n=>{const r=n.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo}),this.props={...Cne,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&Or.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Fee()==="IE"&&Or.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new a5({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&zv.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,o,a,s,u;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)===null||a===void 0||a.finalize(),this.deckPicker=null,(s=this.eventManager)===null||s===void 0||s.destroy(),this.eventManager=null,(u=this.tooltip)===null||u===void 0||u.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var d;(d=this.canvas.parentElement)===null||d===void 0||d.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Or.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Or.removed("onLayerClick","onClick")(),e.initialViewState&&!uc(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return n=n||r||i||o||a,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return ia(this.viewManager),this.viewManager.views}getViewports(e){return ia(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,r){ia(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),o}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),ia(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const o=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=o}if(r||r===0){var i;const o=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((i=e.style)===null||i===void 0?void 0:i.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var e,n;const{canvas:r}=this;if(!r)return;const i=(e=r.clientWidth)!==null&&e!==void 0?e:r.width,o=(n=r.clientHeight)!==null&&n!==void 0?n:r.height;if(i!==this.width||o!==this.height){var a,s;this.width=i,this.height=o,(a=this.viewManager)===null||a===void 0||a.setProps({width:i,height:o}),(s=this.layerManager)===null||s===void 0||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:o})}}_createAnimationLoop(e){const{width:n,height:r,gl:i,glOptions:o,debug:a,onError:s,onBeforeRender:u,onAfterRender:d,useDevicePixels:g}=e;return new ate({width:n,height:r,useDevicePixels:g,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,gl:i,onCreateContext:_=>s5({...o,..._,canvas:this.canvas,debug:a,onContextLost:()=>this._onContextLost()}),onInitialize:_=>this._setGLContext(_.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:u,onAfterRender:d,onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new $O({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let o=i,a=!1;for(const s of r){var n;o=s,a=((n=s.layer)===null||n===void 0?void 0:n.onHover(s,e.event))||a}if(!a&&this.props.onHover&&this.props.onHover(o,e.event),this.props.getTooltip&&this.tooltip){const s=this.props.getTooltip(o);this.tooltip.setTooltip(s,o.x,o.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,RO(e,{enable:!0,copyState:!0})),this.tooltip=new dSe(this.canvas),bh(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new T5;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new ZSe(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in P9)this.eventManager.on(i,this._onEvent);this.viewManager=new W2e({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new _ne(e,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new rSe,this.deckRenderer=new xne(e),this.deckPicker=new fSe(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:r}=this.layerManager.context;bh(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Or.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=Cm.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}q(zE,"defaultProps",Cne);q(zE,"VERSION",zee);class eB{constructor(e,n){q(this,"opts",void 0),q(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:r}=this.source,{size:i}=n;let o=r;if(r&&r.length!==i){o=new Float32Array(i);const a=n.elementOffset||0;for(let s=0;s<i;++s)o[s]=r[a+s]}return o}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function QSe(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function uC(t){return t.stride||t.size*t.bytesPerElement}function Pne(t,e){e.offset&&Or.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=uC(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,o=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:o,stride:n}}function KSe(t,e){const n=Pne(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class JSe{constructor(e,n,r){q(this,"gl",void 0),q(this,"id",void 0),q(this,"size",void 0),q(this,"settings",void 0),q(this,"value",void 0),q(this,"doublePrecision",void 0),q(this,"_buffer",void 0),q(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,o=i===5130;let{defaultValue:a}=n;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let s;o?s=5126:!i&&n.isIndexed?s=e&&RE(e,Qi.ELEMENT_INDEX_UINT32)?5125:5123:s=i||5126;let u=QSe(i||s||5126);this.doublePrecision=o,o&&n.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...n,defaultType:u,defaultValue:a,logicalType:i,type:s,size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new ji(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*uC(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),zv.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const r={},i=this.value instanceof Float64Array,o=KSe(this.getAccessor(),n||{});return r[e]=new eB(this,o.high),r["".concat(e,"64Low")]=i?new eB(this,o.low):new Float32Array(this.size),r}if(n){const r=Pne(this.getAccessor(),n);return{[e]:new eB(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,o=r*i;if(n&&o&&n.length>=o){const a=new Array(i).fill(1/0),s=new Array(i).fill(-1/0);for(let u=0;u<o;)for(let d=0;d<i;d++){const g=n[u++];g<a[d]&&(a[d]=g),g>s[d]&&(s[d]=g)}e=[a,s]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof ji?r={buffer:e}:r=e;const i={...this.settings,...r};if(n.bufferAccessor=i,n.bounds=null,r.constant){let o=r.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!n.constant||!this._areValuesEqual(o,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=o}else if(r.buffer){const o=r.buffer;n.externalBuffer=o,n.constant=!1,this.value=r.value||null;const a=r.value instanceof Float64Array;i.type=r.type||o.accessor.type,i.bytesPerElement=o.accessor.BYTES_PER_ELEMENT*(a?2:1),i.stride=uC(i)}else if(r.value){this._checkExternalBuffer(r);let o=r.value;n.externalBuffer=null,n.constant=!1,this.value=o,i.bytesPerElement=o.BYTES_PER_ELEMENT,i.stride=uC(i);const{buffer:a,byteOffset:s}=this;this.doublePrecision&&o instanceof Float64Array&&(o=YD(o,i));const u=o.byteLength+s+i.stride*2;a.byteLength<u&&a.reallocate(u),a.setAccessor(null),a.subData({data:o,offset:s}),i.type=r.type||a.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?YD(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),offset:r*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,o=zv.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=o;const{buffer:a,byteOffset:s}=this;return a.byteLength<o.byteLength+s&&(a.reallocate(o.byteLength+s),n&&i&&a.subData({data:i instanceof Float64Array?YD(i,this):i,offset:s})),r.allocatedValue=o,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&Or.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:o}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let a=o;for(;--a>=0;)n[r+a]=i[a];return n}switch(o){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let a=o;for(;--a>=0;)n[r+a]=Number.isFinite(e[a])?e[a]:i[a]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}}const tH=[],nH=[];function Tg(t,e=0,n=1/0){let r=tH;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(nH.length=t.length,r=nH):r=tH,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function Ine(t){return t&&t[Symbol.asyncIterator]}function Mne(t,e){const{size:n,stride:r,offset:i,startIndices:o,nested:a}=e,s=t.BYTES_PER_ELEMENT,u=r?r/s:n,d=i?i/s:0,g=Math.floor((t.length-d)/u);return(_,{index:E,target:P})=>{if(!o){const z=E*u+d;for(let F=0;F<n;F++)P[F]=t[z+F];return P}const R=o[E],B=o[E+1]||g;let V;if(a){V=new Array(B-R);for(let z=R;z<B;z++){const F=z*u+d;P=new Array(n);for(let k=0;k<n;k++)P[k]=t[F+k];V[z-R]=P}}else if(u===n)V=t.subarray(R*n+d,B*n+d);else{V=new t.constructor((B-R)*n);let z=0;for(let F=R;F<B;F++){const k=F*u+d;for(let X=0;X<n;X++)V[z++]=t[k+X]}}return V}}const eTe=[],cC=[[0,1/0]];function tTe(t,e){if(t===cC||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let o=0;o<r;o++){const a=t[o];a[1]<e[0]?(n.push(a),i=o+1):a[0]>e[1]?n.push(a):e=[Math.min(a[0],e[0]),Math.max(a[1],e[1])]}return n.splice(i,0,e),n}function tB(t){const{source:e,target:n,start:r=0,size:i,getData:o}=t,a=t.end||n.length,s=e.length,u=a-r;if(s>u){n.set(e.subarray(0,u),r);return}if(n.set(e,r),!o)return;let d=s;for(;d<u;){const g=o(d,e);for(let _=0;_<i;_++)n[r+d]=g[_]||0,d++}}function nTe({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:o}){if(!Array.isArray(o))return tB({source:t,target:e,size:n,getData:r}),e;let a=0,s=0;const u=r&&((g,_)=>r(g+s,_)),d=Math.min(i.length,o.length);for(let g=1;g<d;g++){const _=i[g]*n,E=o[g]*n;tB({source:t.subarray(a,_),target:e,start:s,end:E,size:n,getData:u}),a=_,s=E}return s<e.length&&tB({source:[],target:e,start:s,size:n,getData:u}),e}const rTe={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function One(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...rTe[n],...e,...t,type:n}}function Rne(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function Lne(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function Dne(t){t.push(t.shift())}function U5(t,e){const{doublePrecision:n,settings:r,value:i,size:o}=t,a=n&&i instanceof Float64Array?2:1;return(r.noAlloc?i.length:e*o)*a}function Bne({buffer:t,numInstances:e,attribute:n,fromLength:r,fromStartIndices:i,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,s=n.size*a,u=n.byteOffset,d=n.startIndices,g=i&&d,_=U5(n,e),E=n.isConstant;if(!g&&r>=_)return;const P=E?n.value:n.getBuffer().getData({srcByteOffset:u});if(n.settings.normalized&&!E){const z=o;o=(F,k)=>n.normalizeConstant(z(F,k))}const R=E?(z,F)=>o(P,F):(z,F)=>o(P.subarray(z,z+s),F),B=t.getData({length:r}),V=new Float32Array(_);nTe({source:B,target:V,sourceStartIndices:i,targetStartIndices:d,size:s,getData:R}),t.byteLength<V.byteLength+u&&t.reallocate(V.byteLength+u),t.subData({data:V,offset:u})}class G5 extends JSe{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:cC}),q(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(o=>e[o])]:e[n];return One(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=tTe(this.state.updateRanges,[r,i])}else this.state.updateRanges=cC}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=eTe}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==cC),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:a,noAlloc:s}}=this;let u=!0;if(a){for(const[d,g]of o)a.call(i,this,{data:n,startRow:d,endRow:g,props:r,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,g]of o){const _=Number.isFinite(d)?this.getVertexOffset(d):0,E=Number.isFinite(g)?this.getVertexOffset(g):s||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:_,endOffset:E})}this._checkAttributeArray()}else u=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),u}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const a=e;ia(ArrayBuffer.isView(a.value),"invalid ".concat(i.accessor));const s=!!a.size&&a.size!==this.size;return r.binaryAccessor=Mne(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:n,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const r in e)Object.assign(n,super.getShaderAttributes(r,e[r]));return n}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:o,numInstances:a}){if(e.constant)return;const{settings:s,state:u,value:d,size:g,startIndices:_}=e,{accessor:E,transform:P}=s,R=u.binaryAccessor||(typeof E=="function"?E:o[E]);ia(typeof R=="function",'accessor "'.concat(E,'" is not a function'));let B=e.getVertexOffset(r);const{iterable:V,objectInfo:z}=Tg(n,r,i);for(const F of V){z.index++;let k=R(F,z);if(P&&(k=P.call(this,k)),_){const X=(z.index<_.length-1?_[z.index+1]:a)-_[z.index];if(k&&Array.isArray(k[0])){let Y=B;for(const J of k)e._normalizeValue(J,d,Y),Y+=g}else k&&k.length>g?d.set(k,B):(e._normalizeValue(k,z.target,0),Ane({target:d,source:z.target,start:B,count:X}));B+=X*g}else e._normalizeValue(k,d,B),B+=g}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class iTe{constructor({gl:e,attribute:n,timeline:r}){q(this,"gl",void 0),q(this,"type","interpolation"),q(this,"attributeInTransition",void 0),q(this,"settings",void 0),q(this,"attribute",void 0),q(this,"transition",void 0),q(this,"currentStartIndices",void 0),q(this,"currentLength",void 0),q(this,"transform",void 0),q(this,"buffers",void 0),this.gl=e,this.transition=new FE(r),this.attribute=n,this.attributeInTransition=new G5(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=sTe(e,n);const i={byteLength:0,usage:35050};this.buffers=[new ji(e,i),new ji(e,i)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:i,attribute:o}=this;Dne(i);const a={numInstances:n,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of i)Bne({buffer:s,...a});this.currentStartIndices=o.startIndices,this.currentLength=U5(o,n),this.attributeInTransition.setData({buffer:i[1],value:o.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:i[0],aTo:Rne(r,o)},feedbackBuffers:{vCurrent:i[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:r}=this.settings,{time:i}=this.transition;let o=i/n;r&&(o=r(o)),this.transform.run({uniforms:{time:o}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const oTe=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function sTe(t,e){const n=Lne(e.size);return new UO(t,{vs:oTe,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class aTe{constructor({gl:e,attribute:n,timeline:r}){q(this,"gl",void 0),q(this,"type","spring"),q(this,"attributeInTransition",void 0),q(this,"settings",void 0),q(this,"attribute",void 0),q(this,"transition",void 0),q(this,"currentStartIndices",void 0),q(this,"currentLength",void 0),q(this,"texture",void 0),q(this,"framebuffer",void 0),q(this,"transform",void 0),q(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new FE(r),this.attribute=n,this.attributeInTransition=new G5(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=uTe(e),this.framebuffer=cTe(e,this.texture),this.transform=lTe(e,n,this.framebuffer);const i={byteLength:0,usage:35050};this.buffers=[new ji(e,i),new ji(e,i),new ji(e,i)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:r,buffers:i,attribute:o}=this,a={numInstances:n,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of i)Bne({buffer:s,...a});this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=U5(o,n),this.attributeInTransition.setData({buffer:i[1],value:o.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:Rne(r,o)}})}update(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this;if(!i.update())return!1;const a=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:a.stiffness,damping:a.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),Dne(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),OE(r)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function lTe(t,e,n){const r=Lne(e.size);return new UO(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function uTe(t){return new Pl(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function cTe(t,e){return new Ws(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const fTe={interpolation:iTe,spring:aTe};class hTe{constructor(e,{id:n,timeline:r}){q(this,"id",void 0),q(this,"isSupported",void 0),q(this,"gl",void 0),q(this,"timeline",void 0),q(this,"transitions",void 0),q(this,"needsRedraw",void 0),q(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=UO.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const o=e[i],a=o.getTransitionSetting(n);a&&this._updateAttribute(i,o,a)}for(const i in this.transitions){const o=e[i];(!o||!o.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let o=!i||i.type!==r.type;if(o){if(!this.isSupported){Or.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}i&&this._removeTransition(e);const a=fTe[r.type];a?this.transitions[e]=new a({attribute:n,timeline:this.timeline,gl:this.gl}):(Or.error("unsupported transition type '".concat(r.type,"'"))(),o=!1)}(o||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const rH="attributeManager.invalidate",dTe="attributeManager.updateStart",pTe="attributeManager.updateEnd",gTe="attribute.updateStart",mTe="attribute.allocate",ATe="attribute.updateEnd";class Nne{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){q(this,"id",void 0),q(this,"gl",void 0),q(this,"attributes",void 0),q(this,"updateTriggers",void 0),q(this,"needsRedraw",void 0),q(this,"userData",void 0),q(this,"stats",void 0),q(this,"attributeTransitionManager",void 0),q(this,"mergeBoundsMemoized",L1(e2e)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new hTe(e,{id:"".concat(n,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);_l(rH,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);_l(rH,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:o={},buffers:a={},context:s={}}){let u=!1;_l(dTe,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const g=this.attributes[d],_=g.settings.accessor;g.startIndices=r,g.numInstances=n,o[d]&&Or.removed("props.".concat(d),"data.attributes.".concat(d))(),g.setExternalBuffer(a[d])||g.setBinaryValue(typeof _=="string"?a[_]:void 0,e.startIndices)||typeof _=="string"&&!a[_]&&g.setConstantValue(o[_])||g.needsUpdate()&&(u=!0,this._updateAttribute({attribute:g,numInstances:n,data:e,props:o,context:s})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}u&&_l(pTe,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])===null||i===void 0?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const o in n){const a=n[o];a.needsRedraw(e)&&!r.hasAttribute(o)&&(i[o]=a)}return i}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const r={};for(const i in e)n[i]||Object.assign(r,e[i].getShaderAttributes());return r}_add(e,n={}){for(const r in e){const i=e[r];this.attributes[r]=this._createAttribute(r,i,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,r){const i={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:r.instanced?1:n.divisor||0};return new G5(this.gl,i)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,o=i[e];return o&&o.forEach(a=>{const s=r[a];s&&s.setNeedsUpdate(s.id,n)}),o}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(_l(gTe,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&_l(mTe,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,_l(ATe,n,r))}}class _Te extends FE{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:o}}=this,a=o(e/i);this._value=pc(n,r,a)}}const iH=1e-5;function oH(t,e,n,r,i){const o=e-t,s=(n-e)*i,u=-o*r;return s+u+o+e}function yTe(t,e,n,r,i){if(Array.isArray(n)){const o=[];for(let a=0;a<n.length;a++)o[a]=oH(t[a],e[a],n[a],r,i);return o}return oH(t,e,n,r,i)}function sH(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class vTe extends FE{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:o=e,_currValue:a=e}=this;let s=yTe(o,a,n,r,i);const u=sH(s,n),d=sH(s,a);u<iH&&d<iH&&(s=n,this.end()),this._prevValue=a,this._currValue=s}}const xTe={interpolation:_Te,spring:vTe};class bTe{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:o}=this;if(o.has(e)){const u=o.get(e),{value:d=u.settings.fromValue}=u;n=d,this.remove(e)}if(i=One(i),!i)return;const a=xTe[i.type];if(!a){Or.error("unsupported transition type '".concat(i.type,"'"))();return}const s=new a(this.timeline);s.start({...i,fromValue:n,toValue:r}),o.set(e,s)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function wTe(t){const e=t[Gm];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function ETe(t,e){const n=j5({newProps:t,oldProps:e,propTypes:t[Gm],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=TTe(t,e);let i=!1;return r||(i=CTe(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:PTe(t,e),transitionsChanged:STe(t,e)}}function STe(t,e){if(!t.transitions)return!1;const n={},r=t[Gm];let i=!1;for(const o in t.transitions){const a=r[o],s=a&&a.type;(s==="number"||s==="color"||s==="array")&&jF(t[o],e[o],a)&&(n[o]=!0,i=!0)}return i?n:!1}function j5({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(i," changed shallowly");for(const o of Object.keys(t))if(!(o in n)){if(!(o in e))return"".concat(i,".").concat(o," added");const a=jF(t[o],e[o],r[o]);if(a)return"".concat(i,".").concat(o," ").concat(a)}for(const o of Object.keys(e))if(!(o in n)){if(!(o in t))return"".concat(i,".").concat(o," dropped");if(!Object.hasOwnProperty.call(t,o)){const a=jF(t[o],e[o],r[o]);if(a)return"".concat(i,".").concat(o," ").concat(a)}}return!1}function jF(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function TTe(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function CTe(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&aH(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&aH(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function PTe(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function aH(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},j5({oldProps:i,newProps:r,triggerName:n})}const ITe="count(): argument not an object",MTe="count(): argument not a container";function Fne(t){if(!RTe(t))throw new Error(ITe);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(OTe(t))return Object.keys(t).length;throw new Error(MTe)}function OTe(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function RTe(t){return t!==null&&typeof t=="object"}function kne(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const LTe={10241:9987,10240:9729,10242:33071,10243:33071},VF={};function DTe(t,e,n,r){if(n instanceof Pl)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={10241:n.data.length>1?9985:9729});const o=new Pl(e,{...n,parameters:{...LTe,...i,...r}});return VF[o.id]=t,o}function BTe(t,e){!e||!(e instanceof Pl)||VF[e.id]===t&&(e.delete(),delete VF[e.id])}const NTe={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||$F(t)&&(t.length===3||t.length===4)},equal(t,e,n){return uc(t,e,1)}},accessor:{validate(t,e){const n=cI(t);return n==="function"||n===cI(e.value)},equal(t,e,n){return typeof e=="function"?!0:uc(t,e,1)}},array:{validate(t,e){return e.optional&&!t||$F(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?uc(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?uc(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:r}=n.props;return r&&t?r(t):t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.gl?null:DTe(n.id,r.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{BTe(n.id,t)}}};function FTe(t){const e={},n={},r={};for(const[i,o]of Object.entries(t)){const a=o==null?void 0:o.deprecatedFor;if(a)r[i]=Array.isArray(a)?a:[a];else{const s=kTe(i,o);e[i]=s,n[i]=s.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function kTe(t,e){switch(cI(e)){case"object":return cb(t,e);case"array":return cb(t,{type:"array",value:e,compare:!1});case"boolean":return cb(t,{type:"boolean",value:e});case"number":return cb(t,{type:"number",value:e});case"function":return cb(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function cb(t,e){return"type"in e?{name:t,...NTe[e.type],...e}:"value"in e?{name:t,type:cI(e.value),...e}:{name:t,type:"object",value:e}}function $F(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function cI(t){return $F(t)?"array":t===null?"null":typeof t}function zTe(t,e){let n;for(let o=e.length-1;o>=0;o--){const a=e[o];"extensions"in a&&(n=a.extensions)}const r=HF(t.constructor,n),i=Object.create(r);i[aI]=t,i[F0]={},i[Pm]={};for(let o=0;o<e.length;++o){const a=e[o];for(const s in a)i[s]=a[s]}return Object.freeze(i),i}const UTe="_mergedDefaultProps";function HF(t,e){let n=UTe;if(e)for(const i of e){const o=i.constructor;o&&(n+=":".concat(o.extensionName||o.name))}const r=zne(t,n);return r||(t[n]=GTe(t,e||[]))}function GTe(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=HF(r),o=zne(t,"defaultProps")||{},a=FTe(o),s=Object.assign(Object.create(null),i,a.defaultProps),u=Object.assign(Object.create(null),i==null?void 0:i[Gm],a.propTypes),d=Object.assign(Object.create(null),i==null?void 0:i[KD],a.deprecatedProps);for(const g of e){const _=HF(g.constructor);_&&(Object.assign(s,_),Object.assign(u,_[Gm]),Object.assign(d,_[KD]))}return jTe(s,t),$Te(s,u),VTe(s,d),s[Gm]=u,s[KD]=d,e.length===0&&!V5(t,"_propTypes")&&(t._propTypes=u),s}function jTe(t,e){const n=WTe(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function VTe(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i="".concat(this.id,": ").concat(n);for(const o of e[n])V5(this,o)||(this[o]=r);Or.deprecated(i,e[n].join("/"))()}})}function $Te(t,e){const n={},r={};for(const i in e){const o=e[i],{name:a,value:s}=o;o.async&&(n[a]=s,r[a]=HTe(a))}t[Av]=n,t[F0]={},Object.defineProperties(t,r)}function HTe(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||Ine(e)?this[F0][t]=e:this[Pm][t]=e},get(){if(this[Pm]){if(t in this[Pm])return this[Pm][t]||this[Av][t];if(t in this[F0]){const e=this[aI]&&this[aI].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Av][t]}}return this[Av][t]}}}function V5(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function zne(t,e){return V5(t,e)&&t[e]}function WTe(t){const e=t.componentName;return e||Or.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let qTe=0;class $5{constructor(...e){q(this,"id",void 0),q(this,"props",void 0),q(this,"count",void 0),this.props=zTe(this,e),this.id=this.props.id,this.count=qTe++}clone(e){const{props:n}=this,r={};for(const i in n[Av])i in n[Pm]?r[i]=n[Pm][i]:i in n[F0]&&(r[i]=n[F0][i]);return new this.constructor({...n,...r,...e})}}q($5,"componentName","Component");q($5,"defaultProps",{});const XTe=Object.freeze({});class ZTe{constructor(e){q(this,"component",void 0),q(this,"onAsyncPropUpdated",void 0),q(this,"asyncProps",void 0),q(this,"oldProps",void 0),q(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||XTe}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[aI]||this.component;const n=e[Pm]||{},r=e[F0]||e,i=e[Av]||{};for(const o in n){const a=n[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,a),n[o]=this.getAsyncProp(o)}for(const o in r){const a=r[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,a)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(Ine(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(o=>{this.component&&(o=this._postProcessValue(r,o),this._setAsyncPropValue(e,o,i),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let o=[],a=0;for await(const s of n){if(!this.component)return;const{dataTransform:u}=this.component.props;u?o=u(s,o):o=o.concat(s),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:a,endRow:o.length}]}),a=o.length,this._setAsyncPropValue(e,o,i)}this._onResolve(e,o)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Gm];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class YTe extends ZTe{constructor({attributeManager:e,layer:n}){super(n),q(this,"attributeManager",void 0),q(this,"needsRedraw",void 0),q(this,"needsUpdate",void 0),q(this,"subLayers",void 0),q(this,"usesPickingColorCache",void 0),q(this,"hasPickingBuffer",void 0),q(this,"changeFlags",void 0),q(this,"viewport",void 0),q(this,"uniformTransitions",void 0),q(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const QTe="layer.changeFlag",KTe="layer.initialize",JTe="layer.update",eCe="layer.finalize",tCe="layer.matched",lH=2**24-1,nCe=Object.freeze([]),rCe=L1(({oldViewport:t,viewport:e})=>t.equals(e));let pd=new Uint8ClampedArray(0);const iCe={data:{type:"data",value:nCe,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:o})=>{const{resourceManager:a}=n.context;if(i=i||n.getLoadOptions(),r=r||n.props.loaders,o){var s;i={...i,fetch:{...(s=i)===null||s===void 0?void 0:s.fetch,signal:o}}}let u=a.contains(t);return!u&&!i&&(a.add({resourceId:t,data:ag(t,r),persistent:!1}),u=!0),u?a.subscribe({resourceId:t,onChange:d=>{var g;return(g=n.internalState)===null||g===void 0?void 0:g.reloadAsyncProp(e,d)},consumerId:n.id,requestId:e}):ag(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Br.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class nl extends $5{constructor(...e){super(...e),q(this,"internalState",null),q(this,"lifecycle",Ny.NO_STATE),q(this,"context",void 0),q(this,"state",void 0),q(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){ia(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=dne(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,o,a]=VO(r,n.pixelProjectionMatrix);return e.length===2?[i,o]:[i,o,a]}unproject(e){return ia(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){ia(this.internalState);const r=this.internalState.viewport||this.context.viewport;return pne(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Br.DEFAULT||e===Br.LNGLAT||e===Br.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){ia(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Fne(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=kne(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,o=this.internalState.hasPickingBuffer,a=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(s=>s.getNeedsPickingBuffer.call(this,s));if(o!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:s,instancePickingColors:u}=n.attributes,d=s||u;d&&(a&&d.constant&&(d.constant=!1,n.invalidate(d.id)),!d.value&&!a&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i;if(n&&(e=new Error("".concat(n,": ").concat(e.message),{cause:e})),!((r=(i=this.props).onError)!==null&&r!==void 0&&r.call(i,e))){var o,a;(o=this.context)===null||o===void 0||(a=o.onError)===null||a===void 0||a.call(o,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!rCe({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(pd.length/3);if(this.internalState.usesPickingColorCache=!0,r<n){n>lH&&Or.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),pd=zv.allocate(pd,n,{size:3,copy:!0,maxCount:Math.max(n,lH)});const i=Math.floor(pd.length/3),o=[];for(let a=r;a<i;a++)this.encodePickingColor(a,o),pd[a*3+0]=o[0],pd[a*3+1]=o[1],pd[a*3+2]=o[2]}e.value=pd.subarray(0,n*3)}_setModelAttributes(e,n){const r=this.getAttributeManager(),i=e.userData.excludeAttributes||{},o=r.getShaderAttributes(n,i);e.setAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,o=r||i,a=o&&n.attributes&&n.attributes[o.id];if(a&&a.value){const s=a.value,u=this.encodePickingColor(e);for(let d=0;d<n.length;d++){const g=o.getVertexOffset(d);s[g]===u[0]&&s[g+1]===u[1]&&s[g+2]===u[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const o=i.getVertexOffset(e),a=i.getVertexOffset(e+1);i.buffer.subData({data:new Uint8Array(a-o),offset:o})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==pd.buffer&&(r.value=pd.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){ia(!this.internalState),ia(Number.isFinite(this.props.coordinateSystem)),_l(KTe,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new YTe({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Or.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new bTe(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){_l(tCe,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(_l(JTe,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,o=r.viewport,a=this._updateUniformTransition();i.propsInTransition=a,r.viewport=i.viewport||o,this.props=a;try{const s=this._getUpdateParams(),u=this.getModels();if(r.gl)this.updateState(s);else try{this.updateState(s)}catch{}for(const g of this.props.extensions)g.updateState.call(this,s,g);const d=this.getModels()[0]!==u[0];this._postUpdate(s,d)}finally{r.viewport=o,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){_l(eCe,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const i=this.props,o=this.context;this.props=this.internalState.propsInTransition||i;const a=this.props.opacity;n.opacity=Math.pow(a,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:s}=this.props,u=s&&s(n)||[0,0];bh(o.gl,{polygonOffset:u}),Mu(o.gl,r,()=>{const d={moduleParameters:e,uniforms:n,parameters:r,context:o};for(const g of this.props.extensions)g.draw.call(this,d,g);this.draw(d)})}finally{this.props=i}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let o=!1;switch(i){case"dataChanged":const a=e[i],s=n[i];a&&Array.isArray(s)&&(n.dataChanged=Array.isArray(a)?s.concat(a):a,o=!0);default:n[i]||(n[i]=e[i],o=!0)}o&&_l(QTe,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const r=ETe(e,n);if(r.updateTriggersChanged)for(const o in r.updateTriggersChanged)r.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(r.transitionsChanged)for(const o in r.transitionsChanged){var i;this.internalState.uniformTransitions.add(o,n[o],e[o],(i=e.transitions)===null||i===void 0?void 0:i[o])}return this.setChangeFlags(r)}validateProps(){wTe(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.pickingHighlightColor=r(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Nne(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:o}=this.state;o==null||o.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:s,highlightColor:u}=r;if(n||i.autoHighlight!==a||i.highlightedObjectIndex!==s||i.highlightColor!==u){const d={};a||(d.pickingSelectedColor=null),Array.isArray(u)&&(d.pickingHighlightColor=u),(n||s!==i.highlightedObjectIndex)&&(d.pickingSelectedColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setModuleParameters(d)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}q(nl,"defaultProps",iCe);q(nl,"layerName","Layer");const oCe="compositeLayer.renderLayers";class Uh extends nl{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,i)}return e}getSubLayerProps(e={}){var n;const{opacity:r,pickable:i,visible:o,parameters:a,getPolygonOffset:s,highlightedObjectIndex:u,autoHighlight:d,highlightColor:g,coordinateSystem:_,coordinateOrigin:E,wrapLongitude:P,positionFormat:R,modelMatrix:B,extensions:V,fetch:z,operation:F,_subLayerProps:k}=this.props,X={id:"",updateTriggers:{},opacity:r,pickable:i,visible:o,parameters:a,getPolygonOffset:s,highlightedObjectIndex:u,autoHighlight:d,highlightColor:g,coordinateSystem:_,coordinateOrigin:E,wrapLongitude:P,positionFormat:R,modelMatrix:B,extensions:V,fetch:z,operation:F},Y=k&&e.id&&k[e.id],J=Y&&Y.updateTriggers,ie=e.id||"sublayer";if(Y){const ce=this.props[Gm],re=e.type?e.type._propTypes:{};for(const ue in Y){const se=re[ue]||ce[ue];se&&se.type==="accessor"&&(Y[ue]=this.getSubLayerAccessor(Y[ue]))}}Object.assign(X,e,Y),X.id="".concat(this.props.id,"-").concat(ie),X.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...J};for(const ce of V){const re=ce.getSubLayerProps.call(this,ce);re&&Object.assign(X,re,{updateTriggers:Object.assign(X.updateTriggers,re.updateTriggers)})}return X}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const o=this.renderLayers();r=NE(o,Boolean),this.internalState.subLayers=r}_l(oCe,this,i,r);for(const o of r)o.parent=this}}q(Uh,"layerName","CompositeLayer");const BS=Math.PI/180,uH=180/Math.PI,fC=6370972,tv=256;function sCe(){const t=tv/fC,e=Math.PI/180*tv;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class H5 extends zh{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,nearZMultiplier:o=.1,farZMultiplier:a=2,resolution:s=10}=e;let{height:u,altitude:d=1.5}=e;u=u||1,d=Math.max(.75,d);const g=new vr().lookAt({eye:[0,-d,0],up:[0,0,1]}),_=Math.pow(2,i);g.rotateX(n*BS),g.rotateZ(-r*BS),g.scale(_/u);const E=Math.atan(.5/d),P=tv*2*_/u;super({...e,height:u,viewMatrix:g,longitude:r,latitude:n,zoom:i,distanceScales:sCe(),fovyRadians:E*2,focalDistance:d,near:o,far:Math.min(2,1/P+1)*d*a}),q(this,"longitude",void 0),q(this,"latitude",void 0),q(this,"resolution",void 0),this.latitude=n,this.longitude=r,this.resolution=s}get projectionMode(){return hh.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,this.height/2],n),i=this.unproject([this.width/2,0],n),o=this.unproject([this.width,this.height/2],n),a=this.unproject([this.width/2,this.height],n);return o[0]<this.longitude&&(o[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],o[0],i[0],a[0]),Math.min(r[1],o[1],i[1],a[1]),Math.max(r[0],o[0],i[0],a[0]),Math.max(r[1],o[1],i[1],a[1])]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,o,a]=e,s=n?o:this.height-o,{pixelUnprojectionMatrix:u}=this;let d;if(Number.isFinite(a))d=nB(u,[i,s,a,1]);else{const P=nB(u,[i,s,-1,1]),R=nB(u,[i,s,1,1]),B=((r||0)/fC+1)*tv,V=$D(Rte([],P,R)),z=$D(P),F=$D(R),X=4*((4*z*F-(V-z-F)**2)/16)/V,Y=Math.sqrt(z-X),J=Math.sqrt(Math.max(0,B*B-X)),ie=(Y-J)/Math.sqrt(V);d=qxe([],P,R,ie)}const[g,_,E]=this.unprojectPosition(d);return Number.isFinite(a)?[g,_,E]:Number.isFinite(r)?[g,_,r]:[g,_]}projectPosition(e){const[n,r,i=0]=e,o=n*BS,a=r*BS,s=Math.cos(a),u=(i/fC+1)*tv;return[Math.sin(o)*s*u,-Math.cos(o)*s*u,Math.sin(a)*u]}unprojectPosition(e){const[n,r,i]=e,o=Lte(e),a=Math.asin(i/o),u=Math.atan2(n,-r)*uH,d=a*uH,g=(o/tv-1)*fC;return[u,d,g]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,n){const r=this.unproject(n);return{longitude:e[0]-r[0]+this.longitude,latitude:e[1]-r[1]+this.latitude}}}function nB(t,e){const n=O1([],e,t);return w5(n,n,1/n[3]),n}const rB=Math.PI/180;function aCe({height:t,focalDistance:e,orbitAxis:n,rotationX:r,rotationOrbit:i,zoom:o}){const a=n==="Z"?[0,0,1]:[0,1,0],s=n==="Z"?[0,-e,0]:[0,0,e],u=new vr().lookAt({eye:s,up:a});u.rotateX(r*rB),n==="Z"?u.rotateZ(i*rB):u.rotateY(i*rB);const d=Math.pow(2,o)/t;return u.scale(d),u}class Une extends zh{constructor(e){const{height:n,projectionMatrix:r,fovy:i=50,orbitAxis:o="Z",target:a=[0,0,0],rotationX:s=0,rotationOrbit:u=0,zoom:d=0}=e,g=r?r[5]/2:BE(i);super({...e,longitude:void 0,viewMatrix:aCe({height:n||1,focalDistance:g,orbitAxis:o,rotationX:s,rotationOrbit:u,zoom:d}),fovy:i,focalDistance:g,position:a,zoom:d}),q(this,"projectedCenter",void 0),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:n=!0}={}){const[r,i,o=this.projectedCenter[2]]=e,a=n?i:this.height-i,[s,u,d]=Ym([r,a,o],this.pixelUnprojectionMatrix);return[s,u,d]}panByPosition(e,n){const r=this.project(e),i=[this.width/2+r[0]-n[0],this.height/2+r[1]-n[1],this.projectedCenter[2]];return{target:this.unproject(i)}}}const lCe=new vr().lookAt({eye:[0,0,1]});function uCe({width:t,height:e,near:n,far:r,padding:i}){let o=-t/2,a=t/2,s=-e/2,u=e/2;if(i){const{left:d=0,right:g=0,top:_=0,bottom:E=0}=i,P=Wi((d+t-g)/2,0,t)-t/2,R=Wi((_+e-E)/2,0,e)-e/2;o-=P,a-=P,s+=R,u+=R}return new vr().ortho({left:o,right:a,bottom:s,top:u,near:n,far:r})}class Gne extends zh{constructor(e){const{width:n,height:r,near:i=.1,far:o=1e3,zoom:a=0,target:s=[0,0,0],padding:u=null,flipY:d=!0}=e,g=Array.isArray(a)?a[0]:a,_=Array.isArray(a)?a[1]:a,E=Math.min(g,_),P=Math.pow(2,E);let R;if(g!==_){const B=Math.pow(2,g),V=Math.pow(2,_);R={unitsPerMeter:[B/P,V/P,1],metersPerUnit:[P/B,P/V,1]}}super({...e,longitude:void 0,position:s,viewMatrix:lCe.clone().scale([P,P*(d?-1:1),P]),projectionMatrix:uCe({width:n||1,height:r||1,padding:u,near:i,far:o}),zoom:E,distanceScales:R})}projectFlat([e,n]){const{unitsPerMeter:r}=this.distanceScales;return[e*r[0],n*r[1]]}unprojectFlat([e,n]){const{metersPerUnit:r}=this.distanceScales;return[e*r[0],n*r[1]]}panByPosition(e,n){const r=Ym(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),o=D0([],i,y5([],r)),a=D0([],this.center,o);return{target:this.unprojectFlat(a)}}}class jne extends zh{constructor(e){const{longitude:n,latitude:r,modelMatrix:i,bearing:o=0,pitch:a=0,up:s=[0,0,1]}=e,d=new Nv({bearing:o,pitch:a===-90?1e-4:90+a}).toVector3().normalize(),g=i?new vr(i).transformAsVector(d):d,_=Number.isFinite(r)?I5({latitude:r}):0,E=Math.pow(2,_),P=new vr().lookAt({eye:[0,0,0],center:g,up:s}).scale(E);super({...e,zoom:_,viewMatrix:P}),q(this,"longitude",void 0),q(this,"latitude",void 0),this.latitude=r,this.longitude=n}}const fb=20;class W5 extends k5{constructor(e){const{width:n,height:r,position:i=[0,0,0],bearing:o=0,pitch:a=0,longitude:s=null,latitude:u=null,maxPitch:d=90,minPitch:g=-90,startRotatePos:_,startBearing:E,startPitch:P,startZoomPosition:R}=e;super({width:n,height:r,position:i,bearing:o,pitch:a,longitude:s,latitude:u,maxPitch:d,minPitch:g},{startRotatePos:_,startBearing:E,startPitch:P,startZoomPosition:R})}panStart(){return this}pan(){return this}panEnd(){return this}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:o,startPitch:a}=this.getState(),{width:s,height:u}=this.getViewportProps();if(!i||o===void 0||a===void 0)return this;let d;if(e){const g=(e[0]-i[0])/s,_=(e[1]-i[1])/u;d={bearing:o-g*180,pitch:a-_*90}}else d={bearing:o-n,pitch:a-r};return this._getUpdatedState(d)}rotateEnd(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}zoomStart(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}zoom({scale:e}){let{startZoomPosition:n}=this.getState();n||(n=this.getViewportProps().position);const r=this.getDirection();return this._move(r,Math.log2(e)*fb,n)}zoomEnd(){return this._getUpdatedState({startZoomPosition:null})}moveLeft(e=fb){const n=this.getDirection(!0);return this._move(n.rotateZ({radians:Math.PI/2}),e)}moveRight(e=fb){const n=this.getDirection(!0);return this._move(n.rotateZ({radians:-Math.PI/2}),e)}moveUp(e=fb){const n=this.getDirection(!0);return this._move(n,e)}moveDown(e=fb){const n=this.getDirection(!0);return this._move(n.negate(),e)}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}zoomIn(e=2){return this.zoom({scale:e})}zoomOut(e=2){return this.zoom({scale:1/e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:o}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),o!==null&&n.longitude!==null&&Math.abs(o-n.longitude)>180&&(r.longitude=o<0?o+360:o-360),r}_move(e,n,r=this.getViewportProps().position){const i=e.scale(n);return this._getUpdatedState({position:new yt(r).add(i)})}getDirection(e=!1){return new Nv({bearing:this.getViewportProps().bearing,pitch:e?90:90+this.getViewportProps().pitch}).toVector3().normalize()}_getUpdatedState(e){return new W5({...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{pitch:n,maxPitch:r,minPitch:i,longitude:o,bearing:a}=e;return e.pitch=Wi(n,i,r),o!==null&&(o<-180||o>180)&&(e.longitude=oI(o+180,360)-180),(a<-180||a>180)&&(e.bearing=oI(a+180,360)-180),e}}class Vne extends D1{constructor(...e){super(...e),q(this,"ControllerState",W5),q(this,"transition",{transitionDuration:300,transitionInterpolator:new u_(["position","pitch","bearing"])})}}class $ne extends Sh{get ViewportType(){return jne}get ControllerType(){return Vne}}q($ne,"displayName","FirstPersonView");class Hne extends k5{constructor(e){const{width:n,height:r,rotationX:i=0,rotationOrbit:o=0,target:a=[0,0,0],zoom:s=0,minRotationX:u=-90,maxRotationX:d=90,minZoom:g=-1/0,maxZoom:_=1/0,startPanPosition:E,startRotatePos:P,startRotationX:R,startRotationOrbit:B,startZoomPosition:V,startZoom:z}=e;super({width:n,height:r,rotationX:i,rotationOrbit:o,target:a,zoom:s,minRotationX:u,maxRotationX:d,minZoom:g,maxZoom:_},{startPanPosition:E,startRotatePos:P,startRotationX:R,startRotationOrbit:B,startZoomPosition:V,startZoom:z}),q(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const r=this.getState().startPanPosition||n;if(!r)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startRotationX:o,startRotationOrbit:a}=this.getState(),{width:s,height:u}=this.getViewportProps();if(!i||o===void 0||a===void 0)return this;let d;if(e){let g=(e[0]-i[0])/s;const _=(e[1]-i[1])/u;(o<-90||o>90)&&(g*=-1),d={rotationX:o+_*180,rotationOrbit:a+g*180}}else d={rotationX:o+r,rotationOrbit:a+n};return this._getUpdatedState(d)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{rotationOrbit:i}=r;return Math.abs(i-n.rotationOrbit)>180&&(r.rotationOrbit=i<0?i+360:i-360),r}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomPosition:o}=this.getState();if(o||(i=this.getViewportProps().zoom,o=this._unproject(n)||this._unproject(e)),!o)return this;const a=this._calculateNewZoom({scale:r,startZoom:i}),s=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...s.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:r,minZoom:i}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const o=n+Math.log2(e);return Wi(o,i,r)}_panFromCenter(e){const{width:n,height:r,target:i}=this.getViewportProps();return this.pan({startPosition:i,pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i,maxRotationX:o,minRotationX:a,rotationOrbit:s}=e;return e.zoom=Array.isArray(i)?[Wi(i[0],r,n),Wi(i[1],r,n)]:Wi(i,r,n),e.rotationX=Wi(e.rotationX,a,o),(s<-180||s>180)&&(e.rotationOrbit=oI(s+180,360)-180),e}}class Wne extends D1{constructor(...e){super(...e),q(this,"ControllerState",Hne),q(this,"transition",{transitionDuration:300,transitionInterpolator:new u_({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})})}}class qne extends Sh{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}get ViewportType(){return Une}get ControllerType(){return Wne}}q(qne,"displayName","OrbitView");class cCe extends Hne{constructor(e){super(e),q(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:r,minZoom:i}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);let o=Math.log2(e);if(Array.isArray(n)){let[a,s]=n;switch(this.zoomAxis){case"X":a=Wi(a+o,i,r);break;case"Y":s=Wi(s+o,i,r);break;default:let u=Math.min(a+o,s+o);u<i&&(o+=i-u),u=Math.max(a+o,s+o),u>r&&(o+=r-u),a+=o,s+=o}return[a,s]}return Wi(n+o,i,r)}}class Xne extends D1{constructor(...e){super(...e),q(this,"ControllerState",cCe),q(this,"transition",{transitionDuration:300,transitionInterpolator:new u_(["target","zoom"])}),q(this,"dragMode","pan")}_onPanRotate(){return!1}}class Zne extends Sh{get ViewportType(){return Gne}get ControllerType(){return Xne}}q(Zne,"displayName","OrthographicView");class fCe extends yne{applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=Wi(i,r,n);const{longitude:o,latitude:a}=e;return(o<-180||o>180)&&(e.longitude=oI(o+180,360)-180),e.latitude=Wi(a,-89,89),e}}class Yne extends D1{constructor(...e){super(...e),q(this,"ControllerState",fCe),q(this,"transition",{transitionDuration:300,transitionInterpolator:new u_(["longitude","latitude","zoom"])}),q(this,"dragMode","pan")}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class Qne extends Sh{get ViewportType(){return H5}get ControllerType(){return Yne}}q(Qne,"displayName","GlobeView");class WO{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){q(this,"opts",void 0),e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&uc(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:n}=e.constructor,r={updateTriggers:{}};for(const i in n)if(i in this.props){const o=n[i],a=this.props[i];r[i]=a,o&&o.type==="accessor"&&(r.updateTriggers[i]=this.props.updateTriggers[i],typeof a=="function"&&(r[i]=this.getSubLayerAccessor(a)))}return r}initializeState(e,n){}updateState(e,n){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,n){}finalizeState(e,n){}}q(WO,"defaultProps",{});q(WO,"extensionName","LayerExtension");const iB={bearing:0,pitch:0,position:[0,0,0]},hCe={speed:1.2,curve:1.414};class Kne extends F5{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),q(this,"opts",void 0),this.opts={...hCe,...e}}interpolateProps(e,n,r){const i=une(e,n,r,this.opts);for(const o in iB)i[o]=pc(e[o]||iB[o],n[o]||iB[o],r);return i}getDuration(e,n){let{transitionDuration:r}=n;return r==="auto"&&(r=cne(e,n,this.opts)),r}}class q5{constructor(e){q(this,"opts",void 0),q(this,"typedArrayManager",void 0),q(this,"indexStarts",[0]),q(this,"vertexStarts",[0]),q(this,"vertexCount",0),q(this,"instanceCount",0),q(this,"attributes",void 0),q(this,"_attributeDefs",void 0),q(this,"data",void 0),q(this,"getGeometry",void 0),q(this,"geometryBuffer",void 0),q(this,"buffers",void 0),q(this,"positionSize",void 0),q(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=zv,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:r={},getGeometry:i,geometryBuffer:o,positionFormat:a,dataChanged:s,normalize:u=!0}=this.opts;if(this.data=n,this.getGeometry=i,this.positionSize=o&&o.size||(a==="XY"?2:3),this.buffers=r,this.normalize=u,o&&(ia(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),u||(r.positions=o)),this.geometryBuffer=r.positions,Array.isArray(s))for(const d of s)this._rebuildGeometry(d);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?Mne(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:r,buffers:i,_attributeDefs:o,typedArrayManager:a}=this;for(const s in o)if(s in i)a.release(r[s]),r[s]=null;else{const u=o[s];u.copy=n,r[s]=a.allocate(r[s],e,u)}}_forEachGeometry(e,n,r){const{data:i,getGeometry:o}=this,{iterable:a,objectInfo:s}=Tg(i,n,r);for(const u of a){s.index++;const d=o?o(u,s):null;e(d,s.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:r,instanceCount:i}=this;const{data:o,geometryBuffer:a}=this,{startRow:s=0,endRow:u=1/0}=e||{},d={};if(e||(n=[0],r=[0]),this.normalize||!a)this._forEachGeometry((_,E)=>{const P=_&&this.normalizeGeometry(_);d[E]=P,r[E+1]=r[E]+(P?this.getGeometrySize(P):0)},s,u),i=r[r.length-1];else if(r=o.startIndices,i=r[o.length]||0,ArrayBuffer.isView(a))i=i||a.length/this.positionSize;else if(a instanceof ji){const _=a.accessor.stride||this.positionSize*4;i=i||a.byteLength/_}else if(a.buffer){const _=a.stride||this.positionSize*4;i=i||a.buffer.byteLength/_}else if(a.value){const _=a.value,E=a.stride/_.BYTES_PER_ELEMENT||this.positionSize;i=i||_.length/E}this._allocate(i,!!e),this.indexStarts=n,this.vertexStarts=r,this.instanceCount=i;const g={};this._forEachGeometry((_,E)=>{const P=d[E]||_;g.vertexStart=r[E],g.indexStart=n[E];const R=E<r.length-1?r[E+1]:i;g.geometrySize=R-r[E],g.geometryIndex=E,this.updateGeometryAttributes(P,g)},s,u),this.vertexCount=n[n.length-1]}}const dCe=Object.freeze(Object.defineProperty({__proto__:null,AmbientLight:Zte,AttributeManager:Nne,COORDINATE_SYSTEM:Br,CompositeLayer:Uh,Controller:D1,Deck:zE,DeckRenderer:xne,DirectionalLight:nI,FirstPersonController:Vne,FirstPersonView:$ne,FirstPersonViewport:jne,FlyToInterpolator:Kne,Layer:nl,LayerExtension:WO,LayerManager:_ne,LightingEffect:B5,LinearInterpolator:u_,MapController:vne,MapView:$O,OPERATION:O_e,OrbitController:Wne,OrbitView:qne,OrbitViewport:Une,OrthographicController:Xne,OrthographicView:Zne,OrthographicViewport:Gne,PointLight:gne,PostProcessEffect:R2e,TRANSITION_EVENTS:lI,Tesselator:q5,TransitionInterpolator:F5,UNIT:Bu,VERSION:zee,View:Sh,Viewport:zh,WebMercatorViewport:ug,_CameraLight:h2e,_GlobeController:Yne,_GlobeView:Qne,_GlobeViewport:H5,_LayersPass:GO,_PickLayersPass:N5,_SunLight:O2e,_compareProps:j5,_count:Fne,_deepEqual:uc,_fillArray:Ane,_flatten:NE,_memoize:L1,_mergeShaders:kne,assert:ia,createIterable:Tg,fp64LowPart:hne,gouraudLighting:DE,log:Or,phongLighting:kO,picking:Oc,project:jO,project32:Mc,shadow:lC},Symbol.toStringTag,{value:"Module"})),pCe=typeof window<"u"?we.useLayoutEffect:we.useEffect,gCe=pCe;function fI(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const mCe={position:"absolute",zIndex:-1};function Jne(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>Jne(n,e));if(qO(t)){if(ACe(t))return e.style=mCe,we.cloneElement(t,e);if(_Ce(t))return we.cloneElement(t,e)}return t}function qO(t){return t&&typeof t=="object"&&"type"in t||!1}function ACe(t){var e;return(e=t.props)===null||e===void 0?void 0:e.mapStyle}function _Ce(t){const e=t.type;return e&&e.deckGLViewProps}function WF(t){if(typeof t=="function")return we.createElement(Sh,{},t);if(Array.isArray(t))return t.map(WF);if(qO(t)){if(t.type===we.Fragment)return WF(t.props.children);if(fI(t.type,Sh))return t}return t}function yCe({children:t,layers:e=[],views:n=null}){const r=[],i=[],o={};return we.Children.forEach(WF(t),a=>{if(qO(a)){const s=a.type;if(fI(s,nl)){const u=vCe(s,a.props);i.push(u)}else r.push(a);if(fI(s,Sh)&&s!==Sh&&a.props.id){const u=new s(a.props);o[u.id]=u}}else a&&r.push(a)}),Object.keys(o).length>0&&(Array.isArray(n)?n.forEach(a=>{o[a.id]=a}):n&&(o[n.id]=n),n=Object.values(o)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function vCe(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}function xCe({children:t,deck:e,ContextProvider:n}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},o=r.views[0].id;for(const a of t){let s=o,u=a;qO(a)&&fI(a.type,Sh)&&(s=a.props.id||o,u=a.props.children);const d=r.getViewport(s),g=r.getViewState(s);if(d){g.padding=d.padding;const{x:_,y:E,width:P,height:R}=d;u=Jne(u,{x:_,y:E,width:P,height:R,viewport:d,viewState:g}),i[s]||(i[s]={viewport:d,children:[]}),i[s].children.push(u)}}return Object.keys(i).map(a=>{const{viewport:s,children:u}=i[a],{x:d,y:g,width:_,height:E}=s,P={position:"absolute",left:d,top:g,width:_,height:E},R="view-".concat(a),B=we.createElement("div",{key:R,id:R,style:P},...u);if(n){const V={viewport:s,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:z=>{z.viewId=a,e._onViewStateChange(z)}};return we.createElement(n,{key:R,value:V},B)}return B})}const bCe={mixBlendMode:null};function wCe({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const o in n)o in bCe?i[o]=n[o]:r[o]=n[o];return{containerStyle:r,canvasStyle:i}}function ECe(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function ere(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function SCe(t,e,n){const r=new e({...n,_customRender:i=>{t.redrawReason=i;const o=r.getViewports();t.lastRenderedViewports!==o?t.forceUpdate():ere(t)}});return r}const tre=we.forwardRef((t,e)=>{const[n,r]=we.useState(0),o=we.useRef({control:null,version:n,forceUpdate:()=>r(Y=>Y+1)}).current,a=we.useRef(null),s=we.useRef(null),u=we.useMemo(()=>yCe(t),[t.layers,t.views,t.children]);let d=!0;const g=Y=>{var J;return d&&t.viewState?(o.viewStateUpdateRequested=Y,null):(o.viewStateUpdateRequested=null,(J=t.onViewStateChange)===null||J===void 0?void 0:J.call(t,Y))},_=Y=>{if(d)o.interactionStateUpdateRequested=Y;else{var J;o.interactionStateUpdateRequested=null,(J=t.onInteractionStateChange)===null||J===void 0||J.call(t,Y)}},E=we.useMemo(()=>{const Y={...t,style:null,width:"100%",height:"100%",parent:a.current,canvas:s.current,layers:u.layers,views:u.views,onViewStateChange:g,onInteractionStateChange:_};return delete Y._customRender,o.deck&&o.deck.setProps(Y),Y},[t]);we.useEffect(()=>{const Y=t.Deck||zE;return o.deck=SCe(o,Y,{...E,parent:a.current,canvas:s.current}),()=>{var J;return(J=o.deck)===null||J===void 0?void 0:J.finalize()}},[]),gCe(()=>{ere(o);const{viewStateUpdateRequested:Y,interactionStateUpdateRequested:J}=o;Y&&g(Y),J&&_(J)}),we.useImperativeHandle(e,()=>ECe(o),[]);const P=o.deck&&o.deck.isInitialized?o.deck.getViewports():void 0,{ContextProvider:R,width:B,height:V,id:z,style:F}=t,{containerStyle:k,canvasStyle:X}=we.useMemo(()=>wCe({width:B,height:V,style:F}),[B,V,F]);if(!o.viewStateUpdateRequested&&o.lastRenderedViewports===P||o.version!==n){o.lastRenderedViewports=P,o.version=n;const Y=xCe({children:u.children,deck:o.deck,ContextProvider:R}),J=we.createElement("canvas",{key:"canvas",id:z||"deckgl-overlay",ref:s,style:X});o.control=we.createElement("div",{id:"".concat(z||"deckgl","-wrapper"),ref:a,style:k},[J,Y])}return d=!1,o.control});tre.defaultProps=zE.defaultProps;const TCe=tre;var Hp={},So={};/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function CCe(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(d){return function(g){return u([d,g])}}function u(d){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=d[0]&2?i.return:d[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,d[1])).done)return o;switch(i=0,o&&(d=[d[0]&2,o.value]),d[0]){case 0:case 1:o=d;break;case 4:return n.label++,{value:d[1],done:!1};case 5:n.label++,i=d[1],d=[0];continue;case 7:d=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(d[0]===6||d[0]===2)){n=0;continue}if(d[0]===3&&(!o||d[1]>o[0]&&d[1]<o[3])){n.label=d[1];break}if(d[0]===6&&n.label<o[1]){n.label=o[1],o=d;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(d);break}o[2]&&n.ops.pop(),n.trys.pop();continue}d=e.call(t,n)}catch(g){d=[6,g],i=0}finally{r=o=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}var Qm=function(){function t(e,n){this.next=null,this.key=e,this.data=n,this.left=null,this.right=null}return t}();function PCe(t,e){return t>e?1:t<e?-1:0}function Em(t,e,n){for(var r=new Qm(null,null),i=r,o=r;;){var a=n(t,e.key);if(a<0){if(e.left===null)break;if(n(t,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}o.left=e,o=e,e=e.left}else if(a>0){if(e.right===null)break;if(n(t,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=r.right,e.right=r.left,e}function oB(t,e,n,r){var i=new Qm(t,e);if(n===null)return i.left=i.right=null,i;n=Em(t,n,r);var o=r(t,n.key);return o<0?(i.left=n.left,i.right=n,n.left=null):o>=0&&(i.right=n.right,i.left=n,n.right=null),i}function cH(t,e,n){var r=null,i=null;if(e){e=Em(t,e,n);var o=n(e.key,t);o===0?(r=e.left,i=e.right):o<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function ICe(t,e,n){return e===null?t:(t===null||(e=Em(t.key,e,n),e.left=t),e)}function qF(t,e,n,r,i){if(t){r(""+e+(n?"└── ":"├── ")+i(t)+`
`);var o=e+(n?"    ":"│   ");t.left&&qF(t.left,o,!1,r,i),t.right&&qF(t.right,o,!0,r,i)}}var X5=function(){function t(e){e===void 0&&(e=PCe),this._root=null,this._size=0,this._comparator=e}return t.prototype.insert=function(e,n){return this._size++,this._root=oB(e,n,this._root,this._comparator)},t.prototype.add=function(e,n){var r=new Qm(e,n);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var i=this._comparator,o=Em(e,this._root,i),a=i(e,o.key);return a===0?this._root=o:(a<0?(r.left=o.left,r.right=o,o.left=null):a>0&&(r.right=o.right,r.left=o,o.right=null),this._size++,this._root=r),this._root},t.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},t.prototype._remove=function(e,n,r){var i;if(n===null)return null;n=Em(e,n,r);var o=r(e,n.key);return o===0?(n.left===null?i=n.right:(i=Em(e,n.left,r),i.right=n.right),this._size--,i):n},t.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Em(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},t.prototype.findStatic=function(e){for(var n=this._root,r=this._comparator;n;){var i=r(e,n.key);if(i===0)return n;i<0?n=n.left:n=n.right}return null},t.prototype.find=function(e){return this._root&&(this._root=Em(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},t.prototype.contains=function(e){for(var n=this._root,r=this._comparator;n;){var i=r(e,n.key);if(i===0)return!0;i<0?n=n.left:n=n.right}return!1},t.prototype.forEach=function(e,n){for(var r=this._root,i=[],o=!1;!o;)r!==null?(i.push(r),r=r.left):i.length!==0?(r=i.pop(),e.call(n,r),r=r.right):o=!0;return this},t.prototype.range=function(e,n,r,i){for(var o=[],a=this._comparator,s=this._root,u;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),u=a(s.key,n),u>0)break;if(a(s.key,e)>=0&&r.call(i,s))return this;s=s.right}return this},t.prototype.keys=function(){var e=[];return this.forEach(function(n){var r=n.key;return e.push(r)}),e},t.prototype.values=function(){var e=[];return this.forEach(function(n){var r=n.data;return e.push(r)}),e},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},t.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},t.prototype.at=function(e){for(var n=this._root,r=!1,i=0,o=[];!r;)if(n)o.push(n),n=n.left;else if(o.length>0){if(n=o.pop(),i===e)return n;i++,n=n.right}else r=!0;return null},t.prototype.next=function(e){var n=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var i=this._comparator;n;){var o=i(e.key,n.key);if(o===0)break;o<0?(r=n,n=n.left):n=n.right}return r},t.prototype.prev=function(e){var n=this._root,r=null;if(e.left!==null){for(r=e.left;r.right;)r=r.right;return r}for(var i=this._comparator;n;){var o=i(e.key,n.key);if(o===0)break;o<0?n=n.left:(r=n,n=n.right)}return r},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return OCe(this._root)},t.prototype.load=function(e,n,r){n===void 0&&(n=[]),r===void 0&&(r=!1);var i=e.length,o=this._comparator;if(r&&YF(e,n,0,i-1,o),this._root===null)this._root=XF(e,n,0,i),this._size=i;else{var a=RCe(this.toList(),MCe(e,n),o);i=this._size+i,this._root=ZF({head:a},0,i)}return this},t.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){e===void 0&&(e=function(r){return String(r.key)});var n=[];return qF(this._root,"",!0,function(r){return n.push(r)},e),n.join("")},t.prototype.update=function(e,n,r){var i=this._comparator,o=cH(e,this._root,i),a=o.left,s=o.right;i(e,n)<0?s=oB(n,r,s,i):a=oB(n,r,a,i),this._root=ICe(a,s,i)},t.prototype.split=function(e){return cH(e,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var e,n,r;return CCe(this,function(i){switch(i.label){case 0:e=this._root,n=[],r=!1,i.label=1;case 1:return r?[3,6]:e===null?[3,2]:(n.push(e),e=e.left,[3,5]);case 2:return n.length===0?[3,4]:(e=n.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:r=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},t}();function XF(t,e,n,r){var i=r-n;if(i>0){var o=n+Math.floor(i/2),a=t[o],s=e[o],u=new Qm(a,s);return u.left=XF(t,e,n,o),u.right=XF(t,e,o+1,r),u}return null}function MCe(t,e){for(var n=new Qm(null,null),r=n,i=0;i<t.length;i++)r=r.next=new Qm(t[i],e[i]);return r.next=null,n.next}function OCe(t){for(var e=t,n=[],r=!1,i=new Qm(null,null),o=i;!r;)e?(n.push(e),e=e.left):n.length>0?(e=o=o.next=n.pop(),e=e.right):r=!0;return o.next=null,i.next}function ZF(t,e,n){var r=n-e;if(r>0){var i=e+Math.floor(r/2),o=ZF(t,e,i),a=t.head;return a.left=o,t.head=t.head.next,a.right=ZF(t,i+1,n),a}return null}function RCe(t,e,n){for(var r=new Qm(null,null),i=r,o=t,a=e;o!==null&&a!==null;)n(o.key,a.key)<0?(i.next=o,o=o.next):(i.next=a,a=a.next),i=i.next;return o!==null?i.next=o:a!==null&&(i.next=a),r.next}function YF(t,e,n,r,i){if(!(n>=r)){for(var o=t[n+r>>1],a=n-1,s=r+1;;){do a++;while(i(t[a],o)<0);do s--;while(i(t[s],o)>0);if(a>=s)break;var u=t[a];t[a]=t[s],t[s]=u,u=e[a],e[a]=e[s],e[s]=u}YF(t,e,n,s,i),YF(t,e,s+1,r,i)}}function Lf(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fH(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ql(t,e,n){return e&&fH(t.prototype,e),n&&fH(t,n),t}var hb=function(e,n){return e.ll.x<=n.x&&n.x<=e.ur.x&&e.ll.y<=n.y&&n.y<=e.ur.y},QF=function(e,n){if(n.ur.x<e.ll.x||e.ur.x<n.ll.x||n.ur.y<e.ll.y||e.ur.y<n.ll.y)return null;var r=e.ll.x<n.ll.x?n.ll.x:e.ll.x,i=e.ur.x<n.ur.x?e.ur.x:n.ur.x,o=e.ll.y<n.ll.y?n.ll.y:e.ll.y,a=e.ur.y<n.ur.y?e.ur.y:n.ur.y;return{ll:{x:r,y:o},ur:{x:i,y:a}}},Im=Number.EPSILON;Im===void 0&&(Im=Math.pow(2,-52));var LCe=Im*Im,KF=function(e,n){if(-Im<e&&e<Im&&-Im<n&&n<Im)return 0;var r=e-n;return r*r<LCe*e*n?0:e<n?-1:1},DCe=function(){function t(){Lf(this,t),this.reset()}return Ql(t,[{key:"reset",value:function(){this.xRounder=new hH,this.yRounder=new hH}},{key:"round",value:function(n,r){return{x:this.xRounder.round(n),y:this.yRounder.round(r)}}}]),t}(),hH=function(){function t(){Lf(this,t),this.tree=new X5,this.round(0)}return Ql(t,[{key:"round",value:function(n){var r=this.tree.add(n),i=this.tree.prev(r);if(i!==null&&KF(r.key,i.key)===0)return this.tree.remove(n),i.key;var o=this.tree.next(r);return o!==null&&KF(r.key,o.key)===0?(this.tree.remove(n),o.key):n}}]),t}(),Gw=new DCe,fw=function(e,n){return e.x*n.y-e.y*n.x},nre=function(e,n){return e.x*n.x+e.y*n.y},dH=function(e,n,r){var i={x:n.x-e.x,y:n.y-e.y},o={x:r.x-e.x,y:r.y-e.y},a=fw(i,o);return KF(a,0)},hI=function(e){return Math.sqrt(nre(e,e))},BCe=function(e,n,r){var i={x:n.x-e.x,y:n.y-e.y},o={x:r.x-e.x,y:r.y-e.y};return fw(o,i)/hI(o)/hI(i)},NCe=function(e,n,r){var i={x:n.x-e.x,y:n.y-e.y},o={x:r.x-e.x,y:r.y-e.y};return nre(o,i)/hI(o)/hI(i)},pH=function(e,n,r){return n.y===0?null:{x:e.x+n.x/n.y*(r-e.y),y:r}},gH=function(e,n,r){return n.x===0?null:{x:r,y:e.y+n.y/n.x*(r-e.x)}},FCe=function(e,n,r,i){if(n.x===0)return gH(r,i,e.x);if(i.x===0)return gH(e,n,r.x);if(n.y===0)return pH(r,i,e.y);if(i.y===0)return pH(e,n,r.y);var o=fw(n,i);if(o==0)return null;var a={x:r.x-e.x,y:r.y-e.y},s=fw(a,n)/o,u=fw(a,i)/o,d=e.x+u*n.x,g=r.x+s*i.x,_=e.y+u*n.y,E=r.y+s*i.y,P=(d+g)/2,R=(_+E)/2;return{x:P,y:R}},Ed=function(){Ql(t,null,[{key:"compare",value:function(n,r){var i=t.comparePoints(n.point,r.point);return i!==0?i:(n.point!==r.point&&n.link(r),n.isLeft!==r.isLeft?n.isLeft?1:-1:dI.compare(n.segment,r.segment))}},{key:"comparePoints",value:function(n,r){return n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0}}]);function t(e,n){Lf(this,t),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}return Ql(t,[{key:"link",value:function(n){if(n.point===this.point)throw new Error("Tried to link already linked events");for(var r=n.point.events,i=0,o=r.length;i<o;i++){var a=r[i];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var n=this.point.events.length,r=0;r<n;r++){var i=this.point.events[r];if(i.segment.consumedBy===void 0)for(var o=r+1;o<n;o++){var a=this.point.events[o];a.consumedBy===void 0&&i.otherSE.point.events===a.otherSE.point.events&&i.segment.consume(a.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var n=[],r=0,i=this.point.events.length;r<i;r++){var o=this.point.events[r];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&n.push(o)}return n}},{key:"getLeftmostComparator",value:function(n){var r=this,i=new Map,o=function(s){var u=s.otherSE;i.set(s,{sine:BCe(r.point,n.point,u.point),cosine:NCe(r.point,n.point,u.point)})};return function(a,s){i.has(a)||o(a),i.has(s)||o(s);var u=i.get(a),d=u.sine,g=u.cosine,_=i.get(s),E=_.sine,P=_.cosine;return d>=0&&E>=0?g<P?1:g>P?-1:0:d<0&&E<0?g<P?-1:g>P?1:0:E<d?-1:E>d?1:0}}}]),t}(),kCe=0,dI=function(){Ql(t,null,[{key:"compare",value:function(n,r){var i=n.leftSE.point.x,o=r.leftSE.point.x,a=n.rightSE.point.x,s=r.rightSE.point.x;if(s<i)return 1;if(a<o)return-1;var u=n.leftSE.point.y,d=r.leftSE.point.y,g=n.rightSE.point.y,_=r.rightSE.point.y;if(i<o){if(d<u&&d<g)return 1;if(d>u&&d>g)return-1;var E=n.comparePoint(r.leftSE.point);if(E<0)return 1;if(E>0)return-1;var P=r.comparePoint(n.rightSE.point);return P!==0?P:-1}if(i>o){if(u<d&&u<_)return-1;if(u>d&&u>_)return 1;var R=r.comparePoint(n.leftSE.point);if(R!==0)return R;var B=n.comparePoint(r.rightSE.point);return B<0?1:B>0?-1:1}if(u<d)return-1;if(u>d)return 1;if(a<s){var V=r.comparePoint(n.rightSE.point);if(V!==0)return V}if(a>s){var z=n.comparePoint(r.rightSE.point);if(z<0)return 1;if(z>0)return-1}if(a!==s){var F=g-u,k=a-i,X=_-d,Y=s-o;if(F>k&&X<Y)return 1;if(F<k&&X>Y)return-1}return a>s?1:a<s||g<_?-1:g>_?1:n.id<r.id?-1:n.id>r.id?1:0}}]);function t(e,n,r,i){Lf(this,t),this.id=++kCe,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=r,this.windings=i}return Ql(t,[{key:"replaceRightSE",value:function(n){this.rightSE=n,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var n=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:n<r?n:r},ur:{x:this.rightSE.point.x,y:n>r?n:r}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(n){return n.x===this.leftSE.point.x&&n.y===this.leftSE.point.y||n.x===this.rightSE.point.x&&n.y===this.rightSE.point.y}},{key:"comparePoint",value:function(n){if(this.isAnEndpoint(n))return 0;var r=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(r.x===i.x)return n.x===r.x?0:n.x<r.x?1:-1;var a=(n.y-r.y)/o.y,s=r.x+a*o.x;if(n.x===s)return 0;var u=(n.x-r.x)/o.x,d=r.y+u*o.y;return n.y===d?0:n.y<d?-1:1}},{key:"getIntersection",value:function(n){var r=this.bbox(),i=n.bbox(),o=QF(r,i);if(o===null)return null;var a=this.leftSE.point,s=this.rightSE.point,u=n.leftSE.point,d=n.rightSE.point,g=hb(r,u)&&this.comparePoint(u)===0,_=hb(i,a)&&n.comparePoint(a)===0,E=hb(r,d)&&this.comparePoint(d)===0,P=hb(i,s)&&n.comparePoint(s)===0;if(_&&g)return P&&!E?s:!P&&E?d:null;if(_)return E&&a.x===d.x&&a.y===d.y?null:a;if(g)return P&&s.x===u.x&&s.y===u.y?null:u;if(P&&E)return null;if(P)return s;if(E)return d;var R=FCe(a,this.vector(),u,n.vector());return R===null||!hb(o,R)?null:Gw.round(R.x,R.y)}},{key:"split",value:function(n){var r=[],i=n.events!==void 0,o=new Ed(n,!0),a=new Ed(n,!1),s=this.rightSE;this.replaceRightSE(a),r.push(a),r.push(o);var u=new t(o,s,this.rings.slice(),this.windings.slice());return Ed.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),Ed.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),a.checkForConsuming()),r}},{key:"swapEvents",value:function(){var n=this.rightSE;this.rightSE=this.leftSE,this.leftSE=n,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var r=0,i=this.windings.length;r<i;r++)this.windings[r]*=-1}},{key:"consume",value:function(n){for(var r=this,i=n;r.consumedBy;)r=r.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=t.compare(r,i);if(o!==0){if(o>0){var a=r;r=i,i=a}if(r.prev===i){var s=r;r=i,i=s}for(var u=0,d=i.rings.length;u<d;u++){var g=i.rings[u],_=i.windings[u],E=r.rings.indexOf(g);E===-1?(r.rings.push(g),r.windings.push(_)):r.windings[E]+=_}i.rings=null,i.windings=null,i.consumedBy=r,i.leftSE.consumedBy=r.leftSE,i.rightSE.consumedBy=r.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var n=this.prev.consumedBy||this.prev;this._beforeState=n.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var n=this.beforeState();this._afterState={rings:n.rings.slice(0),windings:n.windings.slice(0),multiPolys:[]};for(var r=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,a=0,s=this.rings.length;a<s;a++){var u=this.rings[a],d=this.windings[a],g=r.indexOf(u);g===-1?(r.push(u),i.push(d)):i[g]+=d}for(var _=[],E=[],P=0,R=r.length;P<R;P++)if(i[P]!==0){var B=r[P],V=B.poly;if(E.indexOf(V)===-1)if(B.isExterior)_.push(V);else{E.indexOf(V)===-1&&E.push(V);var z=_.indexOf(B.poly);z!==-1&&_.splice(z,1)}}for(var F=0,k=_.length;F<k;F++){var X=_[F].multiPoly;o.indexOf(X)===-1&&o.push(X)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var n=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(ph.type){case"union":{var i=n.length===0,o=r.length===0;this._isInResult=i!==o;break}case"intersection":{var a,s;n.length<r.length?(a=n.length,s=r.length):(a=r.length,s=n.length),this._isInResult=s===ph.numMultiPolys&&a<s;break}case"xor":{var u=Math.abs(n.length-r.length);this._isInResult=u%2===1;break}case"difference":{var d=function(_){return _.length===1&&_[0].isSubject};this._isInResult=d(n)!==d(r);break}default:throw new Error("Unrecognized operation type found ".concat(ph.type))}return this._isInResult}}],[{key:"fromRing",value:function(n,r,i){var o,a,s,u=Ed.comparePoints(n,r);if(u<0)o=n,a=r,s=1;else if(u>0)o=r,a=n,s=-1;else throw new Error("Tried to create degenerate segment at [".concat(n.x,", ").concat(n.y,"]"));var d=new Ed(o,!0),g=new Ed(a,!1);return new t(d,g,[i],[s])}}]),t}(),mH=function(){function t(e,n,r){if(Lf(this,t),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Gw.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,a=1,s=e.length;a<s;a++){if(typeof e[a][0]!="number"||typeof e[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var u=Gw.round(e[a][0],e[a][1]);u.x===o.x&&u.y===o.y||(this.segments.push(dI.fromRing(o,u,this)),u.x<this.bbox.ll.x&&(this.bbox.ll.x=u.x),u.y<this.bbox.ll.y&&(this.bbox.ll.y=u.y),u.x>this.bbox.ur.x&&(this.bbox.ur.x=u.x),u.y>this.bbox.ur.y&&(this.bbox.ur.y=u.y),o=u)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(dI.fromRing(o,i,this))}return Ql(t,[{key:"getSweepEvents",value:function(){for(var n=[],r=0,i=this.segments.length;r<i;r++){var o=this.segments[r];n.push(o.leftSE),n.push(o.rightSE)}return n}}]),t}(),zCe=function(){function t(e,n){if(Lf(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new mH(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=e.length;r<i;r++){var o=new mH(e[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=n}return Ql(t,[{key:"getSweepEvents",value:function(){for(var n=this.exteriorRing.getSweepEvents(),r=0,i=this.interiorRings.length;r<i;r++)for(var o=this.interiorRings[r].getSweepEvents(),a=0,s=o.length;a<s;a++)n.push(o[a]);return n}}]),t}(),AH=function(){function t(e,n){if(Lf(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=e.length;r<i;r++){var o=new zCe(e[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=n}return Ql(t,[{key:"getSweepEvents",value:function(){for(var n=[],r=0,i=this.polys.length;r<i;r++)for(var o=this.polys[r].getSweepEvents(),a=0,s=o.length;a<s;a++)n.push(o[a]);return n}}]),t}(),UCe=function(){Ql(t,null,[{key:"factory",value:function(n){for(var r=[],i=0,o=n.length;i<o;i++){var a=n[i];if(!(!a.isInResult()||a.ringOut)){for(var s=null,u=a.leftSE,d=a.rightSE,g=[u],_=u.point,E=[];s=u,u=d,g.push(u),u.point!==_;)for(;;){var P=u.getAvailableLinkedEvents();if(P.length===0){var R=g[0].point,B=g[g.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(R.x,",")+" ".concat(R.y,"]. Last matching segment found ends at")+" [".concat(B.x,", ").concat(B.y,"]."))}if(P.length===1){d=P[0].otherSE;break}for(var V=null,z=0,F=E.length;z<F;z++)if(E[z].point===u.point){V=z;break}if(V!==null){var k=E.splice(V)[0],X=g.splice(k.index);X.unshift(X[0].otherSE),r.push(new t(X.reverse()));continue}E.push({index:g.length,point:u.point});var Y=u.getLeftmostComparator(s);d=P.sort(Y)[0].otherSE;break}r.push(new t(g))}}return r}}]);function t(e){Lf(this,t),this.events=e;for(var n=0,r=e.length;n<r;n++)e[n].segment.ringOut=this;this.poly=null}return Ql(t,[{key:"getGeom",value:function(){for(var n=this.events[0].point,r=[n],i=1,o=this.events.length-1;i<o;i++){var a=this.events[i].point,s=this.events[i+1].point;dH(a,n,s)!==0&&(r.push(a),n=a)}if(r.length===1)return null;var u=r[0],d=r[1];dH(u,n,d)===0&&r.shift(),r.push(r[0]);for(var g=this.isExteriorRing()?1:-1,_=this.isExteriorRing()?0:r.length-1,E=this.isExteriorRing()?r.length:-1,P=[],R=_;R!=E;R+=g)P.push([r[R].x,r[R].y]);return P}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var n=this.enclosingRing();this._isExteriorRing=n?!n.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var n=this.events[0],r=1,i=this.events.length;r<i;r++){var o=this.events[r];Ed.compare(n,o)>0&&(n=o)}for(var a=n.segment.prevInResult(),s=a?a.prevInResult():null;;){if(!a)return null;if(!s)return a.ringOut;if(s.ringOut!==a.ringOut)return s.ringOut.enclosingRing()!==a.ringOut?a.ringOut:a.ringOut.enclosingRing();a=s.prevInResult(),s=a?a.prevInResult():null}}}]),t}(),_H=function(){function t(e){Lf(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Ql(t,[{key:"addInterior",value:function(n){this.interiorRings.push(n),n.poly=this}},{key:"getGeom",value:function(){var n=[this.exteriorRing.getGeom()];if(n[0]===null)return null;for(var r=0,i=this.interiorRings.length;r<i;r++){var o=this.interiorRings[r].getGeom();o!==null&&n.push(o)}return n}}]),t}(),GCe=function(){function t(e){Lf(this,t),this.rings=e,this.polys=this._composePolys(e)}return Ql(t,[{key:"getGeom",value:function(){for(var n=[],r=0,i=this.polys.length;r<i;r++){var o=this.polys[r].getGeom();o!==null&&n.push(o)}return n}},{key:"_composePolys",value:function(n){for(var r=[],i=0,o=n.length;i<o;i++){var a=n[i];if(!a.poly)if(a.isExteriorRing())r.push(new _H(a));else{var s=a.enclosingRing();s.poly||r.push(new _H(s)),s.poly.addInterior(a)}}return r}}]),t}(),jCe=function(){function t(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:dI.compare;Lf(this,t),this.queue=e,this.tree=new X5(n),this.segments=[]}return Ql(t,[{key:"process",value:function(n){var r=n.segment,i=[];if(n.consumedBy)return n.isLeft?this.queue.remove(n.otherSE):this.tree.remove(r),i;var o=n.isLeft?this.tree.insert(r):this.tree.find(r);if(!o)throw new Error("Unable to find segment #".concat(r.id," ")+"[".concat(r.leftSE.point.x,", ").concat(r.leftSE.point.y,"] -> ")+"[".concat(r.rightSE.point.x,", ").concat(r.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var a=o,s=o,u=void 0,d=void 0;u===void 0;)a=this.tree.prev(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);for(;d===void 0;)s=this.tree.next(s),s===null?d=null:s.key.consumedBy===void 0&&(d=s.key);if(n.isLeft){var g=null;if(u){var _=u.getIntersection(r);if(_!==null&&(r.isAnEndpoint(_)||(g=_),!u.isAnEndpoint(_)))for(var E=this._splitSafely(u,_),P=0,R=E.length;P<R;P++)i.push(E[P])}var B=null;if(d){var V=d.getIntersection(r);if(V!==null&&(r.isAnEndpoint(V)||(B=V),!d.isAnEndpoint(V)))for(var z=this._splitSafely(d,V),F=0,k=z.length;F<k;F++)i.push(z[F])}if(g!==null||B!==null){var X=null;if(g===null)X=B;else if(B===null)X=g;else{var Y=Ed.comparePoints(g,B);X=Y<=0?g:B}this.queue.remove(r.rightSE),i.push(r.rightSE);for(var J=r.split(X),ie=0,ce=J.length;ie<ce;ie++)i.push(J[ie])}i.length>0?(this.tree.remove(r),i.push(n)):(this.segments.push(r),r.prev=u)}else{if(u&&d){var re=u.getIntersection(d);if(re!==null){if(!u.isAnEndpoint(re))for(var ue=this._splitSafely(u,re),se=0,me=ue.length;se<me;se++)i.push(ue[se]);if(!d.isAnEndpoint(re))for(var Ce=this._splitSafely(d,re),be=0,Ye=Ce.length;be<Ye;be++)i.push(Ce[be])}}this.tree.remove(r)}return i}},{key:"_splitSafely",value:function(n,r){this.tree.remove(n);var i=n.rightSE;this.queue.remove(i);var o=n.split(r);return o.push(i),n.consumedBy===void 0&&this.tree.insert(n),o}}]),t}(),yH=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,VCe=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,$Ce=function(){function t(){Lf(this,t)}return Ql(t,[{key:"run",value:function(n,r,i){ph.type=n,Gw.reset();for(var o=[new AH(r,!0)],a=0,s=i.length;a<s;a++)o.push(new AH(i[a],!1));if(ph.numMultiPolys=o.length,ph.type==="difference")for(var u=o[0],d=1;d<o.length;)QF(o[d].bbox,u.bbox)!==null?d++:o.splice(d,1);if(ph.type==="intersection"){for(var g=0,_=o.length;g<_;g++)for(var E=o[g],P=g+1,R=o.length;P<R;P++)if(QF(E.bbox,o[P].bbox)===null)return[]}for(var B=new X5(Ed.compare),V=0,z=o.length;V<z;V++)for(var F=o[V].getSweepEvents(),k=0,X=F.length;k<X;k++)if(B.insert(F[k]),B.size>yH)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Y=new jCe(B),J=B.size,ie=B.pop();ie;){var ce=ie.key;if(B.size===J){var re=ce.segment;throw new Error("Unable to pop() ".concat(ce.isLeft?"left":"right"," SweepEvent ")+"[".concat(ce.point.x,", ").concat(ce.point.y,"] from segment #").concat(re.id," ")+"[".concat(re.leftSE.point.x,", ").concat(re.leftSE.point.y,"] -> ")+"[".concat(re.rightSE.point.x,", ").concat(re.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(B.size>yH)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Y.segments.length>VCe)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var ue=Y.process(ce),se=0,me=ue.length;se<me;se++){var Ce=ue[se];Ce.consumedBy===void 0&&B.insert(Ce)}J=B.size,ie=B.pop()}Gw.reset();var be=UCe.factory(Y.segments),Ye=new GCe(be);return Ye.getGeom()}}]),t}(),ph=new $Ce,HCe=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return ph.run("union",e,r)},WCe=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return ph.run("intersection",e,r)},qCe=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return ph.run("xor",e,r)},XCe=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return ph.run("difference",e,r)},ZCe={union:HCe,intersection:WCe,xor:qCe,difference:XCe};const Z5=ZCe;var na=63710088e-1,Y5={centimeters:na*100,centimetres:na*100,degrees:na/111325,feet:na*3.28084,inches:na*39.37,kilometers:na/1e3,kilometres:na/1e3,meters:na,metres:na,miles:na/1609.344,millimeters:na*1e3,millimetres:na*1e3,nauticalmiles:na/1852,radians:1,yards:na*1.0936},YCe={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/na,yards:1.0936133},JF={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Kl(t,e,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function QCe(t,e,n){switch(t){case"Point":return zo(e).geometry;case"LineString":return Su(e).geometry;case"Polygon":return Th(e).geometry;case"MultiPoint":return rre(e).geometry;case"MultiLineString":return Q5(e).geometry;case"MultiPolygon":return UE(e).geometry;default:throw new Error(t+" is invalid")}}function zo(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Km(t[0])||!Km(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return Kl(r,e,n)}function KCe(t,e,n){return n===void 0&&(n={}),vf(t.map(function(r){return zo(r,e)}),n)}function Th(t,e,n){n===void 0&&(n={});for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:t};return Kl(s,e,n)}function JCe(t,e,n){return n===void 0&&(n={}),vf(t.map(function(r){return Th(r,e)}),n)}function Su(t,e,n){if(n===void 0&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:t};return Kl(r,e,n)}function ePe(t,e,n){return n===void 0&&(n={}),vf(t.map(function(r){return Su(r,e)}),n)}function vf(t,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function Q5(t,e,n){n===void 0&&(n={});var r={type:"MultiLineString",coordinates:t};return Kl(r,e,n)}function rre(t,e,n){n===void 0&&(n={});var r={type:"MultiPoint",coordinates:t};return Kl(r,e,n)}function UE(t,e,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:t};return Kl(r,e,n)}function tPe(t,e,n){n===void 0&&(n={});var r={type:"GeometryCollection",geometries:t};return Kl(r,e,n)}function nPe(t,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n}function XO(t,e){e===void 0&&(e="kilometers");var n=Y5[e];if(!n)throw new Error(e+" units is invalid");return t*n}function GE(t,e){e===void 0&&(e="kilometers");var n=Y5[e];if(!n)throw new Error(e+" units is invalid");return t/n}function rPe(t,e){return Uv(GE(t,e))}function iPe(t){var e=t%360;return e<0&&(e+=360),e}function Uv(t){var e=t%(2*Math.PI);return e*180/Math.PI}function wa(t){var e=t%360;return e*Math.PI/180}function ZO(t,e,n){if(e===void 0&&(e="kilometers"),n===void 0&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return XO(GE(t,e),n)}function oPe(t,e,n){if(e===void 0&&(e="meters"),n===void 0&&(n="kilometers"),!(t>=0))throw new Error("area must be a positive number");var r=JF[e];if(!r)throw new Error("invalid original units");var i=JF[n];if(!i)throw new Error("invalid final units");return t/r*i}function Km(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function c_(t){return!!t&&t.constructor===Object}function sPe(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(e){if(!Km(e))throw new Error("bbox must only contain numbers")})}function aPe(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}const lPe=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:JF,bearingToAzimuth:iPe,convertArea:oPe,convertLength:ZO,degreesToRadians:wa,earthRadius:na,factors:Y5,feature:Kl,featureCollection:vf,geometry:QCe,geometryCollection:tPe,isNumber:Km,isObject:c_,lengthToDegrees:rPe,lengthToRadians:GE,lineString:Su,lineStrings:ePe,multiLineString:Q5,multiPoint:rre,multiPolygon:UE,point:zo,points:KCe,polygon:Th,polygons:JCe,radiansToDegrees:Uv,radiansToLength:XO,round:nPe,unitsFactors:YCe,validateBBox:sPe,validateId:aPe},Symbol.toStringTag,{value:"Module"}));function Ea(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function jd(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ire(t){if(t.length>1&&Km(t[0])&&Km(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return ire(t[0]);throw new Error("coordinates must only contain numbers")}function uPe(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}function ek(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}function cPe(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(var r=0,i=t.features;r<i.length;r++){var o=i[r];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!o.geometry||o.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+o.geometry.type)}}function xf(t){return t.type==="Feature"?t.geometry:t}function ore(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}const fPe=Object.freeze(Object.defineProperty({__proto__:null,collectionOf:cPe,containsNumber:ire,featureOf:ek,geojsonType:uPe,getCoord:Ea,getCoords:jd,getGeom:xf,getType:ore},Symbol.toStringTag,{value:"Module"}));function hPe(t,e,n){n===void 0&&(n={});var r=xf(t),i=xf(e),o=Z5.union(r.coordinates,i.coordinates);return o.length===0?null:o.length===1?Th(o[0],n.properties):UE(o,n.properties)}const dPe=Object.freeze(Object.defineProperty({__proto__:null,default:hPe},Symbol.toStringTag,{value:"Module"})),pPe=ti(dPe);function gPe(t,e){var n=xf(t),r=xf(e),i=t.properties||{},o=Z5.difference(n.coordinates,r.coordinates);return o.length===0?null:o.length===1?Th(o[0],i):UE(o,i)}const mPe=Object.freeze(Object.defineProperty({__proto__:null,default:gPe},Symbol.toStringTag,{value:"Module"})),K5=ti(mPe);function APe(t,e,n){n===void 0&&(n={});var r=xf(t),i=xf(e),o=Z5.intersection(r.coordinates,i.coordinates);return o.length===0?null:o.length===1?Th(o[0],n.properties):UE(o,n.properties)}const _Pe=Object.freeze(Object.defineProperty({__proto__:null,default:APe},Symbol.toStringTag,{value:"Module"})),yPe=ti(_Pe);function vPe(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return sre(t);case"FeatureCollection":return xPe(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return J5(t);default:throw new Error("unknown GeoJSON type")}}function sre(t){var e={type:"Feature"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}}),e.properties=are(t.properties),e.geometry=J5(t.geometry),e}function are(t){var e={};return t&&Object.keys(t).forEach(function(n){var r=t[n];typeof r=="object"?r===null?e[n]=null:r.length?e[n]=r.map(function(i){return i}):e[n]=are(r):e[n]=r}),e}function xPe(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"features":return;default:e[n]=t[n]}}),e.features=t.features.map(function(n){return sre(n)}),e}function J5(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),t.type==="GeometryCollection"?(e.geometries=t.geometries.map(function(n){return J5(n)}),e):(e.coordinates=lre(t.coordinates),e)}function lre(t){return typeof t[0]!="object"?t.slice():t.map(function(e){return lre(e)})}function bPe(t){if(!t)throw new Error("coords is required");if(t.type==="Feature"&&t.geometry!==null)return t.geometry.coordinates;if(t.coordinates)return t.coordinates;if(Array.isArray(t))return t;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function tk(t){if(!t)throw new Error("line is required");var e=t.geometry?t.geometry.type:t.type;if(!Array.isArray(t)&&e!=="LineString")throw new Error("geometry must be a LineString");for(var n=bPe(t),r=0,i=1,o,a;i<n.length;)o=a||n[0],a=n[i],r+=(a[0]-o[0])*(a[1]+o[1]),i++;return r>0}function wPe(t,e){if(e=e||{},!ure(e))throw new Error("options is invalid");var n=e.bbox,r=e.id;if(!t)throw new Error("No features passed");if(!Array.isArray(t))throw new Error("features must be an Array");n&&SPe(n),r&&TPe(r);var i={type:"FeatureCollection"};return r&&(i.id=r),n&&(i.bbox=n),i.features=t,i}function EPe(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function ure(t){return!!t&&t.constructor===Object}function SPe(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(e){if(!EPe(e))throw new Error("bbox must only contain numbers")})}function TPe(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}function vH(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function cre(t,e){var n,r,i,o,a,s,u,d,g,_,E=0,P=t.type==="FeatureCollection",R=t.type==="Feature",B=P?t.features.length:1;for(n=0;n<B;n++){for(s=P?t.features[n].geometry:R?t.geometry:t,d=P?t.features[n].properties:R?t.properties:{},g=P?t.features[n].bbox:R?t.bbox:void 0,_=P?t.features[n].id:R?t.id:void 0,u=s?s.type==="GeometryCollection":!1,a=u?s.geometries.length:1,i=0;i<a;i++){if(o=u?s.geometries[i]:s,o===null){if(e(null,E,d,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,E,d,g,_)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],E,d,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}E++}}function NS(t){if(!t)throw new Error("coords is required");if(t.type==="Feature"&&t.geometry!==null)return t.geometry.coordinates;if(t.coordinates)return t.coordinates;if(Array.isArray(t))return t;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function CPe(t,e){if(e=e||{},!ure(e))throw new Error("options is invalid");var n=e.reverse||!1,r=e.mutate||!1;if(!t)throw new Error("<geojson> is required");if(typeof n!="boolean")throw new Error("<reverse> must be a boolean");if(typeof r!="boolean")throw new Error("<mutate> must be a boolean");r===!1&&(t=vPe(t));var i=[];switch(t.type){case"GeometryCollection":return cre(t,function(o){hC(o,n)}),t;case"FeatureCollection":return vH(t,function(o){vH(hC(o,n),function(a){i.push(a)})}),wPe(i)}return hC(t,n)}function hC(t,e){var n=t.type==="Feature"?t.geometry.type:t.type;switch(n){case"GeometryCollection":return cre(t,function(r){hC(r,e)}),t;case"LineString":return xH(NS(t),e),t;case"Polygon":return bH(NS(t),e),t;case"MultiLineString":return NS(t).forEach(function(r){xH(r,e)}),t;case"MultiPolygon":return NS(t).forEach(function(r){bH(r,e)}),t;case"Point":case"MultiPoint":return t}}function xH(t,e){tk(t)===e&&t.reverse()}function bH(t,e){tk(t[0])!==e&&t[0].reverse();for(var n=1;n<t.length;n++)tk(t[n])===e&&t[n].reverse()}const PPe=Object.freeze(Object.defineProperty({__proto__:null,default:CPe},Symbol.toStringTag,{value:"Module"})),IPe=ti(PPe);var Ai={};function Gv(t,e,n,r){r===void 0&&(r={});var i=Ea(t),o=wa(i[0]),a=wa(i[1]),s=wa(n),u=GE(e,r.units),d=Math.asin(Math.sin(a)*Math.cos(u)+Math.cos(a)*Math.sin(u)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(u)*Math.cos(a),Math.cos(u)-Math.sin(a)*Math.sin(d)),_=Uv(g),E=Uv(d);return zo([_,E],r.properties)}const MPe=Object.freeze(Object.defineProperty({__proto__:null,default:Gv},Symbol.toStringTag,{value:"Module"})),YO=ti(MPe);function jE(t,e,n){if(n===void 0&&(n={}),n.final===!0)return OPe(t,e);var r=Ea(t),i=Ea(e),o=wa(r[0]),a=wa(i[0]),s=wa(r[1]),u=wa(i[1]),d=Math.sin(a-o)*Math.cos(u),g=Math.cos(s)*Math.sin(u)-Math.sin(s)*Math.cos(u)*Math.cos(a-o);return Uv(Math.atan2(d,g))}function OPe(t,e){var n=jE(e,t);return n=(n+180)%360,n}const RPe=Object.freeze(Object.defineProperty({__proto__:null,default:jE},Symbol.toStringTag,{value:"Module"})),Kd=ti(RPe);function ch(t,e,n){n===void 0&&(n={});var r=Ea(t),i=Ea(e),o=wa(i[1]-r[1]),a=wa(i[0]-r[0]),s=wa(r[1]),u=wa(i[1]),d=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(u);return XO(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),n.units)}const LPe=Object.freeze(Object.defineProperty({__proto__:null,default:ch},Symbol.toStringTag,{value:"Module"}));function Jd(t,e,n){if(t!==null)for(var r,i,o,a,s,u,d,g=0,_=0,E,P=t.type,R=P==="FeatureCollection",B=P==="Feature",V=R?t.features.length:1,z=0;z<V;z++){d=R?t.features[z].geometry:B?t.geometry:t,E=d?d.type==="GeometryCollection":!1,s=E?d.geometries.length:1;for(var F=0;F<s;F++){var k=0,X=0;if(a=E?d.geometries[F]:d,a!==null){u=a.coordinates;var Y=a.type;switch(g=n&&(Y==="Polygon"||Y==="MultiPolygon")?1:0,Y){case null:break;case"Point":if(e(u,_,z,k,X)===!1)return!1;_++,k++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(e(u[r],_,z,k,X)===!1)return!1;_++,Y==="MultiPoint"&&k++}Y==="LineString"&&k++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-g;i++){if(e(u[r][i],_,z,k,X)===!1)return!1;_++}Y==="MultiLineString"&&k++,Y==="Polygon"&&X++}Y==="Polygon"&&k++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(X=0,i=0;i<u[r].length;i++){for(o=0;o<u[r][i].length-g;o++){if(e(u[r][i][o],_,z,k,X)===!1)return!1;_++}X++}k++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(Jd(a.geometries[r],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function DPe(t,e,n,r){var i=n;return Jd(t,function(o,a,s,u,d){a===0&&n===void 0?i=o:i=e(i,o,a,s,u,d)},r),i}function fre(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&e(t.features[n].properties,n)!==!1;n++);break;case"Feature":e(t.properties,0);break}}function BPe(t,e,n){var r=n;return fre(t,function(i,o){o===0&&n===void 0?r=i:r=e(r,i,o)}),r}function k0(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function NPe(t,e,n){var r=n;return k0(t,function(i,o){o===0&&n===void 0?r=i:r=e(r,i,o)}),r}function FPe(t){var e=[];return Jd(t,function(n){e.push(n)}),e}function VE(t,e){var n,r,i,o,a,s,u,d,g,_,E=0,P=t.type==="FeatureCollection",R=t.type==="Feature",B=P?t.features.length:1;for(n=0;n<B;n++){for(s=P?t.features[n].geometry:R?t.geometry:t,d=P?t.features[n].properties:R?t.properties:{},g=P?t.features[n].bbox:R?t.bbox:void 0,_=P?t.features[n].id:R?t.id:void 0,u=s?s.type==="GeometryCollection":!1,a=u?s.geometries.length:1,i=0;i<a;i++){if(o=u?s.geometries[i]:s,o===null){if(e(null,E,d,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,E,d,g,_)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],E,d,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}E++}}function hre(t,e,n){var r=n;return VE(t,function(i,o,a,s,u){o===0&&n===void 0?r=i:r=e(r,i,o,a,s,u)}),r}function Vd(t,e){VE(t,function(n,r,i,o,a){var s=n===null?null:n.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Kl(n,i,{bbox:o,id:a}),r,0)===!1?!1:void 0}var u;switch(s){case"MultiPoint":u="Point";break;case"MultiLineString":u="LineString";break;case"MultiPolygon":u="Polygon";break}for(var d=0;d<n.coordinates.length;d++){var g=n.coordinates[d],_={type:u,coordinates:g};if(e(Kl(_,i),r,d)===!1)return!1}})}function kPe(t,e,n){var r=n;return Vd(t,function(i,o,a){o===0&&a===0&&n===void 0?r=i:r=e(r,i,o,a)}),r}function e6(t,e){Vd(t,function(n,r,i){var o=0;if(n.geometry){var a=n.geometry.type;if(!(a==="Point"||a==="MultiPoint")){var s,u=0,d=0,g=0;if(Jd(n,function(_,E,P,R,B){if(s===void 0||r>u||R>d||B>g){s=_,u=r,d=R,g=B,o=0;return}var V=Su([s,_],n.properties);if(e(V,r,i,B,o)===!1)return!1;o++,s=_})===!1)return!1}}})}function zPe(t,e,n){var r=n,i=!1;return e6(t,function(o,a,s,u,d){i===!1&&n===void 0?r=o:r=e(r,o,a,s,u,d),i=!0}),r}function dre(t,e){if(!t)throw new Error("geojson is required");Vd(t,function(n,r,i){if(n.geometry!==null){var o=n.geometry.type,a=n.geometry.coordinates;switch(o){case"LineString":if(e(n,r,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(e(Su(a[s],n.properties),r,i,s)===!1)return!1;break}}})}function UPe(t,e,n){var r=n;return dre(t,function(i,o,a,s){o===0&&n===void 0?r=i:r=e(r,i,o,a,s)}),r}function GPe(t,e){if(e=e||{},!c_(e))throw new Error("options is invalid");var n=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,a=e.properties,s;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),a=a||t.features[n].properties,s=t.features[n].geometry;break;case"Feature":a=a||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var u=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=u.length+o-1),Su([u[o],u[o+1]],a,e);case"Polygon":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o-1),Su([u[i][o],u[i][o+1]],a,e);case"MultiLineString":return r<0&&(r=u.length+r),o<0&&(o=u[r].length+o-1),Su([u[r][o],u[r][o+1]],a,e);case"MultiPolygon":return r<0&&(r=u.length+r),i<0&&(i=u[r].length+i),o<0&&(o=u[r][i].length-o-1),Su([u[r][i][o],u[r][i][o+1]],a,e)}throw new Error("geojson is invalid")}function jPe(t,e){if(e=e||{},!c_(e))throw new Error("options is invalid");var n=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,a=e.properties,s;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),a=a||t.features[n].properties,s=t.features[n].geometry;break;case"Feature":a=a||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var u=s.coordinates;switch(s.type){case"Point":return zo(u,a,e);case"MultiPoint":return r<0&&(r=u.length+r),zo(u[r],a,e);case"LineString":return o<0&&(o=u.length+o),zo(u[o],a,e);case"Polygon":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o),zo(u[i][o],a,e);case"MultiLineString":return r<0&&(r=u.length+r),o<0&&(o=u[r].length+o),zo(u[r][o],a,e);case"MultiPolygon":return r<0&&(r=u.length+r),i<0&&(i=u[r].length+i),o<0&&(o=u[r][i].length-o),zo(u[r][i][o],a,e)}throw new Error("geojson is invalid")}const VPe=Object.freeze(Object.defineProperty({__proto__:null,coordAll:FPe,coordEach:Jd,coordReduce:DPe,featureEach:k0,featureReduce:NPe,findPoint:jPe,findSegment:GPe,flattenEach:Vd,flattenReduce:kPe,geomEach:VE,geomReduce:hre,lineEach:dre,lineReduce:UPe,propEach:fre,propReduce:BPe,segmentEach:e6,segmentReduce:zPe},Symbol.toStringTag,{value:"Module"}));function t6(t,e,n){n===void 0&&(n={});var r=Ea(t),i=Ea(e);i[0]+=i[0]-r[0]>180?-360:r[0]-i[0]>180?360:0;var o=$Pe(r,i),a=ZO(o,"meters",n.units);return a}function $Pe(t,e,n){n=n===void 0?na:Number(n);var r=n,i=t[1]*Math.PI/180,o=e[1]*Math.PI/180,a=o-i,s=Math.abs(e[0]-t[0])*Math.PI/180;s>Math.PI&&(s-=2*Math.PI);var u=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),d=Math.abs(u)>1e-11?a/u:Math.cos(i),g=Math.sqrt(a*a+d*d*s*s),_=g*r;return _}function HPe(t,e,n){if(n===void 0&&(n={}),n.method||(n.method="geodesic"),n.units||(n.units="kilometers"),!t)throw new Error("pt is required");if(Array.isArray(t)?t=zo(t):t.type==="Point"?t=Kl(t):ek(t,"Point","point"),!e)throw new Error("line is required");Array.isArray(e)?e=Su(e):e.type==="LineString"?e=Kl(e):ek(e,"LineString","line");var r=1/0,i=t.geometry.coordinates;return e6(e,function(o){var a=o.geometry.coordinates[0],s=o.geometry.coordinates[1],u=WPe(i,a,s,n);u<r&&(r=u)}),ZO(r,"degrees",n.units)}function WPe(t,e,n,r){var i=[n[0]-e[0],n[1]-e[1]],o=[t[0]-e[0],t[1]-e[1]],a=wH(o,i);if(a<=0)return sB(t,e,{method:r.method,units:"degrees"});var s=wH(i,i);if(s<=a)return sB(t,n,{method:r.method,units:"degrees"});var u=a/s,d=[e[0]+u*i[0],e[1]+u*i[1]];return sB(t,d,{method:r.method,units:"degrees"})}function wH(t,e){return t[0]*e[0]+t[1]*e[1]}function sB(t,e,n){return n.method==="planar"?t6(t,e,n):ch(t,e,n)}const qPe=Object.freeze(Object.defineProperty({__proto__:null,default:HPe},Symbol.toStringTag,{value:"Module"})),pre=ti(qPe),QO=ti(VPe),rl=ti(lPe),n6=ti(fPe),XPe=Object.freeze(Object.defineProperty({__proto__:null,MAX_LATITUDE:Hb,WebMercatorViewport:O$,addMetersToLngLat:M5,altitudeToFovy:B0,default:O$,fitBounds:L5,flyToViewport:une,fovyToAltitude:BE,getBounds:D5,getDistanceScales:Uw,getFlyToDuration:cne,getMeterZoom:I5,getProjectionMatrix:one,getProjectionParameters:R5,getViewMatrix:O5,lngLatToWorld:El,normalizeViewportProps:sne,pixelsToWorld:Ym,scaleToZoom:P5,unitsPerMeter:aC,worldToLngLat:gc,worldToPixels:VO,zoomToScale:iI},Symbol.toStringTag,{value:"Module"})),r6=ti(XPe);Object.defineProperty(Ai,"__esModule",{value:!0});Ai.toDeckColor=iIe;Ai.recursivelyTraverseNestedArrays=Are;Ai.generatePointsParallelToLinePoints=oIe;Ai.distance2d=ik;Ai.mix=_re;Ai.nearestPointOnProjectedLine=sIe;Ai.nearestPointOnLine=aIe;Ai.getPickedEditHandle=lIe;Ai.getPickedSnapSourceEditHandle=uIe;Ai.getNonGuidePicks=cIe;Ai.getPickedExistingEditHandle=fIe;Ai.getPickedIntermediateEditHandle=hIe;Ai.getPickedEditHandles=$E;Ai.getEditHandlesForGeometry=dIe;Ai.updateRectanglePosition=pIe;Ai.mapCoords=yre;var EH=KO(YO),ZPe=KO(Kd),YPe=KO(pre),QPe=QO,nk=rl,SH=n6,gre=KO(r6);function KO(t){return t&&t.__esModule?t:{default:t}}function vy(t,e){return eIe(t)||JPe(t,e)||mre(t,e)||KPe()}function KPe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JPe(t,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var n=[],r=!0,i=!1,o=void 0;try{for(var a=t[Symbol.iterator](),s;!(r=(s=a.next()).done)&&(n.push(s.value),!(e&&n.length===e));r=!0);}catch(u){i=!0,o=u}finally{try{!r&&a.return!=null&&a.return()}finally{if(i)throw o}}return n}}function eIe(t){if(Array.isArray(t))return t}function i6(t){return rIe(t)||nIe(t)||mre(t)||tIe()}function tIe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mre(t,e){if(t){if(typeof t=="string")return rk(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rk(t,e)}}function nIe(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function rIe(t){if(Array.isArray(t))return rk(t)}function rk(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function iIe(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[255,0,0,255];return Array.isArray(t)?[t[0]*255,t[1]*255,t[2]*255,t[3]*255]:e}function Are(t,e,n){if(!Array.isArray(t[0]))return!0;for(var r=0;r<t.length;r++)if(Are(t[r],[].concat(i6(e),[r]),n)){n(t,e);break}return!1}function oIe(t,e,n){var r={type:"LineString",coordinates:[t,e]},i=(0,nk.point)(n),o=(0,YPe.default)(i,r),a=(0,ZPe.default)(t,e),s=(n[0]-t[0])*(e[1]-t[1])-(n[1]-t[1])*(e[0]-t[0]),u=s<0?a-90:a-270,d=(0,EH.default)(e,o,u),g=(0,EH.default)(t,o,u);return[d.geometry.coordinates,g.geometry.coordinates]}function ik(t,e,n,r){var i=t-n,o=e-r;return Math.sqrt(i*i+o*o)}function _re(t,e,n){return e*n+t*(1-n)}function sIe(t,e,n){var r=new gre.default(n),i=t.geometry.coordinates,o=i.map(function(be){var Ye=vy(be,3),tt=Ye[0],pt=Ye[1],Ee=Ye[2],Ne=Ee===void 0?0:Ee;return r.project([tt,pt,Ne])}),a=r.project(e.geometry.coordinates),s=vy(a,2),u=s[0],d=s[1],g=1/0,_={};o.forEach(function(be,Ye){var tt=vy(be,2),pt=tt[0],Ee=tt[1];if(Ye!==0){var Ne=vy(o[Ye-1],2),Be=Ne[0],qe=Ne[1],ct=qe-Ee,Ct=pt-Be,Dt=Be*Ee-pt*qe,In=ct*ct+Ct*Ct,Mn=Math.abs(ct*u+Ct*d+Dt)/Math.sqrt(In);Mn<g&&(g=Mn,_={index:Ye,x0:(Ct*(Ct*u-ct*d)-ct*Dt)/In,y0:(ct*(-Ct*u+ct*d)-Ct*Dt)/In})}});var E=_,P=E.index,R=E.x0,B=E.y0,V=vy(o[P-1],3),z=V[0],F=V[1],k=V[2],X=k===void 0?0:k,Y=vy(o[P],3),J=Y[0],ie=Y[1],ce=Y[2],re=ce===void 0?0:ce,ue=ik(z,F,J,ie),se=ik(z,F,R,B),me=se/ue,Ce=_re(X,re,me);return{type:"Feature",geometry:{type:"Point",coordinates:r.unproject([R,B,Ce])},properties:{dist:g,index:P-1}}}function aIe(t,e,n){var r,i,o;n&&(o=new gre.default(n));var a=(0,nk.point)([1/0,1/0],{dist:1/0});return!(!((r=t.geometry)===null||r===void 0)&&r.coordinates.length)||((i=t.geometry)===null||i===void 0?void 0:i.coordinates.length)<2||(0,QPe.flattenEach)(t,function(s){var u=(0,SH.getCoords)(s),d=(0,SH.getCoords)(e),g,_,E,P,R,B,V;if(u.length>1&&d.length){var z,F;o?(z=u.map(function(Ye){return o.project(Ye)}),F=o.project(d)):(z=u,F=d);for(var k=1;k<z.length;k++){if(z[k][0]!==z[k-1][0]){var X=(z[k][1]-z[k-1][1])/(z[k][0]-z[k-1][0]),Y=z[k][1]-X*z[k][0];V=Math.abs(X*F[0]+Y-F[1])/Math.sqrt(X*X+1)}else V=Math.abs(F[0]-z[k][0]);var J=Math.pow(z[k][1]-z[k-1][1],2)+Math.pow(z[k][0]-z[k-1][0],2),ie=Math.pow(z[k][1]-F[1],2)+Math.pow(z[k][0]-F[0],2),ce=Math.pow(z[k-1][1]-F[1],2)+Math.pow(z[k-1][0]-F[0],2),re=Math.pow(V,2),ue=ie-re+ce-re;ue>J&&(V=Math.sqrt(Math.min(ie,ce))),(g==null||g>V)&&(ue>J?ce<ie?(_=0,E=1):(E=0,_=1):(_=Math.sqrt(ce-re)/Math.sqrt(J),E=Math.sqrt(ie-re)/Math.sqrt(J)),g=V,B=k)}var se=z[B-1][0]-z[B][0],me=z[B-1][1]-z[B][1];P=z[B-1][0]-se*_,R=z[B-1][1]-me*_}var Ce={x:P,y:R,idx:B-1,to:_,from:E};if(o){var be=o.unproject([Ce.x,Ce.y]);Ce={x:be[0],y:be[1],idx:B-1,to:_,from:E}}a=(0,nk.point)([Ce.x,Ce.y],{dist:Math.abs(Ce.from-Ce.to),index:Ce.idx})}),a}function lIe(t){var e=$E(t);return e.length?e[0]:null}function uIe(t){var e=$E(t);return e.find(function(n){return n.properties.editHandleType==="snap-source"})}function cIe(t){return t&&t.filter(function(e){return!e.isGuide})}function fIe(t){var e=$E(t);return e.find(function(n){var r=n.properties;return r.featureIndex>=0&&r.editHandleType==="existing"})}function hIe(t){var e=$E(t);return e.find(function(n){var r=n.properties;return r.featureIndex>=0&&r.editHandleType==="intermediate"})}function $E(t){var e=t&&t.filter(function(n){return n.isGuide&&n.object.properties.guideType==="editHandle"}).map(function(n){return n.object})||[];return e}function dIe(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"existing",r=[];switch(t.type){case"Point":r=[{type:"Feature",properties:{guideType:"editHandle",editHandleType:n,positionIndexes:[],featureIndex:e},geometry:{type:"Point",coordinates:t.coordinates}}];break;case"MultiPoint":case"LineString":r=r.concat(aB(t.coordinates,[],e,n));break;case"Polygon":case"MultiLineString":for(var i=0;i<t.coordinates.length;i++)r=r.concat(aB(t.coordinates[i],[i],e,n)),t.type==="Polygon"&&(r=r.slice(0,-1));break;case"MultiPolygon":for(var o=0;o<t.coordinates.length;o++)for(var a=0;a<t.coordinates[o].length;a++)r=r.concat(aB(t.coordinates[o][a],[o,a],e,n)),r=r.slice(0,-1);break;default:throw Error("Unhandled geometry type: ".concat(t.type))}return r}function aB(t,e,n){for(var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"existing",i=[],o=0;o<t.length;o++){var a=t[o];i.push({type:"Feature",properties:{guideType:"editHandle",positionIndexes:[].concat(i6(e),[o]),featureIndex:n,editHandleType:r},geometry:{type:"Point",coordinates:a}})}return i}function pIe(t,e,n){var r=t.geometry.coordinates;if(!r)return null;var i=r[0].slice(0,4);i[e%4]=n;var o=i[(e+2)%4],a=i[e%4];return i[(e+1)%4]=[a[0],o[1]],i[(e+3)%4]=[o[0],a[1]],[[].concat(i6(i),[i[0]])]}function yre(t,e){return typeof t[0]=="number"?!isNaN(t[0])&&isFinite(t[0])?e(t):t:t.map(function(n){return yre(n,e)}).filter(Boolean)}var Rc={};Object.defineProperty(Rc,"__esModule",{value:!0});Rc.ImmutableFeatureCollection=void 0;function Za(t){return _Ie(t)||AIe(t)||mIe(t)||gIe()}function gIe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mIe(t,e){if(t){if(typeof t=="string")return ok(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ok(t,e)}}function AIe(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function _Ie(t){if(Array.isArray(t))return ok(t)}function ok(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function TH(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function l0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?TH(Object(n),!0).forEach(function(r){vre(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):TH(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function yIe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function CH(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vIe(t,e,n){return e&&CH(t.prototype,e),n&&CH(t,n),t}function vre(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var xIe=function(){function t(e){yIe(this,t),vre(this,"featureCollection",void 0),this.featureCollection=e}return vIe(t,[{key:"getObject",value:function(){return this.featureCollection}},{key:"replacePosition",value:function(n,r,i){var o=this.featureCollection.features[n].geometry,a=o.type==="Polygon"||o.type==="MultiPolygon",s=l0({},o,{coordinates:xre(o.coordinates,r,i,a)});return this.replaceGeometry(n,s)}},{key:"removePosition",value:function(n,r){var i=this.featureCollection.features[n].geometry;if(i.type==="Point")throw Error("Can't remove a position from a Point or there'd be nothing left");if(i.type==="MultiPoint"&&i.coordinates.length<2)throw Error("Can't remove the last point of a MultiPoint or there'd be nothing left");if(i.type==="LineString"&&i.coordinates.length<3)throw Error("Can't remove position. LineString must have at least two positions");if(i.type==="Polygon"&&i.coordinates[0].length<5&&Array.isArray(r)&&r[0]===0)throw Error("Can't remove position. Polygon's outer ring must have at least four positions");if(i.type==="MultiLineString"&&i.coordinates.length===1&&i.coordinates[0].length<3)throw Error("Can't remove position. MultiLineString must have at least two positions");if(i.type==="MultiPolygon"&&i.coordinates.length===1&&i.coordinates[0][0].length<5&&Array.isArray(r)&&r[0]===0&&r[1]===0)throw Error("Can't remove position. MultiPolygon's outer ring must have at least four positions");var o=i.type==="Polygon"||i.type==="MultiPolygon",a=l0({},i,{coordinates:bre(i.coordinates,r,o)});return bIe(a),this.replaceGeometry(n,a)}},{key:"addPosition",value:function(n,r,i){var o=this.featureCollection.features[n].geometry;if(o.type==="Point")throw new Error("Unable to add a position to a Point feature");o.type==="Polygon"||o.type;var a=l0({},o,{coordinates:wre(o.coordinates,r,i)});return this.replaceGeometry(n,a)}},{key:"replaceGeometry",value:function(n,r){var i=l0({},this.featureCollection.features[n],{geometry:r}),o=l0({},this.featureCollection,{features:[].concat(Za(this.featureCollection.features.slice(0,n)),[i],Za(this.featureCollection.features.slice(n+1)))});return new t(o)}},{key:"addFeature",value:function(n){return this.addFeatures([n])}},{key:"addFeatures",value:function(n){var r=l0({},this.featureCollection,{features:[].concat(Za(this.featureCollection.features),Za(n))});return new t(r)}},{key:"deleteFeature",value:function(n){return this.deleteFeatures([n])}},{key:"deleteFeatures",value:function(n){var r=Za(this.featureCollection.features);n.sort();for(var i=n.length-1;i>=0;i--){var o=n[i];o>=0&&o<r.length&&r.splice(o,1)}var a=l0({},this.featureCollection,{features:r});return new t(a)}}]),t}();Rc.ImmutableFeatureCollection=xIe;function FS(t,e){if(t.length===2&&e.length===3){var n=e[2];return[t[0],t[1],n]}return t}function xre(t,e,n,r){if(!e)return t;if(e.length===0)return FS(n,t);if(e.length===1){var i=[].concat(Za(t.slice(0,e[0])),[FS(n,t[e[0]])],Za(t.slice(e[0]+1)));return r&&(e[0]===0||e[0]===t.length-1)&&(i[0]=FS(n,t[0]),i[t.length-1]=FS(n,t[0])),i}return[].concat(Za(t.slice(0,e[0])),[xre(t[e[0]],e.slice(1,e.length),n,r)],Za(t.slice(e[0]+1)))}function bre(t,e,n){if(!e)return t;if(e.length===0)throw Error("Must specify the index of the position to remove");if(e.length===1){var r=[].concat(Za(t.slice(0,e[0])),Za(t.slice(e[0]+1)));return n&&(e[0]===0||e[0]===t.length-1)&&(e[0]===0?r[r.length-1]=r[0]:e[0]===t.length-1&&(r[0]=r[r.length-1])),r}return[].concat(Za(t.slice(0,e[0])),[bre(t[e[0]],e.slice(1,e.length),n)],Za(t.slice(e[0]+1)))}function wre(t,e,n,r){if(!e)return t;if(e.length===0)throw Error("Must specify the index of the position to remove");if(e.length===1){var i=[].concat(Za(t.slice(0,e[0])),[n],Za(t.slice(e[0])));return i}return[].concat(Za(t.slice(0,e[0])),[wre(t[e[0]],e.slice(1,e.length),n)],Za(t.slice(e[0]+1)))}function bIe(t){switch(t.type){case"Polygon":wIe(t);break;case"MultiLineString":EIe(t);break;case"MultiPolygon":SIe(t);break}}function wIe(t){for(var e=t.coordinates,n=1;n<e.length;n++)Ere(e,n)&&n--}function EIe(t){for(var e=0;e<t.coordinates.length;e++){var n=t.coordinates[e];n.length===1&&(t.coordinates.splice(e,1),e--)}}function SIe(t){for(var e=0;e<t.coordinates.length;e++){var n=t.coordinates[e],r=n[0];r.length<=3&&(t.coordinates.splice(e,1),e--);for(var i=1;i<n.length;i++)Ere(n,i)&&i--}}function Ere(t,e){var n=t[e];return n.length<=3?(t.splice(e,1),!0):!1}Object.defineProperty(So,"__esModule",{value:!0});So.getIntermediatePosition=UIe;So.GeoJsonEditMode=void 0;var TIe=JO(pPe),CIe=JO(K5),PIe=JO(yPe),IIe=JO(IPe),PH=Ai,lB=Rc;function JO(t){return t&&t.__esModule?t:{default:t}}function MIe(t){if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(t=Sre(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,i=!0,o=!1,a;return{s:function(){r=t[Symbol.iterator]()},n:function(){var u=r.next();return i=u.done,u},e:function(u){o=!0,a=u},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw a}}}}function IH(t){return LIe(t)||RIe(t)||Sre(t)||OIe()}function OIe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Sre(t,e){if(t){if(typeof t=="string")return sk(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sk(t,e)}}function RIe(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function LIe(t){if(Array.isArray(t))return sk(t)}function sk(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function DIe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function MH(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function BIe(t,e,n){return e&&MH(t.prototype,e),n&&MH(t,n),t}function NIe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var FIe={type:"FeatureCollection",features:[]},kIe=[],zIe=function(){function t(){DIe(this,t),NIe(this,"_clickSequence",[])}return BIe(t,[{key:"getGuides",value:function(n){return FIe}},{key:"getTooltips",value:function(n){return kIe}},{key:"getSelectedFeature",value:function(n){return n.selectedIndexes.length===1?n.data.features[n.selectedIndexes[0]]:null}},{key:"getSelectedGeometry",value:function(n){var r=this.getSelectedFeature(n);return r?r.geometry:null}},{key:"getSelectedFeaturesAsFeatureCollection",value:function(n){var r=n.data.features,i=n.selectedIndexes.map(function(o){return r[o]});return{type:"FeatureCollection",features:i}}},{key:"getClickSequence",value:function(){return this._clickSequence}},{key:"addClickSequence",value:function(n){var r=n.mapCoords;this._clickSequence.push(r)}},{key:"resetClickSequence",value:function(){this._clickSequence=[]}},{key:"getTentativeGuide",value:function(n){var r=this.getGuides(n);return r.features.find(function(i){return i.properties&&i.properties.guideType==="tentative"})}},{key:"isSelectionPicked",value:function(n,r){if(!n.length)return!1;var i=(0,PH.getNonGuidePicks)(n).map(function(s){var u=s.index;return u}),o=(0,PH.getPickedEditHandles)(n).map(function(s){var u=s.properties;return u.featureIndex}),a=new Set([].concat(IH(i),IH(o)));return r.selectedIndexes.some(function(s){return a.has(s)})}},{key:"rewindPolygon",value:function(n){var r=n.geometry,i=r.type==="Polygon"||r.type==="MultiPolygon";return i?(0,IIe.default)(n):n}},{key:"getAddFeatureAction",value:function(n,r){var i=n,o=i.type==="Feature"?i:{type:"Feature",properties:{},geometry:i},a=this.rewindPolygon(o),s=new lB.ImmutableFeatureCollection(r).addFeature(a).getObject();return{updatedData:s,editType:"addFeature",editContext:{featureIndexes:[s.features.length-1]}}}},{key:"getAddManyFeaturesAction",value:function(n,r){var i=n.features,o=new lB.ImmutableFeatureCollection(r),a=o.getObject().features.length,s=[],u=MIe(i),d;try{for(u.s();!(d=u.n()).done;){var g=d.value,_=g.properties,E=g.geometry,P=E;o=o.addFeature({type:"Feature",properties:_,geometry:P}),s.push(a+s.length)}}catch(R){u.e(R)}finally{u.f()}return{updatedData:o.getObject(),editType:"addFeature",editContext:{featureIndexes:s}}}},{key:"getAddFeatureOrBooleanPolygonAction",value:function(n,r){var i=n,o=this.getSelectedFeature(r),a=r.modeConfig;if(a&&a.booleanOperation){if(!o||o.geometry.type!=="Polygon"&&o.geometry.type!=="MultiPolygon")return console.warn("booleanOperation only supported for single Polygon or MultiPolygon selection"),null;var s=i.type==="Feature"?i:{type:"Feature",geometry:i},u;if(a.booleanOperation==="union")u=(0,TIe.default)(o,s);else if(a.booleanOperation==="difference")u=(0,CIe.default)(o,s);else if(a.booleanOperation==="intersection")u=(0,PIe.default)(o,s);else return console.warn("Invalid booleanOperation ".concat(a.booleanOperation)),null;if(!u)return console.warn("Canceling edit. Boolean operation erased entire polygon."),null;var d=r.selectedIndexes[0],g=new lB.ImmutableFeatureCollection(r.data).replaceGeometry(d,u.geometry).getObject(),_={updatedData:g,editType:"unionGeometry",editContext:{featureIndexes:[d]}};return _}return this.getAddFeatureAction(n,r.data)}},{key:"createTentativeFeature",value:function(n){return null}},{key:"handleClick",value:function(n,r){}},{key:"handlePointerMove",value:function(n,r){var i=this.createTentativeFeature(r);i&&r.onEdit({updatedData:r.data,editType:"updateTentativeFeature",editContext:{feature:i}})}},{key:"handleStartDragging",value:function(n,r){}},{key:"handleStopDragging",value:function(n,r){}},{key:"handleDragging",value:function(n,r){}},{key:"handleKeyUp",value:function(n,r){n.key==="Escape"&&(this.resetClickSequence(),r.onEdit({updatedData:r.data,editType:"cancelFeature",editContext:{}}))}}]),t}();So.GeoJsonEditMode=zIe;function UIe(t,e){var n=[(t[0]+e[0])/2,(t[1]+e[1])/2];return n}var B1={};Object.defineProperty(B1,"__esModule",{value:!0});B1.ModifyMode=void 0;var OH=rl,Qc=Ai,GIe=So,db=Rc;function dC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?dC=function(n){return typeof n}:dC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},dC(t)}function RH(t){return $Ie(t)||VIe(t)||Tre(t)||jIe()}function jIe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VIe(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function $Ie(t){if(Array.isArray(t))return ak(t)}function HIe(t){if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(t=Tre(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,i=!0,o=!1,a;return{s:function(){r=t[Symbol.iterator]()},n:function(){var u=r.next();return i=u.done,u},e:function(u){o=!0,a=u},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw a}}}}function Tre(t,e){if(t){if(typeof t=="string")return ak(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ak(t,e)}}function ak(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function WIe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function LH(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function qIe(t,e,n){return e&&LH(t.prototype,e),n&&LH(t,n),t}function XIe(t){return function(){var e=pI(t),n;if(QIe()){var r=pI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return ZIe(this,n)}}function ZIe(t,e){return e&&(dC(e)==="object"||typeof e=="function")?e:YIe(t)}function YIe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function QIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function pI(t){return pI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},pI(t)}function KIe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lk(t,e)}function lk(t,e){return lk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},lk(t,e)}var JIe=function(t){KIe(n,t);var e=XIe(n);function n(){return WIe(this,n),e.apply(this,arguments)}return qIe(n,[{key:"getGuides",value:function(i){var o=this,a=[],s=i.data,u=i.lastPointerMoveEvent,d=s.features,g=u&&u.picks,_=u&&u.mapCoords,E=HIe(i.selectedIndexes),P;try{for(E.s();!(P=E.n()).done;){var R=P.value;if(R<d.length){var B=d[R].geometry;a.push.apply(a,RH((0,Qc.getEditHandlesForGeometry)(B,R)))}else console.warn("selectedFeatureIndexes out of range ".concat(R))}}catch(re){E.e(re)}finally{E.f()}if(g&&g.length&&_){var V,z=(0,Qc.getPickedExistingEditHandle)(g),F=!z&&g.find(function(re){return!re.isGuide});if(F&&!F.object.geometry.type.includes("Point")&&!(!((V=i.modeConfig)===null||V===void 0)&&V.lockRectangles&&F.object.properties.shape==="Rectangle")&&i.selectedIndexes.includes(F.index)){var k=null,X=[],Y=(0,OH.point)(_);if((0,Qc.recursivelyTraverseNestedArrays)(F.object.geometry.coordinates,[],function(re,ue){var se=(0,OH.lineString)(re),me=o.getNearestPoint(se,Y,i.modeConfig&&i.modeConfig.viewport);(!k||me.properties.dist<k.properties.dist)&&(k=me,X=ue)}),k){var J=k,ie=J.geometry.coordinates,ce=J.properties.index;a.push({type:"Feature",properties:{guideType:"editHandle",editHandleType:"intermediate",featureIndex:F.index,positionIndexes:[].concat(RH(X),[ce+1])},geometry:{type:"Point",coordinates:ie}})}}}return{type:"FeatureCollection",features:a}}},{key:"getNearestPoint",value:function(i,o,a){var s=i.geometry.coordinates;if(s.some(function(u){return u.length>2})){if(a)return(0,Qc.nearestPointOnProjectedLine)(i,o,a);console.log("Editing 3D point but modeConfig.viewport not provided. Falling back to 2D logic.")}return(0,Qc.nearestPointOnLine)(i,o,a)}},{key:"handleClick",value:function(i,o){var a=(0,Qc.getPickedExistingEditHandle)(i.picks),s=(0,Qc.getPickedIntermediateEditHandle)(i.picks);if(a){var u=a.properties,d=u.featureIndex,g=u.positionIndexes,_;try{_=new db.ImmutableFeatureCollection(o.data).removePosition(d,g).getObject()}catch{}_&&o.onEdit({updatedData:_,editType:"removePosition",editContext:{featureIndexes:[d],positionIndexes:g,position:a.geometry.coordinates}})}else if(s){var E,P=s.properties,R=P.featureIndex,B=P.positionIndexes,V=o.data.features[R],z=!(!((E=o.modeConfig)===null||E===void 0)&&E.lockRectangles&&(V==null?void 0:V.properties.shape)==="Rectangle");if(z){var F=new db.ImmutableFeatureCollection(o.data).addPosition(R,B,s.geometry.coordinates).getObject();F&&o.onEdit({updatedData:F,editType:"addPosition",editContext:{featureIndexes:[R],positionIndexes:B,position:s.geometry.coordinates}})}}}},{key:"handleDragging",value:function(i,o){var a=(0,Qc.getPickedEditHandle)(i.pointerDownPicks);a&&(i.cancelPan(),this._dragEditHandle("movePosition",o,a,i))}},{key:"_dragEditHandle",value:function(i,o,a,s){var u,d=a.properties,g=o.data.features[d.featureIndex],_;if(!((u=o.modeConfig)===null||u===void 0)&&u.lockRectangles&&g.properties.shape==="Rectangle"){var E=(0,Qc.updateRectanglePosition)(g,d.positionIndexes[1],s.mapCoords);_=new db.ImmutableFeatureCollection(o.data).replaceGeometry(d.featureIndex,{coordinates:E,type:"Polygon"}).getObject()}else _=new db.ImmutableFeatureCollection(o.data).replacePosition(d.featureIndex,d.positionIndexes,s.mapCoords).getObject();o.onEdit({updatedData:_,editType:i,editContext:{featureIndexes:[d.featureIndex],positionIndexes:d.positionIndexes,position:s.mapCoords}})}},{key:"handlePointerMove",value:function(i,o){var a=this.getCursor(i);o.onUpdateCursor(a)}},{key:"handleStartDragging",value:function(i,o){var a=o.selectedIndexes,s=(0,Qc.getPickedIntermediateEditHandle)(i.picks);if(a.length&&s){var u=s.properties,d=new db.ImmutableFeatureCollection(o.data).addPosition(u.featureIndex,u.positionIndexes,i.mapCoords).getObject();o.onEdit({updatedData:d,editType:"addPosition",editContext:{featureIndexes:[u.featureIndex],positionIndexes:u.positionIndexes,position:i.mapCoords}})}}},{key:"handleStopDragging",value:function(i,o){var a=o.selectedIndexes,s=(0,Qc.getPickedEditHandle)(i.picks);a.length&&s&&this._dragEditHandle("finishMovePosition",o,s,i)}},{key:"getCursor",value:function(i){var o=i&&i.picks||[],a=(0,Qc.getPickedEditHandles)(o);return a.length?"cell":null}}]),n}(GIe.GeoJsonEditMode);B1.ModifyMode=JIe;var eR={};function DH(t){if(!t)throw new Error("geojson is required");var e=[];return Vd(t,function(n){eMe(n,e)}),vf(e)}function eMe(t,e){var n=[],r=t.geometry;if(r!==null){switch(r.type){case"Polygon":n=jd(r);break;case"LineString":n=[jd(r)]}n.forEach(function(i){var o=tMe(i,t.properties);o.forEach(function(a){a.id=e.length,e.push(a)})})}}function tMe(t,e){var n=[];return t.reduce(function(r,i){var o=Su([r,i],e);return o.bbox=nMe(r,i),n.push(o),i}),n}function nMe(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=n<i?n:i,s=r<o?r:o,u=n>i?n:i,d=r>o?r:o;return[a,s,u,d]}var o6={exports:{}},Cre={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Ya,function(){function n(F,k,X,Y,J){(function ie(ce,re,ue,se,me){for(;se>ue;){if(se-ue>600){var Ce=se-ue+1,be=re-ue+1,Ye=Math.log(Ce),tt=.5*Math.exp(2*Ye/3),pt=.5*Math.sqrt(Ye*tt*(Ce-tt)/Ce)*(be-Ce/2<0?-1:1),Ee=Math.max(ue,Math.floor(re-be*tt/Ce+pt)),Ne=Math.min(se,Math.floor(re+(Ce-be)*tt/Ce+pt));ie(ce,re,Ee,Ne,me)}var Be=ce[re],qe=ue,ct=se;for(r(ce,ue,re),me(ce[se],Be)>0&&r(ce,ue,se);qe<ct;){for(r(ce,qe,ct),qe++,ct--;me(ce[qe],Be)<0;)qe++;for(;me(ce[ct],Be)>0;)ct--}me(ce[ue],Be)===0?r(ce,ue,ct):r(ce,++ct,se),ct<=re&&(ue=ct+1),re<=ct&&(se=ct-1)}})(F,k,X||0,Y||F.length-1,J||i)}function r(F,k,X){var Y=F[k];F[k]=F[X],F[X]=Y}function i(F,k){return F<k?-1:F>k?1:0}var o=function(F){F===void 0&&(F=9),this._maxEntries=Math.max(4,F),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(F,k,X){if(!X)return k.indexOf(F);for(var Y=0;Y<k.length;Y++)if(X(F,k[Y]))return Y;return-1}function s(F,k){u(F,0,F.children.length,k,F)}function u(F,k,X,Y,J){J||(J=V(null)),J.minX=1/0,J.minY=1/0,J.maxX=-1/0,J.maxY=-1/0;for(var ie=k;ie<X;ie++){var ce=F.children[ie];d(J,F.leaf?Y(ce):ce)}return J}function d(F,k){return F.minX=Math.min(F.minX,k.minX),F.minY=Math.min(F.minY,k.minY),F.maxX=Math.max(F.maxX,k.maxX),F.maxY=Math.max(F.maxY,k.maxY),F}function g(F,k){return F.minX-k.minX}function _(F,k){return F.minY-k.minY}function E(F){return(F.maxX-F.minX)*(F.maxY-F.minY)}function P(F){return F.maxX-F.minX+(F.maxY-F.minY)}function R(F,k){return F.minX<=k.minX&&F.minY<=k.minY&&k.maxX<=F.maxX&&k.maxY<=F.maxY}function B(F,k){return k.minX<=F.maxX&&k.minY<=F.maxY&&k.maxX>=F.minX&&k.maxY>=F.minY}function V(F){return{children:F,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function z(F,k,X,Y,J){for(var ie=[k,X];ie.length;)if(!((X=ie.pop())-(k=ie.pop())<=Y)){var ce=k+Math.ceil((X-k)/Y/2)*Y;n(F,ce,k,X,J),ie.push(k,ce,ce,X)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(F){var k=this.data,X=[];if(!B(F,k))return X;for(var Y=this.toBBox,J=[];k;){for(var ie=0;ie<k.children.length;ie++){var ce=k.children[ie],re=k.leaf?Y(ce):ce;B(F,re)&&(k.leaf?X.push(ce):R(F,re)?this._all(ce,X):J.push(ce))}k=J.pop()}return X},o.prototype.collides=function(F){var k=this.data;if(!B(F,k))return!1;for(var X=[];k;){for(var Y=0;Y<k.children.length;Y++){var J=k.children[Y],ie=k.leaf?this.toBBox(J):J;if(B(F,ie)){if(k.leaf||R(F,ie))return!0;X.push(J)}}k=X.pop()}return!1},o.prototype.load=function(F){if(!F||!F.length)return this;if(F.length<this._minEntries){for(var k=0;k<F.length;k++)this.insert(F[k]);return this}var X=this._build(F.slice(),0,F.length-1,0);if(this.data.children.length)if(this.data.height===X.height)this._splitRoot(this.data,X);else{if(this.data.height<X.height){var Y=this.data;this.data=X,X=Y}this._insert(X,this.data.height-X.height-1,!0)}else this.data=X;return this},o.prototype.insert=function(F){return F&&this._insert(F,this.data.height-1),this},o.prototype.clear=function(){return this.data=V([]),this},o.prototype.remove=function(F,k){if(!F)return this;for(var X,Y,J,ie=this.data,ce=this.toBBox(F),re=[],ue=[];ie||re.length;){if(ie||(ie=re.pop(),Y=re[re.length-1],X=ue.pop(),J=!0),ie.leaf){var se=a(F,ie.children,k);if(se!==-1)return ie.children.splice(se,1),re.push(ie),this._condense(re),this}J||ie.leaf||!R(ie,ce)?Y?(X++,ie=Y.children[X],J=!1):ie=null:(re.push(ie),ue.push(X),X=0,Y=ie,ie=ie.children[0])}return this},o.prototype.toBBox=function(F){return F},o.prototype.compareMinX=function(F,k){return F.minX-k.minX},o.prototype.compareMinY=function(F,k){return F.minY-k.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(F){return this.data=F,this},o.prototype._all=function(F,k){for(var X=[];F;)F.leaf?k.push.apply(k,F.children):X.push.apply(X,F.children),F=X.pop();return k},o.prototype._build=function(F,k,X,Y){var J,ie=X-k+1,ce=this._maxEntries;if(ie<=ce)return s(J=V(F.slice(k,X+1)),this.toBBox),J;Y||(Y=Math.ceil(Math.log(ie)/Math.log(ce)),ce=Math.ceil(ie/Math.pow(ce,Y-1))),(J=V([])).leaf=!1,J.height=Y;var re=Math.ceil(ie/ce),ue=re*Math.ceil(Math.sqrt(ce));z(F,k,X,ue,this.compareMinX);for(var se=k;se<=X;se+=ue){var me=Math.min(se+ue-1,X);z(F,se,me,re,this.compareMinY);for(var Ce=se;Ce<=me;Ce+=re){var be=Math.min(Ce+re-1,me);J.children.push(this._build(F,Ce,be,Y-1))}}return s(J,this.toBBox),J},o.prototype._chooseSubtree=function(F,k,X,Y){for(;Y.push(k),!k.leaf&&Y.length-1!==X;){for(var J=1/0,ie=1/0,ce=void 0,re=0;re<k.children.length;re++){var ue=k.children[re],se=E(ue),me=(Ce=F,be=ue,(Math.max(be.maxX,Ce.maxX)-Math.min(be.minX,Ce.minX))*(Math.max(be.maxY,Ce.maxY)-Math.min(be.minY,Ce.minY))-se);me<ie?(ie=me,J=se<J?se:J,ce=ue):me===ie&&se<J&&(J=se,ce=ue)}k=ce||k.children[0]}var Ce,be;return k},o.prototype._insert=function(F,k,X){var Y=X?F:this.toBBox(F),J=[],ie=this._chooseSubtree(Y,this.data,k,J);for(ie.children.push(F),d(ie,Y);k>=0&&J[k].children.length>this._maxEntries;)this._split(J,k),k--;this._adjustParentBBoxes(Y,J,k)},o.prototype._split=function(F,k){var X=F[k],Y=X.children.length,J=this._minEntries;this._chooseSplitAxis(X,J,Y);var ie=this._chooseSplitIndex(X,J,Y),ce=V(X.children.splice(ie,X.children.length-ie));ce.height=X.height,ce.leaf=X.leaf,s(X,this.toBBox),s(ce,this.toBBox),k?F[k-1].children.push(ce):this._splitRoot(X,ce)},o.prototype._splitRoot=function(F,k){this.data=V([F,k]),this.data.height=F.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(F,k,X){for(var Y,J,ie,ce,re,ue,se,me=1/0,Ce=1/0,be=k;be<=X-k;be++){var Ye=u(F,0,be,this.toBBox),tt=u(F,be,X,this.toBBox),pt=(J=Ye,ie=tt,ce=void 0,re=void 0,ue=void 0,se=void 0,ce=Math.max(J.minX,ie.minX),re=Math.max(J.minY,ie.minY),ue=Math.min(J.maxX,ie.maxX),se=Math.min(J.maxY,ie.maxY),Math.max(0,ue-ce)*Math.max(0,se-re)),Ee=E(Ye)+E(tt);pt<me?(me=pt,Y=be,Ce=Ee<Ce?Ee:Ce):pt===me&&Ee<Ce&&(Ce=Ee,Y=be)}return Y||X-k},o.prototype._chooseSplitAxis=function(F,k,X){var Y=F.leaf?this.compareMinX:g,J=F.leaf?this.compareMinY:_;this._allDistMargin(F,k,X,Y)<this._allDistMargin(F,k,X,J)&&F.children.sort(Y)},o.prototype._allDistMargin=function(F,k,X,Y){F.children.sort(Y);for(var J=this.toBBox,ie=u(F,0,k,J),ce=u(F,X-k,X,J),re=P(ie)+P(ce),ue=k;ue<X-k;ue++){var se=F.children[ue];d(ie,F.leaf?J(se):se),re+=P(ie)}for(var me=X-k-1;me>=k;me--){var Ce=F.children[me];d(ce,F.leaf?J(Ce):Ce),re+=P(ce)}return re},o.prototype._adjustParentBBoxes=function(F,k,X){for(var Y=X;Y>=0;Y--)d(k[Y],F)},o.prototype._condense=function(F){for(var k=F.length-1,X=void 0;k>=0;k--)F[k].children.length===0?k>0?(X=F[k-1].children).splice(X.indexOf(F[k]),1):this.clear():s(F[k],this.toBBox)},o})})(Cre);var rMe=Cre.exports;function z0(t){var e=[1/0,1/0,-1/0,-1/0];return Jd(t,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}z0.default=z0;const iMe=Object.freeze(Object.defineProperty({__proto__:null,default:z0},Symbol.toStringTag,{value:"Module"})),s6=ti(iMe);var gd=rMe,Pre=rl,Ire=QO,xy=s6.default,oMe=Ire.featureEach;Ire.coordEach;Pre.polygon;var BH=Pre.featureCollection;function Mre(t){var e=new gd(t);return e.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:xy(n),gd.prototype.insert.call(this,n)},e.load=function(n){var r=[];return Array.isArray(n)?n.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:xy(i),r.push(i)}):oMe(n,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:xy(i),r.push(i)}),gd.prototype.load.call(this,r)},e.remove=function(n,r){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:xy(n),gd.prototype.remove.call(this,n,r)},e.clear=function(){return gd.prototype.clear.call(this)},e.search=function(n){var r=gd.prototype.search.call(this,this.toBBox(n));return BH(r)},e.collides=function(n){return gd.prototype.collides.call(this,this.toBBox(n))},e.all=function(){var n=gd.prototype.all.call(this);return BH(n)},e.toJSON=function(){return gd.prototype.toJSON.call(this)},e.fromJSON=function(n){return gd.prototype.fromJSON.call(this,n)},e.toBBox=function(n){var r;if(n.bbox)r=n.bbox;else if(Array.isArray(n)&&n.length===4)r=n;else if(Array.isArray(n)&&n.length===6)r=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")r=xy(n);else if(n.type==="FeatureCollection")r=xy(n);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},e}o6.exports=Mre;o6.exports.default=Mre;var sMe=o6.exports;const aMe=mA(sMe);function HE(t,e){var n={},r=[];if(t.type==="LineString"&&(t=Kl(t)),e.type==="LineString"&&(e=Kl(e)),t.type==="Feature"&&e.type==="Feature"&&t.geometry!==null&&e.geometry!==null&&t.geometry.type==="LineString"&&e.geometry.type==="LineString"&&t.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=NH(t,e);return i&&r.push(i),vf(r)}var o=aMe();return o.load(DH(e)),k0(DH(t),function(a){k0(o.search(a),function(s){var u=NH(a,s);if(u){var d=jd(u).join(",");n[d]||(n[d]=!0,r.push(u))}})}),vf(r)}function NH(t,e){var n=jd(t),r=jd(e);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=n[0][0],o=n[0][1],a=n[1][0],s=n[1][1],u=r[0][0],d=r[0][1],g=r[1][0],_=r[1][1],E=(_-d)*(a-i)-(g-u)*(s-o),P=(g-u)*(o-d)-(_-d)*(i-u),R=(a-i)*(o-d)-(s-o)*(i-u);if(E===0)return null;var B=P/E,V=R/E;if(B>=0&&B<=1&&V>=0&&V<=1){var z=i+B*(a-i),F=o+B*(s-o);return zo([z,F])}return null}const lMe=Object.freeze(Object.defineProperty({__proto__:null,default:HE},Symbol.toStringTag,{value:"Module"}));function uMe(t,e,n){n===void 0&&(n={});var r=zo([1/0,1/0],{dist:1/0}),i=0;return Vd(t,function(o){for(var a=jd(o),s=0;s<a.length-1;s++){var u=zo(a[s]);u.properties.dist=ch(e,u,n);var d=zo(a[s+1]);d.properties.dist=ch(e,d,n);var g=ch(u,d,n),_=Math.max(u.properties.dist,d.properties.dist),E=jE(u,d),P=Gv(e,_,E+90,n),R=Gv(e,_,E-90,n),B=HE(Su([P.geometry.coordinates,R.geometry.coordinates]),Su([u.geometry.coordinates,d.geometry.coordinates])),V=null;B.features.length>0&&(V=B.features[0],V.properties.dist=ch(e,V,n),V.properties.location=i+ch(u,V,n)),u.properties.dist<r.properties.dist&&(r=u,r.properties.index=s,r.properties.location=i),d.properties.dist<r.properties.dist&&(r=d,r.properties.index=s+1,r.properties.location=i+g),V&&V.properties.dist<r.properties.dist&&(r=V,r.properties.index=s),i+=g}}),r}const cMe=Object.freeze(Object.defineProperty({__proto__:null,default:uMe},Symbol.toStringTag,{value:"Module"})),Ore=ti(cMe);function fMe(t,e,n){n===void 0&&(n={});for(var r=n.steps||64,i=n.properties?n.properties:!Array.isArray(t)&&t.type==="Feature"&&t.properties?t.properties:{},o=[],a=0;a<r;a++)o.push(Gv(t,e,a*-360/r,n).geometry.coordinates);return o.push(o[0]),Th([o],i)}const hMe=Object.freeze(Object.defineProperty({__proto__:null,default:fMe},Symbol.toStringTag,{value:"Module"})),a6=ti(hMe),Lc=ti(LPe);function tR(t,e){e===void 0&&(e={});var n=z0(t),r=(n[0]+n[2])/2,i=(n[1]+n[3])/2;return zo([r,i],e.properties,e)}const dMe=Object.freeze(Object.defineProperty({__proto__:null,default:tR},Symbol.toStringTag,{value:"Module"})),Rre=ti(dMe);Object.defineProperty(eR,"__esModule",{value:!0});eR.ResizeCircleMode=void 0;var pMe=nR(Ore),FH=rl,gMe=nR(a6),mMe=nR(Lc),AMe=nR(Rre),pb=Ai,_Me=So,yMe=Rc;function nR(t){return t&&t.__esModule?t:{default:t}}function pC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pC=function(n){return typeof n}:pC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},pC(t)}function vMe(t){return EMe(t)||wMe(t)||bMe(t)||xMe()}function xMe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bMe(t,e){if(t){if(typeof t=="string")return uk(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return uk(t,e)}}function wMe(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function EMe(t){if(Array.isArray(t))return uk(t)}function uk(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function SMe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kH(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function TMe(t,e,n){return e&&kH(t.prototype,e),n&&kH(t,n),t}function CMe(t){return function(){var e=gI(t),n;if(IMe()){var r=gI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return PMe(this,n)}}function PMe(t,e){return e&&(pC(e)==="object"||typeof e=="function")?e:ck(t)}function ck(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function IMe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function gI(t){return gI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},gI(t)}function MMe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fk(t,e)}function fk(t,e){return fk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},fk(t,e)}function zH(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var OMe=function(t){MMe(n,t);var e=CMe(n);function n(){var r;SMe(this,n);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r=e.call.apply(e,[this].concat(o)),zH(ck(r),"_selectedEditHandle",void 0),zH(ck(r),"_isResizing",!1),r}return TMe(n,[{key:"getGuides",value:function(i){var o=this,a=[],s=i.selectedIndexes,u=i.lastPointerMoveEvent,d=u&&u.picks,g=u&&u.mapCoords;if(d&&d.length&&g&&s.length===1&&!this._isResizing){var _=d.find(function(F){return!F.isGuide});if(_&&_.object.properties.shape&&_.object.properties.shape.includes("Circle")&&i.selectedIndexes.includes(_.index)){var E=null,P=[],R=(0,FH.point)(g);if((0,pb.recursivelyTraverseNestedArrays)(_.object.geometry.coordinates,[],function(F,k){var X=(0,FH.lineString)(F),Y=o.getNearestPoint(X,R,i.modeConfig&&i.modeConfig.viewport);(!E||Y.properties.dist<E.properties.dist)&&(E=Y,P=k)}),E){var B=E,V=B.geometry.coordinates,z=B.properties.index;a.push({type:"Feature",properties:{guideType:"editHandle",editHandleType:"intermediate",featureIndex:_.index,positionIndexes:[].concat(vMe(P),[z+1])},geometry:{type:"Point",coordinates:V}})}}}return{type:"FeatureCollection",features:a}}},{key:"getNearestPoint",value:function(i,o,a){var s=i.geometry.coordinates;if(s.some(function(u){return u.length>2})){if(a)return(0,pb.nearestPointOnProjectedLine)(i,o,a);console.log("Editing 3D point but modeConfig.viewport not provided. Falling back to 2D logic.")}return(0,pMe.default)(i,o)}},{key:"handleDragging",value:function(i,o){var a=(0,pb.getPickedEditHandle)(i.pointerDownPicks);if(a){i.cancelPan();var s=a.properties,u=this.getSelectedFeature(o),d=(0,AMe.default)(u).geometry.coordinates,g=Object.entries(u.geometry.coordinates[0]).length-1,_=Math.max((0,mMe.default)(d,i.mapCoords),.001),E={},P=E.steps,R=P===void 0?g:P,B={steps:R},V=(0,gMe.default)(d,_,B),z=V.geometry,F=new yMe.ImmutableFeatureCollection(o.data).replaceGeometry(s.featureIndex,z).getObject();o.onEdit({updatedData:F,editType:"unionGeometry",editContext:{featureIndexes:[s.featureIndex]}})}}},{key:"handlePointerMove",value:function(i,o){if(!this._isResizing){var a=(0,pb.getPickedEditHandle)(i.picks);this._selectedEditHandle=a&&a.properties.editHandleType==="intermediate"?a:null}var s=this.getCursor(i);o.onUpdateCursor(s)}},{key:"handleStartDragging",value:function(i,o){this._selectedEditHandle&&(this._isResizing=!0)}},{key:"handleStopDragging",value:function(i,o){this._isResizing&&(this._selectedEditHandle=null,this._isResizing=!1)}},{key:"getCursor",value:function(i){var o=i&&i.picks||[],a=(0,pb.getPickedEditHandles)(o);return a.length?"cell":null}}]),n}(_Me.GeoJsonEditMode);eR.ResizeCircleMode=OMe;var N1={};function l6(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return Lre(t);case"FeatureCollection":return RMe(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return u6(t);default:throw new Error("unknown GeoJSON type")}}function Lre(t){var e={type:"Feature"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}}),e.properties=Dre(t.properties),e.geometry=u6(t.geometry),e}function Dre(t){var e={};return t&&Object.keys(t).forEach(function(n){var r=t[n];typeof r=="object"?r===null?e[n]=null:Array.isArray(r)?e[n]=r.map(function(i){return i}):e[n]=Dre(r):e[n]=r}),e}function RMe(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"features":return;default:e[n]=t[n]}}),e.features=t.features.map(function(n){return Lre(n)}),e}function u6(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),t.type==="GeometryCollection"?(e.geometries=t.geometries.map(function(n){return u6(n)}),e):(e.coordinates=Bre(t.coordinates),e)}function Bre(t){var e=t;return typeof e[0]!="object"?e.slice():e.map(function(n){return Bre(n)})}function jw(t,e,n,r){r===void 0&&(r={});var i=e<0,o=ZO(Math.abs(e),r.units,"meters");i&&(o=-Math.abs(o));var a=Ea(t),s=LMe(a,o,n);return s[0]+=s[0]-a[0]>180?-360:a[0]-s[0]>180?360:0,zo(s,r.properties)}function LMe(t,e,n,r){r=r===void 0?na:Number(r);var i=e/r,o=t[0]*Math.PI/180,a=wa(t[1]),s=wa(n),u=i*Math.cos(s),d=a+u;Math.abs(d)>Math.PI/2&&(d=d>0?Math.PI-d:-Math.PI-d);var g=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),_=Math.abs(g)>1e-11?u/g:Math.cos(a),E=i*Math.sin(s)/_,P=o+E;return[(P*180/Math.PI+540)%360-180,d*180/Math.PI]}function DMe(t,e,n,r){if(r=r||{},!c_(r))throw new Error("options is invalid");var i=r.units,o=r.zTranslation,a=r.mutate;if(!t)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");if(o&&typeof o!="number"&&isNaN(o))throw new Error("zTranslation is not a number");if(o=o!==void 0?o:0,e===0&&o===0)return t;if(n==null||isNaN(n))throw new Error("direction is required");return e<0&&(e=-e,n=n+180),(a===!1||a===void 0)&&(t=l6(t)),Jd(t,function(s){var u=jd(jw(s,e,n,{units:i}));s[0]=u[0],s[1]=u[1],o&&s.length===3&&(s[2]+=o)}),t}const BMe=Object.freeze(Object.defineProperty({__proto__:null,default:DMe},Symbol.toStringTag,{value:"Module"})),NMe=ti(BMe);Object.defineProperty(N1,"__esModule",{value:!0});N1.TranslateMode=void 0;var FMe=rR(Kd),kMe=rR(Lc),zMe=rR(NMe),UH=rl,UMe=rR(r6),GMe=Ai,jMe=So,VMe=Rc;function rR(t){return t&&t.__esModule?t:{default:t}}function gC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?gC=function(n){return typeof n}:gC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},gC(t)}function $Me(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function GH(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function HMe(t,e,n){return e&&GH(t.prototype,e),n&&GH(t,n),t}function WMe(t){return function(){var e=mI(t),n;if(XMe()){var r=mI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return qMe(this,n)}}function qMe(t,e){return e&&(gC(e)==="object"||typeof e=="function")?e:hk(t)}function hk(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function XMe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function mI(t){return mI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},mI(t)}function ZMe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&dk(t,e)}function dk(t,e){return dk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},dk(t,e)}function jH(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var YMe=function(t){ZMe(n,t);var e=WMe(n);function n(){var r;$Me(this,n);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r=e.call.apply(e,[this].concat(o)),jH(hk(r),"_geometryBeforeTranslate",void 0),jH(hk(r),"_isTranslatable",void 0),r}return HMe(n,[{key:"handleDragging",value:function(i,o){if(this._isTranslatable){if(this._geometryBeforeTranslate){var a=this.getTranslateAction(i.pointerDownMapCoords,i.mapCoords,"translating",o);a&&o.onEdit(a)}i.cancelPan()}}},{key:"handlePointerMove",value:function(i,o){this._isTranslatable=this.isSelectionPicked(i.pointerDownPicks||i.picks,o),this.updateCursor(o)}},{key:"handleStartDragging",value:function(i,o){this._isTranslatable&&(this._geometryBeforeTranslate=this.getSelectedFeaturesAsFeatureCollection(o))}},{key:"handleStopDragging",value:function(i,o){if(this._geometryBeforeTranslate){var a=this.getTranslateAction(i.pointerDownMapCoords,i.mapCoords,"translated",o);a&&o.onEdit(a),this._geometryBeforeTranslate=null}}},{key:"updateCursor",value:function(i){this._isTranslatable?i.onUpdateCursor("move"):i.onUpdateCursor(null)}},{key:"getTranslateAction",value:function(i,o,a,s){var u=this;if(!this._geometryBeforeTranslate)return null;var d=new VMe.ImmutableFeatureCollection(s.data),g=s.selectedIndexes,_=s.modeConfig||{},E=_.viewport,P=_.screenSpace;if(E&&P)(function(){for(var J=E.project?E:new UMe.default(E),ie=J.project(i),ce=J.project(o),re=ce[0]-ie[0],ue=ce[1]-ie[1],se=0;se<g.length;se++){var me=g[se],Ce=u._geometryBeforeTranslate.features[se],be=Ce.geometry.coordinates;be&&(be=(0,GMe.mapCoords)(be,function(Ye){var tt=J.project(Ye);return tt?(tt[0]+=re,tt[1]+=ue,J.unproject(tt)):null}),d=d.replaceGeometry(me,{type:Ce.geometry.type,coordinates:be}))}})();else for(var R=(0,UH.point)(i),B=(0,UH.point)(o),V=(0,kMe.default)(R,B),z=(0,FMe.default)(R,B),F=(0,zMe.default)(this._geometryBeforeTranslate,V,z),k=0;k<g.length;k++){var X=g[k],Y=F.features[k];d=d.replaceGeometry(X,Y.geometry)}return{updatedData:d.getObject(),editType:a,editContext:{featureIndexes:g}}}}]),n}(jMe.GeoJsonEditMode);N1.TranslateMode=YMe;var WE={};function c6(t,e){e===void 0&&(e={});var n=0,r=0,i=0;return Jd(t,function(o){n+=o[0],r+=o[1],i++},!0),zo([n/i,r/i],e.properties)}const QMe=Object.freeze(Object.defineProperty({__proto__:null,default:c6},Symbol.toStringTag,{value:"Module"})),f6=ti(QMe);function KMe(t,e){e===void 0&&(e={});var n=Number(t[0]),r=Number(t[1]),i=Number(t[2]),o=Number(t[3]);if(t.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[n,r],s=[n,o],u=[i,o],d=[i,r];return Th([[a,d,u,s,a]],e.properties,{bbox:t,id:e.id})}const JMe=Object.freeze(Object.defineProperty({__proto__:null,default:KMe},Symbol.toStringTag,{value:"Module"})),f_=ti(JMe);function AI(t,e){e===void 0&&(e={});var n=xf(t);switch(!e.properties&&t.type==="Feature"&&(e.properties=t.properties),n.type){case"Polygon":return Nre(n,e);case"MultiPolygon":return Fre(n,e);default:throw new Error("invalid poly")}}function Nre(t,e){e===void 0&&(e={});var n=xf(t),r=n.coordinates,i=e.properties?e.properties:t.type==="Feature"?t.properties:{};return h6(r,i)}function Fre(t,e){e===void 0&&(e={});var n=xf(t),r=n.coordinates,i=e.properties?e.properties:t.type==="Feature"?t.properties:{},o=[];return r.forEach(function(a){o.push(h6(a,i))}),vf(o)}function h6(t,e){return t.length>1?Q5(t,e):Su(t[0],e)}const eOe=Object.freeze(Object.defineProperty({__proto__:null,coordsToLine:h6,default:AI,multiPolygonToLine:Fre,polygonToLine:Nre},Symbol.toStringTag,{value:"Module"})),d6=ti(eOe);function kre(t,e,n){n===void 0&&(n={});var r;n.final?r=VH(Ea(e),Ea(t)):r=VH(Ea(t),Ea(e));var i=r>180?-(360-r):r;return i}function VH(t,e){var n=wa(t[1]),r=wa(e[1]),i=wa(e[0]-t[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);var o=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),a=Math.atan2(i,o);return(Uv(a)+360)%360}function tOe(t,e,n){if(n=n||{},!c_(n))throw new Error("options is invalid");var r=n.origin,i=n.mutate;if(!t)throw new Error("geojson required");if(typeof e!="number"||e===0)throw new Error("invalid factor");var o=Array.isArray(r)||typeof r=="object";return i!==!0&&(t=l6(t)),t.type==="FeatureCollection"&&!o?(k0(t,function(a,s){t.features[s]=$H(a,e,r)}),t):$H(t,e,r)}function $H(t,e,n){var r=ore(t)==="Point";return n=nOe(t,n),e===1||r||Jd(t,function(i){var o=t6(n,i),a=kre(n,i),s=o*e,u=jd(jw(n,s,a));i[0]=u[0],i[1]=u[1],i.length===3&&(i[2]*=e)}),t}function nOe(t,e){if(e==null&&(e="centroid"),Array.isArray(e)||typeof e=="object")return Ea(e);var n=t.bbox?t.bbox:z0(t),r=n[0],i=n[1],o=n[2],a=n[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return zo([r,i]);case"se":case"southeast":case"eastsouth":case"bottomright":return zo([o,i]);case"nw":case"northwest":case"westnorth":case"topleft":return zo([r,a]);case"ne":case"northeast":case"eastnorth":case"topright":return zo([o,a]);case"center":return tR(t);case void 0:case null:case"centroid":return c6(t);default:throw new Error("invalid origin")}}const rOe=Object.freeze(Object.defineProperty({__proto__:null,default:tOe},Symbol.toStringTag,{value:"Module"})),iOe=ti(rOe);Object.defineProperty(WE,"__esModule",{value:!0});WE.ScaleMode=void 0;var oOe=h_(s6),sOe=h_(f6),aOe=h_(Kd),lOe=h_(f_),HH=rl,uOe=h_(d6),cOe=QO,WH=h_(Lc),fOe=h_(iOe),qH=n6,hOe=Ai,dOe=So,pOe=Rc;function h_(t){return t&&t.__esModule?t:{default:t}}function mC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?mC=function(n){return typeof n}:mC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},mC(t)}function gOe(t){return yOe(t)||_Oe(t)||AOe(t)||mOe()}function mOe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AOe(t,e){if(t){if(typeof t=="string")return pk(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pk(t,e)}}function _Oe(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function yOe(t){if(Array.isArray(t))return pk(t)}function pk(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function vOe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function XH(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function xOe(t,e,n){return e&&XH(t.prototype,e),n&&XH(t,n),t}function bOe(t){return function(){var e=_I(t),n;if(EOe()){var r=_I(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return wOe(this,n)}}function wOe(t,e){return e&&(mC(e)==="object"||typeof e=="function")?e:Kc(t)}function Kc(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function EOe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function _I(t){return _I=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},_I(t)}function SOe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gk(t,e)}function gk(t,e){return gk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},gk(t,e)}function ih(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var TOe=function(t){SOe(n,t);var e=bOe(n);function n(){var r;vOe(this,n);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r=e.call.apply(e,[this].concat(o)),ih(Kc(r),"_geometryBeingScaled",void 0),ih(Kc(r),"_selectedEditHandle",void 0),ih(Kc(r),"_cornerGuidePoints",void 0),ih(Kc(r),"_cursor",void 0),ih(Kc(r),"_isScaling",!1),ih(Kc(r),"_isSinglePointGeometrySelected",function(s){var u=s||{},d=u.features;if(Array.isArray(d)&&d.length===1){var g=(0,qH.getGeom)(d[0]),_=g.type;return _==="Point"}return!1}),ih(Kc(r),"_getOppositeScaleHandle",function(s){var u=s&&s.properties&&Array.isArray(s.properties.positionIndexes)&&s.properties.positionIndexes[0];if(typeof u!="number")return null;var d=r._cornerGuidePoints.length,g=(u+d/2)%d;return r._cornerGuidePoints.find(function(_){return Array.isArray(_.properties.positionIndexes)?_.properties.positionIndexes[0]===g:!1})}),ih(Kc(r),"_getUpdatedData",function(s,u){for(var d=new pOe.ImmutableFeatureCollection(s.data),g=s.selectedIndexes,_=0;_<g.length;_++){var E=g[_],P=u.features[_];d=d.replaceGeometry(E,P.geometry)}return d.getObject()}),ih(Kc(r),"isEditHandleSelected",function(){return!!r._selectedEditHandle}),ih(Kc(r),"getScaleAction",function(s,u,d,g){if(!r._selectedEditHandle)return null;var _=r._getOppositeScaleHandle(r._selectedEditHandle),E=(0,qH.getCoord)(_),P=COe(E,s,u),R=(0,fOe.default)(r._geometryBeingScaled,P,{origin:E});return{updatedData:r._getUpdatedData(g,R),editType:d,editContext:{featureIndexes:g.selectedIndexes}}}),ih(Kc(r),"updateCursor",function(s){if(r._selectedEditHandle){r._cursor&&s.onUpdateCursor(r._cursor);var u=r.getSelectedFeaturesAsFeatureCollection(s),d=(0,sOe.default)(u),g=(0,aOe.default)(d,r._selectedEditHandle),_=g<0?g+180:g;_>=0&&_<=90||_>=180&&_<=270?(r._cursor="nesw-resize",s.onUpdateCursor("nesw-resize")):(r._cursor="nwse-resize",s.onUpdateCursor("nwse-resize"))}else s.onUpdateCursor(null),r._cursor=null}),r}return xOe(n,[{key:"handlePointerMove",value:function(i,o){if(!this._isScaling){var a=(0,hOe.getPickedEditHandle)(i.picks);this._selectedEditHandle=a&&a.properties.editHandleType==="scale"?a:null,this.updateCursor(o)}}},{key:"handleStartDragging",value:function(i,o){this._selectedEditHandle&&(this._isScaling=!0,this._geometryBeingScaled=this.getSelectedFeaturesAsFeatureCollection(o))}},{key:"handleDragging",value:function(i,o){if(this._isScaling){o.onUpdateCursor(this._cursor);var a=this.getScaleAction(i.pointerDownMapCoords,i.mapCoords,"scaling",o);a&&o.onEdit(a),i.cancelPan()}}},{key:"handleStopDragging",value:function(i,o){if(this._isScaling){var a=this.getScaleAction(i.pointerDownMapCoords,i.mapCoords,"scaled",o);a&&o.onEdit(a),o.onUpdateCursor(null),this._geometryBeingScaled=null,this._selectedEditHandle=null,this._cursor=null,this._isScaling=!1}}},{key:"getGuides",value:function(i){this._cornerGuidePoints=[];var o=this.getSelectedFeaturesAsFeatureCollection(i);if(this._isSinglePointGeometrySelected(o))return{type:"FeatureCollection",features:[]};var a=(0,lOe.default)((0,oOe.default)(o));a.properties.mode="scale";var s=[];return(0,cOe.coordEach)(a,function(u,d){if(d<4){var g=(0,HH.point)(u,{guideType:"editHandle",editHandleType:"scale",positionIndexes:[d]});s.push(g)}}),this._cornerGuidePoints=s,(0,HH.featureCollection)([(0,uOe.default)(a)].concat(gOe(this._cornerGuidePoints)))}}]),n}(dOe.GeoJsonEditMode);WE.ScaleMode=TOe;function COe(t,e,n){var r=(0,WH.default)(t,e),i=(0,WH.default)(t,n);return i/r}var qE={};function zre(t,e,n){if(n=n||{},!c_(n))throw new Error("options is invalid");var r=n.pivot,i=n.mutate;if(!t)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("angle is required");return e===0||(r||(r=c6(t)),(i===!1||i===void 0)&&(t=l6(t)),Jd(t,function(o){var a=kre(r,o),s=a+e,u=t6(r,o),d=jd(jw(r,u,s));o[0]=d[0],o[1]=d[1]})),t}const POe=Object.freeze(Object.defineProperty({__proto__:null,default:zre},Symbol.toStringTag,{value:"Module"})),IOe=ti(POe);Object.defineProperty(qE,"__esModule",{value:!0});qE.RotateMode=void 0;var MOe=d_(s6),ZH=d_(f6),YH=d_(Kd),OOe=d_(f_),ROe=d_(Lc),LOe=QO,DOe=n6,kS=rl,BOe=d_(IOe),NOe=d_(d6),FOe=Ai,QH=So,kOe=Rc;function d_(t){return t&&t.__esModule?t:{default:t}}function AC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?AC=function(n){return typeof n}:AC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},AC(t)}function zOe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function KH(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function UOe(t,e,n){return e&&KH(t.prototype,e),n&&KH(t,n),t}function GOe(t){return function(){var e=yI(t),n;if(VOe()){var r=yI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return jOe(this,n)}}function jOe(t,e){return e&&(AC(e)==="object"||typeof e=="function")?e:Fy(t)}function Fy(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function VOe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function yI(t){return yI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},yI(t)}function $Oe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&mk(t,e)}function mk(t,e){return mk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},mk(t,e)}function gb(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var HOe=function(t){$Oe(n,t);var e=GOe(n);function n(){var r;zOe(this,n);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r=e.call.apply(e,[this].concat(o)),gb(Fy(r),"_selectedEditHandle",void 0),gb(Fy(r),"_geometryBeingRotated",void 0),gb(Fy(r),"_isRotating",!1),gb(Fy(r),"_isSinglePointGeometrySelected",function(s){var u=s||{},d=u.features;if(Array.isArray(d)&&d.length===1){var g=(0,DOe.getGeom)(d[0]),_=g.type;return _==="Point"}return!1}),gb(Fy(r),"getIsRotating",function(){return r._isRotating}),r}return UOe(n,[{key:"getGuides",value:function(i){var o=this._geometryBeingRotated||this.getSelectedFeaturesAsFeatureCollection(i);if(this._isSinglePointGeometrySelected(o))return{type:"FeatureCollection",features:[]};if(this._isRotating)return(0,kS.featureCollection)([(0,ZH.default)(o)]);var a=(0,OOe.default)((0,MOe.default)(o)),s=null,u=null,d=0;(0,LOe.coordEach)(a,function(P){if(s){var R=(0,QH.getIntermediatePosition)(P,s);(!u||R[1]>u[1])&&(u=R);var B=(0,ROe.default)(P,s);d=Math.max(d,B)}s=P});var g=u&&[u[0],u[1]+d/1e3],_=(0,kS.lineString)([u,g]),E=(0,kS.point)(g,{guideType:"editHandle",editHandleType:"rotate"});return(0,kS.featureCollection)([(0,NOe.default)(a),E,_])}},{key:"handleDragging",value:function(i,o){if(this._isRotating){var a=this.getRotateAction(i.pointerDownMapCoords,i.mapCoords,"rotating",o);a&&o.onEdit(a),i.cancelPan()}}},{key:"handlePointerMove",value:function(i,o){if(!this._isRotating){var a=(0,FOe.getPickedEditHandle)(i.picks);this._selectedEditHandle=a&&a.properties.editHandleType==="rotate"?a:null}this.updateCursor(o)}},{key:"handleStartDragging",value:function(i,o){this._selectedEditHandle&&(this._isRotating=!0,this._geometryBeingRotated=this.getSelectedFeaturesAsFeatureCollection(o))}},{key:"handleStopDragging",value:function(i,o){if(this._isRotating){var a=this.getRotateAction(i.pointerDownMapCoords,i.mapCoords,"rotated",o);a&&o.onEdit(a),this._geometryBeingRotated=null,this._selectedEditHandle=null,this._isRotating=!1}}},{key:"updateCursor",value:function(i){this._selectedEditHandle?i.onUpdateCursor("crosshair"):i.onUpdateCursor(null)}},{key:"getRotateAction",value:function(i,o,a,s){if(!this._geometryBeingRotated)return null;for(var u=(0,ZH.default)(this._geometryBeingRotated),d=WOe(u,i,o),g=(0,BOe.default)(this._geometryBeingRotated,d,{pivot:u}),_=new kOe.ImmutableFeatureCollection(s.data),E=s.selectedIndexes,P=0;P<E.length;P++){var R=E[P],B=g.features[P];_=_.replaceGeometry(R,B.geometry)}return{updatedData:_.getObject(),editType:a,editContext:{featureIndexes:E}}}}]),n}(QH.GeoJsonEditMode);qE.RotateMode=HOe;function WOe(t,e,n){var r=(0,YH.default)(t,e),i=(0,YH.default)(t,n);return i-r}var iR={};Object.defineProperty(iR,"__esModule",{value:!0});iR.DuplicateMode=void 0;var qOe=N1;function _C(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_C=function(n){return typeof n}:_C=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_C(t)}function XOe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function JH(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ZOe(t,e,n){return e&&JH(t.prototype,e),n&&JH(t,n),t}function yC(t,e,n){return typeof Reflect<"u"&&Reflect.get?yC=Reflect.get:yC=function(i,o,a){var s=YOe(i,o);if(s){var u=Object.getOwnPropertyDescriptor(s,o);return u.get?u.get.call(a):u.value}},yC(t,e,n||t)}function YOe(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=jv(t),t!==null););return t}function QOe(t){return function(){var e=jv(t),n;if(eRe()){var r=jv(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return KOe(this,n)}}function KOe(t,e){return e&&(_C(e)==="object"||typeof e=="function")?e:JOe(t)}function JOe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function eRe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function jv(t){return jv=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},jv(t)}function tRe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ak(t,e)}function Ak(t,e){return Ak=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Ak(t,e)}var nRe=function(t){tRe(n,t);var e=QOe(n);function n(){return XOe(this,n),e.apply(this,arguments)}return ZOe(n,[{key:"handleStartDragging",value:function(i,o){yC(jv(n.prototype),"handleStartDragging",this).call(this,i,o),this._geometryBeforeTranslate&&o.onEdit(this.getAddManyFeaturesAction(this._geometryBeforeTranslate,o.data))}},{key:"updateCursor",value:function(i){this._isTranslatable?i.onUpdateCursor("copy"):i.onUpdateCursor(null)}}]),n}(qOe.TranslateMode);iR.DuplicateMode=nRe;var oR={};Object.defineProperty(oR,"__esModule",{value:!0});oR.ExtendLineStringMode=void 0;var rRe=So,iRe=Rc;function vC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vC=function(n){return typeof n}:vC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},vC(t)}function oRe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function sRe(t,e,n){return e&&e7(t.prototype,e),n&&e7(t,n),t}function aRe(t){return function(){var e=vI(t),n;if(cRe()){var r=vI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return lRe(this,n)}}function lRe(t,e){return e&&(vC(e)==="object"||typeof e=="function")?e:uRe(t)}function uRe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function cRe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function vI(t){return vI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},vI(t)}function fRe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_k(t,e)}function _k(t,e){return _k=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},_k(t,e)}var hRe=function(t){fRe(n,t);var e=aRe(n);function n(){return oRe(this,n),e.apply(this,arguments)}return sRe(n,[{key:"getSingleSelectedLineString",value:function(i){var o=this.getSelectedGeometry(i);return o&&o.type==="LineString"?o:null}},{key:"handleClick",value:function(i,o){var a=o.selectedIndexes,s=this.getSingleSelectedLineString(o);if(!s){console.warn("ExtendLineStringMode only supported for single LineString selection");return}var u=[s.coordinates.length],d=o.modeConfig;d&&d.drawAtFront&&(u=[0]);var g=a[0],_=new iRe.ImmutableFeatureCollection(o.data).addPosition(g,u,i.mapCoords).getObject();o.onEdit({updatedData:_,editType:"addPosition",editContext:{featureIndexes:[g],positionIndexes:u,position:i.mapCoords}})}},{key:"getGuides",value:function(i){var o={type:"FeatureCollection",features:[]},a=this.getSingleSelectedLineString(i);if(!a)return o;var s=i.lastPointerMoveEvent&&i.lastPointerMoveEvent.mapCoords,u=null,d=i.modeConfig;return d&&d.drawAtFront?u=a.coordinates[0]:u=a.coordinates[a.coordinates.length-1],o.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[u,s]}}),o}},{key:"handlePointerMove",value:function(i,o){o.onUpdateCursor("cell")}}]),n}(rRe.GeoJsonEditMode);oR.ExtendLineStringMode=hRe;var sR={};function Vv(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var r=Ea(t),i=xf(e),o=i.type,a=e.bbox,s=i.coordinates;if(a&&dRe(r,a)===!1)return!1;o==="Polygon"&&(s=[s]);for(var u=!1,d=0;d<s.length&&!u;d++)if(t7(r,s[d][0],n.ignoreBoundary)){for(var g=!1,_=1;_<s[d].length&&!g;)t7(r,s[d][_],!n.ignoreBoundary)&&(g=!0),_++;g||(u=!0)}return u}function t7(t,e,n){var r=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,o=e.length-1;i<e.length;o=i++){var a=e[i][0],s=e[i][1],u=e[o][0],d=e[o][1],g=t[1]*(a-u)+s*(u-t[0])+d*(t[0]-a)===0&&(a-t[0])*(u-t[0])<=0&&(s-t[1])*(d-t[1])<=0;if(g)return!n;var _=s>t[1]!=d>t[1]&&t[0]<(u-a)*(t[1]-s)/(d-s)+a;_&&(r=!r)}return r}function dRe(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}const pRe=Object.freeze(Object.defineProperty({__proto__:null,default:Vv},Symbol.toStringTag,{value:"Module"})),gRe=ti(pRe);"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var n=Object(this),r=Math.max(Math.min(n.length,9007199254740991),0)||0,i=1 in arguments&&parseInt(Number(arguments[1]),10)||0;i=i<0?Math.max(r+i,0):Math.min(i,r);var o=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:r;for(o=o<0?Math.max(r+arguments[2],0):Math.min(o,r);i<o;)n[i]=e,++i;return n},writable:!0});Number.isFinite=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)};Number.isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(t){return t!==t};Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var U0=function(){};U0.prototype.interfaces_=function(){return[]};U0.prototype.getClass=function(){return U0};U0.prototype.equalsWithTolerance=function(e,n,r){return Math.abs(e-n)<=r};var oo=function(t){function e(n){t.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),mr=function(){},Ure={MAX_VALUE:{configurable:!0}};mr.isNaN=function(e){return Number.isNaN(e)};mr.doubleToLongBits=function(e){return e};mr.longBitsToDouble=function(e){return e};mr.isInfinite=function(e){return!Number.isFinite(e)};Ure.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(mr,Ure);var Uu=function(){},aR=function(){},$v=function(){};function Gu(){}var dt=function t(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},p_={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};dt.prototype.setOrdinate=function(e,n){switch(e){case dt.X:this.x=n;break;case dt.Y:this.y=n;break;case dt.Z:this.z=n;break;default:throw new oo("Invalid ordinate index: "+e)}};dt.prototype.equals2D=function(){if(arguments.length===1){var e=arguments[0];return!(this.x!==e.x||this.y!==e.y)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return!(!U0.equalsWithTolerance(this.x,n.x,r)||!U0.equalsWithTolerance(this.y,n.y,r))}};dt.prototype.getOrdinate=function(e){switch(e){case dt.X:return this.x;case dt.Y:return this.y;case dt.Z:return this.z}throw new oo("Invalid ordinate index: "+e)};dt.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||mr.isNaN(this.z))&&mr.isNaN(e.z)};dt.prototype.equals=function(e){return e instanceof dt?this.equals2D(e):!1};dt.prototype.equalInZ=function(e,n){return U0.equalsWithTolerance(this.z,e.z,n)};dt.prototype.compareTo=function(e){var n=e;return this.x<n.x?-1:this.x>n.x?1:this.y<n.y?-1:this.y>n.y?1:0};dt.prototype.clone=function(){};dt.prototype.copy=function(){return new dt(this)};dt.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};dt.prototype.distance3D=function(e){var n=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return Math.sqrt(n*n+r*r+i*i)};dt.prototype.distance=function(e){var n=this.x-e.x,r=this.y-e.y;return Math.sqrt(n*n+r*r)};dt.prototype.hashCode=function(){var e=17;return e=37*e+dt.hashCode(this.x),e=37*e+dt.hashCode(this.y),e};dt.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z};dt.prototype.interfaces_=function(){return[Uu,aR,Gu]};dt.prototype.getClass=function(){return dt};dt.hashCode=function(){if(arguments.length===1){var e=arguments[0],n=mr.doubleToLongBits(e);return Math.trunc((n^n)>>>32)}};p_.DimensionalComparator.get=function(){return Zp};p_.serialVersionUID.get=function(){return 6683108902428367e3};p_.NULL_ORDINATE.get=function(){return mr.NaN};p_.X.get=function(){return 0};p_.Y.get=function(){return 1};p_.Z.get=function(){return 2};Object.defineProperties(dt,p_);var Zp=function(e){if(this._dimensionsToTest=2,arguments.length!==0){if(arguments.length===1){var n=arguments[0];if(n!==2&&n!==3)throw new oo("only 2 or 3 dimensions may be specified");this._dimensionsToTest=n}}};Zp.prototype.compare=function(e,n){var r=e,i=n,o=Zp.compare(r.x,i.x);if(o!==0)return o;var a=Zp.compare(r.y,i.y);if(a!==0)return a;if(this._dimensionsToTest<=2)return 0;var s=Zp.compare(r.z,i.z);return s};Zp.prototype.interfaces_=function(){return[$v]};Zp.prototype.getClass=function(){return Zp};Zp.compare=function(e,n){return e<n?-1:e>n?1:mr.isNaN(e)?mr.isNaN(n)?0:-1:mr.isNaN(n)?1:0};var Hv=function(){};Hv.prototype.create=function(){};Hv.prototype.interfaces_=function(){return[]};Hv.prototype.getClass=function(){return Hv};var Et=function(){},XE={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Et.prototype.interfaces_=function(){return[]};Et.prototype.getClass=function(){return Et};Et.toLocationSymbol=function(e){switch(e){case Et.EXTERIOR:return"e";case Et.BOUNDARY:return"b";case Et.INTERIOR:return"i";case Et.NONE:return"-"}throw new oo("Unknown location value: "+e)};XE.INTERIOR.get=function(){return 0};XE.BOUNDARY.get=function(){return 1};XE.EXTERIOR.get=function(){return 2};XE.NONE.get=function(){return-1};Object.defineProperties(Et,XE);var ar=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},Jl=function(){},Gre={LOG_10:{configurable:!0}};Jl.prototype.interfaces_=function(){return[]};Jl.prototype.getClass=function(){return Jl};Jl.log10=function(e){var n=Math.log(e);return mr.isInfinite(n)||mr.isNaN(n)?n:n/Jl.LOG_10};Jl.min=function(e,n,r,i){var o=e;return n<o&&(o=n),r<o&&(o=r),i<o&&(o=i),o};Jl.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1],r=arguments[2];return e<n?n:e>r?r:e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],o=arguments[1],a=arguments[2];return i<o?o:i>a?a:i}};Jl.wrap=function(e,n){return e<0?n- -e%n:e%n};Jl.max=function(){if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2],i=e;return n>i&&(i=n),r>i&&(i=r),i}else if(arguments.length===4){var o=arguments[0],a=arguments[1],s=arguments[2],u=arguments[3],d=o;return a>d&&(d=a),s>d&&(d=s),u>d&&(d=u),d}};Jl.average=function(e,n){return(e+n)/2};Gre.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Jl,Gre);var Df=function(e){this.str=e};Df.prototype.append=function(e){this.str+=e};Df.prototype.setCharAt=function(e,n){this.str=this.str.substr(0,e)+n+this.str.substr(e+1)};Df.prototype.toString=function(e){return this.str};var bf=function(e){this.value=e};bf.prototype.intValue=function(){return this.value};bf.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0};bf.isNaN=function(e){return Number.isNaN(e)};var Vw=function(){};Vw.isWhitespace=function(e){return e<=32&&e>=0||e===127};Vw.toUpperCase=function(e){return e.toUpperCase()};var Lt=function t(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var r=arguments[0];t.call(this,t.parse(r))}}else if(arguments.length===2){var i=arguments[0],o=arguments[1];this.init(i,o)}},Dc={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Lt.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo};Lt.prototype.extractSignificantDigits=function(e,n){var r=this.abs(),i=Lt.magnitude(r._hi),o=Lt.TEN.pow(i);r=r.divide(o),r.gt(Lt.TEN)?(r=r.divide(Lt.TEN),i+=1):r.lt(Lt.ONE)&&(r=r.multiply(Lt.TEN),i-=1);for(var a=i+1,s=new Df,u=Lt.MAX_PRINT_DIGITS-1,d=0;d<=u;d++){e&&d===a&&s.append(".");var g=Math.trunc(r._hi);if(g<0)break;var _=!1,E=0;g>9?(_=!0,E="9"):E="0"+g,s.append(E),r=r.subtract(Lt.valueOf(g)).multiply(Lt.TEN),_&&r.selfAdd(Lt.TEN);var P=!0,R=Lt.magnitude(r._hi);if(R<0&&Math.abs(R)>=u-d&&(P=!1),!P)break}return n[0]=i,s.toString()};Lt.prototype.sqr=function(){return this.multiply(this)};Lt.prototype.doubleValue=function(){return this._hi+this._lo};Lt.prototype.subtract=function(){if(arguments[0]instanceof Lt){var e=arguments[0];return this.add(e.negate())}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.add(-n)}};Lt.prototype.equals=function(){if(arguments.length===1){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}};Lt.prototype.isZero=function(){return this._hi===0&&this._lo===0};Lt.prototype.selfSubtract=function(){if(arguments[0]instanceof Lt){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.isNaN()?this:this.selfAdd(-n,0)}};Lt.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Lt.prototype.min=function(e){return this.le(e)?this:e};Lt.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Lt){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.selfDivide(n,0)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1],o=null,a=null,s=null,u=null,d=null,g=null,_=null,E=null;return d=this._hi/r,g=Lt.SPLIT*d,o=g-d,E=Lt.SPLIT*r,o=g-o,a=d-o,s=E-r,_=d*r,s=E-s,u=r-s,E=o*s-_+o*u+a*s+a*u,g=(this._hi-_-E+this._lo-d*i)/r,E=d+g,this._hi=E,this._lo=d-E+g,this}};Lt.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Lt.prototype.divide=function(){if(arguments[0]instanceof Lt){var e=arguments[0],n=null,r=null,i=null,o=null,a=null,s=null,u=null,d=null;a=this._hi/e._hi,s=Lt.SPLIT*a,n=s-a,d=Lt.SPLIT*e._hi,n=s-n,r=a-n,i=d-e._hi,u=a*e._hi,i=d-i,o=e._hi-i,d=n*i-u+n*o+r*i+r*o,s=(this._hi-u-d+this._lo-a*e._lo)/e._hi,d=a+s;var g=d,_=a-d+s;return new Lt(g,_)}else if(typeof arguments[0]=="number"){var E=arguments[0];return mr.isNaN(E)?Lt.createNaN():Lt.copy(this).selfDivide(E,0)}};Lt.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo};Lt.prototype.pow=function(e){if(e===0)return Lt.valueOf(1);var n=new Lt(this),r=Lt.valueOf(1),i=Math.abs(e);if(i>1)for(;i>0;)i%2===1&&r.selfMultiply(n),i/=2,i>0&&(n=n.sqr());else r=n;return e<0?r.reciprocal():r};Lt.prototype.ceil=function(){if(this.isNaN())return Lt.NaN;var e=Math.ceil(this._hi),n=0;return e===this._hi&&(n=Math.ceil(this._lo)),new Lt(e,n)};Lt.prototype.compareTo=function(e){var n=e;return this._hi<n._hi?-1:this._hi>n._hi?1:this._lo<n._lo?-1:this._lo>n._lo?1:0};Lt.prototype.rint=function(){if(this.isNaN())return this;var e=this.add(.5);return e.floor()};Lt.prototype.setValue=function(){if(arguments[0]instanceof Lt){var e=arguments[0];return this.init(e),this}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.init(n),this}};Lt.prototype.max=function(e){return this.ge(e)?this:e};Lt.prototype.sqrt=function(){if(this.isZero())return Lt.valueOf(0);if(this.isNegative())return Lt.NaN;var e=1/Math.sqrt(this._hi),n=this._hi*e,r=Lt.valueOf(n),i=this.subtract(r.sqr()),o=i._hi*(e*.5);return r.add(o)};Lt.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Lt){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var n=arguments[0],r=null,i=null,o=null,a=null,s=null,u=null;return o=this._hi+n,s=o-this._hi,a=o-s,a=n-s+(this._hi-a),u=a+this._lo,r=o+u,i=u+(o-r),this._hi=r+i,this._lo=i+(r-this._hi),this}}else if(arguments.length===2){var d=arguments[0],g=arguments[1],_=null,E=null,P=null,R=null,B=null,V=null,z=null,F=null;B=this._hi+d,P=this._lo+g,z=B-this._hi,F=P-this._lo,V=B-z,R=P-F,V=d-z+(this._hi-V),R=g-F+(this._lo-R),z=V+P,_=B+z,E=z+(B-_),z=R+E;var k=_+z,X=z+(_-k);return this._hi=k,this._lo=X,this}};Lt.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Lt){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.selfMultiply(n,0)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1],o=null,a=null,s=null,u=null,d=null,g=null;d=Lt.SPLIT*this._hi,o=d-this._hi,g=Lt.SPLIT*r,o=d-o,a=this._hi-o,s=g-r,d=this._hi*r,s=g-s,u=r-s,g=o*s-d+o*u+a*s+a*u+(this._hi*i+this._lo*r);var _=d+g;o=d-_;var E=g+o;return this._hi=_,this._lo=E,this}};Lt.prototype.selfSqr=function(){return this.selfMultiply(this)};Lt.prototype.floor=function(){if(this.isNaN())return Lt.NaN;var e=Math.floor(this._hi),n=0;return e===this._hi&&(n=Math.floor(this._lo)),new Lt(e,n)};Lt.prototype.negate=function(){return this.isNaN()?this:new Lt(-this._hi,-this._lo)};Lt.prototype.clone=function(){};Lt.prototype.multiply=function(){if(arguments[0]instanceof Lt){var e=arguments[0];return e.isNaN()?Lt.createNaN():Lt.copy(this).selfMultiply(e)}else if(typeof arguments[0]=="number"){var n=arguments[0];return mr.isNaN(n)?Lt.createNaN():Lt.copy(this).selfMultiply(n,0)}};Lt.prototype.isNaN=function(){return mr.isNaN(this._hi)};Lt.prototype.intValue=function(){return Math.trunc(this._hi)};Lt.prototype.toString=function(){var e=Lt.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()};Lt.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(e!==null)return e;var n=new Array(1).fill(null),r=this.extractSignificantDigits(!0,n),i=n[0]+1,o=r;if(r.charAt(0)===".")o="0"+r;else if(i<0)o="0."+Lt.stringOfChar("0",-i)+r;else if(r.indexOf(".")===-1){var a=i-r.length,s=Lt.stringOfChar("0",a);o=r+s+".0"}return this.isNegative()?"-"+o:o};Lt.prototype.reciprocal=function(){var e=null,n=null,r=null,i=null,o=null,a=null,s=null,u=null;o=1/this._hi,a=Lt.SPLIT*o,e=a-o,u=Lt.SPLIT*this._hi,e=a-e,n=o-e,r=u-this._hi,s=o*this._hi,r=u-r,i=this._hi-r,u=e*r-s+e*i+n*r+n*i,a=(1-s-u-o*this._lo)/this._hi;var d=o+a,g=o-d+a;return new Lt(d,g)};Lt.prototype.toSciNotation=function(){if(this.isZero())return Lt.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var n=new Array(1).fill(null),r=this.extractSignificantDigits(!1,n),i=Lt.SCI_NOT_EXPONENT_CHAR+n[0];if(r.charAt(0)==="0")throw new Error("Found leading zero: "+r);var o="";r.length>1&&(o=r.substring(1));var a=r.charAt(0)+"."+o;return this.isNegative()?"-"+a+i:a+i};Lt.prototype.abs=function(){return this.isNaN()?Lt.NaN:this.isNegative()?this.negate():new Lt(this)};Lt.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Lt.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo};Lt.prototype.add=function(){if(arguments[0]instanceof Lt){var e=arguments[0];return Lt.copy(this).selfAdd(e)}else if(typeof arguments[0]=="number"){var n=arguments[0];return Lt.copy(this).selfAdd(n)}};Lt.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof Lt){var n=arguments[0];this._hi=n._hi,this._lo=n._lo}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this._hi=r,this._lo=i}};Lt.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo};Lt.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Lt.prototype.trunc=function(){return this.isNaN()?Lt.NaN:this.isPositive()?this.floor():this.ceil()};Lt.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Lt.prototype.interfaces_=function(){return[Gu,Uu,aR]};Lt.prototype.getClass=function(){return Lt};Lt.sqr=function(e){return Lt.valueOf(e).selfMultiply(e)};Lt.valueOf=function(){if(typeof arguments[0]=="string"){var e=arguments[0];return Lt.parse(e)}else if(typeof arguments[0]=="number"){var n=arguments[0];return new Lt(n)}};Lt.sqrt=function(e){return Lt.valueOf(e).sqrt()};Lt.parse=function(e){for(var n=0,r=e.length;Vw.isWhitespace(e.charAt(n));)n++;var i=!1;if(n<r){var o=e.charAt(n);(o==="-"||o==="+")&&(n++,o==="-"&&(i=!0))}for(var a=new Lt,s=0,u=0,d=0;!(n>=r);){var g=e.charAt(n);if(n++,Vw.isDigit(g)){var _=g-"0";a.selfMultiply(Lt.TEN),a.selfAdd(_),s++;continue}if(g==="."){u=s;continue}if(g==="e"||g==="E"){var E=e.substring(n);try{d=bf.parseInt(E)}catch(z){throw z instanceof Error?new Error("Invalid exponent "+E+" in string "+e):z}finally{}break}throw new Error("Unexpected character '"+g+"' at position "+n+" in string "+e)}var P=a,R=s-u-d;if(R===0)P=a;else if(R>0){var B=Lt.TEN.pow(R);P=a.divide(B)}else if(R<0){var V=Lt.TEN.pow(-R);P=a.multiply(V)}return i?P.negate():P};Lt.createNaN=function(){return new Lt(mr.NaN,mr.NaN)};Lt.copy=function(e){return new Lt(e)};Lt.magnitude=function(e){var n=Math.abs(e),r=Math.log(n)/Math.log(10),i=Math.trunc(Math.floor(r)),o=Math.pow(10,i);return o*10<=n&&(i+=1),i};Lt.stringOfChar=function(e,n){for(var r=new Df,i=0;i<n;i++)r.append(e);return r.toString()};Dc.PI.get=function(){return new Lt(3.141592653589793,12246467991473532e-32)};Dc.TWO_PI.get=function(){return new Lt(6.283185307179586,24492935982947064e-32)};Dc.PI_2.get=function(){return new Lt(1.5707963267948966,6123233995736766e-32)};Dc.E.get=function(){return new Lt(2.718281828459045,14456468917292502e-32)};Dc.NaN.get=function(){return new Lt(mr.NaN,mr.NaN)};Dc.EPS.get=function(){return 123259516440783e-46};Dc.SPLIT.get=function(){return 134217729};Dc.MAX_PRINT_DIGITS.get=function(){return 32};Dc.TEN.get=function(){return Lt.valueOf(10)};Dc.ONE.get=function(){return Lt.valueOf(1)};Dc.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};Dc.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Lt,Dc);var qa=function(){},jre={DP_SAFE_EPSILON:{configurable:!0}};qa.prototype.interfaces_=function(){return[]};qa.prototype.getClass=function(){return qa};qa.orientationIndex=function(e,n,r){var i=qa.orientationIndexFilter(e,n,r);if(i<=1)return i;var o=Lt.valueOf(n.x).selfAdd(-e.x),a=Lt.valueOf(n.y).selfAdd(-e.y),s=Lt.valueOf(r.x).selfAdd(-n.x),u=Lt.valueOf(r.y).selfAdd(-n.y);return o.selfMultiply(u).selfSubtract(a.selfMultiply(s)).signum()};qa.signOfDet2x2=function(e,n,r,i){var o=e.multiply(i).selfSubtract(n.multiply(r));return o.signum()};qa.intersection=function(e,n,r,i){var o=Lt.valueOf(i.y).selfSubtract(r.y).selfMultiply(Lt.valueOf(n.x).selfSubtract(e.x)),a=Lt.valueOf(i.x).selfSubtract(r.x).selfMultiply(Lt.valueOf(n.y).selfSubtract(e.y)),s=o.subtract(a),u=Lt.valueOf(i.x).selfSubtract(r.x).selfMultiply(Lt.valueOf(e.y).selfSubtract(r.y)),d=Lt.valueOf(i.y).selfSubtract(r.y).selfMultiply(Lt.valueOf(e.x).selfSubtract(r.x)),g=u.subtract(d),_=g.selfDivide(s).doubleValue(),E=Lt.valueOf(e.x).selfAdd(Lt.valueOf(n.x).selfSubtract(e.x).selfMultiply(_)).doubleValue(),P=Lt.valueOf(n.x).selfSubtract(e.x).selfMultiply(Lt.valueOf(e.y).selfSubtract(r.y)),R=Lt.valueOf(n.y).selfSubtract(e.y).selfMultiply(Lt.valueOf(e.x).selfSubtract(r.x)),B=P.subtract(R),V=B.selfDivide(s).doubleValue(),z=Lt.valueOf(r.y).selfAdd(Lt.valueOf(i.y).selfSubtract(r.y).selfMultiply(V)).doubleValue();return new dt(E,z)};qa.orientationIndexFilter=function(e,n,r){var i=null,o=(e.x-r.x)*(n.y-r.y),a=(e.y-r.y)*(n.x-r.x),s=o-a;if(o>0){if(a<=0)return qa.signum(s);i=o+a}else if(o<0){if(a>=0)return qa.signum(s);i=-o-a}else return qa.signum(s);var u=qa.DP_SAFE_EPSILON*i;return s>=u||-s>=u?qa.signum(s):2};qa.signum=function(e){return e>0?1:e<0?-1:0};jre.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(qa,jre);var Yr=function(){},ZE={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};ZE.X.get=function(){return 0};ZE.Y.get=function(){return 1};ZE.Z.get=function(){return 2};ZE.M.get=function(){return 3};Yr.prototype.setOrdinate=function(e,n,r){};Yr.prototype.size=function(){};Yr.prototype.getOrdinate=function(e,n){};Yr.prototype.getCoordinate=function(){};Yr.prototype.getCoordinateCopy=function(e){};Yr.prototype.getDimension=function(){};Yr.prototype.getX=function(e){};Yr.prototype.clone=function(){};Yr.prototype.expandEnvelope=function(e){};Yr.prototype.copy=function(){};Yr.prototype.getY=function(e){};Yr.prototype.toCoordinateArray=function(){};Yr.prototype.interfaces_=function(){return[aR]};Yr.prototype.getClass=function(){return Yr};Object.defineProperties(Yr,ZE);var Vre=function(){},F1=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Vre),qs=function(){};qs.arraycopy=function(e,n,r,i,o){for(var a=0,s=n;s<n+o;s++)r[i+a]=e[s],a++};qs.getProperty=function(e){return{"line.separator":`
`}[e]};var mc=function t(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],o=arguments[1];this.x=i.y*o.w-o.y*i.w,this.y=o.x*i.w-i.x*o.w,this.w=i.x*o.y-o.x*i.y}else if(arguments[0]instanceof dt&&arguments[1]instanceof dt){var a=arguments[0],s=arguments[1];this.x=a.y-s.y,this.y=s.x-a.x,this.w=a.x*s.y-s.x*a.y}}else if(arguments.length===3){var u=arguments[0],d=arguments[1],g=arguments[2];this.x=u,this.y=d,this.w=g}else if(arguments.length===4){var _=arguments[0],E=arguments[1],P=arguments[2],R=arguments[3],B=_.y-E.y,V=E.x-_.x,z=_.x*E.y-E.x*_.y,F=P.y-R.y,k=R.x-P.x,X=P.x*R.y-R.x*P.y;this.x=V*X-k*z,this.y=F*z-B*X,this.w=B*k-F*V}};mc.prototype.getY=function(){var e=this.y/this.w;if(mr.isNaN(e)||mr.isInfinite(e))throw new F1;return e};mc.prototype.getX=function(){var e=this.x/this.w;if(mr.isNaN(e)||mr.isInfinite(e))throw new F1;return e};mc.prototype.getCoordinate=function(){var e=new dt;return e.x=this.getX(),e.y=this.getY(),e};mc.prototype.interfaces_=function(){return[]};mc.prototype.getClass=function(){return mc};mc.intersection=function(e,n,r,i){var o=e.y-n.y,a=n.x-e.x,s=e.x*n.y-n.x*e.y,u=r.y-i.y,d=i.x-r.x,g=r.x*i.y-i.x*r.y,_=a*g-d*s,E=u*s-o*g,P=o*d-u*a,R=_/P,B=E/P;if(mr.isNaN(R)||mr.isInfinite(R)||mr.isNaN(B)||mr.isInfinite(B))throw new F1;return new dt(R,B)};var Qn=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof dt){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(arguments.length===4){var o=arguments[0],a=arguments[1],s=arguments[2],u=arguments[3];this.init(o,a,s,u)}},$re={serialVersionUID:{configurable:!0}};Qn.prototype.getArea=function(){return this.getWidth()*this.getHeight()};Qn.prototype.equals=function(e){if(!(e instanceof Qn))return!1;var n=e;return this.isNull()?n.isNull():this._maxx===n.getMaxX()&&this._maxy===n.getMaxY()&&this._minx===n.getMinX()&&this._miny===n.getMinY()};Qn.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new Qn;var n=this._minx>e._minx?this._minx:e._minx,r=this._miny>e._miny?this._miny:e._miny,i=this._maxx<e._maxx?this._maxx:e._maxx,o=this._maxy<e._maxy?this._maxy:e._maxy;return new Qn(n,i,r,o)};Qn.prototype.isNull=function(){return this._maxx<this._minx};Qn.prototype.getMaxX=function(){return this._maxx};Qn.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof dt){var e=arguments[0];return this.covers(e.x,e.y)}else if(arguments[0]instanceof Qn){var n=arguments[0];return this.isNull()||n.isNull()?!1:n.getMinX()>=this._minx&&n.getMaxX()<=this._maxx&&n.getMinY()>=this._miny&&n.getMaxY()<=this._maxy}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isNull()?!1:r>=this._minx&&r<=this._maxx&&i>=this._miny&&i<=this._maxy}};Qn.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof Qn){var e=arguments[0];return this.isNull()||e.isNull()?!1:!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}else if(arguments[0]instanceof dt){var n=arguments[0];return this.intersects(n.x,n.y)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isNull()?!1:!(r>this._maxx||r<this._minx||i>this._maxy||i<this._miny)}};Qn.prototype.getMinY=function(){return this._miny};Qn.prototype.getMinX=function(){return this._minx};Qn.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof dt){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof Qn){var n=arguments[0];if(n.isNull())return null;this.isNull()?(this._minx=n.getMinX(),this._maxx=n.getMaxX(),this._miny=n.getMinY(),this._maxy=n.getMaxY()):(n._minx<this._minx&&(this._minx=n._minx),n._maxx>this._maxx&&(this._maxx=n._maxx),n._miny<this._miny&&(this._miny=n._miny),n._maxy>this._maxy&&(this._maxy=n._maxy))}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.isNull()?(this._minx=r,this._maxx=r,this._miny=i,this._maxy=i):(r<this._minx&&(this._minx=r),r>this._maxx&&(this._maxx=r),i<this._miny&&(this._miny=i),i>this._maxy&&(this._maxy=i))}};Qn.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),n=this.getHeight();return e<n?e:n};Qn.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};Qn.prototype.compareTo=function(e){var n=e;return this.isNull()?n.isNull()?0:-1:n.isNull()?1:this._minx<n._minx?-1:this._minx>n._minx?1:this._miny<n._miny?-1:this._miny>n._miny?1:this._maxx<n._maxx?-1:this._maxx>n._maxx?1:this._maxy<n._maxy?-1:this._maxy>n._maxy?1:0};Qn.prototype.translate=function(e,n){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+n,this.getMaxY()+n)};Qn.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};Qn.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};Qn.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};Qn.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),n=this.getHeight();return e>n?e:n};Qn.prototype.expandBy=function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];if(this.isNull())return null;this._minx-=n,this._maxx+=n,this._miny-=r,this._maxy+=r,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};Qn.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof Qn){var e=arguments[0];return this.covers(e)}else if(arguments[0]instanceof dt){var n=arguments[0];return this.covers(n)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.covers(r,i)}};Qn.prototype.centre=function(){return this.isNull()?null:new dt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};Qn.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof dt){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof Qn){var n=arguments[0];this._minx=n._minx,this._maxx=n._maxx,this._miny=n._miny,this._maxy=n._maxy}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(arguments.length===4){var o=arguments[0],a=arguments[1],s=arguments[2],u=arguments[3];o<a?(this._minx=o,this._maxx=a):(this._minx=a,this._maxx=o),s<u?(this._miny=s,this._maxy=u):(this._miny=u,this._maxy=s)}};Qn.prototype.getMaxY=function(){return this._maxy};Qn.prototype.distance=function(e){if(this.intersects(e))return 0;var n=0;this._maxx<e._minx?n=e._minx-this._maxx:this._minx>e._maxx&&(n=this._minx-e._maxx);var r=0;return this._maxy<e._miny?r=e._miny-this._maxy:this._miny>e._maxy&&(r=this._miny-e._maxy),n===0?r:r===0?n:Math.sqrt(n*n+r*r)};Qn.prototype.hashCode=function(){var e=17;return e=37*e+dt.hashCode(this._minx),e=37*e+dt.hashCode(this._maxx),e=37*e+dt.hashCode(this._miny),e=37*e+dt.hashCode(this._maxy),e};Qn.prototype.interfaces_=function(){return[Uu,Gu]};Qn.prototype.getClass=function(){return Qn};Qn.intersects=function(){if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2];return r.x>=(e.x<n.x?e.x:n.x)&&r.x<=(e.x>n.x?e.x:n.x)&&r.y>=(e.y<n.y?e.y:n.y)&&r.y<=(e.y>n.y?e.y:n.y)}else if(arguments.length===4){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3],u=Math.min(a.x,s.x),d=Math.max(a.x,s.x),g=Math.min(i.x,o.x),_=Math.max(i.x,o.x);return!(g>d||_<u||(u=Math.min(a.y,s.y),d=Math.max(a.y,s.y),g=Math.min(i.y,o.y),_=Math.max(i.y,o.y),g>d)||_<u)}};$re.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(Qn,$re);var Jc={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},lR=function(e){this.geometryFactory=e||new kr};lR.prototype.read=function(e){var n,r,i;e=e.replace(/[\n\r]/g," ");var o=Jc.typeStr.exec(e);if(e.search("EMPTY")!==-1&&(o=Jc.emptyTypeStr.exec(e),o[2]=void 0),o&&(r=o[1].toLowerCase(),i=o[2],nv[r]&&(n=nv[r].apply(this,[i]))),n===void 0)throw new Error("Could not parse WKT "+e);return n};lR.prototype.write=function(e){return this.extractGeometry(e)};lR.prototype.extractGeometry=function(e){var n=e.getGeometryType().toLowerCase();if(!bd[n])return null;var r=n.toUpperCase(),i;return e.isEmpty()?i=r+" EMPTY":i=r+"("+bd[n].apply(this,[e])+")",i};var bd={coordinate:function(e){return e.x+" "+e.y},point:function(e){return bd.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var n=this,r=[],i=0,o=e._geometries.length;i<o;++i)r.push("("+bd.point.apply(n,[e._geometries[i]])+")");return r.join(",")},linestring:function(e){for(var n=this,r=[],i=0,o=e._points._coordinates.length;i<o;++i)r.push(bd.coordinate.apply(n,[e._points._coordinates[i]]));return r.join(",")},linearring:function(e){for(var n=this,r=[],i=0,o=e._points._coordinates.length;i<o;++i)r.push(bd.coordinate.apply(n,[e._points._coordinates[i]]));return r.join(",")},multilinestring:function(e){for(var n=this,r=[],i=0,o=e._geometries.length;i<o;++i)r.push("("+bd.linestring.apply(n,[e._geometries[i]])+")");return r.join(",")},polygon:function(e){var n=this,r=[];r.push("("+bd.linestring.apply(this,[e._shell])+")");for(var i=0,o=e._holes.length;i<o;++i)r.push("("+bd.linestring.apply(n,[e._holes[i]])+")");return r.join(",")},multipolygon:function(e){for(var n=this,r=[],i=0,o=e._geometries.length;i<o;++i)r.push("("+bd.polygon.apply(n,[e._geometries[i]])+")");return r.join(",")},geometrycollection:function(e){for(var n=this,r=[],i=0,o=e._geometries.length;i<o;++i)r.push(n.extractGeometry(e._geometries[i]));return r.join(",")}},nv={point:function(e){if(e===void 0)return this.geometryFactory.createPoint();var n=e.trim().split(Jc.spaces);return this.geometryFactory.createPoint(new dt(Number.parseFloat(n[0]),Number.parseFloat(n[1])))},multipoint:function(e){var n=this;if(e===void 0)return this.geometryFactory.createMultiPoint();for(var r,i=e.trim().split(","),o=[],a=0,s=i.length;a<s;++a)r=i[a].replace(Jc.trimParens,"$1"),o.push(nv.point.apply(n,[r]));return this.geometryFactory.createMultiPoint(o)},linestring:function(e){if(e===void 0)return this.geometryFactory.createLineString();for(var n=e.trim().split(","),r=[],i,o=0,a=n.length;o<a;++o)i=n[o].trim().split(Jc.spaces),r.push(new dt(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLineString(r)},linearring:function(e){if(e===void 0)return this.geometryFactory.createLinearRing();for(var n=e.trim().split(","),r=[],i,o=0,a=n.length;o<a;++o)i=n[o].trim().split(Jc.spaces),r.push(new dt(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(e){var n=this;if(e===void 0)return this.geometryFactory.createMultiLineString();for(var r,i=e.trim().split(Jc.parenComma),o=[],a=0,s=i.length;a<s;++a)r=i[a].replace(Jc.trimParens,"$1"),o.push(nv.linestring.apply(n,[r]));return this.geometryFactory.createMultiLineString(o)},polygon:function(e){var n=this;if(e===void 0)return this.geometryFactory.createPolygon();for(var r,i,o,a=e.trim().split(Jc.parenComma),s,u=[],d=0,g=a.length;d<g;++d)r=a[d].replace(Jc.trimParens,"$1"),i=nv.linestring.apply(n,[r]),o=n.geometryFactory.createLinearRing(i._points),d===0?s=o:u.push(o);return this.geometryFactory.createPolygon(s,u)},multipolygon:function(e){var n=this;if(e===void 0)return this.geometryFactory.createMultiPolygon();for(var r,i=e.trim().split(Jc.doubleParenComma),o=[],a=0,s=i.length;a<s;++a)r=i[a].replace(Jc.trimParens,"$1"),o.push(nv.polygon.apply(n,[r]));return this.geometryFactory.createMultiPolygon(o)},geometrycollection:function(e){var n=this;if(e===void 0)return this.geometryFactory.createGeometryCollection();e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var r=e.trim().split("|"),i=[],o=0,a=r.length;o<a;++o)i.push(n.read(r[o]));return this.geometryFactory.createGeometryCollection(i)}},xc=function(e){this.parser=new lR(e)};xc.prototype.write=function(e){return this.parser.write(e)};xc.toLineString=function(e,n){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+n.x+" "+n.y+" )"};var $d=function(t){function e(n){t.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),xI=function(t){function e(){if(t.call(this),arguments.length===0)t.call(this);else if(arguments.length===1){var n=arguments[0];t.call(this,n)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}($d),Pr=function(){};Pr.prototype.interfaces_=function(){return[]};Pr.prototype.getClass=function(){return Pr};Pr.shouldNeverReachHere=function(){if(arguments.length===0)Pr.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new xI("Should never reach here"+(e!==null?": "+e:""))}};Pr.isTrue=function(){var e,n;if(arguments.length===1)e=arguments[0],Pr.isTrue(e,null);else if(arguments.length===2&&(e=arguments[0],n=arguments[1],!e))throw n===null?new xI:new xI(n)};Pr.equals=function(){var e,n,r;if(arguments.length===2)e=arguments[0],n=arguments[1],Pr.equals(e,n,null);else if(arguments.length===3&&(e=arguments[0],n=arguments[1],r=arguments[2],!n.equals(e)))throw new xI("Expected "+e+" but encountered "+n+(r!==null?": "+r:""))};var ho=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new dt,this._intPt[1]=new dt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},g_={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};ho.prototype.getIndexAlongSegment=function(e,n){return this.computeIntLineIndex(),this._intLineIndex[e][n]};ho.prototype.getTopologySummary=function(){var e=new Df;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()};ho.prototype.computeIntersection=function(e,n,r,i){this._inputLines[0][0]=e,this._inputLines[0][1]=n,this._inputLines[1][0]=r,this._inputLines[1][1]=i,this._result=this.computeIntersect(e,n,r,i)};ho.prototype.getIntersectionNum=function(){return this._result};ho.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],n=this.getEdgeDistance(e,0),r=this.getEdgeDistance(e,1);n>r?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}};ho.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};ho.prototype.setPrecisionModel=function(e){this._precisionModel=e};ho.prototype.isInteriorIntersection=function(){var e=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var n=arguments[0],r=0;r<this._result;r++)if(!(e._intPt[r].equals2D(e._inputLines[n][0])||e._intPt[r].equals2D(e._inputLines[n][1])))return!0;return!1}};ho.prototype.getIntersection=function(e){return this._intPt[e]};ho.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};ho.prototype.hasIntersection=function(){return this._result!==ho.NO_INTERSECTION};ho.prototype.getEdgeDistance=function(e,n){var r=ho.computeEdgeDistance(this._intPt[n],this._inputLines[e][0],this._inputLines[e][1]);return r};ho.prototype.isCollinear=function(){return this._result===ho.COLLINEAR_INTERSECTION};ho.prototype.toString=function(){return xc.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+xc.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};ho.prototype.getEndpoint=function(e,n){return this._inputLines[e][n]};ho.prototype.isIntersection=function(e){for(var n=this,r=0;r<this._result;r++)if(n._intPt[r].equals2D(e))return!0;return!1};ho.prototype.getIntersectionAlongSegment=function(e,n){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][n]]};ho.prototype.interfaces_=function(){return[]};ho.prototype.getClass=function(){return ho};ho.computeEdgeDistance=function(e,n,r){var i=Math.abs(r.x-n.x),o=Math.abs(r.y-n.y),a=-1;if(e.equals(n))a=0;else if(e.equals(r))i>o?a=i:a=o;else{var s=Math.abs(e.x-n.x),u=Math.abs(e.y-n.y);i>o?a=s:a=u,a===0&&!e.equals(n)&&(a=Math.max(s,u))}return Pr.isTrue(!(a===0&&!e.equals(n)),"Bad distance calculation"),a};ho.nonRobustComputeEdgeDistance=function(e,n,r){var i=e.x-n.x,o=e.y-n.y,a=Math.sqrt(i*i+o*o);return Pr.isTrue(!(a===0&&!e.equals(n)),"Invalid distance calculation"),a};g_.DONT_INTERSECT.get=function(){return 0};g_.DO_INTERSECT.get=function(){return 1};g_.COLLINEAR.get=function(){return 2};g_.NO_INTERSECTION.get=function(){return 0};g_.POINT_INTERSECTION.get=function(){return 1};g_.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(ho,g_);var vA=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(r){var i=new Qn(this._inputLines[0][0],this._inputLines[0][1]),o=new Qn(this._inputLines[1][0],this._inputLines[1][1]);return i.contains(r)&&o.contains(r)},e.prototype.computeIntersection=function(){if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2];if(this._isProper=!1,Qn.intersects(i,o,r)&&Rn.orientationIndex(i,o,r)===0&&Rn.orientationIndex(o,i,r)===0)return this._isProper=!0,(r.equals(i)||r.equals(o))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION}else return t.prototype.computeIntersection.apply(this,arguments)},e.prototype.normalizeToMinimum=function(r,i,o,a,s){s.x=this.smallestInAbsValue(r.x,i.x,o.x,a.x),s.y=this.smallestInAbsValue(r.y,i.y,o.y,a.y),r.x-=s.x,r.y-=s.y,i.x-=s.x,i.y-=s.y,o.x-=s.x,o.y-=s.y,a.x-=s.x,a.y-=s.y},e.prototype.safeHCoordinateIntersection=function(r,i,o,a){var s=null;try{s=mc.intersection(r,i,o,a)}catch(u){if(u instanceof F1)s=e.nearestEndpoint(r,i,o,a);else throw u}finally{}return s},e.prototype.intersection=function(r,i,o,a){var s=this.intersectionWithNormalization(r,i,o,a);return this.isInSegmentEnvelopes(s)||(s=new dt(e.nearestEndpoint(r,i,o,a))),this._precisionModel!==null&&this._precisionModel.makePrecise(s),s},e.prototype.smallestInAbsValue=function(r,i,o,a){var s=r,u=Math.abs(s);return Math.abs(i)<u&&(s=i,u=Math.abs(i)),Math.abs(o)<u&&(s=o,u=Math.abs(o)),Math.abs(a)<u&&(s=a),s},e.prototype.checkDD=function(r,i,o,a,s){var u=qa.intersection(r,i,o,a),d=this.isInSegmentEnvelopes(u);qs.out.println("DD in env = "+d+"  --------------------- "+u),s.distance(u)>1e-4&&qs.out.println("Distance = "+s.distance(u))},e.prototype.intersectionWithNormalization=function(r,i,o,a){var s=new dt(r),u=new dt(i),d=new dt(o),g=new dt(a),_=new dt;this.normalizeToEnvCentre(s,u,d,g,_);var E=this.safeHCoordinateIntersection(s,u,d,g);return E.x+=_.x,E.y+=_.y,E},e.prototype.computeCollinearIntersection=function(r,i,o,a){var s=Qn.intersects(r,i,o),u=Qn.intersects(r,i,a),d=Qn.intersects(o,a,r),g=Qn.intersects(o,a,i);return s&&u?(this._intPt[0]=o,this._intPt[1]=a,t.COLLINEAR_INTERSECTION):d&&g?(this._intPt[0]=r,this._intPt[1]=i,t.COLLINEAR_INTERSECTION):s&&d?(this._intPt[0]=o,this._intPt[1]=r,o.equals(r)&&!u&&!g?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):s&&g?(this._intPt[0]=o,this._intPt[1]=i,o.equals(i)&&!u&&!d?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):u&&d?(this._intPt[0]=a,this._intPt[1]=r,a.equals(r)&&!s&&!g?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):u&&g?(this._intPt[0]=a,this._intPt[1]=i,a.equals(i)&&!s&&!d?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(r,i,o,a,s){var u=r.x<i.x?r.x:i.x,d=r.y<i.y?r.y:i.y,g=r.x>i.x?r.x:i.x,_=r.y>i.y?r.y:i.y,E=o.x<a.x?o.x:a.x,P=o.y<a.y?o.y:a.y,R=o.x>a.x?o.x:a.x,B=o.y>a.y?o.y:a.y,V=u>E?u:E,z=g<R?g:R,F=d>P?d:P,k=_<B?_:B,X=(V+z)/2,Y=(F+k)/2;s.x=X,s.y=Y,r.x-=s.x,r.y-=s.y,i.x-=s.x,i.y-=s.y,o.x-=s.x,o.y-=s.y,a.x-=s.x,a.y-=s.y},e.prototype.computeIntersect=function(r,i,o,a){if(this._isProper=!1,!Qn.intersects(r,i,o,a))return t.NO_INTERSECTION;var s=Rn.orientationIndex(r,i,o),u=Rn.orientationIndex(r,i,a);if(s>0&&u>0||s<0&&u<0)return t.NO_INTERSECTION;var d=Rn.orientationIndex(o,a,r),g=Rn.orientationIndex(o,a,i);if(d>0&&g>0||d<0&&g<0)return t.NO_INTERSECTION;var _=s===0&&u===0&&d===0&&g===0;return _?this.computeCollinearIntersection(r,i,o,a):(s===0||u===0||d===0||g===0?(this._isProper=!1,r.equals2D(o)||r.equals2D(a)?this._intPt[0]=r:i.equals2D(o)||i.equals2D(a)?this._intPt[0]=i:s===0?this._intPt[0]=new dt(o):u===0?this._intPt[0]=new dt(a):d===0?this._intPt[0]=new dt(r):g===0&&(this._intPt[0]=new dt(i))):(this._isProper=!0,this._intPt[0]=this.intersection(r,i,o,a)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(r,i,o,a){var s=r,u=Rn.distancePointLine(r,o,a),d=Rn.distancePointLine(i,o,a);return d<u&&(u=d,s=i),d=Rn.distancePointLine(o,r,i),d<u&&(u=d,s=o),d=Rn.distancePointLine(a,r,i),d<u&&(u=d,s=a),s},e}(ho),G0=function(){};G0.prototype.interfaces_=function(){return[]};G0.prototype.getClass=function(){return G0};G0.orientationIndex=function(e,n,r){var i=n.x-e.x,o=n.y-e.y,a=r.x-n.x,s=r.y-n.y;return G0.signOfDet2x2(i,o,a,s)};G0.signOfDet2x2=function(e,n,r,i){var o=null,a=null,s=null;if(o=1,e===0||i===0)return n===0||r===0?0:n>0?r>0?-o:o:r>0?o:-o;if(n===0||r===0)return i>0?e>0?o:-o:e>0?-o:o;if(n>0?i>0?n<=i||(o=-o,a=e,e=r,r=a,a=n,n=i,i=a):n<=-i?(o=-o,r=-r,i=-i):(a=e,e=-r,r=a,a=n,n=-i,i=a):i>0?-n<=i?(o=-o,e=-e,n=-n):(a=-e,e=r,r=a,a=-n,n=i,i=a):n>=i?(e=-e,n=-n,r=-r,i=-i):(o=-o,a=-e,e=-r,r=a,a=-n,n=-i,i=a),e>0)if(r>0){if(!(e<=r))return o}else return o;else{if(r>0)return-o;if(e>=r)o=-o,e=-e,r=-r;else return-o}for(;;){if(s=Math.floor(r/e),r=r-s*e,i=i-s*n,i<0)return-o;if(i>n)return o;if(e>r+r){if(n<i+i)return o}else{if(n>i+i)return-o;r=e-r,i=n-i,o=-o}if(i===0)return r===0?0:-o;if(r===0||(s=Math.floor(e/r),e=e-s*r,n=n-s*i,n<0))return o;if(n>i)return-o;if(r>e+e){if(i<n+n)return-o}else{if(i>n+n)return o;e=r-e,n=i-n,o=-o}if(n===0)return e===0?0:o;if(e===0)return-o}};var mf=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e};mf.prototype.countSegment=function(e,n){if(e.x<this._p.x&&n.x<this._p.x)return null;if(this._p.x===n.x&&this._p.y===n.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&n.y===this._p.y){var r=e.x,i=n.x;return r>i&&(r=n.x,i=e.x),this._p.x>=r&&this._p.x<=i&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&n.y<=this._p.y||n.y>this._p.y&&e.y<=this._p.y){var o=e.x-this._p.x,a=e.y-this._p.y,s=n.x-this._p.x,u=n.y-this._p.y,d=G0.signOfDet2x2(o,a,s,u);if(d===0)return this._isPointOnSegment=!0,null;u<a&&(d=-d),d>0&&this._crossingCount++}};mf.prototype.isPointInPolygon=function(){return this.getLocation()!==Et.EXTERIOR};mf.prototype.getLocation=function(){return this._isPointOnSegment?Et.BOUNDARY:this._crossingCount%2===1?Et.INTERIOR:Et.EXTERIOR};mf.prototype.isOnSegment=function(){return this._isPointOnSegment};mf.prototype.interfaces_=function(){return[]};mf.prototype.getClass=function(){return mf};mf.locatePointInRing=function(){if(arguments[0]instanceof dt&&ar(arguments[1],Yr)){for(var e=arguments[0],n=arguments[1],r=new mf(e),i=new dt,o=new dt,a=1;a<n.size();a++)if(n.getCoordinate(a,i),n.getCoordinate(a-1,o),r.countSegment(i,o),r.isOnSegment())return r.getLocation();return r.getLocation()}else if(arguments[0]instanceof dt&&arguments[1]instanceof Array){for(var s=arguments[0],u=arguments[1],d=new mf(s),g=1;g<u.length;g++){var _=u[g],E=u[g-1];if(d.countSegment(_,E),d.isOnSegment())return d.getLocation()}return d.getLocation()}};var Rn=function(){},m_={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Rn.prototype.interfaces_=function(){return[]};Rn.prototype.getClass=function(){return Rn};Rn.orientationIndex=function(e,n,r){return qa.orientationIndex(e,n,r)};Rn.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var n=0,r=e[0].x,i=1;i<e.length-1;i++){var o=e[i].x-r,a=e[i+1].y,s=e[i-1].y;n+=o*(s-a)}return n/2}else if(ar(arguments[0],Yr)){var u=arguments[0],d=u.size();if(d<3)return 0;var g=new dt,_=new dt,E=new dt;u.getCoordinate(0,_),u.getCoordinate(1,E);var P=_.x;E.x-=P;for(var R=0,B=1;B<d-1;B++)g.y=_.y,_.x=E.x,_.y=E.y,u.getCoordinate(B+1,E),E.x-=P,R+=_.x*(g.y-E.y);return R/2}};Rn.distanceLineLine=function(e,n,r,i){if(e.equals(n))return Rn.distancePointLine(e,r,i);if(r.equals(i))return Rn.distancePointLine(i,e,n);var o=!1;if(!Qn.intersects(e,n,r,i))o=!0;else{var a=(n.x-e.x)*(i.y-r.y)-(n.y-e.y)*(i.x-r.x);if(a===0)o=!0;else{var s=(e.y-r.y)*(i.x-r.x)-(e.x-r.x)*(i.y-r.y),u=(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y),d=u/a,g=s/a;(g<0||g>1||d<0||d>1)&&(o=!0)}}return o?Jl.min(Rn.distancePointLine(e,r,i),Rn.distancePointLine(n,r,i),Rn.distancePointLine(r,e,n),Rn.distancePointLine(i,e,n)):0};Rn.isPointInRing=function(e,n){return Rn.locatePointInRing(e,n)!==Et.EXTERIOR};Rn.computeLength=function(e){var n=e.size();if(n<=1)return 0;var r=0,i=new dt;e.getCoordinate(0,i);for(var o=i.x,a=i.y,s=1;s<n;s++){e.getCoordinate(s,i);var u=i.x,d=i.y,g=u-o,_=d-a;r+=Math.sqrt(g*g+_*_),o=u,a=d}return r};Rn.isCCW=function(e){var n=e.length-1;if(n<3)throw new oo("Ring has fewer than 4 points, so orientation cannot be determined");for(var r=e[0],i=0,o=1;o<=n;o++){var a=e[o];a.y>r.y&&(r=a,i=o)}var s=i;do s=s-1,s<0&&(s=n);while(e[s].equals2D(r)&&s!==i);var u=i;do u=(u+1)%n;while(e[u].equals2D(r)&&u!==i);var d=e[s],g=e[u];if(d.equals2D(r)||g.equals2D(r)||d.equals2D(g))return!1;var _=Rn.computeOrientation(d,r,g),E=!1;return _===0?E=d.x>g.x:E=_>0,E};Rn.locatePointInRing=function(e,n){return mf.locatePointInRing(e,n)};Rn.distancePointLinePerpendicular=function(e,n,r){var i=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),o=((n.y-e.y)*(r.x-n.x)-(n.x-e.x)*(r.y-n.y))/i;return Math.abs(o)*Math.sqrt(i)};Rn.computeOrientation=function(e,n,r){return Rn.orientationIndex(e,n,r)};Rn.distancePointLine=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];if(n.length===0)throw new oo("Line array must contain at least one vertex");for(var r=e.distance(n[0]),i=0;i<n.length-1;i++){var o=Rn.distancePointLine(e,n[i],n[i+1]);o<r&&(r=o)}return r}else if(arguments.length===3){var a=arguments[0],s=arguments[1],u=arguments[2];if(s.x===u.x&&s.y===u.y)return a.distance(s);var d=(u.x-s.x)*(u.x-s.x)+(u.y-s.y)*(u.y-s.y),g=((a.x-s.x)*(u.x-s.x)+(a.y-s.y)*(u.y-s.y))/d;if(g<=0)return a.distance(s);if(g>=1)return a.distance(u);var _=((s.y-a.y)*(u.x-s.x)-(s.x-a.x)*(u.y-s.y))/d;return Math.abs(_)*Math.sqrt(d)}};Rn.isOnLine=function(e,n){for(var r=new vA,i=1;i<n.length;i++){var o=n[i-1],a=n[i];if(r.computeIntersection(e,o,a),r.hasIntersection())return!0}return!1};m_.CLOCKWISE.get=function(){return-1};m_.RIGHT.get=function(){return Rn.CLOCKWISE};m_.COUNTERCLOCKWISE.get=function(){return 1};m_.LEFT.get=function(){return Rn.COUNTERCLOCKWISE};m_.COLLINEAR.get=function(){return 0};m_.STRAIGHT.get=function(){return Rn.COLLINEAR};Object.defineProperties(Rn,m_);var Hd=function(){};Hd.prototype.filter=function(e){};Hd.prototype.interfaces_=function(){return[]};Hd.prototype.getClass=function(){return Hd};var ir=function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()},Gh={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};ir.prototype.isGeometryCollection=function(){return this.getSortIndex()===ir.SORTINDEX_GEOMETRYCOLLECTION};ir.prototype.getFactory=function(){return this._factory};ir.prototype.getGeometryN=function(e){return this};ir.prototype.getArea=function(){return 0};ir.prototype.isRectangle=function(){return!1};ir.prototype.equals=function(){if(arguments[0]instanceof ir){var e=arguments[0];return e===null?!1:this.equalsTopo(e)}else if(arguments[0]instanceof Object){var n=arguments[0];if(!(n instanceof ir))return!1;var r=n;return this.equalsExact(r)}};ir.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)};ir.prototype.geometryChanged=function(){this.apply(ir.geometryChangedFilter)};ir.prototype.geometryChangedAction=function(){this._envelope=null};ir.prototype.equalsNorm=function(e){return e===null?!1:this.norm().equalsExact(e.norm())};ir.prototype.getLength=function(){return 0};ir.prototype.getNumGeometries=function(){return 1};ir.prototype.compareTo=function(){if(arguments.length===1){var e=arguments[0],n=e;return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(r,i)}};ir.prototype.getUserData=function(){return this._userData};ir.prototype.getSRID=function(){return this._SRID};ir.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};ir.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===ir.SORTINDEX_GEOMETRYCOLLECTION)throw new oo("This method does not support GeometryCollection arguments")};ir.prototype.equal=function(e,n,r){return r===0?e.equals(n):e.distance(n)<=r};ir.prototype.norm=function(){var e=this.copy();return e.normalize(),e};ir.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};ir.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Qn(this._envelope)};ir.prototype.setSRID=function(e){this._SRID=e};ir.prototype.setUserData=function(e){this._userData=e};ir.prototype.compare=function(e,n){for(var r=e.iterator(),i=n.iterator();r.hasNext()&&i.hasNext();){var o=r.next(),a=i.next(),s=o.compareTo(a);if(s!==0)return s}return r.hasNext()?1:i.hasNext()?-1:0};ir.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};ir.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===ir.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===ir.SORTINDEX_MULTIPOINT||this.getSortIndex()===ir.SORTINDEX_MULTILINESTRING||this.getSortIndex()===ir.SORTINDEX_MULTIPOLYGON};ir.prototype.interfaces_=function(){return[aR,Uu,Gu]};ir.prototype.getClass=function(){return ir};ir.hasNonEmptyElements=function(e){for(var n=0;n<e.length;n++)if(!e[n].isEmpty())return!0;return!1};ir.hasNullElements=function(e){for(var n=0;n<e.length;n++)if(e[n]===null)return!0;return!1};Gh.serialVersionUID.get=function(){return 8763622679187377e3};Gh.SORTINDEX_POINT.get=function(){return 0};Gh.SORTINDEX_MULTIPOINT.get=function(){return 1};Gh.SORTINDEX_LINESTRING.get=function(){return 2};Gh.SORTINDEX_LINEARRING.get=function(){return 3};Gh.SORTINDEX_MULTILINESTRING.get=function(){return 4};Gh.SORTINDEX_POLYGON.get=function(){return 5};Gh.SORTINDEX_MULTIPOLYGON.get=function(){return 6};Gh.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};Gh.geometryChangedFilter.get=function(){return p6};Object.defineProperties(ir,Gh);var p6=function(){};p6.interfaces_=function(){return[Hd]};p6.filter=function(e){e.geometryChangedAction()};var Ch=function(){};Ch.prototype.filter=function(e){};Ch.prototype.interfaces_=function(){return[]};Ch.prototype.getClass=function(){return Ch};var Nu=function(){},ep={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Nu.prototype.isInBoundary=function(e){};Nu.prototype.interfaces_=function(){return[]};Nu.prototype.getClass=function(){return Nu};ep.Mod2BoundaryNodeRule.get=function(){return Wv};ep.EndPointBoundaryNodeRule.get=function(){return qv};ep.MultiValentEndPointBoundaryNodeRule.get=function(){return Xv};ep.MonoValentEndPointBoundaryNodeRule.get=function(){return Zv};ep.MOD2_BOUNDARY_RULE.get=function(){return new Wv};ep.ENDPOINT_BOUNDARY_RULE.get=function(){return new qv};ep.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Xv};ep.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Zv};ep.OGC_SFS_BOUNDARY_RULE.get=function(){return Nu.MOD2_BOUNDARY_RULE};Object.defineProperties(Nu,ep);var Wv=function(){};Wv.prototype.isInBoundary=function(e){return e%2===1};Wv.prototype.interfaces_=function(){return[Nu]};Wv.prototype.getClass=function(){return Wv};var qv=function(){};qv.prototype.isInBoundary=function(e){return e>0};qv.prototype.interfaces_=function(){return[Nu]};qv.prototype.getClass=function(){return qv};var Xv=function(){};Xv.prototype.isInBoundary=function(e){return e>1};Xv.prototype.interfaces_=function(){return[Nu]};Xv.prototype.getClass=function(){return Xv};var Zv=function(){};Zv.prototype.isInBoundary=function(e){return e===1};Zv.prototype.interfaces_=function(){return[Nu]};Zv.prototype.getClass=function(){return Zv};var Jo=function(){};Jo.prototype.add=function(){};Jo.prototype.addAll=function(){};Jo.prototype.isEmpty=function(){};Jo.prototype.iterator=function(){};Jo.prototype.size=function(){};Jo.prototype.toArray=function(){};Jo.prototype.remove=function(){};function g6(t){this.message=t||""}g6.prototype=new Error;g6.prototype.name="IndexOutOfBoundsException";var k1=function(){};k1.prototype.hasNext=function(){};k1.prototype.next=function(){};k1.prototype.remove=function(){};var Ac=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(Jo);function z1(t){this.message=t||""}z1.prototype=new Error;z1.prototype.name="NoSuchElementException";var bn=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof Jo&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,Jo]},e.prototype.add=function(r){return arguments.length===1?this.array_.push(r):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(r){for(var i=this,o=r.iterator();o.hasNext();)i.add(o.next());return!0},e.prototype.set=function(r,i){var o=this.array_[r];return this.array_[r]=i,o},e.prototype.iterator=function(){return new mRe(this)},e.prototype.get=function(r){if(r<0||r>=this.size())throw new g6;return this.array_[r]},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var r=this,i=[],o=0,a=this.array_.length;o<a;o++)i.push(r.array_[o]);return i},e.prototype.remove=function(r){for(var i=this,o=!1,a=0,s=this.array_.length;a<s;a++)if(i.array_[a]===r){i.array_.splice(a,1),o=!0;break}return o},e}(Ac),mRe=function(t){function e(n){t.call(this),this.arrayList_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new z1;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(r){return this.arrayList_.set(this.position_-1,r)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(k1),YE=function(t){function e(){if(t.call(this),arguments.length!==0){if(arguments.length===1){var r=arguments[0];this.ensureCapacity(r.length),this.add(r,!0)}else if(arguments.length===2){var i=arguments[0],o=arguments[1];this.ensureCapacity(i.length),this.add(i,o)}}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(i){return this.get(i)},e.prototype.addAll=function(){var i=this;if(arguments.length===2){for(var o=arguments[0],a=arguments[1],s=!1,u=o.iterator();u.hasNext();)i.add(u.next(),a),s=!0;return s}else return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var i=this,o=t.prototype.clone.call(this),a=0;a<this.size();a++)o.add(a,i.get(a).copy());return o},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var i=this;if(arguments.length===1){var o=arguments[0];t.prototype.add.call(this,o)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var a=arguments[0],s=arguments[1];return this.add(a,s,!0),!0}else if(arguments[0]instanceof dt&&typeof arguments[1]=="boolean"){var u=arguments[0],d=arguments[1];if(!d&&this.size()>=1){var g=this.get(this.size()-1);if(g.equals2D(u))return null}t.prototype.add.call(this,u)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var _=arguments[0],E=arguments[1];return this.add(_,E),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var P=arguments[0],R=arguments[1],B=arguments[2];if(B)for(var V=0;V<P.length;V++)i.add(P[V],R);else for(var z=P.length-1;z>=0;z--)i.add(P[z],R);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof dt){var F=arguments[0],k=arguments[1],X=arguments[2];if(!X){var Y=this.size();if(Y>0){if(F>0){var J=this.get(F-1);if(J.equals2D(k))return null}if(F<Y){var ie=this.get(F);if(ie.equals2D(k))return null}}}t.prototype.add.call(this,F,k)}}else if(arguments.length===4){var ce=arguments[0],re=arguments[1],ue=arguments[2],se=arguments[3],me=1;ue>se&&(me=-1);for(var Ce=ue;Ce!==se;Ce+=me)i.add(ce[Ce],re);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new dt(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,n),e}(bn),zr=function(){},uR={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};uR.ForwardComparator.get=function(){return $w};uR.BidirectionalComparator.get=function(){return Yv};uR.coordArrayType.get=function(){return new Array(0).fill(null)};zr.prototype.interfaces_=function(){return[]};zr.prototype.getClass=function(){return zr};zr.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))};zr.ptNotInList=function(e,n){for(var r=0;r<e.length;r++){var i=e[r];if(zr.indexOf(i,n)<0)return i}return null};zr.scroll=function(e,n){var r=zr.indexOf(n,e);if(r<0)return null;var i=new Array(e.length).fill(null);qs.arraycopy(e,r,i,0,e.length-r),qs.arraycopy(e,0,i,e.length-r,r),qs.arraycopy(i,0,e,0,e.length)};zr.equals=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];if(e===n)return!0;if(e===null||n===null||e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(!e[r].equals(n[r]))return!1;return!0}else if(arguments.length===3){var i=arguments[0],o=arguments[1],a=arguments[2];if(i===o)return!0;if(i===null||o===null||i.length!==o.length)return!1;for(var s=0;s<i.length;s++)if(a.compare(i[s],o[s])!==0)return!1;return!0}};zr.intersection=function(e,n){for(var r=new YE,i=0;i<e.length;i++)n.intersects(e[i])&&r.add(e[i],!0);return r.toCoordinateArray()};zr.hasRepeatedPoints=function(e){for(var n=1;n<e.length;n++)if(e[n-1].equals(e[n]))return!0;return!1};zr.removeRepeatedPoints=function(e){if(!zr.hasRepeatedPoints(e))return e;var n=new YE(e,!1);return n.toCoordinateArray()};zr.reverse=function(e){for(var n=e.length-1,r=Math.trunc(n/2),i=0;i<=r;i++){var o=e[i];e[i]=e[n-i],e[n-i]=o}};zr.removeNull=function(e){for(var n=0,r=0;r<e.length;r++)e[r]!==null&&n++;var i=new Array(n).fill(null);if(n===0)return i;for(var o=0,a=0;a<e.length;a++)e[a]!==null&&(i[o++]=e[a]);return i};zr.copyDeep=function(){if(arguments.length===1){for(var e=arguments[0],n=new Array(e.length).fill(null),r=0;r<e.length;r++)n[r]=new dt(e[r]);return n}else if(arguments.length===5)for(var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3],u=arguments[4],d=0;d<u;d++)a[s+d]=new dt(i[o+d])};zr.isEqualReversed=function(e,n){for(var r=0;r<e.length;r++){var i=e[r],o=n[e.length-r-1];if(i.compareTo(o)!==0)return!1}return!0};zr.envelope=function(e){for(var n=new Qn,r=0;r<e.length;r++)n.expandToInclude(e[r]);return n};zr.toCoordinateArray=function(e){return e.toArray(zr.coordArrayType)};zr.atLeastNCoordinatesOrNothing=function(e,n){return n.length>=e?n:[]};zr.indexOf=function(e,n){for(var r=0;r<n.length;r++)if(e.equals(n[r]))return r;return-1};zr.increasingDirection=function(e){for(var n=0;n<Math.trunc(e.length/2);n++){var r=e.length-1-n,i=e[n].compareTo(e[r]);if(i!==0)return i}return 1};zr.compare=function(e,n){for(var r=0;r<e.length&&r<n.length;){var i=e[r].compareTo(n[r]);if(i!==0)return i;r++}return r<n.length?-1:r<e.length?1:0};zr.minCoordinate=function(e){for(var n=null,r=0;r<e.length;r++)(n===null||n.compareTo(e[r])>0)&&(n=e[r]);return n};zr.extract=function(e,n,r){n=Jl.clamp(n,0,e.length),r=Jl.clamp(r,-1,e.length);var i=r-n+1;r<0&&(i=0),n>=e.length&&(i=0),r<n&&(i=0);var o=new Array(i).fill(null);if(i===0)return o;for(var a=0,s=n;s<=r;s++)o[a++]=e[s];return o};Object.defineProperties(zr,uR);var $w=function(){};$w.prototype.compare=function(e,n){var r=e,i=n;return zr.compare(r,i)};$w.prototype.interfaces_=function(){return[$v]};$w.prototype.getClass=function(){return $w};var Yv=function(){};Yv.prototype.compare=function(e,n){var r=e,i=n;if(r.length<i.length)return-1;if(r.length>i.length)return 1;if(r.length===0)return 0;var o=zr.compare(r,i),a=zr.isEqualReversed(r,i);return a?0:o};Yv.prototype.OLDcompare=function(e,n){var r=e,i=n;if(r.length<i.length)return-1;if(r.length>i.length)return 1;if(r.length===0)return 0;for(var o=zr.increasingDirection(r),a=zr.increasingDirection(i),s=o>0?0:r.length-1,u=a>0?0:r.length-1,d=0;d<r.length;d++){var g=r[s].compareTo(i[u]);if(g!==0)return g;s+=o,u+=a}return 0};Yv.prototype.interfaces_=function(){return[$v]};Yv.prototype.getClass=function(){return Yv};var A_=function(){};A_.prototype.get=function(){};A_.prototype.put=function(){};A_.prototype.size=function(){};A_.prototype.values=function(){};A_.prototype.entrySet=function(){};var ARe=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(A_);function QE(t){this.message=t||""}QE.prototype=new Error;QE.prototype.name="OperationNotSupported";function cR(){}cR.prototype=new Jo;cR.prototype.contains=function(){};var m6=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof Jo&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(r){for(var i=this,o=0,a=this.array_.length;o<a;o++){var s=i.array_[o];if(s===r)return!0}return!1},e.prototype.add=function(r){return this.contains(r)?!1:(this.array_.push(r),!0)},e.prototype.addAll=function(r){for(var i=this,o=r.iterator();o.hasNext();)i.add(o.next());return!0},e.prototype.remove=function(r){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.toArray=function(){for(var r=this,i=[],o=0,a=this.array_.length;o<a;o++)i.push(r.array_[o]);return i},e.prototype.iterator=function(){return new _Re(this)},e}(cR),_Re=function(t){function e(n){t.call(this),this.hashSet_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new z1;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new QE},e}(k1),Sd=0,dm=1;function n7(t){return t===null?Sd:t.color}function Fi(t){return t===null?null:t.parent}function md(t,e){t!==null&&(t.color=e)}function uB(t){return t===null?null:t.left}function r7(t){return t===null?null:t.right}function aa(){this.root_=null,this.size_=0}aa.prototype=new ARe;aa.prototype.get=function(t){for(var e=this.root_;e!==null;){var n=t.compareTo(e.key);if(n<0)e=e.left;else if(n>0)e=e.right;else return e.value}return null};aa.prototype.put=function(t,e){if(this.root_===null)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Sd,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,r,i;do if(r=n,i=t.compareTo(n.key),i<0)n=n.left;else if(i>0)n=n.right;else{var o=n.value;return n.value=e,o}while(n!==null);var a={key:t,left:null,right:null,value:e,parent:r,color:Sd,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?r.left=a:r.right=a,this.fixAfterInsertion(a),this.size_++,null};aa.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=dm;t!=null&&t!==this.root_&&t.parent.color===dm;)if(Fi(t)===uB(Fi(Fi(t)))){var n=r7(Fi(Fi(t)));n7(n)===dm?(md(Fi(t),Sd),md(n,Sd),md(Fi(Fi(t)),dm),t=Fi(Fi(t))):(t===r7(Fi(t))&&(t=Fi(t),e.rotateLeft(t)),md(Fi(t),Sd),md(Fi(Fi(t)),dm),e.rotateRight(Fi(Fi(t))))}else{var r=uB(Fi(Fi(t)));n7(r)===dm?(md(Fi(t),Sd),md(r,Sd),md(Fi(Fi(t)),dm),t=Fi(Fi(t))):(t===uB(Fi(t))&&(t=Fi(t),e.rotateRight(t)),md(Fi(t),Sd),md(Fi(Fi(t)),dm),e.rotateLeft(Fi(Fi(t))))}this.root_.color=Sd};aa.prototype.values=function(){var t=new bn,e=this.getFirstEntry();if(e!==null)for(t.add(e.value);(e=aa.successor(e))!==null;)t.add(e.value);return t};aa.prototype.entrySet=function(){var t=new m6,e=this.getFirstEntry();if(e!==null)for(t.add(e);(e=aa.successor(e))!==null;)t.add(e);return t};aa.prototype.rotateLeft=function(t){if(t!=null){var e=t.right;t.right=e.left,e.left!=null&&(e.left.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}};aa.prototype.rotateRight=function(t){if(t!=null){var e=t.left;t.left=e.right,e.right!=null&&(e.right.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}};aa.prototype.getFirstEntry=function(){var t=this.root_;if(t!=null)for(;t.left!=null;)t=t.left;return t};aa.successor=function(t){if(t===null)return null;if(t.right!==null){for(var e=t.right;e.left!==null;)e=e.left;return e}else{for(var n=t.parent,r=t;n!==null&&r===n.right;)r=n,n=n.parent;return n}};aa.prototype.size=function(){return this.size_};var Hw=function(){};Hw.prototype.interfaces_=function(){return[]};Hw.prototype.getClass=function(){return Hw};function Hre(){}Hre.prototype=new cR;function wf(){this.array_=[],arguments[0]instanceof Jo&&this.addAll(arguments[0])}wf.prototype=new Hre;wf.prototype.contains=function(t){for(var e=this,n=0,r=this.array_.length;n<r;n++){var i=e.array_[n];if(i.compareTo(t)===0)return!0}return!1};wf.prototype.add=function(t){var e=this;if(this.contains(t))return!1;for(var n=0,r=this.array_.length;n<r;n++){var i=e.array_[n];if(i.compareTo(t)===1)return e.array_.splice(n,0,t),!0}return this.array_.push(t),!0};wf.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next());return!0};wf.prototype.remove=function(t){throw new QE};wf.prototype.size=function(){return this.array_.length};wf.prototype.isEmpty=function(){return this.array_.length===0};wf.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e};wf.prototype.iterator=function(){return new fR(this)};var fR=function(t){this.treeSet_=t,this.position_=0};fR.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new z1;return this.treeSet_.array_[this.position_++]};fR.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};fR.prototype.remove=function(){throw new QE};var jm=function(){};jm.sort=function(){var e=arguments[0],n,r,i,o;if(arguments.length===1)o=function(s,u){return s.compareTo(u)},e.sort(o);else if(arguments.length===2)i=arguments[1],o=function(s,u){return i.compare(s,u)},e.sort(o);else if(arguments.length===3){r=e.slice(arguments[1],arguments[2]),r.sort();var a=e.slice(0,arguments[1]).concat(r,e.slice(arguments[2],e.length));for(e.splice(0,e.length),n=0;n<a.length;n++)e.push(a[n])}else if(arguments.length===4)for(r=e.slice(arguments[1],arguments[2]),i=arguments[3],o=function(s,u){return i.compare(s,u)},r.sort(o),a=e.slice(0,arguments[1]).concat(r,e.slice(arguments[2],e.length)),e.splice(0,e.length),n=0;n<a.length;n++)e.push(a[n])};jm.asList=function(e){for(var n=new bn,r=0,i=e.length;r<i;r++)n.add(e[r]);return n};var ii=function(){},Bc={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Bc.P.get=function(){return 0};Bc.L.get=function(){return 1};Bc.A.get=function(){return 2};Bc.FALSE.get=function(){return-1};Bc.TRUE.get=function(){return-2};Bc.DONTCARE.get=function(){return-3};Bc.SYM_FALSE.get=function(){return"F"};Bc.SYM_TRUE.get=function(){return"T"};Bc.SYM_DONTCARE.get=function(){return"*"};Bc.SYM_P.get=function(){return"0"};Bc.SYM_L.get=function(){return"1"};Bc.SYM_A.get=function(){return"2"};ii.prototype.interfaces_=function(){return[]};ii.prototype.getClass=function(){return ii};ii.toDimensionSymbol=function(e){switch(e){case ii.FALSE:return ii.SYM_FALSE;case ii.TRUE:return ii.SYM_TRUE;case ii.DONTCARE:return ii.SYM_DONTCARE;case ii.P:return ii.SYM_P;case ii.L:return ii.SYM_L;case ii.A:return ii.SYM_A}throw new oo("Unknown dimension value: "+e)};ii.toDimensionValue=function(e){switch(Vw.toUpperCase(e)){case ii.SYM_FALSE:return ii.FALSE;case ii.SYM_TRUE:return ii.TRUE;case ii.SYM_DONTCARE:return ii.DONTCARE;case ii.SYM_P:return ii.P;case ii.SYM_L:return ii.L;case ii.SYM_A:return ii.A}throw new oo("Unknown dimension symbol: "+e)};Object.defineProperties(ii,Bc);var Ef=function(){};Ef.prototype.filter=function(e){};Ef.prototype.interfaces_=function(){return[]};Ef.prototype.getClass=function(){return Ef};var bc=function(){};bc.prototype.filter=function(e,n){};bc.prototype.isDone=function(){};bc.prototype.isGeometryChanged=function(){};bc.prototype.interfaces_=function(){return[]};bc.prototype.getClass=function(){return bc};var Ra=function(t){function e(r,i){if(t.call(this,i),this._geometries=r||[],t.hasNullElements(this._geometries))throw new oo("geometries must not contain null elements")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var i=this,o=new Qn,a=0;a<this._geometries.length;a++)o.expandToInclude(i._geometries[a].getEnvelopeInternal());return o},e.prototype.getGeometryN=function(i){return this._geometries[i]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var i=this,o=new Array(this.getNumPoints()).fill(null),a=-1,s=0;s<this._geometries.length;s++)for(var u=i._geometries[s].getCoordinates(),d=0;d<u.length;d++)a++,o[a]=u[d];return o},e.prototype.getArea=function(){for(var i=this,o=0,a=0;a<this._geometries.length;a++)o+=i._geometries[a].getArea();return o},e.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var o=arguments[0],a=arguments[1];if(!this.isEquivalentClass(o))return!1;var s=o;if(this._geometries.length!==s._geometries.length)return!1;for(var u=0;u<this._geometries.length;u++)if(!i._geometries[u].equalsExact(s._geometries[u],a))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var i=this,o=0;o<this._geometries.length;o++)i._geometries[o].normalize();jm.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var i=this,o=ii.FALSE,a=0;a<this._geometries.length;a++)o=Math.max(o,i._geometries[a].getBoundaryDimension());return o},e.prototype.getDimension=function(){for(var i=this,o=ii.FALSE,a=0;a<this._geometries.length;a++)o=Math.max(o,i._geometries[a].getDimension());return o},e.prototype.getLength=function(){for(var i=this,o=0,a=0;a<this._geometries.length;a++)o+=i._geometries[a].getLength();return o},e.prototype.getNumPoints=function(){for(var i=this,o=0,a=0;a<this._geometries.length;a++)o+=i._geometries[a].getNumPoints();return o},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var i=this,o=this._geometries.length,a=new Array(o).fill(null),s=0;s<this._geometries.length;s++)a[s]=i._geometries[s].reverse();return this.getFactory().createGeometryCollection(a)},e.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var o=arguments[0],a=new wf(jm.asList(this._geometries)),s=new wf(jm.asList(o._geometries));return this.compare(a,s)}else if(arguments.length===2){for(var u=arguments[0],d=arguments[1],g=u,_=this.getNumGeometries(),E=g.getNumGeometries(),P=0;P<_&&P<E;){var R=i.getGeometryN(P),B=g.getGeometryN(P),V=R.compareToSameClass(B,d);if(V!==0)return V;P++}return P<_?1:P<E?-1:0}},e.prototype.apply=function(){var i=this;if(ar(arguments[0],Ch))for(var o=arguments[0],a=0;a<this._geometries.length;a++)i._geometries[a].apply(o);else if(ar(arguments[0],bc)){var s=arguments[0];if(this._geometries.length===0)return null;for(var u=0;u<this._geometries.length&&(i._geometries[u].apply(s),!s.isDone());u++);s.isGeometryChanged()&&this.geometryChanged()}else if(ar(arguments[0],Ef)){var d=arguments[0];d.filter(this);for(var g=0;g<this._geometries.length;g++)i._geometries[g].apply(d)}else if(ar(arguments[0],Hd)){var _=arguments[0];_.filter(this);for(var E=0;E<this._geometries.length;E++)i._geometries[E].apply(_)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Pr.shouldNeverReachHere(),null},e.prototype.clone=function(){var i=this,o=t.prototype.clone.call(this);o._geometries=new Array(this._geometries.length).fill(null);for(var a=0;a<this._geometries.length;a++)o._geometries[a]=i._geometries[a].clone();return o},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var i=this,o=new Array(this._geometries.length).fill(null),a=0;a<o.length;a++)o[a]=i._geometries[a].copy();return new e(o,this._factory)},e.prototype.isEmpty=function(){for(var i=this,o=0;o<this._geometries.length;o++)if(!i._geometries[o].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(e,n),e}(ir),Jm=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ir.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],o=arguments[1];return this.isEquivalentClass(i)?t.prototype.equalsExact.call(this,i,o):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?ii.FALSE:0},e.prototype.isClosed=function(){var i=this;if(this.isEmpty())return!1;for(var o=0;o<this._geometries.length;o++)if(!i._geometries[o].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var i=this,o=this._geometries.length,a=new Array(o).fill(null),s=0;s<this._geometries.length;s++)a[o-1-s]=i._geometries[s].reverse();return this.getFactory().createMultiLineString(a)},e.prototype.getBoundary=function(){return new Ou(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var i=this,o=new Array(this._geometries.length).fill(null),a=0;a<o.length;a++)o[a]=i._geometries[a].copy();return new e(o,this._factory)},e.prototype.interfaces_=function(){return[Hw]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(e,n),e}(Ra),Ou=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var e=arguments[0],n=Nu.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=n}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this._geom=r,this._geomFact=r.getFactory(),this._bnRule=i}};Ou.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var n=this.computeBoundaryCoordinates(e);return n.length===1?this._geomFact.createPoint(n[0]):this._geomFact.createMultiPointFromCoords(n)};Ou.prototype.getBoundary=function(){return this._geom instanceof bo?this.boundaryLineString(this._geom):this._geom instanceof Jm?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};Ou.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed()){var n=this._bnRule.isInBoundary(2);return n?e.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])};Ou.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};Ou.prototype.computeBoundaryCoordinates=function(e){var n=this,r=new bn;this._endpointMap=new aa;for(var i=0;i<e.getNumGeometries();i++){var o=e.getGeometryN(i);o.getNumPoints()!==0&&(n.addEndpoint(o.getCoordinateN(0)),n.addEndpoint(o.getCoordinateN(o.getNumPoints()-1)))}for(var a=this._endpointMap.entrySet().iterator();a.hasNext();){var s=a.next(),u=s.getValue(),d=u.count;n._bnRule.isInBoundary(d)&&r.add(s.getKey())}return zr.toCoordinateArray(r)};Ou.prototype.addEndpoint=function(e){var n=this._endpointMap.get(e);n===null&&(n=new bI,this._endpointMap.put(e,n)),n.count++};Ou.prototype.interfaces_=function(){return[]};Ou.prototype.getClass=function(){return Ou};Ou.getBoundary=function(){if(arguments.length===1){var e=arguments[0],n=new Ou(e);return n.getBoundary()}else if(arguments.length===2){var r=arguments[0],i=arguments[1],o=new Ou(r,i);return o.getBoundary()}};var bI=function(){this.count=null};bI.prototype.interfaces_=function(){return[]};bI.prototype.getClass=function(){return bI};function yRe(){}function vRe(){}var xRe=function(){};function bRe(){}function wRe(){}function ERe(){}var Ru=function(){},A6={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Ru.prototype.interfaces_=function(){return[]};Ru.prototype.getClass=function(){return Ru};Ru.chars=function(e,n){for(var r=new Array(n).fill(null),i=0;i<n;i++)r[i]=e;return String(r)};Ru.getStackTrace=function(){if(arguments.length===1){var e=arguments[0],n=new bRe,r=new yRe;return e.printStackTrace(r),n.toString()}else if(arguments.length===2){var i=arguments[0],o=arguments[1],a="";new vRe(Ru.getStackTrace(i));for(var s=new ERe,u=0;u<o;u++)try{a+=s.readLine()+Ru.NEWLINE}catch(d){if(d instanceof wRe)Pr.shouldNeverReachHere();else throw d}finally{}return a}};Ru.split=function(e,n){for(var r=n.length,i=new bn,o=""+e,a=o.indexOf(n);a>=0;){var s=o.substring(0,a);i.add(s),o=o.substring(a+r),a=o.indexOf(n)}o.length>0&&i.add(o);for(var u=new Array(i.size()).fill(null),d=0;d<u.length;d++)u[d]=i.get(d);return u};Ru.toString=function(){if(arguments.length===1){var e=arguments[0];return Ru.SIMPLE_ORDINATE_FORMAT.format(e)}};Ru.spaces=function(e){return Ru.chars(" ",e)};A6.NEWLINE.get=function(){return qs.getProperty("line.separator")};A6.SIMPLE_ORDINATE_FORMAT.get=function(){return new xRe};Object.defineProperties(Ru,A6);var Ro=function(){};Ro.prototype.interfaces_=function(){return[]};Ro.prototype.getClass=function(){return Ro};Ro.copyCoord=function(e,n,r,i){for(var o=Math.min(e.getDimension(),r.getDimension()),a=0;a<o;a++)r.setOrdinate(i,a,e.getOrdinate(n,a))};Ro.isRing=function(e){var n=e.size();return n===0?!0:n<=3?!1:e.getOrdinate(0,Yr.X)===e.getOrdinate(n-1,Yr.X)&&e.getOrdinate(0,Yr.Y)===e.getOrdinate(n-1,Yr.Y)};Ro.isEqual=function(e,n){var r=e.size(),i=n.size();if(r!==i)return!1;for(var o=Math.min(e.getDimension(),n.getDimension()),a=0;a<r;a++)for(var s=0;s<o;s++){var u=e.getOrdinate(a,s),d=n.getOrdinate(a,s);if(e.getOrdinate(a,s)!==n.getOrdinate(a,s)&&!(mr.isNaN(u)&&mr.isNaN(d)))return!1}return!0};Ro.extend=function(e,n,r){var i=e.create(r,n.getDimension()),o=n.size();if(Ro.copy(n,0,i,0,o),o>0)for(var a=o;a<r;a++)Ro.copy(n,o-1,i,a,1);return i};Ro.reverse=function(e){for(var n=e.size()-1,r=Math.trunc(n/2),i=0;i<=r;i++)Ro.swap(e,i,n-i)};Ro.swap=function(e,n,r){if(n===r)return null;for(var i=0;i<e.getDimension();i++){var o=e.getOrdinate(n,i);e.setOrdinate(n,i,e.getOrdinate(r,i)),e.setOrdinate(r,i,o)}};Ro.copy=function(e,n,r,i,o){for(var a=0;a<o;a++)Ro.copyCoord(e,n+a,r,i+a)};Ro.toString=function(){if(arguments.length===1){var e=arguments[0],n=e.size();if(n===0)return"()";var r=e.getDimension(),i=new Df;i.append("(");for(var o=0;o<n;o++){o>0&&i.append(" ");for(var a=0;a<r;a++)a>0&&i.append(","),i.append(Ru.toString(e.getOrdinate(o,a)))}return i.append(")"),i.toString()}};Ro.ensureValidRing=function(e,n){var r=n.size();if(r===0)return n;if(r<=3)return Ro.createClosedRing(e,n,4);var i=n.getOrdinate(0,Yr.X)===n.getOrdinate(r-1,Yr.X)&&n.getOrdinate(0,Yr.Y)===n.getOrdinate(r-1,Yr.Y);return i?n:Ro.createClosedRing(e,n,r+1)};Ro.createClosedRing=function(e,n,r){var i=e.create(r,n.getDimension()),o=n.size();Ro.copy(n,0,i,0,o);for(var a=o;a<r;a++)Ro.copy(n,0,i,a,1);return i};var bo=function(t){function e(r,i){t.call(this,i),this._points=null,this.init(r)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Qn:this._points.expandEnvelope(new Qn)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var o=arguments[0],a=arguments[1];if(!this.isEquivalentClass(o))return!1;var s=o;if(this._points.size()!==s._points.size())return!1;for(var u=0;u<this._points.size();u++)if(!i.equal(i._points.getCoordinate(u),s._points.getCoordinate(u),a))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var i=this,o=0;o<Math.trunc(this._points.size()/2);o++){var a=i._points.size()-1-o;if(!i._points.getCoordinate(o).equals(i._points.getCoordinate(a)))return i._points.getCoordinate(o).compareTo(i._points.getCoordinate(a))>0&&Ro.reverse(i._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?ii.FALSE:0},e.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return Rn.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var i=this._points.copy();Ro.reverse(i);var o=this.getFactory().createLineString(i);return o},e.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){for(var o=arguments[0],a=o,s=0,u=0;s<this._points.size()&&u<a._points.size();){var d=i._points.getCoordinate(s).compareTo(a._points.getCoordinate(u));if(d!==0)return d;s++,u++}return s<this._points.size()?1:u<a._points.size()?-1:0}else if(arguments.length===2){var g=arguments[0],_=arguments[1],E=g;return _.compare(this._points,E._points)}},e.prototype.apply=function(){var i=this;if(ar(arguments[0],Ch))for(var o=arguments[0],a=0;a<this._points.size();a++)o.filter(i._points.getCoordinate(a));else if(ar(arguments[0],bc)){var s=arguments[0];if(this._points.size()===0)return null;for(var u=0;u<this._points.size()&&(s.filter(i._points,u),!s.isDone());u++);s.isGeometryChanged()&&this.geometryChanged()}else if(ar(arguments[0],Ef)){var d=arguments[0];d.filter(this)}else if(ar(arguments[0],Hd)){var g=arguments[0];g.filter(this)}},e.prototype.getBoundary=function(){return new Ou(this).getBoundary()},e.prototype.isEquivalentClass=function(i){return i instanceof e},e.prototype.clone=function(){var i=t.prototype.clone.call(this);return i._points=this._points.clone(),i},e.prototype.getCoordinateN=function(i){return this._points.getCoordinate(i)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return this._points.size()===0},e.prototype.init=function(i){if(i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),i.size()===1)throw new oo("Invalid number of points in LineString (found "+i.size()+" - must be 0 or >= 2)");this._points=i},e.prototype.isCoordinate=function(i){for(var o=this,a=0;a<this._points.size();a++)if(o._points.getCoordinate(a).equals(i))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(i){return this.getFactory().createPoint(this._points.getCoordinate(i))},e.prototype.interfaces_=function(){return[Hw]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,n),e}(ir),Ww=function(){};Ww.prototype.interfaces_=function(){return[]};Ww.prototype.getClass=function(){return Ww};var Il=function(t){function e(r,i){t.call(this,i),this._coordinates=r||null,this.init(this._coordinates)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Qn;var i=new Qn;return i.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),i},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],o=arguments[1];return this.isEquivalentClass(i)?this.isEmpty()&&i.isEmpty()?!0:this.isEmpty()!==i.isEmpty()?!1:this.equal(i.getCoordinate(),this.getCoordinate(),o):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return ii.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(arguments.length===1){var i=arguments[0],o=i;return this.getCoordinate().compareTo(o.getCoordinate())}else if(arguments.length===2){var a=arguments[0],s=arguments[1],u=a;return s.compare(this._coordinates,u._coordinates)}},e.prototype.apply=function(){if(ar(arguments[0],Ch)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this.getCoordinate())}else if(ar(arguments[0],bc)){var o=arguments[0];if(this.isEmpty())return null;o.filter(this._coordinates,0),o.isGeometryChanged()&&this.geometryChanged()}else if(ar(arguments[0],Ef)){var a=arguments[0];a.filter(this)}else if(ar(arguments[0],Hd)){var s=arguments[0];s.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var i=t.prototype.clone.call(this);return i._coordinates=this._coordinates.clone(),i},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return this._coordinates.size()===0},e.prototype.init=function(i){i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),Pr.isTrue(i.size()<=1),this._coordinates=i},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Ww]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(e,n),e}(ir),cg=function(){};cg.prototype.interfaces_=function(){return[]};cg.prototype.getClass=function(){return cg};var us=function(t){function e(r,i,o){if(t.call(this,o),this._shell=null,this._holes=null,r===null&&(r=this.getFactory().createLinearRing()),i===null&&(i=[]),t.hasNullElements(i))throw new oo("holes must not contain null elements");if(r.isEmpty()&&t.hasNonEmptyElements(i))throw new oo("shell is empty but holes are not");this._shell=r,this._holes=i}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){var i=this;if(this.isEmpty())return[];for(var o=new Array(this.getNumPoints()).fill(null),a=-1,s=this._shell.getCoordinates(),u=0;u<s.length;u++)a++,o[a]=s[u];for(var d=0;d<this._holes.length;d++)for(var g=i._holes[d].getCoordinates(),_=0;_<g.length;_++)a++,o[a]=g[_];return o},e.prototype.getArea=function(){var i=this,o=0;o+=Math.abs(Rn.signedArea(this._shell.getCoordinateSequence()));for(var a=0;a<this._holes.length;a++)o-=Math.abs(Rn.signedArea(i._holes[a].getCoordinateSequence()));return o},e.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var i=this._shell.getCoordinateSequence(),o=this.getEnvelopeInternal(),a=0;a<5;a++){var s=i.getX(a);if(!(s===o.getMinX()||s===o.getMaxX()))return!1;var u=i.getY(a);if(!(u===o.getMinY()||u===o.getMaxY()))return!1}for(var d=i.getX(0),g=i.getY(0),_=1;_<=4;_++){var E=i.getX(_),P=i.getY(_),R=E!==d,B=P!==g;if(R===B)return!1;d=E,g=P}return!0},e.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var o=arguments[0],a=arguments[1];if(!this.isEquivalentClass(o))return!1;var s=o,u=this._shell,d=s._shell;if(!u.equalsExact(d,a)||this._holes.length!==s._holes.length)return!1;for(var g=0;g<this._holes.length;g++)if(!i._holes[g].equalsExact(s._holes[g],a))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var i=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var o=0;o<this._holes.length;o++)i.normalize(i._holes[o],!1);jm.sort(this._holes)}else if(arguments.length===2){var a=arguments[0],s=arguments[1];if(a.isEmpty())return null;var u=new Array(a.getCoordinates().length-1).fill(null);qs.arraycopy(a.getCoordinates(),0,u,0,u.length);var d=zr.minCoordinate(a.getCoordinates());zr.scroll(u,d),qs.arraycopy(u,0,a.getCoordinates(),0,u.length),a.getCoordinates()[u.length]=u[0],Rn.isCCW(a.getCoordinates())===s&&zr.reverse(a.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var i=this,o=0;o+=this._shell.getLength();for(var a=0;a<this._holes.length;a++)o+=i._holes[a].getLength();return o},e.prototype.getNumPoints=function(){for(var i=this,o=this._shell.getNumPoints(),a=0;a<this._holes.length;a++)o+=i._holes[a].getNumPoints();return o},e.prototype.reverse=function(){var i=this,o=this.copy();o._shell=this._shell.copy().reverse(),o._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)o._holes[a]=i._holes[a].copy().reverse();return o},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var o=arguments[0],a=this._shell,s=o._shell;return a.compareToSameClass(s)}else if(arguments.length===2){var u=arguments[0],d=arguments[1],g=u,_=this._shell,E=g._shell,P=_.compareToSameClass(E,d);if(P!==0)return P;for(var R=this.getNumInteriorRing(),B=g.getNumInteriorRing(),V=0;V<R&&V<B;){var z=i.getInteriorRingN(V),F=g.getInteriorRingN(V),k=z.compareToSameClass(F,d);if(k!==0)return k;V++}return V<R?1:V<B?-1:0}},e.prototype.apply=function(i){var o=this;if(ar(i,Ch)){this._shell.apply(i);for(var a=0;a<this._holes.length;a++)o._holes[a].apply(i)}else if(ar(i,bc)){if(this._shell.apply(i),!i.isDone())for(var s=0;s<this._holes.length&&(o._holes[s].apply(i),!i.isDone());s++);i.isGeometryChanged()&&this.geometryChanged()}else if(ar(i,Ef))i.filter(this);else if(ar(i,Hd)){i.filter(this),this._shell.apply(i);for(var u=0;u<this._holes.length;u++)o._holes[u].apply(i)}},e.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var o=new Array(this._holes.length+1).fill(null);o[0]=this._shell;for(var a=0;a<this._holes.length;a++)o[a+1]=i._holes[a];return o.length<=1?this.getFactory().createLinearRing(o[0].getCoordinateSequence()):this.getFactory().createMultiLineString(o)},e.prototype.clone=function(){var i=this,o=t.prototype.clone.call(this);o._shell=this._shell.clone(),o._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)o._holes[a]=i._holes[a].clone();return o},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var i=this,o=this._shell.copy(),a=new Array(this._holes.length).fill(null),s=0;s<a.length;s++)a[s]=i._holes[s].copy();return new e(o,a,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(i){return this._holes[i]},e.prototype.interfaces_=function(){return[cg]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,n),e}(ir),Qv=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ir.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],o=arguments[1];return this.isEquivalentClass(i)?t.prototype.equalsExact.call(this,i,o):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(arguments.length===1){var i=arguments[0];return this._geometries[i].getCoordinate()}else return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return ii.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var i=this,o=new Array(this._geometries.length).fill(null),a=0;a<o.length;a++)o[a]=i._geometries[a].copy();return new e(o,this._factory)},e.prototype.interfaces_=function(){return[Ww]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(e,n),e}(Ra),Ph=function(t){function e(r,i){r instanceof dt&&i instanceof kr&&(r=i.getCoordinateSequenceFactory().create(r)),t.call(this,r,i),this.validateConstruction()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ir.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return ii.FALSE},e.prototype.isClosed=function(){return this.isEmpty()?!0:t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var i=this._points.copy();Ro.reverse(i);var o=this.getFactory().createLinearRing(i);return o},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new oo("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new oo("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,n),e}(bo),yh=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ir.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],o=arguments[1];return this.isEquivalentClass(i)?t.prototype.equalsExact.call(this,i,o):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var i=this,o=this._geometries.length,a=new Array(o).fill(null),s=0;s<this._geometries.length;s++)a[s]=i._geometries[s].reverse();return this.getFactory().createMultiPolygon(a)},e.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var o=new bn,a=0;a<this._geometries.length;a++)for(var s=i._geometries[a],u=s.getBoundary(),d=0;d<u.getNumGeometries();d++)o.add(u.getGeometryN(d));var g=new Array(o.size()).fill(null);return this.getFactory().createMultiLineString(o.toArray(g))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var i=this,o=new Array(this._geometries.length).fill(null),a=0;a<o.length;a++)o[a]=i._geometries[a].copy();return new e(o,this._factory)},e.prototype.interfaces_=function(){return[cg]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,n),e}(Ra),Fu=function(e){this._factory=e||null,this._isUserDataCopied=!1},hR={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Fu.prototype.setCopyUserData=function(e){this._isUserDataCopied=e};Fu.prototype.edit=function(e,n){if(e===null)return null;var r=this.editInternal(e,n);return this._isUserDataCopied&&r.setUserData(e.getUserData()),r};Fu.prototype.editInternal=function(e,n){return this._factory===null&&(this._factory=e.getFactory()),e instanceof Ra?this.editGeometryCollection(e,n):e instanceof us?this.editPolygon(e,n):e instanceof Il?n.edit(e,this._factory):e instanceof bo?n.edit(e,this._factory):(Pr.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)};Fu.prototype.editGeometryCollection=function(e,n){for(var r=this,i=n.edit(e,this._factory),o=new bn,a=0;a<i.getNumGeometries();a++){var s=r.edit(i.getGeometryN(a),n);s===null||s.isEmpty()||o.add(s)}return i.getClass()===Qv?this._factory.createMultiPoint(o.toArray([])):i.getClass()===Jm?this._factory.createMultiLineString(o.toArray([])):i.getClass()===yh?this._factory.createMultiPolygon(o.toArray([])):this._factory.createGeometryCollection(o.toArray([]))};Fu.prototype.editPolygon=function(e,n){var r=this,i=n.edit(e,this._factory);if(i===null&&(i=this._factory.createPolygon(null)),i.isEmpty())return i;var o=this.edit(i.getExteriorRing(),n);if(o===null||o.isEmpty())return this._factory.createPolygon();for(var a=new bn,s=0;s<i.getNumInteriorRing();s++){var u=r.edit(i.getInteriorRingN(s),n);u===null||u.isEmpty()||a.add(u)}return this._factory.createPolygon(o,a.toArray([]))};Fu.prototype.interfaces_=function(){return[]};Fu.prototype.getClass=function(){return Fu};Fu.GeometryEditorOperation=function(){};hR.NoOpGeometryOperation.get=function(){return qw};hR.CoordinateOperation.get=function(){return Xw};hR.CoordinateSequenceOperation.get=function(){return Zw};Object.defineProperties(Fu,hR);var qw=function(){};qw.prototype.edit=function(e,n){return e};qw.prototype.interfaces_=function(){return[Fu.GeometryEditorOperation]};qw.prototype.getClass=function(){return qw};var Xw=function(){};Xw.prototype.edit=function(e,n){var r=this.editCoordinates(e.getCoordinates(),e);return r===null?e:e instanceof Ph?n.createLinearRing(r):e instanceof bo?n.createLineString(r):e instanceof Il?r.length>0?n.createPoint(r[0]):n.createPoint():e};Xw.prototype.interfaces_=function(){return[Fu.GeometryEditorOperation]};Xw.prototype.getClass=function(){return Xw};var Zw=function(){};Zw.prototype.edit=function(e,n){return e instanceof Ph?n.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof bo?n.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof Il?n.createPoint(this.edit(e.getCoordinateSequence(),e)):e};Zw.prototype.interfaces_=function(){return[Fu.GeometryEditorOperation]};Zw.prototype.getClass=function(){return Zw};var Mo=function(){var e=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var n=arguments[0];this._coordinates=new Array(n).fill(null);for(var r=0;r<n;r++)e._coordinates[r]=new dt}else if(ar(arguments[0],Yr)){var i=arguments[0];if(i===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null);for(var o=0;o<this._coordinates.length;o++)e._coordinates[o]=i.getCoordinateCopy(o)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var a=arguments[0],s=arguments[1];this._coordinates=a,this._dimension=s,a===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],d=arguments[1];this._coordinates=new Array(u).fill(null),this._dimension=d;for(var g=0;g<u;g++)e._coordinates[g]=new dt}}},Wre={serialVersionUID:{configurable:!0}};Mo.prototype.setOrdinate=function(e,n,r){switch(n){case Yr.X:this._coordinates[e].x=r;break;case Yr.Y:this._coordinates[e].y=r;break;case Yr.Z:this._coordinates[e].z=r;break;default:throw new oo("invalid ordinateIndex")}};Mo.prototype.size=function(){return this._coordinates.length};Mo.prototype.getOrdinate=function(e,n){switch(n){case Yr.X:return this._coordinates[e].x;case Yr.Y:return this._coordinates[e].y;case Yr.Z:return this._coordinates[e].z}return mr.NaN};Mo.prototype.getCoordinate=function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}else if(arguments.length===2){var n=arguments[0],r=arguments[1];r.x=this._coordinates[n].x,r.y=this._coordinates[n].y,r.z=this._coordinates[n].z}};Mo.prototype.getCoordinateCopy=function(e){return new dt(this._coordinates[e])};Mo.prototype.getDimension=function(){return this._dimension};Mo.prototype.getX=function(e){return this._coordinates[e].x};Mo.prototype.clone=function(){for(var e=this,n=new Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)n[r]=e._coordinates[r].clone();return new Mo(n,this._dimension)};Mo.prototype.expandEnvelope=function(e){for(var n=this,r=0;r<this._coordinates.length;r++)e.expandToInclude(n._coordinates[r]);return e};Mo.prototype.copy=function(){for(var e=this,n=new Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)n[r]=e._coordinates[r].copy();return new Mo(n,this._dimension)};Mo.prototype.toString=function(){var e=this;if(this._coordinates.length>0){var n=new Df(17*this._coordinates.length);n.append("("),n.append(this._coordinates[0]);for(var r=1;r<this._coordinates.length;r++)n.append(", "),n.append(e._coordinates[r]);return n.append(")"),n.toString()}else return"()"};Mo.prototype.getY=function(e){return this._coordinates[e].y};Mo.prototype.toCoordinateArray=function(){return this._coordinates};Mo.prototype.interfaces_=function(){return[Yr,Gu]};Mo.prototype.getClass=function(){return Mo};Wre.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(Mo,Wre);var Ih=function(){},_6={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Ih.prototype.readResolve=function(){return Ih.instance()};Ih.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new Mo(e)}else if(ar(arguments[0],Yr)){var n=arguments[0];return new Mo(n)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return i>3&&(i=3),i<2?new Mo(r):new Mo(r,i)}};Ih.prototype.interfaces_=function(){return[Hv,Gu]};Ih.prototype.getClass=function(){return Ih};Ih.instance=function(){return Ih.instanceObject};_6.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};_6.instanceObject.get=function(){return new Ih};Object.defineProperties(Ih,_6);var qre=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(r){return this.map_.get(r)||null},e.prototype.put=function(r,i){return this.map_.set(r,i),i},e.prototype.values=function(){for(var r=new bn,i=this.map_.values(),o=i.next();!o.done;)r.add(o.value),o=i.next();return r},e.prototype.entrySet=function(){var r=new m6;return this.map_.entries().forEach(function(i){return r.add(i)}),r},e.prototype.size=function(){return this.map_.size()},e}(A_),si=function t(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=t.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Sf){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=t.FIXED,this.setScale(n)}else if(arguments[0]instanceof t){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}},y6={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};si.prototype.equals=function(e){if(!(e instanceof si))return!1;var n=e;return this._modelType===n._modelType&&this._scale===n._scale};si.prototype.compareTo=function(e){var n=e,r=this.getMaximumSignificantDigits(),i=n.getMaximumSignificantDigits();return new bf(r).compareTo(new bf(i))};si.prototype.getScale=function(){return this._scale};si.prototype.isFloating=function(){return this._modelType===si.FLOATING||this._modelType===si.FLOATING_SINGLE};si.prototype.getType=function(){return this._modelType};si.prototype.toString=function(){var e="UNKNOWN";return this._modelType===si.FLOATING?e="Floating":this._modelType===si.FLOATING_SINGLE?e="Floating-Single":this._modelType===si.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e};si.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var e=arguments[0];if(mr.isNaN(e))return e;if(this._modelType===si.FLOATING_SINGLE){var n=e;return n}return this._modelType===si.FIXED?Math.round(e*this._scale)/this._scale:e}else if(arguments[0]instanceof dt){var r=arguments[0];if(this._modelType===si.FLOATING)return null;r.x=this.makePrecise(r.x),r.y=this.makePrecise(r.y)}};si.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===si.FLOATING?e=16:this._modelType===si.FLOATING_SINGLE?e=6:this._modelType===si.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e};si.prototype.setScale=function(e){this._scale=Math.abs(e)};si.prototype.interfaces_=function(){return[Gu,Uu]};si.prototype.getClass=function(){return si};si.mostPrecise=function(e,n){return e.compareTo(n)>=0?e:n};y6.serialVersionUID.get=function(){return 7777263578777804e3};y6.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(si,y6);var Sf=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},v6={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Sf.prototype.readResolve=function(){return Sf.nameToTypeMap.get(this._name)};Sf.prototype.toString=function(){return this._name};Sf.prototype.interfaces_=function(){return[Gu]};Sf.prototype.getClass=function(){return Sf};v6.serialVersionUID.get=function(){return-552860263173159e4};v6.nameToTypeMap.get=function(){return new qre};Object.defineProperties(Sf,v6);si.Type=Sf;si.FIXED=new Sf("FIXED");si.FLOATING=new Sf("FLOATING");si.FLOATING_SINGLE=new Sf("FLOATING SINGLE");var kr=function t(){this._precisionModel=new si,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?ar(arguments[0],Hv)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof si&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},Xre={serialVersionUID:{configurable:!0}};kr.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new dt(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new dt(e.getMinX(),e.getMinY()),new dt(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new dt(e.getMinX(),e.getMinY()),new dt(e.getMinX(),e.getMaxY()),new dt(e.getMaxX(),e.getMaxY()),new dt(e.getMaxX(),e.getMinY()),new dt(e.getMinX(),e.getMinY())]),null)};kr.prototype.createLineString=function(e){if(e){if(e instanceof Array)return new bo(this.getCoordinateSequenceFactory().create(e),this);if(ar(e,Yr))return new bo(e,this)}else return new bo(this.getCoordinateSequenceFactory().create([]),this)};kr.prototype.createMultiLineString=function(){if(arguments.length===0)return new Jm(null,this);if(arguments.length===1){var e=arguments[0];return new Jm(e,this)}};kr.prototype.buildGeometry=function(e){for(var n=null,r=!1,i=!1,o=e.iterator();o.hasNext();){var a=o.next(),s=a.getClass();n===null&&(n=s),s!==n&&(r=!0),a.isGeometryCollectionOrDerived()&&(i=!0)}if(n===null)return this.createGeometryCollection();if(r||i)return this.createGeometryCollection(kr.toGeometryArray(e));var u=e.iterator().next(),d=e.size()>1;if(d){if(u instanceof us)return this.createMultiPolygon(kr.toPolygonArray(e));if(u instanceof bo)return this.createMultiLineString(kr.toLineStringArray(e));if(u instanceof Il)return this.createMultiPoint(kr.toPointArray(e));Pr.shouldNeverReachHere("Unhandled class: "+u.getClass().getName())}return u};kr.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)};kr.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof dt){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}else if(ar(arguments[0],Yr)){var n=arguments[0];return new Il(n,this)}}};kr.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};kr.prototype.createPolygon=function(){if(arguments.length===0)return new us(null,null,this);if(arguments.length===1){if(ar(arguments[0],Yr)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createPolygon(this.createLinearRing(n))}else if(arguments[0]instanceof Ph){var r=arguments[0];return this.createPolygon(r,null)}}else if(arguments.length===2){var i=arguments[0],o=arguments[1];return new us(i,o,this)}};kr.prototype.getSRID=function(){return this._SRID};kr.prototype.createGeometryCollection=function(){if(arguments.length===0)return new Ra(null,this);if(arguments.length===1){var e=arguments[0];return new Ra(e,this)}};kr.prototype.createGeometry=function(e){var n=new Fu(this);return n.edit(e,{edit:function(){if(arguments.length===2){var r=arguments[0];return this._coordinateSequenceFactory.create(r)}}})};kr.prototype.getPrecisionModel=function(){return this._precisionModel};kr.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}else if(ar(arguments[0],Yr)){var n=arguments[0];return new Ph(n,this)}}};kr.prototype.createMultiPolygon=function(){if(arguments.length===0)return new yh(null,this);if(arguments.length===1){var e=arguments[0];return new yh(e,this)}};kr.prototype.createMultiPoint=function(){var e=this;if(arguments.length===0)return new Qv(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];return new Qv(n,this)}else if(arguments[0]instanceof Array){var r=arguments[0];return this.createMultiPoint(r!==null?this.getCoordinateSequenceFactory().create(r):null)}else if(ar(arguments[0],Yr)){var i=arguments[0];if(i===null)return this.createMultiPoint(new Array(0).fill(null));for(var o=new Array(i.size()).fill(null),a=0;a<i.size();a++){var s=e.getCoordinateSequenceFactory().create(1,i.getDimension());Ro.copy(i,a,s,0,1),o[a]=e.createPoint(s)}return this.createMultiPoint(o)}}};kr.prototype.interfaces_=function(){return[Gu]};kr.prototype.getClass=function(){return kr};kr.toMultiPolygonArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};kr.toGeometryArray=function(e){if(e===null)return null;var n=new Array(e.size()).fill(null);return e.toArray(n)};kr.getDefaultCoordinateSequenceFactory=function(){return Ih.instance()};kr.toMultiLineStringArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};kr.toLineStringArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};kr.toMultiPointArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};kr.toLinearRingArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};kr.toPointArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};kr.toPolygonArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};kr.createPointFromInternalCoord=function(e,n){return n.getPrecisionModel().makePrecise(e),n.getFactory().createPoint(e)};Xre.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(kr,Xre);var SRe=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],dR=function(e){this.geometryFactory=e||new kr};dR.prototype.read=function(e){var n;typeof e=="string"?n=JSON.parse(e):n=e;var r=n.type;if(!nf[r])throw new Error("Unknown GeoJSON type: "+n.type);return SRe.indexOf(r)!==-1?nf[r].apply(this,[n.coordinates]):r==="GeometryCollection"?nf[r].apply(this,[n.geometries]):nf[r].apply(this,[n])};dR.prototype.write=function(e){var n=e.getGeometryType();if(!wd[n])throw new Error("Geometry is not supported");return wd[n].apply(this,[e])};var nf={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var r=t.geometry.type;if(!nf[r])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=nf.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e=this,n={};if(t.features){n.features=[];for(var r=0;r<t.features.length;++r)n.features.push(e.read(t.features[r]))}return t.bbox&&(n.bbox=this.parse.bbox.apply(this,[t.bbox])),n},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(new dt(r[0],r[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new dt(t[0],t[1]),new dt(t[2],t[1]),new dt(t[2],t[3]),new dt(t[0],t[3]),new dt(t[0],t[1])])},Point:function(t){var e=new dt(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=this,n=[],r=0;r<t.length;++r)n.push(nf.Point.apply(e,[t[r]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(t){var e=nf.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=this,n=[],r=0;r<t.length;++r)n.push(nf.LineString.apply(e,[t[r]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(t){for(var e=this,n=nf.coordinates.apply(this,[t[0]]),r=this.geometryFactory.createLinearRing(n),i=[],o=1;o<t.length;++o){var a=t[o],s=nf.coordinates.apply(e,[a]),u=e.geometryFactory.createLinearRing(s);i.push(u)}return this.geometryFactory.createPolygon(r,i)},MultiPolygon:function(t){for(var e=this,n=[],r=0;r<t.length;++r){var i=t[r];n.push(nf.Polygon.apply(e,[i]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(t){for(var e=this,n=[],r=0;r<t.length;++r){var i=t[r];n.push(e.read(i))}return this.geometryFactory.createGeometryCollection(n)}},wd={coordinate:function(t){return[t.x,t.y]},Point:function(t){var e=wd.coordinate.apply(this,[t.getCoordinate()]);return{type:"Point",coordinates:e}},MultiPoint:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],o=wd.Point.apply(e,[i]);n.push(o.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(t){for(var e=this,n=[],r=t.getCoordinates(),i=0;i<r.length;++i){var o=r[i];n.push(wd.coordinate.apply(e,[o]))}return{type:"LineString",coordinates:n}},MultiLineString:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],o=wd.LineString.apply(e,[i]);n.push(o.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(t){var e=this,n=[],r=wd.LineString.apply(this,[t._shell]);n.push(r.coordinates);for(var i=0;i<t._holes.length;++i){var o=t._holes[i],a=wd.LineString.apply(e,[o]);n.push(a.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],o=wd.Polygon.apply(e,[i]);n.push(o.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],o=i.getGeometryType();n.push(wd[o].apply(e,[i]))}return{type:"GeometryCollection",geometries:n}}},x6=function(e){this.geometryFactory=e||new kr,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new dR(this.geometryFactory)};x6.prototype.read=function(e){var n=this.parser.read(e);return this.precisionModel.getType()===si.FIXED&&this.reducePrecision(n),n};x6.prototype.reducePrecision=function(e){var n=this,r,i;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(r=0,i=e.points.length;r<i;r++)n.precisionModel.makePrecise(e.points[r]);else if(e.geometries)for(r=0,i=e.geometries.length;r<i;r++)n.reducePrecision(e.geometries[r])};var Zre=function(){this.parser=new dR(this.geometryFactory)};Zre.prototype.write=function(e){return this.parser.write(e)};var gn=function(){},pR={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};gn.prototype.interfaces_=function(){return[]};gn.prototype.getClass=function(){return gn};gn.opposite=function(e){return e===gn.LEFT?gn.RIGHT:e===gn.RIGHT?gn.LEFT:e};pR.ON.get=function(){return 0};pR.LEFT.get=function(){return 1};pR.RIGHT.get=function(){return 2};Object.defineProperties(gn,pR);function gR(t){this.message=t||""}gR.prototype=new Error;gR.prototype.name="EmptyStackException";function Bf(){this.array_=[]}Bf.prototype=new Ac;Bf.prototype.add=function(t){return this.array_.push(t),!0};Bf.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]};Bf.prototype.push=function(t){return this.array_.push(t),t};Bf.prototype.pop=function(t){if(this.array_.length===0)throw new gR;return this.array_.pop()};Bf.prototype.peek=function(){if(this.array_.length===0)throw new gR;return this.array_[this.array_.length-1]};Bf.prototype.empty=function(){return this.array_.length===0};Bf.prototype.isEmpty=function(){return this.empty()};Bf.prototype.search=function(t){return this.array_.indexOf(t)};Bf.prototype.size=function(){return this.array_.length};Bf.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e};var Tf=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Tf.prototype.getCoordinate=function(){return this._minCoord};Tf.prototype.getRightmostSide=function(e,n){var r=this.getRightmostSideOfSegment(e,n);return r<0&&(r=this.getRightmostSideOfSegment(e,n-1)),r<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),r};Tf.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();Pr.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var n=e[this._minIndex-1],r=e[this._minIndex+1],i=Rn.computeOrientation(this._minCoord,r,n),o=!1;(n.y<this._minCoord.y&&r.y<this._minCoord.y&&i===Rn.COUNTERCLOCKWISE||n.y>this._minCoord.y&&r.y>this._minCoord.y&&i===Rn.CLOCKWISE)&&(o=!0),o&&(this._minIndex=this._minIndex-1)};Tf.prototype.getRightmostSideOfSegment=function(e,n){var r=e.getEdge(),i=r.getCoordinates();if(n<0||n+1>=i.length||i[n].y===i[n+1].y)return-1;var o=gn.LEFT;return i[n].y<i[n+1].y&&(o=gn.RIGHT),o};Tf.prototype.getEdge=function(){return this._orientedDe};Tf.prototype.checkForRightmostCoordinate=function(e){for(var n=this,r=e.getEdge().getCoordinates(),i=0;i<r.length-1;i++)(n._minCoord===null||r[i].x>n._minCoord.x)&&(n._minDe=e,n._minIndex=i,n._minCoord=r[i])};Tf.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode(),n=e.getEdges();this._minDe=n.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};Tf.prototype.findEdge=function(e){for(var n=this,r=e.iterator();r.hasNext();){var i=r.next();i.isForward()&&n.checkForRightmostCoordinate(i)}Pr.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var o=this.getRightmostSide(this._minDe,this._minIndex);o===gn.LEFT&&(this._orientedDe=this._minDe.getSym())};Tf.prototype.interfaces_=function(){return[]};Tf.prototype.getClass=function(){return Tf};var Wd=function(t){function e(n,r){t.call(this,e.msgWithCoord(n,r)),this.pt=r?new dt(r):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(r,i){return i?r:r+" [ "+i+" ]"},e}($d),mR=function(){this.array_=[]};mR.prototype.addLast=function(e){this.array_.push(e)};mR.prototype.removeFirst=function(){return this.array_.shift()};mR.prototype.isEmpty=function(){return this.array_.length===0};var La=function(){this._finder=null,this._dirEdgeList=new bn,this._nodes=new bn,this._rightMostCoord=null,this._env=null,this._finder=new Tf};La.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var n=e.next();n.setVisited(!1)}};La.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};La.prototype.computeNodeDepth=function(e){for(var n=this,r=null,i=e.getEdges().iterator();i.hasNext();){var o=i.next();if(o.isVisited()||o.getSym().isVisited()){r=o;break}}if(r===null)throw new Wd("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(r);for(var a=e.getEdges().iterator();a.hasNext();){var s=a.next();s.setVisited(!0),n.copySymDepths(s)}};La.prototype.computeDepth=function(e){this.clearVisitedEdges();var n=this._finder.getEdge();n.setEdgeDepths(gn.RIGHT,e),this.copySymDepths(n),this.computeDepths(n)};La.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};La.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var n=e.next();n.getDepth(gn.RIGHT)>=1&&n.getDepth(gn.LEFT)<=0&&!n.isInteriorAreaEdge()&&n.setInResult(!0)}};La.prototype.computeDepths=function(e){var n=this,r=new m6,i=new mR,o=e.getNode();for(i.addLast(o),r.add(o),e.setVisited(!0);!i.isEmpty();){var a=i.removeFirst();r.add(a),n.computeNodeDepth(a);for(var s=a.getEdges().iterator();s.hasNext();){var u=s.next(),d=u.getSym();if(!d.isVisited()){var g=d.getNode();r.contains(g)||(i.addLast(g),r.add(g))}}}};La.prototype.compareTo=function(e){var n=e;return this._rightMostCoord.x<n._rightMostCoord.x?-1:this._rightMostCoord.x>n._rightMostCoord.x?1:0};La.prototype.getEnvelope=function(){if(this._env===null){for(var e=new Qn,n=this._dirEdgeList.iterator();n.hasNext();)for(var r=n.next(),i=r.getEdge().getCoordinates(),o=0;o<i.length-1;o++)e.expandToInclude(i[o]);this._env=e}return this._env};La.prototype.addReachable=function(e){var n=this,r=new Bf;for(r.add(e);!r.empty();){var i=r.pop();n.add(i,r)}};La.prototype.copySymDepths=function(e){var n=e.getSym();n.setDepth(gn.LEFT,e.getDepth(gn.RIGHT)),n.setDepth(gn.RIGHT,e.getDepth(gn.LEFT))};La.prototype.add=function(e,n){var r=this;e.setVisited(!0),this._nodes.add(e);for(var i=e.getEdges().iterator();i.hasNext();){var o=i.next();r._dirEdgeList.add(o);var a=o.getSym(),s=a.getNode();s.isVisited()||n.push(s)}};La.prototype.getNodes=function(){return this._nodes};La.prototype.getDirectedEdges=function(){return this._dirEdgeList};La.prototype.interfaces_=function(){return[Uu]};La.prototype.getClass=function(){return La};var Gi=function t(){var e=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[gn.ON]=r}else if(arguments[0]instanceof t){var i=arguments[0];if(this.init(i.location.length),i!==null)for(var o=0;o<this.location.length;o++)e.location[o]=i.location[o]}}else if(arguments.length===3){var a=arguments[0],s=arguments[1],u=arguments[2];this.init(3),this.location[gn.ON]=a,this.location[gn.LEFT]=s,this.location[gn.RIGHT]=u}};Gi.prototype.setAllLocations=function(e){for(var n=this,r=0;r<this.location.length;r++)n.location[r]=e};Gi.prototype.isNull=function(){for(var e=this,n=0;n<this.location.length;n++)if(e.location[n]!==Et.NONE)return!1;return!0};Gi.prototype.setAllLocationsIfNull=function(e){for(var n=this,r=0;r<this.location.length;r++)n.location[r]===Et.NONE&&(n.location[r]=e)};Gi.prototype.isLine=function(){return this.location.length===1};Gi.prototype.merge=function(e){var n=this;if(e.location.length>this.location.length){var r=new Array(3).fill(null);r[gn.ON]=this.location[gn.ON],r[gn.LEFT]=Et.NONE,r[gn.RIGHT]=Et.NONE,this.location=r}for(var i=0;i<this.location.length;i++)n.location[i]===Et.NONE&&i<e.location.length&&(n.location[i]=e.location[i])};Gi.prototype.getLocations=function(){return this.location};Gi.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[gn.LEFT];this.location[gn.LEFT]=this.location[gn.RIGHT],this.location[gn.RIGHT]=e};Gi.prototype.toString=function(){var e=new Df;return this.location.length>1&&e.append(Et.toLocationSymbol(this.location[gn.LEFT])),e.append(Et.toLocationSymbol(this.location[gn.ON])),this.location.length>1&&e.append(Et.toLocationSymbol(this.location[gn.RIGHT])),e.toString()};Gi.prototype.setLocations=function(e,n,r){this.location[gn.ON]=e,this.location[gn.LEFT]=n,this.location[gn.RIGHT]=r};Gi.prototype.get=function(e){return e<this.location.length?this.location[e]:Et.NONE};Gi.prototype.isArea=function(){return this.location.length>1};Gi.prototype.isAnyNull=function(){for(var e=this,n=0;n<this.location.length;n++)if(e.location[n]===Et.NONE)return!0;return!1};Gi.prototype.setLocation=function(){if(arguments.length===1){var e=arguments[0];this.setLocation(gn.ON,e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.location[n]=r}};Gi.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(Et.NONE)};Gi.prototype.isEqualOnSide=function(e,n){return this.location[n]===e.location[n]};Gi.prototype.allPositionsEqual=function(e){for(var n=this,r=0;r<this.location.length;r++)if(n.location[r]!==e)return!1;return!0};Gi.prototype.interfaces_=function(){return[]};Gi.prototype.getClass=function(){return Gi};var di=function t(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Gi(e),this.elt[1]=new Gi(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.elt[0]=new Gi(n.elt[0]),this.elt[1]=new Gi(n.elt[1])}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.elt[0]=new Gi(Et.NONE),this.elt[1]=new Gi(Et.NONE),this.elt[r].setLocation(i)}else if(arguments.length===3){var o=arguments[0],a=arguments[1],s=arguments[2];this.elt[0]=new Gi(o,a,s),this.elt[1]=new Gi(o,a,s)}else if(arguments.length===4){var u=arguments[0],d=arguments[1],g=arguments[2],_=arguments[3];this.elt[0]=new Gi(Et.NONE,Et.NONE,Et.NONE),this.elt[1]=new Gi(Et.NONE,Et.NONE,Et.NONE),this.elt[u].setLocations(d,g,_)}};di.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e};di.prototype.setAllLocations=function(e,n){this.elt[e].setAllLocations(n)};di.prototype.isNull=function(e){return this.elt[e].isNull()};di.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.elt[n].setAllLocationsIfNull(r)}};di.prototype.isLine=function(e){return this.elt[e].isLine()};di.prototype.merge=function(e){for(var n=this,r=0;r<2;r++)n.elt[r]===null&&e.elt[r]!==null?n.elt[r]=new Gi(e.elt[r]):n.elt[r].merge(e.elt[r])};di.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};di.prototype.getLocation=function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(gn.ON)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.elt[n].get(r)}};di.prototype.toString=function(){var e=new Df;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()};di.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}};di.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()};di.prototype.setLocation=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];this.elt[e].setLocation(gn.ON,n)}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2];this.elt[r].setLocation(i,o)}};di.prototype.isEqualOnSide=function(e,n){return this.elt[0].isEqualOnSide(e.elt[0],n)&&this.elt[1].isEqualOnSide(e.elt[1],n)};di.prototype.allPositionsEqual=function(e,n){return this.elt[e].allPositionsEqual(n)};di.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new Gi(this.elt[e].location[0]))};di.prototype.interfaces_=function(){return[]};di.prototype.getClass=function(){return di};di.toLineLabel=function(e){for(var n=new di(Et.NONE),r=0;r<2;r++)n.setLocation(r,e.getLocation(r));return n};var jo=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new bn,this._pts=new bn,this._label=new di(Et.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new bn,this._geometryFactory=null;var e=arguments[0],n=arguments[1];this._geometryFactory=n,this.computePoints(e),this.computeRing()};jo.prototype.computeRing=function(){var e=this;if(this._ring!==null)return null;for(var n=new Array(this._pts.size()).fill(null),r=0;r<this._pts.size();r++)n[r]=e._pts.get(r);this._ring=this._geometryFactory.createLinearRing(n),this._isHole=Rn.isCCW(this._ring.getCoordinates())};jo.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};jo.prototype.computePoints=function(e){var n=this;this._startDe=e;var r=e,i=!0;do{if(r===null)throw new Wd("Found null DirectedEdge");if(r.getEdgeRing()===n)throw new Wd("Directed Edge visited twice during ring-building at "+r.getCoordinate());n._edges.add(r);var o=r.getLabel();Pr.isTrue(o.isArea()),n.mergeLabel(o),n.addPoints(r.getEdge(),r.isForward(),i),i=!1,n.setEdgeRing(r,n),r=n.getNext(r)}while(r!==this._startDe)};jo.prototype.getLinearRing=function(){return this._ring};jo.prototype.getCoordinate=function(e){return this._pts.get(e)};jo.prototype.computeMaxNodeDegree=function(){var e=this;this._maxNodeDegree=0;var n=this._startDe;do{var r=n.getNode(),i=r.getEdges().getOutgoingDegree(e);i>e._maxNodeDegree&&(e._maxNodeDegree=i),n=e.getNext(n)}while(n!==this._startDe);this._maxNodeDegree*=2};jo.prototype.addPoints=function(e,n,r){var i=this,o=e.getCoordinates();if(n){var a=1;r&&(a=0);for(var s=a;s<o.length;s++)i._pts.add(o[s])}else{var u=o.length-2;r&&(u=o.length-1);for(var d=u;d>=0;d--)i._pts.add(o[d])}};jo.prototype.isHole=function(){return this._isHole};jo.prototype.setInResult=function(){var e=this._startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this._startDe)};jo.prototype.containsPoint=function(e){var n=this.getLinearRing(),r=n.getEnvelopeInternal();if(!r.contains(e)||!Rn.isPointInRing(e,n.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();){var o=i.next();if(o.containsPoint(e))return!1}return!0};jo.prototype.addHole=function(e){this._holes.add(e)};jo.prototype.isShell=function(){return this._shell===null};jo.prototype.getLabel=function(){return this._label};jo.prototype.getEdges=function(){return this._edges};jo.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};jo.prototype.getShell=function(){return this._shell};jo.prototype.mergeLabel=function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=n.getLocation(r,gn.RIGHT);if(i===Et.NONE)return null;if(this._label.getLocation(r)===Et.NONE)return this._label.setLocation(r,i),null}};jo.prototype.setShell=function(e){this._shell=e,e!==null&&e.addHole(this)};jo.prototype.toPolygon=function(e){for(var n=this,r=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)r[i]=n._holes.get(i).getLinearRing();var o=e.createPolygon(this.getLinearRing(),r);return o};jo.prototype.interfaces_=function(){return[]};jo.prototype.getClass=function(){return jo};var TRe=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(r,i){r.setMinEdgeRing(i)},e.prototype.getNext=function(r){return r.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(jo),CRe=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var r=this,i=new bn,o=this._startDe;do{if(o.getMinEdgeRing()===null){var a=new TRe(o,r._geometryFactory);i.add(a)}o=o.getNext()}while(o!==this._startDe);return i},e.prototype.setEdgeRing=function(r,i){r.setEdgeRing(i)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var r=this,i=this._startDe;do{var o=i.getNode();o.getEdges().linkMinimalDirectedEdges(r),i=i.getNext()}while(i!==this._startDe)},e.prototype.getNext=function(r){return r.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(jo),eu=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this._label=e}}};eu.prototype.setVisited=function(e){this._isVisited=e};eu.prototype.setInResult=function(e){this._isInResult=e};eu.prototype.isCovered=function(){return this._isCovered};eu.prototype.isCoveredSet=function(){return this._isCoveredSet};eu.prototype.setLabel=function(e){this._label=e};eu.prototype.getLabel=function(){return this._label};eu.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0};eu.prototype.updateIM=function(e){Pr.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)};eu.prototype.isInResult=function(){return this._isInResult};eu.prototype.isVisited=function(){return this._isVisited};eu.prototype.interfaces_=function(){return[]};eu.prototype.getClass=function(){return eu};var AR=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var n=arguments[0],r=arguments[1];this._coord=n,this._edges=r,this._label=new di(0,Et.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var r=this.getEdges().getEdges().iterator();r.hasNext();){var i=r.next();if(i.getEdge().isInResult())return!0}return!1},e.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(r){r.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(r){},e.prototype.computeMergedLocation=function(r,i){var o=Et.NONE;if(o=this._label.getLocation(i),!r.isNull(i)){var a=r.getLocation(i);o!==Et.BOUNDARY&&(o=a)}return o},e.prototype.setLabel=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];this._label===null?this._label=new di(r,i):this._label.setLocation(r,i)}else return t.prototype.setLabel.apply(this,arguments)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var r=this;if(arguments[0]instanceof e){var i=arguments[0];this.mergeLabel(i._label)}else if(arguments[0]instanceof di)for(var o=arguments[0],a=0;a<2;a++){var s=r.computeMergedLocation(o,a),u=r._label.getLocation(a);u===Et.NONE&&r._label.setLocation(a,s)}},e.prototype.add=function(r){this._edges.insert(r),r.setNode(this)},e.prototype.setLabelBoundary=function(r){if(this._label===null)return null;var i=Et.NONE;this._label!==null&&(i=this._label.getLocation(r));var o=null;switch(i){case Et.BOUNDARY:o=Et.INTERIOR;break;case Et.INTERIOR:o=Et.BOUNDARY;break;default:o=Et.BOUNDARY;break}this._label.setLocation(r,o)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(eu),Cf=function(){this.nodeMap=new aa,this.nodeFact=null;var e=arguments[0];this.nodeFact=e};Cf.prototype.find=function(e){return this.nodeMap.get(e)};Cf.prototype.addNode=function(){if(arguments[0]instanceof dt){var e=arguments[0],n=this.nodeMap.get(e);return n===null&&(n=this.nodeFact.createNode(e),this.nodeMap.put(e,n)),n}else if(arguments[0]instanceof AR){var r=arguments[0],i=this.nodeMap.get(r.getCoordinate());return i===null?(this.nodeMap.put(r.getCoordinate(),r),r):(i.mergeLabel(r),i)}};Cf.prototype.print=function(e){for(var n=this.iterator();n.hasNext();){var r=n.next();r.print(e)}};Cf.prototype.iterator=function(){return this.nodeMap.values().iterator()};Cf.prototype.values=function(){return this.nodeMap.values()};Cf.prototype.getBoundaryNodes=function(e){for(var n=new bn,r=this.iterator();r.hasNext();){var i=r.next();i.getLabel().getLocation(e)===Et.BOUNDARY&&n.add(i)}return n};Cf.prototype.add=function(e){var n=e.getCoordinate(),r=this.addNode(n);r.add(e)};Cf.prototype.interfaces_=function(){return[]};Cf.prototype.getClass=function(){return Cf};var yi=function(){},KE={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};yi.prototype.interfaces_=function(){return[]};yi.prototype.getClass=function(){return yi};yi.isNorthern=function(e){return e===yi.NE||e===yi.NW};yi.isOpposite=function(e,n){if(e===n)return!1;var r=(e-n+4)%4;return r===2};yi.commonHalfPlane=function(e,n){if(e===n)return e;var r=(e-n+4)%4;if(r===2)return-1;var i=e<n?e:n,o=e>n?e:n;return i===0&&o===3?3:i};yi.isInHalfPlane=function(e,n){return n===yi.SE?e===yi.SE||e===yi.SW:e===n||e===n+1};yi.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1];if(e===0&&n===0)throw new oo("Cannot compute the quadrant for point ( "+e+", "+n+" )");return e>=0?n>=0?yi.NE:yi.SE:n>=0?yi.NW:yi.SW}else if(arguments[0]instanceof dt&&arguments[1]instanceof dt){var r=arguments[0],i=arguments[1];if(i.x===r.x&&i.y===r.y)throw new oo("Cannot compute the quadrant for two identical points "+r);return i.x>=r.x?i.y>=r.y?yi.NE:yi.SE:i.y>=r.y?yi.NW:yi.SW}};KE.NE.get=function(){return 0};KE.NW.get=function(){return 1};KE.SW.get=function(){return 2};KE.SE.get=function(){return 3};Object.defineProperties(yi,KE);var la=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2],o=null;this._edge=n,this.init(r,i),this._label=o}else if(arguments.length===4){var a=arguments[0],s=arguments[1],u=arguments[2],d=arguments[3];this._edge=a,this.init(s,u),this._label=d}};la.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:Rn.computeOrientation(e._p0,e._p1,this._p1)};la.prototype.getDy=function(){return this._dy};la.prototype.getCoordinate=function(){return this._p0};la.prototype.setNode=function(e){this._node=e};la.prototype.print=function(e){var n=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),i=r.lastIndexOf("."),o=r.substring(i+1);e.print("  "+o+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+n+"   "+this._label)};la.prototype.compareTo=function(e){var n=e;return this.compareDirection(n)};la.prototype.getDirectedCoordinate=function(){return this._p1};la.prototype.getDx=function(){return this._dx};la.prototype.getLabel=function(){return this._label};la.prototype.getEdge=function(){return this._edge};la.prototype.getQuadrant=function(){return this._quadrant};la.prototype.getNode=function(){return this._node};la.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),i=n.substring(r+1);return"  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label};la.prototype.computeLabel=function(e){};la.prototype.init=function(e,n){this._p0=e,this._p1=n,this._dx=n.x-e.x,this._dy=n.y-e.y,this._quadrant=yi.quadrant(this._dx,this._dy),Pr.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};la.prototype.interfaces_=function(){return[Uu]};la.prototype.getClass=function(){return la};var yk=function(t){function e(){var n=arguments[0],r=arguments[1];if(t.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=r,r)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var i=n.getNumPoints()-1;this.init(n.getCoordinate(i),n.getCoordinate(i-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(r){return this._depth[r]},e.prototype.setVisited=function(r){this._isVisited=r},e.prototype.computeDirectedLabel=function(){this._label=new di(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(r,i){if(this._depth[r]!==-999&&this._depth[r]!==i)throw new Wd("assigned depths do not match",this.getCoordinate());this._depth[r]=i},e.prototype.isInteriorAreaEdge=function(){for(var r=this,i=!0,o=0;o<2;o++)r._label.isArea(o)&&r._label.getLocation(o,gn.LEFT)===Et.INTERIOR&&r._label.getLocation(o,gn.RIGHT)===Et.INTERIOR||(i=!1);return i},e.prototype.setNextMin=function(r){this._nextMin=r},e.prototype.print=function(r){t.prototype.print.call(this,r),r.print(" "+this._depth[gn.LEFT]+"/"+this._depth[gn.RIGHT]),r.print(" ("+this.getDepthDelta()+")"),this._isInResult&&r.print(" inResult")},e.prototype.setMinEdgeRing=function(r){this._minEdgeRing=r},e.prototype.isLineEdge=function(){var r=this._label.isLine(0)||this._label.isLine(1),i=!this._label.isArea(0)||this._label.allPositionsEqual(0,Et.EXTERIOR),o=!this._label.isArea(1)||this._label.allPositionsEqual(1,Et.EXTERIOR);return r&&i&&o},e.prototype.setEdgeRing=function(r){this._edgeRing=r},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var r=this._edge.getDepthDelta();return this._isForward||(r=-r),r},e.prototype.setInResult=function(r){this._isInResult=r},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(r){this.print(r),r.print(" "),this._isForward?this._edge.print(r):this._edge.printReverse(r)},e.prototype.setSym=function(r){this._sym=r},e.prototype.setVisitedEdge=function(r){this.setVisited(r),this._sym.setVisited(r)},e.prototype.setEdgeDepths=function(r,i){var o=this.getEdge().getDepthDelta();this._isForward||(o=-o);var a=1;r===gn.LEFT&&(a=-1);var s=gn.opposite(r),u=o*a,d=i+u;this.setDepth(r,i),this.setDepth(s,d)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(r){this._next=r},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(r,i){return r===Et.EXTERIOR&&i===Et.INTERIOR?1:r===Et.INTERIOR&&i===Et.EXTERIOR?-1:0},e}(la),Kv=function(){};Kv.prototype.createNode=function(e){return new AR(e,null)};Kv.prototype.interfaces_=function(){return[]};Kv.prototype.getClass=function(){return Kv};var po=function(){if(this._edges=new bn,this._nodes=null,this._edgeEndList=new bn,arguments.length===0)this._nodes=new Cf(new Kv);else if(arguments.length===1){var e=arguments[0];this._nodes=new Cf(e)}};po.prototype.printEdges=function(e){var n=this;e.println("Edges:");for(var r=0;r<this._edges.size();r++){e.println("edge "+r+":");var i=n._edges.get(r);i.print(e),i.eiList.print(e)}};po.prototype.find=function(e){return this._nodes.find(e)};po.prototype.addNode=function(){if(arguments[0]instanceof AR){var e=arguments[0];return this._nodes.addNode(e)}else if(arguments[0]instanceof dt){var n=arguments[0];return this._nodes.addNode(n)}};po.prototype.getNodeIterator=function(){return this._nodes.iterator()};po.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var n=e.next();n.getEdges().linkResultDirectedEdges()}};po.prototype.debugPrintln=function(e){qs.out.println(e)};po.prototype.isBoundaryNode=function(e,n){var r=this._nodes.find(n);if(r===null)return!1;var i=r.getLabel();return i!==null&&i.getLocation(e)===Et.BOUNDARY};po.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var n=e.next();n.getEdges().linkAllDirectedEdges()}};po.prototype.matchInSameDirection=function(e,n,r,i){return e.equals(r)?Rn.computeOrientation(e,n,i)===Rn.COLLINEAR&&yi.quadrant(e,n)===yi.quadrant(r,i):!1};po.prototype.getEdgeEnds=function(){return this._edgeEndList};po.prototype.debugPrint=function(e){qs.out.print(e)};po.prototype.getEdgeIterator=function(){return this._edges.iterator()};po.prototype.findEdgeInSameDirection=function(e,n){for(var r=this,i=0;i<this._edges.size();i++){var o=r._edges.get(i),a=o.getCoordinates();if(r.matchInSameDirection(e,n,a[0],a[1])||r.matchInSameDirection(e,n,a[a.length-1],a[a.length-2]))return o}return null};po.prototype.insertEdge=function(e){this._edges.add(e)};po.prototype.findEdgeEnd=function(e){for(var n=this.getEdgeEnds().iterator();n.hasNext();){var r=n.next();if(r.getEdge()===e)return r}return null};po.prototype.addEdges=function(e){for(var n=this,r=e.iterator();r.hasNext();){var i=r.next();n._edges.add(i);var o=new yk(i,!0),a=new yk(i,!1);o.setSym(a),a.setSym(o),n.add(o),n.add(a)}};po.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)};po.prototype.getNodes=function(){return this._nodes.values()};po.prototype.findEdge=function(e,n){for(var r=this,i=0;i<this._edges.size();i++){var o=r._edges.get(i),a=o.getCoordinates();if(e.equals(a[0])&&n.equals(a[1]))return o}return null};po.prototype.interfaces_=function(){return[]};po.prototype.getClass=function(){return po};po.linkResultDirectedEdges=function(e){for(var n=e.iterator();n.hasNext();){var r=n.next();r.getEdges().linkResultDirectedEdges()}};var Ml=function(){this._geometryFactory=null,this._shellList=new bn;var e=arguments[0];this._geometryFactory=e};Ml.prototype.sortShellsAndHoles=function(e,n,r){for(var i=e.iterator();i.hasNext();){var o=i.next();o.isHole()?r.add(o):n.add(o)}};Ml.prototype.computePolygons=function(e){for(var n=this,r=new bn,i=e.iterator();i.hasNext();){var o=i.next(),a=o.toPolygon(n._geometryFactory);r.add(a)}return r};Ml.prototype.placeFreeHoles=function(e,n){for(var r=this,i=n.iterator();i.hasNext();){var o=i.next();if(o.getShell()===null){var a=r.findEdgeRingContaining(o,e);if(a===null)throw new Wd("unable to assign hole to a shell",o.getCoordinate(0));o.setShell(a)}}};Ml.prototype.buildMinimalEdgeRings=function(e,n,r){for(var i=this,o=new bn,a=e.iterator();a.hasNext();){var s=a.next();if(s.getMaxNodeDegree()>2){s.linkDirectedEdgesForMinimalEdgeRings();var u=s.buildMinimalRings(),d=i.findShell(u);d!==null?(i.placePolygonHoles(d,u),n.add(d)):r.addAll(u)}else o.add(s)}return o};Ml.prototype.containsPoint=function(e){for(var n=this._shellList.iterator();n.hasNext();){var r=n.next();if(r.containsPoint(e))return!0}return!1};Ml.prototype.buildMaximalEdgeRings=function(e){for(var n=this,r=new bn,i=e.iterator();i.hasNext();){var o=i.next();if(o.isInResult()&&o.getLabel().isArea()&&o.getEdgeRing()===null){var a=new CRe(o,n._geometryFactory);r.add(a),a.setInResult()}}return r};Ml.prototype.placePolygonHoles=function(e,n){for(var r=n.iterator();r.hasNext();){var i=r.next();i.isHole()&&i.setShell(e)}};Ml.prototype.getPolygons=function(){var e=this.computePolygons(this._shellList);return e};Ml.prototype.findEdgeRingContaining=function(e,n){for(var r=e.getLinearRing(),i=r.getEnvelopeInternal(),o=r.getCoordinateN(0),a=null,s=null,u=n.iterator();u.hasNext();){var d=u.next(),g=d.getLinearRing(),_=g.getEnvelopeInternal();a!==null&&(s=a.getLinearRing().getEnvelopeInternal());var E=!1;_.contains(i)&&Rn.isPointInRing(o,g.getCoordinates())&&(E=!0),E&&(a===null||s.contains(_))&&(a=d)}return a};Ml.prototype.findShell=function(e){for(var n=0,r=null,i=e.iterator();i.hasNext();){var o=i.next();o.isHole()||(r=o,n++)}return Pr.isTrue(n<=1,"found two shells in MinimalEdgeRing list"),r};Ml.prototype.add=function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var n=arguments[0],r=arguments[1];po.linkResultDirectedEdges(r);var i=this.buildMaximalEdgeRings(n),o=new bn,a=this.buildMinimalEdgeRings(i,this._shellList,o);this.sortShellsAndHoles(a,this._shellList,o),this.placeFreeHoles(this._shellList,o)}};Ml.prototype.interfaces_=function(){return[]};Ml.prototype.getClass=function(){return Ml};var Jv=function(){};Jv.prototype.getBounds=function(){};Jv.prototype.interfaces_=function(){return[]};Jv.prototype.getClass=function(){return Jv};var wc=function(){this._bounds=null,this._item=null;var e=arguments[0],n=arguments[1];this._bounds=e,this._item=n};wc.prototype.getItem=function(){return this._item};wc.prototype.getBounds=function(){return this._bounds};wc.prototype.interfaces_=function(){return[Jv,Gu]};wc.prototype.getClass=function(){return wc};var qd=function(){this._size=null,this._items=null,this._size=0,this._items=new bn,this._items.add(null)};qd.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e};qd.prototype.size=function(){return this._size};qd.prototype.reorder=function(e){for(var n=this,r=null,i=this._items.get(e);e*2<=this._size&&(r=e*2,r!==n._size&&n._items.get(r+1).compareTo(n._items.get(r))<0&&r++,n._items.get(r).compareTo(i)<0);e=r)n._items.set(e,n._items.get(r));this._items.set(e,i)};qd.prototype.clear=function(){this._size=0,this._items.clear()};qd.prototype.isEmpty=function(){return this._size===0};qd.prototype.add=function(e){var n=this;this._items.add(null),this._size+=1;var r=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(r/2)))<0;r/=2)n._items.set(r,n._items.get(Math.trunc(r/2)));this._items.set(r,e)};qd.prototype.interfaces_=function(){return[]};qd.prototype.getClass=function(){return qd};var fg=function(){};fg.prototype.visitItem=function(e){};fg.prototype.interfaces_=function(){return[]};fg.prototype.getClass=function(){return fg};var j0=function(){};j0.prototype.insert=function(e,n){};j0.prototype.remove=function(e,n){};j0.prototype.query=function(){};j0.prototype.interfaces_=function(){return[]};j0.prototype.getClass=function(){return j0};var os=function(){if(this._childBoundables=new bn,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this._level=e}}},Yre={serialVersionUID:{configurable:!0}};os.prototype.getLevel=function(){return this._level};os.prototype.size=function(){return this._childBoundables.size()};os.prototype.getChildBoundables=function(){return this._childBoundables};os.prototype.addChildBoundable=function(e){Pr.isTrue(this._bounds===null),this._childBoundables.add(e)};os.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};os.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};os.prototype.interfaces_=function(){return[Jv,Gu]};os.prototype.getClass=function(){return os};Yre.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(os,Yre);var Ec=function(){};Ec.reverseOrder=function(){return{compare:function(n,r){return r.compareTo(n)}}};Ec.min=function(e){return Ec.sort(e),e.get(0)};Ec.sort=function(e,n){var r=e.toArray();n?jm.sort(r,n):jm.sort(r);for(var i=e.iterator(),o=0,a=r.length;o<a;o++)i.next(),i.set(r[o])};Ec.singletonList=function(e){var n=new bn;return n.add(e),n};var Uo=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],n=arguments[1],r=arguments[2];this._boundable1=e,this._boundable2=n,this._itemDistance=r,this._distance=this.distance()};Uo.prototype.expandToQueue=function(e,n){var r=Uo.isComposite(this._boundable1),i=Uo.isComposite(this._boundable2);if(r&&i)return Uo.area(this._boundable1)>Uo.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,n),null):(this.expand(this._boundable2,this._boundable1,e,n),null);if(r)return this.expand(this._boundable1,this._boundable2,e,n),null;if(i)return this.expand(this._boundable2,this._boundable1,e,n),null;throw new oo("neither boundable is composite")};Uo.prototype.isLeaves=function(){return!(Uo.isComposite(this._boundable1)||Uo.isComposite(this._boundable2))};Uo.prototype.compareTo=function(e){var n=e;return this._distance<n._distance?-1:this._distance>n._distance?1:0};Uo.prototype.expand=function(e,n,r,i){for(var o=this,a=e.getChildBoundables(),s=a.iterator();s.hasNext();){var u=s.next(),d=new Uo(u,n,o._itemDistance);d.getDistance()<i&&r.add(d)}};Uo.prototype.getBoundable=function(e){return e===0?this._boundable1:this._boundable2};Uo.prototype.getDistance=function(){return this._distance};Uo.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};Uo.prototype.interfaces_=function(){return[Uu]};Uo.prototype.getClass=function(){return Uo};Uo.area=function(e){return e.getBounds().getArea()};Uo.isComposite=function(e){return e instanceof os};var Ps=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new bn,this._nodeCapacity=null,arguments.length===0){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(arguments.length===1){var n=arguments[0];Pr.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},_R={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Ps.prototype.getNodeCapacity=function(){return this._nodeCapacity};Ps.prototype.lastNode=function(e){return e.get(e.size()-1)};Ps.prototype.size=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var n=arguments[0],r=0,i=n.getChildBoundables().iterator();i.hasNext();){var o=i.next();o instanceof os?r+=e.size(o):o instanceof wc&&(r+=1)}return r}};Ps.prototype.removeItem=function(e,n){for(var r=null,i=e.getChildBoundables().iterator();i.hasNext();){var o=i.next();o instanceof wc&&o.getItem()===n&&(r=o)}return r!==null?(e.getChildBoundables().remove(r),!0):!1};Ps.prototype.itemsTree=function(){var e=this;if(arguments.length===0){this.build();var n=this.itemsTree(this._root);return n===null?new bn:n}else if(arguments.length===1){for(var r=arguments[0],i=new bn,o=r.getChildBoundables().iterator();o.hasNext();){var a=o.next();if(a instanceof os){var s=e.itemsTree(a);s!==null&&i.add(s)}else a instanceof wc?i.add(a.getItem()):Pr.shouldNeverReachHere()}return i.size()<=0?null:i}};Ps.prototype.insert=function(e,n){Pr.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new wc(e,n))};Ps.prototype.boundablesAtLevel=function(){var e=this;if(arguments.length===1){var n=arguments[0],r=new bn;return this.boundablesAtLevel(n,this._root,r),r}else if(arguments.length===3){var i=arguments[0],o=arguments[1],a=arguments[2];if(Pr.isTrue(i>-2),o.getLevel()===i)return a.add(o),null;for(var s=o.getChildBoundables().iterator();s.hasNext();){var u=s.next();u instanceof os?e.boundablesAtLevel(i,u,a):(Pr.isTrue(u instanceof wc),i===-1&&a.add(u))}return null}};Ps.prototype.query=function(){var e=this;if(arguments.length===1){var n=arguments[0];this.build();var r=new bn;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.query(n,this._root,r),r}else if(arguments.length===2){var i=arguments[0],o=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.query(i,this._root,o)}else if(arguments.length===3){if(ar(arguments[2],fg)&&arguments[0]instanceof Object&&arguments[1]instanceof os)for(var a=arguments[0],s=arguments[1],u=arguments[2],d=s.getChildBoundables(),g=0;g<d.size();g++){var _=d.get(g);e.getIntersectsOp().intersects(_.getBounds(),a)&&(_ instanceof os?e.query(a,_,u):_ instanceof wc?u.visitItem(_.getItem()):Pr.shouldNeverReachHere())}else if(ar(arguments[2],Ac)&&arguments[0]instanceof Object&&arguments[1]instanceof os)for(var E=arguments[0],P=arguments[1],R=arguments[2],B=P.getChildBoundables(),V=0;V<B.size();V++){var z=B.get(V);e.getIntersectsOp().intersects(z.getBounds(),E)&&(z instanceof os?e.query(E,z,R):z instanceof wc?R.add(z.getItem()):Pr.shouldNeverReachHere())}}};Ps.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};Ps.prototype.getRoot=function(){return this.build(),this._root};Ps.prototype.remove=function(){var e=this;if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),n)?this.remove(n,this._root,r):!1}else if(arguments.length===3){var i=arguments[0],o=arguments[1],a=arguments[2],s=this.removeItem(o,a);if(s)return!0;for(var u=null,d=o.getChildBoundables().iterator();d.hasNext();){var g=d.next();if(e.getIntersectsOp().intersects(g.getBounds(),i)&&g instanceof os&&(s=e.remove(i,g,a),s)){u=g;break}}return u!==null&&u.getChildBoundables().isEmpty()&&o.getChildBoundables().remove(u),s}};Ps.prototype.createHigherLevels=function(e,n){Pr.isTrue(!e.isEmpty());var r=this.createParentBoundables(e,n+1);return r.size()===1?r.get(0):this.createHigherLevels(r,n+1)};Ps.prototype.depth=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var n=arguments[0],r=0,i=n.getChildBoundables().iterator();i.hasNext();){var o=i.next();if(o instanceof os){var a=e.depth(o);a>r&&(r=a)}}return r+1}};Ps.prototype.createParentBoundables=function(e,n){var r=this;Pr.isTrue(!e.isEmpty());var i=new bn;i.add(this.createNode(n));var o=new bn(e);Ec.sort(o,this.getComparator());for(var a=o.iterator();a.hasNext();){var s=a.next();r.lastNode(i).getChildBoundables().size()===r.getNodeCapacity()&&i.add(r.createNode(n)),r.lastNode(i).addChildBoundable(s)}return i};Ps.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};Ps.prototype.interfaces_=function(){return[Gu]};Ps.prototype.getClass=function(){return Ps};Ps.compareDoubles=function(e,n){return e>n?1:e<n?-1:0};_R.IntersectsOp.get=function(){return PRe};_R.serialVersionUID.get=function(){return-3886435814360241e3};_R.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(Ps,_R);var PRe=function(){},e1=function(){};e1.prototype.distance=function(e,n){};e1.prototype.interfaces_=function(){return[]};e1.prototype.getClass=function(){return e1};var Qre=function(t){function e(r){r=r||e.DEFAULT_NODE_CAPACITY,t.call(this,r)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(i,o){var a=this;Pr.isTrue(i.length>0);for(var s=new bn,u=0;u<i.length;u++)s.addAll(a.createParentBoundablesFromVerticalSlice(i[u],o));return s},e.prototype.createNode=function(i){return new i7(i)},e.prototype.size=function(){return arguments.length===0?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(arguments.length===2){var i=arguments[0],o=arguments[1];if(i.isNull())return null;t.prototype.insert.call(this,i,o)}else return t.prototype.insert.apply(this,arguments)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(i,o){for(var a=Math.trunc(Math.ceil(i.size()/o)),s=new Array(o).fill(null),u=i.iterator(),d=0;d<o;d++){s[d]=new bn;for(var g=0;u.hasNext()&&g<a;){var _=u.next();s[d].add(_),g++}}return s},e.prototype.query=function(){if(arguments.length===1){var i=arguments[0];return t.prototype.query.call(this,i)}else if(arguments.length===2){var o=arguments[0],a=arguments[1];t.prototype.query.call(this,o,a)}else if(arguments.length===3){if(ar(arguments[2],fg)&&arguments[0]instanceof Object&&arguments[1]instanceof os){var s=arguments[0],u=arguments[1],d=arguments[2];t.prototype.query.call(this,s,u,d)}else if(ar(arguments[2],Ac)&&arguments[0]instanceof Object&&arguments[1]instanceof os){var g=arguments[0],_=arguments[1],E=arguments[2];t.prototype.query.call(this,g,_,E)}}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(i,o){return t.prototype.createParentBoundables.call(this,i,o)},e.prototype.remove=function(){if(arguments.length===2){var i=arguments[0],o=arguments[1];return t.prototype.remove.call(this,i,o)}else return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return arguments.length===0?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(i,o){Pr.isTrue(!i.isEmpty());var a=Math.trunc(Math.ceil(i.size()/this.getNodeCapacity())),s=new bn(i);Ec.sort(s,e.xComparator);var u=this.verticalSlices(s,Math.trunc(Math.ceil(Math.sqrt(a))));return this.createParentBoundablesFromVerticalSlices(u,o)},e.prototype.nearestNeighbour=function(){if(arguments.length===1){if(ar(arguments[0],e1)){var i=arguments[0],o=new Uo(this.getRoot(),this.getRoot(),i);return this.nearestNeighbour(o)}else if(arguments[0]instanceof Uo){var a=arguments[0];return this.nearestNeighbour(a,mr.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof e&&ar(arguments[1],e1)){var s=arguments[0],u=arguments[1],d=new Uo(this.getRoot(),s.getRoot(),u);return this.nearestNeighbour(d)}else if(arguments[0]instanceof Uo&&typeof arguments[1]=="number"){var g=arguments[0],_=arguments[1],E=_,P=null,R=new qd;for(R.add(g);!R.isEmpty()&&E>0;){var B=R.poll(),V=B.getDistance();if(V>=E)break;B.isLeaves()?(E=V,P=B):B.expandToQueue(R,E)}return[P.getBoundable(0).getItem(),P.getBoundable(1).getItem()]}}else if(arguments.length===3){var z=arguments[0],F=arguments[1],k=arguments[2],X=new wc(z,F),Y=new Uo(this.getRoot(),X,k);return this.nearestNeighbour(Y)[0]}},e.prototype.interfaces_=function(){return[j0,Gu]},e.prototype.getClass=function(){return e},e.centreX=function(i){return e.avg(i.getMinX(),i.getMaxX())},e.avg=function(i,o){return(i+o)/2},e.centreY=function(i){return e.avg(i.getMinY(),i.getMaxY())},n.STRtreeNode.get=function(){return i7},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[$v]},compare:function(r,i){return t.compareDoubles(e.centreX(r.getBounds()),e.centreX(i.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[$v]},compare:function(r,i){return t.compareDoubles(e.centreY(r.getBounds()),e.centreY(i.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(r,i){return r.intersects(i)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,n),e}(Ps),i7=function(t){function e(){var n=arguments[0];t.call(this,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var r=null,i=this.getChildBoundables().iterator();i.hasNext();){var o=i.next();r===null?r=new Qn(o.getBounds()):r.expandToInclude(o.getBounds())}return r},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(os),Ha=function(){};Ha.prototype.interfaces_=function(){return[]};Ha.prototype.getClass=function(){return Ha};Ha.relativeSign=function(e,n){return e<n?-1:e>n?1:0};Ha.compare=function(e,n,r){if(n.equals2D(r))return 0;var i=Ha.relativeSign(n.x,r.x),o=Ha.relativeSign(n.y,r.y);switch(e){case 0:return Ha.compareValue(i,o);case 1:return Ha.compareValue(o,i);case 2:return Ha.compareValue(o,-i);case 3:return Ha.compareValue(-i,o);case 4:return Ha.compareValue(-i,-o);case 5:return Ha.compareValue(-o,-i);case 6:return Ha.compareValue(-o,i);case 7:return Ha.compareValue(i,-o)}return Pr.shouldNeverReachHere("invalid octant value"),0};Ha.compareValue=function(e,n){return e<0?-1:e>0?1:n<0?-1:n>0?1:0};var hg=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];this._segString=e,this.coord=new dt(n),this.segmentIndex=r,this._segmentOctant=i,this._isInterior=!n.equals2D(e.getCoordinate(r))};hg.prototype.getCoordinate=function(){return this.coord};hg.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)};hg.prototype.compareTo=function(e){var n=e;return this.segmentIndex<n.segmentIndex?-1:this.segmentIndex>n.segmentIndex?1:this.coord.equals2D(n.coord)?0:Ha.compare(this._segmentOctant,this.coord,n.coord)};hg.prototype.isEndPoint=function(e){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===e};hg.prototype.isInterior=function(){return this._isInterior};hg.prototype.interfaces_=function(){return[Uu]};hg.prototype.getClass=function(){return hg};var Da=function(){this._nodeMap=new aa,this._edge=null;var e=arguments[0];this._edge=e};Da.prototype.getSplitCoordinates=function(){var e=this,n=new YE;this.addEndpoints();for(var r=this.iterator(),i=r.next();r.hasNext();){var o=r.next();e.addEdgeCoordinates(i,o,n),i=o}return n.toCoordinateArray()};Da.prototype.addCollapsedNodes=function(){var e=this,n=new bn;this.findCollapsesFromInsertedNodes(n),this.findCollapsesFromExistingVertices(n);for(var r=n.iterator();r.hasNext();){var i=r.next().intValue();e.add(e._edge.getCoordinate(i),i)}};Da.prototype.print=function(e){e.println("Intersections:");for(var n=this.iterator();n.hasNext();){var r=n.next();r.print(e)}};Da.prototype.findCollapsesFromExistingVertices=function(e){for(var n=this,r=0;r<this._edge.size()-2;r++){var i=n._edge.getCoordinate(r),o=n._edge.getCoordinate(r+2);i.equals2D(o)&&e.add(new bf(r+1))}};Da.prototype.addEdgeCoordinates=function(e,n,r){var i=this,o=this._edge.getCoordinate(n.segmentIndex),a=n.isInterior()||!n.coord.equals2D(o);r.add(new dt(e.coord),!1);for(var s=e.segmentIndex+1;s<=n.segmentIndex;s++)r.add(i._edge.getCoordinate(s));a&&r.add(new dt(n.coord))};Da.prototype.iterator=function(){return this._nodeMap.values().iterator()};Da.prototype.addSplitEdges=function(e){var n=this;this.addEndpoints(),this.addCollapsedNodes();for(var r=this.iterator(),i=r.next();r.hasNext();){var o=r.next(),a=n.createSplitEdge(i,o);e.add(a),i=o}};Da.prototype.findCollapseIndex=function(e,n,r){if(!e.coord.equals2D(n.coord))return!1;var i=n.segmentIndex-e.segmentIndex;return n.isInterior()||i--,i===1?(r[0]=e.segmentIndex+1,!0):!1};Da.prototype.findCollapsesFromInsertedNodes=function(e){for(var n=this,r=new Array(1).fill(null),i=this.iterator(),o=i.next();i.hasNext();){var a=i.next(),s=n.findCollapseIndex(o,a,r);s&&e.add(new bf(r[0])),o=a}};Da.prototype.getEdge=function(){return this._edge};Da.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)};Da.prototype.createSplitEdge=function(e,n){var r=this,i=n.segmentIndex-e.segmentIndex+2,o=this._edge.getCoordinate(n.segmentIndex),a=n.isInterior()||!n.coord.equals2D(o);a||i--;var s=new Array(i).fill(null),u=0;s[u++]=new dt(e.coord);for(var d=e.segmentIndex+1;d<=n.segmentIndex;d++)s[u++]=r._edge.getCoordinate(d);return a&&(s[u]=new dt(n.coord)),new Lo(s,this._edge.getData())};Da.prototype.add=function(e,n){var r=new hg(this._edge,e,n,this._edge.getSegmentOctant(n)),i=this._nodeMap.get(r);return i!==null?(Pr.isTrue(i.coord.equals2D(e),"Found equal nodes with different coordinates"),i):(this._nodeMap.put(r,r),r)};Da.prototype.checkSplitEdgesCorrectness=function(e){var n=this._edge.getCoordinates(),r=e.get(0),i=r.getCoordinate(0);if(!i.equals2D(n[0]))throw new $d("bad split edge start point at "+i);var o=e.get(e.size()-1),a=o.getCoordinates(),s=a[a.length-1];if(!s.equals2D(n[n.length-1]))throw new $d("bad split edge end point at "+s)};Da.prototype.interfaces_=function(){return[]};Da.prototype.getClass=function(){return Da};var V0=function(){};V0.prototype.interfaces_=function(){return[]};V0.prototype.getClass=function(){return V0};V0.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1];if(e===0&&n===0)throw new oo("Cannot compute the octant for point ( "+e+", "+n+" )");var r=Math.abs(e),i=Math.abs(n);return e>=0?n>=0?r>=i?0:1:r>=i?7:6:n>=0?r>=i?3:2:r>=i?4:5}else if(arguments[0]instanceof dt&&arguments[1]instanceof dt){var o=arguments[0],a=arguments[1],s=a.x-o.x,u=a.y-o.y;if(s===0&&u===0)throw new oo("Cannot compute the octant for two identical points "+o);return V0.octant(s,u)}};var Mh=function(){};Mh.prototype.getCoordinates=function(){};Mh.prototype.size=function(){};Mh.prototype.getCoordinate=function(e){};Mh.prototype.isClosed=function(){};Mh.prototype.setData=function(e){};Mh.prototype.getData=function(){};Mh.prototype.interfaces_=function(){return[]};Mh.prototype.getClass=function(){return Mh};var Yw=function(){};Yw.prototype.addIntersection=function(e,n){};Yw.prototype.interfaces_=function(){return[Mh]};Yw.prototype.getClass=function(){return Yw};var Lo=function(){this._nodeList=new Da(this),this._pts=null,this._data=null;var e=arguments[0],n=arguments[1];this._pts=e,this._data=n};Lo.prototype.getCoordinates=function(){return this._pts};Lo.prototype.size=function(){return this._pts.length};Lo.prototype.getCoordinate=function(e){return this._pts[e]};Lo.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Lo.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))};Lo.prototype.setData=function(e){this._data=e};Lo.prototype.safeOctant=function(e,n){return e.equals2D(n)?0:V0.octant(e,n)};Lo.prototype.getData=function(){return this._data};Lo.prototype.addIntersection=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];this.addIntersectionNode(e,n)}else if(arguments.length===4){var r=arguments[0],i=arguments[1],o=arguments[3],a=new dt(r.getIntersection(o));this.addIntersection(a,i)}};Lo.prototype.toString=function(){return xc.toLineString(new Mo(this._pts))};Lo.prototype.getNodeList=function(){return this._nodeList};Lo.prototype.addIntersectionNode=function(e,n){var r=n,i=r+1;if(i<this._pts.length){var o=this._pts[i];e.equals2D(o)&&(r=i)}var a=this._nodeList.add(e,r);return a};Lo.prototype.addIntersections=function(e,n,r){for(var i=this,o=0;o<e.getIntersectionNum();o++)i.addIntersection(e,n,r,o)};Lo.prototype.interfaces_=function(){return[Yw]};Lo.prototype.getClass=function(){return Lo};Lo.getNodedSubstrings=function(){if(arguments.length===1){var e=arguments[0],n=new bn;return Lo.getNodedSubstrings(e,n),n}else if(arguments.length===2)for(var r=arguments[0],i=arguments[1],o=r.iterator();o.hasNext();){var a=o.next();a.getNodeList().addSplitEdges(i)}};var Jn=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new dt,this.p1=new dt;else if(arguments.length===1){var e=arguments[0];this.p0=new dt(e.p0),this.p1=new dt(e.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var n=arguments[0],r=arguments[1],i=arguments[2],o=arguments[3];this.p0=new dt(n,r),this.p1=new dt(i,o)}},Kre={serialVersionUID:{configurable:!0}};Jn.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};Jn.prototype.orientationIndex=function(){if(arguments[0]instanceof Jn){var e=arguments[0],n=Rn.orientationIndex(this.p0,this.p1,e.p0),r=Rn.orientationIndex(this.p0,this.p1,e.p1);return n>=0&&r>=0||n<=0&&r<=0?Math.max(n,r):0}else if(arguments[0]instanceof dt){var i=arguments[0];return Rn.orientationIndex(this.p0,this.p1,i)}};Jn.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])};Jn.prototype.isVertical=function(){return this.p0.x===this.p1.x};Jn.prototype.equals=function(e){if(!(e instanceof Jn))return!1;var n=e;return this.p0.equals(n.p0)&&this.p1.equals(n.p1)};Jn.prototype.intersection=function(e){var n=new vA;return n.computeIntersection(this.p0,this.p1,e.p0,e.p1),n.hasIntersection()?n.getIntersection(0):null};Jn.prototype.project=function(){if(arguments[0]instanceof dt){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new dt(e);var n=this.projectionFactor(e),r=new dt;return r.x=this.p0.x+n*(this.p1.x-this.p0.x),r.y=this.p0.y+n*(this.p1.y-this.p0.y),r}else if(arguments[0]instanceof Jn){var i=arguments[0],o=this.projectionFactor(i.p0),a=this.projectionFactor(i.p1);if(o>=1&&a>=1||o<=0&&a<=0)return null;var s=this.project(i.p0);o<0&&(s=this.p0),o>1&&(s=this.p1);var u=this.project(i.p1);return a<0&&(u=this.p0),a>1&&(u=this.p1),new Jn(s,u)}};Jn.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};Jn.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};Jn.prototype.getCoordinate=function(e){return e===0?this.p0:this.p1};Jn.prototype.distancePerpendicular=function(e){return Rn.distancePointLinePerpendicular(e,this.p0,this.p1)};Jn.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};Jn.prototype.midPoint=function(){return Jn.midPoint(this.p0,this.p1)};Jn.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var n=this.p1.x-this.p0.x,r=this.p1.y-this.p0.y,i=n*n+r*r;if(i<=0)return mr.NaN;var o=((e.x-this.p0.x)*n+(e.y-this.p0.y)*r)/i;return o};Jn.prototype.closestPoints=function(e){var n=this.intersection(e);if(n!==null)return[n,n];var r=new Array(2).fill(null),i=mr.MAX_VALUE,o=null,a=this.closestPoint(e.p0);i=a.distance(e.p0),r[0]=a,r[1]=e.p0;var s=this.closestPoint(e.p1);o=s.distance(e.p1),o<i&&(i=o,r[0]=s,r[1]=e.p1);var u=e.closestPoint(this.p0);o=u.distance(this.p0),o<i&&(i=o,r[0]=this.p0,r[1]=u);var d=e.closestPoint(this.p1);return o=d.distance(this.p1),o<i&&(i=o,r[0]=this.p1,r[1]=d),r};Jn.prototype.closestPoint=function(e){var n=this.projectionFactor(e);if(n>0&&n<1)return this.project(e);var r=this.p0.distance(e),i=this.p1.distance(e);return r<i?this.p0:this.p1};Jn.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};Jn.prototype.getLength=function(){return this.p0.distance(this.p1)};Jn.prototype.compareTo=function(e){var n=e,r=this.p0.compareTo(n.p0);return r!==0?r:this.p1.compareTo(n.p1)};Jn.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e};Jn.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)};Jn.prototype.lineIntersection=function(e){try{var n=mc.intersection(this.p0,this.p1,e.p0,e.p1);return n}catch(r){if(!(r instanceof F1))throw r}finally{}return null};Jn.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};Jn.prototype.pointAlongOffset=function(e,n){var r=this.p0.x+e*(this.p1.x-this.p0.x),i=this.p0.y+e*(this.p1.y-this.p0.y),o=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,s=Math.sqrt(o*o+a*a),u=0,d=0;if(n!==0){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");u=n*o/s,d=n*a/s}var g=r-d,_=i+u,E=new dt(g,_);return E};Jn.prototype.setCoordinates=function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.p0.x=n.x,this.p0.y=n.y,this.p1.x=r.x,this.p1.y=r.y}};Jn.prototype.segmentFraction=function(e){var n=this.projectionFactor(e);return n<0?n=0:(n>1||mr.isNaN(n))&&(n=1),n};Jn.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};Jn.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};Jn.prototype.distance=function(){if(arguments[0]instanceof Jn){var e=arguments[0];return Rn.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}else if(arguments[0]instanceof dt){var n=arguments[0];return Rn.distancePointLine(n,this.p0,this.p1)}};Jn.prototype.pointAlong=function(e){var n=new dt;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n};Jn.prototype.hashCode=function(){var e=mr.doubleToLongBits(this.p0.x);e^=mr.doubleToLongBits(this.p0.y)*31;var n=Math.trunc(e)^Math.trunc(e>>32),r=mr.doubleToLongBits(this.p1.x);r^=mr.doubleToLongBits(this.p1.y)*31;var i=Math.trunc(r)^Math.trunc(r>>32);return n^i};Jn.prototype.interfaces_=function(){return[Uu,Gu]};Jn.prototype.getClass=function(){return Jn};Jn.midPoint=function(e,n){return new dt((e.x+n.x)/2,(e.y+n.y)/2)};Kre.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(Jn,Kre);var Qw=function(){this.tempEnv1=new Qn,this.tempEnv2=new Qn,this._overlapSeg1=new Jn,this._overlapSeg2=new Jn};Qw.prototype.overlap=function(){if(arguments.length!==2){if(arguments.length===4){var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];e.getLineSegment(n,this._overlapSeg1),r.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}};Qw.prototype.interfaces_=function(){return[]};Qw.prototype.getClass=function(){return Qw};var Ol=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];this._pts=e,this._start=n,this._end=r,this._context=i};Ol.prototype.getLineSegment=function(e,n){n.p0=this._pts[e],n.p1=this._pts[e+1]};Ol.prototype.computeSelect=function(e,n,r,i){var o=this._pts[n],a=this._pts[r];if(i.tempEnv1.init(o,a),r-n===1)return i.select(this,n),null;if(!e.intersects(i.tempEnv1))return null;var s=Math.trunc((n+r)/2);n<s&&this.computeSelect(e,n,s,i),s<r&&this.computeSelect(e,s,r,i)};Ol.prototype.getCoordinates=function(){for(var e=this,n=new Array(this._end-this._start+1).fill(null),r=0,i=this._start;i<=this._end;i++)n[r++]=e._pts[i];return n};Ol.prototype.computeOverlaps=function(e,n){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,n)};Ol.prototype.setId=function(e){this._id=e};Ol.prototype.select=function(e,n){this.computeSelect(e,this._start,this._end,n)};Ol.prototype.getEnvelope=function(){if(this._env===null){var e=this._pts[this._start],n=this._pts[this._end];this._env=new Qn(e,n)}return this._env};Ol.prototype.getEndIndex=function(){return this._end};Ol.prototype.getStartIndex=function(){return this._start};Ol.prototype.getContext=function(){return this._context};Ol.prototype.getId=function(){return this._id};Ol.prototype.computeOverlapsInternal=function(e,n,r,i,o,a){var s=this._pts[e],u=this._pts[n],d=r._pts[i],g=r._pts[o];if(n-e===1&&o-i===1)return a.overlap(this,e,r,i),null;if(a.tempEnv1.init(s,u),a.tempEnv2.init(d,g),!a.tempEnv1.intersects(a.tempEnv2))return null;var _=Math.trunc((e+n)/2),E=Math.trunc((i+o)/2);e<_&&(i<E&&this.computeOverlapsInternal(e,_,r,i,E,a),E<o&&this.computeOverlapsInternal(e,_,r,E,o,a)),_<n&&(i<E&&this.computeOverlapsInternal(_,n,r,i,E,a),E<o&&this.computeOverlapsInternal(_,n,r,E,o,a))};Ol.prototype.interfaces_=function(){return[]};Ol.prototype.getClass=function(){return Ol};var Af=function(){};Af.prototype.interfaces_=function(){return[]};Af.prototype.getClass=function(){return Af};Af.getChainStartIndices=function(e){var n=0,r=new bn;r.add(new bf(n));do{var i=Af.findChainEnd(e,n);r.add(new bf(i)),n=i}while(n<e.length-1);var o=Af.toIntArray(r);return o};Af.findChainEnd=function(e,n){for(var r=n;r<e.length-1&&e[r].equals2D(e[r+1]);)r++;if(r>=e.length-1)return e.length-1;for(var i=yi.quadrant(e[r],e[r+1]),o=n+1;o<e.length;){if(!e[o-1].equals2D(e[o])){var a=yi.quadrant(e[o-1],e[o]);if(a!==i)break}o++}return o-1};Af.getChains=function(){if(arguments.length===1){var e=arguments[0];return Af.getChains(e,null)}else if(arguments.length===2){for(var n=arguments[0],r=arguments[1],i=new bn,o=Af.getChainStartIndices(n),a=0;a<o.length-1;a++){var s=new Ol(n,o[a],o[a+1],r);i.add(s)}return i}};Af.toIntArray=function(e){for(var n=new Array(e.size()).fill(null),r=0;r<n.length;r++)n[r]=e.get(r).intValue();return n};var eA=function(){};eA.prototype.computeNodes=function(e){};eA.prototype.getNodedSubstrings=function(){};eA.prototype.interfaces_=function(){return[]};eA.prototype.getClass=function(){return eA};var Kw=function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}}};Kw.prototype.setSegmentIntersector=function(e){this._segInt=e};Kw.prototype.interfaces_=function(){return[eA]};Kw.prototype.getClass=function(){return Kw};var b6=function(t){function e(r){r?t.call(this,r):t.call(this),this._monoChains=new bn,this._index=new Qre,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return Lo.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(i){for(var o=this,a=Af.getChains(i.getCoordinates(),i),s=a.iterator();s.hasNext();){var u=s.next();u.setId(o._idCounter++),o._index.insert(u.getEnvelope(),u),o._monoChains.add(u)}},e.prototype.computeNodes=function(i){var o=this;this._nodedSegStrings=i;for(var a=i.iterator();a.hasNext();)o.add(a.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var i=this,o=new o7(this._segInt),a=this._monoChains.iterator();a.hasNext();)for(var s=a.next(),u=i._index.query(s.getEnvelope()),d=u.iterator();d.hasNext();){var g=d.next();if(g.getId()>s.getId()&&(s.computeOverlaps(g,o),i._nOverlaps++),i._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return o7},Object.defineProperties(e,n),e}(Kw),o7=function(t){function e(){t.call(this),this._si=null;var n=arguments[0];this._si=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(arguments.length===4){var r=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3],s=r.getContext(),u=o.getContext();this._si.processIntersections(s,i,u,a)}else return t.prototype.overlap.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Qw),oi=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setQuadrantSegments(e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(arguments.length===4){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(o),this.setJoinStyle(a),this.setMitreLimit(s)}}},tp={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};oi.prototype.getEndCapStyle=function(){return this._endCapStyle};oi.prototype.isSingleSided=function(){return this._isSingleSided};oi.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=oi.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=oi.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==oi.JOIN_ROUND&&(this._quadrantSegments=oi.DEFAULT_QUADRANT_SEGMENTS)};oi.prototype.getJoinStyle=function(){return this._joinStyle};oi.prototype.setJoinStyle=function(e){this._joinStyle=e};oi.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e};oi.prototype.getSimplifyFactor=function(){return this._simplifyFactor};oi.prototype.getQuadrantSegments=function(){return this._quadrantSegments};oi.prototype.setEndCapStyle=function(e){this._endCapStyle=e};oi.prototype.getMitreLimit=function(){return this._mitreLimit};oi.prototype.setMitreLimit=function(e){this._mitreLimit=e};oi.prototype.setSingleSided=function(e){this._isSingleSided=e};oi.prototype.interfaces_=function(){return[]};oi.prototype.getClass=function(){return oi};oi.bufferDistanceError=function(e){var n=Math.PI/2/e;return 1-Math.cos(n/2)};tp.CAP_ROUND.get=function(){return 1};tp.CAP_FLAT.get=function(){return 2};tp.CAP_SQUARE.get=function(){return 3};tp.JOIN_ROUND.get=function(){return 1};tp.JOIN_MITRE.get=function(){return 2};tp.JOIN_BEVEL.get=function(){return 3};tp.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};tp.DEFAULT_MITRE_LIMIT.get=function(){return 5};tp.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(oi,tp);var Eo=function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Rn.COUNTERCLOCKWISE,this._inputLine=e||null},JE={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Eo.prototype.isDeletable=function(e,n,r,i){var o=this._inputLine[e],a=this._inputLine[n],s=this._inputLine[r];return!this.isConcave(o,a,s)||!this.isShallow(o,a,s,i)?!1:this.isShallowSampled(o,a,e,r,i)};Eo.prototype.deleteShallowConcavities=function(){for(var e=this,n=1,r=this.findNextNonDeletedIndex(n),i=this.findNextNonDeletedIndex(r),o=!1;i<this._inputLine.length;){var a=!1;e.isDeletable(n,r,i,e._distanceTol)&&(e._isDeleted[r]=Eo.DELETE,a=!0,o=!0),a?n=i:n=r,r=e.findNextNonDeletedIndex(n),i=e.findNextNonDeletedIndex(r)}return o};Eo.prototype.isShallowConcavity=function(e,n,r,i){var o=Rn.computeOrientation(e,n,r),a=o===this._angleOrientation;if(!a)return!1;var s=Rn.distancePointLine(n,e,r);return s<i};Eo.prototype.isShallowSampled=function(e,n,r,i,o){var a=this,s=Math.trunc((i-r)/Eo.NUM_PTS_TO_CHECK);s<=0&&(s=1);for(var u=r;u<i;u+=s)if(!a.isShallow(e,n,a._inputLine[u],o))return!1;return!0};Eo.prototype.isConcave=function(e,n,r){var i=Rn.computeOrientation(e,n,r),o=i===this._angleOrientation;return o};Eo.prototype.simplify=function(e){var n=this;this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=Rn.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var r=!1;do r=n.deleteShallowConcavities();while(r);return this.collapseLine()};Eo.prototype.findNextNonDeletedIndex=function(e){for(var n=e+1;n<this._inputLine.length&&this._isDeleted[n]===Eo.DELETE;)n++;return n};Eo.prototype.isShallow=function(e,n,r,i){var o=Rn.distancePointLine(n,e,r);return o<i};Eo.prototype.collapseLine=function(){for(var e=this,n=new YE,r=0;r<this._inputLine.length;r++)e._isDeleted[r]!==Eo.DELETE&&n.add(e._inputLine[r]);return n.toCoordinateArray()};Eo.prototype.interfaces_=function(){return[]};Eo.prototype.getClass=function(){return Eo};Eo.simplify=function(e,n){var r=new Eo(e);return r.simplify(n)};JE.INIT.get=function(){return 0};JE.DELETE.get=function(){return 1};JE.KEEP.get=function(){return 1};JE.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(Eo,JE);var tu=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new bn},Jre={COORDINATE_ARRAY_TYPE:{configurable:!0}};tu.prototype.getCoordinates=function(){var e=this._ptList.toArray(tu.COORDINATE_ARRAY_TYPE);return e};tu.prototype.setPrecisionModel=function(e){this._precisionModel=e};tu.prototype.addPt=function(e){var n=new dt(e);if(this._precisionModel.makePrecise(n),this.isRedundant(n))return null;this._ptList.add(n)};tu.prototype.revere=function(){};tu.prototype.addPts=function(e,n){var r=this;if(n)for(var i=0;i<e.length;i++)r.addPt(e[i]);else for(var o=e.length-1;o>=0;o--)r.addPt(e[o])};tu.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var n=this._ptList.get(this._ptList.size()-1),r=e.distance(n);return r<this._minimimVertexDistance};tu.prototype.toString=function(){var e=new kr,n=e.createLineString(this.getCoordinates());return n.toString()};tu.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new dt(this._ptList.get(0)),n=this._ptList.get(this._ptList.size()-1);if(e.equals(n))return null;this._ptList.add(e)};tu.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e};tu.prototype.interfaces_=function(){return[]};tu.prototype.getClass=function(){return tu};Jre.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(tu,Jre);var Wr=function(){},__={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Wr.prototype.interfaces_=function(){return[]};Wr.prototype.getClass=function(){return Wr};Wr.toDegrees=function(e){return e*180/Math.PI};Wr.normalize=function(e){for(;e>Math.PI;)e-=Wr.PI_TIMES_2;for(;e<=-Math.PI;)e+=Wr.PI_TIMES_2;return e};Wr.angle=function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=r.x-n.x,o=r.y-n.y;return Math.atan2(o,i)}};Wr.isAcute=function(e,n,r){var i=e.x-n.x,o=e.y-n.y,a=r.x-n.x,s=r.y-n.y,u=i*a+o*s;return u>0};Wr.isObtuse=function(e,n,r){var i=e.x-n.x,o=e.y-n.y,a=r.x-n.x,s=r.y-n.y,u=i*a+o*s;return u<0};Wr.interiorAngle=function(e,n,r){var i=Wr.angle(n,e),o=Wr.angle(n,r);return Math.abs(o-i)};Wr.normalizePositive=function(e){if(e<0){for(;e<0;)e+=Wr.PI_TIMES_2;e>=Wr.PI_TIMES_2&&(e=0)}else{for(;e>=Wr.PI_TIMES_2;)e-=Wr.PI_TIMES_2;e<0&&(e=0)}return e};Wr.angleBetween=function(e,n,r){var i=Wr.angle(n,e),o=Wr.angle(n,r);return Wr.diff(i,o)};Wr.diff=function(e,n){var r=null;return e<n?r=n-e:r=e-n,r>Math.PI&&(r=2*Math.PI-r),r};Wr.toRadians=function(e){return e*Math.PI/180};Wr.getTurn=function(e,n){var r=Math.sin(n-e);return r>0?Wr.COUNTERCLOCKWISE:r<0?Wr.CLOCKWISE:Wr.NONE};Wr.angleBetweenOriented=function(e,n,r){var i=Wr.angle(n,e),o=Wr.angle(n,r),a=o-i;return a<=-Math.PI?a+Wr.PI_TIMES_2:a>Math.PI?a-Wr.PI_TIMES_2:a};__.PI_TIMES_2.get=function(){return 2*Math.PI};__.PI_OVER_2.get=function(){return Math.PI/2};__.PI_OVER_4.get=function(){return Math.PI/4};__.COUNTERCLOCKWISE.get=function(){return Rn.COUNTERCLOCKWISE};__.CLOCKWISE.get=function(){return Rn.CLOCKWISE};__.NONE.get=function(){return Rn.COLLINEAR};Object.defineProperties(Wr,__);var eo=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Jn,this._seg1=new Jn,this._offset0=new Jn,this._offset1=new Jn,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=e,this._bufParams=n,this._li=new vA,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===oi.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},e2={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};eo.prototype.addNextSegment=function(e,n){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var r=Rn.computeOrientation(this._s0,this._s1,this._s2),i=r===Rn.CLOCKWISE&&this._side===gn.LEFT||r===Rn.COUNTERCLOCKWISE&&this._side===gn.RIGHT;r===0?this.addCollinear(n):i?this.addOutsideTurn(r,n):this.addInsideTurn(r,n)};eo.prototype.addLineEndCap=function(e,n){var r=new Jn(e,n),i=new Jn;this.computeOffsetSegment(r,gn.LEFT,this._distance,i);var o=new Jn;this.computeOffsetSegment(r,gn.RIGHT,this._distance,o);var a=n.x-e.x,s=n.y-e.y,u=Math.atan2(s,a);switch(this._bufParams.getEndCapStyle()){case oi.CAP_ROUND:this._segList.addPt(i.p1),this.addFilletArc(n,u+Math.PI/2,u-Math.PI/2,Rn.CLOCKWISE,this._distance),this._segList.addPt(o.p1);break;case oi.CAP_FLAT:this._segList.addPt(i.p1),this._segList.addPt(o.p1);break;case oi.CAP_SQUARE:var d=new dt;d.x=Math.abs(this._distance)*Math.cos(u),d.y=Math.abs(this._distance)*Math.sin(u);var g=new dt(i.p1.x+d.x,i.p1.y+d.y),_=new dt(o.p1.x+d.x,o.p1.y+d.y);this._segList.addPt(g),this._segList.addPt(_);break}};eo.prototype.getCoordinates=function(){var e=this._segList.getCoordinates();return e};eo.prototype.addMitreJoin=function(e,n,r,i){var o=!0,a=null;try{a=mc.intersection(n.p0,n.p1,r.p0,r.p1);var s=i<=0?1:a.distance(e)/Math.abs(i);s>this._bufParams.getMitreLimit()&&(o=!1)}catch(u){if(u instanceof F1)a=new dt(0,0),o=!1;else throw u}finally{}o?this._segList.addPt(a):this.addLimitedMitreJoin(n,r,i,this._bufParams.getMitreLimit())};eo.prototype.addFilletCorner=function(e,n,r,i,o){var a=n.x-e.x,s=n.y-e.y,u=Math.atan2(s,a),d=r.x-e.x,g=r.y-e.y,_=Math.atan2(g,d);i===Rn.CLOCKWISE?u<=_&&(u+=2*Math.PI):u>=_&&(u-=2*Math.PI),this._segList.addPt(n),this.addFilletArc(e,u,_,i,o),this._segList.addPt(r)};eo.prototype.addOutsideTurn=function(e,n){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*eo.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===oi.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===oi.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(n&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))};eo.prototype.createSquare=function(e){this._segList.addPt(new dt(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new dt(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new dt(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new dt(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()};eo.prototype.addSegments=function(e,n){this._segList.addPts(e,n)};eo.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};eo.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};eo.prototype.initSideSegments=function(e,n,r){this._s1=e,this._s2=n,this._side=r,this._seg1.setCoordinates(e,n),this.computeOffsetSegment(this._seg1,r,this._distance,this._offset1)};eo.prototype.addLimitedMitreJoin=function(e,n,r,i){var o=this._seg0.p1,a=Wr.angle(o,this._seg0.p0),s=Wr.angleBetweenOriented(this._seg0.p0,o,this._seg1.p1),u=s/2,d=Wr.normalize(a+u),g=Wr.normalize(d+Math.PI),_=i*r,E=_*Math.abs(Math.sin(u)),P=r-E,R=o.x+_*Math.cos(g),B=o.y+_*Math.sin(g),V=new dt(R,B),z=new Jn(o,V),F=z.pointAlongOffset(1,P),k=z.pointAlongOffset(1,-P);this._side===gn.LEFT?(this._segList.addPt(F),this._segList.addPt(k)):(this._segList.addPt(k),this._segList.addPt(F))};eo.prototype.computeOffsetSegment=function(e,n,r,i){var o=n===gn.LEFT?1:-1,a=e.p1.x-e.p0.x,s=e.p1.y-e.p0.y,u=Math.sqrt(a*a+s*s),d=o*r*a/u,g=o*r*s/u;i.p0.x=e.p0.x-g,i.p0.y=e.p0.y+d,i.p1.x=e.p1.x-g,i.p1.y=e.p1.y+d};eo.prototype.addFilletArc=function(e,n,r,i,o){var a=this,s=i===Rn.CLOCKWISE?-1:1,u=Math.abs(n-r),d=Math.trunc(u/this._filletAngleQuantum+.5);if(d<1)return null;for(var g=0,_=u/d,E=g,P=new dt;E<u;){var R=n+s*E;P.x=e.x+o*Math.cos(R),P.y=e.y+o*Math.sin(R),a._segList.addPt(P),E+=_}};eo.prototype.addInsideTurn=function(e,n){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*eo.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var r=new dt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r);var i=new dt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};eo.prototype.createCircle=function(e){var n=new dt(e.x+this._distance,e.y);this._segList.addPt(n),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};eo.prototype.addBevelJoin=function(e,n){this._segList.addPt(e.p1),this._segList.addPt(n.p0)};eo.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new tu,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*eo.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};eo.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var n=this._li.getIntersectionNum();n>=2&&(this._bufParams.getJoinStyle()===oi.JOIN_BEVEL||this._bufParams.getJoinStyle()===oi.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Rn.CLOCKWISE,this._distance))};eo.prototype.closeRing=function(){this._segList.closeRing()};eo.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};eo.prototype.interfaces_=function(){return[]};eo.prototype.getClass=function(){return eo};e2.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};e2.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};e2.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};e2.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(eo,e2);var Ja=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],n=arguments[1];this._precisionModel=e,this._bufParams=n};Ja.prototype.getOffsetCurve=function(e,n){if(this._distance=n,n===0)return null;var r=n<0,i=Math.abs(n),o=this.getSegGen(i);e.length<=1?this.computePointCurve(e[0],o):this.computeOffsetCurve(e,r,o);var a=o.getCoordinates();return r&&zr.reverse(a),a};Ja.prototype.computeSingleSidedBufferCurve=function(e,n,r){var i=this.simplifyTolerance(this._distance);if(n){r.addSegments(e,!0);var o=Eo.simplify(e,-i),a=o.length-1;r.initSideSegments(o[a],o[a-1],gn.LEFT),r.addFirstSegment();for(var s=a-2;s>=0;s--)r.addNextSegment(o[s],!0)}else{r.addSegments(e,!1);var u=Eo.simplify(e,i),d=u.length-1;r.initSideSegments(u[0],u[1],gn.LEFT),r.addFirstSegment();for(var g=2;g<=d;g++)r.addNextSegment(u[g],!0)}r.addLastSegment(),r.closeRing()};Ja.prototype.computeRingBufferCurve=function(e,n,r){var i=this.simplifyTolerance(this._distance);n===gn.RIGHT&&(i=-i);var o=Eo.simplify(e,i),a=o.length-1;r.initSideSegments(o[a-1],o[0],n);for(var s=1;s<=a;s++){var u=s!==1;r.addNextSegment(o[s],u)}r.closeRing()};Ja.prototype.computeLineBufferCurve=function(e,n){var r=this.simplifyTolerance(this._distance),i=Eo.simplify(e,r),o=i.length-1;n.initSideSegments(i[0],i[1],gn.LEFT);for(var a=2;a<=o;a++)n.addNextSegment(i[a],!0);n.addLastSegment(),n.addLineEndCap(i[o-1],i[o]);var s=Eo.simplify(e,-r),u=s.length-1;n.initSideSegments(s[u],s[u-1],gn.LEFT);for(var d=u-2;d>=0;d--)n.addNextSegment(s[d],!0);n.addLastSegment(),n.addLineEndCap(s[1],s[0]),n.closeRing()};Ja.prototype.computePointCurve=function(e,n){switch(this._bufParams.getEndCapStyle()){case oi.CAP_ROUND:n.createCircle(e);break;case oi.CAP_SQUARE:n.createSquare(e);break}};Ja.prototype.getLineCurve=function(e,n){if(this._distance=n,n<0&&!this._bufParams.isSingleSided()||n===0)return null;var r=Math.abs(n),i=this.getSegGen(r);if(e.length<=1)this.computePointCurve(e[0],i);else if(this._bufParams.isSingleSided()){var o=n<0;this.computeSingleSidedBufferCurve(e,o,i)}else this.computeLineBufferCurve(e,i);var a=i.getCoordinates();return a};Ja.prototype.getBufferParameters=function(){return this._bufParams};Ja.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()};Ja.prototype.getRingCurve=function(e,n,r){if(this._distance=r,e.length<=2)return this.getLineCurve(e,r);if(r===0)return Ja.copyCoordinates(e);var i=this.getSegGen(r);return this.computeRingBufferCurve(e,n,i),i.getCoordinates()};Ja.prototype.computeOffsetCurve=function(e,n,r){var i=this.simplifyTolerance(this._distance);if(n){var o=Eo.simplify(e,-i),a=o.length-1;r.initSideSegments(o[a],o[a-1],gn.LEFT),r.addFirstSegment();for(var s=a-2;s>=0;s--)r.addNextSegment(o[s],!0)}else{var u=Eo.simplify(e,i),d=u.length-1;r.initSideSegments(u[0],u[1],gn.LEFT),r.addFirstSegment();for(var g=2;g<=d;g++)r.addNextSegment(u[g],!0)}r.addLastSegment()};Ja.prototype.getSegGen=function(e){return new eo(this._precisionModel,this._bufParams,e)};Ja.prototype.interfaces_=function(){return[]};Ja.prototype.getClass=function(){return Ja};Ja.copyCoordinates=function(e){for(var n=new Array(e.length).fill(null),r=0;r<n.length;r++)n[r]=new dt(e[r]);return n};var $0=function(){this._subgraphs=null,this._seg=new Jn,this._cga=new Rn;var e=arguments[0];this._subgraphs=e},eie={DepthSegment:{configurable:!0}};$0.prototype.findStabbedSegments=function(){var e=this;if(arguments.length===1){for(var n=arguments[0],r=new bn,i=this._subgraphs.iterator();i.hasNext();){var o=i.next(),a=o.getEnvelope();n.y<a.getMinY()||n.y>a.getMaxY()||e.findStabbedSegments(n,o.getDirectedEdges(),r)}return r}else if(arguments.length===3){if(ar(arguments[2],Ac)&&arguments[0]instanceof dt&&arguments[1]instanceof yk)for(var s=arguments[0],u=arguments[1],d=arguments[2],g=u.getEdge().getCoordinates(),_=0;_<g.length-1;_++){e._seg.p0=g[_],e._seg.p1=g[_+1],e._seg.p0.y>e._seg.p1.y&&e._seg.reverse();var E=Math.max(e._seg.p0.x,e._seg.p1.x);if(!(E<s.x)&&!e._seg.isHorizontal()&&!(s.y<e._seg.p0.y||s.y>e._seg.p1.y)&&Rn.computeOrientation(e._seg.p0,e._seg.p1,s)!==Rn.RIGHT){var P=u.getDepth(gn.LEFT);e._seg.p0.equals(g[_])||(P=u.getDepth(gn.RIGHT));var R=new tA(e._seg,P);d.add(R)}}else if(ar(arguments[2],Ac)&&arguments[0]instanceof dt&&ar(arguments[1],Ac))for(var B=arguments[0],V=arguments[1],z=arguments[2],F=V.iterator();F.hasNext();){var k=F.next();k.isForward()&&e.findStabbedSegments(B,k,z)}}};$0.prototype.getDepth=function(e){var n=this.findStabbedSegments(e);if(n.size()===0)return 0;var r=Ec.min(n);return r._leftDepth};$0.prototype.interfaces_=function(){return[]};$0.prototype.getClass=function(){return $0};eie.DepthSegment.get=function(){return tA};Object.defineProperties($0,eie);var tA=function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],n=arguments[1];this._upwardSeg=new Jn(e),this._leftDepth=n};tA.prototype.compareTo=function(e){var n=e;if(this._upwardSeg.minX()>=n._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=n._upwardSeg.minX())return-1;var r=this._upwardSeg.orientationIndex(n._upwardSeg);return r!==0||(r=-1*n._upwardSeg.orientationIndex(this._upwardSeg),r!==0)?r:this._upwardSeg.compareTo(n._upwardSeg)};tA.prototype.compareX=function(e,n){var r=e.p0.compareTo(n.p0);return r!==0?r:e.p1.compareTo(n.p1)};tA.prototype.toString=function(){return this._upwardSeg.toString()};tA.prototype.interfaces_=function(){return[Uu]};tA.prototype.getClass=function(){return tA};var ai=function(e,n,r){this.p0=e||null,this.p1=n||null,this.p2=r||null};ai.prototype.area=function(){return ai.area(this.p0,this.p1,this.p2)};ai.prototype.signedArea=function(){return ai.signedArea(this.p0,this.p1,this.p2)};ai.prototype.interpolateZ=function(e){if(e===null)throw new oo("Supplied point is null.");return ai.interpolateZ(e,this.p0,this.p1,this.p2)};ai.prototype.longestSideLength=function(){return ai.longestSideLength(this.p0,this.p1,this.p2)};ai.prototype.isAcute=function(){return ai.isAcute(this.p0,this.p1,this.p2)};ai.prototype.circumcentre=function(){return ai.circumcentre(this.p0,this.p1,this.p2)};ai.prototype.area3D=function(){return ai.area3D(this.p0,this.p1,this.p2)};ai.prototype.centroid=function(){return ai.centroid(this.p0,this.p1,this.p2)};ai.prototype.inCentre=function(){return ai.inCentre(this.p0,this.p1,this.p2)};ai.prototype.interfaces_=function(){return[]};ai.prototype.getClass=function(){return ai};ai.area=function(e,n,r){return Math.abs(((r.x-e.x)*(n.y-e.y)-(n.x-e.x)*(r.y-e.y))/2)};ai.signedArea=function(e,n,r){return((r.x-e.x)*(n.y-e.y)-(n.x-e.x)*(r.y-e.y))/2};ai.det=function(e,n,r,i){return e*i-n*r};ai.interpolateZ=function(e,n,r,i){var o=n.x,a=n.y,s=r.x-o,u=i.x-o,d=r.y-a,g=i.y-a,_=s*g-u*d,E=e.x-o,P=e.y-a,R=(g*E-u*P)/_,B=(-d*E+s*P)/_,V=n.z+R*(r.z-n.z)+B*(i.z-n.z);return V};ai.longestSideLength=function(e,n,r){var i=e.distance(n),o=n.distance(r),a=r.distance(e),s=i;return o>s&&(s=o),a>s&&(s=a),s};ai.isAcute=function(e,n,r){return!(!Wr.isAcute(e,n,r)||!Wr.isAcute(n,r,e)||!Wr.isAcute(r,e,n))};ai.circumcentre=function(e,n,r){var i=r.x,o=r.y,a=e.x-i,s=e.y-o,u=n.x-i,d=n.y-o,g=2*ai.det(a,s,u,d),_=ai.det(s,a*a+s*s,d,u*u+d*d),E=ai.det(a,a*a+s*s,u,u*u+d*d),P=i-_/g,R=o+E/g;return new dt(P,R)};ai.perpendicularBisector=function(e,n){var r=n.x-e.x,i=n.y-e.y,o=new mc(e.x+r/2,e.y+i/2,1),a=new mc(e.x-i+r/2,e.y+r+i/2,1);return new mc(o,a)};ai.angleBisector=function(e,n,r){var i=n.distance(e),o=n.distance(r),a=i/(i+o),s=r.x-e.x,u=r.y-e.y,d=new dt(e.x+a*s,e.y+a*u);return d};ai.area3D=function(e,n,r){var i=n.x-e.x,o=n.y-e.y,a=n.z-e.z,s=r.x-e.x,u=r.y-e.y,d=r.z-e.z,g=o*d-a*u,_=a*s-i*d,E=i*u-o*s,P=g*g+_*_+E*E,R=Math.sqrt(P)/2;return R};ai.centroid=function(e,n,r){var i=(e.x+n.x+r.x)/3,o=(e.y+n.y+r.y)/3;return new dt(i,o)};ai.inCentre=function(e,n,r){var i=n.distance(r),o=e.distance(r),a=e.distance(n),s=i+o+a,u=(i*e.x+o*n.x+a*r.x)/s,d=(i*e.y+o*n.y+a*r.y)/s;return new dt(u,d)};var ku=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new bn;var e=arguments[0],n=arguments[1],r=arguments[2];this._inputGeom=e,this._distance=n,this._curveBuilder=r};ku.prototype.addPoint=function(e){if(this._distance<=0)return null;var n=e.getCoordinates(),r=this._curveBuilder.getLineCurve(n,this._distance);this.addCurve(r,Et.EXTERIOR,Et.INTERIOR)};ku.prototype.addPolygon=function(e){var n=this,r=this._distance,i=gn.LEFT;this._distance<0&&(r=-this._distance,i=gn.RIGHT);var o=e.getExteriorRing(),a=zr.removeRepeatedPoints(o.getCoordinates());if(this._distance<0&&this.isErodedCompletely(o,this._distance)||this._distance<=0&&a.length<3)return null;this.addPolygonRing(a,r,i,Et.EXTERIOR,Et.INTERIOR);for(var s=0;s<e.getNumInteriorRing();s++){var u=e.getInteriorRingN(s),d=zr.removeRepeatedPoints(u.getCoordinates());n._distance>0&&n.isErodedCompletely(u,-n._distance)||n.addPolygonRing(d,r,gn.opposite(i),Et.INTERIOR,Et.EXTERIOR)}};ku.prototype.isTriangleErodedCompletely=function(e,n){var r=new ai(e[0],e[1],e[2]),i=r.inCentre(),o=Rn.distancePointLine(i,r.p0,r.p1);return o<Math.abs(n)};ku.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var n=zr.removeRepeatedPoints(e.getCoordinates()),r=this._curveBuilder.getLineCurve(n,this._distance);this.addCurve(r,Et.EXTERIOR,Et.INTERIOR)};ku.prototype.addCurve=function(e,n,r){if(e===null||e.length<2)return null;var i=new Lo(e,new di(0,Et.BOUNDARY,n,r));this._curveList.add(i)};ku.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};ku.prototype.addPolygonRing=function(e,n,r,i,o){if(n===0&&e.length<Ph.MINIMUM_VALID_SIZE)return null;var a=i,s=o;e.length>=Ph.MINIMUM_VALID_SIZE&&Rn.isCCW(e)&&(a=o,s=i,r=gn.opposite(r));var u=this._curveBuilder.getRingCurve(e,r,n);this.addCurve(u,a,s)};ku.prototype.add=function(e){if(e.isEmpty())return null;e instanceof us?this.addPolygon(e):e instanceof bo?this.addLineString(e):e instanceof Il?this.addPoint(e):e instanceof Qv?this.addCollection(e):e instanceof Jm?this.addCollection(e):e instanceof yh?this.addCollection(e):e instanceof Ra&&this.addCollection(e)};ku.prototype.isErodedCompletely=function(e,n){var r=e.getCoordinates();if(r.length<4)return n<0;if(r.length===4)return this.isTriangleErodedCompletely(r,n);var i=e.getEnvelopeInternal(),o=Math.min(i.getHeight(),i.getWidth());return n<0&&2*Math.abs(n)>o};ku.prototype.addCollection=function(e){for(var n=this,r=0;r<e.getNumGeometries();r++){var i=e.getGeometryN(r);n.add(i)}};ku.prototype.interfaces_=function(){return[]};ku.prototype.getClass=function(){return ku};var t1=function(){};t1.prototype.locate=function(e){};t1.prototype.interfaces_=function(){return[]};t1.prototype.getClass=function(){return t1};var vh=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()};vh.prototype.next=function(){if(this._atStart)return this._atStart=!1,vh.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new z1;var e=this._parent.getGeometryN(this._index++);return e instanceof Ra?(this._subcollectionIterator=new vh(e),this._subcollectionIterator.next()):e};vh.prototype.remove=function(){throw new Error(this.getClass().getName())};vh.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};vh.prototype.interfaces_=function(){return[k1]};vh.prototype.getClass=function(){return vh};vh.isAtomic=function(e){return!(e instanceof Ra)};var Yl=function(){this._geom=null;var e=arguments[0];this._geom=e};Yl.prototype.locate=function(e){return Yl.locate(e,this._geom)};Yl.prototype.interfaces_=function(){return[t1]};Yl.prototype.getClass=function(){return Yl};Yl.isPointInRing=function(e,n){return n.getEnvelopeInternal().intersects(e)?Rn.isPointInRing(e,n.getCoordinates()):!1};Yl.containsPointInPolygon=function(e,n){if(n.isEmpty())return!1;var r=n.getExteriorRing();if(!Yl.isPointInRing(e,r))return!1;for(var i=0;i<n.getNumInteriorRing();i++){var o=n.getInteriorRingN(i);if(Yl.isPointInRing(e,o))return!1}return!0};Yl.containsPoint=function(e,n){if(n instanceof us)return Yl.containsPointInPolygon(e,n);if(n instanceof Ra)for(var r=new vh(n);r.hasNext();){var i=r.next();if(i!==n&&Yl.containsPoint(e,i))return!0}return!1};Yl.locate=function(e,n){return n.isEmpty()?Et.EXTERIOR:Yl.containsPoint(e,n)?Et.INTERIOR:Et.EXTERIOR};var ua=function(){this._edgeMap=new aa,this._edgeList=null,this._ptInAreaLocation=[Et.NONE,Et.NONE]};ua.prototype.getNextCW=function(e){this.getEdges();var n=this._edgeList.indexOf(e),r=n-1;return n===0&&(r=this._edgeList.size()-1),this._edgeList.get(r)};ua.prototype.propagateSideLabels=function(e){for(var n=Et.NONE,r=this.iterator();r.hasNext();){var i=r.next(),o=i.getLabel();o.isArea(e)&&o.getLocation(e,gn.LEFT)!==Et.NONE&&(n=o.getLocation(e,gn.LEFT))}if(n===Et.NONE)return null;for(var a=n,s=this.iterator();s.hasNext();){var u=s.next(),d=u.getLabel();if(d.getLocation(e,gn.ON)===Et.NONE&&d.setLocation(e,gn.ON,a),d.isArea(e)){var g=d.getLocation(e,gn.LEFT),_=d.getLocation(e,gn.RIGHT);if(_!==Et.NONE){if(_!==a)throw new Wd("side location conflict",u.getCoordinate());g===Et.NONE&&Pr.shouldNeverReachHere("found single null side (at "+u.getCoordinate()+")"),a=g}else Pr.isTrue(d.getLocation(e,gn.LEFT)===Et.NONE,"found single null side"),d.setLocation(e,gn.RIGHT,a),d.setLocation(e,gn.LEFT,a)}}};ua.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;var n=e.next();return n.getCoordinate()};ua.prototype.print=function(e){qs.out.println("EdgeEndStar:   "+this.getCoordinate());for(var n=this.iterator();n.hasNext();){var r=n.next();r.print(e)}};ua.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};ua.prototype.checkAreaLabelsConsistent=function(e){var n=this.getEdges();if(n.size()<=0)return!0;var r=n.size()-1,i=n.get(r).getLabel(),o=i.getLocation(e,gn.LEFT);Pr.isTrue(o!==Et.NONE,"Found unlabelled area edge");for(var a=o,s=this.iterator();s.hasNext();){var u=s.next(),d=u.getLabel();Pr.isTrue(d.isArea(e),"Found non-area edge");var g=d.getLocation(e,gn.LEFT),_=d.getLocation(e,gn.RIGHT);if(g===_||_!==a)return!1;a=g}return!0};ua.prototype.findIndex=function(e){var n=this;this.iterator();for(var r=0;r<this._edgeList.size();r++){var i=n._edgeList.get(r);if(i===e)return r}return-1};ua.prototype.iterator=function(){return this.getEdges().iterator()};ua.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new bn(this._edgeMap.values())),this._edgeList};ua.prototype.getLocation=function(e,n,r){return this._ptInAreaLocation[e]===Et.NONE&&(this._ptInAreaLocation[e]=Yl.locate(n,r[e].getGeometry())),this._ptInAreaLocation[e]};ua.prototype.toString=function(){var e=new Df;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var n=this.iterator();n.hasNext();){var r=n.next();e.append(r),e.append(`
`)}return e.toString()};ua.prototype.computeEdgeEndLabels=function(e){for(var n=this.iterator();n.hasNext();){var r=n.next();r.computeLabel(e)}};ua.prototype.computeLabelling=function(e){var n=this;this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var r=[!1,!1],i=this.iterator();i.hasNext();)for(var o=i.next(),a=o.getLabel(),s=0;s<2;s++)a.isLine(s)&&a.getLocation(s)===Et.BOUNDARY&&(r[s]=!0);for(var u=this.iterator();u.hasNext();)for(var d=u.next(),g=d.getLabel(),_=0;_<2;_++)if(g.isAnyNull(_)){var E=Et.NONE;if(r[_])E=Et.EXTERIOR;else{var P=d.getCoordinate();E=n.getLocation(_,P,e)}g.setAllLocationsIfNull(_,E)}};ua.prototype.getDegree=function(){return this._edgeMap.size()};ua.prototype.insertEdgeEnd=function(e,n){this._edgeMap.put(e,n),this._edgeList=null};ua.prototype.interfaces_=function(){return[]};ua.prototype.getClass=function(){return ua};var IRe=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var r=this;this.getResultAreaEdges();for(var i=null,o=null,a=this._SCANNING_FOR_INCOMING,s=0;s<this._resultAreaEdgeList.size();s++){var u=r._resultAreaEdgeList.get(s),d=u.getSym();if(u.getLabel().isArea())switch(i===null&&u.isInResult()&&(i=u),a){case r._SCANNING_FOR_INCOMING:if(!d.isInResult())continue;o=d,a=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(!u.isInResult())continue;o.setNext(u),a=r._SCANNING_FOR_INCOMING;break}}if(a===this._LINKING_TO_OUTGOING){if(i===null)throw new Wd("no outgoing dirEdge found",this.getCoordinate());Pr.isTrue(i.isInResult(),"unable to link last incoming dirEdge"),o.setNext(i)}},e.prototype.insert=function(r){var i=r;this.insertEdgeEnd(i,i)},e.prototype.getRightmostEdge=function(){var r=this.getEdges(),i=r.size();if(i<1)return null;var o=r.get(0);if(i===1)return o;var a=r.get(i-1),s=o.getQuadrant(),u=a.getQuadrant();return yi.isNorthern(s)&&yi.isNorthern(u)?o:!yi.isNorthern(s)&&!yi.isNorthern(u)?a:o.getDy()!==0?o:a.getDy()!==0?a:(Pr.shouldNeverReachHere("found two horizontal edges incident on node"),null)},e.prototype.print=function(r){qs.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var i=this.iterator();i.hasNext();){var o=i.next();r.print("out "),o.print(r),r.println(),r.print("in "),o.getSym().print(r),r.println()}},e.prototype.getResultAreaEdges=function(){var r=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new bn;for(var i=this.iterator();i.hasNext();){var o=i.next();(o.isInResult()||o.getSym().isInResult())&&r._resultAreaEdgeList.add(o)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(r){for(var i=this.iterator();i.hasNext();){var o=i.next(),a=o.getLabel();a.setAllLocationsIfNull(0,r.getLocation(0)),a.setAllLocationsIfNull(1,r.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){var r=this;this.getEdges();for(var i=null,o=null,a=this._edgeList.size()-1;a>=0;a--){var s=r._edgeList.get(a),u=s.getSym();o===null&&(o=u),i!==null&&u.setNext(i),i=s}o.setNext(i)},e.prototype.computeDepths=function(){var r=this;if(arguments.length===1){var i=arguments[0],o=this.findIndex(i),a=i.getDepth(gn.LEFT),s=i.getDepth(gn.RIGHT),u=this.computeDepths(o+1,this._edgeList.size(),a),d=this.computeDepths(0,o,u);if(d!==s)throw new Wd("depth mismatch at "+i.getCoordinate())}else if(arguments.length===3){for(var g=arguments[0],_=arguments[1],E=arguments[2],P=E,R=g;R<_;R++){var B=r._edgeList.get(R);B.setEdgeDepths(gn.RIGHT,P),P=B.getDepth(gn.LEFT)}return P}},e.prototype.mergeSymLabels=function(){for(var r=this.iterator();r.hasNext();){var i=r.next(),o=i.getLabel();o.merge(i.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(r){for(var i=this,o=null,a=null,s=this._SCANNING_FOR_INCOMING,u=this._resultAreaEdgeList.size()-1;u>=0;u--){var d=i._resultAreaEdgeList.get(u),g=d.getSym();switch(o===null&&d.getEdgeRing()===r&&(o=d),s){case i._SCANNING_FOR_INCOMING:if(g.getEdgeRing()!==r)continue;a=g,s=i._LINKING_TO_OUTGOING;break;case i._LINKING_TO_OUTGOING:if(d.getEdgeRing()!==r)continue;a.setNextMin(d),s=i._SCANNING_FOR_INCOMING;break}}s===this._LINKING_TO_OUTGOING&&(Pr.isTrue(o!==null,"found null for first outgoing dirEdge"),Pr.isTrue(o.getEdgeRing()===r,"unable to link last incoming dirEdge"),a.setNextMin(o))},e.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var r=0,i=this.iterator();i.hasNext();){var o=i.next();o.isInResult()&&r++}return r}else if(arguments.length===1){for(var a=arguments[0],s=0,u=this.iterator();u.hasNext();){var d=u.next();d.getEdgeRing()===a&&s++}return s}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var r=Et.NONE,i=this.iterator();i.hasNext();){var o=i.next(),a=o.getSym();if(!o.isLineEdge()){if(o.isInResult()){r=Et.INTERIOR;break}if(a.isInResult()){r=Et.EXTERIOR;break}}}if(r===Et.NONE)return null;for(var s=r,u=this.iterator();u.hasNext();){var d=u.next(),g=d.getSym();d.isLineEdge()?d.getEdge().setCovered(s===Et.INTERIOR):(d.isInResult()&&(s=Et.EXTERIOR),g.isInResult()&&(s=Et.INTERIOR))}},e.prototype.computeLabelling=function(r){var i=this;t.prototype.computeLabelling.call(this,r),this._label=new di(Et.NONE);for(var o=this.iterator();o.hasNext();)for(var a=o.next(),s=a.getEdge(),u=s.getLabel(),d=0;d<2;d++){var g=u.getLocation(d);(g===Et.INTERIOR||g===Et.BOUNDARY)&&i._label.setLocation(d,Et.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ua),tie=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(r){return new AR(r,new IRe)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Kv),dg=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};dg.prototype.compareTo=function(e){var n=e,r=dg.compareOriented(this._pts,this._orientation,n._pts,n._orientation);return r};dg.prototype.interfaces_=function(){return[Uu]};dg.prototype.getClass=function(){return dg};dg.orientation=function(e){return zr.increasingDirection(e)===1};dg.compareOriented=function(e,n,r,i){for(var o=n?1:-1,a=i?1:-1,s=n?e.length:-1,u=i?r.length:-1,d=n?0:e.length-1,g=i?0:r.length-1;;){var _=e[d].compareTo(r[g]);if(_!==0)return _;d+=o,g+=a;var E=d===s,P=g===u;if(E&&!P)return-1;if(!E&&P)return 1;if(E&&P)return 0}};var Sc=function(){this._edges=new bn,this._ocaMap=new aa};Sc.prototype.print=function(e){var n=this;e.print("MULTILINESTRING ( ");for(var r=0;r<this._edges.size();r++){var i=n._edges.get(r);r>0&&e.print(","),e.print("(");for(var o=i.getCoordinates(),a=0;a<o.length;a++)a>0&&e.print(","),e.print(o[a].x+" "+o[a].y);e.println(")")}e.print(")  ")};Sc.prototype.addAll=function(e){for(var n=this,r=e.iterator();r.hasNext();)n.add(r.next())};Sc.prototype.findEdgeIndex=function(e){for(var n=this,r=0;r<this._edges.size();r++)if(n._edges.get(r).equals(e))return r;return-1};Sc.prototype.iterator=function(){return this._edges.iterator()};Sc.prototype.getEdges=function(){return this._edges};Sc.prototype.get=function(e){return this._edges.get(e)};Sc.prototype.findEqualEdge=function(e){var n=new dg(e.getCoordinates()),r=this._ocaMap.get(n);return r};Sc.prototype.add=function(e){this._edges.add(e);var n=new dg(e.getCoordinates());this._ocaMap.put(n,e)};Sc.prototype.interfaces_=function(){return[]};Sc.prototype.getClass=function(){return Sc};var nA=function(){};nA.prototype.processIntersections=function(e,n,r,i){};nA.prototype.isDone=function(){};nA.prototype.interfaces_=function(){return[]};nA.prototype.getClass=function(){return nA};var nu=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e};nu.prototype.isTrivialIntersection=function(e,n,r,i){if(e===r&&this._li.getIntersectionNum()===1){if(nu.isAdjacentSegments(n,i))return!0;if(e.isClosed()){var o=e.size()-1;if(n===0&&i===o||i===0&&n===o)return!0}}return!1};nu.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};nu.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};nu.prototype.getLineIntersector=function(){return this._li};nu.prototype.hasProperIntersection=function(){return this._hasProper};nu.prototype.processIntersections=function(e,n,r,i){if(e===r&&n===i)return null;this.numTests++;var o=e.getCoordinates()[n],a=e.getCoordinates()[n+1],s=r.getCoordinates()[i],u=r.getCoordinates()[i+1];this._li.computeIntersection(o,a,s,u),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,n,r,i)||(this._hasIntersection=!0,e.addIntersections(this._li,n,0),r.addIntersections(this._li,i,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};nu.prototype.hasIntersection=function(){return this._hasIntersection};nu.prototype.isDone=function(){return!1};nu.prototype.hasInteriorIntersection=function(){return this._hasInterior};nu.prototype.interfaces_=function(){return[nA]};nu.prototype.getClass=function(){return nu};nu.isAdjacentSegments=function(e,n){return Math.abs(e-n)===1};var Pf=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],n=arguments[1],r=arguments[2];this.coord=new dt(e),this.segmentIndex=n,this.dist=r};Pf.prototype.getSegmentIndex=function(){return this.segmentIndex};Pf.prototype.getCoordinate=function(){return this.coord};Pf.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)};Pf.prototype.compareTo=function(e){var n=e;return this.compare(n.segmentIndex,n.dist)};Pf.prototype.isEndPoint=function(e){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===e};Pf.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};Pf.prototype.getDistance=function(){return this.dist};Pf.prototype.compare=function(e,n){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<n?-1:this.dist>n?1:0};Pf.prototype.interfaces_=function(){return[Uu]};Pf.prototype.getClass=function(){return Pf};var Oh=function(){this._nodeMap=new aa,this.edge=null;var e=arguments[0];this.edge=e};Oh.prototype.print=function(e){e.println("Intersections:");for(var n=this.iterator();n.hasNext();){var r=n.next();r.print(e)}};Oh.prototype.iterator=function(){return this._nodeMap.values().iterator()};Oh.prototype.addSplitEdges=function(e){var n=this;this.addEndpoints();for(var r=this.iterator(),i=r.next();r.hasNext();){var o=r.next(),a=n.createSplitEdge(i,o);e.add(a),i=o}};Oh.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)};Oh.prototype.createSplitEdge=function(e,n){var r=this,i=n.segmentIndex-e.segmentIndex+2,o=this.edge.pts[n.segmentIndex],a=n.dist>0||!n.coord.equals2D(o);a||i--;var s=new Array(i).fill(null),u=0;s[u++]=new dt(e.coord);for(var d=e.segmentIndex+1;d<=n.segmentIndex;d++)s[u++]=r.edge.pts[d];return a&&(s[u]=n.coord),new wI(s,new di(this.edge._label))};Oh.prototype.add=function(e,n,r){var i=new Pf(e,n,r),o=this._nodeMap.get(i);return o!==null?o:(this._nodeMap.put(i,i),i)};Oh.prototype.isIntersection=function(e){for(var n=this.iterator();n.hasNext();){var r=n.next();if(r.coord.equals(e))return!0}return!1};Oh.prototype.interfaces_=function(){return[]};Oh.prototype.getClass=function(){return Oh};var rA=function(){};rA.prototype.getChainStartIndices=function(e){var n=this,r=0,i=new bn;i.add(new bf(r));do{var o=n.findChainEnd(e,r);i.add(new bf(o)),r=o}while(r<e.length-1);var a=rA.toIntArray(i);return a};rA.prototype.findChainEnd=function(e,n){for(var r=yi.quadrant(e[n],e[n+1]),i=n+1;i<e.length;){var o=yi.quadrant(e[i-1],e[i]);if(o!==r)break;i++}return i-1};rA.prototype.interfaces_=function(){return[]};rA.prototype.getClass=function(){return rA};rA.toIntArray=function(e){for(var n=new Array(e.size()).fill(null),r=0;r<n.length;r++)n[r]=e.get(r).intValue();return n};var Xd=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Qn,this.env2=new Qn;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var n=new rA;this.startIndex=n.getChainStartIndices(this.pts)};Xd.prototype.getCoordinates=function(){return this.pts};Xd.prototype.getMaxX=function(e){var n=this.pts[this.startIndex[e]].x,r=this.pts[this.startIndex[e+1]].x;return n>r?n:r};Xd.prototype.getMinX=function(e){var n=this.pts[this.startIndex[e]].x,r=this.pts[this.startIndex[e+1]].x;return n<r?n:r};Xd.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],n,n.startIndex[r],n.startIndex[r+1],i)}else if(arguments.length===6){var o=arguments[0],a=arguments[1],s=arguments[2],u=arguments[3],d=arguments[4],g=arguments[5],_=this.pts[o],E=this.pts[a],P=s.pts[u],R=s.pts[d];if(a-o===1&&d-u===1)return g.addIntersections(this.e,o,s.e,u),null;if(this.env1.init(_,E),this.env2.init(P,R),!this.env1.intersects(this.env2))return null;var B=Math.trunc((o+a)/2),V=Math.trunc((u+d)/2);o<B&&(u<V&&this.computeIntersectsForChain(o,B,s,u,V,g),V<d&&this.computeIntersectsForChain(o,B,s,V,d,g)),B<a&&(u<V&&this.computeIntersectsForChain(B,a,s,u,V,g),V<d&&this.computeIntersectsForChain(B,a,s,V,d,g))}};Xd.prototype.getStartIndexes=function(){return this.startIndex};Xd.prototype.computeIntersects=function(e,n){for(var r=this,i=0;i<this.startIndex.length-1;i++)for(var o=0;o<e.startIndex.length-1;o++)r.computeIntersectsForChain(i,e,o,n)};Xd.prototype.interfaces_=function(){return[]};Xd.prototype.getClass=function(){return Xd};var Hs=function t(){var e=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var r=0;r<3;r++)e._depth[n][r]=t.NULL_VALUE},nie={NULL_VALUE:{configurable:!0}};Hs.prototype.getDepth=function(e,n){return this._depth[e][n]};Hs.prototype.setDepth=function(e,n,r){this._depth[e][n]=r};Hs.prototype.isNull=function(){var e=this;if(arguments.length===0){for(var n=0;n<2;n++)for(var r=0;r<3;r++)if(e._depth[n][r]!==Hs.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var i=arguments[0];return this._depth[i][1]===Hs.NULL_VALUE}else if(arguments.length===2){var o=arguments[0],a=arguments[1];return this._depth[o][a]===Hs.NULL_VALUE}};Hs.prototype.normalize=function(){for(var e=this,n=0;n<2;n++)if(!e.isNull(n)){var r=e._depth[n][1];e._depth[n][2]<r&&(r=e._depth[n][2]),r<0&&(r=0);for(var i=1;i<3;i++){var o=0;e._depth[n][i]>r&&(o=1),e._depth[n][i]=o}}};Hs.prototype.getDelta=function(e){return this._depth[e][gn.RIGHT]-this._depth[e][gn.LEFT]};Hs.prototype.getLocation=function(e,n){return this._depth[e][n]<=0?Et.EXTERIOR:Et.INTERIOR};Hs.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Hs.prototype.add=function(){var e=this;if(arguments.length===1)for(var n=arguments[0],r=0;r<2;r++)for(var i=1;i<3;i++){var o=n.getLocation(r,i);(o===Et.EXTERIOR||o===Et.INTERIOR)&&(e.isNull(r,i)?e._depth[r][i]=Hs.depthAtLocation(o):e._depth[r][i]+=Hs.depthAtLocation(o))}else if(arguments.length===3){var a=arguments[0],s=arguments[1],u=arguments[2];u===Et.INTERIOR&&this._depth[a][s]++}};Hs.prototype.interfaces_=function(){return[]};Hs.prototype.getClass=function(){return Hs};Hs.depthAtLocation=function(e){return e===Et.EXTERIOR?0:e===Et.INTERIOR?1:Hs.NULL_VALUE};nie.NULL_VALUE.get=function(){return-1};Object.defineProperties(Hs,nie);var wI=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new Oh(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Hs,this._depthDelta=0,arguments.length===1){var n=arguments[0];e.call(this,n,null)}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.pts=r,this._label=i}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var r=new Array(2).fill(null);r[0]=this.pts[0],r[1]=this.pts[1];var i=new e(r,di.toLineLabel(this._label));return i},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(r){this._isIsolated=r},e.prototype.setName=function(r){this._name=r},e.prototype.equals=function(r){var i=this;if(!(r instanceof e))return!1;var o=r;if(this.pts.length!==o.pts.length)return!1;for(var a=!0,s=!0,u=this.pts.length,d=0;d<this.pts.length;d++)if(i.pts[d].equals2D(o.pts[d])||(a=!1),i.pts[d].equals2D(o.pts[--u])||(s=!1),!a&&!s)return!1;return!0},e.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var r=arguments[0];return this.pts[r]}},e.prototype.print=function(r){var i=this;r.print("edge "+this._name+": "),r.print("LINESTRING (");for(var o=0;o<this.pts.length;o++)o>0&&r.print(","),r.print(i.pts[o].x+" "+i.pts[o].y);r.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(r){e.updateIM(this._label,r)},e.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(r){var i=this;r.print("edge "+this._name+": ");for(var o=this.pts.length-1;o>=0;o--)r.print(i.pts[o]+" ");r.println("")},e.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new Xd(this)),this._mce},e.prototype.getEnvelope=function(){var r=this;if(this._env===null){this._env=new Qn;for(var i=0;i<this.pts.length;i++)r._env.expandToInclude(r.pts[i])}return this._env},e.prototype.addIntersection=function(r,i,o,a){var s=new dt(r.getIntersection(a)),u=i,d=r.getEdgeDistance(o,a),g=u+1;if(g<this.pts.length){var _=this.pts[g];s.equals2D(_)&&(u=g,d=0)}this.eiList.add(s,u,d)},e.prototype.toString=function(){var r=this,i=new Df;i.append("edge "+this._name+": "),i.append("LINESTRING (");for(var o=0;o<this.pts.length;o++)o>0&&i.append(","),i.append(r.pts[o].x+" "+r.pts[o].y);return i.append(")  "+this._label+" "+this._depthDelta),i.toString()},e.prototype.isPointwiseEqual=function(r){var i=this;if(this.pts.length!==r.pts.length)return!1;for(var o=0;o<this.pts.length;o++)if(!i.pts[o].equals2D(r.pts[o]))return!1;return!0},e.prototype.setDepthDelta=function(r){this._depthDelta=r},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(r,i,o){for(var a=this,s=0;s<r.getIntersectionNum();s++)a.addIntersection(r,i,o,s)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];i.setAtLeastIfValid(r.getLocation(0,gn.ON),r.getLocation(1,gn.ON),1),r.isArea()&&(i.setAtLeastIfValid(r.getLocation(0,gn.LEFT),r.getLocation(1,gn.LEFT),2),i.setAtLeastIfValid(r.getLocation(0,gn.RIGHT),r.getLocation(1,gn.RIGHT),2))}else return t.prototype.updateIM.apply(this,arguments)},e}(eu),Ia=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Sc,this._bufParams=e||null};Ia.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e};Ia.prototype.insertUniqueEdge=function(e){var n=this._edgeList.findEqualEdge(e);if(n!==null){var r=n.getLabel(),i=e.getLabel();n.isPointwiseEqual(e)||(i=new di(e.getLabel()),i.flip()),r.merge(i);var o=Ia.depthDelta(i),a=n.getDepthDelta(),s=a+o;n.setDepthDelta(s)}else this._edgeList.add(e),e.setDepthDelta(Ia.depthDelta(e.getLabel()))};Ia.prototype.buildSubgraphs=function(e,n){for(var r=new bn,i=e.iterator();i.hasNext();){var o=i.next(),a=o.getRightmostCoordinate(),s=new $0(r),u=s.getDepth(a);o.computeDepth(u),o.findResultEdges(),r.add(o),n.add(o.getDirectedEdges(),o.getNodes())}};Ia.prototype.createSubgraphs=function(e){for(var n=new bn,r=e.getNodes().iterator();r.hasNext();){var i=r.next();if(!i.isVisited()){var o=new La;o.create(i),n.add(o)}}return Ec.sort(n,Ec.reverseOrder()),n};Ia.prototype.createEmptyResultGeometry=function(){var e=this._geomFact.createPolygon();return e};Ia.prototype.getNoder=function(e){if(this._workingNoder!==null)return this._workingNoder;var n=new b6,r=new vA;return r.setPrecisionModel(e),n.setSegmentIntersector(new nu(r)),n};Ia.prototype.buffer=function(e,n){var r=this._workingPrecisionModel;r===null&&(r=e.getPrecisionModel()),this._geomFact=e.getFactory();var i=new Ja(r,this._bufParams),o=new ku(e,n,i),a=o.getCurves();if(a.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(a,r),this._graph=new po(new tie),this._graph.addEdges(this._edgeList.getEdges());var s=this.createSubgraphs(this._graph),u=new Ml(this._geomFact);this.buildSubgraphs(s,u);var d=u.getPolygons();if(d.size()<=0)return this.createEmptyResultGeometry();var g=this._geomFact.buildGeometry(d);return g};Ia.prototype.computeNodedEdges=function(e,n){var r=this,i=this.getNoder(n);i.computeNodes(e);for(var o=i.getNodedSubstrings(),a=o.iterator();a.hasNext();){var s=a.next(),u=s.getCoordinates();if(!(u.length===2&&u[0].equals2D(u[1]))){var d=s.getData(),g=new wI(s.getCoordinates(),new di(d));r.insertUniqueEdge(g)}}};Ia.prototype.setNoder=function(e){this._workingNoder=e};Ia.prototype.interfaces_=function(){return[]};Ia.prototype.getClass=function(){return Ia};Ia.depthDelta=function(e){var n=e.getLocation(0,gn.LEFT),r=e.getLocation(0,gn.RIGHT);return n===Et.INTERIOR&&r===Et.EXTERIOR?1:n===Et.EXTERIOR&&r===Et.INTERIOR?-1:0};Ia.convertSegStrings=function(e){for(var n=new kr,r=new bn;e.hasNext();){var i=e.next(),o=n.createLineString(i.getCoordinates());r.add(o)}return n.buildGeometry(r)};var pg=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],n=arguments[1];this._noder=e,this._scaleFactor=n,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var r=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3];this._noder=r,this._scaleFactor=i,this._offsetX=o,this._offsetY=a,this._isScaled=!this.isIntegerPrecision()}};pg.prototype.rescale=function(){var e=this;if(ar(arguments[0],Jo))for(var n=arguments[0],r=n.iterator();r.hasNext();){var i=r.next();e.rescale(i.getCoordinates())}else if(arguments[0]instanceof Array){for(var o=arguments[0],a=0;a<o.length;a++)o[a].x=o[a].x/e._scaleFactor+e._offsetX,o[a].y=o[a].y/e._scaleFactor+e._offsetY;o.length===2&&o[0].equals2D(o[1])&&qs.out.println(o)}};pg.prototype.scale=function(){var e=this;if(ar(arguments[0],Jo)){for(var n=arguments[0],r=new bn,i=n.iterator();i.hasNext();){var o=i.next();r.add(new Lo(e.scale(o.getCoordinates()),o.getData()))}return r}else if(arguments[0]instanceof Array){for(var a=arguments[0],s=new Array(a.length).fill(null),u=0;u<a.length;u++)s[u]=new dt(Math.round((a[u].x-e._offsetX)*e._scaleFactor),Math.round((a[u].y-e._offsetY)*e._scaleFactor),a[u].z);var d=zr.removeRepeatedPoints(s);return d}};pg.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};pg.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e};pg.prototype.computeNodes=function(e){var n=e;this._isScaled&&(n=this.scale(e)),this._noder.computeNodes(n)};pg.prototype.interfaces_=function(){return[eA]};pg.prototype.getClass=function(){return pg};var If=function(){this._li=new vA,this._segStrings=null;var e=arguments[0];this._segStrings=e},rie={fact:{configurable:!0}};If.prototype.checkEndPtVertexIntersections=function(){var e=this;if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();){var r=n.next(),i=r.getCoordinates();e.checkEndPtVertexIntersections(i[0],e._segStrings),e.checkEndPtVertexIntersections(i[i.length-1],e._segStrings)}else if(arguments.length===2){for(var o=arguments[0],a=arguments[1],s=a.iterator();s.hasNext();)for(var u=s.next(),d=u.getCoordinates(),g=1;g<d.length-1;g++)if(d[g].equals(o))throw new $d("found endpt/interior pt intersection at index "+g+" :pt "+o)}};If.prototype.checkInteriorIntersections=function(){var e=this;if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();)for(var r=n.next(),i=this._segStrings.iterator();i.hasNext();){var o=i.next();e.checkInteriorIntersections(r,o)}else if(arguments.length===2)for(var a=arguments[0],s=arguments[1],u=a.getCoordinates(),d=s.getCoordinates(),g=0;g<u.length-1;g++)for(var _=0;_<d.length-1;_++)e.checkInteriorIntersections(a,g,s,_);else if(arguments.length===4){var E=arguments[0],P=arguments[1],R=arguments[2],B=arguments[3];if(E===R&&P===B)return null;var V=E.getCoordinates()[P],z=E.getCoordinates()[P+1],F=R.getCoordinates()[B],k=R.getCoordinates()[B+1];if(this._li.computeIntersection(V,z,F,k),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,V,z)||this.hasInteriorIntersection(this._li,F,k)))throw new $d("found non-noded intersection at "+V+"-"+z+" and "+F+"-"+k)}};If.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};If.prototype.checkCollapses=function(){var e=this;if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();){var r=n.next();e.checkCollapses(r)}else if(arguments.length===1)for(var i=arguments[0],o=i.getCoordinates(),a=0;a<o.length-2;a++)e.checkCollapse(o[a],o[a+1],o[a+2])};If.prototype.hasInteriorIntersection=function(e,n,r){for(var i=0;i<e.getIntersectionNum();i++){var o=e.getIntersection(i);if(!(o.equals(n)||o.equals(r)))return!0}return!1};If.prototype.checkCollapse=function(e,n,r){if(e.equals(r))throw new $d("found non-noded collapse at "+If.fact.createLineString([e,n,r]))};If.prototype.interfaces_=function(){return[]};If.prototype.getClass=function(){return If};rie.fact.get=function(){return new kr};Object.defineProperties(If,rie);var el=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],n=arguments[1],r=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=n,this._li=r,n<=0)throw new oo("Scale factor must be non-zero");n!==1&&(this._pt=new dt(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new dt,this._p1Scaled=new dt),this.initCorners(this._pt)},iie={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};el.prototype.intersectsScaled=function(e,n){var r=Math.min(e.x,n.x),i=Math.max(e.x,n.x),o=Math.min(e.y,n.y),a=Math.max(e.y,n.y),s=this._maxx<r||this._minx>i||this._maxy<o||this._miny>a;if(s)return!1;var u=this.intersectsToleranceSquare(e,n);return Pr.isTrue(!(s&&u),"Found bad envelope test"),u};el.prototype.initCorners=function(e){var n=.5;this._minx=e.x-n,this._maxx=e.x+n,this._miny=e.y-n,this._maxy=e.y+n,this._corner[0]=new dt(this._maxx,this._maxy),this._corner[1]=new dt(this._minx,this._maxy),this._corner[2]=new dt(this._minx,this._miny),this._corner[3]=new dt(this._maxx,this._miny)};el.prototype.intersects=function(e,n){return this._scaleFactor===1?this.intersectsScaled(e,n):(this.copyScaled(e,this._p0Scaled),this.copyScaled(n,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};el.prototype.scale=function(e){return Math.round(e*this._scaleFactor)};el.prototype.getCoordinate=function(){return this._originalPt};el.prototype.copyScaled=function(e,n){n.x=this.scale(e.x),n.y=this.scale(e.y)};el.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var e=el.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Qn(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv};el.prototype.intersectsPixelClosure=function(e,n){return this._li.computeIntersection(e,n,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,n,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(e,n,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(e,n,this._corner[3],this._corner[0]),this._li.hasIntersection()))};el.prototype.intersectsToleranceSquare=function(e,n){var r=!1,i=!1;return this._li.computeIntersection(e,n,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,n,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,n,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(e,n,this._corner[3],this._corner[0]),this._li.isProper())||r&&i||e.equals(this._pt)||n.equals(this._pt))};el.prototype.addSnappedNode=function(e,n){var r=e.getCoordinate(n),i=e.getCoordinate(n+1);return this.intersects(r,i)?(e.addIntersection(this.getCoordinate(),n),!0):!1};el.prototype.interfaces_=function(){return[]};el.prototype.getClass=function(){return el};iie.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(el,iie);var Jw=function(){this.tempEnv1=new Qn,this.selectedSegment=new Jn};Jw.prototype.select=function(){if(arguments.length!==1){if(arguments.length===2){var e=arguments[0],n=arguments[1];e.getLineSegment(n,this.selectedSegment),this.select(this.selectedSegment)}}};Jw.prototype.interfaces_=function(){return[]};Jw.prototype.getClass=function(){return Jw};var n1=function(){this._index=null;var e=arguments[0];this._index=e},oie={HotPixelSnapAction:{configurable:!0}};n1.prototype.snap=function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2],o=n.getSafeEnvelope(),a=new sie(n,r,i);return this._index.query(o,{interfaces_:function(){return[fg]},visitItem:function(s){var u=s;u.select(o,a)}}),a.isNodeAdded()}};n1.prototype.interfaces_=function(){return[]};n1.prototype.getClass=function(){return n1};oie.HotPixelSnapAction.get=function(){return sie};Object.defineProperties(n1,oie);var sie=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],r=arguments[1],i=arguments[2];this._hotPixel=n,this._parentEdge=r,this._hotPixelVertexIndex=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1],o=r.getContext();if(this._parentEdge!==null&&o===this._parentEdge&&i===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(o,i)}else return t.prototype.select.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Jw),H0=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new bn};H0.prototype.processIntersections=function(e,n,r,i){var o=this;if(e===r&&n===i)return null;var a=e.getCoordinates()[n],s=e.getCoordinates()[n+1],u=r.getCoordinates()[i],d=r.getCoordinates()[i+1];if(this._li.computeIntersection(a,s,u,d),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var g=0;g<this._li.getIntersectionNum();g++)o._interiorIntersections.add(o._li.getIntersection(g));e.addIntersections(this._li,n,0),r.addIntersections(this._li,i,1)}};H0.prototype.isDone=function(){return!1};H0.prototype.getInteriorIntersections=function(){return this._interiorIntersections};H0.prototype.interfaces_=function(){return[nA]};H0.prototype.getClass=function(){return H0};var Rh=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new vA,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()};Rh.prototype.checkCorrectness=function(e){var n=Lo.getNodedSubstrings(e),r=new If(n);try{r.checkValid()}catch(i){if(i instanceof Vre)i.printStackTrace();else throw i}finally{}};Rh.prototype.getNodedSubstrings=function(){return Lo.getNodedSubstrings(this._nodedSegStrings)};Rh.prototype.snapRound=function(e,n){var r=this.findInteriorIntersections(e,n);this.computeIntersectionSnaps(r),this.computeVertexSnaps(e)};Rh.prototype.findInteriorIntersections=function(e,n){var r=new H0(n);return this._noder.setSegmentIntersector(r),this._noder.computeNodes(e),r.getInteriorIntersections()};Rh.prototype.computeVertexSnaps=function(){var e=this;if(ar(arguments[0],Jo))for(var n=arguments[0],r=n.iterator();r.hasNext();){var i=r.next();e.computeVertexSnaps(i)}else if(arguments[0]instanceof Lo)for(var o=arguments[0],a=o.getCoordinates(),s=0;s<a.length;s++){var u=new el(a[s],e._scaleFactor,e._li),d=e._pointSnapper.snap(u,o,s);d&&o.addIntersection(a[s],s)}};Rh.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new b6,this._pointSnapper=new n1(this._noder.getIndex()),this.snapRound(e,this._li)};Rh.prototype.computeIntersectionSnaps=function(e){for(var n=this,r=e.iterator();r.hasNext();){var i=r.next(),o=new el(i,n._scaleFactor,n._li);n._pointSnapper.snap(o)}};Rh.prototype.interfaces_=function(){return[eA]};Rh.prototype.getClass=function(){return Rh};var $s=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new oi,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._argGeom=n,this._bufParams=r}},U1={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};$s.prototype.bufferFixedPrecision=function(e){var n=new pg(new Rh(new si(1)),e.getScale()),r=new Ia(this._bufParams);r.setWorkingPrecisionModel(e),r.setNoder(n),this._resultGeometry=r.buffer(this._argGeom,this._distance)};$s.prototype.bufferReducedPrecision=function(){var e=this;if(arguments.length===0){for(var n=$s.MAX_PRECISION_DIGITS;n>=0;n--){try{e.bufferReducedPrecision(n)}catch(a){if(a instanceof Wd)e._saveException=a;else throw a}finally{}if(e._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var r=arguments[0],i=$s.precisionScaleFactor(this._argGeom,this._distance,r),o=new si(i);this.bufferFixedPrecision(o)}};$s.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===si.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()};$s.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)};$s.prototype.bufferOriginalPrecision=function(){try{var e=new Ia(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(n){if(n instanceof $d)this._saveException=n;else throw n}finally{}};$s.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry};$s.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)};$s.prototype.interfaces_=function(){return[]};$s.prototype.getClass=function(){return $s};$s.bufferOp=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1],r=new $s(e),i=r.getResultGeometry(n);return i}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof ir&&typeof arguments[1]=="number"){var o=arguments[0],a=arguments[1],s=arguments[2],u=new $s(o);u.setQuadrantSegments(s);var d=u.getResultGeometry(a);return d}else if(arguments[2]instanceof oi&&arguments[0]instanceof ir&&typeof arguments[1]=="number"){var g=arguments[0],_=arguments[1],E=arguments[2],P=new $s(g,E),R=P.getResultGeometry(_);return R}}else if(arguments.length===4){var B=arguments[0],V=arguments[1],z=arguments[2],F=arguments[3],k=new $s(B);k.setQuadrantSegments(z),k.setEndCapStyle(F);var X=k.getResultGeometry(V);return X}};$s.precisionScaleFactor=function(e,n,r){var i=e.getEnvelopeInternal(),o=Jl.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY())),a=n>0?n:0,s=o+2*a,u=Math.trunc(Math.log(s)/Math.log(10)+1),d=r-u,g=Math.pow(10,d);return g};U1.CAP_ROUND.get=function(){return oi.CAP_ROUND};U1.CAP_BUTT.get=function(){return oi.CAP_FLAT};U1.CAP_FLAT.get=function(){return oi.CAP_FLAT};U1.CAP_SQUARE.get=function(){return oi.CAP_SQUARE};U1.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties($s,U1);var Sa=function(){this._pt=[new dt,new dt],this._distance=mr.NaN,this._isNull=!0};Sa.prototype.getCoordinates=function(){return this._pt};Sa.prototype.getCoordinate=function(e){return this._pt[e]};Sa.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var n=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(n,r),null;var i=n.distance(r);i<this._distance&&this.initialize(n,r,i)}};Sa.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(n),this._distance=e.distance(n),this._isNull=!1}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(i),this._distance=o,this._isNull=!1}};Sa.prototype.getDistance=function(){return this._distance};Sa.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var n=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(n,r),null;var i=n.distance(r);i>this._distance&&this.initialize(n,r,i)}};Sa.prototype.interfaces_=function(){return[]};Sa.prototype.getClass=function(){return Sa};var uh=function(){};uh.prototype.interfaces_=function(){return[]};uh.prototype.getClass=function(){return uh};uh.computeDistance=function(){if(arguments[2]instanceof Sa&&arguments[0]instanceof bo&&arguments[1]instanceof dt)for(var e=arguments[0],n=arguments[1],r=arguments[2],i=e.getCoordinates(),o=new Jn,a=0;a<i.length-1;a++){o.setCoordinates(i[a],i[a+1]);var s=o.closestPoint(n);r.setMinimum(s,n)}else if(arguments[2]instanceof Sa&&arguments[0]instanceof us&&arguments[1]instanceof dt){var u=arguments[0],d=arguments[1],g=arguments[2];uh.computeDistance(u.getExteriorRing(),d,g);for(var _=0;_<u.getNumInteriorRing();_++)uh.computeDistance(u.getInteriorRingN(_),d,g)}else if(arguments[2]instanceof Sa&&arguments[0]instanceof ir&&arguments[1]instanceof dt){var E=arguments[0],P=arguments[1],R=arguments[2];if(E instanceof bo)uh.computeDistance(E,P,R);else if(E instanceof us)uh.computeDistance(E,P,R);else if(E instanceof Ra)for(var B=E,V=0;V<B.getNumGeometries();V++){var z=B.getGeometryN(V);uh.computeDistance(z,P,R)}else R.setMinimum(E.getCoordinate(),P)}else if(arguments[2]instanceof Sa&&arguments[0]instanceof Jn&&arguments[1]instanceof dt){var F=arguments[0],k=arguments[1],X=arguments[2],Y=F.closestPoint(k);X.setMinimum(Y,k)}};var iA=function(e){this._maxPtDist=new Sa,this._inputGeom=e||null},w6={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};iA.prototype.computeMaxMidpointDistance=function(e){var n=new gg(this._inputGeom);e.apply(n),this._maxPtDist.setMaximum(n.getMaxPointDistance())};iA.prototype.computeMaxVertexDistance=function(e){var n=new W0(this._inputGeom);e.apply(n),this._maxPtDist.setMaximum(n.getMaxPointDistance())};iA.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()};iA.prototype.getDistancePoints=function(){return this._maxPtDist};iA.prototype.interfaces_=function(){return[]};iA.prototype.getClass=function(){return iA};w6.MaxPointDistanceFilter.get=function(){return W0};w6.MaxMidpointDistanceFilter.get=function(){return gg};Object.defineProperties(iA,w6);var W0=function(e){this._maxPtDist=new Sa,this._minPtDist=new Sa,this._geom=e||null};W0.prototype.filter=function(e){this._minPtDist.initialize(),uh.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};W0.prototype.getMaxPointDistance=function(){return this._maxPtDist};W0.prototype.interfaces_=function(){return[Ch]};W0.prototype.getClass=function(){return W0};var gg=function(e){this._maxPtDist=new Sa,this._minPtDist=new Sa,this._geom=e||null};gg.prototype.filter=function(e,n){if(n===0)return null;var r=e.getCoordinate(n-1),i=e.getCoordinate(n),o=new dt((r.x+i.x)/2,(r.y+i.y)/2);this._minPtDist.initialize(),uh.computeDistance(this._geom,o,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};gg.prototype.isDone=function(){return!1};gg.prototype.isGeometryChanged=function(){return!1};gg.prototype.getMaxPointDistance=function(){return this._maxPtDist};gg.prototype.interfaces_=function(){return[bc]};gg.prototype.getClass=function(){return gg};var zd=function(e){this._comps=e||null};zd.prototype.filter=function(e){e instanceof us&&this._comps.add(e)};zd.prototype.interfaces_=function(){return[Ef]};zd.prototype.getClass=function(){return zd};zd.getPolygons=function(){if(arguments.length===1){var e=arguments[0];return zd.getPolygons(e,new bn)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return n instanceof us?r.add(n):n instanceof Ra&&n.apply(new zd(r)),r}};var Gs=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var e=arguments[0];this._lines=e}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._lines=n,this._isForcedToLineString=r}};Gs.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof Ph){var n=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(n),null}e instanceof bo&&this._lines.add(e)};Gs.prototype.setForceToLineString=function(e){this._isForcedToLineString=e};Gs.prototype.interfaces_=function(){return[Hd]};Gs.prototype.getClass=function(){return Gs};Gs.getGeometry=function(){if(arguments.length===1){var e=arguments[0];return e.getFactory().buildGeometry(Gs.getLines(e))}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return n.getFactory().buildGeometry(Gs.getLines(n,r))}};Gs.getLines=function(){if(arguments.length===1){var e=arguments[0];return Gs.getLines(e,!1)}else if(arguments.length===2){if(ar(arguments[0],Jo)&&ar(arguments[1],Jo)){for(var n=arguments[0],r=arguments[1],i=n.iterator();i.hasNext();){var o=i.next();Gs.getLines(o,r)}return r}else if(arguments[0]instanceof ir&&typeof arguments[1]=="boolean"){var a=arguments[0],s=arguments[1],u=new bn;return a.apply(new Gs(u,s)),u}else if(arguments[0]instanceof ir&&ar(arguments[1],Jo)){var d=arguments[0],g=arguments[1];return d instanceof bo?g.add(d):d.apply(new Gs(g)),g}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&ar(arguments[0],Jo)&&ar(arguments[1],Jo)){for(var _=arguments[0],E=arguments[1],P=arguments[2],R=_.iterator();R.hasNext();){var B=R.next();Gs.getLines(B,E,P)}return E}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof ir&&ar(arguments[1],Jo)){var V=arguments[0],z=arguments[1],F=arguments[2];return V.apply(new Gs(z,F)),z}}};var Tc=function(){if(this._boundaryRule=Nu.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];if(e===null)throw new oo("Rule must be non-null");this._boundaryRule=e}}};Tc.prototype.locateInternal=function(){var e=this;if(arguments[0]instanceof dt&&arguments[1]instanceof us){var n=arguments[0],r=arguments[1];if(r.isEmpty())return Et.EXTERIOR;var i=r.getExteriorRing(),o=this.locateInPolygonRing(n,i);if(o===Et.EXTERIOR)return Et.EXTERIOR;if(o===Et.BOUNDARY)return Et.BOUNDARY;for(var a=0;a<r.getNumInteriorRing();a++){var s=r.getInteriorRingN(a),u=e.locateInPolygonRing(n,s);if(u===Et.INTERIOR)return Et.EXTERIOR;if(u===Et.BOUNDARY)return Et.BOUNDARY}return Et.INTERIOR}else if(arguments[0]instanceof dt&&arguments[1]instanceof bo){var d=arguments[0],g=arguments[1];if(!g.getEnvelopeInternal().intersects(d))return Et.EXTERIOR;var _=g.getCoordinates();return!g.isClosed()&&(d.equals(_[0])||d.equals(_[_.length-1]))?Et.BOUNDARY:Rn.isOnLine(d,_)?Et.INTERIOR:Et.EXTERIOR}else if(arguments[0]instanceof dt&&arguments[1]instanceof Il){var E=arguments[0],P=arguments[1],R=P.getCoordinate();return R.equals2D(E)?Et.INTERIOR:Et.EXTERIOR}};Tc.prototype.locateInPolygonRing=function(e,n){return n.getEnvelopeInternal().intersects(e)?Rn.locatePointInRing(e,n.getCoordinates()):Et.EXTERIOR};Tc.prototype.intersects=function(e,n){return this.locate(e,n)!==Et.EXTERIOR};Tc.prototype.updateLocationInfo=function(e){e===Et.INTERIOR&&(this._isIn=!0),e===Et.BOUNDARY&&this._numBoundaries++};Tc.prototype.computeLocation=function(e,n){var r=this;if(n instanceof Il&&this.updateLocationInfo(this.locateInternal(e,n)),n instanceof bo)this.updateLocationInfo(this.locateInternal(e,n));else if(n instanceof us)this.updateLocationInfo(this.locateInternal(e,n));else if(n instanceof Jm)for(var i=n,o=0;o<i.getNumGeometries();o++){var a=i.getGeometryN(o);r.updateLocationInfo(r.locateInternal(e,a))}else if(n instanceof yh)for(var s=n,u=0;u<s.getNumGeometries();u++){var d=s.getGeometryN(u);r.updateLocationInfo(r.locateInternal(e,d))}else if(n instanceof Ra)for(var g=new vh(n);g.hasNext();){var _=g.next();_!==n&&r.computeLocation(e,_)}};Tc.prototype.locate=function(e,n){return n.isEmpty()?Et.EXTERIOR:n instanceof bo?this.locateInternal(e,n):n instanceof us?this.locateInternal(e,n):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,n),this._boundaryRule.isInBoundary(this._numBoundaries)?Et.BOUNDARY:this._numBoundaries>0||this._isIn?Et.INTERIOR:Et.EXTERIOR)};Tc.prototype.interfaces_=function(){return[]};Tc.prototype.getClass=function(){return Tc};var Ta=function t(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var e=arguments[0],n=arguments[1];t.call(this,e,t.INSIDE_AREA,n)}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2];this._component=r,this._segIndex=i,this._pt=o}},aie={INSIDE_AREA:{configurable:!0}};Ta.prototype.isInsideArea=function(){return this._segIndex===Ta.INSIDE_AREA};Ta.prototype.getCoordinate=function(){return this._pt};Ta.prototype.getGeometryComponent=function(){return this._component};Ta.prototype.getSegmentIndex=function(){return this._segIndex};Ta.prototype.interfaces_=function(){return[]};Ta.prototype.getClass=function(){return Ta};aie.INSIDE_AREA.get=function(){return-1};Object.defineProperties(Ta,aie);var Jp=function(e){this._pts=e||null};Jp.prototype.filter=function(e){e instanceof Il&&this._pts.add(e)};Jp.prototype.interfaces_=function(){return[Ef]};Jp.prototype.getClass=function(){return Jp};Jp.getPoints=function(){if(arguments.length===1){var e=arguments[0];return e instanceof Il?Ec.singletonList(e):Jp.getPoints(e,new bn)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return n instanceof Il?r.add(n):n instanceof Ra&&n.apply(new Jp(r)),r}};var q0=function(){this._locations=null;var e=arguments[0];this._locations=e};q0.prototype.filter=function(e){(e instanceof Il||e instanceof bo||e instanceof us)&&this._locations.add(new Ta(e,0,e.getCoordinate()))};q0.prototype.interfaces_=function(){return[Ef]};q0.prototype.getClass=function(){return q0};q0.getLocations=function(e){var n=new bn;return e.apply(new q0(n)),n};var Xs=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Tc,this._minDistanceLocation=null,this._minDistance=mr.MAX_VALUE,arguments.length===2){var e=arguments[0],n=arguments[1];this._geom=[e,n],this._terminateDistance=0}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=r,this._geom[1]=i,this._terminateDistance=o}};Xs.prototype.computeContainmentDistance=function(){var e=this;if(arguments.length===0){var n=new Array(2).fill(null);if(this.computeContainmentDistance(0,n),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,n)}else if(arguments.length===2){var r=arguments[0],i=arguments[1],o=1-r,a=zd.getPolygons(this._geom[r]);if(a.size()>0){var s=q0.getLocations(this._geom[o]);if(this.computeContainmentDistance(s,a,i),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[o]=i[0],this._minDistanceLocation[r]=i[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&ar(arguments[0],Ac)&&ar(arguments[1],Ac)){for(var u=arguments[0],d=arguments[1],g=arguments[2],_=0;_<u.size();_++)for(var E=u.get(_),P=0;P<d.size();P++)if(e.computeContainmentDistance(E,d.get(P),g),e._minDistance<=e._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Ta&&arguments[1]instanceof us){var R=arguments[0],B=arguments[1],V=arguments[2],z=R.getCoordinate();if(Et.EXTERIOR!==this._ptLocator.locate(z,B))return this._minDistance=0,V[0]=R,V[1]=new Ta(B,z),null}}};Xs.prototype.computeMinDistanceLinesPoints=function(e,n,r){for(var i=this,o=0;o<e.size();o++)for(var a=e.get(o),s=0;s<n.size();s++){var u=n.get(s);if(i.computeMinDistance(a,u,r),i._minDistance<=i._terminateDistance)return null}};Xs.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),n=Gs.getLines(this._geom[0]),r=Gs.getLines(this._geom[1]),i=Jp.getPoints(this._geom[0]),o=Jp.getPoints(this._geom[1]);if(this.computeMinDistanceLines(n,r,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(n,o,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance)||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(r,i,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance))return null;e[0]=null,e[1]=null,this.computeMinDistancePoints(i,o,e),this.updateMinDistance(e,!1)};Xs.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};Xs.prototype.updateMinDistance=function(e,n){if(e[0]===null)return null;n?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])};Xs.prototype.nearestPoints=function(){this.computeMinDistance();var e=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return e};Xs.prototype.computeMinDistance=function(){var e=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof bo&&arguments[1]instanceof Il){var n=arguments[0],r=arguments[1],i=arguments[2];if(n.getEnvelopeInternal().distance(r.getEnvelopeInternal())>this._minDistance)return null;for(var o=n.getCoordinates(),a=r.getCoordinate(),s=0;s<o.length-1;s++){var u=Rn.distancePointLine(a,o[s],o[s+1]);if(u<e._minDistance){e._minDistance=u;var d=new Jn(o[s],o[s+1]),g=d.closestPoint(a);i[0]=new Ta(n,s,g),i[1]=new Ta(r,0,a)}if(e._minDistance<=e._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof bo&&arguments[1]instanceof bo){var _=arguments[0],E=arguments[1],P=arguments[2];if(_.getEnvelopeInternal().distance(E.getEnvelopeInternal())>this._minDistance)return null;for(var R=_.getCoordinates(),B=E.getCoordinates(),V=0;V<R.length-1;V++)for(var z=0;z<B.length-1;z++){var F=Rn.distanceLineLine(R[V],R[V+1],B[z],B[z+1]);if(F<e._minDistance){e._minDistance=F;var k=new Jn(R[V],R[V+1]),X=new Jn(B[z],B[z+1]),Y=k.closestPoints(X);P[0]=new Ta(_,V,Y[0]),P[1]=new Ta(E,z,Y[1])}if(e._minDistance<=e._terminateDistance)return null}}}};Xs.prototype.computeMinDistancePoints=function(e,n,r){for(var i=this,o=0;o<e.size();o++)for(var a=e.get(o),s=0;s<n.size();s++){var u=n.get(s),d=a.getCoordinate().distance(u.getCoordinate());if(d<i._minDistance&&(i._minDistance=d,r[0]=new Ta(a,0,a.getCoordinate()),r[1]=new Ta(u,0,u.getCoordinate())),i._minDistance<=i._terminateDistance)return null}};Xs.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new oo("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};Xs.prototype.computeMinDistanceLines=function(e,n,r){for(var i=this,o=0;o<e.size();o++)for(var a=e.get(o),s=0;s<n.size();s++){var u=n.get(s);if(i.computeMinDistance(a,u,r),i._minDistance<=i._terminateDistance)return null}};Xs.prototype.interfaces_=function(){return[]};Xs.prototype.getClass=function(){return Xs};Xs.distance=function(e,n){var r=new Xs(e,n);return r.distance()};Xs.isWithinDistance=function(e,n,r){var i=new Xs(e,n,r);return i.distance()<=r};Xs.nearestPoints=function(e,n){var r=new Xs(e,n);return r.nearestPoints()};var sa=function(){this._pt=[new dt,new dt],this._distance=mr.NaN,this._isNull=!0};sa.prototype.getCoordinates=function(){return this._pt};sa.prototype.getCoordinate=function(e){return this._pt[e]};sa.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var n=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(n,r),null;var i=n.distance(r);i<this._distance&&this.initialize(n,r,i)}};sa.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(n),this._distance=e.distance(n),this._isNull=!1}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(i),this._distance=o,this._isNull=!1}};sa.prototype.toString=function(){return xc.toLineString(this._pt[0],this._pt[1])};sa.prototype.getDistance=function(){return this._distance};sa.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var n=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(n,r),null;var i=n.distance(r);i>this._distance&&this.initialize(n,r,i)}};sa.prototype.interfaces_=function(){return[]};sa.prototype.getClass=function(){return sa};var uf=function(){};uf.prototype.interfaces_=function(){return[]};uf.prototype.getClass=function(){return uf};uf.computeDistance=function(){if(arguments[2]instanceof sa&&arguments[0]instanceof bo&&arguments[1]instanceof dt)for(var e=arguments[0],n=arguments[1],r=arguments[2],i=new Jn,o=e.getCoordinates(),a=0;a<o.length-1;a++){i.setCoordinates(o[a],o[a+1]);var s=i.closestPoint(n);r.setMinimum(s,n)}else if(arguments[2]instanceof sa&&arguments[0]instanceof us&&arguments[1]instanceof dt){var u=arguments[0],d=arguments[1],g=arguments[2];uf.computeDistance(u.getExteriorRing(),d,g);for(var _=0;_<u.getNumInteriorRing();_++)uf.computeDistance(u.getInteriorRingN(_),d,g)}else if(arguments[2]instanceof sa&&arguments[0]instanceof ir&&arguments[1]instanceof dt){var E=arguments[0],P=arguments[1],R=arguments[2];if(E instanceof bo)uf.computeDistance(E,P,R);else if(E instanceof us)uf.computeDistance(E,P,R);else if(E instanceof Ra)for(var B=E,V=0;V<B.getNumGeometries();V++){var z=B.getGeometryN(V);uf.computeDistance(z,P,R)}else R.setMinimum(E.getCoordinate(),P)}else if(arguments[2]instanceof sa&&arguments[0]instanceof Jn&&arguments[1]instanceof dt){var F=arguments[0],k=arguments[1],X=arguments[2],Y=F.closestPoint(k);X.setMinimum(Y,k)}};var Lu=function(){this._g0=null,this._g1=null,this._ptDist=new sa,this._densifyFrac=0;var e=arguments[0],n=arguments[1];this._g0=e,this._g1=n},E6={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Lu.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};Lu.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new oo("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e};Lu.prototype.compute=function(e,n){this.computeOrientedDistance(e,n,this._ptDist),this.computeOrientedDistance(n,e,this._ptDist)};Lu.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};Lu.prototype.computeOrientedDistance=function(e,n,r){var i=new X0(n);if(e.apply(i),r.setMaximum(i.getMaxPointDistance()),this._densifyFrac>0){var o=new mg(n,this._densifyFrac);e.apply(o),r.setMaximum(o.getMaxPointDistance())}};Lu.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};Lu.prototype.interfaces_=function(){return[]};Lu.prototype.getClass=function(){return Lu};Lu.distance=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1],r=new Lu(e,n);return r.distance()}else if(arguments.length===3){var i=arguments[0],o=arguments[1],a=arguments[2],s=new Lu(i,o);return s.setDensifyFraction(a),s.distance()}};E6.MaxPointDistanceFilter.get=function(){return X0};E6.MaxDensifiedByFractionDistanceFilter.get=function(){return mg};Object.defineProperties(Lu,E6);var X0=function(){this._maxPtDist=new sa,this._minPtDist=new sa,this._euclideanDist=new uf,this._geom=null;var e=arguments[0];this._geom=e};X0.prototype.filter=function(e){this._minPtDist.initialize(),uf.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};X0.prototype.getMaxPointDistance=function(){return this._maxPtDist};X0.prototype.interfaces_=function(){return[Ch]};X0.prototype.getClass=function(){return X0};var mg=function(){this._maxPtDist=new sa,this._minPtDist=new sa,this._geom=null,this._numSubSegs=0;var e=arguments[0],n=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/n))};mg.prototype.filter=function(e,n){var r=this;if(n===0)return null;for(var i=e.getCoordinate(n-1),o=e.getCoordinate(n),a=(o.x-i.x)/this._numSubSegs,s=(o.y-i.y)/this._numSubSegs,u=0;u<this._numSubSegs;u++){var d=i.x+u*a,g=i.y+u*s,_=new dt(d,g);r._minPtDist.initialize(),uf.computeDistance(r._geom,_,r._minPtDist),r._maxPtDist.setMaximum(r._minPtDist)}};mg.prototype.isDone=function(){return!1};mg.prototype.isGeometryChanged=function(){return!1};mg.prototype.getMaxPointDistance=function(){return this._maxPtDist};mg.prototype.interfaces_=function(){return[bc]};mg.prototype.getClass=function(){return mg};var Tl=function(e,n,r){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=n||null,this._result=r||null},S6={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Tl.prototype.checkMaximumDistance=function(e,n,r){var i=new Lu(n,e);if(i.setDensifyFraction(.25),this._maxDistanceFound=i.orientedDistance(),this._maxDistanceFound>r){this._isValid=!1;var o=i.getCoordinates();this._errorLocation=o[1],this._errorIndicator=e.getFactory().createLineString(o),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+xc.toLineString(o[0],o[1])+")"}};Tl.prototype.isValid=function(){var e=Math.abs(this._bufDistance),n=Tl.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-n,this._maxValidDistance=e+n,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Tl.VERBOSE&&qs.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};Tl.prototype.checkNegativeValid=function(){if(!(this._input instanceof us||this._input instanceof yh||this._input instanceof Ra))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)};Tl.prototype.getErrorIndicator=function(){return this._errorIndicator};Tl.prototype.checkMinimumDistance=function(e,n,r){var i=new Xs(e,n,r);if(this._minDistanceFound=i.distance(),this._minDistanceFound<r){this._isValid=!1;var o=i.nearestPoints();this._errorLocation=i.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(o),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+xc.toLineString(o[0],o[1])+" )"}};Tl.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)};Tl.prototype.getErrorLocation=function(){return this._errorLocation};Tl.prototype.getPolygonLines=function(e){for(var n=new bn,r=new Gs(n),i=zd.getPolygons(e),o=i.iterator();o.hasNext();){var a=o.next();a.apply(r)}return e.getFactory().buildGeometry(n)};Tl.prototype.getErrorMessage=function(){return this._errMsg};Tl.prototype.interfaces_=function(){return[]};Tl.prototype.getClass=function(){return Tl};S6.VERBOSE.get=function(){return!1};S6.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Tl,S6);var Zs=function(e,n,r){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=n||null,this._result=r||null},T6={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Zs.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Zs.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*Zs.MAX_ENV_DIFF_FRAC;e===0&&(e=.001);var n=new Qn(this._input.getEnvelopeInternal());n.expandBy(this._distance);var r=new Qn(this._result.getEnvelopeInternal());r.expandBy(e),r.contains(n)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(r)),this.report("Envelope")};Zs.prototype.checkDistance=function(){var e=new Tl(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")};Zs.prototype.checkArea=function(){var e=this._input.getArea(),n=this._result.getArea();this._distance>0&&e>n&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<n&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Zs.prototype.checkPolygonal=function(){this._result instanceof us||this._result instanceof yh||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Zs.prototype.getErrorIndicator=function(){return this._errorIndicator};Zs.prototype.getErrorLocation=function(){return this._errorLocation};Zs.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Zs.prototype.report=function(e){if(!Zs.VERBOSE)return null;qs.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))};Zs.prototype.getErrorMessage=function(){return this._errorMsg};Zs.prototype.interfaces_=function(){return[]};Zs.prototype.getClass=function(){return Zs};Zs.isValidMsg=function(e,n,r){var i=new Zs(e,n,r);return i.isValid()?null:i.getErrorMessage()};Zs.isValid=function(e,n,r){var i=new Zs(e,n,r);return!!i.isValid()};T6.VERBOSE.get=function(){return!1};T6.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Zs,T6);var Mf=function(){this._pts=null,this._data=null;var e=arguments[0],n=arguments[1];this._pts=e,this._data=n};Mf.prototype.getCoordinates=function(){return this._pts};Mf.prototype.size=function(){return this._pts.length};Mf.prototype.getCoordinate=function(e){return this._pts[e]};Mf.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Mf.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:V0.octant(this.getCoordinate(e),this.getCoordinate(e+1))};Mf.prototype.setData=function(e){this._data=e};Mf.prototype.getData=function(){return this._data};Mf.prototype.toString=function(){return xc.toLineString(new Mo(this._pts))};Mf.prototype.interfaces_=function(){return[Mh]};Mf.prototype.getClass=function(){return Mf};var Is=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new bn,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null};Is.prototype.getInteriorIntersection=function(){return this._interiorIntersection};Is.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e};Is.prototype.getIntersectionSegments=function(){return this._intSegments};Is.prototype.count=function(){return this._intersectionCount};Is.prototype.getIntersections=function(){return this._intersections};Is.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Is.prototype.setKeepIntersections=function(e){this._keepIntersections=e};Is.prototype.processIntersections=function(e,n,r,i){if(!this._findAllIntersections&&this.hasIntersection()||e===r&&n===i)return null;if(this._isCheckEndSegmentsOnly){var o=this.isEndSegment(e,n)||this.isEndSegment(r,i);if(!o)return null}var a=e.getCoordinates()[n],s=e.getCoordinates()[n+1],u=r.getCoordinates()[i],d=r.getCoordinates()[i+1];this._li.computeIntersection(a,s,u,d),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=a,this._intSegments[1]=s,this._intSegments[2]=u,this._intSegments[3]=d,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};Is.prototype.isEndSegment=function(e,n){return n===0||n>=e.size()-2};Is.prototype.hasIntersection=function(){return this._interiorIntersection!==null};Is.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};Is.prototype.interfaces_=function(){return[nA]};Is.prototype.getClass=function(){return Is};Is.createAllIntersectionsFinder=function(e){var n=new Is(e);return n.setFindAllIntersections(!0),n};Is.createAnyIntersectionFinder=function(e){return new Is(e)};Is.createIntersectionCounter=function(e){var n=new Is(e);return n.setFindAllIntersections(!0),n.setKeepIntersections(!1),n};var Cc=function(){this._li=new vA,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e};Cc.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Cc.prototype.getIntersections=function(){return this._segInt.getIntersections()};Cc.prototype.isValid=function(){return this.execute(),this._isValid};Cc.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Cc.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Is(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new b6;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Cc.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Wd(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Cc.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+xc.toLineString(e[0],e[1])+" and "+xc.toLineString(e[2],e[3])};Cc.prototype.interfaces_=function(){return[]};Cc.prototype.getClass=function(){return Cc};Cc.computeIntersections=function(e){var n=new Cc(e);return n.setFindAllIntersections(!0),n.isValid(),n.getIntersections()};var oA=function t(){this._nv=null;var e=arguments[0];this._nv=new Cc(t.toSegmentStrings(e))};oA.prototype.checkValid=function(){this._nv.checkValid()};oA.prototype.interfaces_=function(){return[]};oA.prototype.getClass=function(){return oA};oA.toSegmentStrings=function(e){for(var n=new bn,r=e.iterator();r.hasNext();){var i=r.next();n.add(new Mf(i.getCoordinates(),i))}return n};oA.checkValid=function(e){var n=new oA(e);n.checkValid()};var Z0=function(e){this._mapOp=e};Z0.prototype.map=function(e){for(var n=this,r=new bn,i=0;i<e.getNumGeometries();i++){var o=n._mapOp.map(e.getGeometryN(i));o.isEmpty()||r.add(o)}return e.getFactory().createGeometryCollection(kr.toGeometryArray(r))};Z0.prototype.interfaces_=function(){return[]};Z0.prototype.getClass=function(){return Z0};Z0.map=function(e,n){var r=new Z0(n);return r.map(e)};var Of=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new bn,this._resultLineList=new bn;var e=arguments[0],n=arguments[1],r=arguments[2];this._op=e,this._geometryFactory=n,this._ptLocator=r};Of.prototype.collectLines=function(e){for(var n=this,r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var i=r.next();n.collectLineEdge(i,e,n._lineEdgesList),n.collectBoundaryTouchEdge(i,e,n._lineEdgesList)}};Of.prototype.labelIsolatedLine=function(e,n){var r=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(n));e.getLabel().setLocation(n,r)};Of.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList};Of.prototype.collectLineEdge=function(e,n,r){var i=e.getLabel(),o=e.getEdge();e.isLineEdge()&&!e.isVisited()&&Sr.isResultOfOp(i,n)&&!o.isCovered()&&(r.add(o),e.setVisitedEdge(!0))};Of.prototype.findCoveredLineEdges=function(){for(var e=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var r=n.next();r.getEdges().findCoveredLineEdges()}for(var i=this._op.getGraph().getEdgeEnds().iterator();i.hasNext();){var o=i.next(),a=o.getEdge();if(o.isLineEdge()&&!a.isCoveredSet()){var s=e._op.isCoveredByA(o.getCoordinate());a.setCovered(s)}}};Of.prototype.labelIsolatedLines=function(e){for(var n=this,r=e.iterator();r.hasNext();){var i=r.next(),o=i.getLabel();i.isIsolated()&&(o.isNull(0)?n.labelIsolatedLine(i,0):n.labelIsolatedLine(i,1))}};Of.prototype.buildLines=function(e){for(var n=this,r=this._lineEdgesList.iterator();r.hasNext();){var i=r.next(),o=n._geometryFactory.createLineString(i.getCoordinates());n._resultLineList.add(o),i.setInResult(!0)}};Of.prototype.collectBoundaryTouchEdge=function(e,n,r){var i=e.getLabel();if(e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult())return null;Pr.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),Sr.isResultOfOp(i,n)&&n===Sr.INTERSECTION&&(r.add(e.getEdge()),e.setVisitedEdge(!0))};Of.prototype.interfaces_=function(){return[]};Of.prototype.getClass=function(){return Of};var Y0=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new bn;var e=arguments[0],n=arguments[1];this._op=e,this._geometryFactory=n};Y0.prototype.filterCoveredNodeToPoint=function(e){var n=e.getCoordinate();if(!this._op.isCoveredByLA(n)){var r=this._geometryFactory.createPoint(n);this._resultPointList.add(r)}};Y0.prototype.extractNonCoveredResultNodes=function(e){for(var n=this,r=this._op.getGraph().getNodes().iterator();r.hasNext();){var i=r.next();if(!i.isInResult()&&!i.isIncidentEdgeInResult()&&(i.getEdges().getDegree()===0||e===Sr.INTERSECTION)){var o=i.getLabel();Sr.isResultOfOp(o,e)&&n.filterCoveredNodeToPoint(i)}}};Y0.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList};Y0.prototype.interfaces_=function(){return[]};Y0.prototype.getClass=function(){return Y0};var tl=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};tl.prototype.transformPoint=function(e,n){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))};tl.prototype.transformPolygon=function(e,n){var r=this,i=!0,o=this.transformLinearRing(e.getExteriorRing(),e);(o===null||!(o instanceof Ph)||o.isEmpty())&&(i=!1);for(var a=new bn,s=0;s<e.getNumInteriorRing();s++){var u=r.transformLinearRing(e.getInteriorRingN(s),e);u===null||u.isEmpty()||(u instanceof Ph||(i=!1),a.add(u))}if(i)return this._factory.createPolygon(o,a.toArray([]));var d=new bn;return o!==null&&d.add(o),d.addAll(a),this._factory.buildGeometry(d)};tl.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)};tl.prototype.getInputGeometry=function(){return this._inputGeom};tl.prototype.transformMultiLineString=function(e,n){for(var r=this,i=new bn,o=0;o<e.getNumGeometries();o++){var a=r.transformLineString(e.getGeometryN(o),e);a!==null&&(a.isEmpty()||i.add(a))}return this._factory.buildGeometry(i)};tl.prototype.transformCoordinates=function(e,n){return this.copy(e)};tl.prototype.transformLineString=function(e,n){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))};tl.prototype.transformMultiPoint=function(e,n){for(var r=this,i=new bn,o=0;o<e.getNumGeometries();o++){var a=r.transformPoint(e.getGeometryN(o),e);a!==null&&(a.isEmpty()||i.add(a))}return this._factory.buildGeometry(i)};tl.prototype.transformMultiPolygon=function(e,n){for(var r=this,i=new bn,o=0;o<e.getNumGeometries();o++){var a=r.transformPolygon(e.getGeometryN(o),e);a!==null&&(a.isEmpty()||i.add(a))}return this._factory.buildGeometry(i)};tl.prototype.copy=function(e){return e.copy()};tl.prototype.transformGeometryCollection=function(e,n){for(var r=this,i=new bn,o=0;o<e.getNumGeometries();o++){var a=r.transform(e.getGeometryN(o));a!==null&&(r._pruneEmptyGeometry&&a.isEmpty()||i.add(a))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(kr.toGeometryArray(i)):this._factory.buildGeometry(i)};tl.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof Il)return this.transformPoint(e,null);if(e instanceof Qv)return this.transformMultiPoint(e,null);if(e instanceof Ph)return this.transformLinearRing(e,null);if(e instanceof bo)return this.transformLineString(e,null);if(e instanceof Jm)return this.transformMultiLineString(e,null);if(e instanceof us)return this.transformPolygon(e,null);if(e instanceof yh)return this.transformMultiPolygon(e,null);if(e instanceof Ra)return this.transformGeometryCollection(e,null);throw new oo("Unknown Geometry subtype: "+e.getClass().getName())};tl.prototype.transformLinearRing=function(e,n){var r=this.transformCoordinates(e.getCoordinateSequence(),e);if(r===null)return this._factory.createLinearRing(null);var i=r.size();return i>0&&i<4&&!this._preserveType?this._factory.createLineString(r):this._factory.createLinearRing(r)};tl.prototype.interfaces_=function(){return[]};tl.prototype.getClass=function(){return tl};var Lh=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new Jn,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof bo&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1];t.call(this,e.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var r=arguments[0],i=arguments[1];this._srcPts=r,this._isClosed=t.isClosed(r),this._snapTolerance=i}};Lh.prototype.snapVertices=function(e,n){for(var r=this,i=this._isClosed?e.size()-1:e.size(),o=0;o<i;o++){var a=e.get(o),s=r.findSnapForVertex(a,n);s!==null&&(e.set(o,new dt(s)),o===0&&r._isClosed&&e.set(e.size()-1,new dt(s)))}};Lh.prototype.findSnapForVertex=function(e,n){for(var r=this,i=0;i<n.length;i++){if(e.equals2D(n[i]))return null;if(e.distance(n[i])<r._snapTolerance)return n[i]}return null};Lh.prototype.snapTo=function(e){var n=new YE(this._srcPts);this.snapVertices(n,e),this.snapSegments(n,e);var r=n.toCoordinateArray();return r};Lh.prototype.snapSegments=function(e,n){var r=this;if(n.length===0)return null;var i=n.length;n[0].equals2D(n[n.length-1])&&(i=n.length-1);for(var o=0;o<i;o++){var a=n[o],s=r.findSegmentIndexToSnap(a,e);s>=0&&e.add(s+1,new dt(a),!1)}};Lh.prototype.findSegmentIndexToSnap=function(e,n){for(var r=this,i=mr.MAX_VALUE,o=-1,a=0;a<n.size()-1;a++){if(r._seg.p0=n.get(a),r._seg.p1=n.get(a+1),r._seg.p0.equals2D(e)||r._seg.p1.equals2D(e)){if(r._allowSnappingToSourceVertices)continue;return-1}var s=r._seg.distance(e);s<r._snapTolerance&&s<i&&(i=s,o=a)}return o};Lh.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e};Lh.prototype.interfaces_=function(){return[]};Lh.prototype.getClass=function(){return Lh};Lh.isClosed=function(e){return e.length<=1?!1:e[0].equals2D(e[e.length-1])};var Oo=function(e){this._srcGeom=e||null},lie={SNAP_PRECISION_FACTOR:{configurable:!0}};Oo.prototype.snapTo=function(e,n){var r=this.extractTargetCoordinates(e),i=new uie(n,r);return i.transform(this._srcGeom)};Oo.prototype.snapToSelf=function(e,n){var r=this.extractTargetCoordinates(this._srcGeom),i=new uie(e,r,!0),o=i.transform(this._srcGeom),a=o;return n&&ar(a,cg)&&(a=o.buffer(0)),a};Oo.prototype.computeSnapTolerance=function(e){var n=this.computeMinimumSegmentLength(e),r=n/10;return r};Oo.prototype.extractTargetCoordinates=function(e){for(var n=new wf,r=e.getCoordinates(),i=0;i<r.length;i++)n.add(r[i]);return n.toArray(new Array(0).fill(null))};Oo.prototype.computeMinimumSegmentLength=function(e){for(var n=mr.MAX_VALUE,r=0;r<e.length-1;r++){var i=e[r].distance(e[r+1]);i<n&&(n=i)}return n};Oo.prototype.interfaces_=function(){return[]};Oo.prototype.getClass=function(){return Oo};Oo.snap=function(e,n,r){var i=new Array(2).fill(null),o=new Oo(e);i[0]=o.snapTo(n,r);var a=new Oo(n);return i[1]=a.snapTo(i[0],r),i};Oo.computeOverlaySnapTolerance=function(){if(arguments.length===1){var e=arguments[0],n=Oo.computeSizeBasedSnapTolerance(e),r=e.getPrecisionModel();if(r.getType()===si.FIXED){var i=1/r.getScale()*2/1.415;i>n&&(n=i)}return n}else if(arguments.length===2){var o=arguments[0],a=arguments[1];return Math.min(Oo.computeOverlaySnapTolerance(o),Oo.computeOverlaySnapTolerance(a))}};Oo.computeSizeBasedSnapTolerance=function(e){var n=e.getEnvelopeInternal(),r=Math.min(n.getHeight(),n.getWidth()),i=r*Oo.SNAP_PRECISION_FACTOR;return i};Oo.snapToSelf=function(e,n,r){var i=new Oo(e);return i.snapToSelf(n,r)};lie.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(Oo,lie);var uie=function(t){function e(n,r,i){t.call(this),this._snapTolerance=n||null,this._snapPts=r||null,this._isSelfSnap=i!==void 0?i:!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(r,i){var o=new Lh(r,this._snapTolerance);return o.setAllowSnappingToSourceVertices(this._isSelfSnap),o.snapTo(i)},e.prototype.transformCoordinates=function(r,i){var o=r.toCoordinateArray(),a=this.snapLine(o,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(a)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(tl),ba=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};ba.prototype.getCommon=function(){return mr.longBitsToDouble(this._commonBits)};ba.prototype.add=function(e){var n=mr.doubleToLongBits(e);if(this._isFirst)return this._commonBits=n,this._commonSignExp=ba.signExpBits(this._commonBits),this._isFirst=!1,null;var r=ba.signExpBits(n);if(r!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=ba.numCommonMostSigMantissaBits(this._commonBits,n),this._commonBits=ba.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};ba.prototype.toString=function(){if(arguments.length===1){var e=arguments[0],n=mr.longBitsToDouble(e),r=mr.toBinaryString(e),i="0000000000000000000000000000000000000000000000000000000000000000"+r,o=i.substring(i.length-64),a=o.substring(0,1)+"  "+o.substring(1,12)+"(exp) "+o.substring(12)+" [ "+n+" ]";return a}};ba.prototype.interfaces_=function(){return[]};ba.prototype.getClass=function(){return ba};ba.getBit=function(e,n){var r=1<<n;return e&r?1:0};ba.signExpBits=function(e){return e>>52};ba.zeroLowerBits=function(e,n){var r=(1<<n)-1,i=~r,o=e&i;return o};ba.numCommonMostSigMantissaBits=function(e,n){for(var r=0,i=52;i>=0;i--){if(ba.getBit(e,i)!==ba.getBit(n,i))return r;r++}return 52};var Ag=function(){this._commonCoord=null,this._ccFilter=new Q0},C6={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Ag.prototype.addCommonBits=function(e){var n=new _g(this._commonCoord);e.apply(n),e.geometryChanged()};Ag.prototype.removeCommonBits=function(e){if(this._commonCoord.x===0&&this._commonCoord.y===0)return e;var n=new dt(this._commonCoord);n.x=-n.x,n.y=-n.y;var r=new _g(n);return e.apply(r),e.geometryChanged(),e};Ag.prototype.getCommonCoordinate=function(){return this._commonCoord};Ag.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};Ag.prototype.interfaces_=function(){return[]};Ag.prototype.getClass=function(){return Ag};C6.CommonCoordinateFilter.get=function(){return Q0};C6.Translater.get=function(){return _g};Object.defineProperties(Ag,C6);var Q0=function(){this._commonBitsX=new ba,this._commonBitsY=new ba};Q0.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)};Q0.prototype.getCommonCoordinate=function(){return new dt(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};Q0.prototype.interfaces_=function(){return[Ch]};Q0.prototype.getClass=function(){return Q0};var _g=function(){this.trans=null;var e=arguments[0];this.trans=e};_g.prototype.filter=function(e,n){var r=e.getOrdinate(n,0)+this.trans.x,i=e.getOrdinate(n,1)+this.trans.y;e.setOrdinate(n,0,r),e.setOrdinate(n,1,i)};_g.prototype.isDone=function(){return!1};_g.prototype.isGeometryChanged=function(){return!0};_g.prototype.interfaces_=function(){return[bc]};_g.prototype.getClass=function(){return _g};var Ms=function(e,n){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=n,this.computeSnapTolerance()};Ms.prototype.selfSnap=function(e){var n=new Oo(e),r=n.snapTo(e,this._snapTolerance);return r};Ms.prototype.removeCommonBits=function(e){this._cbr=new Ag,this._cbr.add(e[0]),this._cbr.add(e[1]);var n=new Array(2).fill(null);return n[0]=this._cbr.removeCommonBits(e[0].copy()),n[1]=this._cbr.removeCommonBits(e[1].copy()),n};Ms.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e};Ms.prototype.getResultGeometry=function(e){var n=this.snap(this._geom),r=Sr.overlayOp(n[0],n[1],e);return this.prepareResult(r)};Ms.prototype.checkValid=function(e){e.isValid()||qs.out.println("Snapped geometry is invalid")};Ms.prototype.computeSnapTolerance=function(){this._snapTolerance=Oo.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};Ms.prototype.snap=function(e){var n=this.removeCommonBits(e),r=Oo.snap(n[0],n[1],this._snapTolerance);return r};Ms.prototype.interfaces_=function(){return[]};Ms.prototype.getClass=function(){return Ms};Ms.overlayOp=function(e,n,r){var i=new Ms(e,n);return i.getResultGeometry(r)};Ms.union=function(e,n){return Ms.overlayOp(e,n,Sr.UNION)};Ms.intersection=function(e,n){return Ms.overlayOp(e,n,Sr.INTERSECTION)};Ms.symDifference=function(e,n){return Ms.overlayOp(e,n,Sr.SYMDIFFERENCE)};Ms.difference=function(e,n){return Ms.overlayOp(e,n,Sr.DIFFERENCE)};var Ba=function(e,n){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=n};Ba.prototype.getResultGeometry=function(e){var n=null,r=!1,i=null;try{n=Sr.overlayOp(this._geom[0],this._geom[1],e);var o=!0;o&&(r=!0)}catch(a){if(a instanceof $d)i=a;else throw a}finally{}if(!r)try{n=Ms.overlayOp(this._geom[0],this._geom[1],e)}catch(a){throw a instanceof $d?i:a}finally{}return n};Ba.prototype.interfaces_=function(){return[]};Ba.prototype.getClass=function(){return Ba};Ba.overlayOp=function(e,n,r){var i=new Ba(e,n);return i.getResultGeometry(r)};Ba.union=function(e,n){return Ba.overlayOp(e,n,Sr.UNION)};Ba.intersection=function(e,n){return Ba.overlayOp(e,n,Sr.INTERSECTION)};Ba.symDifference=function(e,n){return Ba.overlayOp(e,n,Sr.SYMDIFFERENCE)};Ba.difference=function(e,n){return Ba.overlayOp(e,n,Sr.DIFFERENCE)};var eE=function(){this.mce=null,this.chainIndex=null;var e=arguments[0],n=arguments[1];this.mce=e,this.chainIndex=n};eE.prototype.computeIntersections=function(e,n){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,n)};eE.prototype.interfaces_=function(){return[]};eE.prototype.getClass=function(){return eE};var Rl=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var e=arguments[0],n=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=n}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2];this._eventType=t.INSERT,this._label=r,this._xValue=i,this._obj=o}},P6={INSERT:{configurable:!0},DELETE:{configurable:!0}};Rl.prototype.isDelete=function(){return this._eventType===Rl.DELETE};Rl.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e};Rl.prototype.getObject=function(){return this._obj};Rl.prototype.compareTo=function(e){var n=e;return this._xValue<n._xValue?-1:this._xValue>n._xValue?1:this._eventType<n._eventType?-1:this._eventType>n._eventType?1:0};Rl.prototype.getInsertEvent=function(){return this._insertEvent};Rl.prototype.isInsert=function(){return this._eventType===Rl.INSERT};Rl.prototype.isSameLabel=function(e){return this._label===null?!1:this._label===e._label};Rl.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};Rl.prototype.interfaces_=function(){return[Uu]};Rl.prototype.getClass=function(){return Rl};P6.INSERT.get=function(){return 1};P6.DELETE.get=function(){return 2};Object.defineProperties(Rl,P6);var EI=function(){};EI.prototype.interfaces_=function(){return[]};EI.prototype.getClass=function(){return EI};var Ys=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._li=e,this._includeProper=n,this._recordIsolated=r};Ys.prototype.isTrivialIntersection=function(e,n,r,i){if(e===r&&this._li.getIntersectionNum()===1){if(Ys.isAdjacentSegments(n,i))return!0;if(e.isClosed()){var o=e.getNumPoints()-1;if(n===0&&i===o||i===0&&n===o)return!0}}return!1};Ys.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Ys.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e};Ys.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Ys.prototype.isBoundaryPointInternal=function(e,n){for(var r=n.iterator();r.hasNext();){var i=r.next(),o=i.getCoordinate();if(e.isIntersection(o))return!0}return!1};Ys.prototype.hasProperIntersection=function(){return this._hasProper};Ys.prototype.hasIntersection=function(){return this._hasIntersection};Ys.prototype.isDone=function(){return this._isDone};Ys.prototype.isBoundaryPoint=function(e,n){return n===null?!1:!!(this.isBoundaryPointInternal(e,n[0])||this.isBoundaryPointInternal(e,n[1]))};Ys.prototype.setBoundaryNodes=function(e,n){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=n};Ys.prototype.addIntersections=function(e,n,r,i){if(e===r&&n===i)return null;this.numTests++;var o=e.getCoordinates()[n],a=e.getCoordinates()[n+1],s=r.getCoordinates()[i],u=r.getCoordinates()[i+1];this._li.computeIntersection(o,a,s,u),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),r.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,n,r,i)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(e.addIntersections(this._li,n,0),r.addIntersections(this._li,i,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Ys.prototype.interfaces_=function(){return[]};Ys.prototype.getClass=function(){return Ys};Ys.isAdjacentSegments=function(e,n){return Math.abs(e-n)===1};var MRe=function(t){function e(){t.call(this),this.events=new bn,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){var r=this;Ec.sort(this.events);for(var i=0;i<this.events.size();i++){var o=r.events.get(i);o.isDelete()&&o.getInsertEvent().setDeleteEventIndex(i)}},e.prototype.computeIntersections=function(){var r=this;if(arguments.length===1){var i=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var o=0;o<this.events.size();o++){var a=r.events.get(o);if(a.isInsert()&&r.processOverlaps(o,a.getDeleteEventIndex(),a,i),i.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Ys&&ar(arguments[0],Ac)&&ar(arguments[1],Ac)){var s=arguments[0],u=arguments[1],d=arguments[2];this.addEdges(s,s),this.addEdges(u,u),this.computeIntersections(d)}else if(typeof arguments[2]=="boolean"&&ar(arguments[0],Ac)&&arguments[1]instanceof Ys){var g=arguments[0],_=arguments[1],E=arguments[2];E?this.addEdges(g,null):this.addEdges(g),this.computeIntersections(_)}}},e.prototype.addEdge=function(r,i){for(var o=this,a=r.getMonotoneChainEdge(),s=a.getStartIndexes(),u=0;u<s.length-1;u++){var d=new eE(a,u),g=new Rl(i,a.getMinX(u),d);o.events.add(g),o.events.add(new Rl(a.getMaxX(u),g))}},e.prototype.processOverlaps=function(r,i,o,a){for(var s=this,u=o.getObject(),d=r;d<i;d++){var g=s.events.get(d);if(g.isInsert()){var _=g.getObject();o.isSameLabel(g)||(u.computeIntersections(_,a),s.nOverlaps++)}}},e.prototype.addEdges=function(){var r=this;if(arguments.length===1)for(var i=arguments[0],o=i.iterator();o.hasNext();){var a=o.next();r.addEdge(a,a)}else if(arguments.length===2)for(var s=arguments[0],u=arguments[1],d=s.iterator();d.hasNext();){var g=d.next();r.addEdge(g,u)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(EI),Dh=function(){this._min=mr.POSITIVE_INFINITY,this._max=mr.NEGATIVE_INFINITY},cie={NodeComparator:{configurable:!0}};Dh.prototype.getMin=function(){return this._min};Dh.prototype.intersects=function(e,n){return!(this._min>n||this._max<e)};Dh.prototype.getMax=function(){return this._max};Dh.prototype.toString=function(){return xc.toLineString(new dt(this._min,0),new dt(this._max,0))};Dh.prototype.interfaces_=function(){return[]};Dh.prototype.getClass=function(){return Dh};cie.NodeComparator.get=function(){return tE};Object.defineProperties(Dh,cie);var tE=function(){};tE.prototype.compare=function(e,n){var r=e,i=n,o=(r._min+r._max)/2,a=(i._min+i._max)/2;return o<a?-1:o>a?1:0};tE.prototype.interfaces_=function(){return[$v]};tE.prototype.getClass=function(){return tE};var ORe=function(t){function e(){t.call(this),this._item=null;var n=arguments[0],r=arguments[1],i=arguments[2];this._min=n,this._max=r,this._item=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(r,i,o){if(!this.intersects(r,i))return null;o.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Dh),RRe=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var n=arguments[0],r=arguments[1];this._node1=n,this._node2=r,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(r,i){this._min=Math.min(r._min,i._min),this._max=Math.max(r._max,i._max)},e.prototype.query=function(r,i,o){if(!this.intersects(r,i))return null;this._node1!==null&&this._node1.query(r,i,o),this._node2!==null&&this._node2.query(r,i,o)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Dh),Bh=function(){this._leaves=new bn,this._root=null,this._level=0};Bh.prototype.buildTree=function(){var e=this;Ec.sort(this._leaves,new Dh.NodeComparator);for(var n=this._leaves,r=null,i=new bn;;){if(e.buildLevel(n,i),i.size()===1)return i.get(0);r=n,n=i,i=r}};Bh.prototype.insert=function(e,n,r){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new ORe(e,n,r))};Bh.prototype.query=function(e,n,r){this.init(),this._root.query(e,n,r)};Bh.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};Bh.prototype.printNode=function(e){qs.out.println(xc.toLineString(new dt(e._min,this._level),new dt(e._max,this._level)))};Bh.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};Bh.prototype.buildLevel=function(e,n){this._level++,n.clear();for(var r=0;r<e.size();r+=2){var i=e.get(r),o=r+1<e.size()?e.get(r):null;if(o===null)n.add(i);else{var a=new RRe(e.get(r),e.get(r+1));n.add(a)}}};Bh.prototype.interfaces_=function(){return[]};Bh.prototype.getClass=function(){return Bh};var r1=function(){this._items=new bn};r1.prototype.visitItem=function(e){this._items.add(e)};r1.prototype.getItems=function(){return this._items};r1.prototype.interfaces_=function(){return[fg]};r1.prototype.getClass=function(){return r1};var i1=function(){this._index=null;var e=arguments[0];if(!ar(e,cg))throw new oo("Argument must be Polygonal");this._index=new sA(e)},I6={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};i1.prototype.locate=function(e){var n=new mf(e),r=new o1(n);return this._index.query(e.y,e.y,r),n.getLocation()};i1.prototype.interfaces_=function(){return[t1]};i1.prototype.getClass=function(){return i1};I6.SegmentVisitor.get=function(){return o1};I6.IntervalIndexedGeometry.get=function(){return sA};Object.defineProperties(i1,I6);var o1=function(){this._counter=null;var e=arguments[0];this._counter=e};o1.prototype.visitItem=function(e){var n=e;this._counter.countSegment(n.getCoordinate(0),n.getCoordinate(1))};o1.prototype.interfaces_=function(){return[fg]};o1.prototype.getClass=function(){return o1};var sA=function(){this._index=new Bh;var e=arguments[0];this.init(e)};sA.prototype.init=function(e){for(var n=this,r=Gs.getLines(e),i=r.iterator();i.hasNext();){var o=i.next(),a=o.getCoordinates();n.addLine(a)}};sA.prototype.addLine=function(e){for(var n=this,r=1;r<e.length;r++){var i=new Jn(e[r-1],e[r]),o=Math.min(i.p0.y,i.p1.y),a=Math.max(i.p0.y,i.p1.y);n._index.insert(o,a,i)}};sA.prototype.query=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1],r=new r1;return this._index.query(e,n,r),r.getItems()}else if(arguments.length===3){var i=arguments[0],o=arguments[1],a=arguments[2];this._index.query(i,o,a)}};sA.prototype.interfaces_=function(){return[]};sA.prototype.getClass=function(){return sA};var mb=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new qre,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Tc,arguments.length===2){var n=arguments[0],r=arguments[1],i=Nu.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=r,this._boundaryNodeRule=i,r!==null&&this.add(r)}else if(arguments.length===3){var o=arguments[0],a=arguments[1],s=arguments[2];this._argIndex=o,this._parentGeom=a,this._boundaryNodeRule=s,a!==null&&this.add(a)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(r,i){var o=this._nodes.addNode(i),a=o.getLabel(),s=1,u=Et.NONE;u=a.getLocation(r,gn.ON),u===Et.BOUNDARY&&s++;var d=e.determineBoundary(this._boundaryNodeRule,s);a.setLocation(r,d)},e.prototype.computeSelfNodes=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.computeSelfNodes(r,i,!1)}else if(arguments.length===3){var o=arguments[0],a=arguments[1],s=arguments[2],u=new Ys(o,!0,!1);u.setIsDoneIfProperInt(s);var d=this.createEdgeSetIntersector(),g=this._parentGeom instanceof Ph||this._parentGeom instanceof us||this._parentGeom instanceof yh,_=a||!g;return d.computeIntersections(this._edges,u,_),this.addSelfIntersectionNodes(this._argIndex),u}},e.prototype.computeSplitEdges=function(r){for(var i=this._edges.iterator();i.hasNext();){var o=i.next();o.eiList.addSplitEdges(r)}},e.prototype.computeEdgeIntersections=function(r,i,o){var a=new Ys(i,o,!0);a.setBoundaryNodes(this.getBoundaryNodes(),r.getBoundaryNodes());var s=this.createEdgeSetIntersector();return s.computeIntersections(this._edges,r._edges,a),a},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof Il){var r=arguments[0],i=r.getCoordinate();this.insertPoint(this._argIndex,i,Et.INTERIOR)}else if(arguments[0]instanceof dt){var o=arguments[0];this.insertPoint(this._argIndex,o,Et.INTERIOR)}},e.prototype.addPolygon=function(r){var i=this;this.addPolygonRing(r.getExteriorRing(),Et.EXTERIOR,Et.INTERIOR);for(var o=0;o<r.getNumInteriorRing();o++){var a=r.getInteriorRingN(o);i.addPolygonRing(a,Et.INTERIOR,Et.EXTERIOR)}},e.prototype.addEdge=function(r){this.insertEdge(r);var i=r.getCoordinates();this.insertPoint(this._argIndex,i[0],Et.BOUNDARY),this.insertPoint(this._argIndex,i[i.length-1],Et.BOUNDARY)},e.prototype.addLineString=function(r){var i=zr.removeRepeatedPoints(r.getCoordinates());if(i.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=i[0],null;var o=new wI(i,new di(this._argIndex,Et.INTERIOR));this._lineEdgeMap.put(r,o),this.insertEdge(o),Pr.isTrue(i.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,i[0]),this.insertBoundaryPoint(this._argIndex,i[i.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var r=this.getBoundaryNodes(),i=new Array(r.size()).fill(null),o=0,a=r.iterator();a.hasNext();){var s=a.next();i[o++]=s.getCoordinate().copy()}return i},e.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(r,i,o){if(this.isBoundaryNode(r,i))return null;o===Et.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(r,i):this.insertPoint(r,i,o)},e.prototype.addPolygonRing=function(r,i,o){if(r.isEmpty())return null;var a=zr.removeRepeatedPoints(r.getCoordinates());if(a.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=a[0],null;var s=i,u=o;Rn.isCCW(a)&&(s=o,u=i);var d=new wI(a,new di(this._argIndex,Et.BOUNDARY,s,u));this._lineEdgeMap.put(r,d),this.insertEdge(d),this.insertPoint(this._argIndex,a[0],Et.BOUNDARY)},e.prototype.insertPoint=function(r,i,o){var a=this._nodes.addNode(i),s=a.getLabel();s===null?a._label=new di(r,o):s.setLocation(r,o)},e.prototype.createEdgeSetIntersector=function(){return new MRe},e.prototype.addSelfIntersectionNodes=function(r){for(var i=this,o=this._edges.iterator();o.hasNext();)for(var a=o.next(),s=a.getLabel().getLocation(r),u=a.eiList.iterator();u.hasNext();){var d=u.next();i.addSelfIntersectionNode(r,d.coord,s)}},e.prototype.add=function(){if(arguments.length===1){var r=arguments[0];if(r.isEmpty())return null;if(r instanceof yh&&(this._useBoundaryDeterminationRule=!1),r instanceof us)this.addPolygon(r);else if(r instanceof bo)this.addLineString(r);else if(r instanceof Il)this.addPoint(r);else if(r instanceof Qv)this.addCollection(r);else if(r instanceof Jm)this.addCollection(r);else if(r instanceof yh)this.addCollection(r);else if(r instanceof Ra)this.addCollection(r);else throw new Error(r.getClass().getName())}else return t.prototype.add.apply(this,arguments)},e.prototype.addCollection=function(r){for(var i=this,o=0;o<r.getNumGeometries();o++){var a=r.getGeometryN(o);i.add(a)}},e.prototype.locate=function(r){return ar(this._parentGeom,cg)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new i1(this._parentGeom)),this._areaPtLocator.locate(r)):this._ptLocator.locate(r,this._parentGeom)},e.prototype.findEdge=function(){if(arguments.length===1){var r=arguments[0];return this._lineEdgeMap.get(r)}else return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(r,i){return r.isInBoundary(i)?Et.BOUNDARY:Et.INTERIOR},e}(po),s1=function(){if(this._li=new vA,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new mb(0,e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=Nu.OGC_SFS_BOUNDARY_RULE;n.getPrecisionModel().compareTo(r.getPrecisionModel())>=0?this.setComputationPrecision(n.getPrecisionModel()):this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new mb(0,n,i),this._arg[1]=new mb(1,r,i)}else if(arguments.length===3){var o=arguments[0],a=arguments[1],s=arguments[2];o.getPrecisionModel().compareTo(a.getPrecisionModel())>=0?this.setComputationPrecision(o.getPrecisionModel()):this.setComputationPrecision(a.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new mb(0,o,s),this._arg[1]=new mb(1,a,s)}};s1.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()};s1.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)};s1.prototype.interfaces_=function(){return[]};s1.prototype.getClass=function(){return s1};var Vm=function(){};Vm.prototype.interfaces_=function(){return[]};Vm.prototype.getClass=function(){return Vm};Vm.map=function(){if(arguments[0]instanceof ir&&ar(arguments[1],Vm.MapOp)){for(var e=arguments[0],n=arguments[1],r=new bn,i=0;i<e.getNumGeometries();i++){var o=n.map(e.getGeometryN(i));o!==null&&r.add(o)}return e.getFactory().buildGeometry(r)}else if(ar(arguments[0],Jo)&&ar(arguments[1],Vm.MapOp)){for(var a=arguments[0],s=arguments[1],u=new bn,d=a.iterator();d.hasNext();){var g=d.next(),_=s.map(g);_!==null&&u.add(_)}return u}};Vm.MapOp=function(){};var Sr=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r),this._ptLocator=new Tc,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Sc,this._resultPolyList=new bn,this._resultLineList=new bn,this._resultPointList=new bn,this._graph=new po(new tie),this._geomFact=n.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(r){var i=this._edgeList.findEqualEdge(r);if(i!==null){var o=i.getLabel(),a=r.getLabel();i.isPointwiseEqual(r)||(a=new di(r.getLabel()),a.flip());var s=i.getDepth();s.isNull()&&s.add(o),s.add(a),o.merge(a)}else this._edgeList.add(r)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var i=r.next(),o=i.getSym();i.isInResult()&&o.isInResult()&&(i.setInResult(!1),o.setInResult(!1))}},e.prototype.isCoveredByLA=function(r){return!!(this.isCovered(r,this._resultLineList)||this.isCovered(r,this._resultPolyList))},e.prototype.computeGeometry=function(r,i,o,a){var s=new bn;return s.addAll(r),s.addAll(i),s.addAll(o),s.isEmpty()?e.createEmptyResult(a,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(s)},e.prototype.mergeSymLabels=function(){for(var r=this._graph.getNodes().iterator();r.hasNext();){var i=r.next();i.getEdges().mergeSymLabels()}},e.prototype.isCovered=function(r,i){for(var o=this,a=i.iterator();a.hasNext();){var s=a.next(),u=o._ptLocator.locate(r,s);if(u!==Et.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var r=new bn,i=this._edgeList.iterator();i.hasNext();){var o=i.next();o.isCollapsed()&&(i.remove(),r.add(o.getCollapsedEdge()))}this._edgeList.addAll(r)},e.prototype.updateNodeLabelling=function(){for(var r=this._graph.getNodes().iterator();r.hasNext();){var i=r.next(),o=i.getEdges().getLabel();i.getLabel().merge(o)}},e.prototype.getResultGeometry=function(r){return this.computeOverlay(r),this._resultGeom},e.prototype.insertUniqueEdges=function(r){for(var i=this,o=r.iterator();o.hasNext();){var a=o.next();i.insertUniqueEdge(a)}},e.prototype.computeOverlay=function(r){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var i=new bn;this._arg[0].computeSplitEdges(i),this._arg[1].computeSplitEdges(i),this.insertUniqueEdges(i),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),oA.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(r),this.cancelDuplicateResultEdges();var o=new Ml(this._geomFact);o.add(this._graph),this._resultPolyList=o.getPolygons();var a=new Of(this,this._geomFact,this._ptLocator);this._resultLineList=a.build(r);var s=new Y0(this,this._geomFact,this._ptLocator);this._resultPointList=s.build(r),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,r)},e.prototype.labelIncompleteNode=function(r,i){var o=this._ptLocator.locate(r.getCoordinate(),this._arg[i].getGeometry());r.getLabel().setLocation(i,o)},e.prototype.copyPoints=function(r){for(var i=this,o=this._arg[r].getNodeIterator();o.hasNext();){var a=o.next(),s=i._graph.addNode(a.getCoordinate());s.setLabel(r,a.getLabel().getLocation(r))}},e.prototype.findResultAreaEdges=function(r){for(var i=this._graph.getEdgeEnds().iterator();i.hasNext();){var o=i.next(),a=o.getLabel();a.isArea()&&!o.isInteriorAreaEdge()&&e.isResultOfOp(a.getLocation(0,gn.RIGHT),a.getLocation(1,gn.RIGHT),r)&&o.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var r=this._edgeList.iterator();r.hasNext();){var i=r.next(),o=i.getLabel(),a=i.getDepth();if(!a.isNull()){a.normalize();for(var s=0;s<2;s++)!o.isNull(s)&&o.isArea()&&!a.isNull(s)&&(a.getDelta(s)===0?o.toLine(s):(Pr.isTrue(!a.isNull(s,gn.LEFT),"depth of LEFT side has not been initialized"),o.setLocation(s,gn.LEFT,a.getLocation(s,gn.LEFT)),Pr.isTrue(!a.isNull(s,gn.RIGHT),"depth of RIGHT side has not been initialized"),o.setLocation(s,gn.RIGHT,a.getLocation(s,gn.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var r=this,i=this._graph.getNodes().iterator();i.hasNext();){var o=i.next();o.getEdges().computeLabelling(r._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var r=this,i=this._graph.getNodes().iterator();i.hasNext();){var o=i.next(),a=o.getLabel();o.isIsolated()&&(a.isNull(0)?r.labelIncompleteNode(o,0):r.labelIncompleteNode(o,1)),o.getEdges().updateLabelling(a)}},e.prototype.isCoveredByA=function(r){return!!this.isCovered(r,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(s1);Sr.overlayOp=function(t,e,n){var r=new Sr(t,e),i=r.getResultGeometry(n);return i};Sr.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Sr.createEmptyResult(Sr.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return Z0.map(t,{interfaces_:function(){return[Vm.MapOp]},map:function(r){return r.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Ba.overlayOp(t,e,Sr.INTERSECTION)};Sr.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Sr.createEmptyResult(Sr.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Ba.overlayOp(t,e,Sr.SYMDIFFERENCE)};Sr.resultDimension=function(t,e,n){var r=e.getDimension(),i=n.getDimension(),o=-1;switch(t){case Sr.INTERSECTION:o=Math.min(r,i);break;case Sr.UNION:o=Math.max(r,i);break;case Sr.DIFFERENCE:o=r;break;case Sr.SYMDIFFERENCE:o=Math.max(r,i);break}return o};Sr.createEmptyResult=function(t,e,n,r){var i=null;switch(Sr.resultDimension(t,e,n)){case-1:i=r.createGeometryCollection(new Array(0).fill(null));break;case 0:i=r.createPoint();break;case 1:i=r.createLineString();break;case 2:i=r.createPolygon();break}return i};Sr.difference=function(t,e){return t.isEmpty()?Sr.createEmptyResult(Sr.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Ba.overlayOp(t,e,Sr.DIFFERENCE))};Sr.isResultOfOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=t.getLocation(0),r=t.getLocation(1);return Sr.isResultOfOp(n,r,e)}else if(arguments.length===3){var i=arguments[0],o=arguments[1],a=arguments[2];switch(i===Et.BOUNDARY&&(i=Et.INTERIOR),o===Et.BOUNDARY&&(o=Et.INTERIOR),a){case Sr.INTERSECTION:return i===Et.INTERIOR&&o===Et.INTERIOR;case Sr.UNION:return i===Et.INTERIOR||o===Et.INTERIOR;case Sr.DIFFERENCE:return i===Et.INTERIOR&&o!==Et.INTERIOR;case Sr.SYMDIFFERENCE:return i===Et.INTERIOR&&o!==Et.INTERIOR||i!==Et.INTERIOR&&o===Et.INTERIOR}return!1}};Sr.INTERSECTION=1;Sr.UNION=2;Sr.DIFFERENCE=3;Sr.SYMDIFFERENCE=4;var eg=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Tc,this._seg=new Jn;var e=arguments[0],n=arguments[1];this._g=e,this._boundaryDistanceTolerance=n,this._linework=this.extractLinework(e)};eg.prototype.isWithinToleranceOfBoundary=function(e){for(var n=this,r=0;r<this._linework.getNumGeometries();r++)for(var i=n._linework.getGeometryN(r),o=i.getCoordinateSequence(),a=0;a<o.size()-1;a++){o.getCoordinate(a,n._seg.p0),o.getCoordinate(a+1,n._seg.p1);var s=n._seg.distance(e);if(s<=n._boundaryDistanceTolerance)return!0}return!1};eg.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?Et.BOUNDARY:this._ptLocator.locate(e,this._g)};eg.prototype.extractLinework=function(e){var n=new a1;e.apply(n);var r=n.getLinework(),i=kr.toLineStringArray(r);return e.getFactory().createMultiLineString(i)};eg.prototype.interfaces_=function(){return[]};eg.prototype.getClass=function(){return eg};var a1=function(){this._linework=null,this._linework=new bn};a1.prototype.getLinework=function(){return this._linework};a1.prototype.filter=function(e){var n=this;if(e instanceof us){var r=e;this._linework.add(r.getExteriorRing());for(var i=0;i<r.getNumInteriorRing();i++)n._linework.add(r.getInteriorRingN(i))}};a1.prototype.interfaces_=function(){return[Ef]};a1.prototype.getClass=function(){return a1};var aA=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e};aA.prototype.extractPoints=function(e,n,r){for(var i=this,o=e.getCoordinates(),a=0;a<o.length-1;a++)i.computeOffsetPoints(o[a],o[a+1],n,r)};aA.prototype.setSidesToGenerate=function(e,n){this._doLeft=e,this._doRight=n};aA.prototype.getPoints=function(e){for(var n=this,r=new bn,i=Gs.getLines(this._g),o=i.iterator();o.hasNext();){var a=o.next();n.extractPoints(a,e,r)}return r};aA.prototype.computeOffsetPoints=function(e,n,r,i){var o=n.x-e.x,a=n.y-e.y,s=Math.sqrt(o*o+a*a),u=r*o/s,d=r*a/s,g=(n.x+e.x)/2,_=(n.y+e.y)/2;if(this._doLeft){var E=new dt(g-d,_+u);i.add(E)}if(this._doRight){var P=new dt(g+d,_-u);i.add(P)}};aA.prototype.interfaces_=function(){return[]};aA.prototype.getClass=function(){return aA};var ru=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new bn;var e=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,n),this._geom=[e,n,r],this._locFinder=[new eg(this._geom[0],this._boundaryDistanceTolerance),new eg(this._geom[1],this._boundaryDistanceTolerance),new eg(this._geom[2],this._boundaryDistanceTolerance)]},fie={TOLERANCE:{configurable:!0}};ru.prototype.reportResult=function(e,n,r){qs.out.println("Overlay result invalid - A:"+Et.toLocationSymbol(n[0])+" B:"+Et.toLocationSymbol(n[1])+" expected:"+(r?"i":"e")+" actual:"+Et.toLocationSymbol(n[2]))};ru.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var n=this.checkValid(e);return n};ru.prototype.checkValid=function(){var e=this;if(arguments.length===1){for(var n=arguments[0],r=0;r<this._testCoords.size();r++){var i=e._testCoords.get(r);if(!e.checkValid(n,i))return e._invalidLocation=i,!1}return!0}else if(arguments.length===2){var o=arguments[0],a=arguments[1];return this._location[0]=this._locFinder[0].getLocation(a),this._location[1]=this._locFinder[1].getLocation(a),this._location[2]=this._locFinder[2].getLocation(a),ru.hasLocation(this._location,Et.BOUNDARY)?!0:this.isValidResult(o,this._location)}};ru.prototype.addTestPts=function(e){var n=new aA(e);this._testCoords.addAll(n.getPoints(5*this._boundaryDistanceTolerance))};ru.prototype.isValidResult=function(e,n){var r=Sr.isResultOfOp(n[0],n[1],e),i=n[2]===Et.INTERIOR,o=!(r^i);return o||this.reportResult(e,n,r),o};ru.prototype.getInvalidLocation=function(){return this._invalidLocation};ru.prototype.interfaces_=function(){return[]};ru.prototype.getClass=function(){return ru};ru.hasLocation=function(e,n){for(var r=0;r<3;r++)if(e[r]===n)return!0;return!1};ru.computeBoundaryDistanceTolerance=function(e,n){return Math.min(Oo.computeSizeBasedSnapTolerance(e),Oo.computeSizeBasedSnapTolerance(n))};ru.isValid=function(e,n,r,i){var o=new ru(e,n,i);return o.isValid(r)};fie.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(ru,fie);var ql=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};ql.prototype.extractElements=function(e,n){var r=this;if(e===null)return null;for(var i=0;i<e.getNumGeometries();i++){var o=e.getGeometryN(i);r._skipEmpty&&o.isEmpty()||n.add(o)}};ql.prototype.combine=function(){for(var e=this,n=new bn,r=this._inputGeoms.iterator();r.hasNext();){var i=r.next();e.extractElements(i,n)}return n.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(n)};ql.prototype.interfaces_=function(){return[]};ql.prototype.getClass=function(){return ql};ql.combine=function(){if(arguments.length===1){var e=arguments[0],n=new ql(e);return n.combine()}else if(arguments.length===2){var r=arguments[0],i=arguments[1],o=new ql(ql.createList(r,i));return o.combine()}else if(arguments.length===3){var a=arguments[0],s=arguments[1],u=arguments[2],d=new ql(ql.createList(a,s,u));return d.combine()}};ql.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()};ql.createList=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1],r=new bn;return r.add(e),r.add(n),r}else if(arguments.length===3){var i=arguments[0],o=arguments[1],a=arguments[2],s=new bn;return s.add(i),s.add(o),s.add(a),s}};var Go=function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,this._inputPolys===null&&(this._inputPolys=new bn)},hie={STRTREE_NODE_CAPACITY:{configurable:!0}};Go.prototype.reduceToGeometries=function(e){for(var n=this,r=new bn,i=e.iterator();i.hasNext();){var o=i.next(),a=null;ar(o,Ac)?a=n.unionTree(o):o instanceof ir&&(a=o),r.add(a)}return r};Go.prototype.extractByEnvelope=function(e,n,r){for(var i=new bn,o=0;o<n.getNumGeometries();o++){var a=n.getGeometryN(o);a.getEnvelopeInternal().intersects(e)?i.add(a):r.add(a)}return this._geomFactory.buildGeometry(i)};Go.prototype.unionOptimized=function(e,n){var r=e.getEnvelopeInternal(),i=n.getEnvelopeInternal();if(!r.intersects(i)){var o=ql.combine(e,n);return o}if(e.getNumGeometries()<=1&&n.getNumGeometries()<=1)return this.unionActual(e,n);var a=r.intersection(i);return this.unionUsingEnvelopeIntersection(e,n,a)};Go.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new Qre(Go.STRTREE_NODE_CAPACITY),n=this._inputPolys.iterator();n.hasNext();){var r=n.next();e.insert(r.getEnvelopeInternal(),r)}this._inputPolys=null;var i=e.itemsTree(),o=this.unionTree(i);return o};Go.prototype.binaryUnion=function(){if(arguments.length===1){var e=arguments[0];return this.binaryUnion(e,0,e.size())}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];if(i-r<=1){var o=Go.getGeometry(n,r);return this.unionSafe(o,null)}else{if(i-r===2)return this.unionSafe(Go.getGeometry(n,r),Go.getGeometry(n,r+1));var a=Math.trunc((i+r)/2),s=this.binaryUnion(n,r,a),u=this.binaryUnion(n,a,i);return this.unionSafe(s,u)}}};Go.prototype.repeatedUnion=function(e){for(var n=null,r=e.iterator();r.hasNext();){var i=r.next();n===null?n=i.copy():n=n.union(i)}return n};Go.prototype.unionSafe=function(e,n){return e===null&&n===null?null:e===null?n.copy():n===null?e.copy():this.unionOptimized(e,n)};Go.prototype.unionActual=function(e,n){return Go.restrictToPolygons(e.union(n))};Go.prototype.unionTree=function(e){var n=this.reduceToGeometries(e),r=this.binaryUnion(n);return r};Go.prototype.unionUsingEnvelopeIntersection=function(e,n,r){var i=new bn,o=this.extractByEnvelope(r,e,i),a=this.extractByEnvelope(r,n,i),s=this.unionActual(o,a);i.add(s);var u=ql.combine(i);return u};Go.prototype.bufferUnion=function(){if(arguments.length===1){var e=arguments[0],n=e.get(0).getFactory(),r=n.buildGeometry(e),i=r.buffer(0);return i}else if(arguments.length===2){var o=arguments[0],a=arguments[1],s=o.getFactory(),u=s.createGeometryCollection([o,a]),d=u.buffer(0);return d}};Go.prototype.interfaces_=function(){return[]};Go.prototype.getClass=function(){return Go};Go.restrictToPolygons=function(e){if(ar(e,cg))return e;var n=zd.getPolygons(e);return n.size()===1?n.get(0):e.getFactory().createMultiPolygon(kr.toPolygonArray(n))};Go.getGeometry=function(e,n){return n>=e.size()?null:e.get(n)};Go.union=function(e){var n=new Go(e);return n.union()};hie.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Go,hie);var SI=function(){};SI.prototype.interfaces_=function(){return[]};SI.prototype.getClass=function(){return SI};SI.union=function(e,n){if(e.isEmpty()||n.isEmpty()){if(e.isEmpty()&&n.isEmpty())return Sr.createEmptyResult(Sr.UNION,e,n,e.getFactory());if(e.isEmpty())return n.copy();if(n.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(n),Ba.overlayOp(e,n,Sr.UNION)};function xA(){return new TI}function TI(){this.reset()}TI.prototype={constructor:TI,reset:function(){this.s=this.t=0},add:function(t){s7(zS,t,this.t),s7(this,zS.s,this.s),this.s?this.t+=zS.t:this.s=zS.t},valueOf:function(){return this.s}};var zS=new TI;function s7(t,e,n){var r=t.s=e+n,i=r-e,o=r-i;t.t=e-o+(n-i)}var vo=1e-6,Mi=Math.PI,Ld=Mi/2,a7=Mi/4,Zd=Mi*2,pm=180/Mi,ef=Mi/180,Ca=Math.abs,LRe=Math.atan,l1=Math.atan2,es=Math.cos,ts=Math.sin,G1=Math.sqrt;function die(t){return t>1?0:t<-1?Mi:Math.acos(t)}function K0(t){return t>1?Ld:t<-1?-Ld:Math.asin(t)}function qb(){}function CI(t,e){t&&u7.hasOwnProperty(t.type)&&u7[t.type](t,e)}var l7={Feature:function(t,e){CI(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)CI(n[r].geometry,e)}},u7={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){vk(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)vk(n[r],e,0)},Polygon:function(t,e){c7(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)c7(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)CI(n[r],e)}};function vk(t,e,n){var r=-1,i=t.length-n,o;for(e.lineStart();++r<i;)o=t[r],e.point(o[0],o[1],o[2]);e.lineEnd()}function c7(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)vk(t[n],e,1);e.polygonEnd()}function DRe(t,e){t&&l7.hasOwnProperty(t.type)?l7[t.type](t,e):CI(t,e)}xA();xA();function xk(t){return[l1(t[1],t[0]),K0(t[2])]}function u1(t){var e=t[0],n=t[1],r=es(n);return[r*es(e),r*ts(e),ts(n)]}function US(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function PI(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function cB(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function GS(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function bk(t){var e=G1(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}xA();function pie(t,e){function n(r,i){return r=t(r,i),e(r[0],r[1])}return t.invert&&e.invert&&(n.invert=function(r,i){return r=e.invert(r,i),r&&t.invert(r[0],r[1])}),n}function wk(t,e){return[t>Mi?t-Zd:t<-Mi?t+Zd:t,e]}wk.invert=wk;function BRe(t,e,n){return(t%=Zd)?e||n?pie(h7(t),d7(e,n)):h7(t):e||n?d7(e,n):wk}function f7(t){return function(e,n){return e+=t,[e>Mi?e-Zd:e<-Mi?e+Zd:e,n]}}function h7(t){var e=f7(t);return e.invert=f7(-t),e}function d7(t,e){var n=es(t),r=ts(t),i=es(e),o=ts(e);function a(s,u){var d=es(u),g=es(s)*d,_=ts(s)*d,E=ts(u),P=E*n+g*r;return[l1(_*i-P*o,g*n-E*r),K0(P*i+_*o)]}return a.invert=function(s,u){var d=es(u),g=es(s)*d,_=ts(s)*d,E=ts(u),P=E*i-_*o;return[l1(_*i+E*o,g*n+P*r),K0(P*n-g*r)]},a}function NRe(t,e,n,r,i,o){if(n){var a=es(e),s=ts(e),u=r*n;i==null?(i=e+r*Zd,o=e-u/2):(i=p7(a,i),o=p7(a,o),(r>0?i<o:i>o)&&(i+=r*Zd));for(var d,g=i;r>0?g>o:g<o;g-=u)d=xk([a,-s*es(g),-s*ts(g)]),t.point(d[0],d[1])}}function p7(t,e){e=u1(e),e[0]-=t,bk(e);var n=die(-e[1]);return((-e[2]<0?-n:n)+Zd-vo)%Zd}function gie(){var t=[],e;return{point:function(n,r){e.push([n,r])},lineStart:function(){t.push(e=[])},lineEnd:qb,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function FRe(t,e,n,r,i,o){var a=t[0],s=t[1],u=e[0],d=e[1],g=0,_=1,E=u-a,P=d-s,R;if(R=n-a,!(!E&&R>0)){if(R/=E,E<0){if(R<g)return;R<_&&(_=R)}else if(E>0){if(R>_)return;R>g&&(g=R)}if(R=i-a,!(!E&&R<0)){if(R/=E,E<0){if(R>_)return;R>g&&(g=R)}else if(E>0){if(R<g)return;R<_&&(_=R)}if(R=r-s,!(!P&&R>0)){if(R/=P,P<0){if(R<g)return;R<_&&(_=R)}else if(P>0){if(R>_)return;R>g&&(g=R)}if(R=o-s,!(!P&&R<0)){if(R/=P,P<0){if(R>_)return;R>g&&(g=R)}else if(P>0){if(R<g)return;R<_&&(_=R)}return g>0&&(t[0]=a+g*E,t[1]=s+g*P),_<1&&(e[0]=a+_*E,e[1]=s+_*P),!0}}}}}function xC(t,e){return Ca(t[0]-e[0])<vo&&Ca(t[1]-e[1])<vo}function jS(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function mie(t,e,n,r,i){var o=[],a=[],s,u;if(t.forEach(function(R){if(!((B=R.length-1)<=0)){var B,V=R[0],z=R[B],F;if(xC(V,z)){for(i.lineStart(),s=0;s<B;++s)i.point((V=R[s])[0],V[1]);i.lineEnd();return}o.push(F=new jS(V,R,null,!0)),a.push(F.o=new jS(V,null,F,!1)),o.push(F=new jS(z,R,null,!1)),a.push(F.o=new jS(z,null,F,!0))}}),!!o.length){for(a.sort(e),g7(o),g7(a),s=0,u=a.length;s<u;++s)a[s].e=n=!n;for(var d=o[0],g,_;;){for(var E=d,P=!0;E.v;)if((E=E.n)===d)return;g=E.z,i.lineStart();do{if(E.v=E.o.v=!0,E.e){if(P)for(s=0,u=g.length;s<u;++s)i.point((_=g[s])[0],_[1]);else r(E.x,E.n.x,1,i);E=E.n}else{if(P)for(g=E.p.z,s=g.length-1;s>=0;--s)i.point((_=g[s])[0],_[1]);else r(E.x,E.p.x,-1,i);E=E.p}E=E.o,g=E.z,P=!P}while(!E.v);i.lineEnd()}}}function g7(t){if(e=t.length){for(var e,n=0,r=t[0],i;++n<e;)r.n=i=t[n],i.p=r,r=i;r.n=i=t[0],i.p=r}}function Aie(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function kRe(t){return t.length===1&&(t=zRe(t)),{left:function(e,n,r,i){for(r==null&&(r=0),i==null&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(r==null&&(r=0),i==null&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}function zRe(t){return function(e,n){return Aie(t(e),n)}}kRe(Aie);function _ie(t){for(var e=t.length,n,r=-1,i=0,o,a;++r<e;)i+=t[r].length;for(o=new Array(i);--e>=0;)for(a=t[e],n=a.length;--n>=0;)o[--i]=a[n];return o}var Xb=1e9,VS=-Xb;function URe(t,e,n,r){function i(d,g){return t<=d&&d<=n&&e<=g&&g<=r}function o(d,g,_,E){var P=0,R=0;if(d==null||(P=a(d,_))!==(R=a(g,_))||u(d,g)<0^_>0)do E.point(P===0||P===3?t:n,P>1?r:e);while((P=(P+_+4)%4)!==R);else E.point(g[0],g[1])}function a(d,g){return Ca(d[0]-t)<vo?g>0?0:3:Ca(d[0]-n)<vo?g>0?2:1:Ca(d[1]-e)<vo?g>0?1:0:g>0?3:2}function s(d,g){return u(d.x,g.x)}function u(d,g){var _=a(d,1),E=a(g,1);return _!==E?_-E:_===0?g[1]-d[1]:_===1?d[0]-g[0]:_===2?d[1]-g[1]:g[0]-d[0]}return function(d){var g=d,_=gie(),E,P,R,B,V,z,F,k,X,Y,J,ie={point:ce,lineStart:me,lineEnd:Ce,polygonStart:ue,polygonEnd:se};function ce(Ye,tt){i(Ye,tt)&&g.point(Ye,tt)}function re(){for(var Ye=0,tt=0,pt=P.length;tt<pt;++tt)for(var Ee=P[tt],Ne=1,Be=Ee.length,qe=Ee[0],ct,Ct,Dt=qe[0],In=qe[1];Ne<Be;++Ne)ct=Dt,Ct=In,qe=Ee[Ne],Dt=qe[0],In=qe[1],Ct<=r?In>r&&(Dt-ct)*(r-Ct)>(In-Ct)*(t-ct)&&++Ye:In<=r&&(Dt-ct)*(r-Ct)<(In-Ct)*(t-ct)&&--Ye;return Ye}function ue(){g=_,E=[],P=[],J=!0}function se(){var Ye=re(),tt=J&&Ye,pt=(E=_ie(E)).length;(tt||pt)&&(d.polygonStart(),tt&&(d.lineStart(),o(null,null,1,d),d.lineEnd()),pt&&mie(E,s,Ye,o,d),d.polygonEnd()),g=d,E=P=R=null}function me(){ie.point=be,P&&P.push(R=[]),Y=!0,X=!1,F=k=NaN}function Ce(){E&&(be(B,V),z&&X&&_.rejoin(),E.push(_.result())),ie.point=ce,X&&g.lineEnd()}function be(Ye,tt){var pt=i(Ye,tt);if(P&&R.push([Ye,tt]),Y)B=Ye,V=tt,z=pt,Y=!1,pt&&(g.lineStart(),g.point(Ye,tt));else if(pt&&X)g.point(Ye,tt);else{var Ee=[F=Math.max(VS,Math.min(Xb,F)),k=Math.max(VS,Math.min(Xb,k))],Ne=[Ye=Math.max(VS,Math.min(Xb,Ye)),tt=Math.max(VS,Math.min(Xb,tt))];FRe(Ee,Ne,t,e,n,r)?(X||(g.lineStart(),g.point(Ee[0],Ee[1])),g.point(Ne[0],Ne[1]),pt||g.lineEnd(),J=!1):pt&&(g.lineStart(),g.point(Ye,tt),J=!1)}F=Ye,k=tt,X=pt}return ie}}var fB=xA();function GRe(t,e){var n=e[0],r=e[1],i=[ts(n),-es(n),0],o=0,a=0;fB.reset();for(var s=0,u=t.length;s<u;++s)if(g=(d=t[s]).length)for(var d,g,_=d[g-1],E=_[0],P=_[1]/2+a7,R=ts(P),B=es(P),V=0;V<g;++V,E=F,R=X,B=Y,_=z){var z=d[V],F=z[0],k=z[1]/2+a7,X=ts(k),Y=es(k),J=F-E,ie=J>=0?1:-1,ce=ie*J,re=ce>Mi,ue=R*X;if(fB.add(l1(ue*ie*ts(ce),B*Y+ue*es(ce))),o+=re?J+ie*Zd:J,re^E>=n^F>=n){var se=PI(u1(_),u1(z));bk(se);var me=PI(i,se);bk(me);var Ce=(re^J>=0?-1:1)*K0(me[2]);(r>Ce||r===Ce&&(se[0]||se[1]))&&(a+=re^J>=0?1:-1)}}return(o<-vo||o<vo&&fB<-vo)^a&1}xA();function m7(t){return t}xA();xA();var c1=1/0,II=c1,nE=-c1,MI=nE,A7={point:jRe,lineStart:qb,lineEnd:qb,polygonStart:qb,polygonEnd:qb,result:function(){var t=[[c1,II],[nE,MI]];return nE=MI=-(II=c1=1/0),t}};function jRe(t,e){t<c1&&(c1=t),t>nE&&(nE=t),e<II&&(II=e),e>MI&&(MI=e)}xA();function yie(t,e,n,r){return function(i,o){var a=e(o),s=i.invert(r[0],r[1]),u=gie(),d=e(u),g=!1,_,E,P,R={point:B,lineStart:z,lineEnd:F,polygonStart:function(){R.point=k,R.lineStart=X,R.lineEnd=Y,E=[],_=[]},polygonEnd:function(){R.point=B,R.lineStart=z,R.lineEnd=F,E=_ie(E);var J=GRe(_,s);E.length?(g||(o.polygonStart(),g=!0),mie(E,$Re,J,n,o)):J&&(g||(o.polygonStart(),g=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),g&&(o.polygonEnd(),g=!1),E=_=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function B(J,ie){var ce=i(J,ie);t(J=ce[0],ie=ce[1])&&o.point(J,ie)}function V(J,ie){var ce=i(J,ie);a.point(ce[0],ce[1])}function z(){R.point=V,a.lineStart()}function F(){R.point=B,a.lineEnd()}function k(J,ie){P.push([J,ie]);var ce=i(J,ie);d.point(ce[0],ce[1])}function X(){d.lineStart(),P=[]}function Y(){k(P[0][0],P[0][1]),d.lineEnd();var J=d.clean(),ie=u.result(),ce,re=ie.length,ue,se,me;if(P.pop(),_.push(P),P=null,!!re){if(J&1){if(se=ie[0],(ue=se.length-1)>0){for(g||(o.polygonStart(),g=!0),o.lineStart(),ce=0;ce<ue;++ce)o.point((me=se[ce])[0],me[1]);o.lineEnd()}return}re>1&&J&2&&ie.push(ie.pop().concat(ie.shift())),E.push(ie.filter(VRe))}}return R}}function VRe(t){return t.length>1}function $Re(t,e){return((t=t.x)[0]<0?t[1]-Ld-vo:Ld-t[1])-((e=e.x)[0]<0?e[1]-Ld-vo:Ld-e[1])}const _7=yie(function(){return!0},HRe,qRe,[-Mi,-Ld]);function HRe(t){var e=NaN,n=NaN,r=NaN,i;return{lineStart:function(){t.lineStart(),i=1},point:function(o,a){var s=o>0?Mi:-Mi,u=Ca(o-e);Ca(u-Mi)<vo?(t.point(e,n=(n+a)/2>0?Ld:-Ld),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(s,n),t.point(o,n),i=0):r!==s&&u>=Mi&&(Ca(e-r)<vo&&(e-=r*vo),Ca(o-s)<vo&&(o-=s*vo),n=WRe(e,n,o,a),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(s,n),i=0),t.point(e=o,n=a),r=s},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-i}}}function WRe(t,e,n,r){var i,o,a=ts(t-n);return Ca(a)>vo?LRe((ts(e)*(o=es(r))*ts(n)-ts(r)*(i=es(e))*ts(t))/(i*o*a)):(e+r)/2}function qRe(t,e,n,r){var i;if(t==null)i=n*Ld,r.point(-Mi,i),r.point(0,i),r.point(Mi,i),r.point(Mi,0),r.point(Mi,-i),r.point(0,-i),r.point(-Mi,-i),r.point(-Mi,0),r.point(-Mi,i);else if(Ca(t[0]-e[0])>vo){var o=t[0]<e[0]?Mi:-Mi;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(e[0],e[1])}function XRe(t,e){var n=es(t),r=n>0,i=Ca(n)>vo;function o(g,_,E,P){NRe(P,t,e,E,g,_)}function a(g,_){return es(g)*es(_)>n}function s(g){var _,E,P,R,B;return{lineStart:function(){R=P=!1,B=1},point:function(V,z){var F=[V,z],k,X=a(V,z),Y=r?X?0:d(V,z):X?d(V+(V<0?Mi:-Mi),z):0;if(!_&&(R=P=X)&&g.lineStart(),X!==P&&(k=u(_,F),(!k||xC(_,k)||xC(F,k))&&(F[0]+=vo,F[1]+=vo,X=a(F[0],F[1]))),X!==P)B=0,X?(g.lineStart(),k=u(F,_),g.point(k[0],k[1])):(k=u(_,F),g.point(k[0],k[1]),g.lineEnd()),_=k;else if(i&&_&&r^X){var J;!(Y&E)&&(J=u(F,_,!0))&&(B=0,r?(g.lineStart(),g.point(J[0][0],J[0][1]),g.point(J[1][0],J[1][1]),g.lineEnd()):(g.point(J[1][0],J[1][1]),g.lineEnd(),g.lineStart(),g.point(J[0][0],J[0][1])))}X&&(!_||!xC(_,F))&&g.point(F[0],F[1]),_=F,P=X,E=Y},lineEnd:function(){P&&g.lineEnd(),_=null},clean:function(){return B|(R&&P)<<1}}}function u(g,_,E){var P=u1(g),R=u1(_),B=[1,0,0],V=PI(P,R),z=US(V,V),F=V[0],k=z-F*F;if(!k)return!E&&g;var X=n*z/k,Y=-n*F/k,J=PI(B,V),ie=GS(B,X),ce=GS(V,Y);cB(ie,ce);var re=J,ue=US(ie,re),se=US(re,re),me=ue*ue-se*(US(ie,ie)-1);if(!(me<0)){var Ce=G1(me),be=GS(re,(-ue-Ce)/se);if(cB(be,ie),be=xk(be),!E)return be;var Ye=g[0],tt=_[0],pt=g[1],Ee=_[1],Ne;tt<Ye&&(Ne=Ye,Ye=tt,tt=Ne);var Be=tt-Ye,qe=Ca(Be-Mi)<vo,ct=qe||Be<vo;if(!qe&&Ee<pt&&(Ne=pt,pt=Ee,Ee=Ne),ct?qe?pt+Ee>0^be[1]<(Ca(be[0]-Ye)<vo?pt:Ee):pt<=be[1]&&be[1]<=Ee:Be>Mi^(Ye<=be[0]&&be[0]<=tt)){var Ct=GS(re,(-ue+Ce)/se);return cB(Ct,ie),[be,xk(Ct)]}}}function d(g,_){var E=r?t:Mi-t,P=0;return g<-E?P|=1:g>E&&(P|=2),_<-E?P|=4:_>E&&(P|=8),P}return yie(a,s,o,r?[0,-t]:[-Mi,t-Mi])}function vie(t){return function(e){var n=new Ek;for(var r in t)n[r]=t[r];return n.stream=e,n}}function Ek(){}Ek.prototype={constructor:Ek,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function xie(t,e,n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),o!=null&&t.clipExtent(null),DRe(n,t.stream(A7));var a=A7.result(),s=Math.min(r/(a[1][0]-a[0][0]),i/(a[1][1]-a[0][1])),u=+e[0][0]+(r-s*(a[1][0]+a[0][0]))/2,d=+e[0][1]+(i-s*(a[1][1]+a[0][1]))/2;return o!=null&&t.clipExtent(o),t.scale(s*150).translate([u,d])}function ZRe(t,e,n){return xie(t,[[0,0],e],n)}var y7=16,YRe=es(30*ef);function v7(t,e){return+e?KRe(t,e):QRe(t)}function QRe(t){return vie({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function KRe(t,e){function n(r,i,o,a,s,u,d,g,_,E,P,R,B,V){var z=d-r,F=g-i,k=z*z+F*F;if(k>4*e&&B--){var X=a+E,Y=s+P,J=u+R,ie=G1(X*X+Y*Y+J*J),ce=K0(J/=ie),re=Ca(Ca(J)-1)<vo||Ca(o-_)<vo?(o+_)/2:l1(Y,X),ue=t(re,ce),se=ue[0],me=ue[1],Ce=se-r,be=me-i,Ye=F*Ce-z*be;(Ye*Ye/k>e||Ca((z*Ce+F*be)/k-.5)>.3||a*E+s*P+u*R<YRe)&&(n(r,i,o,a,s,u,se,me,re,X/=ie,Y/=ie,J,B,V),V.point(se,me),n(se,me,re,X,Y,J,d,g,_,E,P,R,B,V))}}return function(r){var i,o,a,s,u,d,g,_,E,P,R,B,V={point:z,lineStart:F,lineEnd:X,polygonStart:function(){r.polygonStart(),V.lineStart=Y},polygonEnd:function(){r.polygonEnd(),V.lineStart=F}};function z(ce,re){ce=t(ce,re),r.point(ce[0],ce[1])}function F(){_=NaN,V.point=k,r.lineStart()}function k(ce,re){var ue=u1([ce,re]),se=t(ce,re);n(_,E,g,P,R,B,_=se[0],E=se[1],g=ce,P=ue[0],R=ue[1],B=ue[2],y7,r),r.point(_,E)}function X(){V.point=z,r.lineEnd()}function Y(){F(),V.point=J,V.lineEnd=ie}function J(ce,re){k(i=ce,re),o=_,a=E,s=P,u=R,d=B,V.point=k}function ie(){n(_,E,g,P,R,B,o,a,i,s,u,d,y7,r),V.lineEnd=X,X()}return V}}var JRe=vie({point:function(t,e){this.stream.point(t*ef,e*ef)}});function eLe(t){return tLe(function(){return t})()}function tLe(t){var e,n=150,r=480,i=250,o,a,s=0,u=0,d=0,g=0,_=0,E,P,R=null,B=_7,V=null,z,F,k,X=m7,Y=.5,J=v7(se,Y),ie,ce;function re(be){return be=P(be[0]*ef,be[1]*ef),[be[0]*n+o,a-be[1]*n]}function ue(be){return be=P.invert((be[0]-o)/n,(a-be[1])/n),be&&[be[0]*pm,be[1]*pm]}function se(be,Ye){return be=e(be,Ye),[be[0]*n+o,a-be[1]*n]}re.stream=function(be){return ie&&ce===be?ie:ie=JRe(B(E,J(X(ce=be))))},re.clipAngle=function(be){return arguments.length?(B=+be?XRe(R=be*ef,6*ef):(R=null,_7),Ce()):R*pm},re.clipExtent=function(be){return arguments.length?(X=be==null?(V=z=F=k=null,m7):URe(V=+be[0][0],z=+be[0][1],F=+be[1][0],k=+be[1][1]),Ce()):V==null?null:[[V,z],[F,k]]},re.scale=function(be){return arguments.length?(n=+be,me()):n},re.translate=function(be){return arguments.length?(r=+be[0],i=+be[1],me()):[r,i]},re.center=function(be){return arguments.length?(s=be[0]%360*ef,u=be[1]%360*ef,me()):[s*pm,u*pm]},re.rotate=function(be){return arguments.length?(d=be[0]%360*ef,g=be[1]%360*ef,_=be.length>2?be[2]%360*ef:0,me()):[d*pm,g*pm,_*pm]},re.precision=function(be){return arguments.length?(J=v7(se,Y=be*be),Ce()):G1(Y)},re.fitExtent=function(be,Ye){return xie(re,be,Ye)},re.fitSize=function(be,Ye){return ZRe(re,be,Ye)};function me(){P=pie(E=BRe(d,g,_),e);var be=e(s,u);return o=r-be[0]*n,a=i+be[1]*n,Ce()}function Ce(){return ie=ce=null,re}return function(){return e=t.apply(this,arguments),re.invert=e.invert&&ue,me()}}function bie(t){return function(e,n){var r=es(e),i=es(n),o=t(r*i);return[o*i*ts(e),o*ts(n)]}}function wie(t){return function(e,n){var r=G1(e*e+n*n),i=t(r),o=ts(i),a=es(i);return[l1(e*o,r*a),K0(r&&n*o/r)]}}var nLe=bie(function(t){return G1(2/(1+t))});nLe.invert=wie(function(t){return 2*K0(t/2)});var Eie=bie(function(t){return(t=die(t))&&t/ts(t)});Eie.invert=wie(function(t){return t});function rLe(){return eLe(Eie).scale(79.4188).clipAngle(180-.001)}function x7(t,e){return[t,e]}x7.invert=x7;function M6(t,e,n){n=n||{};var r=n.units||"kilometers",i=n.steps||8;if(!t)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof i!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");var o=[];switch(t.type){case"GeometryCollection":return VE(t,function(a){var s=bC(a,e,r,i);s&&o.push(s)}),vf(o);case"FeatureCollection":return k0(t,function(a){var s=bC(a,e,r,i);s&&k0(s,function(u){u&&o.push(u)})}),vf(o)}return bC(t,e,r,i)}function bC(t,e,n,r){var i=t.properties||{},o=t.type==="Feature"?t.geometry:t;if(o.type==="GeometryCollection"){var a=[];return VE(t,function(B){var V=bC(B,e,n,r);V&&a.push(V)}),vf(a)}var s=iLe(o),u={type:o.type,coordinates:Tie(o.coordinates,s)},d=new x6,g=d.read(u),_=XO(GE(e,n),"meters"),E=$s.bufferOp(g,_,r),P=new Zre;if(E=P.write(E),!Sie(E.coordinates)){var R={type:E.type,coordinates:Cie(E.coordinates,s)};return Kl(R,i)}}function Sie(t){return Array.isArray(t[0])?Sie(t[0]):isNaN(t[0])}function Tie(t,e){return typeof t[0]!="object"?e(t):t.map(function(n){return Tie(n,e)})}function Cie(t,e){return typeof t[0]!="object"?e.invert(t):t.map(function(n){return Cie(n,e)})}function iLe(t){var e=tR(t).geometry.coordinates,n=[-e[0],-e[1]];return rLe().rotate(n).scale(na)}const oLe=Object.freeze(Object.defineProperty({__proto__:null,default:M6},Symbol.toStringTag,{value:"Module"})),Pie=ti(oLe),O6=ti(lMe);Object.defineProperty(sR,"__esModule",{value:!0});sR.SplitPolygonMode=void 0;var sLe=Cg(gRe),aLe=Cg(K5),lLe=Cg(Pie),uLe=Cg(O6),cLe=rl,fLe=Cg(Kd),b7=Cg(Lc),hLe=Cg(YO),dLe=Cg(d6),w7=Cg(Ore),pLe=Ai,gLe=So,mLe=Rc;function Cg(t){return t&&t.__esModule?t:{default:t}}function wC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?wC=function(n){return typeof n}:wC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},wC(t)}function ALe(t){return vLe(t)||yLe(t)||Iie(t)||_Le()}function _Le(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yLe(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function vLe(t){if(Array.isArray(t))return Sk(t)}function xLe(t,e){return ELe(t)||wLe(t,e)||Iie(t,e)||bLe()}function bLe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Iie(t,e){if(t){if(typeof t=="string")return Sk(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Sk(t,e)}}function Sk(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function wLe(t,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var n=[],r=!0,i=!1,o=void 0;try{for(var a=t[Symbol.iterator](),s;!(r=(s=a.next()).done)&&(n.push(s.value),!(e&&n.length===e));r=!0);}catch(u){i=!0,o=u}finally{try{!r&&a.return!=null&&a.return()}finally{if(i)throw o}}return n}}function ELe(t){if(Array.isArray(t))return t}function SLe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function TLe(t,e,n){return e&&E7(t.prototype,e),n&&E7(t,n),t}function CLe(t){return function(){var e=OI(t),n;if(MLe()){var r=OI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return PLe(this,n)}}function PLe(t,e){return e&&(wC(e)==="object"||typeof e=="function")?e:ILe(t)}function ILe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function MLe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function OI(t){return OI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},OI(t)}function OLe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Tk(t,e)}function Tk(t,e){return Tk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Tk(t,e)}var RLe=function(t){OLe(n,t);var e=CLe(n);function n(){return SLe(this,n),e.apply(this,arguments)}return TLe(n,[{key:"calculateMapCoords",value:function(i,o,a){var s=a.modeConfig;if(!s||!s.lock90Degree||!i.length)return o;if(i.length===1){var u=i[0],d=this.getSelectedGeometry(a),g=(0,dLe.default)(d),_=g.type==="FeatureCollection"?g.features:[g],E=Number.MAX_SAFE_INTEGER,P=null;if(_.forEach(function(Y){var J=(0,w7.default)(Y,u),ie=(0,b7.default)(J,u);E>ie&&(E=ie,P=J)}),P){var R=(0,fLe.default)(u,P),B=(0,b7.default)(u,o,{units:"meters"});return(0,hLe.default)(u,B,R,{units:"meters"}).geometry.coordinates}return o}var V=i[i.length-1],z=(0,pLe.generatePointsParallelToLinePoints)(i[i.length-2],V,o),F=xLe(z,1),k=F[0],X=(0,w7.default)((0,cLe.lineString)([V,k]),o).geometry.coordinates;return X}},{key:"getGuides",value:function(i){var o=this.getClickSequence(),a={type:"FeatureCollection",features:[]};if(o.length===0||!i.lastPointerMoveEvent)return a;var s=i.lastPointerMoveEvent.mapCoords;return a.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[].concat(ALe(o),[this.calculateMapCoords(o,s,i)])}}),a}},{key:"handleClick",value:function(i,o){var a=this.getTentativeGuide(o),s=this.getSelectedGeometry(o);if(!s){console.warn("A polygon must be selected for splitting");return}var u=this.getClickSequence();a&&a.geometry.type==="LineString"?u.push(a.geometry.coordinates[a.geometry.coordinates.length-1]):this.addClickSequence(i);var d={type:"Point",coordinates:u[u.length-1]},g=(0,sLe.default)(d,s);if(u.length>1&&a&&!g){this.resetClickSequence();var _=(0,uLe.default)(a,s);if(_.features.length===0)return;var E=this.splitPolygon(a,o);E&&o.onEdit(E)}}},{key:"handlePointerMove",value:function(i,o){o.onUpdateCursor("cell")}},{key:"splitPolygon",value:function(i,o){var a=this.getSelectedGeometry(o),s=o.selectedIndexes[0],u=o.modeConfig||{},d=u.gap,g=d===void 0?.1:d,_=u.units,E=_===void 0?"centimeters":_;g===0&&(g=.1,E="centimeters");var P=(0,lLe.default)(i,g,{units:E}),R=(0,aLe.default)(a,P);if(!R)return console.warn("Canceling edit. Split Polygon erased"),null;var B=R.geometry,V=B.type,z=B.coordinates,F=[];V==="Polygon"?F=z.map(function(Y){return[Y]}):F=z.reduce(function(Y,J){return J.forEach(function(ie){Y.push([ie])}),Y},[]);var k=new mLe.ImmutableFeatureCollection(o.data).replaceGeometry(s,{type:"MultiPolygon",coordinates:F}),X={updatedData:k.getObject(),editType:"split",editContext:{featureIndexes:[s]}};return X}}]),n}(gLe.GeoJsonEditMode);sR.SplitPolygonMode=RLe;var yR={};Object.defineProperty(yR,"__esModule",{value:!0});yR.ExtrudeMode=void 0;var LLe=BLe(Kd),Ab=Ai,DLe=B1,hB=Rc;function BLe(t){return t&&t.__esModule?t:{default:t}}function EC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?EC=function(n){return typeof n}:EC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},EC(t)}function S7(t){return kLe(t)||FLe(t)||Mie(t)||NLe()}function NLe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FLe(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function kLe(t){if(Array.isArray(t))return Ck(t)}function by(t,e){return GLe(t)||ULe(t,e)||Mie(t,e)||zLe()}function zLe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mie(t,e){if(t){if(typeof t=="string")return Ck(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ck(t,e)}}function Ck(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ULe(t,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var n=[],r=!0,i=!1,o=void 0;try{for(var a=t[Symbol.iterator](),s;!(r=(s=a.next()).done)&&(n.push(s.value),!(e&&n.length===e));r=!0);}catch(u){i=!0,o=u}finally{try{!r&&a.return!=null&&a.return()}finally{if(i)throw o}}return n}}function GLe(t){if(Array.isArray(t))return t}function jLe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function VLe(t,e,n){return e&&T7(t.prototype,e),n&&T7(t,n),t}function $Le(t){return function(){var e=RI(t),n;if(WLe()){var r=RI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return HLe(this,n)}}function HLe(t,e){return e&&(EC(e)==="object"||typeof e=="function")?e:Oie(t)}function Oie(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function WLe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function RI(t){return RI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},RI(t)}function qLe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pk(t,e)}function Pk(t,e){return Pk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Pk(t,e)}function XLe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ZLe=function(t){qLe(n,t);var e=$Le(n);function n(){var r;jLe(this,n);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r=e.call.apply(e,[this].concat(o)),XLe(Oie(r),"isPointAdded",!1),r}return VLe(n,[{key:"handleDragging",value:function(i,o){var a=(0,Ab.getPickedEditHandle)(i.pointerDownPicks);if(a){var s=a.properties.featureIndex,u=a.properties.positionIndexes,d=this.coordinatesSize(u,s,o.data);u=this.isPointAdded?this.nextPositionIndexes(u,d):u;var g=this.getPointForPositionIndexes(this.prevPositionIndexes(u,d),s,o.data),_=this.getPointForPositionIndexes(u,s,o.data);if(g&&_){var E=(0,Ab.generatePointsParallelToLinePoints)(g,_,i.mapCoords),P=by(E,2),R=P[0],B=P[1],V=new hB.ImmutableFeatureCollection(o.data).replacePosition(s,this.prevPositionIndexes(u,d),B).replacePosition(s,u,R).getObject();o.onEdit({updatedData:V,editType:"extruding",editContext:{featureIndexes:[s],positionIndexes:this.nextPositionIndexes(u,d),position:R}}),i.cancelPan()}}}},{key:"handleStartDragging",value:function(i,o){var a=o.selectedIndexes,s=(0,Ab.getPickedIntermediateEditHandle)(i.picks);if(a.length&&s){var u=s.properties,d=u.positionIndexes,g=u.featureIndex,_=this.coordinatesSize(d,g,o.data),E=this.getPointForPositionIndexes(this.prevPositionIndexes(d,_),g,o.data),P=this.getPointForPositionIndexes(d,g,o.data);if(E&&P){var R=new hB.ImmutableFeatureCollection(o.data);this.isOrthogonal(d,g,_,o.data)||(R=R.addPosition(g,d,P)),this.isOrthogonal(this.prevPositionIndexes(d,_),g,_,o.data)||(R=R.addPosition(g,d,E),this.isPointAdded=!0),o.onEdit({updatedData:R.getObject(),editType:"startExtruding",editContext:{featureIndexes:[g],positionIndexes:d,position:E}})}}}},{key:"handleStopDragging",value:function(i,o){var a=o.selectedIndexes,s=(0,Ab.getPickedEditHandle)(i.pointerDownPicks);if(a.length&&s){var u=s.properties.featureIndex,d=s.properties.positionIndexes,g=this.coordinatesSize(d,u,o.data);d=this.isPointAdded?this.nextPositionIndexes(d,g):d;var _=this.getPointForPositionIndexes(this.prevPositionIndexes(d,g),u,o.data),E=this.getPointForPositionIndexes(d,u,o.data);if(_&&E){var P=(0,Ab.generatePointsParallelToLinePoints)(_,E,i.mapCoords),R=by(P,2),B=R[0],V=R[1],z=new hB.ImmutableFeatureCollection(o.data).replacePosition(u,this.prevPositionIndexes(d,g),V).replacePosition(u,d,B).getObject();o.onEdit({updatedData:z,editType:"extruded",editContext:{featureIndexes:[u],positionIndexes:d,position:B}})}}this.isPointAdded=!1}},{key:"coordinatesSize",value:function(i,o,a){var s=a.features,u=0;if(Array.isArray(i)){var d=s[o],g=d.geometry.coordinates;if(i.length===3){var _=by(i,2),E=_[0],P=_[1];g.length&&g[E].length&&(u=g[E][P].length)}else{var R=by(i,1),B=R[0];g.length&&g[B].length&&(u=g[B].length)}}return u}},{key:"getBearing",value:function(i,o){var a=(0,LLe.default)(i,o);return a<0?Math.floor(360+a):Math.floor(a)}},{key:"isOrthogonal",value:function(i,o,a,s){if(!Array.isArray(i))return!1;i[i.length-1]===a-1&&(i[i.length-1]=0);var u=this.getPointForPositionIndexes(this.prevPositionIndexes(i,a),o,s),d=this.getPointForPositionIndexes(this.nextPositionIndexes(i,a),o,s),g=this.getPointForPositionIndexes(i,o,s),_=this.getBearing(g,u),E=this.getBearing(g,d);return[89,90,91,269,270,271].includes(Math.abs(_-E))}},{key:"nextPositionIndexes",value:function(i,o){if(!Array.isArray(i))return[];var a=S7(i);return a.length&&(a[a.length-1]=a[a.length-1]===o-1?0:a[a.length-1]+1),a}},{key:"prevPositionIndexes",value:function(i,o){if(!Array.isArray(i))return[];var a=S7(i);return a.length&&(a[a.length-1]=a[a.length-1]===0?o-2:a[a.length-1]-1),a}},{key:"getPointForPositionIndexes",value:function(i,o,a){var s=a.features,u;if(Array.isArray(i)){var d=s[o],g=d.geometry.coordinates;if(i.length===3){var _=by(i,3),E=_[0],P=_[1],R=_[2];g.length&&g[E].length&&(u=g[E][P][R])}else{var B=by(i,2),V=B[0],z=B[1];g.length&&g[V].length&&(u=g[V][z])}}return u}}]),n}(DLe.ModifyMode);yR.ExtrudeMode=ZLe;var vR={};Object.defineProperty(vR,"__esModule",{value:!0});vR.ElevationMode=void 0;var C7=Ai,YLe=B1;function SC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?SC=function(n){return typeof n}:SC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},SC(t)}function QLe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function KLe(t,e,n){return e&&P7(t.prototype,e),n&&P7(t,n),t}function _v(t,e,n){return typeof Reflect<"u"&&Reflect.get?_v=Reflect.get:_v=function(i,o,a){var s=JLe(i,o);if(s){var u=Object.getOwnPropertyDescriptor(s,o);return u.get?u.get.call(a):u.value}},_v(t,e,n||t)}function JLe(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=$m(t),t!==null););return t}function e3e(t){return function(){var e=$m(t),n;if(r3e()){var r=$m(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return t3e(this,n)}}function t3e(t,e){return e&&(SC(e)==="object"||typeof e=="function")?e:n3e(t)}function n3e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function r3e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function $m(t){return $m=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},$m(t)}function i3e(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ik(t,e)}function Ik(t,e){return Ik=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Ik(t,e)}function o3e(t){var e=t.pointerDownScreenCoords,n=t.screenCoords;return 10*(e[1]-n[1])}var s3e=function(t){i3e(n,t);var e=e3e(n);function n(){return QLe(this,n),e.apply(this,arguments)}return KLe(n,[{key:"makeElevatedEvent",value:function(i,o,a){var s=a.modeConfig||{},u=s.minElevation,d=u===void 0?0:u,g=s.maxElevation,_=g===void 0?2e4:g,E=s.calculateElevationChange,P=E===void 0?o3e:E;if(!i.pointerDownScreenCoords)return i;var R=o.length===3?o[2]:0;return R+=P({pointerDownScreenCoords:i.pointerDownScreenCoords,screenCoords:i.screenCoords}),R=Math.min(R,_),R=Math.max(R,d),Object.assign({},i,{mapCoords:[o[0],o[1],R]})}},{key:"handlePointerMove",value:function(i,o){var a=(0,C7.getPickedEditHandle)(i.pointerDownPicks),s=a?a.geometry.coordinates:i.mapCoords;_v($m(n.prototype),"handlePointerMove",this).call(this,this.makeElevatedEvent(i,s,o),o)}},{key:"handleStopDragging",value:function(i,o){var a=(0,C7.getPickedEditHandle)(i.picks),s=a?a.geometry.coordinates:i.mapCoords;_v($m(n.prototype),"handleStopDragging",this).call(this,this.makeElevatedEvent(i,s,o),o)}},{key:"getCursor",value:function(i){var o=_v($m(n.prototype),"getCursor",this).call(this,i);return o==="cell"&&(o="ns-resize"),o}}],[{key:"calculateElevationChangeWithViewport",value:function(i,o){var a=o.pointerDownScreenCoords,s=o.screenCoords,u=156543.03392*Math.cos(i.latitude*Math.PI/180)/Math.pow(2,i.zoom);return u*(a[1]-s[1])/2}}]),n}(YLe.ModifyMode);vR.ElevationMode=s3e;var xR={},t2={};Object.defineProperty(t2,"__esModule",{value:!0});t2.CompositeMode=void 0;var a3e=So;function TC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?TC=function(n){return typeof n}:TC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},TC(t)}function l3e(t){return f3e(t)||c3e(t)||Rie(t)||u3e()}function u3e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function c3e(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function f3e(t){if(Array.isArray(t))return Mk(t)}function h3e(t){if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(t=Rie(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,i=!0,o=!1,a;return{s:function(){r=t[Symbol.iterator]()},n:function(){var u=r.next();return i=u.done,u},e:function(u){o=!0,a=u},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw a}}}}function Rie(t,e){if(t){if(typeof t=="string")return Mk(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mk(t,e)}}function Mk(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function d3e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function p3e(t,e,n){return e&&I7(t.prototype,e),n&&I7(t,n),t}function g3e(t){return function(){var e=LI(t),n;if(A3e()){var r=LI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return m3e(this,n)}}function m3e(t,e){return e&&(TC(e)==="object"||typeof e=="function")?e:Lie(t)}function Lie(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function A3e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function LI(t){return LI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},LI(t)}function _3e(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ok(t,e)}function Ok(t,e){return Ok=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Ok(t,e)}function y3e(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var v3e=function(t){_3e(n,t);var e=g3e(n);function n(r){var i;return d3e(this,n),i=e.call(this),y3e(Lie(i),"_modes",void 0),i._modes=r,i}return p3e(n,[{key:"_coalesce",value:function(i){for(var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a,s=0;s<this._modes.length&&(a=i(this._modes[s]),!(o?o(a):a));s++);return a}},{key:"handleClick",value:function(i,o){this._coalesce(function(a){return a.handleClick(i,o)})}},{key:"handlePointerMove",value:function(i,o){return this._coalesce(function(a){return a.handlePointerMove(i,o)})}},{key:"handleStartDragging",value:function(i,o){return this._coalesce(function(a){return a.handleStartDragging(i,o)})}},{key:"handleStopDragging",value:function(i,o){return this._coalesce(function(a){return a.handleStopDragging(i,o)})}},{key:"handleDragging",value:function(i,o){return this._coalesce(function(a){return a.handleDragging(i,o)})}},{key:"getGuides",value:function(i){var o=[],a=h3e(this._modes),s;try{for(a.s();!(s=a.n()).done;){var u=s.value;o.push.apply(o,l3e(u.getGuides(i).features))}}catch(d){a.e(d)}finally{a.f()}return{type:"FeatureCollection",features:o}}}]),n}(a3e.GeoJsonEditMode);t2.CompositeMode=v3e;Object.defineProperty(xR,"__esModule",{value:!0});xR.TransformMode=void 0;var x3e=rl,M7=N1,dB=WE,pB=qE,b3e=t2;function CC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?CC=function(n){return typeof n}:CC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},CC(t)}function O7(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function w3e(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?O7(Object(n),!0).forEach(function(r){E3e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O7(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function E3e(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function S3e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function R7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function T3e(t,e,n){return e&&R7(t.prototype,e),n&&R7(t,n),t}function hw(t,e,n){return typeof Reflect<"u"&&Reflect.get?hw=Reflect.get:hw=function(i,o,a){var s=C3e(i,o);if(s){var u=Object.getOwnPropertyDescriptor(s,o);return u.get?u.get.call(a):u.value}},hw(t,e,n||t)}function C3e(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=J0(t),t!==null););return t}function P3e(t){return function(){var e=J0(t),n;if(O3e()){var r=J0(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return I3e(this,n)}}function I3e(t,e){return e&&(CC(e)==="object"||typeof e=="function")?e:M3e(t)}function M3e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function O3e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function J0(t){return J0=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},J0(t)}function R3e(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rk(t,e)}function Rk(t,e){return Rk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Rk(t,e)}var L3e=function(t){R3e(n,t);var e=P3e(n);function n(){return S3e(this,n),e.call(this,[new M7.TranslateMode,new dB.ScaleMode,new pB.RotateMode])}return T3e(n,[{key:"handlePointerMove",value:function(i,o){var a=null;hw(J0(n.prototype),"handlePointerMove",this).call(this,i,w3e({},o,{onUpdateCursor:function(u){a=u||a}})),o.onUpdateCursor(a)}},{key:"handleStartDragging",value:function(i,o){var a=null,s=null,u=[];this._modes.forEach(function(d){d instanceof M7.TranslateMode?s=d:(d instanceof dB.ScaleMode&&(a=d),u.push(d))}),a instanceof dB.ScaleMode&&!a.isEditHandleSelected()&&u.push(s),u.filter(Boolean).forEach(function(d){return d.handleStartDragging(i,o)})}},{key:"getGuides",value:function(i){var o=hw(J0(n.prototype),"getGuides",this).call(this,i),a=(this._modes||[]).find(function(u){return u instanceof pB.RotateMode});if(a instanceof pB.RotateMode){var s=o.features.filter(function(u){var d=u.properties||{},g=d.editHandleType,_=d.mode,E=[_];return a.getIsRotating()&&E.push(g),!E.includes("scale")});o=(0,x3e.featureCollection)(s)}return o}}]),n}(b3e.CompositeMode);xR.TransformMode=L3e;var bR={};Object.defineProperty(bR,"__esModule",{value:!0});bR.DrawPointMode=void 0;var D3e=So;function PC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?PC=function(n){return typeof n}:PC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},PC(t)}function B3e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function L7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function N3e(t,e,n){return e&&L7(t.prototype,e),n&&L7(t,n),t}function IC(t,e,n){return typeof Reflect<"u"&&Reflect.get?IC=Reflect.get:IC=function(i,o,a){var s=F3e(i,o);if(s){var u=Object.getOwnPropertyDescriptor(s,o);return u.get?u.get.call(a):u.value}},IC(t,e,n||t)}function F3e(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=f1(t),t!==null););return t}function k3e(t){return function(){var e=f1(t),n;if(G3e()){var r=f1(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return z3e(this,n)}}function z3e(t,e){return e&&(PC(e)==="object"||typeof e=="function")?e:U3e(t)}function U3e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function G3e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function f1(t){return f1=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},f1(t)}function j3e(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Lk(t,e)}function Lk(t,e){return Lk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Lk(t,e)}var V3e=function(t){j3e(n,t);var e=k3e(n);function n(){return B3e(this,n),e.apply(this,arguments)}return N3e(n,[{key:"createTentativeFeature",value:function(i){var o=i.lastPointerMoveEvent,a=o?[o.mapCoords]:[];return{type:"Feature",properties:{guideType:"tentative"},geometry:{type:"Point",coordinates:a[0]}}}},{key:"handleClick",value:function(i,o){var a=i.mapCoords,s={type:"Point",coordinates:a};o.onEdit(this.getAddFeatureAction(s,o.data))}},{key:"handlePointerMove",value:function(i,o){o.onUpdateCursor("cell"),IC(f1(n.prototype),"handlePointerMove",this).call(this,i,o)}}]),n}(D3e.GeoJsonEditMode);bR.DrawPointMode=V3e;var wR={};Object.defineProperty(wR,"__esModule",{value:!0});wR.DrawLineStringMode=void 0;var $3e=Ai,H3e=So;function MC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?MC=function(n){return typeof n}:MC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},MC(t)}function $S(t){return Z3e(t)||X3e(t)||q3e(t)||W3e()}function W3e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function q3e(t,e){if(t){if(typeof t=="string")return Dk(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dk(t,e)}}function X3e(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function Z3e(t){if(Array.isArray(t))return Dk(t)}function Dk(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Y3e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function D7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Q3e(t,e,n){return e&&D7(t.prototype,e),n&&D7(t,n),t}function K3e(t){return function(){var e=DI(t),n;if(tDe()){var r=DI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return J3e(this,n)}}function J3e(t,e){return e&&(MC(e)==="object"||typeof e=="function")?e:eDe(t)}function eDe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tDe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function DI(t){return DI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},DI(t)}function nDe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bk(t,e)}function Bk(t,e){return Bk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Bk(t,e)}var rDe=function(t){nDe(n,t);var e=K3e(n);function n(){return Y3e(this,n),e.apply(this,arguments)}return Q3e(n,[{key:"handleClick",value:function(i,o){var a=i.picks,s=(0,$3e.getPickedEditHandle)(a),u=!1;s||(this.addClickSequence(i),u=!0);var d=this.getClickSequence();if(d.length>1&&s&&Array.isArray(s.properties.positionIndexes)&&s.properties.positionIndexes[0]===d.length-1){var g={type:"LineString",coordinates:$S(d)};this.resetClickSequence();var _=this.getAddFeatureAction(g,o.data);_&&o.onEdit(_)}else u&&o.onEdit({updatedData:o.data,editType:"addTentativePosition",editContext:{position:i.mapCoords}})}},{key:"handleKeyUp",value:function(i,o){var a=i.key;if(a==="Enter"){var s=this.getClickSequence();if(s.length>1){var u={type:"LineString",coordinates:$S(s)};this.resetClickSequence();var d=this.getAddFeatureAction(u,o.data);d&&o.onEdit(d)}}}},{key:"getGuides",value:function(i){var o,a=i.lastPointerMoveEvent,s=this.getClickSequence(),u=a?[a.mapCoords]:[],d={type:"FeatureCollection",features:[]},g;s.length>0&&(g={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[].concat($S(s),u)}}),g&&d.features.push(g);var _=s.map(function(E,P){return{type:"Feature",properties:{guideType:"editHandle",editHandleType:"existing",featureIndex:-1,positionIndexes:[P]},geometry:{type:"Point",coordinates:E}}});return(o=d.features).push.apply(o,$S(_)),d}},{key:"handlePointerMove",value:function(i,o){o.onUpdateCursor("cell")}}]),n}(H3e.GeoJsonEditMode);wR.DrawLineStringMode=rDe;var j1={};Object.defineProperty(j1,"__esModule",{value:!0});j1.DrawPolygonMode=void 0;var iDe=aDe(O6),B7=rl,oDe=Ai,sDe=So;function aDe(t){return t&&t.__esModule?t:{default:t}}function OC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?OC=function(n){return typeof n}:OC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},OC(t)}function wy(t){return fDe(t)||cDe(t)||uDe(t)||lDe()}function lDe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uDe(t,e){if(t){if(typeof t=="string")return Nk(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nk(t,e)}}function cDe(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function fDe(t){if(Array.isArray(t))return Nk(t)}function Nk(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function hDe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function N7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function dDe(t,e,n){return e&&N7(t.prototype,e),n&&N7(t,n),t}function RC(t,e,n){return typeof Reflect<"u"&&Reflect.get?RC=Reflect.get:RC=function(i,o,a){var s=pDe(i,o);if(s){var u=Object.getOwnPropertyDescriptor(s,o);return u.get?u.get.call(a):u.value}},RC(t,e,n||t)}function pDe(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=h1(t),t!==null););return t}function gDe(t){return function(){var e=h1(t),n;if(_De()){var r=h1(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return mDe(this,n)}}function mDe(t,e){return e&&(OC(e)==="object"||typeof e=="function")?e:ADe(t)}function ADe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _De(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function h1(t){return h1=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},h1(t)}function yDe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Fk(t,e)}function Fk(t,e){return Fk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Fk(t,e)}var vDe=function(t){yDe(n,t);var e=gDe(n);function n(){return hDe(this,n),e.apply(this,arguments)}return dDe(n,[{key:"createTentativeFeature",value:function(i){var o=i.lastPointerMoveEvent,a=this.getClickSequence(),s=o?[o.mapCoords]:[],u;return a.length===1||a.length===2?u={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[].concat(wy(a),s)}}:a.length>2&&(u={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"Polygon",coordinates:[[].concat(wy(a),s,[a[0]])]}}),u}},{key:"getGuides",value:function(i){var o,a=this.getClickSequence(),s={type:"FeatureCollection",features:[]},u=this.createTentativeFeature(i);u&&s.features.push(u);var d=a.map(function(g,_){return{type:"Feature",properties:{guideType:"editHandle",editHandleType:"existing",featureIndex:-1,positionIndexes:[_]},geometry:{type:"Point",coordinates:g}}});return(o=s.features).push.apply(o,wy(d)),s}},{key:"handleClick",value:function(i,o){var a=i.picks,s=(0,oDe.getPickedEditHandle)(a),u=this.getClickSequence(),d=!1;if(u.length>2&&o.modeConfig&&o.modeConfig.preventOverlappingLines){var g=(0,B7.lineString)([u[u.length-1],i.mapCoords]),_=(0,B7.lineString)(wy(u.slice(0,u.length-1))),E=(0,iDe.default)(g,_);E.features.length>0&&(d=!0)}var P=!1;if(!s&&!d&&(this.addClickSequence(i),P=!0),u.length>2&&s&&Array.isArray(s.properties.positionIndexes)&&(s.properties.positionIndexes[0]===0||s.properties.positionIndexes[0]===u.length-1)){var R={type:"Polygon",coordinates:[[].concat(wy(u),[u[0]])]};this.resetClickSequence();var B=this.getAddFeatureOrBooleanPolygonAction(R,o);B&&o.onEdit(B)}else P&&o.onEdit({updatedData:o.data,editType:"addTentativePosition",editContext:{position:i.mapCoords}})}},{key:"handleKeyUp",value:function(i,o){if(i.key==="Enter"){var a=this.getClickSequence();if(a.length>2){var s={type:"Polygon",coordinates:[[].concat(wy(a),[a[0]])]};this.resetClickSequence();var u=this.getAddFeatureOrBooleanPolygonAction(s,o);u&&o.onEdit(u)}}}},{key:"handlePointerMove",value:function(i,o){o.onUpdateCursor("cell"),RC(h1(n.prototype),"handlePointerMove",this).call(this,i,o)}}]),n}(sDe.GeoJsonEditMode);j1.DrawPolygonMode=vDe;var ER={},np={};Object.defineProperty(np,"__esModule",{value:!0});np.TwoClickPolygonMode=void 0;var xDe=So;function LC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?LC=function(n){return typeof n}:LC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},LC(t)}function bDe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function F7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function wDe(t,e,n){return e&&F7(t.prototype,e),n&&F7(t,n),t}function DC(t,e,n){return typeof Reflect<"u"&&Reflect.get?DC=Reflect.get:DC=function(i,o,a){var s=EDe(i,o);if(s){var u=Object.getOwnPropertyDescriptor(s,o);return u.get?u.get.call(a):u.value}},DC(t,e,n||t)}function EDe(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=d1(t),t!==null););return t}function SDe(t){return function(){var e=d1(t),n;if(PDe()){var r=d1(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return TDe(this,n)}}function TDe(t,e){return e&&(LC(e)==="object"||typeof e=="function")?e:CDe(t)}function CDe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function PDe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function d1(t){return d1=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},d1(t)}function IDe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&kk(t,e)}function kk(t,e){return kk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},kk(t,e)}var MDe=function(t){IDe(n,t);var e=SDe(n);function n(){return bDe(this,n),e.apply(this,arguments)}return wDe(n,[{key:"handleClick",value:function(i,o){o.modeConfig&&o.modeConfig.dragToDraw||(this.addClickSequence(i),this.checkAndFinishPolygon(o))}},{key:"handleStartDragging",value:function(i,o){!o.modeConfig||!o.modeConfig.dragToDraw||(this.addClickSequence(i),i.cancelPan())}},{key:"handleStopDragging",value:function(i,o){!o.modeConfig||!o.modeConfig.dragToDraw||(this.addClickSequence(i),this.checkAndFinishPolygon(o))}},{key:"checkAndFinishPolygon",value:function(i){var o=this.getClickSequence(),a=this.getTentativeGuide(i);if(o.length>1&&a&&a.geometry.type==="Polygon"){var s={type:"Feature",properties:{shape:a.properties.shape},geometry:{type:"Polygon",coordinates:a.geometry.coordinates}},u=this.getAddFeatureOrBooleanPolygonAction(s,i);this.resetClickSequence(),u&&i.onEdit(u)}}},{key:"getGuides",value:function(i){var o=i.lastPointerMoveEvent,a=i.modeConfig,s=this.getClickSequence(),u={type:"FeatureCollection",features:[]};if(s.length===0)return u;var d=s[0],g=o.mapCoords,_=this.getTwoClickPolygon(d,g,a);return _&&u.features.push({type:"Feature",properties:{shape:_.properties&&_.properties.shape,guideType:"tentative"},geometry:_.geometry}),u}},{key:"getTwoClickPolygon",value:function(i,o,a){return null}},{key:"handlePointerMove",value:function(i,o){o.onUpdateCursor("cell"),DC(d1(n.prototype),"handlePointerMove",this).call(this,i,o)}},{key:"createTentativeFeature",value:function(i){var o=i.lastPointerMoveEvent,a=this.getClickSequence(),s=o?[o.mapCoords]:[],u;return a.length===1&&(u=this.getTwoClickPolygon(a[0],s[0],i.modeConfig)),u}}]),n}(xDe.GeoJsonEditMode);np.TwoClickPolygonMode=MDe;Object.defineProperty(ER,"__esModule",{value:!0});ER.DrawRectangleMode=void 0;var ODe=LDe(f_),RDe=np;function LDe(t){return t&&t.__esModule?t:{default:t}}function BC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?BC=function(n){return typeof n}:BC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},BC(t)}function DDe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function k7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function BDe(t,e,n){return e&&k7(t.prototype,e),n&&k7(t,n),t}function NDe(t){return function(){var e=BI(t),n;if(zDe()){var r=BI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return FDe(this,n)}}function FDe(t,e){return e&&(BC(e)==="object"||typeof e=="function")?e:kDe(t)}function kDe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function zDe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function BI(t){return BI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},BI(t)}function UDe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&zk(t,e)}function zk(t,e){return zk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},zk(t,e)}var GDe=function(t){UDe(n,t);var e=NDe(n);function n(){return DDe(this,n),e.apply(this,arguments)}return BDe(n,[{key:"getTwoClickPolygon",value:function(i,o,a){var s=(0,ODe.default)([i[0],i[1],o[0],o[1]]);return s.properties=s.properties||{},s.properties.shape="Rectangle",s}}]),n}(RDe.TwoClickPolygonMode);ER.DrawRectangleMode=GDe;var SR={};function jDe(t,e,n){n===void 0&&(n={});for(var r=xf(t),i=r.coordinates,o=0,a=0;a<i.length&&!(e>=o&&a===i.length-1);a++)if(o>=e){var s=e-o;if(s){var u=jE(i[a],i[a-1])-180,d=Gv(i[a],s,u,n);return d}else return zo(i[a])}else o+=ch(i[a],i[a+1],n);return zo(i[i.length-1])}const VDe=Object.freeze(Object.defineProperty({__proto__:null,default:jDe},Symbol.toStringTag,{value:"Module"})),Die=ti(VDe);Object.defineProperty(SR,"__esModule",{value:!0});SR.DrawSquareMode=void 0;var $De=R6(f_),z7=R6(Lc),HDe=R6(Die),_b=rl,WDe=np;function R6(t){return t&&t.__esModule?t:{default:t}}function NC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?NC=function(n){return typeof n}:NC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},NC(t)}function qDe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function U7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function XDe(t,e,n){return e&&U7(t.prototype,e),n&&U7(t,n),t}function ZDe(t){return function(){var e=NI(t),n;if(KDe()){var r=NI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return YDe(this,n)}}function YDe(t,e){return e&&(NC(e)==="object"||typeof e=="function")?e:QDe(t)}function QDe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function KDe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function NI(t){return NI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},NI(t)}function JDe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Uk(t,e)}function Uk(t,e){return Uk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Uk(t,e)}var eBe=function(t){JDe(n,t);var e=ZDe(n);function n(){return qDe(this,n),e.apply(this,arguments)}return XDe(n,[{key:"getTwoClickPolygon",value:function(i,o,a){var s=[o[0],i[1]],u=[i[0],o[1]],d=(0,z7.default)((0,_b.point)(s),(0,_b.point)(i)),g=(0,z7.default)((0,_b.point)(u),(0,_b.point)(i)),_=d<=g?d:g,E=d<=g?s:u,P=(0,_b.lineString)([E,o]),R=(0,HDe.default)(P,_),B=R.geometry.coordinates,V=(0,$De.default)([i[0],i[1],B[0],B[1]]);return V.properties=V.properties||{},V.properties.shape="Square",V}}]),n}(WDe.TwoClickPolygonMode);SR.DrawSquareMode=eBe;var TR={};Object.defineProperty(TR,"__esModule",{value:!0});TR.DrawRectangleFromCenterMode=void 0;var tBe=rBe(f_),nBe=np;function rBe(t){return t&&t.__esModule?t:{default:t}}function FC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?FC=function(n){return typeof n}:FC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},FC(t)}function iBe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function oBe(t,e,n){return e&&G7(t.prototype,e),n&&G7(t,n),t}function sBe(t){return function(){var e=FI(t),n;if(uBe()){var r=FI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return aBe(this,n)}}function aBe(t,e){return e&&(FC(e)==="object"||typeof e=="function")?e:lBe(t)}function lBe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function uBe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function FI(t){return FI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},FI(t)}function cBe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Gk(t,e)}function Gk(t,e){return Gk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Gk(t,e)}var fBe=function(t){cBe(n,t);var e=sBe(n);function n(){return iBe(this,n),e.apply(this,arguments)}return oBe(n,[{key:"getTwoClickPolygon",value:function(i,o,a){var s=i[0]>o[0]?i[0]+Math.abs(i[0]-o[0]):i[0]-Math.abs(i[0]-o[0]),u=i[1]>o[1]?i[1]+Math.abs(i[1]-o[1]):i[1]-Math.abs(i[1]-o[1]),d=(0,tBe.default)([s,u,o[0],o[1]]);return d.properties=d.properties||{},d.properties.shape="Rectangle",d}}]),n}(nBe.TwoClickPolygonMode);TR.DrawRectangleFromCenterMode=fBe;var CR={};Object.defineProperty(CR,"__esModule",{value:!0});CR.DrawSquareFromCenterMode=void 0;var hBe=L6(f_),j7=L6(Lc),dBe=L6(Die),yb=rl,pBe=np;function L6(t){return t&&t.__esModule?t:{default:t}}function kC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?kC=function(n){return typeof n}:kC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},kC(t)}function gBe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function V7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mBe(t,e,n){return e&&V7(t.prototype,e),n&&V7(t,n),t}function ABe(t){return function(){var e=kI(t),n;if(vBe()){var r=kI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return _Be(this,n)}}function _Be(t,e){return e&&(kC(e)==="object"||typeof e=="function")?e:yBe(t)}function yBe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function vBe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function kI(t){return kI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},kI(t)}function xBe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jk(t,e)}function jk(t,e){return jk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},jk(t,e)}var bBe=function(t){xBe(n,t);var e=ABe(n);function n(){return gBe(this,n),e.apply(this,arguments)}return mBe(n,[{key:"getTwoClickPolygon",value:function(i,o,a){var s=[o[0],i[1]],u=[i[0],o[1]],d=(0,j7.default)((0,yb.point)(s),(0,yb.point)(i)),g=(0,j7.default)((0,yb.point)(u),(0,yb.point)(i)),_=d<=g?d:g,E=d<=g?s:u,P=(0,yb.lineString)([E,o]),R=(0,dBe.default)(P,_),B=R.geometry.coordinates,V=i[0]>B[0]?i[0]+Math.abs(i[0]-B[0]):i[0]-Math.abs(i[0]-B[0]),z=i[1]>B[1]?i[1]+Math.abs(i[1]-B[1]):i[1]-Math.abs(i[1]-B[1]),F=(0,hBe.default)([V,z,B[0],B[1]]);return F.properties=F.properties||{},F.properties.shape="Square",F}}]),n}(pBe.TwoClickPolygonMode);CR.DrawSquareFromCenterMode=bBe;var PR={};Object.defineProperty(PR,"__esModule",{value:!0});PR.DrawCircleByDiameterMode=void 0;var wBe=Bie(a6),EBe=Bie(Lc),SBe=So,TBe=np;function Bie(t){return t&&t.__esModule?t:{default:t}}function zC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?zC=function(n){return typeof n}:zC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},zC(t)}function CBe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function PBe(t,e,n){return e&&$7(t.prototype,e),n&&$7(t,n),t}function IBe(t){return function(){var e=zI(t),n;if(RBe()){var r=zI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return MBe(this,n)}}function MBe(t,e){return e&&(zC(e)==="object"||typeof e=="function")?e:OBe(t)}function OBe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function RBe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function zI(t){return zI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},zI(t)}function LBe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vk(t,e)}function Vk(t,e){return Vk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Vk(t,e)}var DBe=function(t){LBe(n,t);var e=IBe(n);function n(){return CBe(this,n),e.apply(this,arguments)}return PBe(n,[{key:"getTwoClickPolygon",value:function(i,o,a){var s=a||{},u=s.steps,d=u===void 0?64:u,g={steps:d};d<4&&(console.warn("Minimum steps to draw a circle is 4 "),g.steps=4);var _=(0,SBe.getIntermediatePosition)(i,o),E=Math.max((0,EBe.default)(i,_),.001),P=(0,wBe.default)(_,E,g);return P.properties=P.properties||{},P.properties.shape="Circle",P}}]),n}(TBe.TwoClickPolygonMode);PR.DrawCircleByDiameterMode=DBe;var IR={};Object.defineProperty(IR,"__esModule",{value:!0});IR.DrawCircleFromCenterMode=void 0;var BBe=Nie(a6),NBe=Nie(Lc),FBe=np;function Nie(t){return t&&t.__esModule?t:{default:t}}function UC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?UC=function(n){return typeof n}:UC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},UC(t)}function kBe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function H7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function zBe(t,e,n){return e&&H7(t.prototype,e),n&&H7(t,n),t}function UBe(t){return function(){var e=UI(t),n;if(VBe()){var r=UI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return GBe(this,n)}}function GBe(t,e){return e&&(UC(e)==="object"||typeof e=="function")?e:jBe(t)}function jBe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function VBe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function UI(t){return UI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},UI(t)}function $Be(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$k(t,e)}function $k(t,e){return $k=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},$k(t,e)}var HBe=function(t){$Be(n,t);var e=UBe(n);function n(){return kBe(this,n),e.apply(this,arguments)}return zBe(n,[{key:"getTwoClickPolygon",value:function(i,o,a){var s=a||{},u=s.steps,d=u===void 0?64:u,g={steps:d};d<4&&(console.warn("Minimum steps to draw a circle is 4 "),g.steps=4);var _=Math.max((0,NBe.default)(i,o),.001),E=(0,BBe.default)(i,_,g);return E.properties=E.properties||{},E.properties.shape="Circle",E}}]),n}(FBe.TwoClickPolygonMode);IR.DrawCircleFromCenterMode=HBe;var MR={};function WBe(t,e,n,r){r=r||{};var i=r.steps||64,o=r.units||"kilometers",a=r.angle||0,s=r.pivot||t,u=r.properties||t.properties||{};if(!t)throw new Error("center is required");if(!e)throw new Error("xSemiAxis is required");if(!n)throw new Error("ySemiAxis is required");if(!c_(r))throw new Error("options must be an object");if(!Km(i))throw new Error("steps must be a number");if(!Km(a))throw new Error("angle must be a number");var d=Ea(t);if(o==="degrees")var g=wa(a);else e=jw(t,e,90,{units:o}),n=jw(t,n,0,{units:o}),e=Ea(e)[0]-d[0],n=Ea(n)[1]-d[1];for(var _=[],E=0;E<i;E+=1){var P=E*-360/i,R=e*n/Math.sqrt(Math.pow(n,2)+Math.pow(e,2)*Math.pow(W7(P),2)),B=e*n/Math.sqrt(Math.pow(e,2)+Math.pow(n,2)/Math.pow(W7(P),2));if(P<-90&&P>=-270&&(R=-R),P<-180&&P>=-360&&(B=-B),o==="degrees"){var V=R*Math.cos(g)+B*Math.sin(g),z=B*Math.cos(g)-R*Math.sin(g);R=V,B=z}_.push([R+d[0],B+d[1]])}return _.push(_[0]),o==="degrees"?Th([_],u):zre(Th([_],u),a,{pivot:s})}function W7(t){var e=t*Math.PI/180;return Math.tan(e)}const qBe=Object.freeze(Object.defineProperty({__proto__:null,default:WBe},Symbol.toStringTag,{value:"Module"})),Fie=ti(qBe);Object.defineProperty(MR,"__esModule",{value:!0});MR.DrawEllipseByBoundingBoxMode=void 0;var XBe=D6(f_),q7=D6(Lc),ZBe=D6(Fie),HS=rl,YBe=So,QBe=np;function D6(t){return t&&t.__esModule?t:{default:t}}function GC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?GC=function(n){return typeof n}:GC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},GC(t)}function KBe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function X7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function JBe(t,e,n){return e&&X7(t.prototype,e),n&&X7(t,n),t}function eNe(t){return function(){var e=GI(t),n;if(rNe()){var r=GI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return tNe(this,n)}}function tNe(t,e){return e&&(GC(e)==="object"||typeof e=="function")?e:nNe(t)}function nNe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function rNe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function GI(t){return GI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},GI(t)}function iNe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Hk(t,e)}function Hk(t,e){return Hk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Hk(t,e)}var oNe=function(t){iNe(n,t);var e=eNe(n);function n(){return KBe(this,n),e.apply(this,arguments)}return JBe(n,[{key:"getTwoClickPolygon",value:function(i,o,a){var s=Math.min(i[0],o[0]),u=Math.min(i[1],o[1]),d=Math.max(i[0],o[0]),g=Math.max(i[1],o[1]),_=(0,XBe.default)([s,u,d,g]).geometry.coordinates[0],E=(0,YBe.getIntermediatePosition)(i,o),P=Math.max((0,q7.default)((0,HS.point)(_[0]),(0,HS.point)(_[1])),.001),R=Math.max((0,q7.default)((0,HS.point)(_[0]),(0,HS.point)(_[3])),.001);return(0,ZBe.default)(E,P,R)}}]),n}(QBe.TwoClickPolygonMode);MR.DrawEllipseByBoundingBoxMode=oNe;var OR={},n2={};Object.defineProperty(n2,"__esModule",{value:!0});n2.ThreeClickPolygonMode=void 0;var sNe=So;function jC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?jC=function(n){return typeof n}:jC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},jC(t)}function aNe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function lNe(t,e,n){return e&&Z7(t.prototype,e),n&&Z7(t,n),t}function VC(t,e,n){return typeof Reflect<"u"&&Reflect.get?VC=Reflect.get:VC=function(i,o,a){var s=uNe(i,o);if(s){var u=Object.getOwnPropertyDescriptor(s,o);return u.get?u.get.call(a):u.value}},VC(t,e,n||t)}function uNe(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=p1(t),t!==null););return t}function cNe(t){return function(){var e=p1(t),n;if(dNe()){var r=p1(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return fNe(this,n)}}function fNe(t,e){return e&&(jC(e)==="object"||typeof e=="function")?e:hNe(t)}function hNe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dNe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function p1(t){return p1=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},p1(t)}function pNe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Wk(t,e)}function Wk(t,e){return Wk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Wk(t,e)}var gNe=function(t){pNe(n,t);var e=cNe(n);function n(){return aNe(this,n),e.apply(this,arguments)}return lNe(n,[{key:"handleClick",value:function(i,o){this.addClickSequence(i);var a=this.getClickSequence(),s=this.getTentativeGuide(o);if(a.length>2&&s&&s.geometry.type==="Polygon"){var u=this.getAddFeatureOrBooleanPolygonAction(s.geometry,o);this.resetClickSequence(),u&&o.onEdit(u)}}},{key:"getGuides",value:function(i){var o=i.lastPointerMoveEvent,a=i.modeConfig,s=this.getClickSequence(),u={type:"FeatureCollection",features:[]};if(s.length===0)return u;var d=o.mapCoords;if(s.length===1)u.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[s[0],d]}});else{var g=this.getThreeClickPolygon(s[0],s[1],d,a);g&&u.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:g.geometry})}return u}},{key:"getThreeClickPolygon",value:function(i,o,a,s){return null}},{key:"handlePointerMove",value:function(i,o){o.onUpdateCursor("cell"),VC(p1(n.prototype),"handlePointerMove",this).call(this,i,o)}},{key:"createTentativeFeature",value:function(i){var o=i.lastPointerMoveEvent,a=this.getClickSequence(),s=o?[o.mapCoords]:[],u;return a.length===2&&(u=this.getThreeClickPolygon(a[0],a[1],s[0],i.modeConfig)),u}}]),n}(sNe.GeoJsonEditMode);n2.ThreeClickPolygonMode=gNe;Object.defineProperty(OR,"__esModule",{value:!0});OR.DrawEllipseUsingThreePointsMode=void 0;var Y7=B6(Lc),mNe=B6(Fie),ANe=B6(Kd),_Ne=rl,yNe=So,vNe=n2;function B6(t){return t&&t.__esModule?t:{default:t}}function $C(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?$C=function(n){return typeof n}:$C=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},$C(t)}function xNe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Q7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function bNe(t,e,n){return e&&Q7(t.prototype,e),n&&Q7(t,n),t}function wNe(t){return function(){var e=jI(t),n;if(TNe()){var r=jI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return ENe(this,n)}}function ENe(t,e){return e&&($C(e)==="object"||typeof e=="function")?e:SNe(t)}function SNe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function TNe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function jI(t){return jI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},jI(t)}function CNe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qk(t,e)}function qk(t,e){return qk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},qk(t,e)}var PNe=function(t){CNe(n,t);var e=wNe(n);function n(){return xNe(this,n),e.apply(this,arguments)}return bNe(n,[{key:"getThreeClickPolygon",value:function(i,o,a,s){var u=(0,yNe.getIntermediatePosition)(i,o),d=Math.max((0,Y7.default)(u,(0,_Ne.point)(a)),.001),g=Math.max((0,Y7.default)(i,o),.001)/2,_={angle:(0,ANe.default)(i,o)};return(0,mNe.default)(u,d,g,_)}}]),n}(vNe.ThreeClickPolygonMode);OR.DrawEllipseUsingThreePointsMode=PNe;var RR={};Object.defineProperty(RR,"__esModule",{value:!0});RR.DrawRectangleUsingThreePointsMode=void 0;var INe=Ai,MNe=n2;function HC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?HC=function(n){return typeof n}:HC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},HC(t)}function ONe(t,e){return BNe(t)||DNe(t,e)||LNe(t,e)||RNe()}function RNe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LNe(t,e){if(t){if(typeof t=="string")return K7(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return K7(t,e)}}function K7(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function DNe(t,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var n=[],r=!0,i=!1,o=void 0;try{for(var a=t[Symbol.iterator](),s;!(r=(s=a.next()).done)&&(n.push(s.value),!(e&&n.length===e));r=!0);}catch(u){i=!0,o=u}finally{try{!r&&a.return!=null&&a.return()}finally{if(i)throw o}}return n}}function BNe(t){if(Array.isArray(t))return t}function NNe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function J7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function FNe(t,e,n){return e&&J7(t.prototype,e),n&&J7(t,n),t}function kNe(t){return function(){var e=VI(t),n;if(GNe()){var r=VI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return zNe(this,n)}}function zNe(t,e){return e&&(HC(e)==="object"||typeof e=="function")?e:UNe(t)}function UNe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function GNe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function VI(t){return VI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},VI(t)}function jNe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Xk(t,e)}function Xk(t,e){return Xk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Xk(t,e)}var VNe=function(t){jNe(n,t);var e=kNe(n);function n(){return NNe(this,n),e.apply(this,arguments)}return FNe(n,[{key:"getThreeClickPolygon",value:function(i,o,a,s){var u=(0,INe.generatePointsParallelToLinePoints)(i,o,a),d=ONe(u,2),g=d[0],_=d[1];return{type:"Feature",properties:{shape:"Rectangle"},geometry:{type:"Polygon",coordinates:[[i,o,g,_,i]]}}}}]),n}(MNe.ThreeClickPolygonMode);RR.DrawRectangleUsingThreePointsMode=VNe;var LR={};Object.defineProperty(LR,"__esModule",{value:!0});LR.Draw90DegreePolygonMode=void 0;var eW=DR(YO),tW=DR(Kd),$Ne=DR(O6),HNe=DR(Lc),WS=rl,gB=Ai,WNe=So;function DR(t){return t&&t.__esModule?t:{default:t}}function WC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?WC=function(n){return typeof n}:WC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},WC(t)}function Ad(t){return ZNe(t)||XNe(t)||kie(t)||qNe()}function qNe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XNe(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function ZNe(t){if(Array.isArray(t))return Zk(t)}function YNe(t,e){return JNe(t)||KNe(t,e)||kie(t,e)||QNe()}function QNe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kie(t,e){if(t){if(typeof t=="string")return Zk(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zk(t,e)}}function Zk(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function KNe(t,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var n=[],r=!0,i=!1,o=void 0;try{for(var a=t[Symbol.iterator](),s;!(r=(s=a.next()).done)&&(n.push(s.value),!(e&&n.length===e));r=!0);}catch(u){i=!0,o=u}finally{try{!r&&a.return!=null&&a.return()}finally{if(i)throw o}}return n}}function JNe(t){if(Array.isArray(t))return t}function eFe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nW(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function tFe(t,e,n){return e&&nW(t.prototype,e),n&&nW(t,n),t}function qC(t,e,n){return typeof Reflect<"u"&&Reflect.get?qC=Reflect.get:qC=function(i,o,a){var s=nFe(i,o);if(s){var u=Object.getOwnPropertyDescriptor(s,o);return u.get?u.get.call(a):u.value}},qC(t,e,n||t)}function nFe(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=g1(t),t!==null););return t}function rFe(t){return function(){var e=g1(t),n;if(sFe()){var r=g1(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return iFe(this,n)}}function iFe(t,e){return e&&(WC(e)==="object"||typeof e=="function")?e:oFe(t)}function oFe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function sFe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function g1(t){return g1=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},g1(t)}function aFe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Yk(t,e)}function Yk(t,e){return Yk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Yk(t,e)}var lFe=function(t){aFe(n,t);var e=rFe(n);function n(){return eFe(this,n),e.apply(this,arguments)}return tFe(n,[{key:"createTentativeFeature",value:function(i){var o=this.getClickSequence(),a=i.lastPointerMoveEvent.mapCoords,s;if(o.length===1)s=a;else{var u=o[o.length-2],d=o[o.length-1],g=(0,gB.generatePointsParallelToLinePoints)(u,d,a),_=YNe(g,1);s=_[0]}var E;return o.length<3?E={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[].concat(Ad(o),[s])}}:E={type:"Feature",properties:{guideType:"tentative"},geometry:{type:"Polygon",coordinates:[[].concat(Ad(o),[s,o[0]])]}},E}},{key:"getGuides",value:function(i){var o={type:"FeatureCollection",features:[]},a=this.getClickSequence();if(a.length===0||!i.lastPointerMoveEvent)return o;var s=this.createTentativeFeature(i);return o.features.push(s),o.features=o.features.concat((0,gB.getEditHandlesForGeometry)(s.geometry,-1)),o.features=o.features.slice(0,-1),o}},{key:"handlePointerMove",value:function(i,o){o.onUpdateCursor("cell"),qC(g1(n.prototype),"handlePointerMove",this).call(this,i,o)}},{key:"handleClick",value:function(i,o){var a=i.picks,s=this.getTentativeGuide(o);this.addClickSequence(i);var u=this.getClickSequence();if(s){if(u.length===3&&s.geometry.type==="LineString"){var d=s.geometry;u[u.length-1]=d.coordinates[d.coordinates.length-1]}else if(u.length>3&&s.geometry.type==="Polygon"){var g=s.geometry;u[u.length-1]=g.coordinates[0][g.coordinates[0].length-2];var _=(0,gB.getPickedEditHandle)(a);if(_&&Array.isArray(_.properties.positionIndexes)&&(_.properties.positionIndexes[1]===0||_.properties.positionIndexes[1]===g.coordinates[0].length-3)){var E={type:"Polygon",coordinates:this.finalizedCoordinates(Ad(g.coordinates[0]))};this.resetClickSequence();var P=this.getAddFeatureOrBooleanPolygonAction(E,o);P&&o.onEdit(P)}}var R={screenCoords:[-1,-1],mapCoords:i.mapCoords,picks:[],pointerDownPicks:null,pointerDownScreenCoords:null,pointerDownMapCoords:null,cancelPan:function(){},sourceEvent:null};this.handlePointerMove(R,o)}}},{key:"finalizedCoordinates",value:function(i){var o=[[].concat(Ad(i.slice(0,-2)),[i[0]])],a=this.getIntermediatePoint(Ad(i));if(a)o=[[].concat(Ad(i.slice(0,-2)),[a,i[0]])];else{var s=Ad(i);s.splice(-3,1),a=this.getIntermediatePoint(Ad(s)),a&&(o=[[].concat(Ad(i.slice(0,-3)),[a,i[0]])])}return o}},{key:"getIntermediatePoint",value:function(i){var o;if(i.length>4){var a=Ad(i),s=a[0],u=a[1],d=(0,tW.default)(s,u),g=i[i.length-3],_=i[i.length-4],E=(0,tW.default)(g,_),P={first:[],second:[]};[1,2,3].forEach(function(B){var V=d+B*90;P.first.push(V>180?V-360:V);var z=E+B*90;P.second.push(z>180?z-360:z)});var R=(0,HNe.default)((0,WS.point)(s),(0,WS.point)(g));[0,1,2].forEach(function(B){var V=(0,WS.lineString)([s,(0,eW.default)(s,R,P.first[B]).geometry.coordinates]);[0,1,2].forEach(function(z){var F=(0,WS.lineString)([g,(0,eW.default)(g,R,P.second[z]).geometry.coordinates]),k=(0,$Ne.default)(V,F);k&&k.features.length&&(o=k.features[0].geometry.coordinates)})})}return o}}]),n}(WNe.GeoJsonEditMode);LR.Draw90DegreePolygonMode=lFe;var BR={},zie="Expected a function",rW=0/0,uFe="[object Symbol]",cFe=/^\s+|\s+$/g,fFe=/^[-+]0x[0-9a-f]+$/i,hFe=/^0b[01]+$/i,dFe=/^0o[0-7]+$/i,pFe=parseInt,gFe=typeof Ya=="object"&&Ya&&Ya.Object===Object&&Ya,mFe=typeof self=="object"&&self&&self.Object===Object&&self,AFe=gFe||mFe||Function("return this")(),_Fe=Object.prototype,yFe=_Fe.toString,vFe=Math.max,xFe=Math.min,mB=function(){return AFe.Date.now()};function bFe(t,e,n){var r,i,o,a,s,u,d=0,g=!1,_=!1,E=!0;if(typeof t!="function")throw new TypeError(zie);e=iW(e)||0,$I(n)&&(g=!!n.leading,_="maxWait"in n,o=_?vFe(iW(n.maxWait)||0,e):o,E="trailing"in n?!!n.trailing:E);function P(J){var ie=r,ce=i;return r=i=void 0,d=J,a=t.apply(ce,ie),a}function R(J){return d=J,s=setTimeout(z,e),g?P(J):a}function B(J){var ie=J-u,ce=J-d,re=e-ie;return _?xFe(re,o-ce):re}function V(J){var ie=J-u,ce=J-d;return u===void 0||ie>=e||ie<0||_&&ce>=o}function z(){var J=mB();if(V(J))return F(J);s=setTimeout(z,B(J))}function F(J){return s=void 0,E&&r?P(J):(r=i=void 0,a)}function k(){s!==void 0&&clearTimeout(s),d=0,r=u=i=s=void 0}function X(){return s===void 0?a:F(mB())}function Y(){var J=mB(),ie=V(J);if(r=arguments,i=this,u=J,ie){if(s===void 0)return R(u);if(_)return s=setTimeout(z,e),P(u)}return s===void 0&&(s=setTimeout(z,e)),a}return Y.cancel=k,Y.flush=X,Y}function wFe(t,e,n){var r=!0,i=!0;if(typeof t!="function")throw new TypeError(zie);return $I(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),bFe(t,e,{leading:r,maxWait:e,trailing:i})}function $I(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function EFe(t){return!!t&&typeof t=="object"}function SFe(t){return typeof t=="symbol"||EFe(t)&&yFe.call(t)==uFe}function iW(t){if(typeof t=="number")return t;if(SFe(t))return rW;if($I(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=$I(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(cFe,"");var n=hFe.test(t);return n||dFe.test(t)?pFe(t.slice(2),n?2:8):fFe.test(t)?rW:+t}var TFe=wFe;Object.defineProperty(BR,"__esModule",{value:!0});BR.DrawPolygonByDraggingMode=void 0;var CFe=MFe(TFe),PFe=Ai,IFe=j1;function MFe(t){return t&&t.__esModule?t:{default:t}}function XC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?XC=function(n){return typeof n}:XC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},XC(t)}function OFe(t){return BFe(t)||DFe(t)||LFe(t)||RFe()}function RFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LFe(t,e){if(t){if(typeof t=="string")return Qk(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qk(t,e)}}function DFe(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function BFe(t){if(Array.isArray(t))return Qk(t)}function Qk(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function NFe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oW(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function FFe(t,e,n){return e&&oW(t.prototype,e),n&&oW(t,n),t}function kFe(t){return function(){var e=HI(t),n;if(UFe()){var r=HI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return zFe(this,n)}}function zFe(t,e){return e&&(XC(e)==="object"||typeof e=="function")?e:Uie(t)}function Uie(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function UFe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function HI(t){return HI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},HI(t)}function GFe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Kk(t,e)}function Kk(t,e){return Kk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Kk(t,e)}function jFe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var VFe=function(t){GFe(n,t);var e=kFe(n);function n(){var r;NFe(this,n);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r=e.call.apply(e,[this].concat(o)),jFe(Uie(r),"handleDraggingThrottled",null),r}return FFe(n,[{key:"handleClick",value:function(i,o){}},{key:"handleStartDragging",value:function(i,o){i.cancelPan(),o.modeConfig&&o.modeConfig.throttleMs?this.handleDraggingThrottled=(0,CFe.default)(this.handleDraggingAux,o.modeConfig.throttleMs):this.handleDraggingThrottled=this.handleDraggingAux}},{key:"handleStopDragging",value:function(i,o){this.addClickSequence(i);var a=this.getClickSequence();if(this.handleDraggingThrottled&&this.handleDraggingThrottled.cancel&&this.handleDraggingThrottled.cancel(),a.length>2){var s={type:"Polygon",coordinates:[[].concat(OFe(a),[a[0]])]};this.resetClickSequence();var u=this.getAddFeatureOrBooleanPolygonAction(s,o);u&&o.onEdit(u)}}},{key:"handleDraggingAux",value:function(i,o){var a=i.picks,s=(0,PFe.getPickedEditHandle)(a);s||this.addClickSequence(i)}},{key:"handleDragging",value:function(i,o){this.handleDraggingThrottled&&this.handleDraggingThrottled(i,o)}}]),n}(IFe.DrawPolygonMode);BR.DrawPolygonByDraggingMode=VFe;var NR={};Object.defineProperty(NR,"__esModule",{value:!0});NR.ViewMode=void 0;var $Fe=So;function ZC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ZC=function(n){return typeof n}:ZC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ZC(t)}function HFe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function WFe(t){return function(){var e=WI(t),n;if(ZFe()){var r=WI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return qFe(this,n)}}function qFe(t,e){return e&&(ZC(e)==="object"||typeof e=="function")?e:XFe(t)}function XFe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ZFe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function WI(t){return WI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},WI(t)}function YFe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Jk(t,e)}function Jk(t,e){return Jk=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Jk(t,e)}var QFe=function(t){YFe(n,t);var e=WFe(n);function n(){return HFe(this,n),e.apply(this,arguments)}return n}($Fe.GeoJsonEditMode);NR.ViewMode=QFe;var FR={};function KFe(t,e){var n=ch(t,e),r=jE(t,e),i=Gv(t,n/2,r);return i}const JFe=Object.freeze(Object.defineProperty({__proto__:null,default:KFe},Symbol.toStringTag,{value:"Module"})),eke=ti(JFe);Object.defineProperty(FR,"__esModule",{value:!0});FR.MeasureDistanceMode=void 0;var tke=Gie(Lc),sW=Gie(eke),nke=Ai,rke=So;function Gie(t){return t&&t.__esModule?t:{default:t}}function YC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?YC=function(n){return typeof n}:YC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},YC(t)}function AB(t){return ake(t)||ske(t)||oke(t)||ike()}function ike(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oke(t,e){if(t){if(typeof t=="string")return e4(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e4(t,e)}}function ske(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function ake(t){if(Array.isArray(t))return e4(t)}function e4(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function lke(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function aW(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function uke(t,e,n){return e&&aW(t.prototype,e),n&&aW(t,n),t}function cke(t){return function(){var e=qI(t),n;if(hke()){var r=qI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return fke(this,n)}}function fke(t,e){return e&&(YC(e)==="object"||typeof e=="function")?e:Zb(t)}function Zb(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function qI(t){return qI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},qI(t)}function dke(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&t4(t,e)}function t4(t,e){return t4=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},t4(t,e)}function qS(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var pke=function(t){dke(n,t);var e=cke(n);function n(){var r;lke(this,n);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r=e.call.apply(e,[this].concat(o)),qS(Zb(r),"_isMeasuringSessionFinished",!1),qS(Zb(r),"_currentTooltips",[]),qS(Zb(r),"_currentDistance",0),qS(Zb(r),"_calculateDistanceForTooltip",function(s){var u=s.positionA,d=s.positionB,g=s.modeConfig,_=g||{},E=_.turfOptions,P=_.measurementCallback,R=(0,tke.default)(u,d,E);return P&&P(R),R}),r}return uke(n,[{key:"_formatTooltip",value:function(i,o){var a=o||{},s=a.formatTooltip,u=a.turfOptions,d=u&&u.units||"kilometers",g;return s?g=s(i):g="".concat(parseFloat(i).toFixed(2)," ").concat(d),g}},{key:"handleClick",value:function(i,o){var a=o.modeConfig,s=o.data,u=o.onEdit,d=a||{},g=d.centerTooltipsOnLine,_=g===void 0?!1:g;this._isMeasuringSessionFinished&&(this._isMeasuringSessionFinished=!1,this.resetClickSequence(),this._currentTooltips=[],this._currentDistance=0);var E=i.picks,P=(0,nke.getPickedEditHandle)(E),R=!1;P||(this.addClickSequence(i),R=!0);var B=this.getClickSequence();if(B.length>1&&P&&Array.isArray(P.properties.positionIndexes)&&P.properties.positionIndexes[0]===B.length-1)this._isMeasuringSessionFinished=!0;else if(R){if(B.length>1){this._currentDistance+=this._calculateDistanceForTooltip({positionA:B[B.length-2],positionB:B[B.length-1],modeConfig:a});var V=_?(0,sW.default)(B[B.length-2],B[B.length-1]).geometry.coordinates:i.mapCoords;this._currentTooltips.push({position:V,text:this._formatTooltip(this._currentDistance,a)})}u({updatedData:s,editType:"addTentativePosition",editContext:{position:i.mapCoords}})}}},{key:"handleKeyUp",value:function(i,o){if(!this._isMeasuringSessionFinished){i.stopPropagation();var a=i.key,s=this.getClickSequence().length;switch(a){case"Escape":this._isMeasuringSessionFinished=!0,s===1&&(this.resetClickSequence(),this._currentTooltips=[]),o.onUpdateCursor("cell");break;case"Enter":this.handleClick(o.lastPointerMoveEvent,o),this._isMeasuringSessionFinished=!0;break}}}},{key:"getGuides",value:function(i){var o,a=i.lastPointerMoveEvent,s=this.getClickSequence(),u=a&&!this._isMeasuringSessionFinished?[a.mapCoords]:[],d={type:"FeatureCollection",features:[]};s.length>0&&d.features.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[].concat(AB(s),u)}});var g=s.map(function(_,E){return{type:"Feature",properties:{guideType:"editHandle",editHandleType:"existing",featureIndex:-1,positionIndexes:[E]},geometry:{type:"Point",coordinates:_}}});return(o=d.features).push.apply(o,AB(g)),d}},{key:"handlePointerMove",value:function(i,o){o.onUpdateCursor("cell")}},{key:"getTooltips",value:function(i){var o=i.lastPointerMoveEvent,a=i.modeConfig,s=a||{},u=s.centerTooltipsOnLine,d=u===void 0?!1:u,g=this.getClickSequence();if(g.length>0&&o&&!this._isMeasuringSessionFinished){var _=this._calculateDistanceForTooltip({positionA:g[g.length-1],positionB:o.mapCoords,modeConfig:i.modeConfig}),E=d?(0,sW.default)(g[g.length-1],o.mapCoords).geometry.coordinates:o.mapCoords;return[].concat(AB(this._currentTooltips),[{position:E,text:this._formatTooltip(this._currentDistance+_,a)}])}return this._currentTooltips}}]),n}(rke.GeoJsonEditMode);FR.MeasureDistanceMode=pke;var kR={},lW=6378137;function n4(t){return hre(t,function(e,n){return e+gke(n)},0)}function gke(t){var e=0,n;switch(t.type){case"Polygon":return uW(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)e+=uW(t.coordinates[n]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function uW(t){var e=0;if(t&&t.length>0){e+=Math.abs(cW(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(cW(t[n]))}return e}function cW(t){var e,n,r,i,o,a,s,u=0,d=t.length;if(d>2){for(s=0;s<d;s++)s===d-2?(i=d-2,o=d-1,a=0):s===d-1?(i=d-1,o=0,a=1):(i=s,o=s+1,a=s+2),e=t[i],n=t[o],r=t[a],u+=(_B(r[0])-_B(e[0]))*Math.sin(_B(n[1]));u=u*lW*lW/2}return u}function _B(t){return t*Math.PI/180}const mke=Object.freeze(Object.defineProperty({__proto__:null,default:n4},Symbol.toStringTag,{value:"Module"})),Ake=ti(mke);Object.defineProperty(kR,"__esModule",{value:!0});kR.MeasureAreaMode=void 0;var _ke=jie(Ake),yke=jie(f6),vke=j1;function jie(t){return t&&t.__esModule?t:{default:t}}function QC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?QC=function(n){return typeof n}:QC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},QC(t)}function fW(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function xke(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?fW(Object(n),!0).forEach(function(r){bke(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fW(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function bke(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function wke(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hW(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Eke(t,e,n){return e&&hW(t.prototype,e),n&&hW(t,n),t}function KC(t,e,n){return typeof Reflect<"u"&&Reflect.get?KC=Reflect.get:KC=function(i,o,a){var s=Ske(i,o);if(s){var u=Object.getOwnPropertyDescriptor(s,o);return u.get?u.get.call(a):u.value}},KC(t,e,n||t)}function Ske(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=m1(t),t!==null););return t}function Tke(t){return function(){var e=m1(t),n;if(Ike()){var r=m1(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return Cke(this,n)}}function Cke(t,e){return e&&(QC(e)==="object"||typeof e=="function")?e:Pke(t)}function Pke(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ike(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function m1(t){return m1=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},m1(t)}function Mke(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r4(t,e)}function r4(t,e){return r4=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},r4(t,e)}var Oke=[],Rke=function(t){Mke(n,t);var e=Tke(n);function n(){return wke(this,n),e.apply(this,arguments)}return Eke(n,[{key:"handleClick",value:function(i,o){var a=xke({},o,{onEdit:function(){}});KC(m1(n.prototype),"handleClick",this).call(this,i,a)}},{key:"getTooltips",value:function(i){var o=this.getTentativeGuide(i);if(o&&o.geometry.type==="Polygon"){var a=i.modeConfig,s=a||{},u=s.formatTooltip,d=s.measurementCallback,g="sq. m",_=(0,yke.default)(o),E=(0,_ke.default)(o),P;return u?P=u(E):P="".concat(parseFloat(E).toFixed(2)," ").concat(g),d&&d(E),[{position:_.geometry.coordinates,text:P}]}return Oke}}]),n}(vke.DrawPolygonMode);kR.MeasureAreaMode=Rke;var zR={},N6={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;function e(r,i){if(r===i)return!0;if(Array.isArray(r)){var o=r.length;if(!i||i.length!==o)return!1;for(var a=0;a<o;a++)if(r[a]!==i[a])return!1;return!0}return!1}function n(r){var i={},o;return function(a){for(var s in a)if(!e(a[s],i[s])){o=r(a),i=a;break}return o}}})(N6);Object.defineProperty(zR,"__esModule",{value:!0});zR.MeasureAngleMode=void 0;var dW=F6(Kd),Lke=F6(Rre),Dke=F6(N6),Bke=So;function F6(t){return t&&t.__esModule?t:{default:t}}function JC(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?JC=function(n){return typeof n}:JC=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},JC(t)}function Nke(t){return Uke(t)||zke(t)||kke(t)||Fke()}function Fke(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kke(t,e){if(t){if(typeof t=="string")return i4(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i4(t,e)}}function zke(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function Uke(t){if(Array.isArray(t))return i4(t)}function i4(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Gke(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pW(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function jke(t,e,n){return e&&pW(t.prototype,e),n&&pW(t,n),t}function Vke(t){return function(){var e=XI(t),n;if(Hke()){var r=XI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return $ke(this,n)}}function $ke(t,e){return e&&(JC(e)==="object"||typeof e=="function")?e:Vie(t)}function Vie(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Hke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function XI(t){return XI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},XI(t)}function Wke(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o4(t,e)}function o4(t,e){return o4=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},o4(t,e)}function qke(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Xke=[],Zke=function(t){Wke(n,t);var e=Vke(n);function n(){var r;Gke(this,n);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r=e.call.apply(e,[this].concat(o)),qke(Vie(r),"_getTooltips",(0,Dke.default)(function(s){var u=s.modeConfig,d=s.vertex,g=s.point1,_=s.point2,E=Xke;if(d&&g&&_){var P=u||{},R=P.formatTooltip,B=P.measurementCallback,V="deg",z=(0,dW.default)(d,g),F=(0,dW.default)(d,_),k=Math.abs(z-F);k>180&&(k=360-k);var X;R?X=R(k):X="".concat(parseFloat(k).toFixed(2)," ").concat(V),B&&B(k);var Y=(0,Lke.default)({type:"FeatureCollection",features:[g,_].map(function(J){return{type:"Feature",geometry:{type:"Point",coordinates:J}}})}).geometry.coordinates;E=[{position:Y,text:X}]}return E})),r}return jke(n,[{key:"handleClick",value:function(i,o){this.getClickSequence().length>=3&&this.resetClickSequence(),this.addClickSequence(i)}},{key:"handlePointerMove",value:function(i,o){o.onUpdateCursor("cell")}},{key:"getPoints",value:function(i){var o=this.getClickSequence(),a=Nke(o);return o.length<3&&i.lastPointerMoveEvent&&a.push(i.lastPointerMoveEvent.mapCoords),a}},{key:"getGuides",value:function(i){var o={type:"FeatureCollection",features:[]},a=o.features,s=this.getPoints(i);return s.length>2?a.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[s[1],s[0],s[2]]}}):s.length>1&&a.push({type:"Feature",properties:{guideType:"tentative"},geometry:{type:"LineString",coordinates:[s[1],s[0]]}}),o}},{key:"getTooltips",value:function(i){var o=this.getPoints(i);return this._getTooltips({modeConfig:i.modeConfig,vertex:o[0],point1:o[1],point2:o[2]})}}]),n}(Bke.GeoJsonEditMode);zR.MeasureAngleMode=Zke;var UR={};Object.defineProperty(UR,"__esModule",{value:!0});UR.SnappableMode=void 0;var XS=Ai,Yke=So;function eP(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?eP=function(n){return typeof n}:eP=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},eP(t)}function Qke(t){if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(t=$ie(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,i=!0,o=!1,a;return{s:function(){r=t[Symbol.iterator]()},n:function(){var u=r.next();return i=u.done,u},e:function(u){o=!0,a=u},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw a}}}}function Ey(t){return e4e(t)||Jke(t)||$ie(t)||Kke()}function Kke(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $ie(t,e){if(t){if(typeof t=="string")return s4(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s4(t,e)}}function Jke(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function e4e(t){if(Array.isArray(t))return s4(t)}function s4(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function gW(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function t4e(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?gW(Object(n),!0).forEach(function(r){Wie(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gW(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function n4e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mW(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r4e(t,e,n){return e&&mW(t.prototype,e),n&&mW(t,n),t}function i4e(t){return function(){var e=ZI(t),n;if(s4e()){var r=ZI(this).constructor;n=Reflect.construct(e,arguments,r)}else n=e.apply(this,arguments);return o4e(this,n)}}function o4e(t,e){return e&&(eP(e)==="object"||typeof e=="function")?e:Hie(t)}function Hie(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s4e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function ZI(t){return ZI=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},ZI(t)}function a4e(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a4(t,e)}function a4(t,e){return a4=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},a4(t,e)}function Wie(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l4e=function(t){a4e(n,t);var e=i4e(n);function n(r){var i;return n4e(this,n),i=e.call(this),Wie(Hie(i),"_handler",void 0),i._handler=r,i}return r4e(n,[{key:"_getSnappedMouseEvent",value:function(i,o,a){return Object.assign(i,{mapCoords:a.geometry.coordinates,pointerDownMapCoords:o&&o.geometry.coordinates})}},{key:"_getPickedSnapTarget",value:function(i){return(0,XS.getPickedEditHandles)(i).find(function(o){return o.properties.editHandleType==="snap-target"})}},{key:"_getPickedSnapSource",value:function(i){return(0,XS.getPickedSnapSourceEditHandle)(i)}},{key:"_getUpdatedSnapSourceHandle",value:function(i,o){var a=i.properties,s=a.featureIndex,u=a.positionIndexes;if(!Array.isArray(u))return i;var d=o.features[s],g=u.reduce(function(_,E){return _[E]},d.geometry.coordinates);return t4e({},i,{geometry:{type:"Point",coordinates:g}})}},{key:"_getSnapTargets",value:function(i){var o=i.modeConfig||{},a=o.additionalSnapTargets;a=a||[];var s=[].concat(Ey(i.data.features),Ey(a));return s}},{key:"_getSnapTargetHandles",value:function(i){for(var o=[],a=this._getSnapTargets(i),s=0;s<a.length;s++){var u=!i.selectedIndexes.includes(s);if(u){var d=a[s].geometry;o.push.apply(o,Ey((0,XS.getEditHandlesForGeometry)(d,s,"snap-target")))}}return o}},{key:"getGuides",value:function(i){var o=i.modeConfig,a=i.lastPointerMoveEvent,s=o||{},u=s.enableSnapping,d={type:"FeatureCollection",features:Ey(this._handler.getGuides(i).features)};if(!u)return d;var g=a&&this._getPickedSnapSource(a.pointerDownPicks);if(g){var _;return(_=d.features).push.apply(_,Ey(this._getSnapTargetHandles(i)).concat([this._getUpdatedSnapSourceHandle(g,i.data)])),d}var E=i.data.features,P=Qke(i.selectedIndexes),R;try{for(P.s();!(R=P.n()).done;){var B=R.value;if(B<E.length){var V,z=E[B].geometry;(V=d.features).push.apply(V,Ey((0,XS.getEditHandlesForGeometry)(z,B,"snap-source")))}}}catch(F){P.e(F)}finally{P.f()}return d}},{key:"_getSnapAwareEvent",value:function(i,o){var a=this._getPickedSnapSource(o.lastPointerMoveEvent.pointerDownPicks),s=this._getPickedSnapTarget(i.picks);return a&&s?this._getSnappedMouseEvent(i,a,s):i}},{key:"handleStartDragging",value:function(i,o){this._handler.handleStartDragging(i,o)}},{key:"handleStopDragging",value:function(i,o){this._handler.handleStopDragging(this._getSnapAwareEvent(i,o),o)}},{key:"handleDragging",value:function(i,o){this._handler.handleDragging(this._getSnapAwareEvent(i,o),o)}},{key:"handlePointerMove",value:function(i,o){this._handler.handlePointerMove(this._getSnapAwareEvent(i,o),o)}}]),n}(Yke.GeoJsonEditMode);UR.SnappableMode=l4e;(function(t){function e(Dt){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(Mn){return typeof Mn}:e=function(Mn){return Mn&&typeof Symbol=="function"&&Mn.constructor===Symbol&&Mn!==Symbol.prototype?"symbol":typeof Mn},e(Dt)}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"GeoJsonEditMode",{enumerable:!0,get:function(){return n.GeoJsonEditMode}}),Object.defineProperty(t,"ModifyMode",{enumerable:!0,get:function(){return r.ModifyMode}}),Object.defineProperty(t,"ResizeCircleMode",{enumerable:!0,get:function(){return i.ResizeCircleMode}}),Object.defineProperty(t,"TranslateMode",{enumerable:!0,get:function(){return o.TranslateMode}}),Object.defineProperty(t,"ScaleMode",{enumerable:!0,get:function(){return a.ScaleMode}}),Object.defineProperty(t,"RotateMode",{enumerable:!0,get:function(){return s.RotateMode}}),Object.defineProperty(t,"DuplicateMode",{enumerable:!0,get:function(){return u.DuplicateMode}}),Object.defineProperty(t,"ExtendLineStringMode",{enumerable:!0,get:function(){return d.ExtendLineStringMode}}),Object.defineProperty(t,"SplitPolygonMode",{enumerable:!0,get:function(){return g.SplitPolygonMode}}),Object.defineProperty(t,"ExtrudeMode",{enumerable:!0,get:function(){return _.ExtrudeMode}}),Object.defineProperty(t,"ElevationMode",{enumerable:!0,get:function(){return E.ElevationMode}}),Object.defineProperty(t,"TransformMode",{enumerable:!0,get:function(){return P.TransformMode}}),Object.defineProperty(t,"DrawPointMode",{enumerable:!0,get:function(){return R.DrawPointMode}}),Object.defineProperty(t,"DrawLineStringMode",{enumerable:!0,get:function(){return B.DrawLineStringMode}}),Object.defineProperty(t,"DrawPolygonMode",{enumerable:!0,get:function(){return V.DrawPolygonMode}}),Object.defineProperty(t,"DrawRectangleMode",{enumerable:!0,get:function(){return z.DrawRectangleMode}}),Object.defineProperty(t,"DrawSquareMode",{enumerable:!0,get:function(){return F.DrawSquareMode}}),Object.defineProperty(t,"DrawRectangleFromCenterMode",{enumerable:!0,get:function(){return k.DrawRectangleFromCenterMode}}),Object.defineProperty(t,"DrawSquareFromCenterMode",{enumerable:!0,get:function(){return X.DrawSquareFromCenterMode}}),Object.defineProperty(t,"DrawCircleByDiameterMode",{enumerable:!0,get:function(){return Y.DrawCircleByDiameterMode}}),Object.defineProperty(t,"DrawCircleFromCenterMode",{enumerable:!0,get:function(){return J.DrawCircleFromCenterMode}}),Object.defineProperty(t,"DrawEllipseByBoundingBoxMode",{enumerable:!0,get:function(){return ie.DrawEllipseByBoundingBoxMode}}),Object.defineProperty(t,"DrawEllipseUsingThreePointsMode",{enumerable:!0,get:function(){return ce.DrawEllipseUsingThreePointsMode}}),Object.defineProperty(t,"DrawRectangleUsingThreePointsMode",{enumerable:!0,get:function(){return re.DrawRectangleUsingThreePointsMode}}),Object.defineProperty(t,"Draw90DegreePolygonMode",{enumerable:!0,get:function(){return ue.Draw90DegreePolygonMode}}),Object.defineProperty(t,"DrawPolygonByDraggingMode",{enumerable:!0,get:function(){return se.DrawPolygonByDraggingMode}}),Object.defineProperty(t,"ImmutableFeatureCollection",{enumerable:!0,get:function(){return me.ImmutableFeatureCollection}}),Object.defineProperty(t,"ViewMode",{enumerable:!0,get:function(){return Ce.ViewMode}}),Object.defineProperty(t,"MeasureDistanceMode",{enumerable:!0,get:function(){return be.MeasureDistanceMode}}),Object.defineProperty(t,"MeasureAreaMode",{enumerable:!0,get:function(){return Ye.MeasureAreaMode}}),Object.defineProperty(t,"MeasureAngleMode",{enumerable:!0,get:function(){return tt.MeasureAngleMode}}),Object.defineProperty(t,"CompositeMode",{enumerable:!0,get:function(){return pt.CompositeMode}}),Object.defineProperty(t,"SnappableMode",{enumerable:!0,get:function(){return Ee.SnappableMode}}),Object.defineProperty(t,"_memoize",{enumerable:!0,get:function(){return Ne.default}}),t.utils=void 0;var n=So,r=B1,i=eR,o=N1,a=WE,s=qE,u=iR,d=oR,g=sR,_=yR,E=vR,P=xR,R=bR,B=wR,V=j1,z=ER,F=SR,k=TR,X=CR,Y=PR,J=IR,ie=MR,ce=OR,re=RR,ue=LR,se=BR,me=Rc,Ce=NR,be=FR,Ye=kR,tt=zR,pt=t2,Ee=UR,Ne=Ct(N6),Be=ct(Ai);t.utils=Be;function qe(){if(typeof WeakMap!="function")return null;var Dt=new WeakMap;return qe=function(){return Dt},Dt}function ct(Dt){if(Dt&&Dt.__esModule)return Dt;if(Dt===null||e(Dt)!=="object"&&typeof Dt!="function")return{default:Dt};var In=qe();if(In&&In.has(Dt))return In.get(Dt);var Mn={},Tn=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Nt in Dt)if(Object.prototype.hasOwnProperty.call(Dt,Nt)){var Zt=Tn?Object.getOwnPropertyDescriptor(Dt,Nt):null;Zt&&(Zt.get||Zt.set)?Object.defineProperty(Mn,Nt,Zt):Mn[Nt]=Dt[Nt]}return Mn.default=Dt,In&&In.set(Dt,Mn),Mn}function Ct(Dt){return Dt&&Dt.__esModule?Dt:{default:Dt}}})(Hp);var qie={},Hm={};Object.defineProperty(Hm,"__esModule",{value:!0});Hm.MAX_ARROWS=Hm.DEFAULT_ARROWS=Hm.ArrowStyles=void 0;var u4e={NONE:0,FORWARD:1,BACKWARD:2,BOTH:3};Hm.ArrowStyles=u4e;var c4e=1;Hm.DEFAULT_ARROWS=c4e;var f4e=3;Hm.MAX_ARROWS=f4e;var GR={};const h4e=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  
    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  
  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(curr, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,d4e=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,YI=[0,0,0,255],p4e={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:YI},getTargetColor:{type:"accessor",value:YI},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class jR extends nl{constructor(...e){super(...e),q(this,"state",void 0)}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:h4e,fs:d4e,modules:[Mc,Oc]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:YI},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:YI},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e;if(i.extensionsChanged||i.propsChanged&&n.numSegments!==r.numSegments){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:r,widthMinPixels:i,widthMaxPixels:o,greatCircle:a,wrapLongitude:s}=this.props;this.state.model.setUniforms(e).setUniforms({greatCircle:a,widthUnits:Bu[n],widthScale:r,widthMinPixels:i,widthMaxPixels:o,useShortestPath:s}).draw()}_getModel(e){const{id:n,numSegments:r}=this.props;let i=[];for(let a=0;a<r;a++)i=i.concat([a,1,0,a,-1,0]);const o=new Oa(e,{...this.getShaders(),id:n,geometry:new Cs({drawMode:5,attributes:{positions:new Float32Array(i)}}),isInstanced:!0});return o.setUniforms({numSegments:r}),o}}q(jR,"layerName","ArcLayer");q(jR,"defaultProps",p4e);const g4e=new Uint16Array([0,2,1,0,3,2]),m4e=new Float32Array([0,1,0,0,1,0,1,1]);function A4e(t,e){if(!e)return _4e(t);const n=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),r=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),i=Math.ceil(n/e)+1,o=Math.ceil(r/e)+1,a=(i-1)*(o-1)*6,s=new Uint32Array(a),u=new Float32Array(i*o*2),d=new Float64Array(i*o*3);let g=0,_=0;for(let E=0;E<i;E++){const P=E/(i-1);for(let R=0;R<o;R++){const B=R/(o-1),V=y4e(t,P,B);d[g*3+0]=V[0],d[g*3+1]=V[1],d[g*3+2]=V[2]||0,u[g*2+0]=P,u[g*2+1]=1-B,E>0&&R>0&&(s[_++]=g-o,s[_++]=g-o-1,s[_++]=g-1,s[_++]=g-o,s[_++]=g-1,s[_++]=g),g++}}return{vertexCount:a,positions:d,indices:s,texCoords:u}}function _4e(t){const e=new Float64Array(12);for(let n=0;n<t.length;n++)e[n*3+0]=t[n][0],e[n*3+1]=t[n][1],e[n*3+2]=t[n][2]||0;return{vertexCount:6,positions:e,indices:g4e,texCoords:m4e}}function y4e(t,e,n){return pc(pc(t[0],t[1],n),pc(t[3],t[2],n),e)}const v4e=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,x4e=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,b4e=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat(x4e,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive && !picking_uAttribute) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`),w4e={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Br.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0}};class VR extends nl{constructor(...e){super(...e),q(this,"state",void 0)}getShaders(){return super.getShaders({vs:v4e,fs:b4e,modules:[Mc,Oc]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const n=!0;e.add({indices:{size:1,isIndexed:!0,update:r=>r.value=this.state.mesh.indices,noAlloc:n},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:r=>r.value=this.state.mesh.positions,noAlloc:n},texCoords:{size:2,update:r=>r.value=this.state.mesh.texCoords,noAlloc:n}})}updateState({props:e,oldProps:n,changeFlags:r}){const i=this.getAttributeManager();if(r.extensionsChanged){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),i.invalidateAll()}if(e.bounds!==n.bounds){const a=this.state.mesh,s=this._createMesh();this.state.model.setVertexCount(s.vertexCount);for(const u in s)a&&a[u]!==s[u]&&i.invalidate(u);this.setState({mesh:s,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==n._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:n}=this.props,r=e.info;if(!r.color||!n)return r.bitmap=null,r;const{width:i,height:o}=n;r.index=0;const a=E4e(r.color),s=[Math.floor(a[0]*i),Math.floor(a[1]*o)];return r.bitmap={size:{width:i,height:o},uv:a,pixel:s},r}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let n=e;return AW(e)&&(n=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),A4e(n,this.context.viewport.resolution)}_getModel(e){return e?new Oa(e,{...this.getShaders(),id:this.props.id,geometry:new Cs({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(e){const{uniforms:n,moduleParameters:r}=e,{model:i,coordinateConversion:o,bounds:a,disablePicking:s}=this.state,{image:u,desaturate:d,transparentColor:g,tintColor:_}=this.props;r.pickingActive&&s||u&&i&&i.setUniforms(n).setUniforms({bitmapTexture:u,desaturate:d,transparentColor:g.map(E=>E/255),tintColor:_.slice(0,3).map(E=>E/255),coordinateConversion:o,bounds:a}).draw()}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:n,DEFAULT:r}=Br;let{_imageCoordinateSystem:i}=this.props;if(i!==r){const{bounds:o}=this.props;if(!AW(o))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const a=this.context.viewport.resolution?e:n;if(i=i===e?e:n,i===e&&a===n)return{coordinateConversion:-1,bounds:o};if(i===n&&a===e){const s=El([o[0],o[1]]),u=El([o[2],o[3]]);return{coordinateConversion:1,bounds:[s[0],s[1],u[0],u[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}q(VR,"layerName","BitmapLayer");q(VR,"defaultProps",w4e);function E4e(t){const[e,n,r]=t,i=(r&240)/256,o=(r&15)/16;return[(e+o)/256,(n+i)/256]}function AW(t){return Number.isFinite(t[0])}const S4e=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,T4e=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,C4e=1024,P4e=4,_W=()=>{},yW={10241:9987,10240:9729,10242:33071,10243:33071};function I4e(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function M4e(t,e,n,r){const i=Math.min(n/e.width,r/e.height),o=Math.floor(e.width*i),a=Math.floor(e.height*i);return i===1?{data:e,width:o,height:a}:(t.canvas.height=a,t.canvas.width=o,t.clearRect(0,0,o,a),t.drawImage(e,0,0,e.width,e.height,0,0,o,a),{data:t.canvas,width:o,height:a})}function rE(t){return t&&(t.id||t.url)}function O4e(t,e,n,r){const i=t.width,o=t.height,a=new Pl(t.gl,{width:e,height:n,parameters:r});return ete(t,a,{targetY:0,width:i,height:o}),t.delete(),a}function vW(t,e,n){for(let r=0;r<e.length;r++){const{icon:i,xOffset:o}=e[r],a=rE(i);t[a]={...i,x:o,y:n}}}function R4e({icons:t,buffer:e,mapping:n={},xOffset:r=0,yOffset:i=0,rowHeight:o=0,canvasWidth:a}){let s=[];for(let u=0;u<t.length;u++){const d=t[u],g=rE(d);if(!n[g]){const{height:_,width:E}=d;r+E+e>a&&(vW(n,s,i),r=0,i=o+i+e,o=0,s=[]),s.push({icon:d,xOffset:r}),r=r+E+e,o=Math.max(o,_)}}return s.length>0&&vW(n,s,i),{mapping:n,rowHeight:o,xOffset:r,yOffset:i,canvasWidth:a,canvasHeight:I4e(o+i+e)}}function L4e(t,e,n){if(!t||!e)return null;n=n||{};const r={},{iterable:i,objectInfo:o}=Tg(t);for(const a of i){o.index++;const s=e(a,o),u=rE(s);if(!s)throw new Error("Icon is missing.");if(!s.url)throw new Error("Icon url is missing.");!r[u]&&(!n[u]||s.url!==n[u].url)&&(r[u]={...s,source:a,sourceIndex:o.index})}return r}class D4e{constructor(e,{onUpdate:n=_W,onError:r=_W}){q(this,"gl",void 0),q(this,"onUpdate",void 0),q(this,"onError",void 0),q(this,"_loadOptions",null),q(this,"_texture",null),q(this,"_externalTexture",null),q(this,"_mapping",{}),q(this,"_textureParameters",null),q(this,"_pendingCount",0),q(this,"_autoPacking",!1),q(this,"_xOffset",0),q(this,"_yOffset",0),q(this,"_rowHeight",0),q(this,"_buffer",P4e),q(this,"_canvasWidth",C4e),q(this,"_canvasHeight",0),q(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=r}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?rE(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:r,iconMapping:i,textureParameters:o}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),i&&(this._mapping=i),r){var a;(a=this._texture)===null||a===void 0||a.delete(),this._texture=null,this._externalTexture=r}o&&(this._textureParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(L4e(e,n,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:o,yOffset:a,rowHeight:s,canvasHeight:u}=R4e({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=s,this._mapping=i,this._xOffset=o,this._yOffset=a,this._canvasHeight=u,this._texture||(this._texture=new Pl(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||yW})),this._texture.height!==this._canvasHeight&&(this._texture=O4e(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||yW)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,ag(r.url,this._loadOptions).then(i=>{const o=rE(r),a=this._mapping[o],{x:s,y:u,width:d,height:g}=a,{data:_,width:E,height:P}=M4e(n,i,d,g);this._texture.setSubImageData({data:_,x:s+(d-E)/2,y:u+(g-P)/2,width:E,height:P}),a.width=E,a.height=P,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const Xie=[0,0,0,255],B4e={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:Xie},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class r2 extends nl{constructor(...e){super(...e),q(this,"state",void 0)}getShaders(){return super.getShaders({vs:S4e,fs:T4e,modules:[Mc,Oc]})}initializeState(){this.state={iconManager:new D4e(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:Xie},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e,o=this.getAttributeManager(),{iconAtlas:a,iconMapping:s,data:u,getIcon:d,textureParameters:g}=n,{iconManager:_}=this.state,E=a||this.internalState.isAsyncPropLoading("iconAtlas");if(_.setProps({loadOptions:n.loadOptions,autoPacking:!E,iconAtlas:a,iconMapping:E?s:null,textureParameters:g}),E?r.iconMapping!==n.iconMapping&&o.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&_.packIcons(u,d),i.extensionsChanged){var P;const{gl:R}=this.context;(P=this.state.model)===null||P===void 0||P.delete(),this.state.model=this._getModel(R),o.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:o,billboard:a,alphaCutoff:s}=this.props,{iconManager:u}=this.state,d=u.getTexture();d&&this.state.model.setUniforms(e).setUniforms({iconsTexture:d,iconsTextureDim:[d.width,d.height],sizeUnits:Bu[o],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,billboard:a,alphaCutoff:s}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new Oa(e,{...this.getShaders(),id:this.props.id,geometry:new Cs({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const r=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;r?r(e):Or.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:r,anchorX:i=n/2,anchorY:o=r/2}=this.state.iconManager.getIconMapping(e);return[n/2-i,r/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:r,width:i,height:o}=this.state.iconManager.getIconMapping(e);return[n,r,i,o]}}q(r2,"defaultProps",B4e);q(r2,"layerName","IconLayer");const N4e=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      gl_Position = vec4(0.);
      return;
    }
  }
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(p, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,F4e=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,k4e=[0,0,0,255],z4e={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:k4e},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class k6 extends nl{getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:N4e,fs:F4e,modules:[Mc,Oc]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:r}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:r,widthMinPixels:i,widthMaxPixels:o,wrapLongitude:a}=this.props;this.state.model.setUniforms(e).setUniforms({widthUnits:Bu[n],widthScale:r,widthMinPixels:i,widthMaxPixels:o,useShortestPath:a?1:0}).draw(),a&&this.state.model.setUniforms({useShortestPath:-1}).draw()}_getModel(e){const n=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Oa(e,{...this.getShaders(),id:this.props.id,geometry:new Cs({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}q(k6,"layerName","LineLayer");q(k6,"defaultProps",z4e);const U4e=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,G4e=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Zie=[0,0,0,255],Yie=[0,0,1],j4e={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:Yie},getColor:{type:"accessor",value:Zie},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function V4e(t){const{header:e,attributes:n}=t;!e||!n||(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}class $R extends nl{getShaders(){return super.getShaders({vs:U4e,fs:G4e,modules:[Mc,DE,Oc]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:Yie},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:Zie}})}updateState(e){const{changeFlags:n,props:r}=e;if(super.updateState(e),n.extensionsChanged){var i;const{gl:o}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}n.dataChanged&&V4e(r.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:r}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:Bu[r],radiusPixels:n}).draw()}_getModel(e){const n=[];for(let r=0;r<3;r++){const i=r/3*Math.PI*2;n.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new Oa(e,{...this.getShaders(),id:this.props.id,geometry:new Cs({drawMode:4,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}q($R,"layerName","PointCloudLayer");q($R,"defaultProps",j4e);const $4e=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,H4e=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (!filled) {
    discard;
  } else {
    gl_FragColor = vFillColor;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,xW=[0,0,0,255],W4e={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:xW},getLineColor:{type:"accessor",value:xW},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class HR extends nl{getShaders(){return super.getShaders({vs:$4e,fs:H4e,modules:[Mc,Oc]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:r}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:o,stroked:a,filled:s,billboard:u,antialiasing:d,lineWidthUnits:g,lineWidthScale:_,lineWidthMinPixels:E,lineWidthMaxPixels:P}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:a?1:0,filled:s,billboard:u,antialiasing:d,radiusUnits:Bu[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:o,lineWidthUnits:Bu[g],lineWidthScale:_,lineWidthMinPixels:E,lineWidthMaxPixels:P}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Oa(e,{...this.getShaders(),id:this.props.id,geometry:new Cs({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}q(HR,"defaultProps",W4e);q(HR,"layerName","ScatterplotLayer");const z6={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function U6(t,e,n={}){return q4e(t,n)!==e?(X4e(t,n),!0):!1}function q4e(t,e={}){return Math.sign(QI(t,e))}function QI(t,e={}){const{start:n=0,end:r=t.length}=e,i=e.size||2;let o=0;for(let a=n,s=r-i;a<r;a+=i)o+=(t[a]-t[s])*(t[a+1]+t[s+1]),s=a;return o/2}function X4e(t,e){const{start:n=0,end:r=t.length,size:i=2}=e,o=(r-n)/i,a=Math.floor(o/2);for(let s=0;s<a;++s){const u=n+s*i,d=n+(o-1-s)*i;for(let g=0;g<i;++g){const _=t[u+g];t[u+g]=t[d+g],t[d+g]=_}}}function Z4e(t,e,n=2,r){const i=e&&e.length,o=i?e[0]*n:t.length;let a=Qie(t,0,o,n,!0,r&&r[0]);const s=[];if(!a||a.next===a.prev)return s;let u,d,g,_,E,P,R;if(i&&(a=eze(t,e,a,n,r)),t.length>80*n){_=d=t[0],E=g=t[1];for(let B=n;B<o;B+=n)P=t[B],R=t[B+1],P<_&&(_=P),R<E&&(E=R),P>d&&(d=P),R>g&&(g=R);u=Math.max(d-_,g-E),u=u!==0?1/u:0}return iE(a,s,n,_,E,u),s}function Qie(t,e,n,r,i,o){let a,s;if(o===void 0&&(o=QI(t,{start:e,end:n,size:r})),i===o<0)for(a=e;a<n;a+=r)s=bW(a,t[a],t[a+1],s);else for(a=n-r;a>=e;a-=r)s=bW(a,t[a],t[a+1],s);return s&&WR(s,s.next)&&(sE(s),s=s.next),s}function lA(t,e){if(!t)return t;e||(e=t);let n=t,r;do if(r=!1,!n.steiner&&(WR(n,n.next)||ns(n.prev,n,n.next)===0)){if(sE(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function iE(t,e,n,r,i,o,a){if(!t)return;!a&&o&&oze(t,r,i,o);let s=t,u,d;for(;t.prev!==t.next;){if(u=t.prev,d=t.next,o?Q4e(t,r,i,o):Y4e(t)){e.push(u.i/n),e.push(t.i/n),e.push(d.i/n),sE(t),t=d.next,s=d.next;continue}if(t=d,t===s){a?a===1?(t=K4e(lA(t),e,n),iE(t,e,n,r,i,o,2)):a===2&&J4e(t,e,n,r,i,o):iE(lA(t),e,n,r,i,o,1);break}}}function Y4e(t){const e=t.prev,n=t,r=t.next;if(ns(e,n,r)>=0)return!1;let i=t.next.next;for(;i!==t.prev;){if(rv(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&ns(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Q4e(t,e,n,r){const i=t.prev,o=t,a=t.next;if(ns(i,o,a)>=0)return!1;const s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,d=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,g=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,_=l4(s,u,e,n,r),E=l4(d,g,e,n,r);let P=t.prevZ,R=t.nextZ;for(;P&&P.z>=_&&R&&R.z<=E;){if(P!==t.prev&&P!==t.next&&rv(i.x,i.y,o.x,o.y,a.x,a.y,P.x,P.y)&&ns(P.prev,P,P.next)>=0||(P=P.prevZ,R!==t.prev&&R!==t.next&&rv(i.x,i.y,o.x,o.y,a.x,a.y,R.x,R.y)&&ns(R.prev,R,R.next)>=0))return!1;R=R.nextZ}for(;P&&P.z>=_;){if(P!==t.prev&&P!==t.next&&rv(i.x,i.y,o.x,o.y,a.x,a.y,P.x,P.y)&&ns(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;R&&R.z<=E;){if(R!==t.prev&&R!==t.next&&rv(i.x,i.y,o.x,o.y,a.x,a.y,R.x,R.y)&&ns(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function K4e(t,e,n){let r=t;do{const i=r.prev,o=r.next.next;!WR(i,o)&&Kie(i,r,r.next,o)&&oE(i,o)&&oE(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),sE(r),sE(r.next),r=t=o),r=r.next}while(r!==t);return lA(r)}function J4e(t,e,n,r,i,o){let a=t;do{let s=a.next.next;for(;s!==a.prev;){if(a.i!==s.i&&lze(a,s)){let u=Jie(a,s);a=lA(a,a.next),u=lA(u,u.next),iE(a,e,n,r,i,o),iE(u,e,n,r,i,o);return}s=s.next}a=a.next}while(a!==t)}function eze(t,e,n,r,i){const o=[];let a,s,u,d,g;for(a=0,s=e.length;a<s;a++)u=e[a]*r,d=a<s-1?e[a+1]*r:t.length,g=Qie(t,u,d,r,!1,i&&i[a+1]),g===g.next&&(g.steiner=!0),o.push(aze(g));for(o.sort(tze),a=0;a<o.length;a++)nze(o[a],n),n=lA(n,n.next);return n}function tze(t,e){return t.x-e.x}function nze(t,e){if(e=rze(t,e),e){const n=Jie(e,t);lA(e,e.next),lA(n,n.next)}}function rze(t,e){let n=e;const r=t.x,i=t.y;let o=-1/0,a;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const E=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(E<=r&&E>o){if(o=E,E===r){if(i===n.y)return n;if(i===n.next.y)return n.next}a=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!a)return null;if(r===o)return a;const s=a,u=a.x,d=a.y;let g=1/0,_;n=a;do r>=n.x&&n.x>=u&&r!==n.x&&rv(i<d?r:o,i,u,d,i<d?o:r,i,n.x,n.y)&&(_=Math.abs(i-n.y)/(r-n.x),oE(n,t)&&(_<g||_===g&&(n.x>a.x||n.x===a.x&&ize(a,n)))&&(a=n,g=_)),n=n.next;while(n!==s);return a}function ize(t,e){return ns(t.prev,t,e.prev)<0&&ns(e.next,t,t.next)<0}function oze(t,e,n,r){let i=t;do i.z===null&&(i.z=l4(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,sze(i)}function sze(t){let e,n,r=1,i,o,a,s,u,d;do{for(o=t,t=null,d=null,i=0;o;){for(i++,s=o,a=0,n=0;n<r&&(a++,s=s.nextZ,!!s);n++);for(u=r;a>0||u>0&&s;)a!==0&&(u===0||!s||o.z<=s.z)?(e=o,o=o.nextZ,a--):(e=s,s=s.nextZ,u--),d?d.nextZ=e:t=e,e.prevZ=d,d=e;o=s}d.nextZ=null,r*=2}while(i>1);return t}function l4(t,e,n,r,i){return t=32767*(t-n)*i,e=32767*(e-r)*i,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function aze(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function rv(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function lze(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!uze(t,e)&&(oE(t,e)&&oE(e,t)&&cze(t,e)&&(ns(t.prev,t,e.prev)||ns(t,e.prev,e))||WR(t,e)&&ns(t.prev,t,t.next)>0&&ns(e.prev,e,e.next)>0)}function ns(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function WR(t,e){return t.x===e.x&&t.y===e.y}function Kie(t,e,n,r){const i=YS(ns(t,e,n)),o=YS(ns(t,e,r)),a=YS(ns(n,r,t)),s=YS(ns(n,r,e));return!!(i!==o&&a!==s||i===0&&ZS(t,n,e)||o===0&&ZS(t,r,e)||a===0&&ZS(n,t,r)||s===0&&ZS(n,e,r))}function ZS(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function YS(t){return t>0?1:t<0?-1:0}function uze(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Kie(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function oE(t,e){return ns(t.prev,t,t.next)<0?ns(t,e,t.next)>=0&&ns(t,t.prev,e)>=0:ns(t,e,t.prev)<0||ns(t,t.next,e)<0}function cze(t,e){let n=t,r=!1;const i=(t.x+e.x)/2,o=(t.y+e.y)/2;do n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function Jie(t,e){const n=new u4(t.i,t.x,t.y),r=new u4(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function bW(t,e,n,r){const i=new u4(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function sE(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function u4(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gh(t,e){const n=e.length,r=t.length;if(r>0){let i=!0;for(let o=0;o<n;o++)if(t[r-n+o]!==e[o]){i=!1;break}if(i)return!1}for(let i=0;i<n;i++)t[r+i]=e[i];return!0}function c4(t,e){const n=e.length;for(let r=0;r<n;r++)t[r]=e[r]}function aE(t,e,n,r,i=[]){const o=r+e*n;for(let a=0;a<n;a++)i[a]=t[o+a];return i}function f4(t,e,n,r,i=[]){let o,a;if(n&8)o=(r[3]-t[1])/(e[1]-t[1]),a=3;else if(n&4)o=(r[1]-t[1])/(e[1]-t[1]),a=1;else if(n&2)o=(r[2]-t[0])/(e[0]-t[0]),a=2;else if(n&1)o=(r[0]-t[0])/(e[0]-t[0]),a=0;else return null;for(let s=0;s<t.length;s++)i[s]=(a&1)===s?r[a]:o*(e[s]-t[s])+t[s];return i}function tP(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function eoe(t,e){const{size:n=2,broken:r=!1,gridResolution:i=10,gridOffset:o=[0,0],startIndex:a=0,endIndex:s=t.length}=e||{},u=(s-a)/n;let d=[];const g=[d],_=aE(t,0,n,a);let E,P;const R=noe(_,i,o,[]),B=[];gh(d,_);for(let V=1;V<u;V++){for(E=aE(t,V,n,a,E),P=tP(E,R);P;){f4(_,E,P,R,B);const z=tP(B,R);z&&(f4(_,B,z,R,B),P=z),gh(d,B),c4(_,B),hze(R,i,P),r&&d.length>n&&(d=[],g.push(d),gh(d,_)),P=tP(E,R)}gh(d,E),c4(_,E)}return r?g:g[0]}const wW=0,fze=1;function QS(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function toe(t,e=null,n){if(!t.length)return[];const{size:r=2,gridResolution:i=10,gridOffset:o=[0,0],edgeTypes:a=!1}=n||{},s=[],u=[{pos:t,types:a?new Array(t.length/r).fill(fze):null,holes:e||[]}],d=[[],[]];let g=[];for(;u.length;){const{pos:_,types:E,holes:P}=u.shift();dze(_,r,P[0]||_.length,d),g=noe(d[0],i,o,g);const R=tP(d[1],g);if(R){let B=EW(_,E,r,0,P[0]||_.length,g,R);const V={pos:B[0].pos,types:B[0].types,holes:[]},z={pos:B[1].pos,types:B[1].types,holes:[]};u.push(V,z);for(let F=0;F<P.length;F++)B=EW(_,E,r,P[F],P[F+1]||_.length,g,R),B[0]&&(V.holes.push(V.pos.length),V.pos=QS(V.pos,B[0].pos),a&&(V.types=QS(V.types,B[0].types))),B[1]&&(z.holes.push(z.pos.length),z.pos=QS(z.pos,B[1].pos),a&&(z.types=QS(z.types,B[1].types)))}else{const B={positions:_};a&&(B.edgeTypes=E),P.length&&(B.holeIndices=P),s.push(B)}}return s}function EW(t,e,n,r,i,o,a){const s=(i-r)/n,u=[],d=[],g=[],_=[],E=[];let P,R,B;const V=aE(t,s-1,n,r);let z=Math.sign(a&8?V[1]-o[3]:V[0]-o[2]),F=e&&e[s-1],k=0,X=0;for(let Y=0;Y<s;Y++)P=aE(t,Y,n,r,P),R=Math.sign(a&8?P[1]-o[3]:P[0]-o[2]),B=e&&e[r/n+Y],R&&z&&z!==R&&(f4(V,P,a,o,E),gh(u,E)&&g.push(F),gh(d,E)&&_.push(F)),R<=0?(gh(u,P)&&g.push(B),k-=R):g.length&&(g[g.length-1]=wW),R>=0?(gh(d,P)&&_.push(B),X+=R):_.length&&(_[_.length-1]=wW),c4(V,P),z=R,F=B;return[k?{pos:u,types:e&&g}:null,X?{pos:d,types:e&&_}:null]}function noe(t,e,n,r){const i=Math.floor((t[0]-n[0])/e)*e+n[0],o=Math.floor((t[1]-n[1])/e)*e+n[1];return r[0]=i,r[1]=o,r[2]=i+e,r[3]=o+e,r}function hze(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function dze(t,e,n,r){let i=1/0,o=-1/0,a=1/0,s=-1/0;for(let u=0;u<n;u+=e){const d=t[u],g=t[u+1];i=d<i?d:i,o=d>o?d:o,a=g<a?g:a,s=g>s?g:s}return r[0][0]=i,r[0][1]=a,r[1][0]=o,r[1][1]=s,r}const pze=85.051129;function gze(t,e){const{size:n=2,startIndex:r=0,endIndex:i=t.length,normalize:o=!0}=e||{},a=t.slice(r,i);roe(a,n,0,i-r);const s=eoe(a,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const u of s)ioe(u,n);return s}function mze(t,e=null,n){const{size:r=2,normalize:i=!0,edgeTypes:o=!1}=n||{};e=e||[];const a=[],s=[];let u=0,d=0;for(let _=0;_<=e.length;_++){const E=e[_]||t.length,P=d,R=Aze(t,r,u,E);for(let B=R;B<E;B++)a[d++]=t[B];for(let B=u;B<R;B++)a[d++]=t[B];roe(a,r,P,d),_ze(a,r,P,d,n==null?void 0:n.maxLatitude),u=E,s[_]=d}s.pop();const g=toe(a,s,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(i)for(const _ of g)ioe(_.positions,r);return g}function Aze(t,e,n,r){let i=-1,o=-1;for(let a=n+1;a<r;a+=e){const s=Math.abs(t[a]);s>i&&(i=s,o=a-1)}return o}function _ze(t,e,n,r,i=pze){const o=t[n],a=t[r-e];if(Math.abs(o-a)>180){const s=aE(t,0,e,n);s[0]+=Math.round((a-o)/360)*360,gh(t,s),s[1]=Math.sign(s[1])*i,gh(t,s),s[0]=o,gh(t,s)}}function roe(t,e,n,r){let i=t[0],o;for(let a=n;a<r;a+=e){o=t[a];const s=o-i;(s>180||s<-180)&&(o-=Math.round(s/360)*360),t[a]=i=o}}function ioe(t,e){let n;const r=t.length/e;for(let o=0;o<r&&(n=t[o*e],(n+180)%360===0);o++);const i=-Math.round(n/360)*360;if(i!==0)for(let o=0;o<r;o++)t[o*e]+=i}class yze extends Cs{constructor(e){const{id:n=Ma("column-geometry")}=e,{indices:r,attributes:i}=vze(e);super({...e,id:n,indices:r,attributes:i})}}function vze(t){const{radius:e,height:n=1,nradial:r=10}=t;let{vertices:i}=t;i&&(Or.assert(i.length>=r),i=i.flatMap(P=>[P[0],P[1]]),U6(i,z6.COUNTER_CLOCKWISE));const o=n>0,a=r+1,s=o?a*3+1:r,u=Math.PI*2/r,d=new Uint16Array(o?r*3*2:0),g=new Float32Array(s*3),_=new Float32Array(s*3);let E=0;if(o){for(let P=0;P<a;P++){const R=P*u,B=P%r,V=Math.sin(R),z=Math.cos(R);for(let F=0;F<2;F++)g[E+0]=i?i[B*2]:z*e,g[E+1]=i?i[B*2+1]:V*e,g[E+2]=(1/2-F)*n,_[E+0]=i?i[B*2]:z,_[E+1]=i?i[B*2+1]:V,E+=3}g[E+0]=g[E-3],g[E+1]=g[E-2],g[E+2]=g[E-1],E+=3}for(let P=o?0:1;P<a;P++){const R=Math.floor(P/2)*Math.sign(.5-P%2),B=R*u,V=(R+r)%r,z=Math.sin(B),F=Math.cos(B);g[E+0]=i?i[V*2]:F*e,g[E+1]=i?i[V*2+1]:z*e,g[E+2]=n/2,_[E+2]=1,E+=3}if(o){let P=0;for(let R=0;R<r;R++)d[P++]=R*2+0,d[P++]=R*2+2,d[P++]=R*2+0,d[P++]=R*2+1,d[P++]=R*2+1,d[P++]=R*2+3}return{indices:d,attributes:{POSITION:{size:3,value:g},NORMAL:{size:3,value:_}}}}const xze=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
  float elevation = 0.0;
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,bze=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,KI=[0,0,0,255],wze={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:KI},getLineColor:{type:"accessor",value:KI},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class i2 extends nl{getShaders(){const{gl:e}=this.context,n=!Hr(e),r={},i=this.props.flatShading&&RE(e,Qi.GLSL_DERIVATIVES);return i&&(r.FLAT_SHADING=1),super.getShaders({vs:xze,fs:bze,defines:r,transpileToGLSL100:n,modules:[Mc,i?kO:DE,Oc]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:KI},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:KI},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e,o=i.extensionsChanged||n.flatShading!==r.flatShading;if(o){var a;const{gl:s}=this.context;(a=this.state.model)===null||a===void 0||a.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}(o||n.diskResolution!==r.diskResolution||n.vertices!==r.vertices||(n.extruded||n.stroked)!==(r.extruded||r.stroked))&&this._updateGeometry(n)}getGeometry(e,n,r){const i=new yze({radius:1,height:r?2:0,vertices:n,nradial:e});let o=0;if(n)for(let a=0;a<e;a++){const s=n[a],u=Math.sqrt(s[0]*s[0]+s[1]*s[1]);o+=u/e}else o=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*o}),i}_getModel(e){return new Oa(e,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:e,vertices:n,extruded:r,stroked:i}){const o=this.getGeometry(e,n,r||i);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3,wireframeVertexCount:o.indices.value.length}),this.state.model.setProps({geometry:o})}draw({uniforms:e}){const{lineWidthUnits:n,lineWidthScale:r,lineWidthMinPixels:i,lineWidthMaxPixels:o,radiusUnits:a,elevationScale:s,extruded:u,filled:d,stroked:g,wireframe:_,offset:E,coverage:P,radius:R,angle:B}=this.props,{model:V,fillVertexCount:z,wireframeVertexCount:F,edgeDistance:k}=this.state;V.setUniforms(e).setUniforms({radius:R,angle:B/180*Math.PI,offset:E,extruded:u,stroked:g,coverage:P,elevationScale:s,edgeDistance:k,radiusUnits:Bu[a],widthUnits:Bu[n],widthScale:r,widthMinPixels:i,widthMaxPixels:o}),u&&_&&(V.setProps({isIndexed:!0}),V.setVertexCount(F).setDrawMode(1).setUniforms({isStroke:!0}).draw()),d&&(V.setProps({isIndexed:!1}),V.setVertexCount(z).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!u&&g&&(V.setProps({isIndexed:!1}),V.setVertexCount(z*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}q(i2,"layerName","ColumnLayer");q(i2,"defaultProps",wze);const Eze={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};class G6 extends i2{getGeometry(e){return new qte}draw({uniforms:e}){const{elevationScale:n,extruded:r,offset:i,coverage:o,cellSize:a,angle:s,radiusUnits:u}=this.props;this.state.model.setUniforms(e).setUniforms({radius:a/2,radiusUnits:Bu[u],angle:s,offset:i,extruded:r,coverage:o,elevationScale:n,edgeDistance:1,isWireframe:!1}).draw()}}q(G6,"layerName","GridCellLayer");q(G6,"defaultProps",Eze);function Sze(t,e,n,r){let i;if(Array.isArray(t[0])){const o=t.length*e;i=new Array(o);for(let a=0;a<t.length;a++)for(let s=0;s<e;s++)i[a*e+s]=t[a][s]||0}else i=t;return n?eoe(i,{size:e,gridResolution:n}):r?gze(i,{size:e}):i}const Tze=1,Cze=2,yB=4;class Pze extends q5{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?Sze(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(SW(e)){let r=0;for(const i of e)r+=this.getGeometrySize(i);return r}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&SW(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const r=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:o,geometrySize:a}=n;r.fill(0,o,o+a),i?(r[o]=yB,r[o+a-2]=yB):(r[o]+=Tze,r[o+a-2]+=Cze),r[o+a-1]=yB}_updatePositions(e,n){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:i,geometrySize:o}=n,a=new Array(3);for(let s=i,u=0;u<o;s++,u++)this.getPointOnPath(e,u,a),r[s*3]=a[0],r[s*3+1]=a[1],r[s*3+2]=a[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,r=[]){const{positionSize:i}=this;n*i>=e.length&&(n+=1-e.length/i);const o=n*i;return r[0]=e[o],r[1]=e[o+1],r[2]=i===3&&e[o+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,r=e.length-n;return e[0]===e[r]&&e[1]===e[r+1]&&(n===2||e[2]===e[r+2])}}function SW(t){return Array.isArray(t[0])}const Ize=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Mze=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,ooe=[0,0,0,255],Oze={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:ooe},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},vB={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class V1 extends nl{constructor(...e){super(...e),q(this,"state",void 0)}getShaders(){return super.getShaders({vs:Ize,fs:Mze,modules:[Mc,Oc]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:vB,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:vB,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:vB,defaultValue:ooe},instancePickingColors:{size:3,type:5121,accessor:(r,{index:i,target:o})=>this.encodePickingColor(r&&r.__source?r.__source.index:i,o)}}),this.setState({pathTesselator:new Pze({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:s}=this.state,u=n.data.attributes||{};s.updateGeometry({data:n.data,geometryBuffer:u.getPath,buffers:u,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),r.dataChanged||i.invalidateAll()}if(r.extensionsChanged){var a;const{gl:s}=this.context;(a=this.state.model)===null||a===void 0||a.delete(),this.state.model=this._getModel(s),i.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,{data:i}=this.props;return i[0]&&i[0].__source&&(n.object=i.find(o=>o.__source.index===r)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:r,billboard:i,miterLimit:o,widthUnits:a,widthScale:s,widthMinPixels:u,widthMaxPixels:d}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(r),billboard:i,widthUnits:Bu[a],widthScale:s,miterLimit:o,widthMinPixels:u,widthMaxPixels:d}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Oa(e,{...this.getShaders(),id:this.props.id,geometry:new Cs({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}q(V1,"defaultProps",Oze);q(V1,"layerName","PathLayer");var j6={exports:{}};j6.exports=qR;j6.exports.default=qR;function qR(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,o=soe(t,0,i,n,!0),a=[];if(!o||o.next===o.prev)return a;var s,u,d,g,_,E,P;if(r&&(o=Nze(t,e,o,n)),t.length>80*n){s=d=t[0],u=g=t[1];for(var R=n;R<i;R+=n)_=t[R],E=t[R+1],_<s&&(s=_),E<u&&(u=E),_>d&&(d=_),E>g&&(g=E);P=Math.max(d-s,g-u),P=P!==0?32767/P:0}return lE(o,a,n,s,u,P,0),a}function soe(t,e,n,r,i){var o,a;if(i===p4(t,e,n,r)>0)for(o=e;o<n;o+=r)a=TW(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=TW(o,t[o],t[o+1],a);return a&&XR(a,a.next)&&(cE(a),a=a.next),a}function e_(t,e){if(!t)return t;e||(e=t);var n=t,r;do if(r=!1,!n.steiner&&(XR(n,n.next)||rs(n.prev,n,n.next)===0)){if(cE(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function lE(t,e,n,r,i,o,a){if(t){!a&&o&&Gze(t,r,i,o);for(var s=t,u,d;t.prev!==t.next;){if(u=t.prev,d=t.next,o?Lze(t,r,i,o):Rze(t)){e.push(u.i/n|0),e.push(t.i/n|0),e.push(d.i/n|0),cE(t),t=d.next,s=d.next;continue}if(t=d,t===s){a?a===1?(t=Dze(e_(t),e,n),lE(t,e,n,r,i,o,2)):a===2&&Bze(t,e,n,r,i,o):lE(e_(t),e,n,r,i,o,1);break}}}}function Rze(t){var e=t.prev,n=t,r=t.next;if(rs(e,n,r)>=0)return!1;for(var i=e.x,o=n.x,a=r.x,s=e.y,u=n.y,d=r.y,g=i<o?i<a?i:a:o<a?o:a,_=s<u?s<d?s:d:u<d?u:d,E=i>o?i>a?i:a:o>a?o:a,P=s>u?s>d?s:d:u>d?u:d,R=r.next;R!==e;){if(R.x>=g&&R.x<=E&&R.y>=_&&R.y<=P&&iv(i,s,o,u,a,d,R.x,R.y)&&rs(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function Lze(t,e,n,r){var i=t.prev,o=t,a=t.next;if(rs(i,o,a)>=0)return!1;for(var s=i.x,u=o.x,d=a.x,g=i.y,_=o.y,E=a.y,P=s<u?s<d?s:d:u<d?u:d,R=g<_?g<E?g:E:_<E?_:E,B=s>u?s>d?s:d:u>d?u:d,V=g>_?g>E?g:E:_>E?_:E,z=h4(P,R,e,n,r),F=h4(B,V,e,n,r),k=t.prevZ,X=t.nextZ;k&&k.z>=z&&X&&X.z<=F;){if(k.x>=P&&k.x<=B&&k.y>=R&&k.y<=V&&k!==i&&k!==a&&iv(s,g,u,_,d,E,k.x,k.y)&&rs(k.prev,k,k.next)>=0||(k=k.prevZ,X.x>=P&&X.x<=B&&X.y>=R&&X.y<=V&&X!==i&&X!==a&&iv(s,g,u,_,d,E,X.x,X.y)&&rs(X.prev,X,X.next)>=0))return!1;X=X.nextZ}for(;k&&k.z>=z;){if(k.x>=P&&k.x<=B&&k.y>=R&&k.y<=V&&k!==i&&k!==a&&iv(s,g,u,_,d,E,k.x,k.y)&&rs(k.prev,k,k.next)>=0)return!1;k=k.prevZ}for(;X&&X.z<=F;){if(X.x>=P&&X.x<=B&&X.y>=R&&X.y<=V&&X!==i&&X!==a&&iv(s,g,u,_,d,E,X.x,X.y)&&rs(X.prev,X,X.next)>=0)return!1;X=X.nextZ}return!0}function Dze(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!XR(i,o)&&aoe(i,r,r.next,o)&&uE(i,o)&&uE(o,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(o.i/n|0),cE(r),cE(r.next),r=t=o),r=r.next}while(r!==t);return e_(r)}function Bze(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&$ze(a,s)){var u=loe(a,s);a=e_(a,a.next),u=e_(u,u.next),lE(a,e,n,r,i,o,0),lE(u,e,n,r,i,o,0);return}s=s.next}a=a.next}while(a!==t)}function Nze(t,e,n,r){var i=[],o,a,s,u,d;for(o=0,a=e.length;o<a;o++)s=e[o]*r,u=o<a-1?e[o+1]*r:t.length,d=soe(t,s,u,r,!1),d===d.next&&(d.steiner=!0),i.push(Vze(d));for(i.sort(Fze),o=0;o<i.length;o++)n=kze(i[o],n);return n}function Fze(t,e){return t.x-e.x}function kze(t,e){var n=zze(t,e);if(!n)return e;var r=loe(n,t);return e_(r,r.next),e_(n,n.next)}function zze(t,e){var n=e,r=t.x,i=t.y,o=-1/0,a;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var s=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>o&&(o=s,a=n.x<n.next.x?n:n.next,s===r))return a}n=n.next}while(n!==e);if(!a)return null;var u=a,d=a.x,g=a.y,_=1/0,E;n=a;do r>=n.x&&n.x>=d&&r!==n.x&&iv(i<g?r:o,i,d,g,i<g?o:r,i,n.x,n.y)&&(E=Math.abs(i-n.y)/(r-n.x),uE(n,t)&&(E<_||E===_&&(n.x>a.x||n.x===a.x&&Uze(a,n)))&&(a=n,_=E)),n=n.next;while(n!==u);return a}function Uze(t,e){return rs(t.prev,t,e.prev)<0&&rs(e.next,t,t.next)<0}function Gze(t,e,n,r){var i=t;do i.z===0&&(i.z=h4(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,jze(i)}function jze(t){var e,n,r,i,o,a,s,u,d=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<d&&(s++,r=r.nextZ,!!r);e++);for(u=d;s>0||u>0&&r;)s!==0&&(u===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,d*=2}while(a>1);return t}function h4(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Vze(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function iv(t,e,n,r,i,o,a,s){return(i-a)*(e-s)>=(t-a)*(o-s)&&(t-a)*(r-s)>=(n-a)*(e-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function $ze(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Hze(t,e)&&(uE(t,e)&&uE(e,t)&&Wze(t,e)&&(rs(t.prev,t,e.prev)||rs(t,e.prev,e))||XR(t,e)&&rs(t.prev,t,t.next)>0&&rs(e.prev,e,e.next)>0)}function rs(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function XR(t,e){return t.x===e.x&&t.y===e.y}function aoe(t,e,n,r){var i=JS(rs(t,e,n)),o=JS(rs(t,e,r)),a=JS(rs(n,r,t)),s=JS(rs(n,r,e));return!!(i!==o&&a!==s||i===0&&KS(t,n,e)||o===0&&KS(t,r,e)||a===0&&KS(n,t,r)||s===0&&KS(n,e,r))}function KS(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function JS(t){return t>0?1:t<0?-1:0}function Hze(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&aoe(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function uE(t,e){return rs(t.prev,t,t.next)<0?rs(t,e,t.next)>=0&&rs(t,t.prev,e)>=0:rs(t,e,t.prev)<0||rs(t,t.next,e)<0}function Wze(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function loe(t,e){var n=new d4(t.i,t.x,t.y),r=new d4(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function TW(t,e,n,r){var i=new d4(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function cE(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function d4(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}qR.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(p4(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var d=e[s]*n,g=s<u-1?e[s+1]*n:t.length;a-=Math.abs(p4(t,d,g,n))}var _=0;for(s=0;s<r.length;s+=3){var E=r[s]*n,P=r[s+1]*n,R=r[s+2]*n;_+=Math.abs((t[E]-t[R])*(t[P+1]-t[E+1])-(t[E]-t[P])*(t[R+1]-t[E+1]))}return a===0&&_===0?0:Math.abs((_-a)/a)};function p4(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}qR.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};var qze=j6.exports;const Xze=mA(qze),eT=z6.CLOCKWISE,CW=z6.COUNTER_CLOCKWISE,Mm={isClosed:!0};function Zze(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Yb(t){return"positions"in t?t.positions:t}function nP(t){return"holeIndices"in t?t.holeIndices:null}function Yze(t){return Array.isArray(t[0])}function Qze(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function Kze(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function Jze(t,e,n,r){for(let i=0;i<e;i++)if(t[n+i]!==t[r-e+i])return!1;return!0}function PW(t,e,n,r,i){let o=e;const a=n.length;for(let s=0;s<a;s++)for(let u=0;u<r;u++)t[o++]=n[s][u]||0;if(!Kze(n))for(let s=0;s<r;s++)t[o++]=n[0][s]||0;return Mm.start=e,Mm.end=o,Mm.size=r,U6(t,i,Mm),o}function IW(t,e,n,r,i=0,o,a){o=o||n.length;const s=o-i;if(s<=0)return e;let u=e;for(let d=0;d<s;d++)t[u++]=n[i+d];if(!Jze(n,r,i,o))for(let d=0;d<r;d++)t[u++]=n[i+d];return Mm.start=e,Mm.end=u,Mm.size=r,U6(t,a,Mm),u}function uoe(t,e){Zze(t);const n=[],r=[];if("positions"in t){const{positions:i,holeIndices:o}=t;if(o){let a=0;for(let s=0;s<=o.length;s++)a=IW(n,a,i,e,o[s-1],o[s],s===0?eT:CW),r.push(a);return r.pop(),{positions:n,holeIndices:r}}t=i}if(!Yze(t))return IW(n,0,t,e,0,n.length,eT),n;if(!Qze(t)){let i=0;for(const[o,a]of t.entries())i=PW(n,i,a,e,o===0?eT:CW),r.push(i);return r.pop(),{positions:n,holeIndices:r}}return PW(n,0,t,e,eT),n}function xB(t,e,n){const r=t.length/3;let i=0;for(let o=0;o<r;o++){const a=(o+1)%r;i+=t[o*3+e]*t[a*3+n],i-=t[a*3+e]*t[o*3+n]}return Math.abs(i/2)}function MW(t,e,n,r){const i=t.length/3;for(let o=0;o<i;o++){const a=o*3,s=t[a+0],u=t[a+1],d=t[a+2];t[a+e]=s,t[a+n]=u,t[a+r]=d}}function e5e(t,e,n,r){let i=nP(t);i&&(i=i.map(s=>s/e));let o=Yb(t);const a=r&&e===3;if(n){const s=o.length;o=o.slice();const u=[];for(let d=0;d<s;d+=e){u[0]=o[d],u[1]=o[d+1],a&&(u[2]=o[d+2]);const g=n(u);o[d]=g[0],o[d+1]=g[1],a&&(o[d+2]=g[2])}}if(a){const s=xB(o,0,1),u=xB(o,0,2),d=xB(o,1,2);if(!s&&!u&&!d)return[];s>u&&s>d||(u>d?(n||(o=o.slice()),MW(o,0,2,1)):(n||(o=o.slice()),MW(o,2,0,1)))}return Xze(o,i,e)}class t5e extends q5{constructor(e){const{fp64:n,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=uoe(e,this.positionSize);return this.opts.resolution?toe(Yb(n),nP(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?mze(Yb(n),nP(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(OW(e)){let n=0;for(const r of e)n+=this.getGeometrySize(r);return n}return Yb(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&OW(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:r,indexStart:i}){const{attributes:o,indexStarts:a,typedArrayManager:s}=this;let u=o.indices;if(!u||!e)return;let d=i;const g=e5e(e,this.positionSize,this.opts.preproject,this.opts.full3d);u=s.allocate(u,i+g.length,{copy:!0});for(let _=0;_<g.length;_++)u[d++]=g[_]+r;a[n+1]=i+g.length,o.indices=u}_updatePositions(e,{vertexStart:n,geometrySize:r}){const{attributes:{positions:i},positionSize:o}=this;if(!i||!e)return;const a=Yb(e);for(let s=n,u=0;u<r;s++,u++){const d=a[u*o],g=a[u*o+1],_=o>2?a[u*o+2]:0;i[s*3]=d,i[s*3+1]=g,i[s*3+2]=_}}_updateVertexValid(e,{vertexStart:n,geometrySize:r}){const{positionSize:i}=this,o=this.attributes.vertexValid,a=e&&nP(e);if(e&&e.edgeTypes?o.set(e.edgeTypes,n):o.fill(1,n,n+r),a)for(let s=0;s<a.length;s++)o[n+a[s]/i-1]=0;o[n+r-1]=0}}function OW(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const coe=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,n5e=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(coe,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),r5e=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(coe,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),i5e=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,JI=[0,0,0,255],o5e={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:JI},getLineColor:{type:"accessor",value:JI},material:!0},tT={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class o2 extends nl{constructor(...e){super(...e),q(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?n5e:r5e,fs:i5e,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Mc,DE,Oc]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:r}=this.props;const{_full3d:i}=this.props;n.isGeospatial&&r===Br.DEFAULT&&(r=Br.LNGLAT);let o;r===Br.LNGLAT&&(i?o=n.projectPosition.bind(n):o=n.projectFlat.bind(n)),this.setState({numInstances:0,polygonTesselator:new t5e({preproject:o,fp64:this.use64bitPositions(),IndexType:!e||LO(e,Qi.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const a=this.getAttributeManager(),s=!0;a.remove(["instancePickingColors"]),a.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:tT,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,transition:tT,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:tT,accessor:"getFillColor",defaultValue:JI,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:tT,accessor:"getLineColor",defaultValue:JI,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(u,{index:d,target:g})=>this.encodePickingColor(u&&u.__source?u.__source.index:d,g),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,{data:i}=this.props;return i[0]&&i[0].__source&&(n.object=i.find(o=>o.__source.index===r)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:r,wireframe:i,elevationScale:o}=this.props,{topModel:a,sideModel:s,polygonTesselator:u}=this.state,d={...e,extruded:!!n,elevationScale:o};s&&(s.setInstanceCount(u.instanceCount-1),s.setUniforms(d),i&&(s.setDrawMode(3),s.setUniforms({isWireframe:!0}).draw()),r&&(s.setDrawMode(6),s.setUniforms({isWireframe:!1}).draw())),a&&(a.setVertexCount(u.vertexCount),a.setUniforms(d).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:r,changeFlags:i}=e,o=this.getAttributeManager();if(i.extensionsChanged||n.filled!==r.filled||n.extruded!==r.extruded){var s;(s=this.state.models)===null||s===void 0||s.forEach(u=>u.delete()),this.setState(this._getModels(this.context.gl)),o.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:o}=this.state,a=e.data.attributes||{};o.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:a.getPolygon,buffers:a,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:r,extruded:i}=this.props;let o,a;if(r){const s=this.getShaders("top");s.defines.NON_INSTANCED_MODEL=1,o=new Oa(e,{...s,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return i&&(a=new Oa(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new Cs({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),a.userData.excludeAttributes={indices:!0}),{models:[a,o].filter(Boolean),topModel:o,sideModel:a}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}q(o2,"defaultProps",o5e);q(o2,"layerName","SolidPolygonLayer");function foe({data:t,getIndex:e,dataRange:n,replace:r}){const{startRow:i=0,endRow:o=1/0}=n,a=t.length;let s=a,u=a;for(let E=0;E<a;E++){const P=e(t[E]);if(s>E&&P>=i&&(s=E),P>=o){u=E;break}}let d=s;const _=u-s!==r.length?t.slice(u):void 0;for(let E=0;E<r.length;E++)t[d++]=r[E];if(_){for(let E=0;E<_.length;E++)t[d++]=_[E];t.length=d}return{startRow:s,endRow:s+r.length}}const hoe=[0,0,0,255],s5e=[0,0,0,255],a5e={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:s5e},getLineColor:{type:"accessor",value:hoe},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class bA extends Uh{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&Or.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(n&&Array.isArray(e.dataChanged)){const r=this.state.paths.slice(),i=e.dataChanged.map(o=>foe({data:r,getIndex:a=>a.__source.index,dataRange:o,replace:this._getPaths(o)}));this.setState({paths:r,pathsDiff:i})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:n,getPolygon:r,positionFormat:i,_normalize:o}=this.props,a=[],s=i==="XY"?2:3,{startRow:u,endRow:d}=e,{iterable:g,objectInfo:_}=Tg(n,u,d);for(const E of g){_.index++;let P=r(E,_);o&&(P=uoe(P,s));const{holeIndices:R}=P,B=P.positions||P;if(R)for(let V=0;V<=R.length;V++){const z=B.slice(R[V-1]||0,R[V]||B.length);a.push(this.getSubLayerRow({path:z},E,_.index))}else a.push(this.getSubLayerRow({path:B},E,_.index))}return a}renderLayers(){const{data:e,_dataDiff:n,stroked:r,filled:i,extruded:o,wireframe:a,_normalize:s,_windingOrder:u,elevationScale:d,transitions:g,positionFormat:_}=this.props,{lineWidthUnits:E,lineWidthScale:P,lineWidthMinPixels:R,lineWidthMaxPixels:B,lineJointRounded:V,lineMiterLimit:z,lineDashJustified:F}=this.props,{getFillColor:k,getLineColor:X,getLineWidth:Y,getLineDashArray:J,getElevation:ie,getPolygon:ce,updateTriggers:re,material:ue}=this.props,{paths:se,pathsDiff:me}=this.state,Ce=this.getSubLayerClass("fill",o2),be=this.getSubLayerClass("stroke",V1),Ye=this.shouldRenderSubLayer("fill",se)&&new Ce({_dataDiff:n,extruded:o,elevationScale:d,filled:i,wireframe:a,_normalize:s,_windingOrder:u,getElevation:ie,getFillColor:k,getLineColor:o&&a?X:hoe,material:ue,transitions:g},this.getSubLayerProps({id:"fill",updateTriggers:re&&{getPolygon:re.getPolygon,getElevation:re.getElevation,getFillColor:re.getFillColor,lineColors:o&&a,getLineColor:re.getLineColor}}),{data:e,positionFormat:_,getPolygon:ce}),tt=!o&&r&&this.shouldRenderSubLayer("stroke",se)&&new be({_dataDiff:me&&(()=>me),widthUnits:E,widthScale:P,widthMinPixels:R,widthMaxPixels:B,jointRounded:V,miterLimit:z,dashJustified:F,_pathType:"loop",transitions:g&&{getWidth:g.getLineWidth,getColor:g.getLineColor,getPath:g.getPolygon},getColor:this.getSubLayerAccessor(X),getWidth:this.getSubLayerAccessor(Y),getDashArray:this.getSubLayerAccessor(J)},this.getSubLayerProps({id:"stroke",updateTriggers:re&&{getWidth:re.getLineWidth,getColor:re.getLineColor,getDashArray:re.getLineDashArray}}),{data:se,positionFormat:_,getPath:pt=>pt.path});return[!o&&Ye,tt,o&&Ye]}}q(bA,"layerName","PolygonLayer");q(bA,"defaultProps",a5e);function l5e(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,r=t.featureIds.value[n];return n!==-1?u5e(t,r,n):null}function u5e(t,e,n){const r={properties:{...t.properties[e]}};for(const i in t.numericProps)r.properties[i]=t.numericProps[i].value[n];return r}function c5e(t,e){const n={points:null,lines:null,polygons:null};for(const r in n){const i=t[r].globalFeatureIds.value;n[r]=new Uint8ClampedArray(i.length*3);const o=[];for(let a=0;a<i.length;a++)e(i[a],o),n[r][a*3+0]=o[0],n[r][a*3+1]=o[1],n[r][a*3+2]=o[2]}return n}const f5e=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,bB=192/256,RW=[],h5e={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class ZR extends r2{constructor(...e){super(...e),q(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:f5e}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;let{outlineColor:i}=n;i!==r.outlineColor&&(i=i.map(o=>o/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!n.sdf&&n.outlineWidth&&Or.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:r,outlineWidth:i}=this.props,{outlineColor:o}=this.state,a=i?Math.max(r,bB*(1-i)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:bB,outlineBuffer:a,gamma:r,sdf:!!n,outlineColor:o},super.draw(e),n&&i){const{iconManager:s}=this.state;s.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:bB}})}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):RW}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):RW}}q(ZR,"defaultProps",h5e);q(ZR,"layerName","MultiIconLayer");const dw=1e20;class d5e{constructor({fontSize:e=24,buffer:n=3,radius:r=8,cutoff:i=.25,fontFamily:o="sans-serif",fontWeight:a="normal",fontStyle:s="normal"}={}){this.buffer=n,this.cutoff=i,this.radius=r;const u=this.size=e+n*4,d=this._createCanvas(u),g=this.ctx=d.getContext("2d",{willReadFrequently:!0});g.font=`${s} ${a} ${e}px ${o}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(u*u),this.gridInner=new Float64Array(u*u),this.f=new Float64Array(u),this.z=new Float64Array(u+1),this.v=new Uint16Array(u)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:o,actualBoundingBoxRight:a}=this.ctx.measureText(e),s=Math.ceil(r),u=0,d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-o))),g=Math.min(this.size-this.buffer,s+Math.ceil(i)),_=d+2*this.buffer,E=g+2*this.buffer,P=Math.max(_*E,0),R=new Uint8ClampedArray(P),B={data:R,width:_,height:E,glyphWidth:d,glyphHeight:g,glyphTop:s,glyphLeft:u,glyphAdvance:n};if(d===0||g===0)return B;const{ctx:V,buffer:z,gridInner:F,gridOuter:k}=this;V.clearRect(z,z,d,g),V.fillText(e,z,z+s);const X=V.getImageData(z,z,d,g);k.fill(dw,0,P),F.fill(0,0,P);for(let Y=0;Y<g;Y++)for(let J=0;J<d;J++){const ie=X.data[4*(Y*d+J)+3]/255;if(ie===0)continue;const ce=(Y+z)*_+J+z;if(ie===1)k[ce]=0,F[ce]=dw;else{const re=.5-ie;k[ce]=re>0?re*re:0,F[ce]=re<0?re*re:0}}LW(k,0,0,_,E,_,this.f,this.v,this.z),LW(F,z,z,d,g,_,this.f,this.v,this.z);for(let Y=0;Y<P;Y++){const J=Math.sqrt(k[Y])-Math.sqrt(F[Y]);R[Y]=Math.round(255-255*(J/this.radius+this.cutoff))}return B}}function LW(t,e,n,r,i,o,a,s,u){for(let d=e;d<e+r;d++)DW(t,n*o+d,o,i,a,s,u);for(let d=n;d<n+i;d++)DW(t,d*o+e,1,r,a,s,u)}function DW(t,e,n,r,i,o,a){o[0]=0,a[0]=-dw,a[1]=dw,i[0]=t[e];for(let s=1,u=0,d=0;s<r;s++){i[s]=t[e+s*n];const g=s*s;do{const _=o[u];d=(i[s]-i[_]+g-_*_)/(s-_)/2}while(d<=a[u]&&--u>-1);u++,o[u]=s,a[u]=d,a[u+1]=dw}for(let s=0,u=0;s<r;s++){for(;a[u+1]<s;)u++;const d=o[u],g=s-d;t[e+s*n]=i[d]+g*g}}const p5e=32,g5e=[];function m5e(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function A5e({characterSet:t,getFontWidth:e,fontHeight:n,buffer:r,maxCanvasWidth:i,mapping:o={},xOffset:a=0,yOffset:s=0}){let u=0,d=a;const g=n+r*2;for(const _ of t)if(!o[_]){const E=e(_);d+E+r*2>i&&(d=0,u++),o[_]={x:d+r,y:s+u*g+r,width:E,height:g,layoutWidth:E,layoutHeight:n},d+=E+r*2}return{mapping:o,xOffset:d,yOffset:s+u*g,canvasHeight:m5e(s+(u+1)*g)}}function doe(t,e,n,r){let i=0;for(let a=e;a<n;a++){var o;const s=t[a];i+=((o=r[s])===null||o===void 0?void 0:o.layoutWidth)||0}return i}function poe(t,e,n,r,i,o){let a=e,s=0;for(let u=e;u<n;u++){const d=doe(t,u,u+1,i);s+d>r&&(a<u&&o.push(u),a=u,s=0),s+=d}return s}function _5e(t,e,n,r,i,o){let a=e,s=e,u=e,d=0;for(let g=e;g<n;g++)if((t[g]===" "||t[g+1]===" "||g+1===n)&&(u=g+1),u>s){let _=doe(t,s,u,i);d+_>r&&(a<s&&(o.push(s),a=s,d=0),_>r&&(_=poe(t,s,u,r,i,o),a=o[o.length-1])),s=u,d+=_}return d}function y5e(t,e,n,r,i=0,o){o===void 0&&(o=t.length);const a=[];return e==="break-all"?poe(t,i,o,n,r,a):_5e(t,i,o,n,r,a),a}function v5e(t,e,n,r,i,o){let a=0,s=0;for(let u=e;u<n;u++){const d=t[u],g=r[d];g?(s||(s=g.layoutHeight),i[u]=a+g.layoutWidth/2,a+=g.layoutWidth):(Or.warn("Missing character: ".concat(d," (").concat(d.codePointAt(0),")"))(),i[u]=a,a+=p5e)}o[0]=a,o[1]=s}function x5e(t,e,n,r,i){const o=Array.from(t),a=o.length,s=new Array(a),u=new Array(a),d=new Array(a),g=(n==="break-word"||n==="break-all")&&isFinite(r)&&r>0,_=[0,0],E=[0,0];let P=0,R=0,B=0;for(let z=0;z<=a;z++){const F=o[z];if((F===`
`||z===a)&&(B=z),B>R){const k=g?y5e(o,n,r,i,R,B):g5e;for(let X=0;X<=k.length;X++){const Y=X===0?R:k[X-1],J=X<k.length?k[X]:B;v5e(o,Y,J,i,s,E);for(let ie=Y;ie<J;ie++){var V;const ce=o[ie],re=((V=i[ce])===null||V===void 0?void 0:V.layoutOffsetY)||0;u[ie]=P+E[1]/2+re,d[ie]=E[0]}P=P+E[1]*e,_[0]=Math.max(_[0],E[0])}R=B}F===`
`&&(s[R]=0,u[R]=0,d[R]=0,R++)}return _[1]=P,{x:s,y:u,rowWidth:d,size:_}}function b5e({value:t,length:e,stride:n,offset:r,startIndices:i,characterSet:o}){const a=t.BYTES_PER_ELEMENT,s=n?n/a:1,u=r?r/a:0,d=i[e]||Math.ceil((t.length-u)/s),g=o&&new Set,_=new Array(e);let E=t;if(s>1||u>0){const P=t.constructor;E=new P(d);for(let R=0;R<d;R++)E[R]=t[R*s+u]}for(let P=0;P<e;P++){const R=i[P],B=i[P+1]||d,V=E.subarray(R,B);_[P]=String.fromCodePoint.apply(null,V),g&&V.forEach(g.add,g)}if(g)for(const P of g)o.add(String.fromCodePoint(P));return{texts:_,characterCount:d}}class goe{constructor(e=5){q(this,"limit",void 0),q(this,"_cache",{}),q(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function w5e(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const yv={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:w5e(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},BW=1024,NW=.9,FW=1.2,moe=3;let eM=new goe(moe);function E5e(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const r=eM.get(t);if(!r)return n;for(const i in r.mapping)n.has(i)&&n.delete(i);return n}function S5e(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function kW(t,e,n,r){t.font="".concat(r," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function T5e(t){Or.assert(Number.isFinite(t)&&t>=moe,"Invalid cache limit"),eM=new goe(t)}class C5e{constructor(){q(this,"props",{...yv}),q(this,"_key",void 0),q(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*FW+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=E5e(this._key,this.props.characterSet),r=eM.get(this._key);if(r&&n.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(n,r);this._atlas=i,eM.set(this._key,i)}_generateFontAtlas(e,n){const{fontFamily:r,fontWeight:i,fontSize:o,buffer:a,sdf:s,radius:u,cutoff:d}=this.props;let g=n&&n.data;g||(g=document.createElement("canvas"),g.width=BW);const _=g.getContext("2d",{willReadFrequently:!0});kW(_,r,o,i);const{mapping:E,canvasHeight:P,xOffset:R,yOffset:B}=A5e({getFontWidth:V=>_.measureText(V).width,fontHeight:o*FW,buffer:a,characterSet:e,maxCanvasWidth:BW,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(g.height!==P){const V=_.getImageData(0,0,g.width,g.height);g.height=P,_.putImageData(V,0,0)}if(kW(_,r,o,i),s){const V=new d5e({fontSize:o,buffer:a,radius:u,cutoff:d,fontFamily:r,fontWeight:"".concat(i)});for(const z of e){const{data:F,width:k,height:X,glyphTop:Y}=V.draw(z);E[z].width=k,E[z].layoutOffsetY=o*NW-Y;const J=_.createImageData(k,X);S5e(F,J),_.putImageData(J,E[z].x,E[z].y)}}else for(const V of e)_.fillText(V,E[V].x,E[V].y+a+o*NW);return{xOffset:R,yOffset:B,mapping:E,data:g,width:g.width,height:g.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:r,buffer:i,sdf:o,radius:a,cutoff:s}=this.props;return o?"".concat(e," ").concat(n," ").concat(r," ").concat(i," ").concat(a," ").concat(s):"".concat(e," ").concat(n," ").concat(r," ").concat(i)}}const P5e=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,I5e=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,M5e={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class YR extends nl{constructor(...e){super(...e),q(this,"state",void 0)}getShaders(){return super.getShaders({vs:P5e,fs:I5e,modules:[Mc,Oc]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var r;const{gl:i}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:r,sizeUnits:i,sizeMinPixels:o,sizeMaxPixels:a,getLineWidth:s}=this.props;let{padding:u}=this.props;u.length<4&&(u=[u[0],u[1],u[0],u[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:!!s,padding:u,sizeUnits:Bu[i],sizeScale:r,sizeMinPixels:o,sizeMaxPixels:a}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new Oa(e,{...this.getShaders(),id:this.props.id,geometry:new Cs({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}q(YR,"defaultProps",M5e);q(YR,"layerName","TextBackgroundLayer");const zW={start:1,middle:0,end:-1},UW={top:1,center:0,bottom:-1},wB=[0,0,0,255],O5e=1,R5e={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:wB},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:yv.characterSet},fontFamily:yv.fontFamily,fontWeight:yv.fontWeight,lineHeight:O5e,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:wB},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:wB},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class QR extends Uh{constructor(...e){super(...e),q(this,"state",void 0),q(this,"getBoundingRect",(n,r)=>{let{size:[i,o]}=this.transformParagraph(n,r);const{fontSize:a}=this.state.fontAtlasManager.props;i/=a,o/=a;const{getTextAnchor:s,getAlignmentBaseline:u}=this.props,d=zW[typeof s=="function"?s(n,r):s],g=UW[typeof u=="function"?u(n,r):u];return[(d-1)*i/2,(g-1)*o/2,i,o]}),q(this,"getIconOffsets",(n,r)=>{const{getTextAnchor:i,getAlignmentBaseline:o}=this.props,{x:a,y:s,rowWidth:u,size:[d,g]}=this.transformParagraph(n,r),_=zW[typeof i=="function"?i(n,r):i],E=UW[typeof o=="function"?o(n,r):o],P=a.length,R=new Array(P*2);let B=0;for(let V=0;V<P;V++){const z=(1-_)*(d-u[V])/2;R[B++]=(_-1)*d/2+z+a[V],R[B++]=(E-1)*g/2+s[V]}return R})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new C5e},this.props.maxWidth>0&&Or.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==r.lineHeight||n.wordBreak!==r.wordBreak||n.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:o}=this.state,a={...e,characterSet:o,fontFamily:n,fontWeight:r};if(!i.mapping)return i.setProps(a),!0;for(const s in a)if(a[s]!==i.props[s])return i.setProps(a),!0;return!1}_updateText(){var e;const{data:n,characterSet:r}=this.props,i=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:o}=this.props,a=n.startIndices,s;const u=r==="auto"&&new Set;if(i&&a){const{texts:d,characterCount:g}=b5e({...ArrayBuffer.isView(i)?{value:i}:i,length:n.length,startIndices:a,characterSet:u});s=g,o=(_,{index:E})=>d[E]}else{const{iterable:d,objectInfo:g}=Tg(n);a=[0],s=0;for(const _ of d){g.index++;const E=Array.from(o(_,g)||"");u&&E.forEach(u.add,u),s+=E.length,a.push(s)}}this.setState({getText:o,startIndices:a,numInstances:s,characterSet:u||r})}transformParagraph(e,n){const{fontAtlasManager:r}=this.state,i=r.mapping,o=this.state.getText,{wordBreak:a,lineHeight:s,maxWidth:u}=this.props,d=o(e,n)||"";return x5e(d,s,a,u*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:n,getText:r,fontAtlasManager:{scale:i,texture:o,mapping:a},styleVersion:s}=this.state,{data:u,_dataDiff:d,getPosition:g,getColor:_,getSize:E,getAngle:P,getPixelOffset:R,getBackgroundColor:B,getBorderColor:V,getBorderWidth:z,backgroundPadding:F,background:k,billboard:X,fontSettings:Y,outlineWidth:J,outlineColor:ie,sizeScale:ce,sizeUnits:re,sizeMinPixels:ue,sizeMaxPixels:se,transitions:me,updateTriggers:Ce}=this.props,be=this.getSubLayerClass("characters",ZR),Ye=this.getSubLayerClass("background",YR);return[k&&new Ye({getFillColor:B,getLineColor:V,getLineWidth:z,padding:F,getPosition:g,getSize:E,getAngle:P,getPixelOffset:R,billboard:X,sizeScale:ce,sizeUnits:re,sizeMinPixels:ue,sizeMaxPixels:se,transitions:me&&{getPosition:me.getPosition,getAngle:me.getAngle,getSize:me.getSize,getFillColor:me.getBackgroundColor,getLineColor:me.getBorderColor,getLineWidth:me.getBorderWidth,getPixelOffset:me.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Ce.getPosition,getAngle:Ce.getAngle,getSize:Ce.getSize,getFillColor:Ce.getBackgroundColor,getLineColor:Ce.getBorderColor,getLineWidth:Ce.getBorderWidth,getPixelOffset:Ce.getPixelOffset,getBoundingRect:{getText:Ce.getText,getTextAnchor:Ce.getTextAnchor,getAlignmentBaseline:Ce.getAlignmentBaseline,styleVersion:s}}}),{data:u.attributes&&u.attributes.background?{length:u.length,attributes:u.attributes.background}:u,_dataDiff:d,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new be({sdf:Y.sdf,smoothing:Number.isFinite(Y.smoothing)?Y.smoothing:yv.smoothing,outlineWidth:J/(Y.radius||yv.radius),outlineColor:ie,iconAtlas:o,iconMapping:a,getPosition:g,getColor:_,getSize:E,getAngle:P,getPixelOffset:R,billboard:X,sizeScale:ce*i,sizeUnits:re,sizeMinPixels:ue*i,sizeMaxPixels:se*i,transitions:me&&{getPosition:me.getPosition,getAngle:me.getAngle,getColor:me.getColor,getSize:me.getSize,getPixelOffset:me.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Ce.getText,getPosition:Ce.getPosition,getAngle:Ce.getAngle,getColor:Ce.getColor,getSize:Ce.getSize,getPixelOffset:Ce.getPixelOffset,getIconOffsets:{getTextAnchor:Ce.getTextAnchor,getAlignmentBaseline:Ce.getAlignmentBaseline,styleVersion:s}}}),{data:u,_dataDiff:d,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){T5e(e)}}q(QR,"defaultProps",R5e);q(QR,"layerName","TextLayer");const rP={circle:{type:HR,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:r2,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:QR,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},iP={type:V1,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},g4={type:o2,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function vb({type:t,props:e}){const n={};for(const r in e)n[r]=t.defaultProps[e[r]];return n}function EB(t,e){const{transitions:n,updateTriggers:r}=t.props,i={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const o in e){const a=e[o];let s=t.props[o];o.startsWith("get")&&(s=t.getSubLayerAccessor(s),i.updateTriggers[a]=r[o],n&&(i.transitions[a]=n[o])),i[a]=s}return i}function L5e(t){if(Array.isArray(t))return t;switch(Or.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Or.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function GW(t,e,n={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:o=t.length}=n;for(let a=i;a<o;a++){const s=t[a],{geometry:u}=s;if(u)if(u.type==="GeometryCollection"){Or.assert(Array.isArray(u.geometries),"GeoJSON does not have geometries array");const{geometries:d}=u;for(let g=0;g<d.length;g++){const _=d[g];jW(_,r,e,s,a)}}else jW(u,r,e,s,a)}return r}function jW(t,e,n,r,i){const{type:o,coordinates:a}=t,{pointFeatures:s,lineFeatures:u,polygonFeatures:d,polygonOutlineFeatures:g}=e;if(!B5e(o,a)){Or.warn("".concat(o," coordinates are malformed"))();return}switch(o){case"Point":s.push(n({geometry:t},r,i));break;case"MultiPoint":a.forEach(_=>{s.push(n({geometry:{type:"Point",coordinates:_}},r,i))});break;case"LineString":u.push(n({geometry:t},r,i));break;case"MultiLineString":a.forEach(_=>{u.push(n({geometry:{type:"LineString",coordinates:_}},r,i))});break;case"Polygon":d.push(n({geometry:t},r,i)),a.forEach(_=>{g.push(n({geometry:{type:"LineString",coordinates:_}},r,i))});break;case"MultiPolygon":a.forEach(_=>{d.push(n({geometry:{type:"Polygon",coordinates:_}},r,i)),_.forEach(E=>{g.push(n({geometry:{type:"LineString",coordinates:E}},r,i))})});break}}const D5e={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function B5e(t,e){let n=D5e[t];for(Or.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function Aoe(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function nT(t){return t.geometry.coordinates}function N5e(t,e){const n=Aoe(),{pointFeatures:r,lineFeatures:i,polygonFeatures:o,polygonOutlineFeatures:a}=t;return n.points.data=r,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=nT,n.lines.data=i,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=nT,n.polygons.data=o,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=nT,n.polygonsOutline.data=a,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=nT,n}function F5e(t,e){const n=Aoe(),{points:r,lines:i,polygons:o}=t,a=c5e(t,e);return n.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:3,value:a.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:3,value:a.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines._pathType="open",n.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,pickingColors:{size:3,value:a.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},n.polygons._normalize=!1,o.triangles&&(n.polygons.data.attributes.indices=o.triangles.value),n.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:3,value:a.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},n.polygonsOutline._pathType="open",n}const k5e=["points","linestrings","polygons"],z5e={...vb(rP.circle),...vb(rP.icon),...vb(rP.text),...vb(iP),...vb(g4),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class $1 extends Uh{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:r}=this.props,i=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const r=F5e(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:n}){const r=L5e(e.data),i=this.getSubLayerRow.bind(this);let o={};const a={};if(Array.isArray(n.dataChanged)){const u=this.state.features;for(const d in u)o[d]=u[d].slice(),a[d]=[];for(const d of n.dataChanged){const g=GW(r,i,d);for(const _ in u)a[_].push(foe({data:o[_],getIndex:E=>E.__source.index,dataRange:d,replace:g[_]}))}}else o=GW(r,i);const s=N5e(o,a);this.setState({features:o,featuresDiff:a,layerProps:s})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r,sourceLayer:i}=n;return n.featureType=k5e.find(o=>i.id.startsWith("".concat(this.id,"-").concat(o,"-"))),r>=0&&i.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[r]),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),r=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(n)===r&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:r}=this.state,i="polygons-fill",o=this.shouldRenderSubLayer(i,r.polygons.data)&&this.getSubLayerClass(i,g4.type);if(o){const a=EB(this,g4.props),s=e&&n;return s||delete a.getLineColor,a.updateTriggers.lineColors=s,new o(a,this.getSubLayerProps({id:i,updateTriggers:a.updateTriggers}),r.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:r}=this.state,i="polygons-stroke",o="linestrings",a=!e&&n&&this.shouldRenderSubLayer(i,r.polygonsOutline.data)&&this.getSubLayerClass(i,iP.type),s=this.shouldRenderSubLayer(o,r.lines.data)&&this.getSubLayerClass(o,iP.type);if(a||s){const u=EB(this,iP.props);return[a&&new a(u,this.getSubLayerProps({id:i,updateTriggers:u.updateTriggers}),r.polygonsOutline),s&&new s(u,this.getSubLayerProps({id:o,updateTriggers:u.updateTriggers}),r.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:r}=this.state;let{highlightedObjectIndex:i}=this.props;!r&&Number.isFinite(i)&&(i=n.points.data.findIndex(s=>s.__source.index===i));const o=new Set(e.split("+")),a=[];for(const s of o){const u="points-".concat(s),d=rP[s],g=d&&this.shouldRenderSubLayer(u,n.points.data)&&this.getSubLayerClass(u,d.type);if(g){const _=EB(this,d.props);let E=n.points;if(s==="text"&&r){const{instancePickingColors:P,...R}=E.data.attributes;E={...E,data:{...E.data,attributes:R}}}a.push(new g(_,this.getSubLayerProps({id:u,updateTriggers:_.updateTriggers,highlightedObjectIndex:i}),E))}}return a}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),r=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&n,r,i,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(r,i)=>{const{data:o,index:a}=i,s=l5e(o,a);return e(s,i)}}}q($1,"layerName","GeoJsonLayer");q($1,"defaultProps",z5e);const U5e=Object.freeze(Object.defineProperty({__proto__:null,ArcLayer:jR,BitmapLayer:VR,ColumnLayer:i2,GeoJsonLayer:$1,GridCellLayer:G6,IconLayer:r2,LineLayer:k6,PathLayer:V1,PointCloudLayer:$R,PolygonLayer:bA,ScatterplotLayer:HR,SolidPolygonLayer:o2,TextLayer:QR,_MultiIconLayer:ZR,_TextBackgroundLayer:YR},Symbol.toStringTag,{value:"Module"})),y_=ti(U5e);var uA={};Object.defineProperty(uA,"__esModule",{value:!0});uA.UNIT=uA.PROJECTED_PIXEL_SIZE_MULTIPLIER=void 0;var G5e=2/3;uA.PROJECTED_PIXEL_SIZE_MULTIPLIER=G5e;var j5e={common:0,meters:1,pixels:2};uA.UNIT=j5e;var V6={};const s2=ti(dCe);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=s2;function n(Y){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(ie){return typeof ie}:n=function(ie){return ie&&typeof Symbol=="function"&&ie.constructor===Symbol&&ie!==Symbol.prototype?"symbol":typeof ie},n(Y)}function r(Y,J){var ie=Object.keys(Y);if(Object.getOwnPropertySymbols){var ce=Object.getOwnPropertySymbols(Y);J&&(ce=ce.filter(function(re){return Object.getOwnPropertyDescriptor(Y,re).enumerable})),ie.push.apply(ie,ce)}return ie}function i(Y){for(var J=1;J<arguments.length;J++){var ie=arguments[J]!=null?arguments[J]:{};J%2?r(Object(ie),!0).forEach(function(ce){F(Y,ce,ie[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Y,Object.getOwnPropertyDescriptors(ie)):r(Object(ie)).forEach(function(ce){Object.defineProperty(Y,ce,Object.getOwnPropertyDescriptor(ie,ce))})}return Y}function o(Y){if(typeof Symbol>"u"||Y[Symbol.iterator]==null){if(Array.isArray(Y)||(Y=a(Y))){var J=0,ie=function(){};return{s:ie,n:function(){return J>=Y.length?{done:!0}:{done:!1,value:Y[J++]}},e:function(Ce){throw Ce},f:ie}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ce,re=!0,ue=!1,se;return{s:function(){ce=Y[Symbol.iterator]()},n:function(){var Ce=ce.next();return re=Ce.done,Ce},e:function(Ce){ue=!0,se=Ce},f:function(){try{!re&&ce.return!=null&&ce.return()}finally{if(ue)throw se}}}}function a(Y,J){if(Y){if(typeof Y=="string")return s(Y,J);var ie=Object.prototype.toString.call(Y).slice(8,-1);if(ie==="Object"&&Y.constructor&&(ie=Y.constructor.name),ie==="Map"||ie==="Set")return Array.from(ie);if(ie==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ie))return s(Y,J)}}function s(Y,J){(J==null||J>Y.length)&&(J=Y.length);for(var ie=0,ce=new Array(J);ie<J;ie++)ce[ie]=Y[ie];return ce}function u(Y,J){if(!(Y instanceof J))throw new TypeError("Cannot call a class as a function")}function d(Y,J){for(var ie=0;ie<J.length;ie++){var ce=J[ie];ce.enumerable=ce.enumerable||!1,ce.configurable=!0,"value"in ce&&(ce.writable=!0),Object.defineProperty(Y,ce.key,ce)}}function g(Y,J,ie){return J&&d(Y.prototype,J),ie&&d(Y,ie),Y}function _(Y){return function(){var J=B(Y),ie;if(R()){var ce=B(this).constructor;ie=Reflect.construct(J,arguments,ce)}else ie=J.apply(this,arguments);return E(this,ie)}}function E(Y,J){return J&&(n(J)==="object"||typeof J=="function")?J:P(Y)}function P(Y){if(Y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function B(Y){return B=Object.setPrototypeOf?Object.getPrototypeOf:function(ie){return ie.__proto__||Object.getPrototypeOf(ie)},B(Y)}function V(Y,J){if(typeof J!="function"&&J!==null)throw new TypeError("Super expression must either be null or a function");Y.prototype=Object.create(J&&J.prototype,{constructor:{value:Y,writable:!0,configurable:!0}}),J&&z(Y,J)}function z(Y,J){return z=Object.setPrototypeOf||function(ce,re){return ce.__proto__=re,ce},z(Y,J)}function F(Y,J,ie){return J in Y?Object.defineProperty(Y,J,{value:ie,enumerable:!0,configurable:!0,writable:!0}):Y[J]=ie,Y}var k=["anyclick","pointermove","panstart","panmove","panend","keyup"],X=function(Y){V(ie,Y);var J=_(ie);function ie(){return u(this,ie),J.apply(this,arguments)}return g(ie,[{key:"onLayerClick",value:function(re){}},{key:"onStartDragging",value:function(re){}},{key:"onStopDragging",value:function(re){}},{key:"onDragging",value:function(re){}},{key:"onPointerMove",value:function(re){}},{key:"onLayerKeyUp",value:function(re){}},{key:"initializeState",value:function(){this.setState({_editableLayerState:{pointerDownPicks:null,pointerDownScreenCoords:null,pointerDownMapCoords:null,eventHandler:this._forwardEventToCurrentLayer.bind(this)}}),this._addEventHandlers()}},{key:"finalizeState",value:function(){this._removeEventHandlers()}},{key:"_addEventHandlers",value:function(){var re=this.context.deck.eventManager,ue=this.state._editableLayerState.eventHandler,se=o(k),me;try{for(se.s();!(me=se.n()).done;){var Ce=me.value;re.on(Ce,ue,{priority:100})}}catch(be){se.e(be)}finally{se.f()}}},{key:"_removeEventHandlers",value:function(){var re=this.context.deck.eventManager,ue=this.state._editableLayerState.eventHandler,se=o(k),me;try{for(se.s();!(me=se.n()).done;){var Ce=me.value;re.off(Ce,ue)}}catch(be){se.e(be)}finally{se.f()}}},{key:"_forwardEventToCurrentLayer",value:function(re){var ue=this.getCurrentLayer(),se=ue["_on".concat(re.type)].bind(ue);if(!se){console.warn("no handler for mjolnir.js event ".concat(re.type));return}se(re)}},{key:"_onanyclick",value:function(re){var ue=re.srcEvent,se=this.getScreenCoords(ue),me=this.getMapCoords(se),Ce=this.getPicks(se);this.onLayerClick({mapCoords:me,screenCoords:se,picks:Ce,sourceEvent:ue})}},{key:"_onkeyup",value:function(re){var ue=re.srcEvent;this.onLayerKeyUp(ue)}},{key:"_onpanstart",value:function(re){var ue=this.getScreenCoords(re.srcEvent),se=this.getMapCoords(ue),me=this.getPicks(ue);this.setState({_editableLayerState:i({},this.state._editableLayerState,{pointerDownScreenCoords:ue,pointerDownMapCoords:se,pointerDownPicks:me})}),this.onStartDragging({picks:me,screenCoords:ue,mapCoords:se,pointerDownScreenCoords:ue,pointerDownMapCoords:se,cancelPan:re.stopImmediatePropagation,sourceEvent:re.srcEvent})}},{key:"_onpanmove",value:function(re){var ue=re.srcEvent,se=this.getScreenCoords(ue),me=this.getMapCoords(se),Ce=this.state._editableLayerState,be=Ce.pointerDownPicks,Ye=Ce.pointerDownScreenCoords,tt=Ce.pointerDownMapCoords,pt=this.getPicks(se);this.onDragging({screenCoords:se,mapCoords:me,picks:pt,pointerDownPicks:be,pointerDownScreenCoords:Ye,pointerDownMapCoords:tt,sourceEvent:ue,cancelPan:re.stopImmediatePropagation})}},{key:"_onpanend",value:function(re){var ue=re.srcEvent,se=this.getScreenCoords(ue),me=this.getMapCoords(se),Ce=this.state._editableLayerState,be=Ce.pointerDownPicks,Ye=Ce.pointerDownScreenCoords,tt=Ce.pointerDownMapCoords,pt=this.getPicks(se);this.onStopDragging({picks:pt,screenCoords:se,mapCoords:me,pointerDownPicks:be,pointerDownScreenCoords:Ye,pointerDownMapCoords:tt,sourceEvent:ue}),this.setState({_editableLayerState:i({},this.state._editableLayerState,{pointerDownScreenCoords:null,pointerDownMapCoords:null,pointerDownPicks:null})})}},{key:"_onpointermove",value:function(re){var ue=re.srcEvent,se=this.getScreenCoords(ue),me=this.getMapCoords(se),Ce=this.state._editableLayerState,be=Ce.pointerDownPicks,Ye=Ce.pointerDownScreenCoords,tt=Ce.pointerDownMapCoords,pt=this.getPicks(se);this.onPointerMove({screenCoords:se,mapCoords:me,picks:pt,pointerDownPicks:be,pointerDownScreenCoords:Ye,pointerDownMapCoords:tt,sourceEvent:ue})}},{key:"getPicks",value:function(re){return this.context.deck.pickMultipleObjects({x:re[0],y:re[1],layerIds:[this.props.id],radius:this.props.pickingRadius,depth:this.props.pickingDepth})}},{key:"getScreenCoords",value:function(re){return[re.clientX-this.context.gl.canvas.getBoundingClientRect().left,re.clientY-this.context.gl.canvas.getBoundingClientRect().top]}},{key:"getMapCoords",value:function(re){return this.context.viewport.unproject([re[0],re[1]])}}]),ie}(e.CompositeLayer);t.default=X,F(X,"layerName","EditableLayer")})(V6);var _oe={},rp={};Object.defineProperty(rp,"__esModule",{value:!0});rp.toDeckColor=e6e;rp.recursivelyTraverseNestedArrays=voe;rp.generatePointsParallelToLinePoints=t6e;rp.distance2d=A4;rp.mix=xoe;rp.nearestPointOnProjectedLine=n6e;rp.insertBefore=r6e;var VW=KR(YO),V5e=KR(Kd),$5e=KR(pre),H5e=rl,W5e=KR(r6);function KR(t){return t&&t.__esModule?t:{default:t}}function Sy(t,e){return Z5e(t)||X5e(t,e)||yoe(t,e)||q5e()}function q5e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X5e(t,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var n=[],r=!0,i=!1,o=void 0;try{for(var a=t[Symbol.iterator](),s;!(r=(s=a.next()).done)&&(n.push(s.value),!(e&&n.length===e));r=!0);}catch(u){i=!0,o=u}finally{try{!r&&a.return!=null&&a.return()}finally{if(i)throw o}}return n}}function Z5e(t){if(Array.isArray(t))return t}function Y5e(t){return J5e(t)||K5e(t)||yoe(t)||Q5e()}function Q5e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yoe(t,e){if(t){if(typeof t=="string")return m4(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m4(t,e)}}function K5e(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function J5e(t){if(Array.isArray(t))return m4(t)}function m4(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function e6e(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[255,0,0,255];return Array.isArray(t)?[t[0]*255,t[1]*255,t[2]*255,t[3]*255]:e}function voe(t,e,n){if(!Array.isArray(t[0]))return!0;for(var r=0;r<t.length;r++)if(voe(t[r],[].concat(Y5e(e),[r]),n)){n(t,e);break}return!1}function t6e(t,e,n){var r={type:"LineString",coordinates:[t,e]},i=(0,H5e.point)(n),o=(0,$5e.default)(i,r),a=(0,V5e.default)(t,e),s=(n[0]-t[0])*(e[1]-t[1])-(n[1]-t[1])*(e[0]-t[0]),u=s<0?a-90:a-270,d=(0,VW.default)(e,o,u),g=(0,VW.default)(t,o,u);return[d.geometry.coordinates,g.geometry.coordinates]}function A4(t,e,n,r){var i=t-n,o=e-r;return Math.sqrt(i*i+o*o)}function xoe(t,e,n){return e*n+t*(1-n)}function n6e(t,e,n){var r=new W5e.default(n),i=t.geometry.coordinates,o=i.map(function(be){var Ye=Sy(be,3),tt=Ye[0],pt=Ye[1],Ee=Ye[2],Ne=Ee===void 0?0:Ee;return r.project([tt,pt,Ne])}),a=r.project(e.geometry.coordinates),s=Sy(a,2),u=s[0],d=s[1],g=1/0,_={};o.forEach(function(be,Ye){var tt=Sy(be,2),pt=tt[0],Ee=tt[1];if(Ye!==0){var Ne=Sy(o[Ye-1],2),Be=Ne[0],qe=Ne[1],ct=qe-Ee,Ct=pt-Be,Dt=Be*Ee-pt*qe,In=ct*ct+Ct*Ct,Mn=Math.abs(ct*u+Ct*d+Dt)/Math.sqrt(In);Mn<g&&(g=Mn,_={index:Ye,x0:(Ct*(Ct*u-ct*d)-ct*Dt)/In,y0:(ct*(-Ct*u+ct*d)-Ct*Dt)/In})}});var E=_,P=E.index,R=E.x0,B=E.y0,V=Sy(o[P-1],3),z=V[0],F=V[1],k=V[2],X=k===void 0?0:k,Y=Sy(o[P],3),J=Y[0],ie=Y[1],ce=Y[2],re=ce===void 0?0:ce,ue=A4(z,F,J,ie),se=A4(z,F,R,B),me=se/ue,Ce=xoe(X,re,me);return{type:"Feature",geometry:{type:"Point",coordinates:r.unproject([R,B,Ce])},properties:{dist:g,index:P-1}}}function r6e(t,e,n){var r=t.indexOf(e);return r<0?t:t.slice(0,r)+n+t.slice(r)}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=y_,n=rp;function r(Y){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?r=function(ie){return typeof ie}:r=function(ie){return ie&&typeof Symbol=="function"&&ie.constructor===Symbol&&ie!==Symbol.prototype?"symbol":typeof ie},r(Y)}function i(Y,J){if(!(Y instanceof J))throw new TypeError("Cannot call a class as a function")}function o(Y,J){for(var ie=0;ie<J.length;ie++){var ce=J[ie];ce.enumerable=ce.enumerable||!1,ce.configurable=!0,"value"in ce&&(ce.writable=!0),Object.defineProperty(Y,ce.key,ce)}}function a(Y,J,ie){return J&&o(Y.prototype,J),ie&&o(Y,ie),Y}function s(Y,J,ie){return typeof Reflect<"u"&&Reflect.get?s=Reflect.get:s=function(re,ue,se){var me=u(re,ue);if(me){var Ce=Object.getOwnPropertyDescriptor(me,ue);return Ce.get?Ce.get.call(se):Ce.value}},s(Y,J,ie||Y)}function u(Y,J){for(;!Object.prototype.hasOwnProperty.call(Y,J)&&(Y=P(Y),Y!==null););return Y}function d(Y){return function(){var J=P(Y),ie;if(E()){var ce=P(this).constructor;ie=Reflect.construct(J,arguments,ce)}else ie=J.apply(this,arguments);return g(this,ie)}}function g(Y,J){return J&&(r(J)==="object"||typeof J=="function")?J:_(Y)}function _(Y){if(Y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y}function E(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function P(Y){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(ie){return ie.__proto__||Object.getPrototypeOf(ie)},P(Y)}function R(Y,J){if(typeof J!="function"&&J!==null)throw new TypeError("Super expression must either be null or a function");Y.prototype=Object.create(J&&J.prototype,{constructor:{value:Y,writable:!0,configurable:!0}}),J&&B(Y,J)}function B(Y,J){return B=Object.setPrototypeOf||function(ce,re){return ce.__proto__=re,ce},B(Y,J)}function V(Y,J){var ie=Object.keys(Y);if(Object.getOwnPropertySymbols){var ce=Object.getOwnPropertySymbols(Y);J&&(ce=ce.filter(function(re){return Object.getOwnPropertyDescriptor(Y,re).enumerable})),ie.push.apply(ie,ce)}return ie}function z(Y){for(var J=1;J<arguments.length;J++){var ie=arguments[J]!=null?arguments[J]:{};J%2?V(Object(ie),!0).forEach(function(ce){F(Y,ce,ie[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Y,Object.getOwnPropertyDescriptors(ie)):V(Object(ie)).forEach(function(ce){Object.defineProperty(Y,ce,Object.getOwnPropertyDescriptor(ie,ce))})}return Y}function F(Y,J,ie){return J in Y?Object.defineProperty(Y,J,{value:ie,enumerable:!0,configurable:!0,writable:!0}):Y[J]=ie,Y}var k=z({},e.PathLayer.defaultProps,{pickingLineWidthExtraPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER}}),X=function(Y){R(ie,Y);var J=d(ie);function ie(){return i(this,ie),J.apply(this,arguments)}return a(ie,[{key:"getShaders",value:function(){var re,ue=s(P(ie.prototype),"getShaders",this).call(this);return ue.vs=(0,n.insertBefore)(ue.vs,"vec3 width;",`
       if(picking_uActive){
        widthPixels.xy += pickingLineWidthExtraPixels;
       }
      `),z({},ue,{inject:z({},ue.inject||{},{"vs:#decl":(((re=ue.inject)===null||re===void 0?void 0:re["vs:#decl"])||"").concat("uniform float pickingLineWidthExtraPixels;")})})}},{key:"draw",value:function(re){s(P(ie.prototype),"draw",this).call(this,z({},re,{uniforms:z({},re.uniforms,{pickingLineWidthExtraPixels:this.props.pickingLineWidthExtraPixels})}))}}]),ie}(e.PathLayer);t.default=X,X.defaultProps=k,X.layerName="EditablePathLayer"})(_oe);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=y_,n=Hp,r=uA,i=a(V6),o=a(_oe);function a(It){return It&&It.__esModule?It:{default:It}}function s(It){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?s=function($t){return typeof $t}:s=function($t){return $t&&typeof Symbol=="function"&&$t.constructor===Symbol&&$t!==Symbol.prototype?"symbol":typeof $t},s(It)}function u(It,Xt){var $t=Object.keys(It);if(Object.getOwnPropertySymbols){var cn=Object.getOwnPropertySymbols(It);Xt&&(cn=cn.filter(function(Jt){return Object.getOwnPropertyDescriptor(It,Jt).enumerable})),$t.push.apply($t,cn)}return $t}function d(It){for(var Xt=1;Xt<arguments.length;Xt++){var $t=arguments[Xt]!=null?arguments[Xt]:{};Xt%2?u(Object($t),!0).forEach(function(cn){re(It,cn,$t[cn])}):Object.getOwnPropertyDescriptors?Object.defineProperties(It,Object.getOwnPropertyDescriptors($t)):u(Object($t)).forEach(function(cn){Object.defineProperty(It,cn,Object.getOwnPropertyDescriptor($t,cn))})}return It}function g(It){if(typeof Symbol>"u"||It[Symbol.iterator]==null){if(Array.isArray(It)||(It=_(It))){var Xt=0,$t=function(){};return{s:$t,n:function(){return Xt>=It.length?{done:!0}:{done:!1,value:It[Xt++]}},e:function(cr){throw cr},f:$t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var cn,Jt=!0,Ln=!1,qn;return{s:function(){cn=It[Symbol.iterator]()},n:function(){var cr=cn.next();return Jt=cr.done,cr},e:function(cr){Ln=!0,qn=cr},f:function(){try{!Jt&&cn.return!=null&&cn.return()}finally{if(Ln)throw qn}}}}function _(It,Xt){if(It){if(typeof It=="string")return E(It,Xt);var $t=Object.prototype.toString.call(It).slice(8,-1);if($t==="Object"&&It.constructor&&($t=It.constructor.name),$t==="Map"||$t==="Set")return Array.from($t);if($t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test($t))return E(It,Xt)}}function E(It,Xt){(Xt==null||Xt>It.length)&&(Xt=It.length);for(var $t=0,cn=new Array(Xt);$t<Xt;$t++)cn[$t]=It[$t];return cn}function P(It,Xt){if(!(It instanceof Xt))throw new TypeError("Cannot call a class as a function")}function R(It,Xt){for(var $t=0;$t<Xt.length;$t++){var cn=Xt[$t];cn.enumerable=cn.enumerable||!1,cn.configurable=!0,"value"in cn&&(cn.writable=!0),Object.defineProperty(It,cn.key,cn)}}function B(It,Xt,$t){return Xt&&R(It.prototype,Xt),$t&&R(It,$t),It}function V(It,Xt,$t){return typeof Reflect<"u"&&Reflect.get?V=Reflect.get:V=function(Jt,Ln,qn){var or=z(Jt,Ln);if(or){var cr=Object.getOwnPropertyDescriptor(or,Ln);return cr.get?cr.get.call(qn):cr.value}},V(It,Xt,$t||It)}function z(It,Xt){for(;!Object.prototype.hasOwnProperty.call(It,Xt)&&(It=J(It),It!==null););return It}function F(It){return function(){var Xt=J(It),$t;if(Y()){var cn=J(this).constructor;$t=Reflect.construct(Xt,arguments,cn)}else $t=Xt.apply(this,arguments);return k(this,$t)}}function k(It,Xt){return Xt&&(s(Xt)==="object"||typeof Xt=="function")?Xt:X(It)}function X(It){if(It===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return It}function Y(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function J(It){return J=Object.setPrototypeOf?Object.getPrototypeOf:function($t){return $t.__proto__||Object.getPrototypeOf($t)},J(It)}function ie(It,Xt){if(typeof Xt!="function"&&Xt!==null)throw new TypeError("Super expression must either be null or a function");It.prototype=Object.create(Xt&&Xt.prototype,{constructor:{value:It,writable:!0,configurable:!0}}),Xt&&ce(It,Xt)}function ce(It,Xt){return ce=Object.setPrototypeOf||function(cn,Jt){return cn.__proto__=Jt,cn},ce(It,Xt)}function re(It,Xt,$t){return Xt in It?Object.defineProperty(It,Xt,{value:$t,enumerable:!0,configurable:!0,writable:!0}):It[Xt]=$t,It}var ue=[0,0,0,153],se=[0,0,0,144],me=[0,0,0,255],Ce=[0,0,144,144],be=[144,144,144,255],Ye=[144,144,144,144],tt=[192,0,0,255],pt=[0,0,0,128],Ee=[124,0,192,255],Ne=[255,255,255,255],Be=5,qe=3,ct=7,Ct=32*r.PROJECTED_PIXEL_SIZE_MULTIPLIER,Dt=n.DrawPolygonMode;function In(It){return!It||typeof It!="function"?It:function(Xt){return It(Mn(Xt))}}function Mn(It){return It.__source?It.__source.object:It.sourceFeature?It.sourceFeature.feature:It}function Tn(It){switch(It.properties.editHandleType){case"existing":return tt;case"snap-source":return Ee;case"intermediate":default:return pt}}function Nt(It){return Ne}function Zt(It){switch(It.properties.editHandleType){case"existing":return Be;case"snap":return ct;case"intermediate":default:return qe}}var Wt={mode:Dt,onEdit:function(){},pickable:!0,pickingRadius:10,pickingDepth:5,fp64:!1,filled:!0,stroked:!0,lineWidthScale:r.PROJECTED_PIXEL_SIZE_MULTIPLIER,lineWidthMinPixels:1,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,pickingLineWidthExtraPixels:0,lineWidthUnits:"pixels",lineJointRounded:!1,lineCapRounded:!1,lineMiterLimit:4,pointRadiusScale:1,pointRadiusMinPixels:2,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,getLineColor:function(Xt,$t,cn){return $t?me:ue},getFillColor:function(Xt,$t,cn){return $t?Ce:se},getRadius:function(Xt){return Xt&&Xt.properties&&Xt.properties.radius||Xt&&Xt.properties&&Xt.properties.size||1},getLineWidth:function(Xt){return Xt&&Xt.properties&&Xt.properties.lineWidth||3},getTentativeLineColor:function(Xt){return be},getTentativeFillColor:function(Xt){return Ye},getTentativeLineWidth:function(Xt){return Xt&&Xt.properties&&Xt.properties.lineWidth||3},editHandleType:"point",editHandlePointRadiusScale:1,editHandlePointOutline:!0,editHandlePointStrokeWidth:2,editHandlePointRadiusUnits:"pixels",editHandlePointRadiusMinPixels:4,editHandlePointRadiusMaxPixels:8,getEditHandlePointColor:Tn,getEditHandlePointOutlineColor:Nt,getEditHandlePointRadius:Zt,editHandleIconAtlas:null,editHandleIconMapping:null,editHandleIconSizeScale:1,editHandleIconSizeUnits:"pixels",getEditHandleIcon:function(Xt){return Xt.properties.editHandleType},getEditHandleIconSize:10,getEditHandleIconColor:Tn,getEditHandleIconAngle:0,billboard:!0},hn={view:n.ViewMode,modify:n.ModifyMode,translate:new n.SnappableMode(new n.TranslateMode),transform:new n.SnappableMode(new n.TransformMode),scale:n.ScaleMode,rotate:n.RotateMode,duplicate:n.DuplicateMode,split:n.SplitPolygonMode,extrude:n.ExtrudeMode,elevation:n.ElevationMode,drawPoint:n.DrawPointMode,drawLineString:n.DrawLineStringMode,drawPolygon:n.DrawPolygonMode,drawRectangle:n.DrawRectangleMode,drawSquare:n.DrawSquareMode,drawRectangleFromCenter:n.DrawRectangleFromCenterMode,drawSquareFromCenter:n.DrawSquareFromCenterMode,drawCircleFromCenter:n.DrawCircleFromCenterMode,drawCircleByBoundingBox:n.DrawCircleByDiameterMode,drawEllipseByBoundingBox:n.DrawEllipseByBoundingBoxMode,drawRectangleUsing3Points:n.DrawRectangleUsingThreePointsMode,drawEllipseUsing3Points:n.DrawEllipseUsingThreePointsMode,draw90DegreePolygon:n.Draw90DegreePolygonMode,drawPolygonByDragging:n.DrawPolygonByDraggingMode},lr=function(It){ie($t,It);var Xt=F($t);function $t(){return P(this,$t),Xt.apply(this,arguments)}return B($t,[{key:"renderLayers",value:function(){var Jt=this.getSubLayerProps({id:"geojson",data:this.props.data,fp64:this.props.fp64,filled:this.props.filled,stroked:this.props.stroked,lineWidthScale:this.props.lineWidthScale,lineWidthMinPixels:this.props.lineWidthMinPixels,lineWidthMaxPixels:this.props.lineWidthMaxPixels,lineWidthUnits:this.props.lineWidthUnits,lineJointRounded:this.props.lineJointRounded,lineCapRounded:this.props.lineCapRounded,lineMiterLimit:this.props.lineMiterLimit,pointRadiusScale:this.props.pointRadiusScale,pointRadiusMinPixels:this.props.pointRadiusMinPixels,pointRadiusMaxPixels:this.props.pointRadiusMaxPixels,getLineColor:this.selectionAwareAccessor(this.props.getLineColor),getFillColor:this.selectionAwareAccessor(this.props.getFillColor),getPointRadius:this.selectionAwareAccessor(this.props.getRadius),getLineWidth:this.selectionAwareAccessor(this.props.getLineWidth),_subLayerProps:{linestrings:{billboard:this.props.billboard,updateTriggers:{all:[this.props.selectedFeatureIndexes,this.props.mode]}},"polygons-stroke":{billboard:this.props.billboard,pickingLineWidthExtraPixels:this.props.pickingLineWidthExtraPixels,type:o.default,updateTriggers:{all:[this.props.selectedFeatureIndexes,this.props.mode]}}},updateTriggers:{getLineColor:[this.props.selectedFeatureIndexes,this.props.mode],getFillColor:[this.props.selectedFeatureIndexes,this.props.mode],getPointRadius:[this.props.selectedFeatureIndexes,this.props.mode],getLineWidth:[this.props.selectedFeatureIndexes,this.props.mode]}}),Ln=[new e.GeoJsonLayer(Jt)];return Ln=Ln.concat(this.createGuidesLayers(),this.createTooltipsLayers()),Ln}},{key:"initializeState",value:function(){V(J($t.prototype),"initializeState",this).call(this),this.setState({selectedFeatures:[],editHandles:[]})}},{key:"shouldUpdateState",value:function(Jt){return V(J($t.prototype),"shouldUpdateState",this).call(this,Jt)||Jt.changeFlags.stateChanged}},{key:"updateState",value:function(Jt){var Ln=Jt.props,qn=Jt.oldProps,or=Jt.changeFlags,cr=Jt.context;if(V(J($t.prototype),"updateState",this).call(this,{oldProps:qn,props:Ln,changeFlags:or,context:cr}),or.propsOrDataChanged){var cs=Object.keys(qn).length===0||Ln.mode!==qn.mode;if(cs){var Ri;if(typeof Ln.mode=="function"){var Do=Ln.mode;Ri=new Do}else typeof Ln.mode=="string"?(Ri=hn[Ln.mode],console.warn("Deprecated use of passing `mode` as a string. Pass the mode's class constructor instead.")):Ri=Ln.mode;Ri||(console.warn("No mode configured for ".concat(String(Ln.mode))),Ri=new Dt),Ri!==this.state.mode&&this.setState({mode:Ri,cursor:null})}}var Fa=[];Array.isArray(Ln.selectedFeatureIndexes)&&(Fa=Ln.selectedFeatureIndexes.map(function(Nl){return Ln.data.features[Nl]})),this.setState({selectedFeatures:Fa})}},{key:"getModeProps",value:function(Jt){var Ln=this;return{modeConfig:Jt.modeConfig,data:Jt.data,selectedIndexes:Jt.selectedFeatureIndexes,lastPointerMoveEvent:this.state.lastPointerMoveEvent,cursor:this.state.cursor,onEdit:function(or){Ln.setNeedsUpdate(),Jt.onEdit(or)},onUpdateCursor:function(or){Ln.setState({cursor:or})}}}},{key:"selectionAwareAccessor",value:function(Jt){var Ln=this;return typeof Jt!="function"?Jt:function(qn){return Jt(qn,Ln.isFeatureSelected(qn),Ln.props.mode)}}},{key:"isFeatureSelected",value:function(Jt){if(!this.props.data||!this.props.selectedFeatureIndexes||!this.props.selectedFeatureIndexes.length)return!1;var Ln=this.props.data.features.indexOf(Jt);return this.props.selectedFeatureIndexes.includes(Ln)}},{key:"getPickingInfo",value:function(Jt){var Ln=Jt.info,qn=Jt.sourceLayer;return qn.id.endsWith("guides")&&(Ln.isGuide=!0),Ln}},{key:"_updateAutoHighlight",value:function(Jt){if(Jt!=null&&Jt.sourceLayer)if(Jt.isGuide){var Ln=g(Jt.sourceLayer.getSubLayers()),qn;try{for(Ln.s();!(qn=Ln.n()).done;){var or=qn.value;or.updateAutoHighlight(Jt)}}catch(cr){Ln.e(cr)}finally{Ln.f()}}else Jt.sourceLayer.updateAutoHighlight(Jt)}},{key:"createGuidesLayers",value:function(){var Jt=this.getActiveMode(),Ln=Jt.getGuides(this.getModeProps(this.props));if(!Ln||!Ln.features.length)return[];var qn={linestrings:{billboard:this.props.billboard,autoHighlight:!1},"polygons-fill":{autoHighlight:!1},"polygons-stroke":{billboard:this.props.billboard}};this.props.editHandleType==="icon"?qn["points-icon"]={type:e.IconLayer,iconAtlas:this.props.editHandleIconAtlas,iconMapping:this.props.editHandleIconMapping,sizeUnits:this.props.editHandleIconSizeUnits,sizeScale:this.props.editHandleIconSizeScale,getIcon:In(this.props.getEditHandleIcon),getSize:In(this.props.getEditHandleIconSize),getColor:In(this.props.getEditHandleIconColor),getAngle:In(this.props.getEditHandleIconAngle)}:qn["points-circle"]={type:e.ScatterplotLayer,radiusScale:this.props.editHandlePointRadiusScale,stroked:this.props.editHandlePointOutline,getLineWidth:this.props.editHandlePointStrokeWidth,radiusUnits:this.props.editHandlePointRadiusUnits,radiusMinPixels:this.props.editHandlePointRadiusMinPixels,radiusMaxPixels:this.props.editHandlePointRadiusMaxPixels,getRadius:In(this.props.getEditHandlePointRadius),getFillColor:In(this.props.getEditHandlePointColor),getLineColor:In(this.props.getEditHandlePointOutlineColor)};var or=new e.GeoJsonLayer(this.getSubLayerProps({id:"guides",data:Ln,fp64:this.props.fp64,_subLayerProps:qn,lineWidthScale:this.props.lineWidthScale,lineWidthMinPixels:this.props.lineWidthMinPixels,lineWidthMaxPixels:this.props.lineWidthMaxPixels,lineWidthUnits:this.props.lineWidthUnits,lineJointRounded:this.props.lineJointRounded,lineCapRounded:this.props.lineCapRounded,lineMiterLimit:this.props.lineMiterLimit,getLineColor:In(this.props.getTentativeLineColor),getLineWidth:In(this.props.getTentativeLineWidth),getFillColor:In(this.props.getTentativeFillColor),pointType:this.props.editHandleType==="icon"?"icon":"circle",iconAtlas:this.props.editHandleIconAtlas}));return[or]}},{key:"createTooltipsLayers",value:function(){var Jt=this.getActiveMode(),Ln=Jt.getTooltips(this.getModeProps(this.props)),qn=new e.TextLayer(d({getSize:Ct},this.getSubLayerProps({id:"tooltips",data:Ln})));return[qn]}},{key:"onLayerClick",value:function(Jt){this.getActiveMode().handleClick(Jt,this.getModeProps(this.props))}},{key:"onLayerKeyUp",value:function(Jt){this.getActiveMode().handleKeyUp(Jt,this.getModeProps(this.props))}},{key:"onStartDragging",value:function(Jt){this.getActiveMode().handleStartDragging(Jt,this.getModeProps(this.props))}},{key:"onDragging",value:function(Jt){this.getActiveMode().handleDragging(Jt,this.getModeProps(this.props))}},{key:"onStopDragging",value:function(Jt){this.getActiveMode().handleStopDragging(Jt,this.getModeProps(this.props))}},{key:"onPointerMove",value:function(Jt){this.setState({lastPointerMoveEvent:Jt}),this.getActiveMode().handlePointerMove(Jt,this.getModeProps(this.props))}},{key:"getCursor",value:function(Jt){var Ln=Jt.isDragging;if(this.state===null||this.state===void 0)return null;var qn=this.state.cursor;return qn||(qn=Ln?"grabbing":"grab"),qn}},{key:"getActiveMode",value:function(){return this.state.mode}}]),$t}(i.default);t.default=lr,re(lr,"layerName","EditableGeoJsonLayer"),re(lr,"defaultProps",Wt)})(GR);var boe={},$6={},JR={};(function(t){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",r="["+e+"]["+n+"]*",i=new RegExp("^"+r+"$"),o=function(s,u){const d=[];let g=u.exec(s);for(;g;){const _=[];_.startIndex=u.lastIndex-g[0].length;const E=g.length;for(let P=0;P<E;P++)_.push(g[P]);d.push(_),g=u.exec(s)}return d},a=function(s){const u=i.exec(s);return!(u===null||typeof u>"u")};t.isExist=function(s){return typeof s<"u"},t.isEmptyObject=function(s){return Object.keys(s).length===0},t.merge=function(s,u,d){if(u){const g=Object.keys(u),_=g.length;for(let E=0;E<_;E++)d==="strict"?s[g[E]]=[u[g[E]]]:s[g[E]]=u[g[E]]}},t.getValue=function(s){return t.isExist(s)?s:""},t.isName=a,t.getAllMatches=o,t.nameRegexp=r})(JR);const H6=JR,i6e={allowBooleanAttributes:!1,unpairedTags:[]};$6.validate=function(t,e){e=Object.assign({},i6e,e);const n=[];let r=!1,i=!1;t[0]==="\uFEFF"&&(t=t.substr(1));for(let o=0;o<t.length;o++)if(t[o]==="<"&&t[o+1]==="?"){if(o+=2,o=HW(t,o),o.err)return o}else if(t[o]==="<"){let a=o;if(o++,t[o]==="!"){o=WW(t,o);continue}else{let s=!1;t[o]==="/"&&(s=!0,o++);let u="";for(;o<t.length&&t[o]!==">"&&t[o]!==" "&&t[o]!=="	"&&t[o]!==`
`&&t[o]!=="\r";o++)u+=t[o];if(u=u.trim(),u[u.length-1]==="/"&&(u=u.substring(0,u.length-1),o--),!h6e(u)){let _;return u.trim().length===0?_="Invalid space after '<'.":_="Tag '"+u+"' is an invalid name.",zs("InvalidTag",_,xu(t,o))}const d=a6e(t,o);if(d===!1)return zs("InvalidAttr","Attributes for '"+u+"' have open quote.",xu(t,o));let g=d.value;if(o=d.index,g[g.length-1]==="/"){const _=o-g.length;g=g.substring(0,g.length-1);const E=qW(g,e);if(E===!0)r=!0;else return zs(E.err.code,E.err.msg,xu(t,_+E.err.line))}else if(s)if(d.tagClosed){if(g.trim().length>0)return zs("InvalidTag","Closing tag '"+u+"' can't have attributes or invalid starting.",xu(t,a));{const _=n.pop();if(u!==_.tagName){let E=xu(t,_.tagStartPos);return zs("InvalidTag","Expected closing tag '"+_.tagName+"' (opened in line "+E.line+", col "+E.col+") instead of closing tag '"+u+"'.",xu(t,a))}n.length==0&&(i=!0)}}else return zs("InvalidTag","Closing tag '"+u+"' doesn't have proper closing.",xu(t,o));else{const _=qW(g,e);if(_!==!0)return zs(_.err.code,_.err.msg,xu(t,o-g.length+_.err.line));if(i===!0)return zs("InvalidXml","Multiple possible root nodes found.",xu(t,o));e.unpairedTags.indexOf(u)!==-1||n.push({tagName:u,tagStartPos:a}),r=!0}for(o++;o<t.length;o++)if(t[o]==="<")if(t[o+1]==="!"){o++,o=WW(t,o);continue}else if(t[o+1]==="?"){if(o=HW(t,++o),o.err)return o}else break;else if(t[o]==="&"){const _=c6e(t,o);if(_==-1)return zs("InvalidChar","char '&' is not expected.",xu(t,o));o=_}else if(i===!0&&!$W(t[o]))return zs("InvalidXml","Extra text at the end",xu(t,o));t[o]==="<"&&o--}}else{if($W(t[o]))continue;return zs("InvalidChar","char '"+t[o]+"' is not expected.",xu(t,o))}if(r){if(n.length==1)return zs("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",xu(t,n[0].tagStartPos));if(n.length>0)return zs("InvalidXml","Invalid '"+JSON.stringify(n.map(o=>o.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return zs("InvalidXml","Start tag expected.",1);return!0};function $W(t){return t===" "||t==="	"||t===`
`||t==="\r"}function HW(t,e){const n=e;for(;e<t.length;e++)if(t[e]=="?"||t[e]==" "){const r=t.substr(n,e-n);if(e>5&&r==="xml")return zs("InvalidXml","XML declaration allowed only at the start of the document.",xu(t,e));if(t[e]=="?"&&t[e+1]==">"){e++;break}else continue}return e}function WW(t,e){if(t.length>e+5&&t[e+1]==="-"&&t[e+2]==="-"){for(e+=3;e<t.length;e++)if(t[e]==="-"&&t[e+1]==="-"&&t[e+2]===">"){e+=2;break}}else if(t.length>e+8&&t[e+1]==="D"&&t[e+2]==="O"&&t[e+3]==="C"&&t[e+4]==="T"&&t[e+5]==="Y"&&t[e+6]==="P"&&t[e+7]==="E"){let n=1;for(e+=8;e<t.length;e++)if(t[e]==="<")n++;else if(t[e]===">"&&(n--,n===0))break}else if(t.length>e+9&&t[e+1]==="["&&t[e+2]==="C"&&t[e+3]==="D"&&t[e+4]==="A"&&t[e+5]==="T"&&t[e+6]==="A"&&t[e+7]==="["){for(e+=8;e<t.length;e++)if(t[e]==="]"&&t[e+1]==="]"&&t[e+2]===">"){e+=2;break}}return e}const o6e='"',s6e="'";function a6e(t,e){let n="",r="",i=!1;for(;e<t.length;e++){if(t[e]===o6e||t[e]===s6e)r===""?r=t[e]:r!==t[e]||(r="");else if(t[e]===">"&&r===""){i=!0;break}n+=t[e]}return r!==""?!1:{value:n,index:e,tagClosed:i}}const l6e=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function qW(t,e){const n=H6.getAllMatches(t,l6e),r={};for(let i=0;i<n.length;i++){if(n[i][1].length===0)return zs("InvalidAttr","Attribute '"+n[i][2]+"' has no space in starting.",xb(n[i]));if(n[i][3]!==void 0&&n[i][4]===void 0)return zs("InvalidAttr","Attribute '"+n[i][2]+"' is without value.",xb(n[i]));if(n[i][3]===void 0&&!e.allowBooleanAttributes)return zs("InvalidAttr","boolean attribute '"+n[i][2]+"' is not allowed.",xb(n[i]));const o=n[i][2];if(!f6e(o))return zs("InvalidAttr","Attribute '"+o+"' is an invalid name.",xb(n[i]));if(!r.hasOwnProperty(o))r[o]=1;else return zs("InvalidAttr","Attribute '"+o+"' is repeated.",xb(n[i]))}return!0}function u6e(t,e){let n=/\d/;for(t[e]==="x"&&(e++,n=/[\da-fA-F]/);e<t.length;e++){if(t[e]===";")return e;if(!t[e].match(n))break}return-1}function c6e(t,e){if(e++,t[e]===";")return-1;if(t[e]==="#")return e++,u6e(t,e);let n=0;for(;e<t.length;e++,n++)if(!(t[e].match(/\w/)&&n<20)){if(t[e]===";")break;return-1}return e}function zs(t,e,n){return{err:{code:t,msg:e,line:n.line||n,col:n.col}}}function f6e(t){return H6.isName(t)}function h6e(t){return H6.isName(t)}function xu(t,e){const n=t.substring(0,e).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function xb(t){return t.startIndex+t[1].length}var W6={};const woe={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(t,e,n){return t}},d6e=function(t){return Object.assign({},woe,t)};W6.buildOptions=d6e;W6.defaultOptions=woe;class p6e{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,n){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:n})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}var g6e=p6e;const m6e=JR;function A6e(t,e){const n={};if(t[e+3]==="O"&&t[e+4]==="C"&&t[e+5]==="T"&&t[e+6]==="Y"&&t[e+7]==="P"&&t[e+8]==="E"){e=e+9;let r=1,i=!1,o=!1,a="";for(;e<t.length;e++)if(t[e]==="<"&&!o){if(i&&v6e(t,e))e+=7,[entityName,val,e]=_6e(t,e+1),val.indexOf("&")===-1&&(n[E6e(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(i&&x6e(t,e))e+=8;else if(i&&b6e(t,e))e+=8;else if(i&&w6e(t,e))e+=9;else if(y6e)o=!0;else throw new Error("Invalid DOCTYPE");r++,a=""}else if(t[e]===">"){if(o?t[e-1]==="-"&&t[e-2]==="-"&&(o=!1,r--):r--,r===0)break}else t[e]==="["?i=!0:a+=t[e];if(r!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:n,i:e}}function _6e(t,e){let n="";for(;e<t.length&&t[e]!=="'"&&t[e]!=='"';e++)n+=t[e];if(n=n.trim(),n.indexOf(" ")!==-1)throw new Error("External entites are not supported");const r=t[e++];let i="";for(;e<t.length&&t[e]!==r;e++)i+=t[e];return[n,i,e]}function y6e(t,e){return t[e+1]==="!"&&t[e+2]==="-"&&t[e+3]==="-"}function v6e(t,e){return t[e+1]==="!"&&t[e+2]==="E"&&t[e+3]==="N"&&t[e+4]==="T"&&t[e+5]==="I"&&t[e+6]==="T"&&t[e+7]==="Y"}function x6e(t,e){return t[e+1]==="!"&&t[e+2]==="E"&&t[e+3]==="L"&&t[e+4]==="E"&&t[e+5]==="M"&&t[e+6]==="E"&&t[e+7]==="N"&&t[e+8]==="T"}function b6e(t,e){return t[e+1]==="!"&&t[e+2]==="A"&&t[e+3]==="T"&&t[e+4]==="T"&&t[e+5]==="L"&&t[e+6]==="I"&&t[e+7]==="S"&&t[e+8]==="T"}function w6e(t,e){return t[e+1]==="!"&&t[e+2]==="N"&&t[e+3]==="O"&&t[e+4]==="T"&&t[e+5]==="A"&&t[e+6]==="T"&&t[e+7]==="I"&&t[e+8]==="O"&&t[e+9]==="N"}function E6e(t){if(m6e.isName(t))return t;throw new Error(`Invalid entity name ${t}`)}var S6e=A6e;const T6e=/^[-+]?0x[a-fA-F0-9]+$/,C6e=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const P6e={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function I6e(t,e={}){if(e=Object.assign({},P6e,e),!t||typeof t!="string")return t;let n=t.trim();if(e.skipLike!==void 0&&e.skipLike.test(n))return t;if(e.hex&&T6e.test(n))return Number.parseInt(n,16);{const r=C6e.exec(n);if(r){const i=r[1],o=r[2];let a=M6e(r[3]);const s=r[4]||r[6];if(!e.leadingZeros&&o.length>0&&i&&n[2]!==".")return t;if(!e.leadingZeros&&o.length>0&&!i&&n[1]!==".")return t;{const u=Number(n),d=""+u;return d.search(/[eE]/)!==-1||s?e.eNotation?u:t:n.indexOf(".")!==-1?d==="0"&&a===""||d===a||i&&d==="-"+a?u:t:o?a===d||i+a===d?u:t:n===d||n===i+d?u:t}}else return t}}function M6e(t){return t&&t.indexOf(".")!==-1&&(t=t.replace(/0+$/,""),t==="."?t="0":t[0]==="."?t="0"+t:t[t.length-1]==="."&&(t=t.substr(0,t.length-1))),t}var O6e=I6e;const q6=JR,bb=g6e,R6e=S6e,L6e=O6e;"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,q6.nameRegexp);let D6e=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=B6e,this.parseXml=U6e,this.parseTextData=N6e,this.resolveNameSpace=F6e,this.buildAttributesMap=z6e,this.isItStopNode=$6e,this.replaceEntitiesValue=j6e,this.readStopNodeData=W6e,this.saveTextToParentTag=V6e,this.addChild=G6e}};function B6e(t){const e=Object.keys(t);for(let n=0;n<e.length;n++){const r=e[n];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:t[r]}}}function N6e(t,e,n,r,i,o,a){if(t!==void 0&&(this.options.trimValues&&!r&&(t=t.trim()),t.length>0)){a||(t=this.replaceEntitiesValue(t));const s=this.options.tagValueProcessor(e,t,n,i,o);return s==null?t:typeof s!=typeof t||s!==t?s:this.options.trimValues?y4(t,this.options.parseTagValue,this.options.numberParseOptions):t.trim()===t?y4(t,this.options.parseTagValue,this.options.numberParseOptions):t}}function F6e(t){if(this.options.removeNSPrefix){const e=t.split(":"),n=t.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(t=n+e[1])}return t}const k6e=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function z6e(t,e,n){if(!this.options.ignoreAttributes&&typeof t=="string"){const r=q6.getAllMatches(t,k6e),i=r.length,o={};for(let a=0;a<i;a++){const s=this.resolveNameSpace(r[a][1]);let u=r[a][4],d=this.options.attributeNamePrefix+s;if(s.length)if(this.options.transformAttributeName&&(d=this.options.transformAttributeName(d)),d==="__proto__"&&(d="#__proto__"),u!==void 0){this.options.trimValues&&(u=u.trim()),u=this.replaceEntitiesValue(u);const g=this.options.attributeValueProcessor(s,u,e);g==null?o[d]=u:typeof g!=typeof u||g!==u?o[d]=g:o[d]=y4(u,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(o[d]=!0)}if(!Object.keys(o).length)return;if(this.options.attributesGroupName){const a={};return a[this.options.attributesGroupName]=o,a}return o}}const U6e=function(t){t=t.replace(/\r\n?/g,`
`);const e=new bb("!xml");let n=e,r="",i="";for(let o=0;o<t.length;o++)if(t[o]==="<")if(t[o+1]==="/"){const s=b0(t,">",o,"Closing Tag is not closed.");let u=t.substring(o+2,s).trim();if(this.options.removeNSPrefix){const _=u.indexOf(":");_!==-1&&(u=u.substr(_+1))}this.options.transformTagName&&(u=this.options.transformTagName(u)),n&&(r=this.saveTextToParentTag(r,n,i));const d=i.substring(i.lastIndexOf(".")+1);if(u&&this.options.unpairedTags.indexOf(u)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${u}>`);let g=0;d&&this.options.unpairedTags.indexOf(d)!==-1?(g=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):g=i.lastIndexOf("."),i=i.substring(0,g),n=this.tagsNodeStack.pop(),r="",o=s}else if(t[o+1]==="?"){let s=_4(t,o,!1,"?>");if(!s)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,n,i),!(this.options.ignoreDeclaration&&s.tagName==="?xml"||this.options.ignorePiTags)){const u=new bb(s.tagName);u.add(this.options.textNodeName,""),s.tagName!==s.tagExp&&s.attrExpPresent&&(u[":@"]=this.buildAttributesMap(s.tagExp,i,s.tagName)),this.addChild(n,u,i)}o=s.closeIndex+1}else if(t.substr(o+1,3)==="!--"){const s=b0(t,"-->",o+4,"Comment is not closed.");if(this.options.commentPropName){const u=t.substring(o+4,s-2);r=this.saveTextToParentTag(r,n,i),n.add(this.options.commentPropName,[{[this.options.textNodeName]:u}])}o=s}else if(t.substr(o+1,2)==="!D"){const s=R6e(t,o);this.docTypeEntities=s.entities,o=s.i}else if(t.substr(o+1,2)==="!["){const s=b0(t,"]]>",o,"CDATA is not closed.")-2,u=t.substring(o+9,s);if(r=this.saveTextToParentTag(r,n,i),this.options.cdataPropName)n.add(this.options.cdataPropName,[{[this.options.textNodeName]:u}]);else{let d=this.parseTextData(u,n.tagname,i,!0,!1,!0);d==null&&(d=""),n.add(this.options.textNodeName,d)}o=s+2}else{let s=_4(t,o,this.options.removeNSPrefix),u=s.tagName;const d=s.rawTagName;let g=s.tagExp,_=s.attrExpPresent,E=s.closeIndex;this.options.transformTagName&&(u=this.options.transformTagName(u)),n&&r&&n.tagname!=="!xml"&&(r=this.saveTextToParentTag(r,n,i,!1));const P=n;if(P&&this.options.unpairedTags.indexOf(P.tagname)!==-1&&(n=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),u!==e.tagname&&(i+=i?"."+u:u),this.isItStopNode(this.options.stopNodes,i,u)){let R="";if(g.length>0&&g.lastIndexOf("/")===g.length-1)o=s.closeIndex;else if(this.options.unpairedTags.indexOf(u)!==-1)o=s.closeIndex;else{const V=this.readStopNodeData(t,d,E+1);if(!V)throw new Error(`Unexpected end of ${d}`);o=V.i,R=V.tagContent}const B=new bb(u);u!==g&&_&&(B[":@"]=this.buildAttributesMap(g,i,u)),R&&(R=this.parseTextData(R,u,i,!0,_,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),B.add(this.options.textNodeName,R),this.addChild(n,B,i)}else{if(g.length>0&&g.lastIndexOf("/")===g.length-1){u[u.length-1]==="/"?(u=u.substr(0,u.length-1),i=i.substr(0,i.length-1),g=u):g=g.substr(0,g.length-1),this.options.transformTagName&&(u=this.options.transformTagName(u));const R=new bb(u);u!==g&&_&&(R[":@"]=this.buildAttributesMap(g,i,u)),this.addChild(n,R,i),i=i.substr(0,i.lastIndexOf("."))}else{const R=new bb(u);this.tagsNodeStack.push(n),u!==g&&_&&(R[":@"]=this.buildAttributesMap(g,i,u)),this.addChild(n,R,i),n=R}r="",o=E}}else r+=t[o];return e.child};function G6e(t,e,n){const r=this.options.updateTag(e.tagname,n,e[":@"]);r===!1||(typeof r=="string"&&(e.tagname=r),t.addChild(e))}const j6e=function(t){if(this.options.processEntities){for(let e in this.docTypeEntities){const n=this.docTypeEntities[e];t=t.replace(n.regx,n.val)}for(let e in this.lastEntities){const n=this.lastEntities[e];t=t.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const n=this.htmlEntities[e];t=t.replace(n.regex,n.val)}t=t.replace(this.ampEntity.regex,this.ampEntity.val)}return t};function V6e(t,e,n,r){return t&&(r===void 0&&(r=Object.keys(e.child).length===0),t=this.parseTextData(t,e.tagname,n,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,r),t!==void 0&&t!==""&&e.add(this.options.textNodeName,t),t=""),t}function $6e(t,e,n){const r="*."+n;for(const i in t){const o=t[i];if(r===o||e===o)return!0}return!1}function H6e(t,e,n=">"){let r,i="";for(let o=e;o<t.length;o++){let a=t[o];if(r)a===r&&(r="");else if(a==='"'||a==="'")r=a;else if(a===n[0])if(n[1]){if(t[o+1]===n[1])return{data:i,index:o}}else return{data:i,index:o};else a==="	"&&(a=" ");i+=a}}function b0(t,e,n,r){const i=t.indexOf(e,n);if(i===-1)throw new Error(r);return i+e.length-1}function _4(t,e,n,r=">"){const i=H6e(t,e+1,r);if(!i)return;let o=i.data;const a=i.index,s=o.search(/\s/);let u=o,d=!0;s!==-1&&(u=o.substr(0,s).replace(/\s\s*$/,""),o=o.substr(s+1));const g=u;if(n){const _=u.indexOf(":");_!==-1&&(u=u.substr(_+1),d=u!==i.data.substr(_+1))}return{tagName:u,tagExp:o,closeIndex:a,attrExpPresent:d,rawTagName:g}}function W6e(t,e,n){const r=n;let i=1;for(;n<t.length;n++)if(t[n]==="<")if(t[n+1]==="/"){const o=b0(t,">",n,`${e} is not closed`);if(t.substring(n+2,o).trim()===e&&(i--,i===0))return{tagContent:t.substring(r,n),i:o};n=o}else if(t[n+1]==="?")n=b0(t,"?>",n+1,"StopNode is not closed.");else if(t.substr(n+1,3)==="!--")n=b0(t,"-->",n+3,"StopNode is not closed.");else if(t.substr(n+1,2)==="![")n=b0(t,"]]>",n,"StopNode is not closed.")-2;else{const o=_4(t,n,">");o&&((o&&o.tagName)===e&&o.tagExp[o.tagExp.length-1]!=="/"&&i++,n=o.closeIndex)}}function y4(t,e,n){if(e&&typeof t=="string"){const r=t.trim();return r==="true"?!0:r==="false"?!1:L6e(t,n)}else return q6.isExist(t)?t:""}var q6e=D6e,Eoe={};function X6e(t,e){return Soe(t,e)}function Soe(t,e,n){let r;const i={};for(let o=0;o<t.length;o++){const a=t[o],s=Z6e(a);let u="";if(n===void 0?u=s:u=n+"."+s,s===e.textNodeName)r===void 0?r=a[s]:r+=""+a[s];else{if(s===void 0)continue;if(a[s]){let d=Soe(a[s],e,u);const g=Q6e(d,e);a[":@"]?Y6e(d,a[":@"],u,e):Object.keys(d).length===1&&d[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?d=d[e.textNodeName]:Object.keys(d).length===0&&(e.alwaysCreateTextNode?d[e.textNodeName]="":d=""),i[s]!==void 0&&i.hasOwnProperty(s)?(Array.isArray(i[s])||(i[s]=[i[s]]),i[s].push(d)):e.isArray(s,u,g)?i[s]=[d]:i[s]=d}}}return typeof r=="string"?r.length>0&&(i[e.textNodeName]=r):r!==void 0&&(i[e.textNodeName]=r),i}function Z6e(t){const e=Object.keys(t);for(let n=0;n<e.length;n++){const r=e[n];if(r!==":@")return r}}function Y6e(t,e,n,r){if(e){const i=Object.keys(e),o=i.length;for(let a=0;a<o;a++){const s=i[a];r.isArray(s,n+"."+s,!0,!0)?t[s]=[e[s]]:t[s]=e[s]}}}function Q6e(t,e){const{textNodeName:n}=e,r=Object.keys(t).length;return!!(r===0||r===1&&(t[n]||typeof t[n]=="boolean"||t[n]===0))}Eoe.prettify=X6e;const{buildOptions:K6e}=W6,J6e=q6e,{prettify:eUe}=Eoe,tUe=$6;let nUe=class{constructor(e){this.externalEntities={},this.options=K6e(e)}parse(e,n){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(n){n===!0&&(n={});const o=tUe.validate(e,n);if(o!==!0)throw Error(`${o.err.msg}:${o.err.line}:${o.err.col}`)}const r=new J6e(this.options);r.addExternalEntities(this.externalEntities);const i=r.parseXml(e);return this.options.preserveOrder||i===void 0?i:eUe(i,this.options)}addEntity(e,n){if(n.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(n==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=n}};var rUe=nUe;const iUe=`
`;function oUe(t,e){let n="";return e.format&&e.indentBy.length>0&&(n=iUe),Toe(t,e,"",n)}function Toe(t,e,n,r){let i="",o=!1;for(let a=0;a<t.length;a++){const s=t[a],u=sUe(s);if(u===void 0)continue;let d="";if(n.length===0?d=u:d=`${n}.${u}`,u===e.textNodeName){let R=s[u];aUe(d,e)||(R=e.tagValueProcessor(u,R),R=Coe(R,e)),o&&(i+=r),i+=R,o=!1;continue}else if(u===e.cdataPropName){o&&(i+=r),i+=`<![CDATA[${s[u][0][e.textNodeName]}]]>`,o=!1;continue}else if(u===e.commentPropName){i+=r+`<!--${s[u][0][e.textNodeName]}-->`,o=!0;continue}else if(u[0]==="?"){const R=XW(s[":@"],e),B=u==="?xml"?"":r;let V=s[u][0][e.textNodeName];V=V.length!==0?" "+V:"",i+=B+`<${u}${V}${R}?>`,o=!0;continue}let g=r;g!==""&&(g+=e.indentBy);const _=XW(s[":@"],e),E=r+`<${u}${_}`,P=Toe(s[u],e,d,g);e.unpairedTags.indexOf(u)!==-1?e.suppressUnpairedNode?i+=E+">":i+=E+"/>":(!P||P.length===0)&&e.suppressEmptyNode?i+=E+"/>":P&&P.endsWith(">")?i+=E+`>${P}${r}</${u}>`:(i+=E+">",P&&r!==""&&(P.includes("/>")||P.includes("</"))?i+=r+e.indentBy+P+r:i+=P,i+=`</${u}>`),o=!0}return i}function sUe(t){const e=Object.keys(t);for(let n=0;n<e.length;n++){const r=e[n];if(t.hasOwnProperty(r)&&r!==":@")return r}}function XW(t,e){let n="";if(t&&!e.ignoreAttributes)for(let r in t){if(!t.hasOwnProperty(r))continue;let i=e.attributeValueProcessor(r,t[r]);i=Coe(i,e),i===!0&&e.suppressBooleanAttributes?n+=` ${r.substr(e.attributeNamePrefix.length)}`:n+=` ${r.substr(e.attributeNamePrefix.length)}="${i}"`}return n}function aUe(t,e){t=t.substr(0,t.length-e.textNodeName.length-1);let n=t.substr(t.lastIndexOf(".")+1);for(let r in e.stopNodes)if(e.stopNodes[r]===t||e.stopNodes[r]==="*."+n)return!0;return!1}function Coe(t,e){if(t&&t.length>0&&e.processEntities)for(let n=0;n<e.entities.length;n++){const r=e.entities[n];t=t.replace(r.regex,r.val)}return t}var lUe=oUe;const uUe=lUe,cUe={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function wA(t){this.options=Object.assign({},cUe,t),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=dUe),this.processTextOrObjNode=fUe,this.options.format?(this.indentate=hUe,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}wA.prototype.build=function(t){return this.options.preserveOrder?uUe(t,this.options):(Array.isArray(t)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(t={[this.options.arrayNodeName]:t}),this.j2x(t,0).val)};wA.prototype.j2x=function(t,e){let n="",r="";for(let i in t)if(Object.prototype.hasOwnProperty.call(t,i))if(typeof t[i]>"u")this.isAttribute(i)&&(r+="");else if(t[i]===null)this.isAttribute(i)?r+="":i[0]==="?"?r+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:r+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(t[i]instanceof Date)r+=this.buildTextValNode(t[i],i,"",e);else if(typeof t[i]!="object"){const o=this.isAttribute(i);if(o)n+=this.buildAttrPairStr(o,""+t[i]);else if(i===this.options.textNodeName){let a=this.options.tagValueProcessor(i,""+t[i]);r+=this.replaceEntitiesValue(a)}else r+=this.buildTextValNode(t[i],i,"",e)}else if(Array.isArray(t[i])){const o=t[i].length;let a="";for(let s=0;s<o;s++){const u=t[i][s];typeof u>"u"||(u===null?i[0]==="?"?r+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:r+=this.indentate(e)+"<"+i+"/"+this.tagEndChar:typeof u=="object"?this.options.oneListGroup?a+=this.j2x(u,e+1).val:a+=this.processTextOrObjNode(u,i,e):a+=this.buildTextValNode(u,i,"",e))}this.options.oneListGroup&&(a=this.buildObjectNode(a,i,"",e)),r+=a}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const o=Object.keys(t[i]),a=o.length;for(let s=0;s<a;s++)n+=this.buildAttrPairStr(o[s],""+t[i][o[s]])}else r+=this.processTextOrObjNode(t[i],i,e);return{attrStr:n,val:r}};wA.prototype.buildAttrPairStr=function(t,e){return e=this.options.attributeValueProcessor(t,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+t:" "+t+'="'+e+'"'};function fUe(t,e,n){const r=this.j2x(t,n+1);return t[this.options.textNodeName]!==void 0&&Object.keys(t).length===1?this.buildTextValNode(t[this.options.textNodeName],e,r.attrStr,n):this.buildObjectNode(r.val,e,r.attrStr,n)}wA.prototype.buildObjectNode=function(t,e,n,r){if(t==="")return e[0]==="?"?this.indentate(r)+"<"+e+n+"?"+this.tagEndChar:this.indentate(r)+"<"+e+n+this.closeTag(e)+this.tagEndChar;{let i="</"+e+this.tagEndChar,o="";return e[0]==="?"&&(o="?",i=""),(n||n==="")&&t.indexOf("<")===-1?this.indentate(r)+"<"+e+n+o+">"+t+i:this.options.commentPropName!==!1&&e===this.options.commentPropName&&o.length===0?this.indentate(r)+`<!--${t}-->`+this.newLine:this.indentate(r)+"<"+e+n+o+this.tagEndChar+t+this.indentate(r)+i}};wA.prototype.closeTag=function(t){let e="";return this.options.unpairedTags.indexOf(t)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${t}`,e};wA.prototype.buildTextValNode=function(t,e,n,r){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(r)+`<![CDATA[${t}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(r)+`<!--${t}-->`+this.newLine;if(e[0]==="?")return this.indentate(r)+"<"+e+n+"?"+this.tagEndChar;{let i=this.options.tagValueProcessor(e,t);return i=this.replaceEntitiesValue(i),i===""?this.indentate(r)+"<"+e+n+this.closeTag(e)+this.tagEndChar:this.indentate(r)+"<"+e+n+">"+i+"</"+e+this.tagEndChar}};wA.prototype.replaceEntitiesValue=function(t){if(t&&t.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const n=this.options.entities[e];t=t.replace(n.regex,n.val)}return t};function hUe(t){return this.options.indentBy.repeat(t)}function dUe(t){return t.startsWith(this.options.attributeNamePrefix)&&t!==this.options.textNodeName?t.substr(this.attrPrefixLen):!1}var pUe=wA;const gUe=$6,mUe=rUe,AUe=pUe;var _Ue={XMLParser:mUe,XMLValidator:gUe,XMLBuilder:AUe};function yUe(t,e){return new _Ue.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...e}).parse(t)}function vUe(t){return typeof t=="string"?t.charAt(0).toLowerCase()+t.slice(1):t}function v4(t){if(Array.isArray(t))return t.map(e=>v4(e));if(t&&typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))e[vUe(n)]=v4(r);return e}return t}const xUe="3.4.14",t_={name:"XML",id:"xml",module:"xml",version:xUe,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:bUe,options:{xml:{parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(t,e)=>ZW(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>ZW(t,e)};function bUe(t){return t.startsWith("<?xml")}function ZW(t,e){var n;const r={...t_.options.xml,...e==null?void 0:e.xml};switch(r.parser){case"fast-xml-parser":const i={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:r.removeNSPrefix,textNodeName:r.textNodeName,isArray:(a,s,u,d)=>{var g;return!!(!(r==null||(g=r.arrayPaths)===null||g===void 0)&&g.some(E=>s===E))},...e==null?void 0:e._fastXML},o=yUe(t,i);return r.uncapitalizeKeys?v4(o):o;default:throw new Error(e==null||(n=e.xml)===null||n===void 0?void 0:n.parser)}}function wUe(t,e){var n,r,i;const o=(n=t_.parseTextSync)===null||n===void 0?void 0:n.call(t_,t,e),a=(o==null||(r=o.ServiceExceptionReport)===null||r===void 0?void 0:r.ServiceException)||(o==null||(i=o["ogc:ServiceExceptionReport"])===null||i===void 0?void 0:i["ogc:ServiceException"]);return typeof a=="string"?a:a.value||a.code||"Unknown error"}const EUe="3.4.14",oP={id:"wms-error",name:"WMS Error",module:"wms",version:EUe,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:SUe,options:{wms:{throwOnError:!1}},parse:async(t,e)=>SB(new TextDecoder().decode(t),e),parseSync:(t,e)=>SB(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>SB(t,e)};function SUe(t){return t.startsWith("<?xml")}function SB(t,e){const n={...oP.options.wms,...e==null?void 0:e.wms},r=wUe(t,n),i=n.minimalErrors?r:"WMS Service error: ".concat(r);if(n.throwOnError)throw new Error(i);return i}function A1(t){return Array.isArray(t)?t:t?[t]:[]}function eL(t){const e=A1(t);return e.length>0&&e.every(n=>typeof n=="string")?e:[]}function rT(t){switch(typeof t){case"number":return t;case"string":return parseFloat(t);default:return}}function TB(t){switch(typeof t){case"number":return t;case"string":return parseInt(t,10);default:return}}function vv(t){switch(t){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function YW(t,e){const n=t_.parseTextSync(t,e),r=n.WMT_MS_Capabilities||n.WMS_Capabilities||n,i=TUe(r);if(e!=null&&e.inheritedLayerProps)for(const o of i.layers)Ioe(o,null);return(e!=null&&e.includeRawData||e!=null&&e.raw)&&(i.raw=r),e!=null&&e.includeXMLText&&(i.xml=t),i}function TUe(t){var e,n,r,i,o,a,s,u,d,g,_,E,P,R,B,V;const z={version:String(t.version||""),name:String(((e=t.Service)===null||e===void 0?void 0:e.Name)||"unnamed"),title:(n=t.Service)!==null&&n!==void 0&&n.Title?String((r=t.Service)===null||r===void 0?void 0:r.Title):void 0,abstract:(i=t.Service)!==null&&i!==void 0&&i.Abstract?String((o=t.Service)===null||o===void 0?void 0:o.Abstract):void 0,keywords:eL((a=t.Service)===null||a===void 0||(s=a.KeywordList)===null||s===void 0?void 0:s.Keyword),fees:(u=t.Service)!==null&&u!==void 0&&u.Fees?JSON.stringify((d=t.Service)===null||d===void 0?void 0:d.Fees):void 0,accessConstraints:(g=t.Service)!==null&&g!==void 0&&g.AccessConstraints?JSON.stringify((_=t.Service)===null||_===void 0?void 0:_.AccessConstraints):void 0,layerLimit:TB((E=t.Service)===null||E===void 0?void 0:E.LayerLimit),maxWidth:TB((P=t.Service)===null||P===void 0?void 0:P.maxWidth),maxHeight:TB((R=t.Service)===null||R===void 0?void 0:R.maxHeight),layers:[],requests:CUe((B=t.Capability)===null||B===void 0?void 0:B.Request),exceptions:PUe(t.Exception)},F=A1((V=t.Capability)===null||V===void 0?void 0:V.Layer);for(const k of F)z.layers.push(Poe(k));for(const[k,X]of Object.entries(z))X===void 0&&delete z[k];return z}function CUe(t){const e={};for(const[n,r]of Object.entries(t||{})){const i=eL(r==null?void 0:r.Format);e[n]={mimeTypes:i}}return e}function PUe(t){if(A1(t==null?void 0:t.Format).length>0)return{mimeTypes:eL(t)}}function Poe(t){var e;const n={title:String((t==null?void 0:t.Title)||""),name:(t==null?void 0:t.Name)&&String(t==null?void 0:t.Name),abstract:(t==null?void 0:t.Name)&&String(t==null?void 0:t.Abstract),keywords:eL((e=t.KeywordList)===null||e===void 0?void 0:e.Keyword)},r=(t==null?void 0:t.CRS)||(t==null?void 0:t.SRS);r&&Array.isArray(r)&&r.every(g=>typeof g=="string")&&(n.crs=r);let i=(t==null?void 0:t.EX_GeographicBoundingBox)&&IUe(t==null?void 0:t.EX_GeographicBoundingBox);i&&(n.geographicBoundingBox=i),i=(t==null?void 0:t.LatLonBoundingBox)&&MUe(t==null?void 0:t.LatLonBoundingBox),i&&(n.geographicBoundingBox=i);const o=(t==null?void 0:t.BoundingBox)&&OUe(t==null?void 0:t.BoundingBox);o&&o.length>0&&(n.boundingBoxes=o);const s=A1(t==null?void 0:t.Dimension).map(g=>LUe(g));s.length&&(n.dimensions=s),t!=null&&t.opaque&&(n.opaque=vv(t==null?void 0:t.opaque)),t!=null&&t.cascaded&&(n.cascaded=vv(t==null?void 0:t.cascaded)),t!=null&&t.queryable&&(n.queryable=vv(t==null?void 0:t.queryable));const u=A1(t==null?void 0:t.Layer),d=[];for(const g of u)d.push(Poe(g));d.length>0&&(n.layers=d);for(const[g,_]of Object.entries(n))_===void 0&&delete n[g];return n}function IUe(t){const{westBoundLongitude:e,northBoundLatitude:n,eastBoundLongitude:r,southBoundLatitude:i}=t;return[[e,i],[r,n]]}function MUe(t){const{minx:e,miny:n,maxx:r,maxy:i}=t;return[[e,n],[r,i]]}function OUe(t){return A1(t).map(n=>RUe(n))}function RUe(t){const{CRS:e,SRS:n,minx:r,miny:i,maxx:o,maxy:a,resx:s,resy:u}=t,d={crs:e||n,boundingBox:[[rT(r),rT(i)],[rT(o),rT(a)]]};return s&&(d.xResolution=s),u&&(d.yResolution=u),d}function LUe(t){const{name:e,units:n,value:r}=t,i={name:e,units:n,extent:r};return t.unitSymbol&&(i.unitSymbol=t.unitSymbol),t.default&&(i.defaultValue=t.default),t.multipleValues&&(i.multipleValues=vv(t.multipleValues)),t.nearestValue&&(i.nearestValue=vv(t.nearestValue)),t.current&&(i.current=vv(t.current)),i}function Ioe(t,e){e!=null&&e.geographicBoundingBox&&!t.geographicBoundingBox&&(t.geographicBoundingBox=[...e.geographicBoundingBox]),e!=null&&e.crs&&!t.crs&&(t.crs=[...e.crs]),e!=null&&e.boundingBoxes&&!t.boundingBoxes&&(t.boundingBoxes=[...e.boundingBoxes]),e!=null&&e.dimensions&&!t.dimensions&&(t.dimensions=[...e.dimensions]);for(const n of t.layers||[])Ioe(n,t)}const DUe="3.4.14",X6={id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:DUe,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:BUe,options:{wms:{}},parse:async(t,e)=>YW(new TextDecoder().decode(t),e==null?void 0:e.wms),parseTextSync:(t,e)=>YW(t,e==null?void 0:e.wms)};function BUe(t){return t.startsWith("<?xml")}function QW(t,e){var n;const i=((n=t_.parseTextSync(t,e).FeatureInfoResponse)===null||n===void 0?void 0:n.FIELDS)||[];return{features:(Array.isArray(i)?i:[i]).map(a=>NUe(a))}}function NUe(t){return{attributes:t||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}const FUe={...X6,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(t,e)=>QW(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>QW(t,e)};function KW(t,e){var n;return(n=t_.parseTextSync)===null||n===void 0?void 0:n.call(t_,t,e)}const kUe={...X6,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(t,e)=>KW(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>KW(t,e)};class zUe{constructor(e){q(this,"fetch",void 0),q(this,"loadOptions",void 0),q(this,"_needsRefresh",!0),q(this,"props",void 0),this.props={...e},this.loadOptions={...e.loadOptions},this.fetch=UUe(this.loadOptions)}setProps(e){this.props=Object.assign(this.props,e),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=this._needsRefresh;return e&&(this._needsRefresh=!1),n}}function UUe(t){const e=t==null?void 0:t.fetch;if(e&&typeof e=="function")return(r,i)=>e(r,i);const n=t==null?void 0:t.fetch;return n&&typeof n!="function"?r=>fetch(r,n):r=>fetch(r)}class tL extends zUe{}class nL extends tL{constructor(e){super(e)}async getMetadata(){throw new Error("ImageSource.getMetadata not implemented")}async getImage(e){const n=this.getGranularParameters(e),r=this.getURLFromTemplate(n),o=await(await this.fetch(r)).arrayBuffer();return await Bw.parse(o)}getGranularParameters(e){const[n,r,i,o]=e.bbox;return{...e,east:n,north:r,south:o,west:i}}getURLFromTemplate(e){let n=this.props.url;for(const[r,i]of Object.entries(e))n=n.replace("${".concat(r,"}"),String(i)),n=n.replace("{".concat(r,"}"),String(i));return n}}q(nL,"type","template");q(nL,"testURL",t=>t.toLowerCase().includes("{"));class rL extends tL{constructor(e){var n;super(e),q(this,"url",void 0),q(this,"substituteCRS84",void 0),q(this,"flipCRS",void 0),q(this,"wmsParameters",void 0),q(this,"vendorParameters",void 0),q(this,"capabilities",null),this.url=e.url,this.substituteCRS84=(n=e.substituteCRS84)!==null&&n!==void 0?n:!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...e.wmsParameters},this.vendorParameters=e.vendorParameters||{}}async getMetadata(){const e=await this.getCapabilities();return this.normalizeMetadata(e)}async getImage(e){return await this.getMap(e)}normalizeMetadata(e){return e}async getCapabilities(e,n){const r=this.getCapabilitiesURL(e,n),i=await this.fetch(r),o=await i.arrayBuffer();this._checkResponse(i,o);const a=await X6.parse(o,this.loadOptions);return this.capabilities=a,a}async getMap(e,n){const r=this.getMapURL(e,n),i=await this.fetch(r),o=await i.arrayBuffer();this._checkResponse(i,o);try{return await Bw.parse(o,this.loadOptions)}catch{throw this._parseError(o)}}async getFeatureInfo(e,n){const r=this.getFeatureInfoURL(e,n),i=await this.fetch(r),o=await i.arrayBuffer();return this._checkResponse(i,o),await FUe.parse(o,this.loadOptions)}async getFeatureInfoText(e,n){const r=this.getFeatureInfoURL(e,n),i=await this.fetch(r),o=await i.arrayBuffer();return this._checkResponse(i,o),new TextDecoder().decode(o)}async describeLayer(e,n){const r=this.describeLayerURL(e,n),i=await this.fetch(r),o=await i.arrayBuffer();return this._checkResponse(i,o),await kUe.parse(o,this.loadOptions)}async getLegendGraphic(e,n){const r=this.getLegendGraphicURL(e,n),i=await this.fetch(r),o=await i.arrayBuffer();this._checkResponse(i,o);try{return await Bw.parse(o,this.loadOptions)}catch{throw this._parseError(o)}}getCapabilitiesURL(e,n){const r={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetCapabilities",r,n)}getMapURL(e,n){e=this._getWMS130Parameters(e);const r={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetMap",r,n)}getFeatureInfoURL(e,n){const r={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetFeatureInfo",r,n)}describeLayerURL(e,n){const r={version:this.wmsParameters.version,...e};return this._getWMSUrl("DescribeLayer",r,n)}getLegendGraphicURL(e,n){const r={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetLegendGraphic",r,n)}_parseWMSUrl(e){const[n,r]=e.split("?"),i=r.split("&"),o={};for(const a of i){const[s,u]=a.split("=");o[s]=u}return{url:n,parameters:o}}_getWMSUrl(e,n,r){let i=this.url,o=!0;const a={service:"WMS",version:n.version,request:e,...n,...this.vendorParameters,...r},s=["transparent","time","elevation"];for(const[u,d]of Object.entries(a))(!s.includes(u)||d)&&(i+=o?"?":"&",o=!1,i+=this._getURLParameter(u,d,n));return encodeURI(i)}_getWMS130Parameters(e){const n={...e};return n.srs&&(n.crs=n.crs||n.srs,delete n.srs),n}_getURLParameter(e,n,r){switch(e){case"crs":r.version!=="1.3.0"?e="srs":this.substituteCRS84&&n==="EPSG:4326"&&(n="CRS:84");break;case"srs":r.version==="1.3.0"&&(e="crs");break;case"bbox":const i=this._flipBoundingBox(n,r);i&&(n=i);break}return e=e.toUpperCase(),Array.isArray(n)?"".concat(e,"=").concat(n.join(",")):"".concat(e,"=").concat(n?String(n):"")}_flipBoundingBox(e,n){if(!Array.isArray(e)||e.length!==4)return null;const r=n.version==="1.3.0"&&this.flipCRS.includes(n.crs||"")&&!(this.substituteCRS84&&n.crs==="EPSG:4326"),i=e;return r?[i[1],i[0],i[3],i[2]]:i}async _fetchArrayBuffer(e){const n=await this.fetch(e),r=await n.arrayBuffer();return this._checkResponse(n,r),r}_checkResponse(e,n){const r=e.headers["content-type"];if(!e.ok||oP.mimeTypes.includes(r)){const i=kme(this.loadOptions,{wms:{throwOnError:!0}}),o=oP.parseSync(n,i);throw new Error(o)}}_parseError(e){const n=oP.parseSync(e,this.loadOptions);return new Error(n)}}q(rL,"type","wms");q(rL,"testURL",t=>t.toLowerCase().includes("wms"));class Z6 extends tL{constructor(e){super(e)}async getMetadata(){return await this.metadata()}async getImage(e){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(e){throw new Error("not implemented")}metadataURL(e){return"".concat(this.props.url,"?f=pjson")}exportImageURL(e){const n="bbox=".concat(e.bbox[0],",").concat(e.bbox[1],",").concat(e.bbox[2],",").concat(e.bbox[3]),r="size=".concat(e.width,",").concat(e.height),i={...e,bbox:n,size:r};return delete i.width,delete i.height,this.getUrl("exportImage",i)}getUrl(e,n,r){let i="".concat(this.props.url,"/").concat(e),o=!0;for(const[a,s]of Object.entries(n))i+=o?"?":"&",o=!1,Array.isArray(s)?i+="".concat(a.toUpperCase(),"=").concat(s.join(",")):i+="".concat(a.toUpperCase(),"=").concat(s?String(s):"");return i}async checkResponse(e){if(!e.ok)throw new Error("error")}}q(Z6,"type","arcgis-image-server");q(Z6,"testURL",t=>t.toLowerCase().includes("ImageServer"));const GUe=[rL,Z6,nL];function jUe(t){const{type:e="auto"}=t;switch(e==="auto"?VUe(t.url):e){case"template":return new nL(t);case"wms":return new rL(t);default:throw new Error("Not a valid image source type")}}function VUe(t){for(const e of GUe)if(e.testURL&&e.testURL(t))return e.type;return"wms"}const JW=6378137*Math.PI;function eq(t){const e=El(t);return e[0]=(e[0]/256-1)*JW,e[1]=(e[1]/256-1)*JW,e}const $Ue={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(t,e)=>console.error(e,t)}};class Y6 extends Uh{constructor(...e){super(...e),q(this,"state",void 0)}get isLoaded(){return!!this.state&&this.state.loadCounter===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:e,props:n,oldProps:r}){const{viewport:i}=this.context;e.dataChanged||n.serviceType!==r.serviceType?(this.state.imageSource=this._createImageSource(n),this._loadMetadata(),this.debounce(()=>this.loadImage(i,"image source changed"),0)):uc(n.layers,r.layers,1)?e.viewportChanged&&this.debounce(()=>this.loadImage(i,"viewport changed")):this.debounce(()=>this.loadImage(i,"layers changed"),0)}finalizeState(){}renderLayers(){const{bounds:e,image:n,lastRequestParameters:r}=this.state;return n&&new VR({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:r.srs==="EPSG:4326"?Br.LNGLAT:Br.CARTESIAN,bounds:e,image:n})}async getFeatureInfoText(e,n){const{lastRequestParameters:r}=this.state;if(r){var i,o;return await((i=(o=this.state.imageSource).getFeatureInfoText)===null||i===void 0?void 0:i.call(o,{...r,query_layers:r.layers,x:e,y:n,info_format:"application/vnd.ogc.gml"}))}return""}_createImageSource(e){if(e.data instanceof tL)return e.data;if(typeof e.data=="string")return jUe({url:e.data,loadOptions:e.loadOptions,type:e.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){const{imageSource:e}=this.state;try{this.state.loadCounter++;const i=await e.getMetadata();if(this.state.imageSource===e){var n;(n=this.getCurrentLayer())===null||n===void 0||n.props.onMetadataLoad(i)}}catch(i){var r;(r=this.getCurrentLayer())===null||r===void 0||r.props.onMetadataLoadError(i)}finally{this.state.loadCounter--}}async loadImage(e,n){const{layers:r,serviceType:i}=this.props;if(i==="wms"&&r.length===0)return;const o=e.getBounds(),{width:a,height:s}=e,u=this.getRequestId();let{srs:d}=this.props;d==="auto"&&(d=e.resolution?"EPSG:4326":"EPSG:3857");const g={width:a,height:s,bbox:o,layers:r,srs:d};if(d==="EPSG:3857"){const[P,R]=eq([o[0],o[1]]),[B,V]=eq([o[2],o[3]]);g.bbox=[P,R,B,V]}try{this.state.loadCounter++,this.props.onImageLoadStart(u);const P=await this.state.imageSource.getImage(g);if(this.state.lastRequestId<u){var _;(_=this.getCurrentLayer())===null||_===void 0||_.props.onImageLoad(u),this.setState({image:P,bounds:o,lastRequestParameters:g,lastRequestId:u})}}catch(P){var E;this.raiseError(P,"Load image"),(E=this.getCurrentLayer())===null||E===void 0||E.props.onImageLoadError(u,P)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(e,n=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>e(),n)}}q(Y6,"layerName","WMSLayer");q(Y6,"defaultProps",$Ue);const HUe={getHeight:{type:"accessor",value:0},greatCircle:!0};class Q6 extends jR{}q(Q6,"layerName","GreatCircleLayer");q(Q6,"defaultProps",HUe);const WUe={...bA.defaultProps};class v_ extends Uh{indexToBounds(){return null}renderLayers(){const{elevationScale:e,extruded:n,wireframe:r,filled:i,stroked:o,lineWidthUnits:a,lineWidthScale:s,lineWidthMinPixels:u,lineWidthMaxPixels:d,lineJointRounded:g,lineMiterLimit:_,lineDashJustified:E,getElevation:P,getFillColor:R,getLineColor:B,getLineWidth:V}=this.props,{updateTriggers:z,material:F,transitions:k}=this.props,X=this.getSubLayerClass("cell",bA),{updateTriggers:Y,...J}=this.indexToBounds()||{};return new X({filled:i,wireframe:r,extruded:n,elevationScale:e,stroked:o,lineWidthUnits:a,lineWidthScale:s,lineWidthMinPixels:u,lineWidthMaxPixels:d,lineJointRounded:g,lineMiterLimit:_,lineDashJustified:E,material:F,transitions:k,getElevation:P,getFillColor:R,getLineColor:B,getLineWidth:V},this.getSubLayerProps({id:"cell",updateTriggers:z&&{...Y,getElevation:z.getElevation,getFillColor:z.getFillColor,getLineColor:z.getLineColor,getLineWidth:z.getLineWidth}}),J)}}q(v_,"layerName","GeoCellLayer");q(v_,"defaultProps",WUe);function qUe(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Moe={exports:{}};(function(t){/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */(function(e,n){typeof qUe=="function"&&t&&t.exports?t.exports=n():(e.dcodeIO=e.dcodeIO||{}).Long=n()})(Ya,function(){function e(ue,se,me){this.low=ue|0,this.high=se|0,this.unsigned=!!me}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function n(ue){return(ue&&ue.__isLong__)===!0}e.isLong=n;var r={},i={};function o(ue,se){var me,Ce,be;return se?(ue>>>=0,(be=0<=ue&&ue<256)&&(Ce=i[ue],Ce)?Ce:(me=s(ue,(ue|0)<0?-1:0,!0),be&&(i[ue]=me),me)):(ue|=0,(be=-128<=ue&&ue<128)&&(Ce=r[ue],Ce)?Ce:(me=s(ue,ue<0?-1:0,!1),be&&(r[ue]=me),me))}e.fromInt=o;function a(ue,se){if(isNaN(ue)||!isFinite(ue))return se?F:z;if(se){if(ue<0)return F;if(ue>=R)return ie}else{if(ue<=-B)return ce;if(ue+1>=B)return J}return ue<0?a(-ue,se).neg():s(ue%P|0,ue/P|0,se)}e.fromNumber=a;function s(ue,se,me){return new e(ue,se,me)}e.fromBits=s;var u=Math.pow;function d(ue,se,me){if(ue.length===0)throw Error("empty string");if(ue==="NaN"||ue==="Infinity"||ue==="+Infinity"||ue==="-Infinity")return z;if(typeof se=="number"?(me=se,se=!1):se=!!se,me=me||10,me<2||36<me)throw RangeError("radix");var Ce;if((Ce=ue.indexOf("-"))>0)throw Error("interior hyphen");if(Ce===0)return d(ue.substring(1),se,me).neg();for(var be=a(u(me,8)),Ye=z,tt=0;tt<ue.length;tt+=8){var pt=Math.min(8,ue.length-tt),Ee=parseInt(ue.substring(tt,tt+pt),me);if(pt<8){var Ne=a(u(me,pt));Ye=Ye.mul(Ne).add(a(Ee))}else Ye=Ye.mul(be),Ye=Ye.add(a(Ee))}return Ye.unsigned=se,Ye}e.fromString=d;function g(ue){return ue instanceof e?ue:typeof ue=="number"?a(ue):typeof ue=="string"?d(ue):s(ue.low,ue.high,ue.unsigned)}e.fromValue=g;var _=65536,E=1<<24,P=_*_,R=P*P,B=R/2,V=o(E),z=o(0);e.ZERO=z;var F=o(0,!0);e.UZERO=F;var k=o(1);e.ONE=k;var X=o(1,!0);e.UONE=X;var Y=o(-1);e.NEG_ONE=Y;var J=s(-1,2147483647,!1);e.MAX_VALUE=J;var ie=s(-1,-1,!0);e.MAX_UNSIGNED_VALUE=ie;var ce=s(0,-2147483648,!1);e.MIN_VALUE=ce;var re=e.prototype;return re.toInt=function(){return this.unsigned?this.low>>>0:this.low},re.toNumber=function(){return this.unsigned?(this.high>>>0)*P+(this.low>>>0):this.high*P+(this.low>>>0)},re.toString=function(se){if(se=se||10,se<2||36<se)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ce)){var me=a(se),Ce=this.div(me),be=Ce.mul(me).sub(this);return Ce.toString(se)+be.toInt().toString(se)}else return"-"+this.neg().toString(se);for(var Ye=a(u(se,6),this.unsigned),tt=this,pt="";;){var Ee=tt.div(Ye),Ne=tt.sub(Ee.mul(Ye)).toInt()>>>0,Be=Ne.toString(se);if(tt=Ee,tt.isZero())return Be+pt;for(;Be.length<6;)Be="0"+Be;pt=""+Be+pt}},re.getHighBits=function(){return this.high},re.getHighBitsUnsigned=function(){return this.high>>>0},re.getLowBits=function(){return this.low},re.getLowBitsUnsigned=function(){return this.low>>>0},re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ce)?64:this.neg().getNumBitsAbs();for(var se=this.high!=0?this.high:this.low,me=31;me>0&&!(se&1<<me);me--);return this.high!=0?me+33:me+1},re.isZero=function(){return this.high===0&&this.low===0},re.isNegative=function(){return!this.unsigned&&this.high<0},re.isPositive=function(){return this.unsigned||this.high>=0},re.isOdd=function(){return(this.low&1)===1},re.isEven=function(){return(this.low&1)===0},re.equals=function(se){return n(se)||(se=g(se)),this.unsigned!==se.unsigned&&this.high>>>31===1&&se.high>>>31===1?!1:this.high===se.high&&this.low===se.low},re.eq=re.equals,re.notEquals=function(se){return!this.eq(se)},re.neq=re.notEquals,re.lessThan=function(se){return this.comp(se)<0},re.lt=re.lessThan,re.lessThanOrEqual=function(se){return this.comp(se)<=0},re.lte=re.lessThanOrEqual,re.greaterThan=function(se){return this.comp(se)>0},re.gt=re.greaterThan,re.greaterThanOrEqual=function(se){return this.comp(se)>=0},re.gte=re.greaterThanOrEqual,re.compare=function(se){if(n(se)||(se=g(se)),this.eq(se))return 0;var me=this.isNegative(),Ce=se.isNegative();return me&&!Ce?-1:!me&&Ce?1:this.unsigned?se.high>>>0>this.high>>>0||se.high===this.high&&se.low>>>0>this.low>>>0?-1:1:this.sub(se).isNegative()?-1:1},re.comp=re.compare,re.negate=function(){return!this.unsigned&&this.eq(ce)?ce:this.not().add(k)},re.neg=re.negate,re.add=function(se){n(se)||(se=g(se));var me=this.high>>>16,Ce=this.high&65535,be=this.low>>>16,Ye=this.low&65535,tt=se.high>>>16,pt=se.high&65535,Ee=se.low>>>16,Ne=se.low&65535,Be=0,qe=0,ct=0,Ct=0;return Ct+=Ye+Ne,ct+=Ct>>>16,Ct&=65535,ct+=be+Ee,qe+=ct>>>16,ct&=65535,qe+=Ce+pt,Be+=qe>>>16,qe&=65535,Be+=me+tt,Be&=65535,s(ct<<16|Ct,Be<<16|qe,this.unsigned)},re.subtract=function(se){return n(se)||(se=g(se)),this.add(se.neg())},re.sub=re.subtract,re.multiply=function(se){if(this.isZero()||(n(se)||(se=g(se)),se.isZero()))return z;if(this.eq(ce))return se.isOdd()?ce:z;if(se.eq(ce))return this.isOdd()?ce:z;if(this.isNegative())return se.isNegative()?this.neg().mul(se.neg()):this.neg().mul(se).neg();if(se.isNegative())return this.mul(se.neg()).neg();if(this.lt(V)&&se.lt(V))return a(this.toNumber()*se.toNumber(),this.unsigned);var me=this.high>>>16,Ce=this.high&65535,be=this.low>>>16,Ye=this.low&65535,tt=se.high>>>16,pt=se.high&65535,Ee=se.low>>>16,Ne=se.low&65535,Be=0,qe=0,ct=0,Ct=0;return Ct+=Ye*Ne,ct+=Ct>>>16,Ct&=65535,ct+=be*Ne,qe+=ct>>>16,ct&=65535,ct+=Ye*Ee,qe+=ct>>>16,ct&=65535,qe+=Ce*Ne,Be+=qe>>>16,qe&=65535,qe+=be*Ee,Be+=qe>>>16,qe&=65535,qe+=Ye*pt,Be+=qe>>>16,qe&=65535,Be+=me*Ne+Ce*Ee+be*pt+Ye*tt,Be&=65535,s(ct<<16|Ct,Be<<16|qe,this.unsigned)},re.mul=re.multiply,re.divide=function(se){if(n(se)||(se=g(se)),se.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?F:z;var me,Ce,be;if(this.unsigned){if(se.unsigned||(se=se.toUnsigned()),se.gt(this))return F;if(se.gt(this.shru(1)))return X;be=F}else{if(this.eq(ce)){if(se.eq(k)||se.eq(Y))return ce;if(se.eq(ce))return k;var Ye=this.shr(1);return me=Ye.div(se).shl(1),me.eq(z)?se.isNegative()?k:Y:(Ce=this.sub(se.mul(me)),be=me.add(Ce.div(se)),be)}else if(se.eq(ce))return this.unsigned?F:z;if(this.isNegative())return se.isNegative()?this.neg().div(se.neg()):this.neg().div(se).neg();if(se.isNegative())return this.div(se.neg()).neg();be=z}for(Ce=this;Ce.gte(se);){me=Math.max(1,Math.floor(Ce.toNumber()/se.toNumber()));for(var tt=Math.ceil(Math.log(me)/Math.LN2),pt=tt<=48?1:u(2,tt-48),Ee=a(me),Ne=Ee.mul(se);Ne.isNegative()||Ne.gt(Ce);)me-=pt,Ee=a(me,this.unsigned),Ne=Ee.mul(se);Ee.isZero()&&(Ee=k),be=be.add(Ee),Ce=Ce.sub(Ne)}return be},re.div=re.divide,re.modulo=function(se){return n(se)||(se=g(se)),this.sub(this.div(se).mul(se))},re.mod=re.modulo,re.not=function(){return s(~this.low,~this.high,this.unsigned)},re.and=function(se){return n(se)||(se=g(se)),s(this.low&se.low,this.high&se.high,this.unsigned)},re.or=function(se){return n(se)||(se=g(se)),s(this.low|se.low,this.high|se.high,this.unsigned)},re.xor=function(se){return n(se)||(se=g(se)),s(this.low^se.low,this.high^se.high,this.unsigned)},re.shiftLeft=function(se){return n(se)&&(se=se.toInt()),(se&=63)===0?this:se<32?s(this.low<<se,this.high<<se|this.low>>>32-se,this.unsigned):s(0,this.low<<se-32,this.unsigned)},re.shl=re.shiftLeft,re.shiftRight=function(se){return n(se)&&(se=se.toInt()),(se&=63)===0?this:se<32?s(this.low>>>se|this.high<<32-se,this.high>>se,this.unsigned):s(this.high>>se-32,this.high>=0?0:-1,this.unsigned)},re.shr=re.shiftRight,re.shiftRightUnsigned=function(se){if(n(se)&&(se=se.toInt()),se&=63,se===0)return this;var me=this.high;if(se<32){var Ce=this.low;return s(Ce>>>se|me<<32-se,me>>>se,this.unsigned)}else return se===32?s(me,0,this.unsigned):s(me>>>se-32,0,this.unsigned)},re.shru=re.shiftRightUnsigned,re.toSigned=function(){return this.unsigned?s(this.low,this.high,!1):this},re.toUnsigned=function(){return this.unsigned?this:s(this.low,this.high,!0)},re.toBytes=function(ue){return ue?this.toBytesLE():this.toBytesBE()},re.toBytesLE=function(){var ue=this.high,se=this.low;return[se&255,se>>>8&255,se>>>16&255,se>>>24&255,ue&255,ue>>>8&255,ue>>>16&255,ue>>>24&255]},re.toBytesBE=function(){var ue=this.high,se=this.low;return[ue>>>24&255,ue>>>16&255,ue>>>8&255,ue&255,se>>>24&255,se>>>16&255,se>>>8&255,se&255]},e})})(Moe);var XUe=Moe.exports;const sP=mA(XUe),ZUe=3,YUe=30,QUe=2*YUe+1,tq=180/Math.PI;function KUe(t,e,n){const r=1<<e;return[(t[0]+n[0])/r,(t[1]+n[1])/r]}function nq(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function JUe(t){return[nq(t[0]),nq(t[1])]}function e8e(t,[e,n]){switch(t){case 0:return[1,e,n];case 1:return[-e,1,n];case 2:return[-e,-n,1];case 3:return[-1,-n,-e];case 4:return[n,-1,-e];case 5:return[n,e,-1];default:throw new Error("Invalid face")}}function t8e([t,e,n]){const r=Math.atan2(n,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*tq,r*tq]}function n8e(t){let e=sP.fromString(t,!0,10).toString(2);for(;e.length<ZUe+QUe;)e="0"+e;const n=e.lastIndexOf("1"),r=e.substring(0,3),i=e.substring(3,n),o=i.length/2,a=sP.fromString(r,!0,2).toString(10);let s=sP.fromString(i,!0,2).toString(4);for(;s.length<o;)s="0"+s;return"".concat(a,"/").concat(s)}function r8e(t,e,n,r){if(r===0){n===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function i8e(t){const e=t.split("/"),n=parseInt(e[0],10),r=e[1],i=r.length,o=[0,0];let a;for(let s=i-1;s>=0;s--){a=i-s;const u=r[s];let d=0,g=0;u==="1"?g=1:u==="2"?(d=1,g=1):u==="3"&&(d=1);const _=Math.pow(2,a-1);r8e(_,o,d,g),o[0]+=_*d,o[1]+=_*g}if(n%2===1){const s=o[0];o[0]=o[1],o[1]=s}return{face:n,ij:o,level:a}}function o8e(t){const e=t.padEnd(16,"0");return sP.fromString(e,16)}const s8e=100;function a8e({face:t,ij:e,level:n}){const r=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(s8e*Math.pow(2,-n))),o=new Float64Array(4*i*2+2);let a=0,s=0;for(let u=0;u<4;u++){const d=r[u].slice(0),g=r[u+1],_=(g[0]-d[0])/i,E=(g[1]-d[1])/i;for(let P=0;P<i;P++){d[0]+=_,d[1]+=E;const R=KUe(e,n,d),B=JUe(R),V=e8e(t,B),z=t8e(V);Math.abs(z[1])>89.999&&(z[0]=s);const F=z[0]-s;z[0]+=F>180?-360:F<-180?360:0,o[a++]=z[0],o[a++]=z[1],s=z[0]}}return o[a++]=o[0],o[a++]=o[1],o}function l8e(t){if(typeof t=="string"){if(t.indexOf("/")>0)return t;t=o8e(t)}return n8e(t.toString())}function u8e(t){const e=l8e(t),n=i8e(e);return a8e(n)}const c8e={getS2Token:{type:"accessor",value:t=>t.token}};class K6 extends v_{indexToBounds(){const{data:e,getS2Token:n}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(r,i)=>u8e(n(r,i))}}}q(K6,"layerName","S2Layer");q(K6,"defaultProps",c8e);const CB=512;function f8e(t,e){let n=0,r=0,i=1<<t.length;const o=i/CB;for(let a=0;a<t.length;a++){i>>=1;const s=parseInt(t[a]);s%2&&(n|=i),s>1&&(r|=i)}return[[n/o,CB-r/o],[(n+e)/o,CB-(r+e)/o]]}function h8e(t,e=1){const[n,r]=f8e(t,e),[i,o]=gc(n),[a,s]=gc(r);return[a,o,a,s,i,s,i,o,a,o]}const d8e={getQuadkey:{type:"accessor",value:t=>t.quadkey}};class J6 extends v_{indexToBounds(){const{data:e,extruded:n,getQuadkey:r}=this.props,i=n?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(o,a)=>h8e(r(o,a),i),updateTriggers:{getPolygon:i}}}}q(J6,"layerName","QuadkeyLayer");q(J6,"defaultProps",d8e);class Ooe{constructor(e){q(this,"index",void 0),q(this,"isVisible",void 0),q(this,"isSelected",void 0),q(this,"parent",void 0),q(this,"children",void 0),q(this,"content",void 0),q(this,"state",void 0),q(this,"layers",void 0),q(this,"id",void 0),q(this,"zoom",void 0),q(this,"userData",void 0),q(this,"boundingBox",void 0),q(this,"_abortController",void 0),q(this,"_loader",void 0),q(this,"_loaderId",void 0),q(this,"_isLoaded",void 0),q(this,"_isCancelled",void 0),q(this,"_needsReload",void 0),q(this,"_bbox",void 0),this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:n,onLoad:r,onError:i}){const{index:o,id:a,bbox:s,userData:u,zoom:d}=this,g=this._loaderId;this._abortController=new AbortController;const{signal:_}=this._abortController,E=await n.scheduleRequest(this,B=>B.isSelected?1:-1);if(!E){this._isCancelled=!0;return}if(this._isCancelled){E.done();return}let P=null,R;try{P=await e({index:o,id:a,bbox:s,userData:u,zoom:d,signal:_})}catch(B){R=B||!0}finally{E.done()}if(g===this._loaderId){if(this._loader=void 0,this.content=P,this._isCancelled&&!P){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,R?i(R,this):r(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)===null||e===void 0||e.abort())}}const yl={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},rq=new yt,p8e=new yt;class eU{constructor(e=[0,0,0],n=[0,0,0],r){q(this,"center",void 0),q(this,"halfDiagonal",void 0),q(this,"minimum",void 0),q(this,"maximum",void 0),r=r||rq.copy(e).add(n).scale(.5),this.center=new yt(r),this.halfDiagonal=new yt(n).subtract(this.center),this.minimum=new yt(e),this.maximum=new yt(n)}clone(){return new eU(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:n}=this,r=p8e.from(e.normal),i=n.x*Math.abs(r.x)+n.y*Math.abs(r.y)+n.z*Math.abs(r.z),o=this.center.dot(r)+e.distance;return o-i>0?yl.INSIDE:o+i<0?yl.OUTSIDE:yl.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=rq.from(e).subtract(this.center),{halfDiagonal:r}=this;let i=0,o;return o=Math.abs(n.x)-r.x,o>0&&(i+=o*o),o=Math.abs(n.y)-r.y,o>0&&(i+=o*o),o=Math.abs(n.z)-r.z,o>0&&(i+=o*o),i}}const wb=new yt,iq=new yt;class a2{constructor(e=[0,0,0],n=0){q(this,"center",void 0),q(this,"radius",void 0),this.radius=-0,this.center=new yt,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=wb.from(n),this.center=new yt().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new a2(this.center,this.radius)}union(e){const n=this.center,r=this.radius,i=e.center,o=e.radius,a=wb.copy(i).subtract(n),s=a.magnitude();if(r>=s+o)return this.clone();if(o>=s+r)return e.clone();const u=(r+s+o)*.5;return iq.copy(a).scale((-r+u)/s).add(n),this.center.copy(iq),this.radius=u,this}expand(e){const r=wb.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const n=pbe(wb,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const r=wb.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const n=this.center,r=this.radius,o=e.normal.dot(n)+e.distance;return o<-r?yl.OUTSIDE:o<r?yl.INTERSECTING:yl.INSIDE}}const g8e=new yt,m8e=new yt,iT=new yt,oT=new yt,sT=new yt,A8e=new yt,_8e=new yt,zp={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class l2{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){q(this,"center",void 0),q(this,"halfAxes",void 0),this.center=new yt().from(e),this.halfAxes=new is(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new yt(e).len(),new yt(n).len(),new yt(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),i=new yt(e).normalize(),o=new yt(n).normalize(),a=new yt(r).normalize();return new Zm().fromMatrix3(new is([...i,...o,...a]))}fromCenterHalfSizeQuaternion(e,n,r){const i=new Zm(r),o=new is().fromQuaternion(i);return o[0]=o[0]*n[0],o[1]=o[1]*n[0],o[2]=o[2]*n[0],o[3]=o[3]*n[1],o[4]=o[4]*n[1],o[5]=o[5]*n[1],o[6]=o[6]*n[2],o[7]=o[7]*n[2],o[8]=o[8]*n[2],this.center=new yt().from(e),this.halfAxes=o,this}clone(){return new l2(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new a2){const n=this.halfAxes,r=n.getColumn(0,iT),i=n.getColumn(1,oT),o=n.getColumn(2,sT),a=g8e.copy(r).add(i).add(o);return e.center.copy(this.center),e.radius=a.magnitude(),e}intersectPlane(e){const n=this.center,r=e.normal,i=this.halfAxes,o=r.x,a=r.y,s=r.z,u=Math.abs(o*i[zp.COLUMN0ROW0]+a*i[zp.COLUMN0ROW1]+s*i[zp.COLUMN0ROW2])+Math.abs(o*i[zp.COLUMN1ROW0]+a*i[zp.COLUMN1ROW1]+s*i[zp.COLUMN1ROW2])+Math.abs(o*i[zp.COLUMN2ROW0]+a*i[zp.COLUMN2ROW1]+s*i[zp.COLUMN2ROW2]),d=r.dot(n)+e.distance;return d<=-u?yl.OUTSIDE:d>=u?yl.INSIDE:yl.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=m8e.from(e).subtract(this.center),r=this.halfAxes,i=r.getColumn(0,iT),o=r.getColumn(1,oT),a=r.getColumn(2,sT),s=i.magnitude(),u=o.magnitude(),d=a.magnitude();i.normalize(),o.normalize(),a.normalize();let g=0,_;return _=Math.abs(n.dot(i))-s,_>0&&(g+=_*_),_=Math.abs(n.dot(o))-u,_>0&&(g+=_*_),_=Math.abs(n.dot(a))-d,_>0&&(g+=_*_),g}computePlaneDistances(e,n,r=[-0,-0]){let i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const a=this.center,s=this.halfAxes,u=s.getColumn(0,iT),d=s.getColumn(1,oT),g=s.getColumn(2,sT),_=A8e.copy(u).add(d).add(g).add(a),E=_8e.copy(_).subtract(e);let P=n.dot(E);return i=Math.min(P,i),o=Math.max(P,o),_.copy(a).add(u).add(d).subtract(g),E.copy(_).subtract(e),P=n.dot(E),i=Math.min(P,i),o=Math.max(P,o),_.copy(a).add(u).subtract(d).add(g),E.copy(_).subtract(e),P=n.dot(E),i=Math.min(P,i),o=Math.max(P,o),_.copy(a).add(u).subtract(d).subtract(g),E.copy(_).subtract(e),P=n.dot(E),i=Math.min(P,i),o=Math.max(P,o),a.copy(_).subtract(u).add(d).add(g),E.copy(_).subtract(e),P=n.dot(E),i=Math.min(P,i),o=Math.max(P,o),a.copy(_).subtract(u).add(d).subtract(g),E.copy(_).subtract(e),P=n.dot(E),i=Math.min(P,i),o=Math.max(P,o),a.copy(_).subtract(u).subtract(d).add(g),E.copy(_).subtract(e),P=n.dot(E),i=Math.min(P,i),o=Math.max(P,o),a.copy(_).subtract(u).subtract(d).subtract(g),E.copy(_).subtract(e),P=n.dot(E),i=Math.min(P,i),o=Math.max(P,o),r[0]=i,r[1]=o,r}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,iT);n.transformAsPoint(e);const r=this.halfAxes.getColumn(1,oT);r.transformAsPoint(e);const i=this.halfAxes.getColumn(2,sT);return i.transformAsPoint(e),this.halfAxes=new is([...n,...r,...i]),this}getTransform(){throw new Error("not implemented")}}const oq=new yt,sq=new yt;class cf{constructor(e=[0,0,1],n=0){q(this,"normal",void 0),q(this,"distance",void 0),this.normal=new yt,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return ac(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=oq.from(e),this.normal.from(n).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,n,r,i){return this.normal.set(e,n,r),ac(Sl(this.normal.len(),1)),this.distance=i,this}clone(){return new cf(this.normal,this.distance)}equals(e){return Sl(this.distance,e.distance)&&Sl(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=sq.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,n)}projectPointOntoPlane(e,n=[0,0,0]){e=oq.from(e);const r=this.getPointDistance(e),i=sq.copy(this.normal).scale(r);return e.subtract(i).to(n)}}const aq=[new yt([1,0,0]),new yt([0,1,0]),new yt([0,0,1])],lq=new yt,y8e=new yt;new cf(new yt(1,0,0),0);class cc{constructor(e=[]){q(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*aq.length;const n=e.center,r=e.radius;let i=0;for(const o of aq){let a=this.planes[i],s=this.planes[i+1];a||(a=this.planes[i]=new cf),s||(s=this.planes[i+1]=new cf);const u=lq.copy(o).scale(-r).add(n);-o.dot(u),a.fromPointNormal(u,o);const d=lq.copy(o).scale(r).add(n),g=y8e.copy(o).negate();-g.dot(d),s.fromPointNormal(d,g),i+=2}return this}computeVisibility(e){let n=yl.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case yl.OUTSIDE:return yl.OUTSIDE;case yl.INTERSECTING:n=yl.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(ac(Number.isFinite(n),"parentPlaneMask is required."),n===cc.MASK_OUTSIDE||n===cc.MASK_INSIDE)return n;let r=cc.MASK_INSIDE;const i=this.planes;for(let o=0;o<this.planes.length;++o){const a=o<31?1<<o:0;if(o<31&&!(n&a))continue;const s=i[o],u=e.intersectPlane(s);if(u===yl.OUTSIDE)return cc.MASK_OUTSIDE;u===yl.INTERSECTING&&(r|=a)}return r}}q(cc,"MASK_OUTSIDE",4294967295);q(cc,"MASK_INSIDE",0);q(cc,"MASK_INDETERMINATE",2147483647);new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;new yt;const vd=new is,v8e=new is,x8e=new is,aT=new is,uq=new is;function b8e(t,e={}){const n=Fv.EPSILON20,r=10;let i=0,o=0;const a=v8e,s=x8e;a.identity(),s.copy(t);const u=n*w8e(s);for(;o<r&&E8e(s)>u;)S8e(s,aT),uq.copy(aT).transpose(),s.multiplyRight(aT),s.multiplyLeft(uq),a.multiplyRight(aT),++i>2&&(++o,i=0);return e.unitary=a.toTarget(e.unitary),e.diagonal=s.toTarget(e.diagonal),e}function w8e(t){let e=0;for(let n=0;n<9;++n){const r=t[n];e+=r*r}return Math.sqrt(e)}const x4=[1,0,0],b4=[2,2,1];function E8e(t){let e=0;for(let n=0;n<3;++n){const r=t[vd.getElementIndex(b4[n],x4[n])];e+=2*r*r}return Math.sqrt(e)}function S8e(t,e){const n=Fv.EPSILON15;let r=0,i=1;for(let d=0;d<3;++d){const g=Math.abs(t[vd.getElementIndex(b4[d],x4[d])]);g>r&&(i=d,r=g)}const o=x4[i],a=b4[i];let s=1,u=0;if(Math.abs(t[vd.getElementIndex(a,o)])>n){const d=t[vd.getElementIndex(a,a)],g=t[vd.getElementIndex(o,o)],_=t[vd.getElementIndex(a,o)],E=(d-g)/2/_;let P;E<0?P=-1/(-E+Math.sqrt(1+E*E)):P=1/(E+Math.sqrt(1+E*E)),s=1/Math.sqrt(1+P*P),u=P*s}return is.IDENTITY.to(e),e[vd.getElementIndex(o,o)]=e[vd.getElementIndex(a,a)]=s,e[vd.getElementIndex(a,o)]=u,e[vd.getElementIndex(o,a)]=-u,e}const gm=new yt,T8e=new yt,C8e=new yt,P8e=new yt,I8e=new yt,M8e=new is,O8e={diagonal:new is,unitary:new is};function Roe(t,e=new l2){if(!t||t.length===0)return e.halfAxes=new is([0,0,0,0,0,0,0,0,0]),e.center=new yt,e;const n=t.length,r=new yt(0,0,0);for(const re of t)r.add(re);const i=1/n;r.multiplyByScalar(i);let o=0,a=0,s=0,u=0,d=0,g=0;for(const re of t){const ue=gm.copy(re).subtract(r);o+=ue.x*ue.x,a+=ue.x*ue.y,s+=ue.x*ue.z,u+=ue.y*ue.y,d+=ue.y*ue.z,g+=ue.z*ue.z}o*=i,a*=i,s*=i,u*=i,d*=i,g*=i;const _=M8e;_[0]=o,_[1]=a,_[2]=s,_[3]=a,_[4]=u,_[5]=d,_[6]=s,_[7]=d,_[8]=g;const{unitary:E}=b8e(_,O8e),P=e.halfAxes.copy(E);let R=P.getColumn(0,C8e),B=P.getColumn(1,P8e),V=P.getColumn(2,I8e),z=-Number.MAX_VALUE,F=-Number.MAX_VALUE,k=-Number.MAX_VALUE,X=Number.MAX_VALUE,Y=Number.MAX_VALUE,J=Number.MAX_VALUE;for(const re of t)gm.copy(re),z=Math.max(gm.dot(R),z),F=Math.max(gm.dot(B),F),k=Math.max(gm.dot(V),k),X=Math.min(gm.dot(R),X),Y=Math.min(gm.dot(B),Y),J=Math.min(gm.dot(V),J);R=R.multiplyByScalar(.5*(X+z)),B=B.multiplyByScalar(.5*(Y+F)),V=V.multiplyByScalar(.5*(J+k)),e.center.copy(R).add(B).add(V);const ie=T8e.set(z-X,F-Y,k-J).multiplyByScalar(.5),ce=new is([ie[0],0,0,0,ie[1],0,0,0,ie[2]]);return e.halfAxes.multiplyRight(ce),e}const ov=512,cq=3,Loe=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],Doe=Loe.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),R8e=Doe.concat([[.25,.5],[.75,.5]]);class sv{constructor(e,n,r){q(this,"x",void 0),q(this,"y",void 0),q(this,"z",void 0),q(this,"childVisible",void 0),q(this,"selected",void 0),q(this,"_children",void 0),this.x=e,this.y=n,this.z=r}get children(){if(!this._children){const e=this.x*2,n=this.y*2,r=this.z+1;this._children=[new sv(e,n,r),new sv(e,n+1,r),new sv(e+1,n,r),new sv(e+1,n+1,r)]}return this._children}update(e){const{viewport:n,cullingVolume:r,elevationBounds:i,minZ:o,maxZ:a,bounds:s,offset:u,project:d}=e,g=this.getBoundingVolume(i,u,d);if(s&&!this.insideBounds(s)||r.computeVisibility(g)<0)return!1;if(!this.childVisible){let{z:E}=this;if(E<a&&E>=o){const P=g.distanceTo(n.cameraPosition)*n.scale/n.height;E+=Math.floor(Math.log2(P))}if(E>=a)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const E of this.children)E.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const n of this._children)n.getSelected(e);return e}insideBounds([e,n,r,i]){const o=Math.pow(2,this.z),a=ov/o;return this.x*a<r&&this.y*a<i&&(this.x+1)*a>e&&(this.y+1)*a>n}getBoundingVolume(e,n,r){if(r){const u=this.z<1?R8e:this.z<2?Doe:Loe,d=[];for(const g of u){const _=E4(this.x+g[0],this.y+g[1],this.z);_[2]=e[0],d.push(r(_)),e[0]!==e[1]&&(_[2]=e[1],d.push(r(_)))}return Roe(d)}const i=Math.pow(2,this.z),o=ov/i,a=this.x*o+n*ov,s=ov-(this.y+1)*o;return new eU([a,s,e[0]],[a+o,s+o,e[1]])}}function L8e(t,e,n,r){const i=t instanceof H5&&t.resolution?t.projectPosition:null,o=Object.values(t.getFrustumPlanes()).map(({normal:P,distance:R})=>new cf(P.clone().negate(),R)),a=new cc(o),s=t.distanceScales.unitsPerMeter[2],u=n&&n[0]*s||0,d=n&&n[1]*s||0,g=t instanceof ug&&t.pitch<=60?e:0;if(r){const[P,R,B,V]=r,z=El([P,V]),F=El([B,R]);r=[z[0],ov-z[1],F[0],ov-F[1]]}const _=new sv(0,0,0),E={viewport:t,project:i,cullingVolume:a,elevationBounds:[u,d],minZ:g,maxZ:e,bounds:r,offset:0};if(_.update(E),t instanceof ug&&t.subViewports&&t.subViewports.length>1){for(E.offset=-1;_.update(E)&&!(--E.offset<-cq););for(E.offset=1;_.update(E)&&!(++E.offset>cq););}return _.getSelected()}const yg=512,D8e=[-1/0,-1/0,1/0,1/0],tM={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(n=>typeof n=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}};function Boe(t,e){const n=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...n.map(i=>i[0])),Math.min(...n.map(i=>i[1])),Math.max(...n.map(i=>i[0])),Math.max(...n.map(i=>i[1]))]}function B8e(t){return Math.abs(t.split("").reduce((e,n)=>(e<<5)-e+n.charCodeAt(0)|0,0))}function fE(t,e){if(!t||!t.length)return null;const{index:n,id:r}=e;if(Array.isArray(t)){const o=B8e(r)%t.length;t=t[o]}let i=t;for(const o of Object.keys(n)){const a=new RegExp("{".concat(o,"}"),"g");i=i.replace(a,String(n[o]))}return Number.isInteger(n.y)&&Number.isInteger(n.z)&&(i=i.replace(/\{-y\}/g,String(Math.pow(2,n.z)-n.y-1))),i}function N8e(t,e,n){let r;if(e&&e.length===2){const[i,o]=e,a=t.getBounds({z:i}),s=t.getBounds({z:o});r=[Math.min(a[0],s[0]),Math.min(a[1],s[1]),Math.max(a[2],s[2]),Math.max(a[3],s[3])]}else r=t.getBounds();return t.isGeospatial?[Math.max(r[0],n[0]),Math.max(r[1],n[1]),Math.min(r[2],n[2]),Math.min(r[3],n[3])]:[Math.max(Math.min(r[0],n[2]),n[0]),Math.max(Math.min(r[1],n[3]),n[1]),Math.min(Math.max(r[2],n[0]),n[2]),Math.min(Math.max(r[3],n[1]),n[3])]}function F8e({viewport:t,z:e=0,cullRect:n}){return(t.subViewports||[t]).map(i=>w4(i,e,n))}function w4(t,e,n){if(!Array.isArray(e)){const o=n.x-t.x,a=n.y-t.y,{width:s,height:u}=n,d={targetZ:e},g=t.unproject([o,a],d),_=t.unproject([o+s,a],d),E=t.unproject([o,a+u],d),P=t.unproject([o+s,a+u],d);return[Math.min(g[0],_[0],E[0],P[0]),Math.min(g[1],_[1],E[1],P[1]),Math.max(g[0],_[0],E[0],P[0]),Math.max(g[1],_[1],E[1],P[1])]}const r=w4(t,e[0],n),i=w4(t,e[1],n);return[Math.min(r[0],i[0]),Math.min(r[1],i[1]),Math.max(r[2],i[2]),Math.max(r[3],i[3])]}function k8e(t,e,n){return n?Boe(t,n).map(i=>i*e/yg):t.map(r=>r*e/yg)}function tU(t,e){return Math.pow(2,t)*yg/e}function E4(t,e,n){const r=tU(n,yg),i=t/r*360-180,o=Math.PI-2*Math.PI*e/r,a=180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)));return[i,a]}function fq(t,e,n,r){const i=tU(n,r);return[t/i*yg,e/i*yg]}function z8e(t,e,n,r,i=yg){if(t.isGeospatial){const[d,g]=E4(e,n,r),[_,E]=E4(e+1,n+1,r);return{west:d,north:g,east:_,south:E}}const[o,a]=fq(e,n,r,i),[s,u]=fq(e+1,n+1,r,i);return{left:o,top:a,right:s,bottom:u}}function U8e(t,e,n,r,i){const o=N8e(t,null,r),a=tU(e,n),[s,u,d,g]=k8e(o,a,i),_=[];for(let E=Math.floor(s);E<d;E++)for(let P=Math.floor(u);P<g;P++)_.push({x:E,y:P,z:e});return _}function G8e({viewport:t,maxZoom:e,minZoom:n,zRange:r,extent:i,tileSize:o=yg,modelMatrix:a,modelMatrixInverse:s,zoomOffset:u=0}){let d=t.isGeospatial?Math.round(t.zoom+Math.log2(yg/o))+u:Math.ceil(t.zoom)+u;if(typeof n=="number"&&Number.isFinite(n)&&d<n){if(!i)return[];d=n}typeof e=="number"&&Number.isFinite(e)&&d>e&&(d=e);let g=i;return a&&s&&i&&!t.isGeospatial&&(g=Boe(i,a)),t.isGeospatial?L8e(t,d,r,i):U8e(t,d,o,g||D8e,s)}function j8e(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function V8e(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}function $8e(t){let e={},n;return r=>{for(const i in r)if(!H8e(r[i],e[i])){n=t(r),e=r;break}return n}}function H8e(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}const hq=1,iL=2,W8e="never",q8e="no-overlap",nU="best-available",X8e=5,Z8e={[nU]:Q8e,[q8e]:K8e,[W8e]:()=>{}},Y8e={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class Noe{constructor(e){q(this,"opts",void 0),q(this,"_requestScheduler",void 0),q(this,"_cache",void 0),q(this,"_dirty",void 0),q(this,"_tiles",void 0),q(this,"_cacheByteSize",void 0),q(this,"_viewport",void 0),q(this,"_zRange",void 0),q(this,"_selectedTiles",void 0),q(this,"_frameNumber",void 0),q(this,"_modelMatrix",void 0),q(this,"_modelMatrixInverse",void 0),q(this,"_maxZoom",void 0),q(this,"_minZoom",void 0),q(this,"onTileLoad",void 0),q(this,"_getCullBounds",$8e(F8e)),this.opts={...Y8e,...e},this.onTileLoad=n=>{var r,i;(r=(i=this.opts).onTileLoad)===null||r===void 0||r.call(i,n),this.opts.maxCacheByteSize&&(this._cacheByteSize+=n.byteLength,this._resizeCache())},this._requestScheduler=new mee({maxRequests:e.maxRequests,throttleRequests:!!(e.maxRequests&&e.maxRequests>0)}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new vr,this._modelMatrixInverse=new vr,this.setOptions(e)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const n=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(n)?this._cache.delete(e):n.setNeedsReload()}}update(e,{zRange:n,modelMatrix:r}={}){const i=new vr(r),o=!i.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Sl(this._zRange,n)||o){o&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e,this._zRange=n;const s=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:n,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=s.map(u=>this._getTile(u,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(s=>this._getTile(s.index,!0)));const a=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),a&&this._frameNumber++,this._frameNumber}isTileVisible(e,n){if(!e.isVisible)return!1;if(n&&this._viewport){const r=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:n}),{bbox:i}=e;for(const[o,a,s,u]of r){let d;if("west"in i)d=i.west<s&&i.east>o&&i.south<u&&i.north>a;else{const g=Math.min(i.top,i.bottom),_=Math.max(i.top,i.bottom);d=i.left<s&&i.right>o&&g<u&&_>a}if(d)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:n,minZoom:r,zRange:i,modelMatrix:o,modelMatrixInverse:a}){const{tileSize:s,extent:u,zoomOffset:d}=this.opts;return G8e({viewport:e,maxZoom:n,minZoom:r,zRange:i,tileSize:s,extent:u,modelMatrix:o,modelMatrixInverse:a,zoomOffset:d})}getTileId(e){return"".concat(e.x,"-").concat(e.y,"-").concat(e.z)}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:n}=this.opts;return{bbox:z8e(this._viewport,e.x,e.y,e.z,n)}}getParentIndex(e){const n=Math.floor(e.x/2),r=Math.floor(e.y/2),i=e.z-1;return{x:n,y:r,z:i}}updateTileStates(){const e=this.opts.refinementStrategy||nU,n=new Array(this._cache.size);let r=0;for(const i of this._cache.values())n[r++]=i.isVisible,i.isSelected=!1,i.isVisible=!1;for(const i of this._selectedTiles)i.isSelected=!0,i.isVisible=!0;(typeof e=="function"?e:Z8e[e])(Array.from(this._cache.values())),r=0;for(const i of this._cache.values())if(n[r++]!==i.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,n=[];let r=0;for(const i of this._cache.values())i.isLoading&&(r++,!i.isSelected&&!i.isVisible&&n.push(i));for(;e>0&&r>e&&n.length>0;)n.shift().abort(),r--}_rebuildTree(){const{_cache:e}=this;for(const n of e.values())n.parent=null,n.children&&(n.children.length=0);for(const n of e.values()){const r=this._getNearestAncestor(n);n.parent=r,r!=null&&r.children&&r.children.push(n)}}_resizeCache(){const{_cache:e,opts:n}=this,r=n.maxCacheSize||(n.maxCacheByteSize?1/0:X8e*this.selectedTiles.length),i=n.maxCacheByteSize||1/0;if(e.size>r||this._cacheByteSize>i){for(const[u,d]of e){if(!d.isVisible&&!d.isSelected){var a,s;this._cacheByteSize-=n.maxCacheByteSize?d.byteLength:0,e.delete(u),(a=(s=this.opts).onTileUnload)===null||a===void 0||a.call(s,d)}if(e.size<=r&&this._cacheByteSize<=i)break}this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((u,d)=>u.zoom-d.zoom),this._dirty=!1)}_getTile(e,n){const r=this.getTileId(e);let i=this._cache.get(r),o=!1;return!i&&n?(i=new Ooe(e),Object.assign(i,this.getTileMetadata(i.index)),Object.assign(i,{id:r,zoom:this.getTileZoom(i.index)}),o=!0,this._cache.set(r,i),this._dirty=!0):i&&i.needsReload&&(o=!0),i&&o&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(e){const{_minZoom:n=0}=this;let r=e.index;for(;this.getTileZoom(r)>n;){r=this.getParentIndex(r);const i=this._getTile(r);if(i)return i}return null}}function Q8e(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!Foe(e)&&rU(e);for(const e of t)e.isVisible=!!(e.state&iL)}function K8e(t){for(const n of t)n.state=0;for(const n of t)n.isSelected&&Foe(n);const e=Array.from(t).sort((n,r)=>n.zoom-r.zoom);for(const n of e)if(n.isVisible=!!(n.state&iL),n.children&&(n.isVisible||n.state&hq))for(const r of n.children)r.state=hq;else n.isSelected&&rU(n)}function Foe(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=iL,!0;e=e.parent}return!1}function rU(t){for(const e of t.children)e.isLoaded||e.content?e.state|=iL:rU(e)}const J8e={TilesetClass:Noe,data:{type:"data",value:[]},dataComparator:tM.equal,renderSubLayers:{type:"function",value:t=>new $1(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:nU,zRange:null,maxRequests:6,zoomOffset:0};class H1 extends Uh{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,n;(e=this.state)===null||e===void 0||(n=e.tileset)===null||n===void 0||n.finalize()}get isLoaded(){var e,n,r;return(e=this.state)===null||e===void 0||(n=e.tileset)===null||n===void 0||(r=n.selectedTiles)===null||r===void 0?void 0:r.every(i=>i.isLoaded&&i.layers&&i.layers.every(o=>o.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:n}=this.state;const r=e.propsOrDataChanged||e.updateTriggersChanged,i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);n?r&&(n.setOptions(this._getTilesetOptions()),i?n.reloadAll():this.state.tileset.tiles.forEach(o=>{o.layers=null})):(n=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:n})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:n,maxCacheByteSize:r,refinementStrategy:i,extent:o,maxZoom:a,minZoom:s,maxRequests:u,zoomOffset:d}=this.props;return{maxCacheSize:n,maxCacheByteSize:r,maxZoom:a,minZoom:s,tileSize:e,refinementStrategy:i,extent:o,maxRequests:u,zoomOffset:d,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const{tileset:e}=this.state,{zRange:n,modelMatrix:r}=this.props,i=e.update(this.context.viewport,{zRange:n,modelMatrix:r}),{isLoaded:o}=e,a=this.state.isLoaded!==o,s=this.state.frameNumber!==i;o&&(a||s)&&this._onViewportLoad(),s&&this.setState({frameNumber:i}),this.state.isLoaded=o}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:n}=this.props;n&&n(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,n){this.props.onTileError(e),n.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:n,getTileData:r,fetch:i}=this.props,{signal:o}=e;return e.url=typeof n=="string"||Array.isArray(n)?fE(n,e):null,r?r(e):i&&e.url?i(e.url,{propName:"data",layer:this,signal:o}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo({info:e,sourceLayer:n}){const r=n.props.tile;return e.picked&&(e.tile=r),e.sourceTile=r,e}_updateAutoHighlight(e){const n=e.sourceTile;if(n&&n.layers)for(const r of n.layers)r.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const n=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)n&&e.layers[0]&&Object.keys(n).some(r=>e.layers[0].props[r]!==n[r])&&(e.layers=e.layers.map(r=>r.clone(n)));else{const r=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=NE(r,Boolean).map(i=>i.clone({tile:e,...n}))}return e.layers})}filterSubLayer({layer:e,cullRect:n}){const{tile:r}=e.props;return this.state.tileset.isTileVisible(r,n)}}q(H1,"defaultProps",J8e);q(H1,"layerName","TileLayer");const eGe={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}};class iU extends V1{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`uniform float trailLength;
attribute float instanceTimestamps;
attribute float instanceNextTimestamps;
varying float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
varying float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:n,trailLength:r,currentTime:i}=this.props;e.uniforms={...e.uniforms,fadeTrail:n,trailLength:r,currentTime:i},super.draw(e)}}q(iU,"layerName","TripsLayer");q(iU,"defaultProps",eGe);var mn=function(t){t=t||{};var e=typeof t<"u"?t:{},n={},r;for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);var i="";function o(st){return e.locateFile?e.locateFile(st,i):i+st}var a;document.currentScript&&(i=document.currentScript.src),i.indexOf("blob:")!==0?i=i.substr(0,i.lastIndexOf("/")+1):i="",a=function(Pt,rn,Gn){var w=new XMLHttpRequest;w.open("GET",Pt,!0),w.responseType="arraybuffer",w.onload=function(){if(w.status==200||w.status==0&&w.response){rn(w.response);return}var Ir=ge(Pt);if(Ir){rn(Ir.buffer);return}Gn()},w.onerror=Gn,w.send(null)};var s=e.print||console.log.bind(console),u=e.printErr||console.warn.bind(console);for(r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);n=null,e.arguments&&e.arguments;var d=0,g=function(st){d=st},_=function(){return d},E=8;function P(st,Pt,rn,Gn){switch(rn=rn||"i8",rn.charAt(rn.length-1)==="*"&&(rn="i32"),rn){case"i1":me[st>>0]=Pt;break;case"i8":me[st>>0]=Pt;break;case"i16":be[st>>1]=Pt;break;case"i32":Ye[st>>2]=Pt;break;case"i64":Fa=[Pt>>>0,(Do=Pt,+It(Do)>=1?Do>0?(cn(+$t(Do/4294967296),4294967295)|0)>>>0:~~+Xt((Do-+(~~Do>>>0))/4294967296)>>>0:0)],Ye[st>>2]=Fa[0],Ye[st+4>>2]=Fa[1];break;case"float":tt[st>>2]=Pt;break;case"double":pt[st>>3]=Pt;break;default:tr("invalid type for setValue: "+rn)}}function R(st,Pt,rn){switch(Pt=Pt||"i8",Pt.charAt(Pt.length-1)==="*"&&(Pt="i32"),Pt){case"i1":return me[st>>0];case"i8":return me[st>>0];case"i16":return be[st>>1];case"i32":return Ye[st>>2];case"i64":return Ye[st>>2];case"float":return tt[st>>2];case"double":return pt[st>>3];default:tr("invalid type for getValue: "+Pt)}return null}var B=!1;function V(st,Pt){st||tr("Assertion failed: "+Pt)}function z(st){var Pt=e["_"+st];return V(Pt,"Cannot call unknown function "+st+", make sure it is exported"),Pt}function F(st,Pt,rn,Gn,w){var Ue={string:function(ro){var ca=0;if(ro!=null&&ro!==0){var kc=(ro.length<<2)+1;ca=ht(kc),ce(ro,ca,kc)}return ca},array:function(ro){var ca=ht(ro.length);return re(ro,ca),ca}};function Ir(ro){return Pt==="string"?J(ro):Pt==="boolean"?!!ro:ro}var fr=z(st),rr=[],Tr=0;if(Gn)for(var qi=0;qi<Gn.length;qi++){var qr=Ue[rn[qi]];qr?(Tr===0&&(Tr=rt()),rr[qi]=qr(Gn[qi])):rr[qi]=Gn[qi]}var jn=fr.apply(null,rr);return jn=Ir(jn),Tr!==0&&ft(Tr),jn}function k(st,Pt,rn,Gn){rn=rn||[];var w=rn.every(function(Ir){return Ir==="number"}),Ue=Pt!=="string";return Ue&&w&&!Gn?z(st):function(){return F(st,Pt,rn,arguments)}}var X=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Y(st,Pt,rn){for(var Gn=Pt+rn,w=Pt;st[w]&&!(w>=Gn);)++w;if(w-Pt>16&&st.subarray&&X)return X.decode(st.subarray(Pt,w));for(var Ue="";Pt<w;){var Ir=st[Pt++];if(!(Ir&128)){Ue+=String.fromCharCode(Ir);continue}var fr=st[Pt++]&63;if((Ir&224)==192){Ue+=String.fromCharCode((Ir&31)<<6|fr);continue}var rr=st[Pt++]&63;if((Ir&240)==224?Ir=(Ir&15)<<12|fr<<6|rr:Ir=(Ir&7)<<18|fr<<12|rr<<6|st[Pt++]&63,Ir<65536)Ue+=String.fromCharCode(Ir);else{var Tr=Ir-65536;Ue+=String.fromCharCode(55296|Tr>>10,56320|Tr&1023)}}return Ue}function J(st,Pt){return st?Y(Ce,st,Pt):""}function ie(st,Pt,rn,Gn){if(!(Gn>0))return 0;for(var w=rn,Ue=rn+Gn-1,Ir=0;Ir<st.length;++Ir){var fr=st.charCodeAt(Ir);if(fr>=55296&&fr<=57343){var rr=st.charCodeAt(++Ir);fr=65536+((fr&1023)<<10)|rr&1023}if(fr<=127){if(rn>=Ue)break;Pt[rn++]=fr}else if(fr<=2047){if(rn+1>=Ue)break;Pt[rn++]=192|fr>>6,Pt[rn++]=128|fr&63}else if(fr<=65535){if(rn+2>=Ue)break;Pt[rn++]=224|fr>>12,Pt[rn++]=128|fr>>6&63,Pt[rn++]=128|fr&63}else{if(rn+3>=Ue)break;Pt[rn++]=240|fr>>18,Pt[rn++]=128|fr>>12&63,Pt[rn++]=128|fr>>6&63,Pt[rn++]=128|fr&63}}return Pt[rn]=0,rn-w}function ce(st,Pt,rn){return ie(st,Ce,Pt,rn)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function re(st,Pt){me.set(st,Pt)}function ue(st,Pt){return st%Pt>0&&(st+=Pt-st%Pt),st}var se,me,Ce,be,Ye,tt,pt;function Ee(st){se=st,e.HEAP8=me=new Int8Array(st),e.HEAP16=be=new Int16Array(st),e.HEAP32=Ye=new Int32Array(st),e.HEAPU8=Ce=new Uint8Array(st),e.HEAPU16=new Uint16Array(st),e.HEAPU32=new Uint32Array(st),e.HEAPF32=tt=new Float32Array(st),e.HEAPF64=pt=new Float64Array(st)}var Ne=5266928,Be=24016,qe=e.TOTAL_MEMORY||33554432;e.buffer?se=e.buffer:se=new ArrayBuffer(qe),qe=se.byteLength,Ee(se),Ye[Be>>2]=Ne;function ct(st){for(;st.length>0;){var Pt=st.shift();if(typeof Pt=="function"){Pt();continue}var rn=Pt.func;typeof rn=="number"?Pt.arg===void 0?e.dynCall_v(rn):e.dynCall_vi(rn,Pt.arg):rn(Pt.arg===void 0?null:Pt.arg)}}var Ct=[],Dt=[],In=[],Mn=[];function Tn(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)hn(e.preRun.shift());ct(Ct)}function Nt(){ct(Dt)}function Zt(){ct(In)}function Wt(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)lr(e.postRun.shift());ct(Mn)}function hn(st){Ct.unshift(st)}function lr(st){Mn.unshift(st)}var It=Math.abs,Xt=Math.ceil,$t=Math.floor,cn=Math.min,Jt=0,Ln=null;function qn(st){Jt++,e.monitorRunDependencies&&e.monitorRunDependencies(Jt)}function or(st){if(Jt--,e.monitorRunDependencies&&e.monitorRunDependencies(Jt),Jt==0&&Ln){var Pt=Ln;Ln=null,Pt()}}e.preloadedImages={},e.preloadedAudios={};var cr=null,cs="data:application/octet-stream;base64,";function Ri(st){return String.prototype.startsWith?st.startsWith(cs):st.indexOf(cs)===0}var Do,Fa;cr="data:application/octet-stream;base64,AAAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAABAAAAAMAAAAGAAAABQAAAAIAAAAAAAAAAgAAAAMAAAABAAAABAAAAAYAAAAAAAAABQAAAAMAAAAGAAAABAAAAAUAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAABAAAABQAAAAIAAAAAAAAAAQAAAAMAAAAGAAAABAAAAAYAAAAAAAAABQAAAAIAAAABAAAABAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAgAAAAMAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAABgAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAABgAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAAAAAAABgAAAAAAAAADAAAAAgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAUAAAAEAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAEAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAUAAAACAAAABAAAAAMAAAAIAAAAAQAAAAcAAAAGAAAACQAAAAAAAAADAAAAAgAAAAIAAAAGAAAACgAAAAsAAAAAAAAAAQAAAAUAAAADAAAADQAAAAEAAAAHAAAABAAAAAwAAAAAAAAABAAAAH8AAAAPAAAACAAAAAMAAAAAAAAADAAAAAUAAAACAAAAEgAAAAoAAAAIAAAAAAAAABAAAAAGAAAADgAAAAsAAAARAAAAAQAAAAkAAAACAAAABwAAABUAAAAJAAAAEwAAAAMAAAANAAAAAQAAAAgAAAAFAAAAFgAAABAAAAAEAAAAAAAAAA8AAAAJAAAAEwAAAA4AAAAUAAAAAQAAAAcAAAAGAAAACgAAAAsAAAAYAAAAFwAAAAUAAAACAAAAEgAAAAsAAAARAAAAFwAAABkAAAACAAAABgAAAAoAAAAMAAAAHAAAAA0AAAAaAAAABAAAAA8AAAADAAAADQAAABoAAAAVAAAAHQAAAAMAAAAMAAAABwAAAA4AAAB/AAAAEQAAABsAAAAJAAAAFAAAAAYAAAAPAAAAFgAAABwAAAAfAAAABAAAAAgAAAAMAAAAEAAAABIAAAAhAAAAHgAAAAgAAAAFAAAAFgAAABEAAAALAAAADgAAAAYAAAAjAAAAGQAAABsAAAASAAAAGAAAAB4AAAAgAAAABQAAAAoAAAAQAAAAEwAAACIAAAAUAAAAJAAAAAcAAAAVAAAACQAAABQAAAAOAAAAEwAAAAkAAAAoAAAAGwAAACQAAAAVAAAAJgAAABMAAAAiAAAADQAAAB0AAAAHAAAAFgAAABAAAAApAAAAIQAAAA8AAAAIAAAAHwAAABcAAAAYAAAACwAAAAoAAAAnAAAAJQAAABkAAAAYAAAAfwAAACAAAAAlAAAACgAAABcAAAASAAAAGQAAABcAAAARAAAACwAAAC0AAAAnAAAAIwAAABoAAAAqAAAAHQAAACsAAAAMAAAAHAAAAA0AAAAbAAAAKAAAACMAAAAuAAAADgAAABQAAAARAAAAHAAAAB8AAAAqAAAALAAAAAwAAAAPAAAAGgAAAB0AAAArAAAAJgAAAC8AAAANAAAAGgAAABUAAAAeAAAAIAAAADAAAAAyAAAAEAAAABIAAAAhAAAAHwAAACkAAAAsAAAANQAAAA8AAAAWAAAAHAAAACAAAAAeAAAAGAAAABIAAAA0AAAAMgAAACUAAAAhAAAAHgAAADEAAAAwAAAAFgAAABAAAAApAAAAIgAAABMAAAAmAAAAFQAAADYAAAAkAAAAMwAAACMAAAAuAAAALQAAADgAAAARAAAAGwAAABkAAAAkAAAAFAAAACIAAAATAAAANwAAACgAAAA2AAAAJQAAACcAAAA0AAAAOQAAABgAAAAXAAAAIAAAACYAAAB/AAAAIgAAADMAAAAdAAAALwAAABUAAAAnAAAAJQAAABkAAAAXAAAAOwAAADkAAAAtAAAAKAAAABsAAAAkAAAAFAAAADwAAAAuAAAANwAAACkAAAAxAAAANQAAAD0AAAAWAAAAIQAAAB8AAAAqAAAAOgAAACsAAAA+AAAAHAAAACwAAAAaAAAAKwAAAD4AAAAvAAAAQAAAABoAAAAqAAAAHQAAACwAAAA1AAAAOgAAAEEAAAAcAAAAHwAAACoAAAAtAAAAJwAAACMAAAAZAAAAPwAAADsAAAA4AAAALgAAADwAAAA4AAAARAAAABsAAAAoAAAAIwAAAC8AAAAmAAAAKwAAAB0AAABFAAAAMwAAAEAAAAAwAAAAMQAAAB4AAAAhAAAAQwAAAEIAAAAyAAAAMQAAAH8AAAA9AAAAQgAAACEAAAAwAAAAKQAAADIAAAAwAAAAIAAAAB4AAABGAAAAQwAAADQAAAAzAAAARQAAADYAAABHAAAAJgAAAC8AAAAiAAAANAAAADkAAABGAAAASgAAACAAAAAlAAAAMgAAADUAAAA9AAAAQQAAAEsAAAAfAAAAKQAAACwAAAA2AAAARwAAADcAAABJAAAAIgAAADMAAAAkAAAANwAAACgAAAA2AAAAJAAAAEgAAAA8AAAASQAAADgAAABEAAAAPwAAAE0AAAAjAAAALgAAAC0AAAA5AAAAOwAAAEoAAABOAAAAJQAAACcAAAA0AAAAOgAAAH8AAAA+AAAATAAAACwAAABBAAAAKgAAADsAAAA/AAAATgAAAE8AAAAnAAAALQAAADkAAAA8AAAASAAAAEQAAABQAAAAKAAAADcAAAAuAAAAPQAAADUAAAAxAAAAKQAAAFEAAABLAAAAQgAAAD4AAAArAAAAOgAAACoAAABSAAAAQAAAAEwAAAA/AAAAfwAAADgAAAAtAAAATwAAADsAAABNAAAAQAAAAC8AAAA+AAAAKwAAAFQAAABFAAAAUgAAAEEAAAA6AAAANQAAACwAAABWAAAATAAAAEsAAABCAAAAQwAAAFEAAABVAAAAMQAAADAAAAA9AAAAQwAAAEIAAAAyAAAAMAAAAFcAAABVAAAARgAAAEQAAAA4AAAAPAAAAC4AAABaAAAATQAAAFAAAABFAAAAMwAAAEAAAAAvAAAAWQAAAEcAAABUAAAARgAAAEMAAAA0AAAAMgAAAFMAAABXAAAASgAAAEcAAABZAAAASQAAAFsAAAAzAAAARQAAADYAAABIAAAAfwAAAEkAAAA3AAAAUAAAADwAAABYAAAASQAAAFsAAABIAAAAWAAAADYAAABHAAAANwAAAEoAAABOAAAAUwAAAFwAAAA0AAAAOQAAAEYAAABLAAAAQQAAAD0AAAA1AAAAXgAAAFYAAABRAAAATAAAAFYAAABSAAAAYAAAADoAAABBAAAAPgAAAE0AAAA/AAAARAAAADgAAABdAAAATwAAAFoAAABOAAAASgAAADsAAAA5AAAAXwAAAFwAAABPAAAATwAAAE4AAAA/AAAAOwAAAF0AAABfAAAATQAAAFAAAABEAAAASAAAADwAAABjAAAAWgAAAFgAAABRAAAAVQAAAF4AAABlAAAAPQAAAEIAAABLAAAAUgAAAGAAAABUAAAAYgAAAD4AAABMAAAAQAAAAFMAAAB/AAAASgAAAEYAAABkAAAAVwAAAFwAAABUAAAARQAAAFIAAABAAAAAYQAAAFkAAABiAAAAVQAAAFcAAABlAAAAZgAAAEIAAABDAAAAUQAAAFYAAABMAAAASwAAAEEAAABoAAAAYAAAAF4AAABXAAAAUwAAAGYAAABkAAAAQwAAAEYAAABVAAAAWAAAAEgAAABbAAAASQAAAGMAAABQAAAAaQAAAFkAAABhAAAAWwAAAGcAAABFAAAAVAAAAEcAAABaAAAATQAAAFAAAABEAAAAagAAAF0AAABjAAAAWwAAAEkAAABZAAAARwAAAGkAAABYAAAAZwAAAFwAAABTAAAATgAAAEoAAABsAAAAZAAAAF8AAABdAAAATwAAAFoAAABNAAAAbQAAAF8AAABqAAAAXgAAAFYAAABRAAAASwAAAGsAAABoAAAAZQAAAF8AAABcAAAATwAAAE4AAABtAAAAbAAAAF0AAABgAAAAaAAAAGIAAABuAAAATAAAAFYAAABSAAAAYQAAAH8AAABiAAAAVAAAAGcAAABZAAAAbwAAAGIAAABuAAAAYQAAAG8AAABSAAAAYAAAAFQAAABjAAAAUAAAAGkAAABYAAAAagAAAFoAAABxAAAAZAAAAGYAAABTAAAAVwAAAGwAAAByAAAAXAAAAGUAAABmAAAAawAAAHAAAABRAAAAVQAAAF4AAABmAAAAZQAAAFcAAABVAAAAcgAAAHAAAABkAAAAZwAAAFsAAABhAAAAWQAAAHQAAABpAAAAbwAAAGgAAABrAAAAbgAAAHMAAABWAAAAXgAAAGAAAABpAAAAWAAAAGcAAABbAAAAcQAAAGMAAAB0AAAAagAAAF0AAABjAAAAWgAAAHUAAABtAAAAcQAAAGsAAAB/AAAAZQAAAF4AAABzAAAAaAAAAHAAAABsAAAAZAAAAF8AAABcAAAAdgAAAHIAAABtAAAAbQAAAGwAAABdAAAAXwAAAHUAAAB2AAAAagAAAG4AAABiAAAAaAAAAGAAAAB3AAAAbwAAAHMAAABvAAAAYQAAAG4AAABiAAAAdAAAAGcAAAB3AAAAcAAAAGsAAABmAAAAZQAAAHgAAABzAAAAcgAAAHEAAABjAAAAdAAAAGkAAAB1AAAAagAAAHkAAAByAAAAcAAAAGQAAABmAAAAdgAAAHgAAABsAAAAcwAAAG4AAABrAAAAaAAAAHgAAAB3AAAAcAAAAHQAAABnAAAAdwAAAG8AAABxAAAAaQAAAHkAAAB1AAAAfwAAAG0AAAB2AAAAcQAAAHkAAABqAAAAdgAAAHgAAABsAAAAcgAAAHUAAAB5AAAAbQAAAHcAAABvAAAAcwAAAG4AAAB5AAAAdAAAAHgAAAB4AAAAcwAAAHIAAABwAAAAeQAAAHcAAAB2AAAAeQAAAHQAAAB4AAAAdwAAAHUAAABxAAAAdgAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAQAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAADAAAABQAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAgAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAABQAAAAUAAAAAAAAAAAAAAP////8BAAAAAAAAAAMAAAAEAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAQAAAP//////////AQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAIAAAAAAAAAAAAAAAEAAAACAAAABgAAAAQAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAoAAAACAAAAAAAAAAAAAAABAAAAAQAAAAUAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAAAAAAAAAAAAAEAAAADAAAABwAAAAYAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAJAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAAAAAAAAAAAAQAAAAQAAAAIAAAACgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAAAAAAAAAAABAAAACwAAAA8AAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAgAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAAAAAAAAAAABAAAADAAAABAAAAAMAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAEAAAAKAAAAEwAAAAgAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAgAAAAAAAAAAAAAAAQAAAA0AAAARAAAADQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAAAAAAAAAAAAAEAAAAOAAAAEgAAAA8AAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAAAAAABAAAA//////////8TAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABIAAAAAAAAAGAAAAAAAAAAhAAAAAAAAAB4AAAAAAAAAIAAAAAMAAAAxAAAAAQAAADAAAAADAAAAMgAAAAMAAAAIAAAAAAAAAAUAAAAFAAAACgAAAAUAAAAWAAAAAAAAABAAAAAAAAAAEgAAAAAAAAApAAAAAQAAACEAAAAAAAAAHgAAAAAAAAAEAAAAAAAAAAAAAAAFAAAAAgAAAAUAAAAPAAAAAQAAAAgAAAAAAAAABQAAAAUAAAAfAAAAAQAAABYAAAAAAAAAEAAAAAAAAAACAAAAAAAAAAYAAAAAAAAADgAAAAAAAAAKAAAAAAAAAAsAAAAAAAAAEQAAAAMAAAAYAAAAAQAAABcAAAADAAAAGQAAAAMAAAAAAAAAAAAAAAEAAAAFAAAACQAAAAUAAAAFAAAAAAAAAAIAAAAAAAAABgAAAAAAAAASAAAAAQAAAAoAAAAAAAAACwAAAAAAAAAEAAAAAQAAAAMAAAAFAAAABwAAAAUAAAAIAAAAAQAAAAAAAAAAAAAAAQAAAAUAAAAQAAAAAQAAAAUAAAAAAAAAAgAAAAAAAAAHAAAAAAAAABUAAAAAAAAAJgAAAAAAAAAJAAAAAAAAABMAAAAAAAAAIgAAAAMAAAAOAAAAAQAAABQAAAADAAAAJAAAAAMAAAADAAAAAAAAAA0AAAAFAAAAHQAAAAUAAAABAAAAAAAAAAcAAAAAAAAAFQAAAAAAAAAGAAAAAQAAAAkAAAAAAAAAEwAAAAAAAAAEAAAAAgAAAAwAAAAFAAAAGgAAAAUAAAAAAAAAAQAAAAMAAAAAAAAADQAAAAUAAAACAAAAAQAAAAEAAAAAAAAABwAAAAAAAAAaAAAAAAAAACoAAAAAAAAAOgAAAAAAAAAdAAAAAAAAACsAAAAAAAAAPgAAAAMAAAAmAAAAAQAAAC8AAAADAAAAQAAAAAMAAAAMAAAAAAAAABwAAAAFAAAALAAAAAUAAAANAAAAAAAAABoAAAAAAAAAKgAAAAAAAAAVAAAAAQAAAB0AAAAAAAAAKwAAAAAAAAAEAAAAAwAAAA8AAAAFAAAAHwAAAAUAAAADAAAAAQAAAAwAAAAAAAAAHAAAAAUAAAAHAAAAAQAAAA0AAAAAAAAAGgAAAAAAAAAfAAAAAAAAACkAAAAAAAAAMQAAAAAAAAAsAAAAAAAAADUAAAAAAAAAPQAAAAMAAAA6AAAAAQAAAEEAAAADAAAASwAAAAMAAAAPAAAAAAAAABYAAAAFAAAAIQAAAAUAAAAcAAAAAAAAAB8AAAAAAAAAKQAAAAAAAAAqAAAAAQAAACwAAAAAAAAANQAAAAAAAAAEAAAABAAAAAgAAAAFAAAAEAAAAAUAAAAMAAAAAQAAAA8AAAAAAAAAFgAAAAUAAAAaAAAAAQAAABwAAAAAAAAAHwAAAAAAAAAyAAAAAAAAADAAAAAAAAAAMQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAIQAAAAMAAAAYAAAAAwAAABIAAAADAAAAEAAAAAMAAABGAAAAAAAAAEMAAAAAAAAAQgAAAAMAAAA0AAAAAwAAADIAAAAAAAAAMAAAAAAAAAAlAAAAAwAAACAAAAAAAAAAHgAAAAMAAABTAAAAAAAAAFcAAAADAAAAVQAAAAMAAABKAAAAAwAAAEYAAAAAAAAAQwAAAAAAAAA5AAAAAQAAADQAAAADAAAAMgAAAAAAAAAZAAAAAAAAABcAAAAAAAAAGAAAAAMAAAARAAAAAAAAAAsAAAADAAAACgAAAAMAAAAOAAAAAwAAAAYAAAADAAAAAgAAAAMAAAAtAAAAAAAAACcAAAAAAAAAJQAAAAMAAAAjAAAAAwAAABkAAAAAAAAAFwAAAAAAAAAbAAAAAwAAABEAAAAAAAAACwAAAAMAAAA/AAAAAAAAADsAAAADAAAAOQAAAAMAAAA4AAAAAwAAAC0AAAAAAAAAJwAAAAAAAAAuAAAAAwAAACMAAAADAAAAGQAAAAAAAAAkAAAAAAAAABQAAAAAAAAADgAAAAMAAAAiAAAAAAAAABMAAAADAAAACQAAAAMAAAAmAAAAAwAAABUAAAADAAAABwAAAAMAAAA3AAAAAAAAACgAAAAAAAAAGwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAFAAAAAAAAAAzAAAAAwAAACIAAAAAAAAAEwAAAAMAAABIAAAAAAAAADwAAAADAAAALgAAAAMAAABJAAAAAwAAADcAAAAAAAAAKAAAAAAAAABHAAAAAwAAADYAAAADAAAAJAAAAAAAAABAAAAAAAAAAC8AAAAAAAAAJgAAAAMAAAA+AAAAAAAAACsAAAADAAAAHQAAAAMAAAA6AAAAAwAAACoAAAADAAAAGgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAMwAAAAMAAABSAAAAAwAAAEAAAAAAAAAALwAAAAAAAABMAAAAAwAAAD4AAAAAAAAAKwAAAAMAAABhAAAAAAAAAFkAAAADAAAARwAAAAMAAABiAAAAAwAAAFQAAAAAAAAARQAAAAAAAABgAAAAAwAAAFIAAAADAAAAQAAAAAAAAABLAAAAAAAAAEEAAAAAAAAAOgAAAAMAAAA9AAAAAAAAADUAAAADAAAALAAAAAMAAAAxAAAAAwAAACkAAAADAAAAHwAAAAMAAABeAAAAAAAAAFYAAAAAAAAATAAAAAMAAABRAAAAAwAAAEsAAAAAAAAAQQAAAAAAAABCAAAAAwAAAD0AAAAAAAAANQAAAAMAAABrAAAAAAAAAGgAAAADAAAAYAAAAAMAAABlAAAAAwAAAF4AAAAAAAAAVgAAAAAAAABVAAAAAwAAAFEAAAADAAAASwAAAAAAAAA5AAAAAAAAADsAAAAAAAAAPwAAAAMAAABKAAAAAAAAAE4AAAADAAAATwAAAAMAAABTAAAAAwAAAFwAAAADAAAAXwAAAAMAAAAlAAAAAAAAACcAAAADAAAALQAAAAMAAAA0AAAAAAAAADkAAAAAAAAAOwAAAAAAAABGAAAAAwAAAEoAAAAAAAAATgAAAAMAAAAYAAAAAAAAABcAAAADAAAAGQAAAAMAAAAgAAAAAwAAACUAAAAAAAAAJwAAAAMAAAAyAAAAAwAAADQAAAAAAAAAOQAAAAAAAAAuAAAAAAAAADwAAAAAAAAASAAAAAMAAAA4AAAAAAAAAEQAAAADAAAAUAAAAAMAAAA/AAAAAwAAAE0AAAADAAAAWgAAAAMAAAAbAAAAAAAAACgAAAADAAAANwAAAAMAAAAjAAAAAAAAAC4AAAAAAAAAPAAAAAAAAAAtAAAAAwAAADgAAAAAAAAARAAAAAMAAAAOAAAAAAAAABQAAAADAAAAJAAAAAMAAAARAAAAAwAAABsAAAAAAAAAKAAAAAMAAAAZAAAAAwAAACMAAAAAAAAALgAAAAAAAABHAAAAAAAAAFkAAAAAAAAAYQAAAAMAAABJAAAAAAAAAFsAAAADAAAAZwAAAAMAAABIAAAAAwAAAFgAAAADAAAAaQAAAAMAAAAzAAAAAAAAAEUAAAADAAAAVAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAWQAAAAAAAAA3AAAAAwAAAEkAAAAAAAAAWwAAAAMAAAAmAAAAAAAAAC8AAAADAAAAQAAAAAMAAAAiAAAAAwAAADMAAAAAAAAARQAAAAMAAAAkAAAAAwAAADYAAAAAAAAARwAAAAAAAABgAAAAAAAAAGgAAAAAAAAAawAAAAMAAABiAAAAAAAAAG4AAAADAAAAcwAAAAMAAABhAAAAAwAAAG8AAAADAAAAdwAAAAMAAABMAAAAAAAAAFYAAAADAAAAXgAAAAMAAABSAAAAAAAAAGAAAAAAAAAAaAAAAAAAAABUAAAAAwAAAGIAAAAAAAAAbgAAAAMAAAA6AAAAAAAAAEEAAAADAAAASwAAAAMAAAA+AAAAAwAAAEwAAAAAAAAAVgAAAAMAAABAAAAAAwAAAFIAAAAAAAAAYAAAAAAAAABVAAAAAAAAAFcAAAAAAAAAUwAAAAMAAABlAAAAAAAAAGYAAAADAAAAZAAAAAMAAABrAAAAAwAAAHAAAAADAAAAcgAAAAMAAABCAAAAAAAAAEMAAAADAAAARgAAAAMAAABRAAAAAAAAAFUAAAAAAAAAVwAAAAAAAABeAAAAAwAAAGUAAAAAAAAAZgAAAAMAAAAxAAAAAAAAADAAAAADAAAAMgAAAAMAAAA9AAAAAwAAAEIAAAAAAAAAQwAAAAMAAABLAAAAAwAAAFEAAAAAAAAAVQAAAAAAAABfAAAAAAAAAFwAAAAAAAAAUwAAAAAAAABPAAAAAAAAAE4AAAAAAAAASgAAAAMAAAA/AAAAAQAAADsAAAADAAAAOQAAAAMAAABtAAAAAAAAAGwAAAAAAAAAZAAAAAUAAABdAAAAAQAAAF8AAAAAAAAAXAAAAAAAAABNAAAAAQAAAE8AAAAAAAAATgAAAAAAAAB1AAAABAAAAHYAAAAFAAAAcgAAAAUAAABqAAAAAQAAAG0AAAAAAAAAbAAAAAAAAABaAAAAAQAAAF0AAAABAAAAXwAAAAAAAABaAAAAAAAAAE0AAAAAAAAAPwAAAAAAAABQAAAAAAAAAEQAAAAAAAAAOAAAAAMAAABIAAAAAQAAADwAAAADAAAALgAAAAMAAABqAAAAAAAAAF0AAAAAAAAATwAAAAUAAABjAAAAAQAAAFoAAAAAAAAATQAAAAAAAABYAAAAAQAAAFAAAAAAAAAARAAAAAAAAAB1AAAAAwAAAG0AAAAFAAAAXwAAAAUAAABxAAAAAQAAAGoAAAAAAAAAXQAAAAAAAABpAAAAAQAAAGMAAAABAAAAWgAAAAAAAABpAAAAAAAAAFgAAAAAAAAASAAAAAAAAABnAAAAAAAAAFsAAAAAAAAASQAAAAMAAABhAAAAAQAAAFkAAAADAAAARwAAAAMAAABxAAAAAAAAAGMAAAAAAAAAUAAAAAUAAAB0AAAAAQAAAGkAAAAAAAAAWAAAAAAAAABvAAAAAQAAAGcAAAAAAAAAWwAAAAAAAAB1AAAAAgAAAGoAAAAFAAAAWgAAAAUAAAB5AAAAAQAAAHEAAAAAAAAAYwAAAAAAAAB3AAAAAQAAAHQAAAABAAAAaQAAAAAAAAB3AAAAAAAAAG8AAAAAAAAAYQAAAAAAAABzAAAAAAAAAG4AAAAAAAAAYgAAAAMAAABrAAAAAQAAAGgAAAADAAAAYAAAAAMAAAB5AAAAAAAAAHQAAAAAAAAAZwAAAAUAAAB4AAAAAQAAAHcAAAAAAAAAbwAAAAAAAABwAAAAAQAAAHMAAAAAAAAAbgAAAAAAAAB1AAAAAQAAAHEAAAAFAAAAaQAAAAUAAAB2AAAAAQAAAHkAAAAAAAAAdAAAAAAAAAByAAAAAQAAAHgAAAABAAAAdwAAAAAAAAByAAAAAAAAAHAAAAAAAAAAawAAAAAAAABkAAAAAAAAAGYAAAAAAAAAZQAAAAMAAABTAAAAAQAAAFcAAAADAAAAVQAAAAMAAAB2AAAAAAAAAHgAAAAAAAAAcwAAAAUAAABsAAAAAQAAAHIAAAAAAAAAcAAAAAAAAABcAAAAAQAAAGQAAAAAAAAAZgAAAAAAAAB1AAAAAAAAAHkAAAAFAAAAdwAAAAUAAABtAAAAAQAAAHYAAAAAAAAAeAAAAAAAAABfAAAAAQAAAGwAAAABAAAAcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAB+ogX28rbpPxqumpJv+fM/165tC4ns9D+XaEnTqUsEQFrOtNlC4PA/3U+0XG6P9b9TdUUBxTTjP4PUp8ex1ty/B1rD/EN43z+lcDi6LLrZP/a45NWEHMY/oJ5ijLDZ+j/xw3rjxWPjP2B8A46ioQdAotff3wla2z+FMSpA1jj+v6b5Y1mtPbS/cIu8K0F457/2esiyJpDNv98k5Ts2NeA/pvljWa09tD88ClUJ60MDQPZ6yLImkM0/4ONKxa0UBcD2uOTVhBzGv5G7JRxGave/8cN648Vj47+HCwtkjAXIv6LX398JWtu/qyheaCAL9D9TdUUBxTTjv4gyTxslhwVAB1rD/EN4378EH/28teoFwH6iBfbytum/F6ztFYdK/r/Xrm0Liez0vwcS6wNGWeO/Ws602ULg8L9TCtRLiLT8P8pi5RexJsw/BlIKPVwR5T95Wyu0/QjnP5PjoT7YYcu/mBhKZ6zrwj8wRYS7NebuP3qW6geh+Ls/SLrixebL3r+pcyymN9XrPwmkNHp7xec/GWNMZVAA17+82s+x2BLiPwn2ytbJ9ek/LgEH1sMS1j8yp/2LhTfeP+SnWwtQBbu/d38gkp5X7z8ytsuHaADGPzUYObdf1+m/7IauECWhwz+cjSACjzniP76Z+wUhN9K/1+GEKzup67+/GYr/04baPw6idWOvsuc/ZedTWsRa5b/EJQOuRzi0v/OncYhHPes/h49PixY53j+i8wWfC03Nvw2idWOvsue/ZedTWsRa5T/EJQOuRzi0P/KncYhHPeu/iY9PixY53r+i8wWfC03NP9anWwtQBbs/d38gkp5X778ytsuHaADGvzUYObdf1+k/74auECWhw7+cjSACjzniv8CZ+wUhN9I/1uGEKzup6z+/GYr/04bavwmkNHp7xee/F2NMZVAA1z+82s+x2BLivwr2ytbJ9em/KwEH1sMS1r8yp/2LhTfev81i5RexJsy/BlIKPVwR5b95Wyu0/Qjnv5DjoT7YYcs/nBhKZ6zrwr8wRYS7Nebuv3OW6geh+Lu/SLrixebL3j+pcyymN9Xrv8rHIFfWehZAMBwUdlo0DECTUc17EOb2PxpVB1SWChdAzjbhb9pTDUDQhmdvECX5P9FlMKCC9+g/IIAzjELgE0DajDngMv8GQFhWDmDPjNs/y1guLh96EkAxPi8k7DIEQJCc4URlhRhA3eLKKLwkEECqpNAyTBD/P6xpjXcDiwVAFtl//cQm4z+Ibt3XKiYTQM7mCLUb3QdAoM1t8yVv7D8aLZv2Nk8UQEAJPV5nQwxAtSsfTCoE9z9TPjXLXIIWQBVanC5W9AtAYM3d7Adm9j++5mQz1FoWQBUThyaVBghAwH5muQsV7T89Q1qv82MUQJoWGOfNuBdAzrkClkmwDkDQjKq77t37Py+g0dtitsE/ZwAMTwVPEUBojepluNwBQGYbtuW+t9w/HNWIJs6MEkDTNuQUSlgEQKxktPP5TcQ/ixbLB8JjEUCwuWjXMQYCQAS/R09FkRdAowpiZjhhDkB7LmlczD/7P01iQmhhsAVAnrtTwDy84z/Z6jfQ2TgTQChOCXMnWwpAhrW3daoz8z/HYJvVPI4VQLT3ik5FcA5Angi7LOZd+z+NNVzDy5gXQBXdvVTFUA1AYNMgOeYe+T8+qHXGCwkXQKQTOKwa5AJA8gFVoEMW0T+FwzJyttIRQAEAAAD/////BwAAAP////8xAAAA/////1cBAAD/////YQkAAP////+nQQAA/////5HLAQD/////95AMAP/////B9lcAAAAAAAAAAAAAAAAAAgAAAP////8OAAAA/////2IAAAD/////rgIAAP/////CEgAA/////06DAAD/////IpcDAP/////uIRkA/////4LtrwAAAAAAAAAAAAAAAAAAAAAAAgAAAP//////////AQAAAAMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////wIAAAD//////////wEAAAAAAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA/////////////////////wEAAAD///////////////8CAAAA////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD///////////////////////////////8CAAAA////////////////AQAAAP////////////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAAAQAAAP//////////AgAAAP//////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAAEAAAD//////////wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAgAAAAAAAAACAAAAAQAAAAEAAAACAAAAAgAAAAAAAAAFAAAABQAAAAAAAAACAAAAAgAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAABAAAAAgAAAAIAAAACAAAAAAAAAAUAAAAGAAAAAAAAAAIAAAACAAAAAwAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAAAAAAAAgAAAAEAAAADAAAAAgAAAAIAAAAAAAAABQAAAAcAAAAAAAAAAgAAAAIAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAACAAAAAQAAAAQAAAACAAAAAgAAAAAAAAAFAAAACAAAAAAAAAACAAAAAgAAAAMAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAACAAAAAAAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAUAAAAJAAAAAAAAAAIAAAACAAAAAwAAAAUAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAIAAAACAAAAAAAAAAMAAAAOAAAAAgAAAAAAAAACAAAAAwAAAAAAAAAAAAAAAgAAAAIAAAADAAAABgAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAgAAAAIAAAAAAAAAAwAAAAoAAAACAAAAAAAAAAIAAAADAAAAAQAAAAAAAAACAAAAAgAAAAMAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAgAAAAAAAAADAAAACwAAAAIAAAAAAAAAAgAAAAMAAAACAAAAAAAAAAIAAAACAAAAAwAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAACAAAAAAAAAAMAAAAMAAAAAgAAAAAAAAACAAAAAwAAAAMAAAAAAAAAAgAAAAIAAAADAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAIAAAAAAAAAAwAAAA0AAAACAAAAAAAAAAIAAAADAAAABAAAAAAAAAACAAAAAgAAAAMAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAgAAAAAAAAADAAAABgAAAAIAAAAAAAAAAgAAAAMAAAAPAAAAAAAAAAIAAAACAAAAAwAAAAsAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAIAAAACAAAAAAAAAAMAAAAHAAAAAgAAAAAAAAACAAAAAwAAABAAAAAAAAAAAgAAAAIAAAADAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAIAAAAAAAAAAwAAAAgAAAACAAAAAAAAAAIAAAADAAAAEQAAAAAAAAACAAAAAgAAAAMAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAACAAAAAgAAAAAAAAADAAAACQAAAAIAAAAAAAAAAgAAAAMAAAASAAAAAAAAAAIAAAACAAAAAwAAAA4AAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAACAAAAAAAAAAMAAAAFAAAAAgAAAAAAAAACAAAAAwAAABMAAAAAAAAAAgAAAAIAAAADAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAgAAAAAAAAACAAAAAQAAABMAAAACAAAAAgAAAAAAAAAFAAAACgAAAAAAAAACAAAAAgAAAAMAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABEAAAACAAAAAAAAAAIAAAABAAAADwAAAAIAAAACAAAAAAAAAAUAAAALAAAAAAAAAAIAAAACAAAAAwAAABEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAIAAAAAAAAAAgAAAAEAAAAQAAAAAgAAAAIAAAAAAAAABQAAAAwAAAAAAAAAAgAAAAIAAAADAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAACAAAAAQAAABEAAAACAAAAAgAAAAAAAAAFAAAADQAAAAAAAAACAAAAAgAAAAMAAAATAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAACAAAAAAAAAAIAAAABAAAAEgAAAAIAAAACAAAAAAAAAAUAAAAOAAAAAAAAAAIAAAACAAAAAwAAAAIAAAABAAAAAAAAAAEAAAACAAAAAAAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAEAAAAAAAAAAgAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAgAAAAAAAAABAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAFAAAAAAAAAAEAAAAAAAAAAAAAAMuhRbbsNlBBYqHW9OmHIkF9XBuqnS31QAK37uYhNMhAOSo3UUupm0DC+6pc6JxvQHV9eseEEEJAzURsCyqlFEB8BQ4NMJjnPyy3tBoS97o/xawXQznRjj89J2K2CZxhP6vX43RIIDQ/S8isgygEBz+LvFHQkmzaPjFFFO7wMq4+AADMLkTtjkIAAOgkJqxhQgAAU7B0MjRCAADwpBcVB0IAAACYP2HaQQAAAIn/Ja5BzczM4Eg6gUHNzMxMU7BTQTMzMzNfgCZBAAAAAEi3+UAAAAAAwGPNQDMzMzMzy6BAmpmZmZkxc0AzMzMzM/NFQDMzMzMzMxlAzczMzMzM7D+ygXSx2U6RQKimJOvQKnpA23hmONTHY0A/AGcxyudNQNb3K647mzZA+S56rrwWIUAm4kUQ+9UJQKre9hGzh/M/BLvoy9WG3T+LmqMf8VHGP2m3nYNV37A/gbFHcyeCmT+cBPWBckiDP61tZACjKW0/q2RbYVUYVj8uDypVyLNAP6jGS5cA5zBBwcqhBdCNGUEGEhQ/JVEDQT6WPnRbNO1AB/AWSJgT1kDfUWNCNLDAQNk+5C33OqlAchWL34QSk0DKvtDIrNV8QNF0G3kFzGVASSeWhBl6UED+/0mNGuk4QGjA/dm/1CJALPLPMql6DEDSHoDrwpP1P2jouzWST+A/egAAAAAAAABKAwAAAAAAAPoWAAAAAAAAyqAAAAAAAAB6ZQQAAAAAAErGHgAAAAAA+mvXAAAAAADK8+MFAAAAAHqqOykAAAAASqmhIAEAAAD6oGvkBwAAAMpm8T43AAAAes+ZuIIBAABKrDQMkwoAAPq1cFUFSgAAyvkUViUGAgAAAAAAAwAAAAYAAAACAAAABQAAAAEAAAAEAAAAAAAAAAAAAAAFAAAAAwAAAAEAAAAGAAAABAAAAAIAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAA/////wAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAP////8AAAAAAAAAAAEAAAABAAAAAAAAAAAAAAD/////AAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAABAAEAAAEBAAAAAAABAAAAAQAAAAEAAQAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAHAAAABwAAAAEAAAACAAAABAAAAAMAAAAAAAAAAAAAAAcAAAADAAAAAQAAAAIAAAAFAAAABAAAAAAAAAAAAAAAYWxnb3MuYwBfcG9seWZpbGxJbnRlcm5hbABhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0dlb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9HZW9Cb3VuZGFyeQBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGgzVG9Mb2NhbElqawBiYXNlQ2VsbCAhPSBvcmlnaW5CYXNlQ2VsbAAhKG9yaWdpbk9uUGVudCAmJiBpbmRleE9uUGVudCkAcGVudGFnb25Sb3RhdGlvbnMgPj0gMABkaXJlY3Rpb25Sb3RhdGlvbnMgPj0gMABiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvSDMAIV9pc0Jhc2VDZWxsUGVudGFnb24oYmFzZUNlbGwpAGJhc2VDZWxsUm90YXRpb25zID49IDAAd2l0aGluUGVudGFnb25Sb3RhdGlvbnMgPj0gMABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";var Nl=24032;function _s(st){return st}function mo(st){var Pt=/\b__Z[\w\d_]+/g;return st.replace(Pt,function(rn){var Gn=rn;return rn===Gn?rn:Gn+" ["+rn+"]"})}function Fl(){var st=new Error;if(!st.stack){try{throw new Error(0)}catch(Pt){st=Pt}if(!st.stack)return"(no stack trace available)"}return st.stack.toString()}function su(){var st=Fl();return e.extraStackTrace&&(st+=`
`+e.extraStackTrace()),mo(st)}function kl(st,Pt,rn,Gn){tr("Assertion failed: "+J(st)+", at: "+[Pt?J(Pt):"unknown filename",rn,Gn?J(Gn):"unknown function"])}function au(){return me.length}function $u(st,Pt,rn){Ce.set(Ce.subarray(Pt,Pt+rn),st)}function lu(st){return e.___errno_location&&(Ye[e.___errno_location()>>2]=st),st}function Hu(st){tr("OOM")}function uu(st){try{var Pt=new ArrayBuffer(st);return Pt.byteLength!=st?void 0:(new Int8Array(Pt).set(me),it(Pt),Ee(Pt),1)}catch{}}function Fc(st){var Pt=au(),rn=16777216,Gn=2147483648-rn;if(st>Gn)return!1;for(var w=16777216,Ue=Math.max(Pt,w);Ue<st;)Ue<=536870912?Ue=ue(2*Ue,rn):Ue=Math.min(ue((3*Ue+2147483648)/4,rn),Gn);var Ir=uu(Ue);return!!Ir}var Wu=typeof atob=="function"?atob:function(st){var Pt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",rn="",Gn,w,Ue,Ir,fr,rr,Tr,qi=0;st=st.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Ir=Pt.indexOf(st.charAt(qi++)),fr=Pt.indexOf(st.charAt(qi++)),rr=Pt.indexOf(st.charAt(qi++)),Tr=Pt.indexOf(st.charAt(qi++)),Gn=Ir<<2|fr>>4,w=(fr&15)<<4|rr>>2,Ue=(rr&3)<<6|Tr,rn=rn+String.fromCharCode(Gn),rr!==64&&(rn=rn+String.fromCharCode(w)),Tr!==64&&(rn=rn+String.fromCharCode(Ue));while(qi<st.length);return rn};function Ge(st){try{for(var Pt=Wu(st),rn=new Uint8Array(Pt.length),Gn=0;Gn<Pt.length;++Gn)rn[Gn]=Pt.charCodeAt(Gn);return rn}catch{throw new Error("Converting base64 string to bytes failed.")}}function ge(st){if(Ri(st))return Ge(st.slice(cs.length))}var Ae={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},ze={a:tr,b:g,c:_,d:kl,e:lu,f:au,g:$u,h:Fc,i:Hu,j:_s,k:mo,l:uu,m:Fl,n:su,o:Nl,p:Be},Me=function(st,Pt,rn){"almost asm";var Gn=new st.Int8Array(rn),w=new st.Int32Array(rn);new st.Uint8Array(rn),new st.Float32Array(rn);var Ue=new st.Float64Array(rn),Ir=Pt.p|0,fr=st.Math.floor,rr=st.Math.abs,Tr=st.Math.sqrt,qi=st.Math.pow,qr=st.Math.cos,jn=st.Math.sin,ro=st.Math.tan,ca=st.Math.acos,kc=st.Math.asin,zl=st.Math.atan,Qr=st.Math.atan2,Vo=st.Math.ceil,Bo=st.Math.imul,ka=st.Math.min,$o=st.Math.clz32,Hn=Pt.b,Ke=Pt.c,gt=Pt.d,za=Pt.e,Vi=Pt.f,gi=Pt.g,Nf=Pt.h,fa=Pt.i,Ve=24048;function $h(y){return Gn=new Int8Array(y),w=new Int32Array(y),Ue=new Float64Array(y),rn=y,!0}function cu(y){y=y|0;var x=0;return x=Ve,Ve=Ve+y|0,Ve=Ve+15&-16,x|0}function _n(){return Ve|0}function ur(y){y=y|0,Ve=y}function Cr(y,x){y=y|0,Ve=y}function Os(y){return y=y|0,(Bo(y*3|0,y+1|0)|0)+1|0}function Rs(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0;var D=0,j=0;ys(y,x,T,O,0)|0&&(j=(Bo(T*3|0,T+1|0)|0)+1|0,Aa(O|0,0,j<<3|0)|0,D=ma(j,4)|0,D&&(Ls(y,x,T,O,D,j,0),Mr(D)))}function xr(y,x,T,O,D){y=y|0,x=x|0,T=T|0,O=O|0,D=D|0;var j=0;if(ys(y,x,T,O,D)|0){if(j=(Bo(T*3|0,T+1|0)|0)+1|0,Aa(O|0,0,j<<3|0)|0,D|0){Aa(D|0,0,j<<2|0)|0,Ls(y,x,T,O,D,j,0);return}D=ma(j,4)|0,D&&(Ls(y,x,T,O,D,j,0),Mr(D))}}function ys(y,x,T,O,D){y=y|0,x=x|0,T=T|0,O=O|0,D=D|0;var j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0;if(mt=Ve,Ve=Ve+16|0,nt=mt,j=O,w[j>>2]=y,w[j+4>>2]=x,j=(D|0)!=0,j&&(w[D>>2]=0),No(y,x)|0)return nt=1,Ve=mt,nt|0;w[nt>>2]=0;e:do if((T|0)>=1)if(j)for(pe=0,_e=1,Xe=1,G=0,j=y;;){if(!(G|pe)){if(j=ye(j,x,4,nt)|0,x=Ke()|0,(j|0)==0&(x|0)==0){j=2;break e}if(No(j,x)|0){j=1;break e}}if(j=ye(j,x,w[16+(pe<<2)>>2]|0,nt)|0,x=Ke()|0,(j|0)==0&(x|0)==0){j=2;break e}if(y=O+(Xe<<3)|0,w[y>>2]=j,w[y+4>>2]=x,w[D+(Xe<<2)>>2]=_e,G=G+1|0,y=(G|0)==(_e|0),Z=pe+1|0,ae=(Z|0)==6,No(j,x)|0){j=1;break e}if(_e=_e+(ae&y&1)|0,(_e|0)>(T|0)){j=0;break}else pe=y?ae?0:Z:pe,Xe=Xe+1|0,G=y?0:G}else for(pe=0,_e=1,Xe=1,G=0,j=y;;){if(!(G|pe)){if(j=ye(j,x,4,nt)|0,x=Ke()|0,(j|0)==0&(x|0)==0){j=2;break e}if(No(j,x)|0){j=1;break e}}if(j=ye(j,x,w[16+(pe<<2)>>2]|0,nt)|0,x=Ke()|0,(j|0)==0&(x|0)==0){j=2;break e}if(y=O+(Xe<<3)|0,w[y>>2]=j,w[y+4>>2]=x,G=G+1|0,y=(G|0)==(_e|0),Z=pe+1|0,ae=(Z|0)==6,No(j,x)|0){j=1;break e}if(_e=_e+(ae&y&1)|0,(_e|0)>(T|0)){j=0;break}else pe=y?ae?0:Z:pe,Xe=Xe+1|0,G=y?0:G}else j=0;while(0);return nt=j,Ve=mt,nt|0}function Ls(y,x,T,O,D,j,G){y=y|0,x=x|0,T=T|0,O=O|0,D=D|0,j=j|0,G=G|0;var Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0;if(Xe=Ve,Ve=Ve+16|0,_e=Xe,(y|0)==0&(x|0)==0){Ve=Xe;return}if(Z=Hc(y|0,x|0,j|0,((j|0)<0)<<31>>31|0)|0,Ke()|0,ae=O+(Z<<3)|0,nt=ae,mt=w[nt>>2]|0,nt=w[nt+4>>2]|0,pe=(mt|0)==(y|0)&(nt|0)==(x|0),!((mt|0)==0&(nt|0)==0|pe))do Z=(Z+1|0)%(j|0)|0,ae=O+(Z<<3)|0,mt=ae,nt=w[mt>>2]|0,mt=w[mt+4>>2]|0,pe=(nt|0)==(y|0)&(mt|0)==(x|0);while(!((nt|0)==0&(mt|0)==0|pe));if(Z=D+(Z<<2)|0,pe&&(w[Z>>2]|0)<=(G|0)){Ve=Xe;return}if(mt=ae,w[mt>>2]=y,w[mt+4>>2]=x,w[Z>>2]=G,(G|0)>=(T|0)){Ve=Xe;return}mt=G+1|0,w[_e>>2]=0,nt=ye(y,x,2,_e)|0,Ls(nt,Ke()|0,T,O,D,j,mt),w[_e>>2]=0,nt=ye(y,x,3,_e)|0,Ls(nt,Ke()|0,T,O,D,j,mt),w[_e>>2]=0,nt=ye(y,x,1,_e)|0,Ls(nt,Ke()|0,T,O,D,j,mt),w[_e>>2]=0,nt=ye(y,x,5,_e)|0,Ls(nt,Ke()|0,T,O,D,j,mt),w[_e>>2]=0,nt=ye(y,x,4,_e)|0,Ls(nt,Ke()|0,T,O,D,j,mt),w[_e>>2]=0,nt=ye(y,x,6,_e)|0,Ls(nt,Ke()|0,T,O,D,j,mt),Ve=Xe}function ye(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0;var D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0;if((w[O>>2]|0)>0){D=0;do T=Gl(T)|0,D=D+1|0;while((D|0)<(w[O>>2]|0))}Z=An(y|0,x|0,45)|0,Ke()|0,ae=Z&127,j=fs(y,x)|0,D=An(y|0,x|0,52)|0,Ke()|0,D=D&15;e:do if(!D)G=6;else for(;;){if(Xe=(15-D|0)*3|0,nt=An(y|0,x|0,Xe|0)|0,Ke()|0,nt=nt&7,mt=(Ua(D)|0)==0,D=D+-1|0,_e=Dn(7,0,Xe|0)|0,x=x&~(Ke()|0),Xe=Dn(w[(mt?464:48)+(nt*28|0)+(T<<2)>>2]|0,0,Xe|0)|0,pe=Ke()|0,T=w[(mt?672:256)+(nt*28|0)+(T<<2)>>2]|0,y=Xe|y&~_e,x=pe|x,!T){T=0;break e}if(!D){G=6;break}}while(0);(G|0)==6&&(mt=w[880+(ae*28|0)+(T<<2)>>2]|0,nt=Dn(mt|0,0,45)|0,y=nt|y,x=Ke()|0|x&-1040385,T=w[4304+(ae*28|0)+(T<<2)>>2]|0,(mt&127|0)==127&&(mt=Dn(w[880+(ae*28|0)+20>>2]|0,0,45)|0,x=Ke()|0|x&-1040385,T=w[4304+(ae*28|0)+20>>2]|0,y=ws(mt|y,x)|0,x=Ke()|0,w[O>>2]=(w[O>>2]|0)+1)),G=An(y|0,x|0,45)|0,Ke()|0,G=G&127;e:do if(Lr(G)|0){t:do if((fs(y,x)|0)==1){if((ae|0)!=(G|0))if(lo(G,w[7728+(ae*28|0)>>2]|0)|0){y=mp(y,x)|0,j=1,x=Ke()|0;break}else{y=ws(y,x)|0,j=1,x=Ke()|0;break}switch(j|0){case 5:{y=mp(y,x)|0,x=Ke()|0,w[O>>2]=(w[O>>2]|0)+5,j=0;break t}case 3:{y=ws(y,x)|0,x=Ke()|0,w[O>>2]=(w[O>>2]|0)+1,j=0;break t}default:return nt=0,mt=0,Hn(nt|0),mt|0}}else j=0;while(0);if((T|0)>0){D=0;do y=gp(y,x)|0,x=Ke()|0,D=D+1|0;while((D|0)!=(T|0))}if((ae|0)!=(G|0)){if(!(ao(G)|0)){if((j|0)!=0|(fs(y,x)|0)!=5)break;w[O>>2]=(w[O>>2]|0)+1;break}switch(Z&127){case 8:case 118:break e}(fs(y,x)|0)!=3&&(w[O>>2]=(w[O>>2]|0)+1)}}else if((T|0)>0){D=0;do y=ws(y,x)|0,x=Ke()|0,D=D+1|0;while((D|0)!=(T|0))}while(0);return w[O>>2]=((w[O>>2]|0)+T|0)%6|0,nt=x,mt=y,Hn(nt|0),mt|0}function Oe(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0;var D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0;if(Xe=Ve,Ve=Ve+16|0,_e=Xe,!T)return _e=O,w[_e>>2]=y,w[_e+4>>2]=x,_e=0,Ve=Xe,_e|0;w[_e>>2]=0;e:do if(No(y,x)|0)y=1;else{if(j=(T|0)>0,j){D=0,pe=y;do{if(pe=ye(pe,x,4,_e)|0,x=Ke()|0,(pe|0)==0&(x|0)==0){y=2;break e}if(D=D+1|0,No(pe,x)|0){y=1;break e}}while((D|0)<(T|0));if(ae=O,w[ae>>2]=pe,w[ae+4>>2]=x,ae=T+-1|0,j){j=0,G=1,D=pe,y=x;do{if(D=ye(D,y,2,_e)|0,y=Ke()|0,(D|0)==0&(y|0)==0){y=2;break e}if(Z=O+(G<<3)|0,w[Z>>2]=D,w[Z+4>>2]=y,G=G+1|0,No(D,y)|0){y=1;break e}j=j+1|0}while((j|0)<(T|0));Z=0,j=G;do{if(D=ye(D,y,3,_e)|0,y=Ke()|0,(D|0)==0&(y|0)==0){y=2;break e}if(G=O+(j<<3)|0,w[G>>2]=D,w[G+4>>2]=y,j=j+1|0,No(D,y)|0){y=1;break e}Z=Z+1|0}while((Z|0)<(T|0));G=0;do{if(D=ye(D,y,1,_e)|0,y=Ke()|0,(D|0)==0&(y|0)==0){y=2;break e}if(Z=O+(j<<3)|0,w[Z>>2]=D,w[Z+4>>2]=y,j=j+1|0,No(D,y)|0){y=1;break e}G=G+1|0}while((G|0)<(T|0));G=0;do{if(D=ye(D,y,5,_e)|0,y=Ke()|0,(D|0)==0&(y|0)==0){y=2;break e}if(Z=O+(j<<3)|0,w[Z>>2]=D,w[Z+4>>2]=y,j=j+1|0,No(D,y)|0){y=1;break e}G=G+1|0}while((G|0)<(T|0));G=0;do{if(D=ye(D,y,4,_e)|0,y=Ke()|0,(D|0)==0&(y|0)==0){y=2;break e}if(Z=O+(j<<3)|0,w[Z>>2]=D,w[Z+4>>2]=y,j=j+1|0,No(D,y)|0){y=1;break e}G=G+1|0}while((G|0)<(T|0));for(G=0;;){if(D=ye(D,y,6,_e)|0,y=Ke()|0,(D|0)==0&(y|0)==0){y=2;break e}if((G|0)!=(ae|0))if(Z=O+(j<<3)|0,w[Z>>2]=D,w[Z+4>>2]=y,!(No(D,y)|0))j=j+1|0;else{y=1;break e}if(G=G+1|0,(G|0)>=(T|0)){G=pe,j=x;break}}}else G=pe,D=pe,j=x,y=x}else G=O,w[G>>2]=y,w[G+4>>2]=x,G=y,D=y,j=x,y=x;y=((G|0)!=(D|0)|(j|0)!=(y|0))&1}while(0);return _e=y,Ve=Xe,_e|0}function He(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0;if(j=Ve,Ve=Ve+48|0,D=j+8|0,O=j,Z=y,G=w[Z+4>>2]|0,T=O,w[T>>2]=w[Z>>2],w[T+4>>2]=G,jc(O,D),D=Xi(D,x)|0,x=w[O>>2]|0,O=w[y+8>>2]|0,(O|0)<=0)return Z=x,G=(D|0)<(Z|0),Z=G?Z:D,Z=Z+12|0,Ve=j,Z|0;T=w[y+12>>2]|0,y=0;do x=(w[T+(y<<3)>>2]|0)+x|0,y=y+1|0;while((y|0)<(O|0));return Z=(D|0)<(x|0),Z=Z?x:D,Z=Z+12|0,Ve=j,Z|0}function Ot(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0,ae=0;if(Z=Ve,Ve=Ve+48|0,O=Z+8|0,D=Z,!(on(y,x,T)|0)){Ve=Z;return}if(ae=y,j=w[ae+4>>2]|0,G=D,w[G>>2]=w[ae>>2],w[G+4>>2]=j,jc(D,O),G=Xi(O,x)|0,x=w[D>>2]|0,j=w[y+8>>2]|0,(j|0)>0){D=w[y+12>>2]|0,O=0;do x=(w[D+(O<<3)>>2]|0)+x|0,O=O+1|0;while((O|0)!=(j|0))}if(x=(G|0)<(x|0)?x:G,(x|0)<=-12){Ve=Z;return}ae=x+11|0,Aa(T|0,0,(((ae|0)>0?ae:0)<<3)+8|0)|0,Ve=Z}function on(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0,Vt=0,yn=0,Cn=0,Rt=0,fn=0,ot=0,On=0,Bn=0,Pn=0,Mt=0,br=0,ui=0,Vr=0,Jr=0,qt=0,xi=0,$i=0,gr=0;if(gr=Ve,Ve=Ve+112|0,Jr=gr+80|0,ae=gr+72|0,qt=gr,xi=gr+56|0,pe=y+8|0,$i=Ga((w[pe>>2]<<5)+32|0)|0,$i||gt(22848,22448,800,22456),$g(y,$i),j=y,O=w[j+4>>2]|0,Z=ae,w[Z>>2]=w[j>>2],w[Z+4>>2]=O,jc(ae,Jr),Z=Xi(Jr,x)|0,O=w[ae>>2]|0,j=w[pe>>2]|0,(j|0)>0){G=w[y+12>>2]|0,D=0;do O=(w[G+(D<<3)>>2]|0)+O|0,D=D+1|0;while((D|0)!=(j|0))}if(Z=(Z|0)<(O|0)?O:Z,Vr=Z+12|0,D=ma(Vr,8)|0,_e=ma(Vr,8)|0,w[Jr>>2]=0,br=y,ui=w[br+4>>2]|0,O=ae,w[O>>2]=w[br>>2],w[O+4>>2]=ui,O=Fn(ae,Vr,x,Jr,D,_e)|0,O|0)return Mr(D),Mr(_e),Mr($i),$i=O,Ve=gr,$i|0;e:do if((w[pe>>2]|0)>0){for(j=y+12|0,O=0;G=Fn((w[j>>2]|0)+(O<<3)|0,Vr,x,Jr,D,_e)|0,O=O+1|0,!(G|0);)if((O|0)>=(w[pe>>2]|0))break e;return Mr(D),Mr(_e),Mr($i),$i=G,Ve=gr,$i|0}while(0);(Z|0)>-12&&Aa(_e|0,0,((Vr|0)>1?Vr:1)<<3|0)|0;e:do if((w[Jr>>2]|0)>0){ui=((Vr|0)<0)<<31>>31,ot=D,On=_e,Bn=D,Pn=D,Mt=_e,br=D,O=D,yn=D,Cn=_e,Rt=_e,fn=_e,D=_e;t:for(;;){for(Vt=w[Jr>>2]|0,mt=0,kt=0,j=0;;){G=qt,Z=G+56|0;do w[G>>2]=0,G=G+4|0;while((G|0)<(Z|0));if(x=ot+(mt<<3)|0,ae=w[x>>2]|0,x=w[x+4>>2]|0,ys(ae,x,1,qt,0)|0){G=qt,Z=G+56|0;do w[G>>2]=0,G=G+4|0;while((G|0)<(Z|0));G=ma(7,4)|0,G|0&&(Ls(ae,x,1,qt,G,7,0),Mr(G))}nt=0;do{Xe=qt+(nt<<3)|0,_e=w[Xe>>2]|0,Xe=w[Xe+4>>2]|0;n:do if(!((_e|0)==0&(Xe|0)==0)){if(ae=Hc(_e|0,Xe|0,Vr|0,ui|0)|0,Ke()|0,G=T+(ae<<3)|0,Z=G,x=w[Z>>2]|0,Z=w[Z+4>>2]|0,!((x|0)==0&(Z|0)==0))for(pe=0;;){if((pe|0)>(Vr|0))break t;if((x|0)==(_e|0)&(Z|0)==(Xe|0))break n;if(ae=(ae+1|0)%(Vr|0)|0,G=T+(ae<<3)|0,Z=G,x=w[Z>>2]|0,Z=w[Z+4>>2]|0,(x|0)==0&(Z|0)==0)break;pe=pe+1|0}(_e|0)==0&(Xe|0)==0||(du(_e,Xe,xi),Hg(y,$i,xi)|0&&(pe=G,w[pe>>2]=_e,w[pe+4>>2]=Xe,pe=On+(j<<3)|0,w[pe>>2]=_e,w[pe+4>>2]=Xe,j=j+1|0))}while(0);nt=nt+1|0}while(nt>>>0<7);if(kt=kt+1|0,(kt|0)>=(Vt|0))break;mt=mt+1|0}if((Vt|0)>0&&Aa(Bn|0,0,Vt<<3|0)|0,w[Jr>>2]=j,(j|0)>0)_e=D,Xe=fn,nt=br,mt=Rt,kt=Cn,Vt=On,D=yn,fn=O,Rt=Pn,Cn=Bn,yn=_e,O=Xe,br=Mt,Mt=nt,Pn=mt,Bn=kt,On=ot,ot=Vt;else break e}return Mr(Pn),Mr(Mt),Mr($i),$i=-1,Ve=gr,$i|0}else O=_e;while(0);return Mr($i),Mr(D),Mr(O),$i=0,Ve=gr,$i|0}function Fn(y,x,T,O,D,j){y=y|0,x=x|0,T=T|0,O=O|0,D=D|0,j=j|0;var G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0,Vt=0,yn=0,Cn=0,Rt=0,fn=0,ot=0,On=0,Bn=0,Pn=0,Mt=0,br=0,ui=0,Vr=0,Jr=0;if(ui=Ve,Ve=Ve+48|0,Bn=ui+32|0,Pn=ui+16|0,Mt=ui,G=w[y>>2]|0,(G|0)<=0)return br=0,Ve=ui,br|0;Cn=y+4|0,Rt=Bn+8|0,fn=Pn+8|0,ot=Mt+8|0,On=((x|0)<0)<<31>>31,yn=0;e:for(;;){Z=w[Cn>>2]|0,kt=Z+(yn<<4)|0,w[Bn>>2]=w[kt>>2],w[Bn+4>>2]=w[kt+4>>2],w[Bn+8>>2]=w[kt+8>>2],w[Bn+12>>2]=w[kt+12>>2],(yn|0)==(G+-1|0)?(w[Pn>>2]=w[Z>>2],w[Pn+4>>2]=w[Z+4>>2],w[Pn+8>>2]=w[Z+8>>2],w[Pn+12>>2]=w[Z+12>>2]):(kt=Z+(yn+1<<4)|0,w[Pn>>2]=w[kt>>2],w[Pn+4>>2]=w[kt+4>>2],w[Pn+8>>2]=w[kt+8>>2],w[Pn+12>>2]=w[kt+12>>2]),kt=ap(Bn,Pn,T)|0;t:do if((kt|0)>0){Vt=+(kt|0),mt=0;n:for(;;){Jr=+(kt-mt|0),Vr=+(mt|0),Ue[Mt>>3]=+Ue[Bn>>3]*Jr/Vt+ +Ue[Pn>>3]*Vr/Vt,Ue[ot>>3]=+Ue[Rt>>3]*Jr/Vt+ +Ue[fn>>3]*Vr/Vt,Xe=zg(Mt,T)|0,nt=Ke()|0,Z=Hc(Xe|0,nt|0,x|0,On|0)|0,Ke()|0,G=j+(Z<<3)|0,ae=G,pe=w[ae>>2]|0,ae=w[ae+4>>2]|0;r:do if((pe|0)==0&(ae|0)==0)br=14;else for(_e=0;;){if((_e|0)>(x|0)){G=1;break r}if((pe|0)==(Xe|0)&(ae|0)==(nt|0)){G=7;break r}if(Z=(Z+1|0)%(x|0)|0,G=j+(Z<<3)|0,ae=G,pe=w[ae>>2]|0,ae=w[ae+4>>2]|0,(pe|0)==0&(ae|0)==0){br=14;break}else _e=_e+1|0}while(0);switch((br|0)==14&&(br=0,(Xe|0)==0&(nt|0)==0?G=7:(w[G>>2]=Xe,w[G+4>>2]=nt,G=w[O>>2]|0,_e=D+(G<<3)|0,w[_e>>2]=Xe,w[_e+4>>2]=nt,w[O>>2]=G+1,G=0)),G&7){case 7:case 0:break;default:break n}if(mt=mt+1|0,(kt|0)<=(mt|0)){br=8;break t}}if(G|0){G=-1,br=20;break e}}else br=8;while(0);if((br|0)==8&&(br=0),yn=yn+1|0,G=w[y>>2]|0,(yn|0)>=(G|0)){G=0,br=20;break}}return(br|0)==20?(Ve=ui,G|0):0}function Rr(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0;if(pe=Ve,Ve=Ve+176|0,ae=pe,(x|0)<1){Kh(T,0,0),Ve=pe;return}G=y,G=An(w[G>>2]|0,w[G+4>>2]|0,52)|0,Ke()|0,Kh(T,(x|0)>6?x:6,G&15),G=0;do{if(O=y+(G<<3)|0,jl(w[O>>2]|0,w[O+4>>2]|0,ae),O=w[ae>>2]|0,(O|0)>0){Z=0;do j=ae+8+(Z<<4)|0,Z=Z+1|0,O=ae+8+(((Z|0)%(O|0)|0)<<4)|0,D=z_(T,O,j)|0,D?Sn(T,D)|0:Vl(T,j,O)|0,O=w[ae>>2]|0;while((Z|0)<(O|0))}G=G+1|0}while((G|0)!=(x|0));Ve=pe}function Ao(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0;if(j=Ve,Ve=Ve+32|0,O=j,D=j+16|0,Rr(y,x,D),w[T>>2]=0,w[T+4>>2]=0,w[T+8>>2]=0,y=Tp(D)|0,!y){zA(T)|0,Sp(D),Ve=j;return}do{x=ax(T)|0;do lx(x,y)|0,G=y+16|0,w[O>>2]=w[G>>2],w[O+4>>2]=w[G+4>>2],w[O+8>>2]=w[G+8>>2],w[O+12>>2]=w[G+12>>2],Sn(D,y)|0,y=Cp(D,O)|0;while(y|0);y=Tp(D)|0}while(y|0);zA(T)|0,Sp(D),Ve=j}function Lr(y){return y=y|0,w[7728+(y*28|0)+16>>2]|0}function ao(y){return y=y|0,(y|0)==4|(y|0)==117|0}function vs(y){return y=y|0,w[11152+((w[y>>2]|0)*216|0)+((w[y+4>>2]|0)*72|0)+((w[y+8>>2]|0)*24|0)+(w[y+12>>2]<<3)>>2]|0}function Ig(y){return y=y|0,w[11152+((w[y>>2]|0)*216|0)+((w[y+4>>2]|0)*72|0)+((w[y+8>>2]|0)*24|0)+(w[y+12>>2]<<3)+4>>2]|0}function Hh(y,x){y=y|0,x=x|0,y=7728+(y*28|0)|0,w[x>>2]=w[y>>2],w[x+4>>2]=w[y+4>>2],w[x+8>>2]=w[y+8>>2],w[x+12>>2]=w[y+12>>2]}function ha(y,x){y=y|0,x=x|0;var T=0,O=0;if(x>>>0>20)return x=-1,x|0;do if((w[11152+(x*216|0)>>2]|0)!=(y|0))if((w[11152+(x*216|0)+8>>2]|0)!=(y|0))if((w[11152+(x*216|0)+16>>2]|0)!=(y|0))if((w[11152+(x*216|0)+24>>2]|0)!=(y|0))if((w[11152+(x*216|0)+32>>2]|0)!=(y|0))if((w[11152+(x*216|0)+40>>2]|0)!=(y|0))if((w[11152+(x*216|0)+48>>2]|0)!=(y|0))if((w[11152+(x*216|0)+56>>2]|0)!=(y|0))if((w[11152+(x*216|0)+64>>2]|0)!=(y|0))if((w[11152+(x*216|0)+72>>2]|0)!=(y|0))if((w[11152+(x*216|0)+80>>2]|0)!=(y|0))if((w[11152+(x*216|0)+88>>2]|0)!=(y|0))if((w[11152+(x*216|0)+96>>2]|0)!=(y|0))if((w[11152+(x*216|0)+104>>2]|0)!=(y|0))if((w[11152+(x*216|0)+112>>2]|0)!=(y|0))if((w[11152+(x*216|0)+120>>2]|0)!=(y|0))if((w[11152+(x*216|0)+128>>2]|0)!=(y|0))if((w[11152+(x*216|0)+136>>2]|0)==(y|0))y=2,T=1,O=2;else{if((w[11152+(x*216|0)+144>>2]|0)==(y|0)){y=0,T=2,O=0;break}if((w[11152+(x*216|0)+152>>2]|0)==(y|0)){y=0,T=2,O=1;break}if((w[11152+(x*216|0)+160>>2]|0)==(y|0)){y=0,T=2,O=2;break}if((w[11152+(x*216|0)+168>>2]|0)==(y|0)){y=1,T=2,O=0;break}if((w[11152+(x*216|0)+176>>2]|0)==(y|0)){y=1,T=2,O=1;break}if((w[11152+(x*216|0)+184>>2]|0)==(y|0)){y=1,T=2,O=2;break}if((w[11152+(x*216|0)+192>>2]|0)==(y|0)){y=2,T=2,O=0;break}if((w[11152+(x*216|0)+200>>2]|0)==(y|0)){y=2,T=2,O=1;break}if((w[11152+(x*216|0)+208>>2]|0)==(y|0)){y=2,T=2,O=2;break}else y=-1;return y|0}else y=2,T=1,O=1;else y=2,T=1,O=0;else y=1,T=1,O=2;else y=1,T=1,O=1;else y=1,T=1,O=0;else y=0,T=1,O=2;else y=0,T=1,O=1;else y=0,T=1,O=0;else y=2,T=0,O=2;else y=2,T=0,O=1;else y=2,T=0,O=0;else y=1,T=0,O=2;else y=1,T=0,O=1;else y=1,T=0,O=0;else y=0,T=0,O=2;else y=0,T=0,O=1;else y=0,T=0,O=0;while(0);return x=w[11152+(x*216|0)+(T*72|0)+(y*24|0)+(O<<3)+4>>2]|0,x|0}function lo(y,x){return y=y|0,x=x|0,(w[7728+(y*28|0)+20>>2]|0)==(x|0)?(x=1,x|0):(x=(w[7728+(y*28|0)+24>>2]|0)==(x|0),x|0)}function op(y,x){return y=y|0,x=x|0,w[880+(y*28|0)+(x<<2)>>2]|0}function sp(y,x){return y=y|0,x=x|0,(w[880+(y*28|0)>>2]|0)==(x|0)?(x=0,x|0):(w[880+(y*28|0)+4>>2]|0)==(x|0)?(x=1,x|0):(w[880+(y*28|0)+8>>2]|0)==(x|0)?(x=2,x|0):(w[880+(y*28|0)+12>>2]|0)==(x|0)?(x=3,x|0):(w[880+(y*28|0)+16>>2]|0)==(x|0)?(x=4,x|0):(w[880+(y*28|0)+20>>2]|0)==(x|0)?(x=5,x|0):((w[880+(y*28|0)+24>>2]|0)==(x|0)?6:7)|0}function da(){return 122}function il(y){y=y|0;var x=0,T=0,O=0;x=0;do Dn(x|0,0,45)|0,O=Ke()|0|134225919,T=y+(x<<3)|0,w[T>>2]=-1,w[T+4>>2]=O,x=x+1|0;while((x|0)!=122)}function EA(y){return y=y|0,+Ue[y+16>>3]<+Ue[y+24>>3]|0}function Wh(y,x){y=y|0,x=x|0;var T=0,O=0,D=0;return T=+Ue[x>>3],!(T>=+Ue[y+8>>3])||!(T<=+Ue[y>>3])?(x=0,x|0):(O=+Ue[y+16>>3],T=+Ue[y+24>>3],D=+Ue[x+8>>3],x=D>=T,y=D<=O&1,O<T?x&&(y=1):x||(y=0),x=(y|0)!=0,x|0)}function Xi(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0;G=Ve,Ve=Ve+288|0,T=G+264|0,O=G+96|0,D=G,j=D,Z=j+96|0;do w[j>>2]=0,j=j+4|0;while((j|0)<(Z|0));return Ap(x,D),j=D,Z=w[j>>2]|0,j=w[j+4>>2]|0,du(Z,j,T),jl(Z,j,O),ae=+Uc(T,O+8|0),Ue[T>>3]=+Ue[y>>3],j=T+8|0,Ue[j>>3]=+Ue[y+16>>3],Ue[O>>3]=+Ue[y+8>>3],Z=O+8|0,Ue[Z>>3]=+Ue[y+24>>3],pe=+Uc(T,O),Z=~~+Vo(+(pe*pe/+Xg(+ +rr(+((+Ue[j>>3]-+Ue[Z>>3])/(+Ue[T>>3]-+Ue[O>>3]))),3)/(ae*(ae*2.59807621135)*.8))),Ve=G,(Z|0?Z:1)|0}function ap(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0;Z=Ve,Ve=Ve+288|0,O=Z+264|0,D=Z+96|0,j=Z,G=j,ae=G+96|0;do w[G>>2]=0,G=G+4|0;while((G|0)<(ae|0));return Ap(T,j),ae=j,G=w[ae>>2]|0,ae=w[ae+4>>2]|0,du(G,ae,O),jl(G,ae,D),pe=+Uc(O,D+8|0),ae=~~+Vo(+(+Uc(y,x)/(pe*2))),Ve=Z,(ae|0?ae:1)|0}function SA(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0,w[y>>2]=x,w[y+4>>2]=T,w[y+8>>2]=O}function Ff(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0;Xe=x+8|0,w[Xe>>2]=0,ae=+Ue[y>>3],G=+rr(+ae),pe=+Ue[y+8>>3],Z=+rr(+pe)/.8660254037844386,G=G+Z*.5,T=~~G,y=~~Z,G=G-+(T|0),Z=Z-+(y|0);do if(G<.5)if(G<.3333333333333333)if(w[x>>2]=T,Z<(G+1)*.5){w[x+4>>2]=y;break}else{y=y+1|0,w[x+4>>2]=y;break}else if(nt=1-G,y=(!(Z<nt)&1)+y|0,w[x+4>>2]=y,nt<=Z&Z<G*2){T=T+1|0,w[x>>2]=T;break}else{w[x>>2]=T;break}else{if(!(G<.6666666666666666))if(T=T+1|0,w[x>>2]=T,Z<G*.5){w[x+4>>2]=y;break}else{y=y+1|0,w[x+4>>2]=y;break}if(Z<1-G){if(w[x+4>>2]=y,G*2+-1<Z){w[x>>2]=T;break}}else y=y+1|0,w[x+4>>2]=y;T=T+1|0,w[x>>2]=T}while(0);do if(ae<0)if(y&1){_e=(y+1|0)/2|0,_e=$c(T|0,((T|0)<0)<<31>>31|0,_e|0,((_e|0)<0)<<31>>31|0)|0,T=~~(+(T|0)-((+(_e>>>0)+4294967296*+(Ke()|0))*2+1)),w[x>>2]=T;break}else{_e=(y|0)/2|0,_e=$c(T|0,((T|0)<0)<<31>>31|0,_e|0,((_e|0)<0)<<31>>31|0)|0,T=~~(+(T|0)-(+(_e>>>0)+4294967296*+(Ke()|0))*2),w[x>>2]=T;break}while(0);_e=x+4|0,pe<0&&(T=T-((y<<1|1|0)/2|0)|0,w[x>>2]=T,y=0-y|0,w[_e>>2]=y),O=y-T|0,(T|0)<0?(D=0-T|0,w[_e>>2]=O,w[Xe>>2]=D,w[x>>2]=0,y=O,T=0):D=0,(y|0)<0&&(T=T-y|0,w[x>>2]=T,D=D-y|0,w[Xe>>2]=D,w[_e>>2]=0,y=0),j=T-D|0,O=y-D|0,(D|0)<0&&(w[x>>2]=j,w[_e>>2]=O,w[Xe>>2]=0,y=O,T=j,D=0),O=(y|0)<(T|0)?y:T,O=(D|0)<(O|0)?D:O,!((O|0)<=0)&&(w[x>>2]=T-O,w[_e>>2]=y-O,w[Xe>>2]=D-O)}function li(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0;x=w[y>>2]|0,G=y+4|0,T=w[G>>2]|0,(x|0)<0&&(T=T-x|0,w[G>>2]=T,j=y+8|0,w[j>>2]=(w[j>>2]|0)-x,w[y>>2]=0,x=0),(T|0)<0?(x=x-T|0,w[y>>2]=x,j=y+8|0,D=(w[j>>2]|0)-T|0,w[j>>2]=D,w[G>>2]=0,T=0):(D=y+8|0,j=D,D=w[D>>2]|0),(D|0)<0&&(x=x-D|0,w[y>>2]=x,T=T-D|0,w[G>>2]=T,w[j>>2]=0,D=0),O=(T|0)<(x|0)?T:x,O=(D|0)<(O|0)?D:O,!((O|0)<=0)&&(w[y>>2]=x-O,w[G>>2]=T-O,w[j>>2]=D-O)}function qu(y,x){y=y|0,x=x|0;var T=0,O=0;O=w[y+8>>2]|0,T=+((w[y+4>>2]|0)-O|0),Ue[x>>3]=+((w[y>>2]|0)-O|0)-T*.5,Ue[x+8>>3]=T*.8660254037844386}function xs(y,x,T){y=y|0,x=x|0,T=T|0,w[T>>2]=(w[x>>2]|0)+(w[y>>2]|0),w[T+4>>2]=(w[x+4>>2]|0)+(w[y+4>>2]|0),w[T+8>>2]=(w[x+8>>2]|0)+(w[y+8>>2]|0)}function Ul(y,x,T){y=y|0,x=x|0,T=T|0,w[T>>2]=(w[y>>2]|0)-(w[x>>2]|0),w[T+4>>2]=(w[y+4>>2]|0)-(w[x+4>>2]|0),w[T+8>>2]=(w[y+8>>2]|0)-(w[x+8>>2]|0)}function Xu(y,x){y=y|0,x=x|0;var T=0,O=0;T=Bo(w[y>>2]|0,x)|0,w[y>>2]=T,T=y+4|0,O=Bo(w[T>>2]|0,x)|0,w[T>>2]=O,y=y+8|0,x=Bo(w[y>>2]|0,x)|0,w[y>>2]=x}function kf(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0;G=w[y>>2]|0,Z=(G|0)<0,O=(w[y+4>>2]|0)-(Z?G:0)|0,j=(O|0)<0,D=(j?0-O|0:0)+((w[y+8>>2]|0)-(Z?G:0))|0,T=(D|0)<0,y=T?0:D,x=(j?0:O)-(T?D:0)|0,D=(Z?0:G)-(j?O:0)-(T?D:0)|0,T=(x|0)<(D|0)?x:D,T=(y|0)<(T|0)?y:T,O=(T|0)>0,y=y-(O?T:0)|0,x=x-(O?T:0)|0;e:do switch(D-(O?T:0)|0){case 0:switch(x|0){case 0:return Z=y|0?(y|0)==1?1:7:0,Z|0;case 1:return Z=y|0?(y|0)==1?3:7:2,Z|0;default:break e}case 1:switch(x|0){case 0:return Z=y|0?(y|0)==1?5:7:4,Z|0;case 1:{if(!y)y=6;else break e;return y|0}default:break e}}while(0);return Z=7,Z|0}function T_(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0;G=y+8|0,T=w[G>>2]|0,x=(w[y>>2]|0)-T|0,Z=y+4|0,T=(w[Z>>2]|0)-T|0,O=Vc(+((x*3|0)-T|0)/7)|0,w[y>>2]=O,x=Vc(+((T<<1)+x|0)/7)|0,w[Z>>2]=x,w[G>>2]=0,T=x-O|0,(O|0)<0?(j=0-O|0,w[Z>>2]=T,w[G>>2]=j,w[y>>2]=0,x=T,O=0,T=j):T=0,(x|0)<0&&(O=O-x|0,w[y>>2]=O,T=T-x|0,w[G>>2]=T,w[Z>>2]=0,x=0),j=O-T|0,D=x-T|0,(T|0)<0?(w[y>>2]=j,w[Z>>2]=D,w[G>>2]=0,x=D,D=j,T=0):D=O,O=(x|0)<(D|0)?x:D,O=(T|0)<(O|0)?T:O,!((O|0)<=0)&&(w[y>>2]=D-O,w[Z>>2]=x-O,w[G>>2]=T-O)}function lp(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0;G=y+8|0,T=w[G>>2]|0,x=(w[y>>2]|0)-T|0,Z=y+4|0,T=(w[Z>>2]|0)-T|0,O=Vc(+((x<<1)+T|0)/7)|0,w[y>>2]=O,x=Vc(+((T*3|0)-x|0)/7)|0,w[Z>>2]=x,w[G>>2]=0,T=x-O|0,(O|0)<0?(j=0-O|0,w[Z>>2]=T,w[G>>2]=j,w[y>>2]=0,x=T,O=0,T=j):T=0,(x|0)<0&&(O=O-x|0,w[y>>2]=O,T=T-x|0,w[G>>2]=T,w[Z>>2]=0,x=0),j=O-T|0,D=x-T|0,(T|0)<0?(w[y>>2]=j,w[Z>>2]=D,w[G>>2]=0,x=D,D=j,T=0):D=O,O=(x|0)<(D|0)?x:D,O=(T|0)<(O|0)?T:O,!((O|0)<=0)&&(w[y>>2]=D-O,w[Z>>2]=x-O,w[G>>2]=T-O)}function Zu(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0;x=w[y>>2]|0,G=y+4|0,T=w[G>>2]|0,Z=y+8|0,O=w[Z>>2]|0,D=T+(x*3|0)|0,w[y>>2]=D,T=O+(T*3|0)|0,w[G>>2]=T,x=(O*3|0)+x|0,w[Z>>2]=x,O=T-D|0,(D|0)<0?(x=x-D|0,w[G>>2]=O,w[Z>>2]=x,w[y>>2]=0,T=O,O=0):O=D,(T|0)<0&&(O=O-T|0,w[y>>2]=O,x=x-T|0,w[Z>>2]=x,w[G>>2]=0,T=0),j=O-x|0,D=T-x|0,(x|0)<0?(w[y>>2]=j,w[G>>2]=D,w[Z>>2]=0,O=j,x=0):D=T,T=(D|0)<(O|0)?D:O,T=(x|0)<(T|0)?x:T,!((T|0)<=0)&&(w[y>>2]=O-T,w[G>>2]=D-T,w[Z>>2]=x-T)}function Ds(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0;D=w[y>>2]|0,G=y+4|0,x=w[G>>2]|0,Z=y+8|0,T=w[Z>>2]|0,O=(x*3|0)+D|0,D=T+(D*3|0)|0,w[y>>2]=D,w[G>>2]=O,x=(T*3|0)+x|0,w[Z>>2]=x,T=O-D|0,(D|0)<0?(x=x-D|0,w[G>>2]=T,w[Z>>2]=x,w[y>>2]=0,D=0):T=O,(T|0)<0&&(D=D-T|0,w[y>>2]=D,x=x-T|0,w[Z>>2]=x,w[G>>2]=0,T=0),j=D-x|0,O=T-x|0,(x|0)<0?(w[y>>2]=j,w[G>>2]=O,w[Z>>2]=0,D=j,x=0):O=T,T=(O|0)<(D|0)?O:D,T=(x|0)<(T|0)?x:T,!((T|0)<=0)&&(w[y>>2]=D-T,w[G>>2]=O-T,w[Z>>2]=x-T)}function Mg(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0;(x+-1|0)>>>0>=6||(D=(w[15472+(x*12|0)>>2]|0)+(w[y>>2]|0)|0,w[y>>2]=D,Z=y+4|0,O=(w[15472+(x*12|0)+4>>2]|0)+(w[Z>>2]|0)|0,w[Z>>2]=O,G=y+8|0,x=(w[15472+(x*12|0)+8>>2]|0)+(w[G>>2]|0)|0,w[G>>2]=x,T=O-D|0,(D|0)<0?(x=x-D|0,w[Z>>2]=T,w[G>>2]=x,w[y>>2]=0,O=0):(T=O,O=D),(T|0)<0&&(O=O-T|0,w[y>>2]=O,x=x-T|0,w[G>>2]=x,w[Z>>2]=0,T=0),j=O-x|0,D=T-x|0,(x|0)<0?(w[y>>2]=j,w[Z>>2]=D,w[G>>2]=0,O=j,x=0):D=T,T=(D|0)<(O|0)?D:O,T=(x|0)<(T|0)?x:T,!((T|0)<=0)&&(w[y>>2]=O-T,w[Z>>2]=D-T,w[G>>2]=x-T))}function zc(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0;D=w[y>>2]|0,G=y+4|0,x=w[G>>2]|0,Z=y+8|0,T=w[Z>>2]|0,O=x+D|0,D=T+D|0,w[y>>2]=D,w[G>>2]=O,x=T+x|0,w[Z>>2]=x,T=O-D|0,(D|0)<0?(x=x-D|0,w[G>>2]=T,w[Z>>2]=x,w[y>>2]=0,O=0):(T=O,O=D),(T|0)<0&&(O=O-T|0,w[y>>2]=O,x=x-T|0,w[Z>>2]=x,w[G>>2]=0,T=0),j=O-x|0,D=T-x|0,(x|0)<0?(w[y>>2]=j,w[G>>2]=D,w[Z>>2]=0,O=j,x=0):D=T,T=(D|0)<(O|0)?D:O,T=(x|0)<(T|0)?x:T,!((T|0)<=0)&&(w[y>>2]=O-T,w[G>>2]=D-T,w[Z>>2]=x-T)}function ol(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0;x=w[y>>2]|0,G=y+4|0,O=w[G>>2]|0,Z=y+8|0,T=w[Z>>2]|0,D=O+x|0,w[y>>2]=D,O=T+O|0,w[G>>2]=O,x=T+x|0,w[Z>>2]=x,T=O-D|0,(D|0)<0?(x=x-D|0,w[G>>2]=T,w[Z>>2]=x,w[y>>2]=0,O=0):(T=O,O=D),(T|0)<0&&(O=O-T|0,w[y>>2]=O,x=x-T|0,w[Z>>2]=x,w[G>>2]=0,T=0),j=O-x|0,D=T-x|0,(x|0)<0?(w[y>>2]=j,w[G>>2]=D,w[Z>>2]=0,O=j,x=0):D=T,T=(D|0)<(O|0)?D:O,T=(x|0)<(T|0)?x:T,!((T|0)<=0)&&(w[y>>2]=O-T,w[G>>2]=D-T,w[Z>>2]=x-T)}function Gl(y){switch(y=y|0,y|0){case 1:{y=5;break}case 5:{y=4;break}case 4:{y=6;break}case 6:{y=2;break}case 2:{y=3;break}case 3:{y=1;break}}return y|0}function Bs(y){switch(y=y|0,y|0){case 1:{y=3;break}case 3:{y=2;break}case 2:{y=6;break}case 6:{y=4;break}case 4:{y=5;break}case 5:{y=1;break}}return y|0}function up(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0;x=w[y>>2]|0,G=y+4|0,T=w[G>>2]|0,Z=y+8|0,O=w[Z>>2]|0,D=T+(x<<1)|0,w[y>>2]=D,T=O+(T<<1)|0,w[G>>2]=T,x=(O<<1)+x|0,w[Z>>2]=x,O=T-D|0,(D|0)<0?(x=x-D|0,w[G>>2]=O,w[Z>>2]=x,w[y>>2]=0,T=O,O=0):O=D,(T|0)<0&&(O=O-T|0,w[y>>2]=O,x=x-T|0,w[Z>>2]=x,w[G>>2]=0,T=0),j=O-x|0,D=T-x|0,(x|0)<0?(w[y>>2]=j,w[G>>2]=D,w[Z>>2]=0,O=j,x=0):D=T,T=(D|0)<(O|0)?D:O,T=(x|0)<(T|0)?x:T,!((T|0)<=0)&&(w[y>>2]=O-T,w[G>>2]=D-T,w[Z>>2]=x-T)}function zf(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0;D=w[y>>2]|0,G=y+4|0,x=w[G>>2]|0,Z=y+8|0,T=w[Z>>2]|0,O=(x<<1)+D|0,D=T+(D<<1)|0,w[y>>2]=D,w[G>>2]=O,x=(T<<1)+x|0,w[Z>>2]=x,T=O-D|0,(D|0)<0?(x=x-D|0,w[G>>2]=T,w[Z>>2]=x,w[y>>2]=0,D=0):T=O,(T|0)<0&&(D=D-T|0,w[y>>2]=D,x=x-T|0,w[Z>>2]=x,w[G>>2]=0,T=0),j=D-x|0,O=T-x|0,(x|0)<0?(w[y>>2]=j,w[G>>2]=O,w[Z>>2]=0,D=j,x=0):O=T,T=(O|0)<(D|0)?O:D,T=(x|0)<(T|0)?x:T,!((T|0)<=0)&&(w[y>>2]=D-T,w[G>>2]=O-T,w[Z>>2]=x-T)}function Uf(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0;return G=(w[y>>2]|0)-(w[x>>2]|0)|0,Z=(G|0)<0,O=(w[y+4>>2]|0)-(w[x+4>>2]|0)-(Z?G:0)|0,j=(O|0)<0,D=(Z?0-G|0:0)+(w[y+8>>2]|0)-(w[x+8>>2]|0)+(j?0-O|0:0)|0,y=(D|0)<0,x=y?0:D,T=(j?0:O)-(y?D:0)|0,D=(Z?0:G)-(j?O:0)-(y?D:0)|0,y=(T|0)<(D|0)?T:D,y=(x|0)<(y|0)?x:y,O=(y|0)>0,x=x-(O?y:0)|0,T=T-(O?y:0)|0,y=D-(O?y:0)|0,y=(y|0)>-1?y:0-y|0,T=(T|0)>-1?T:0-T|0,x=(x|0)>-1?x:0-x|0,x=(T|0)>(x|0)?T:x,((y|0)>(x|0)?y:x)|0}function C_(y,x){y=y|0,x=x|0;var T=0;T=w[y+8>>2]|0,w[x>>2]=(w[y>>2]|0)-T,w[x+4>>2]=(w[y+4>>2]|0)-T}function Og(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0;O=w[y>>2]|0,w[x>>2]=O,y=w[y+4>>2]|0,G=x+4|0,w[G>>2]=y,Z=x+8|0,w[Z>>2]=0,T=y-O|0,(O|0)<0?(y=0-O|0,w[G>>2]=T,w[Z>>2]=y,w[x>>2]=0,O=0):(T=y,y=0),(T|0)<0&&(O=O-T|0,w[x>>2]=O,y=y-T|0,w[Z>>2]=y,w[G>>2]=0,T=0),j=O-y|0,D=T-y|0,(y|0)<0?(w[x>>2]=j,w[G>>2]=D,w[Z>>2]=0,T=D,D=j,y=0):D=O,O=(T|0)<(D|0)?T:D,O=(y|0)<(O|0)?y:O,!((O|0)<=0)&&(w[x>>2]=D-O,w[G>>2]=T-O,w[Z>>2]=y-O)}function Rg(y){y=y|0;var x=0,T=0,O=0,D=0;x=y+8|0,D=w[x>>2]|0,T=D-(w[y>>2]|0)|0,w[y>>2]=T,O=y+4|0,y=(w[O>>2]|0)-D|0,w[O>>2]=y,w[x>>2]=0-(y+T)}function TA(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0;T=w[y>>2]|0,x=0-T|0,w[y>>2]=x,G=y+8|0,w[G>>2]=0,Z=y+4|0,O=w[Z>>2]|0,D=O+T|0,(T|0)>0?(w[Z>>2]=D,w[G>>2]=T,w[y>>2]=0,x=0,O=D):T=0,(O|0)<0?(j=x-O|0,w[y>>2]=j,T=T-O|0,w[G>>2]=T,w[Z>>2]=0,D=j-T|0,x=0-T|0,(T|0)<0?(w[y>>2]=D,w[Z>>2]=x,w[G>>2]=0,O=x,T=0):(O=0,D=j)):D=x,x=(O|0)<(D|0)?O:D,x=(T|0)<(x|0)?T:x,!((x|0)<=0)&&(w[y>>2]=D-x,w[Z>>2]=O-x,w[G>>2]=T-x)}function qh(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0;O=Ve,Ve=Ve+16|0,D=O,Kr(y,x,T,D),Ff(D,T+4|0),Ve=O}function Kr(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0;var D=0,j=0,G=0,Z=0,ae=0;if(ae=Ve,Ve=Ve+32|0,j=ae,Qh(y,j),w[T>>2]=0,D=+Zi(15888,j),G=+Zi(15912,j),G<D&&(w[T>>2]=1,D=G),G=+Zi(15936,j),G<D&&(w[T>>2]=2,D=G),G=+Zi(15960,j),G<D&&(w[T>>2]=3,D=G),G=+Zi(15984,j),G<D&&(w[T>>2]=4,D=G),G=+Zi(16008,j),G<D&&(w[T>>2]=5,D=G),G=+Zi(16032,j),G<D&&(w[T>>2]=6,D=G),G=+Zi(16056,j),G<D&&(w[T>>2]=7,D=G),G=+Zi(16080,j),G<D&&(w[T>>2]=8,D=G),G=+Zi(16104,j),G<D&&(w[T>>2]=9,D=G),G=+Zi(16128,j),G<D&&(w[T>>2]=10,D=G),G=+Zi(16152,j),G<D&&(w[T>>2]=11,D=G),G=+Zi(16176,j),G<D&&(w[T>>2]=12,D=G),G=+Zi(16200,j),G<D&&(w[T>>2]=13,D=G),G=+Zi(16224,j),G<D&&(w[T>>2]=14,D=G),G=+Zi(16248,j),G<D&&(w[T>>2]=15,D=G),G=+Zi(16272,j),G<D&&(w[T>>2]=16,D=G),G=+Zi(16296,j),G<D&&(w[T>>2]=17,D=G),G=+Zi(16320,j),G<D&&(w[T>>2]=18,D=G),G=+Zi(16344,j),G<D&&(w[T>>2]=19,D=G),G=+ca(+(1-D*.5)),G<1e-16){w[O>>2]=0,w[O+4>>2]=0,w[O+8>>2]=0,w[O+12>>2]=0,Ve=ae;return}if(T=w[T>>2]|0,D=+Ue[16368+(T*24|0)>>3],D=+fu(D-+fu(+hp(15568+(T<<4)|0,y))),Ua(x)|0?Z=+fu(D+-.3334731722518321):Z=D,D=+ro(+G)/.381966011250105,(x|0)>0){j=0;do D=D*2.6457513110645907,j=j+1|0;while((j|0)!=(x|0))}G=+qr(+Z)*D,Ue[O>>3]=G,Z=+jn(+Z)*D,Ue[O+8>>3]=Z,Ve=ae}function cp(y,x,T,O,D){y=y|0,x=x|0,T=T|0,O=O|0,D=D|0;var j=0,G=0;if(j=+Qu(y),j<1e-16){x=15568+(x<<4)|0,w[D>>2]=w[x>>2],w[D+4>>2]=w[x+4>>2],w[D+8>>2]=w[x+8>>2],w[D+12>>2]=w[x+12>>2];return}if(G=+Qr(+ +Ue[y+8>>3],+ +Ue[y>>3]),(T|0)>0){y=0;do j=j/2.6457513110645907,y=y+1|0;while((y|0)!=(T|0))}O?(j=j/3,T=(Ua(T)|0)==0,j=+zl(+((T?j:j/2.6457513110645907)*.381966011250105))):(j=+zl(+(j*.381966011250105)),Ua(T)|0&&(G=+fu(G+.3334731722518321))),MA(15568+(x<<4)|0,+fu(+Ue[16368+(x*24|0)>>3]-G),j,D)}function CA(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0;O=Ve,Ve=Ve+16|0,D=O,qu(y+4|0,D),cp(D,w[y>>2]|0,x,0,T),Ve=O}function PA(y,x,T,O,D){y=y|0,x=x|0,T=T|0,O=O|0,D=D|0;var j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0,Vt=0,yn=0,Cn=0,Rt=0,fn=0,ot=0,On=0,Bn=0,Pn=0,Mt=0,br=0,ui=0,Vr=0,Jr=0,qt=0,xi=0,$i=0,gr=0;if(xi=Ve,Ve=Ve+272|0,j=xi+256|0,Rt=xi+240|0,Vr=xi,Jr=xi+224|0,qt=xi+208|0,fn=xi+176|0,ot=xi+160|0,On=xi+192|0,Bn=xi+144|0,Pn=xi+128|0,Mt=xi+112|0,br=xi+96|0,ui=xi+80|0,w[j>>2]=x,w[Rt>>2]=w[y>>2],w[Rt+4>>2]=w[y+4>>2],w[Rt+8>>2]=w[y+8>>2],w[Rt+12>>2]=w[y+12>>2],Lg(Rt,j,Vr),w[D>>2]=0,Rt=O+T+((O|0)==5&1)|0,(Rt|0)<=(T|0)){Ve=xi;return}ae=w[j>>2]|0,pe=Jr+4|0,_e=fn+4|0,Xe=T+5|0,nt=16848+(ae<<2)|0,mt=16928+(ae<<2)|0,kt=Pn+8|0,Vt=Mt+8|0,yn=br+8|0,Cn=qt+4|0,Z=T;e:for(;;){G=Vr+(((Z|0)%5|0)<<4)|0,w[qt>>2]=w[G>>2],w[qt+4>>2]=w[G+4>>2],w[qt+8>>2]=w[G+8>>2],w[qt+12>>2]=w[G+12>>2];do;while((Gf(qt,ae,0,1)|0)==2);if((Z|0)>(T|0)&(Ua(x)|0)!=0){if(w[fn>>2]=w[qt>>2],w[fn+4>>2]=w[qt+4>>2],w[fn+8>>2]=w[qt+8>>2],w[fn+12>>2]=w[qt+12>>2],qu(pe,ot),O=w[fn>>2]|0,j=w[17008+(O*80|0)+(w[Jr>>2]<<2)>>2]|0,w[fn>>2]=w[18608+(O*80|0)+(j*20|0)>>2],G=w[18608+(O*80|0)+(j*20|0)+16>>2]|0,(G|0)>0){y=0;do zc(_e),y=y+1|0;while((y|0)<(G|0))}switch(G=18608+(O*80|0)+(j*20|0)+4|0,w[On>>2]=w[G>>2],w[On+4>>2]=w[G+4>>2],w[On+8>>2]=w[G+8>>2],Xu(On,(w[nt>>2]|0)*3|0),xs(_e,On,_e),li(_e),qu(_e,Bn),$i=+(w[mt>>2]|0),Ue[Pn>>3]=$i*3,Ue[kt>>3]=0,gr=$i*-1.5,Ue[Mt>>3]=gr,Ue[Vt>>3]=$i*2.598076211353316,Ue[br>>3]=gr,Ue[yn>>3]=$i*-2.598076211353316,w[17008+((w[fn>>2]|0)*80|0)+(w[qt>>2]<<2)>>2]|0){case 1:{y=Mt,O=Pn;break}case 3:{y=br,O=Mt;break}case 2:{y=Pn,O=br;break}default:{y=12;break e}}GA(ot,Bn,O,y,ui),cp(ui,w[fn>>2]|0,ae,1,D+8+(w[D>>2]<<4)|0),w[D>>2]=(w[D>>2]|0)+1}if((Z|0)<(Xe|0)&&(qu(Cn,fn),cp(fn,w[qt>>2]|0,ae,1,D+8+(w[D>>2]<<4)|0),w[D>>2]=(w[D>>2]|0)+1),w[Jr>>2]=w[qt>>2],w[Jr+4>>2]=w[qt+4>>2],w[Jr+8>>2]=w[qt+8>>2],w[Jr+12>>2]=w[qt+12>>2],Z=Z+1|0,(Z|0)>=(Rt|0)){y=3;break}}if((y|0)==3){Ve=xi;return}else(y|0)==12&&gt(22474,22521,581,22531)}function Lg(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0,ae=0;ae=Ve,Ve=Ve+128|0,O=ae+64|0,D=ae,j=O,G=20208,Z=j+60|0;do w[j>>2]=w[G>>2],j=j+4|0,G=G+4|0;while((j|0)<(Z|0));j=D,G=20272,Z=j+60|0;do w[j>>2]=w[G>>2],j=j+4|0,G=G+4|0;while((j|0)<(Z|0));Z=(Ua(w[x>>2]|0)|0)==0,O=Z?O:D,D=y+4|0,up(D),zf(D),Ua(w[x>>2]|0)|0&&(Ds(D),w[x>>2]=(w[x>>2]|0)+1),w[T>>2]=w[y>>2],x=T+4|0,xs(D,O,x),li(x),w[T+16>>2]=w[y>>2],x=T+20|0,xs(D,O+12|0,x),li(x),w[T+32>>2]=w[y>>2],x=T+36|0,xs(D,O+24|0,x),li(x),w[T+48>>2]=w[y>>2],x=T+52|0,xs(D,O+36|0,x),li(x),w[T+64>>2]=w[y>>2],T=T+68|0,xs(D,O+48|0,T),li(T),Ve=ae}function Gf(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0;var D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0;if(kt=Ve,Ve=Ve+32|0,nt=kt+12|0,Z=kt,mt=y+4|0,Xe=w[16928+(x<<2)>>2]|0,_e=(O|0)!=0,Xe=_e?Xe*3|0:Xe,D=w[mt>>2]|0,pe=y+8|0,G=w[pe>>2]|0,_e){if(j=y+12|0,O=w[j>>2]|0,D=G+D+O|0,(D|0)==(Xe|0))return mt=1,Ve=kt,mt|0;ae=j}else ae=y+12|0,O=w[ae>>2]|0,D=G+D+O|0;if((D|0)<=(Xe|0))return mt=0,Ve=kt,mt|0;do if((O|0)>0){if(O=w[y>>2]|0,(G|0)>0){j=18608+(O*80|0)+60|0,O=y;break}O=18608+(O*80|0)+40|0,T?(SA(nt,Xe,0,0),Ul(mt,nt,Z),ol(Z),xs(Z,nt,mt),j=O,O=y):(j=O,O=y)}else j=18608+((w[y>>2]|0)*80|0)+20|0,O=y;while(0);if(w[O>>2]=w[j>>2],D=j+16|0,(w[D>>2]|0)>0){O=0;do zc(mt),O=O+1|0;while((O|0)<(w[D>>2]|0))}return y=j+4|0,w[nt>>2]=w[y>>2],w[nt+4>>2]=w[y+4>>2],w[nt+8>>2]=w[y+8>>2],x=w[16848+(x<<2)>>2]|0,Xu(nt,_e?x*3|0:x),xs(mt,nt,mt),li(mt),_e?O=((w[pe>>2]|0)+(w[mt>>2]|0)+(w[ae>>2]|0)|0)==(Xe|0)?1:2:O=2,mt=O,Ve=kt,mt|0}function IA(y,x){y=y|0,x=x|0;var T=0;do T=Gf(y,x,0,1)|0;while((T|0)==2);return T|0}function jf(y,x,T,O,D){y=y|0,x=x|0,T=T|0,O=O|0,D=D|0;var j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0,Vt=0,yn=0,Cn=0,Rt=0,fn=0,ot=0,On=0,Bn=0,Pn=0,Mt=0,br=0,ui=0,Vr=0;if(br=Ve,Ve=Ve+240|0,j=br+224|0,On=br+208|0,Bn=br,Pn=br+192|0,Mt=br+176|0,yn=br+160|0,Cn=br+144|0,Rt=br+128|0,fn=br+112|0,ot=br+96|0,w[j>>2]=x,w[On>>2]=w[y>>2],w[On+4>>2]=w[y+4>>2],w[On+8>>2]=w[y+8>>2],w[On+12>>2]=w[y+12>>2],fp(On,j,Bn),w[D>>2]=0,Vt=O+T+((O|0)==6&1)|0,(Vt|0)<=(T|0)){Ve=br;return}ae=w[j>>2]|0,pe=T+6|0,_e=16928+(ae<<2)|0,Xe=Cn+8|0,nt=Rt+8|0,mt=fn+8|0,kt=Pn+4|0,G=0,Z=T,O=-1;e:for(;;){if(j=(Z|0)%6|0,y=Bn+(j<<4)|0,w[Pn>>2]=w[y>>2],w[Pn+4>>2]=w[y+4>>2],w[Pn+8>>2]=w[y+8>>2],w[Pn+12>>2]=w[y+12>>2],y=G,G=Gf(Pn,ae,0,1)|0,(Z|0)>(T|0)&(Ua(x)|0)!=0&&(y|0)!=1&&(w[Pn>>2]|0)!=(O|0)){switch(qu(Bn+(((j+5|0)%6|0)<<4)+4|0,Mt),qu(Bn+(j<<4)+4|0,yn),ui=+(w[_e>>2]|0),Ue[Cn>>3]=ui*3,Ue[Xe>>3]=0,Vr=ui*-1.5,Ue[Rt>>3]=Vr,Ue[nt>>3]=ui*2.598076211353316,Ue[fn>>3]=Vr,Ue[mt>>3]=ui*-2.598076211353316,j=w[On>>2]|0,w[17008+(j*80|0)+(((O|0)==(j|0)?w[Pn>>2]|0:O)<<2)>>2]|0){case 1:{y=Rt,O=Cn;break}case 3:{y=fn,O=Rt;break}case 2:{y=Cn,O=fn;break}default:{y=8;break e}}GA(Mt,yn,O,y,ot),!(wp(Mt,ot)|0)&&!(wp(yn,ot)|0)&&(cp(ot,w[On>>2]|0,ae,1,D+8+(w[D>>2]<<4)|0),w[D>>2]=(w[D>>2]|0)+1)}if((Z|0)<(pe|0)&&(qu(kt,Mt),cp(Mt,w[Pn>>2]|0,ae,1,D+8+(w[D>>2]<<4)|0),w[D>>2]=(w[D>>2]|0)+1),Z=Z+1|0,(Z|0)>=(Vt|0)){y=3;break}else O=w[Pn>>2]|0}if((y|0)==3){Ve=br;return}else(y|0)==8&&gt(22557,22521,746,22602)}function fp(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0,ae=0;ae=Ve,Ve=Ve+160|0,O=ae+80|0,D=ae,j=O,G=20336,Z=j+72|0;do w[j>>2]=w[G>>2],j=j+4|0,G=G+4|0;while((j|0)<(Z|0));j=D,G=20416,Z=j+72|0;do w[j>>2]=w[G>>2],j=j+4|0,G=G+4|0;while((j|0)<(Z|0));Z=(Ua(w[x>>2]|0)|0)==0,O=Z?O:D,D=y+4|0,up(D),zf(D),Ua(w[x>>2]|0)|0&&(Ds(D),w[x>>2]=(w[x>>2]|0)+1),w[T>>2]=w[y>>2],x=T+4|0,xs(D,O,x),li(x),w[T+16>>2]=w[y>>2],x=T+20|0,xs(D,O+12|0,x),li(x),w[T+32>>2]=w[y>>2],x=T+36|0,xs(D,O+24|0,x),li(x),w[T+48>>2]=w[y>>2],x=T+52|0,xs(D,O+36|0,x),li(x),w[T+64>>2]=w[y>>2],x=T+68|0,xs(D,O+48|0,x),li(x),w[T+80>>2]=w[y>>2],T=T+84|0,xs(D,O+60|0,T),li(T),Ve=ae}function fu(y){y=+y;var x=0;return x=y<0?y+6.283185307179586:y,+(y>=6.283185307179586?x+-6.283185307179586:x)}function pa(y,x){return y=y|0,x=x|0,+rr(+(+Ue[y>>3]-+Ue[x>>3]))<17453292519943298e-27?(x=+rr(+(+Ue[y+8>>3]-+Ue[x+8>>3]))<17453292519943298e-27,x|0):(x=0,x|0)}function Vf(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0;return D=+Ue[x>>3],O=+Ue[y>>3],j=+jn(+((D-O)*.5)),T=+jn(+((+Ue[x+8>>3]-+Ue[y+8>>3])*.5)),T=j*j+T*(+qr(+D)*+qr(+O)*T),+(+Qr(+ +Tr(+T),+ +Tr(+(1-T)))*2)}function Uc(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0;return D=+Ue[x>>3],O=+Ue[y>>3],j=+jn(+((D-O)*.5)),T=+jn(+((+Ue[x+8>>3]-+Ue[y+8>>3])*.5)),T=j*j+T*(+qr(+D)*+qr(+O)*T),+(+Qr(+ +Tr(+T),+ +Tr(+(1-T)))*2*6371.007180918475)}function P_(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0;return D=+Ue[x>>3],O=+Ue[y>>3],j=+jn(+((D-O)*.5)),T=+jn(+((+Ue[x+8>>3]-+Ue[y+8>>3])*.5)),T=j*j+T*(+qr(+D)*+qr(+O)*T),+(+Qr(+ +Tr(+T),+ +Tr(+(1-T)))*2*6371.007180918475*1e3)}function hp(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0;return j=+Ue[x>>3],O=+qr(+j),D=+Ue[x+8>>3]-+Ue[y+8>>3],G=O*+jn(+D),T=+Ue[y>>3],+ +Qr(+G,+(+jn(+j)*+qr(+T)-+qr(+D)*(O*+jn(+T))))}function MA(y,x,T,O){y=y|0,x=+x,T=+T,O=O|0;var D=0,j=0,G=0,Z=0;if(T<1e-16){w[O>>2]=w[y>>2],w[O+4>>2]=w[y+4>>2],w[O+8>>2]=w[y+8>>2],w[O+12>>2]=w[y+12>>2];return}j=x<0?x+6.283185307179586:x,j=x>=6.283185307179586?j+-6.283185307179586:j;do if(j<1e-16)x=+Ue[y>>3]+T,Ue[O>>3]=x,D=O;else{if(D=+rr(+(j+-3.141592653589793))<1e-16,x=+Ue[y>>3],D){x=x-T,Ue[O>>3]=x,D=O;break}if(G=+qr(+T),T=+jn(+T),x=G*+jn(+x)+ +qr(+j)*(T*+qr(+x)),x=x>1?1:x,x=+kc(+(x<-1?-1:x)),Ue[O>>3]=x,+rr(+(x+-1.5707963267948966))<1e-16){Ue[O>>3]=1.5707963267948966,Ue[O+8>>3]=0;return}if(+rr(+(x+1.5707963267948966))<1e-16){Ue[O>>3]=-1.5707963267948966,Ue[O+8>>3]=0;return}if(Z=+qr(+x),j=T*+jn(+j)/Z,T=+Ue[y>>3],x=(G-+jn(+x)*+jn(+T))/+qr(+T)/Z,G=j>1?1:j,x=x>1?1:x,x=+Ue[y+8>>3]+ +Qr(+(G<-1?-1:G),+(x<-1?-1:x)),x>3.141592653589793)do x=x+-6.283185307179586;while(x>3.141592653589793);if(x<-3.141592653589793)do x=x+6.283185307179586;while(x<-3.141592653589793);Ue[O+8>>3]=x;return}while(0);if(+rr(+(x+-1.5707963267948966))<1e-16){Ue[D>>3]=1.5707963267948966,Ue[O+8>>3]=0;return}if(+rr(+(x+1.5707963267948966))<1e-16){Ue[D>>3]=-1.5707963267948966,Ue[O+8>>3]=0;return}if(x=+Ue[y+8>>3],x>3.141592653589793)do x=x+-6.283185307179586;while(x>3.141592653589793);if(x<-3.141592653589793)do x=x+6.283185307179586;while(x<-3.141592653589793);Ue[O+8>>3]=x}function OA(y){return y=y|0,+ +Ue[20496+(y<<3)>>3]}function Dg(y){return y=y|0,+ +Ue[20624+(y<<3)>>3]}function Bg(y){return y=y|0,+ +Ue[20752+(y<<3)>>3]}function RA(y){return y=y|0,+ +Ue[20880+(y<<3)>>3]}function jr(y){y=y|0;var x=0;return x=21008+(y<<3)|0,y=w[x>>2]|0,Hn(w[x+4>>2]|0),y|0}function hu(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0;return nt=+Ue[x>>3],_e=+Ue[y>>3],ae=+jn(+((nt-_e)*.5)),j=+Ue[x+8>>3],pe=+Ue[y+8>>3],G=+jn(+((j-pe)*.5)),Z=+qr(+_e),Xe=+qr(+nt),G=ae*ae+G*(Xe*Z*G),G=+Qr(+ +Tr(+G),+ +Tr(+(1-G)))*2,ae=+Ue[T>>3],nt=+jn(+((ae-nt)*.5)),O=+Ue[T+8>>3],j=+jn(+((O-j)*.5)),D=+qr(+ae),j=nt*nt+j*(Xe*D*j),j=+Qr(+ +Tr(+j),+ +Tr(+(1-j)))*2,ae=+jn(+((_e-ae)*.5)),O=+jn(+((pe-O)*.5)),O=ae*ae+O*(Z*D*O),O=+Qr(+ +Tr(+O),+ +Tr(+(1-O)))*2,D=(G+j+O)*.5,+(+zl(+ +Tr(+(+ro(+(D*.5))*+ro(+((D-G)*.5))*+ro(+((D-j)*.5))*+ro(+((D-O)*.5)))))*4)}function I_(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0;if(j=Ve,Ve=Ve+192|0,O=j+168|0,D=j,du(y,x,O),jl(y,x,D),x=w[D>>2]|0,(x|0)<=0)return T=0,Ve=j,+T;if(T=+hu(D+8|0,D+8+(((x|0)!=1&1)<<4)|0,O)+0,(x|0)==1)return Ve=j,+T;y=1;do G=y,y=y+1|0,T=T+ +hu(D+8+(G<<4)|0,D+8+(((y|0)%(x|0)|0)<<4)|0,O);while((y|0)<(x|0));return Ve=j,+T}function LA(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0;if(j=Ve,Ve=Ve+192|0,O=j+168|0,D=j,du(y,x,O),jl(y,x,D),x=w[D>>2]|0,(x|0)>0){if(T=+hu(D+8|0,D+8+(((x|0)!=1&1)<<4)|0,O)+0,(x|0)!=1){y=1;do G=y,y=y+1|0,T=T+ +hu(D+8+(G<<4)|0,D+8+(((y|0)%(x|0)|0)<<4)|0,O);while((y|0)<(x|0))}}else T=0;return Ve=j,+(T*6371.007180918475*6371.007180918475)}function M_(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0;if(j=Ve,Ve=Ve+192|0,O=j+168|0,D=j,du(y,x,O),jl(y,x,D),x=w[D>>2]|0,(x|0)>0){if(T=+hu(D+8|0,D+8+(((x|0)!=1&1)<<4)|0,O)+0,(x|0)!=1){y=1;do G=y,y=y+1|0,T=T+ +hu(D+8+(G<<4)|0,D+8+(((y|0)%(x|0)|0)<<4)|0,O);while((y|0)<(x|0))}}else T=0;return Ve=j,+(T*6371.007180918475*6371.007180918475*1e3*1e3)}function $f(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0;if(G=Ve,Ve=Ve+176|0,j=G,jg(y,x,j),y=w[j>>2]|0,(y|0)<=1)return D=0,Ve=G,+D;x=y+-1|0,y=0,T=0,O=+Ue[j+8>>3],D=+Ue[j+16>>3];do y=y+1|0,ae=O,O=+Ue[j+8+(y<<4)>>3],pe=+jn(+((O-ae)*.5)),Z=D,D=+Ue[j+8+(y<<4)+8>>3],Z=+jn(+((D-Z)*.5)),Z=pe*pe+Z*(+qr(+O)*+qr(+ae)*Z),T=T+ +Qr(+ +Tr(+Z),+ +Tr(+(1-Z)))*2;while((y|0)<(x|0));return Ve=G,+T}function DA(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0;if(G=Ve,Ve=Ve+176|0,j=G,jg(y,x,j),y=w[j>>2]|0,(y|0)<=1)return D=0,Ve=G,+D;x=y+-1|0,y=0,T=0,O=+Ue[j+8>>3],D=+Ue[j+16>>3];do y=y+1|0,ae=O,O=+Ue[j+8+(y<<4)>>3],pe=+jn(+((O-ae)*.5)),Z=D,D=+Ue[j+8+(y<<4)+8>>3],Z=+jn(+((D-Z)*.5)),Z=pe*pe+Z*(+qr(+ae)*+qr(+O)*Z),T=T+ +Qr(+ +Tr(+Z),+ +Tr(+(1-Z)))*2;while((y|0)!=(x|0));return pe=T*6371.007180918475,Ve=G,+pe}function nx(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0;if(G=Ve,Ve=Ve+176|0,j=G,jg(y,x,j),y=w[j>>2]|0,(y|0)<=1)return D=0,Ve=G,+D;x=y+-1|0,y=0,T=0,O=+Ue[j+8>>3],D=+Ue[j+16>>3];do y=y+1|0,ae=O,O=+Ue[j+8+(y<<4)>>3],pe=+jn(+((O-ae)*.5)),Z=D,D=+Ue[j+8+(y<<4)+8>>3],Z=+jn(+((D-Z)*.5)),Z=pe*pe+Z*(+qr(+ae)*+qr(+O)*Z),T=T+ +Qr(+ +Tr(+Z),+ +Tr(+(1-Z)))*2;while((y|0)!=(x|0));return pe=T*6371.007180918475*1e3,Ve=G,+pe}function rx(y,x){return y=y|0,x=x|0,x=An(y|0,x|0,52)|0,Ke()|0,x&15|0}function O_(y,x){return y=y|0,x=x|0,x=An(y|0,x|0,45)|0,Ke()|0,x&127|0}function Ng(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0;if(!(!0&(x&-16777216|0)==134217728)||(G=An(y|0,x|0,45)|0,Ke()|0,G=G&127,G>>>0>121))return x=0,x|0;T=An(y|0,x|0,52)|0,Ke()|0,T=T&15;do if(T|0){for(D=1,O=0;;){if(j=An(y|0,x|0,(15-D|0)*3|0)|0,Ke()|0,j=j&7,(j|0)!=0&(O^1))if((j|0)==1&(Lr(G)|0)!=0){Z=0,O=13;break}else O=1;if((j|0)==7){Z=0,O=13;break}if(D>>>0<T>>>0)D=D+1|0;else{O=9;break}}if((O|0)==9){if((T|0)==15)Z=1;else break;return Z|0}else if((O|0)==13)return Z|0}while(0);for(;;){if(Z=An(y|0,x|0,(14-T|0)*3|0)|0,Ke()|0,!((Z&7|0)==7&!0)){Z=0,O=13;break}if(T>>>0<14)T=T+1|0;else{Z=1,O=13;break}}return(O|0)==13?Z|0:0}function dp(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0;if(O=An(y|0,x|0,52)|0,Ke()|0,O=O&15,(O|0)>=(T|0)){if((O|0)!=(T|0))if(T>>>0<=15){if(D=Dn(T|0,0,52)|0,y=D|y,x=Ke()|0|x&-15728641,(O|0)>(T|0))do D=Dn(7,0,(14-T|0)*3|0)|0,T=T+1|0,y=D|y,x=Ke()|0|x;while((T|0)<(O|0))}else x=0,y=0}else x=0,y=0;return Hn(x|0),y|0}function BA(y,x,T){return y=y|0,x=x|0,T=T|0,y=An(y|0,x|0,52)|0,Ke()|0,y=y&15,(T|0)<16&(y|0)<=(T|0)?(T=xp(7,T-y|0)|0,T|0):(T=0,T|0)}function bs(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0;var D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0;if(G=An(y|0,x|0,52)|0,Ke()|0,G=G&15,!!((T|0)<16&(G|0)<=(T|0))){if((G|0)==(T|0)){T=O,w[T>>2]=y,w[T+4>>2]=x;return}if(ae=xp(7,T-G|0)|0,pe=(ae|0)/7|0,Z=An(y|0,x|0,45)|0,Ke()|0,!(Lr(Z&127)|0))j=0;else{e:do if(!G)D=0;else for(j=1;;){if(D=An(y|0,x|0,(15-j|0)*3|0)|0,Ke()|0,D=D&7,D|0)break e;if(j>>>0<G>>>0)j=j+1|0;else{D=0;break}}while(0);j=(D|0)==0}if(_e=Dn(G+1|0,0,52)|0,D=Ke()|0|x&-15728641,Z=(14-G|0)*3|0,x=Dn(7,0,Z|0)|0,x=(_e|y)&~x,G=D&~(Ke()|0),bs(x,G,T,O),D=O+(pe<<3)|0,!j){_e=Dn(1,0,Z|0)|0,bs(_e|x,Ke()|0|G,T,D),_e=D+(pe<<3)|0,ae=Dn(2,0,Z|0)|0,bs(ae|x,Ke()|0|G,T,_e),_e=_e+(pe<<3)|0,ae=Dn(3,0,Z|0)|0,bs(ae|x,Ke()|0|G,T,_e),_e=_e+(pe<<3)|0,ae=Dn(4,0,Z|0)|0,bs(ae|x,Ke()|0|G,T,_e),_e=_e+(pe<<3)|0,ae=Dn(5,0,Z|0)|0,bs(ae|x,Ke()|0|G,T,_e),ae=Dn(6,0,Z|0)|0,bs(ae|x,Ke()|0|G,T,_e+(pe<<3)|0);return}j=D+(pe<<3)|0,(ae|0)>6&&(ae=D+8|0,_e=(j>>>0>ae>>>0?j:ae)+-1+(0-D)|0,Aa(D|0,0,_e+8&-8|0)|0,D=ae+(_e>>>3<<3)|0),_e=Dn(2,0,Z|0)|0,bs(_e|x,Ke()|0|G,T,D),_e=D+(pe<<3)|0,ae=Dn(3,0,Z|0)|0,bs(ae|x,Ke()|0|G,T,_e),_e=_e+(pe<<3)|0,ae=Dn(4,0,Z|0)|0,bs(ae|x,Ke()|0|G,T,_e),_e=_e+(pe<<3)|0,ae=Dn(5,0,Z|0)|0,bs(ae|x,Ke()|0|G,T,_e),ae=Dn(6,0,Z|0)|0,bs(ae|x,Ke()|0|G,T,_e+(pe<<3)|0)}}function No(y,x){y=y|0,x=x|0;var T=0,O=0,D=0;if(D=An(y|0,x|0,45)|0,Ke()|0,!(Lr(D&127)|0))return D=0,D|0;D=An(y|0,x|0,52)|0,Ke()|0,D=D&15;e:do if(!D)T=0;else for(O=1;;){if(T=An(y|0,x|0,(15-O|0)*3|0)|0,Ke()|0,T=T&7,T|0)break e;if(O>>>0<D>>>0)O=O+1|0;else{T=0;break}}while(0);return D=(T|0)==0&1,D|0}function R_(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0;if(O=An(y|0,x|0,52)|0,Ke()|0,O=O&15,(T|0)<16&(O|0)<=(T|0)){if((O|0)!=(T|0)&&(D=Dn(T|0,0,52)|0,y=D|y,x=Ke()|0|x&-15728641,(O|0)<(T|0)))do D=Dn(7,0,(14-O|0)*3|0)|0,O=O+1|0,y=y&~D,x=x&~(Ke()|0);while((O|0)<(T|0))}else x=0,y=0;return Hn(x|0),y|0}function ix(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0,Vt=0,yn=0,Cn=0,Rt=0,fn=0,ot=0,On=0,Bn=0,Pn=0,Mt=0;if(!T)return Pn=0,Pn|0;if(D=y,O=w[D>>2]|0,D=w[D+4>>2]|0,!0&(D&15728640|0)==0){if((T|0)<=0||(Pn=x,w[Pn>>2]=O,w[Pn+4>>2]=D,(T|0)==1))return Pn=0,Pn|0;O=1;do On=y+(O<<3)|0,Bn=w[On+4>>2]|0,Pn=x+(O<<3)|0,w[Pn>>2]=w[On>>2],w[Pn+4>>2]=Bn,O=O+1|0;while((O|0)!=(T|0));return O=0,O|0}if(On=T<<3,Bn=Ga(On)|0,!Bn)return Pn=-3,Pn|0;if(ed(Bn|0,y|0,On|0)|0,ot=ma(T,8)|0,!ot)return Mr(Bn),Pn=-3,Pn|0;O=T;e:for(;;){G=Bn,_e=w[G>>2]|0,G=w[G+4>>2]|0,Rt=An(_e|0,G|0,52)|0,Ke()|0,Rt=Rt&15,fn=Rt+-1|0,Cn=(O|0)>0;t:do if(Cn){if(yn=((O|0)<0)<<31>>31,kt=Dn(fn|0,0,52)|0,Vt=Ke()|0,fn>>>0>15)for(D=0,y=_e,T=G;;){if(!((y|0)==0&(T|0)==0)){if(j=An(y|0,T|0,52)|0,Ke()|0,j=j&15,Z=(j|0)<(fn|0),j=(j|0)==(fn|0),pe=Z?0:j?y:0,y=Z?0:j?T:0,T=Hc(pe|0,y|0,O|0,yn|0)|0,Ke()|0,j=ot+(T<<3)|0,Z=j,ae=w[Z>>2]|0,Z=w[Z+4>>2]|0,(ae|0)==0&(Z|0)==0)T=pe;else for(kt=0,mt=T,nt=Z,T=pe;;){if((kt|0)>(O|0)){Pn=41;break e}if((ae|0)==(T|0)&(nt&-117440513|0)==(y|0)){pe=An(ae|0,nt|0,56)|0,Ke()|0,pe=pe&7,Xe=pe+1|0,Vt=An(ae|0,nt|0,45)|0,Ke()|0;n:do if(!(Lr(Vt&127)|0))Z=7;else{if(ae=An(ae|0,nt|0,52)|0,Ke()|0,ae=ae&15,!ae){Z=6;break}for(Z=1;;){if(Vt=Dn(7,0,(15-Z|0)*3|0)|0,!((Vt&T|0)==0&((Ke()|0)&y|0)==0)){Z=7;break n}if(Z>>>0<ae>>>0)Z=Z+1|0;else{Z=6;break}}}while(0);if((pe+2|0)>>>0>Z>>>0){Pn=51;break e}Vt=Dn(Xe|0,0,56)|0,y=Ke()|0|y&-117440513,Z=j,w[Z>>2]=0,w[Z+4>>2]=0,Z=mt,T=Vt|T}else Z=(mt+1|0)%(O|0)|0;if(j=ot+(Z<<3)|0,nt=j,ae=w[nt>>2]|0,nt=w[nt+4>>2]|0,(ae|0)==0&(nt|0)==0)break;kt=kt+1|0,mt=Z}Vt=j,w[Vt>>2]=T,w[Vt+4>>2]=y}if(D=D+1|0,(D|0)>=(O|0))break t;T=Bn+(D<<3)|0,y=w[T>>2]|0,T=w[T+4>>2]|0}for(D=0,y=_e,T=G;;){if(!((y|0)==0&(T|0)==0)){if(Z=An(y|0,T|0,52)|0,Ke()|0,Z=Z&15,(Z|0)>=(fn|0)){if((Z|0)!=(fn|0)&&(y=y|kt,T=T&-15728641|Vt,Z>>>0>=Rt>>>0)){j=fn;do mt=Dn(7,0,(14-j|0)*3|0)|0,j=j+1|0,y=mt|y,T=Ke()|0|T;while(j>>>0<Z>>>0)}}else y=0,T=0;if(Z=Hc(y|0,T|0,O|0,yn|0)|0,Ke()|0,j=ot+(Z<<3)|0,ae=j,pe=w[ae>>2]|0,ae=w[ae+4>>2]|0,!((pe|0)==0&(ae|0)==0))for(mt=0;;){if((mt|0)>(O|0)){Pn=41;break e}if((pe|0)==(y|0)&(ae&-117440513|0)==(T|0)){Xe=An(pe|0,ae|0,56)|0,Ke()|0,Xe=Xe&7,nt=Xe+1|0,Mt=An(pe|0,ae|0,45)|0,Ke()|0;n:do if(!(Lr(Mt&127)|0))ae=7;else{if(pe=An(pe|0,ae|0,52)|0,Ke()|0,pe=pe&15,!pe){ae=6;break}for(ae=1;;){if(Mt=Dn(7,0,(15-ae|0)*3|0)|0,!((Mt&y|0)==0&((Ke()|0)&T|0)==0)){ae=7;break n}if(ae>>>0<pe>>>0)ae=ae+1|0;else{ae=6;break}}}while(0);if((Xe+2|0)>>>0>ae>>>0){Pn=51;break e}Mt=Dn(nt|0,0,56)|0,T=Ke()|0|T&-117440513,nt=j,w[nt>>2]=0,w[nt+4>>2]=0,y=Mt|y}else Z=(Z+1|0)%(O|0)|0;if(j=ot+(Z<<3)|0,ae=j,pe=w[ae>>2]|0,ae=w[ae+4>>2]|0,(pe|0)==0&(ae|0)==0)break;mt=mt+1|0}Mt=j,w[Mt>>2]=y,w[Mt+4>>2]=T}if(D=D+1|0,(D|0)>=(O|0))break t;T=Bn+(D<<3)|0,y=w[T>>2]|0,T=w[T+4>>2]|0}}while(0);if((O+5|0)>>>0<11){Pn=99;break}if(Vt=ma((O|0)/6|0,8)|0,!Vt){Pn=58;break}t:do if(Cn){mt=0,nt=0;do{if(Z=ot+(mt<<3)|0,y=Z,D=w[y>>2]|0,y=w[y+4>>2]|0,!((D|0)==0&(y|0)==0)){ae=An(D|0,y|0,56)|0,Ke()|0,ae=ae&7,T=ae+1|0,pe=y&-117440513,Mt=An(D|0,y|0,45)|0,Ke()|0;n:do if(Lr(Mt&127)|0){if(Xe=An(D|0,y|0,52)|0,Ke()|0,Xe=Xe&15,Xe|0)for(j=1;;){if(Mt=Dn(7,0,(15-j|0)*3|0)|0,!((D&Mt|0)==0&(pe&(Ke()|0)|0)==0))break n;if(j>>>0<Xe>>>0)j=j+1|0;else break}y=Dn(T|0,0,56)|0,D=y|D,y=Ke()|0|pe,T=Z,w[T>>2]=D,w[T+4>>2]=y,T=ae+2|0}while(0);(T|0)==7&&(Mt=Vt+(nt<<3)|0,w[Mt>>2]=D,w[Mt+4>>2]=y&-117440513,nt=nt+1|0)}mt=mt+1|0}while((mt|0)!=(O|0));if(Cn){if(kt=((O|0)<0)<<31>>31,Xe=Dn(fn|0,0,52)|0,mt=Ke()|0,fn>>>0>15)for(y=0,D=0;;){do if(!((_e|0)==0&(G|0)==0)){for(ae=An(_e|0,G|0,52)|0,Ke()|0,ae=ae&15,j=(ae|0)<(fn|0),ae=(ae|0)==(fn|0),Z=j?0:ae?_e:0,ae=j?0:ae?G:0,j=Hc(Z|0,ae|0,O|0,kt|0)|0,Ke()|0,T=0;;){if((T|0)>(O|0)){Pn=98;break e}if(Mt=ot+(j<<3)|0,pe=w[Mt+4>>2]|0,(pe&-117440513|0)==(ae|0)&&(w[Mt>>2]|0)==(Z|0)){Pn=70;break}if(j=(j+1|0)%(O|0)|0,Mt=ot+(j<<3)|0,(w[Mt>>2]|0)==(Z|0)&&(w[Mt+4>>2]|0)==(ae|0))break;T=T+1|0}if((Pn|0)==70&&(Pn=0,!0&(pe&117440512|0)==100663296))break;Mt=x+(D<<3)|0,w[Mt>>2]=_e,w[Mt+4>>2]=G,D=D+1|0}while(0);if(y=y+1|0,(y|0)>=(O|0)){O=nt;break t}G=Bn+(y<<3)|0,_e=w[G>>2]|0,G=w[G+4>>2]|0}for(y=0,D=0;;){do if(!((_e|0)==0&(G|0)==0)){if(ae=An(_e|0,G|0,52)|0,Ke()|0,ae=ae&15,(ae|0)>=(fn|0))if((ae|0)!=(fn|0))if(T=_e|Xe,j=G&-15728641|mt,ae>>>0<Rt>>>0)ae=j;else{Z=fn;do Mt=Dn(7,0,(14-Z|0)*3|0)|0,Z=Z+1|0,T=Mt|T,j=Ke()|0|j;while(Z>>>0<ae>>>0);ae=j}else T=_e,ae=G;else T=0,ae=0;for(Z=Hc(T|0,ae|0,O|0,kt|0)|0,Ke()|0,j=0;;){if((j|0)>(O|0)){Pn=98;break e}if(Mt=ot+(Z<<3)|0,pe=w[Mt+4>>2]|0,(pe&-117440513|0)==(ae|0)&&(w[Mt>>2]|0)==(T|0)){Pn=93;break}if(Z=(Z+1|0)%(O|0)|0,Mt=ot+(Z<<3)|0,(w[Mt>>2]|0)==(T|0)&&(w[Mt+4>>2]|0)==(ae|0))break;j=j+1|0}if((Pn|0)==93&&(Pn=0,!0&(pe&117440512|0)==100663296))break;Mt=x+(D<<3)|0,w[Mt>>2]=_e,w[Mt+4>>2]=G,D=D+1|0}while(0);if(y=y+1|0,(y|0)>=(O|0)){O=nt;break t}G=Bn+(y<<3)|0,_e=w[G>>2]|0,G=w[G+4>>2]|0}}else D=0,O=nt}else D=0,O=0;while(0);if(Aa(ot|0,0,On|0)|0,ed(Bn|0,Vt|0,O<<3|0)|0,Mr(Vt),O)x=x+(D<<3)|0;else break}return(Pn|0)==41?(Mr(Bn),Mr(ot),Mt=-1,Mt|0):(Pn|0)==51?(Mr(Bn),Mr(ot),Mt=-2,Mt|0):(Pn|0)==58?(Mr(Bn),Mr(ot),Mt=-3,Mt|0):(Pn|0)==98?(Mr(Vt),Mr(Bn),Mr(ot),Mt=-1,Mt|0):((Pn|0)==99&&ed(x|0,Bn|0,O<<3|0)|0,Mr(Bn),Mr(ot),Mt=0,Mt|0)}function pp(y,x,T,O,D){y=y|0,x=x|0,T=T|0,O=O|0,D=D|0;var j=0,G=0,Z=0,ae=0,pe=0,_e=0;if((x|0)<=0)return D=0,D|0;if((D|0)>=16){for(j=0;;){if(_e=y+(j<<3)|0,!((w[_e>>2]|0)==0&(w[_e+4>>2]|0)==0)){j=14;break}if(j=j+1|0,(j|0)>=(x|0)){G=0,j=16;break}}if((j|0)==14)return((O|0)>0?-2:-1)|0;if((j|0)==16)return G|0}j=0,_e=0;e:for(;;){pe=y+(_e<<3)|0,Z=pe,G=w[Z>>2]|0,Z=w[Z+4>>2]|0;do if(!((G|0)==0&(Z|0)==0)){if((j|0)>=(O|0)){G=-1,j=16;break e}if(ae=An(G|0,Z|0,52)|0,Ke()|0,ae=ae&15,(ae|0)>(D|0)){G=-2,j=16;break e}if((ae|0)==(D|0)){pe=T+(j<<3)|0,w[pe>>2]=G,w[pe+4>>2]=Z,j=j+1|0;break}if(G=(xp(7,D-ae|0)|0)+j|0,(G|0)>(O|0)){G=-1,j=16;break e}bs(w[pe>>2]|0,w[pe+4>>2]|0,D,T+(j<<3)|0),j=G}while(0);if(_e=_e+1|0,(_e|0)>=(x|0)){G=0,j=16;break}}return(j|0)==16?G|0:0}function Xh(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0;if((x|0)<=0)return T=0,T|0;if((T|0)>=16){for(O=0;;){if(G=y+(O<<3)|0,!((w[G>>2]|0)==0&(w[G+4>>2]|0)==0)){O=-1,D=13;break}if(O=O+1|0,(O|0)>=(x|0)){O=0,D=13;break}}if((D|0)==13)return O|0}O=0,G=0;e:for(;;){D=y+(G<<3)|0,j=w[D>>2]|0,D=w[D+4>>2]|0;do if(!((j|0)==0&(D|0)==0)){if(D=An(j|0,D|0,52)|0,Ke()|0,D=D&15,(D|0)>(T|0)){O=-1,D=13;break e}if((D|0)==(T|0)){O=O+1|0;break}else{O=(xp(7,T-D|0)|0)+O|0;break}}while(0);if(G=G+1|0,(G|0)>=(x|0)){D=13;break}}return(D|0)==13?O|0:0}function NA(y,x){return y=y|0,x=x|0,x=An(y|0,x|0,52)|0,Ke()|0,x&1|0}function fs(y,x){y=y|0,x=x|0;var T=0,O=0,D=0;if(D=An(y|0,x|0,52)|0,Ke()|0,D=D&15,!D)return D=0,D|0;for(O=1;;){if(T=An(y|0,x|0,(15-O|0)*3|0)|0,Ke()|0,T=T&7,T|0){O=5;break}if(O>>>0<D>>>0)O=O+1|0;else{T=0,O=5;break}}return(O|0)==5?T|0:0}function gp(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0,ae=0;if(ae=An(y|0,x|0,52)|0,Ke()|0,ae=ae&15,!ae)return Z=x,ae=y,Hn(Z|0),ae|0;for(Z=1,T=0;;){j=(15-Z|0)*3|0,O=Dn(7,0,j|0)|0,D=Ke()|0,G=An(y|0,x|0,j|0)|0,Ke()|0,j=Dn(Gl(G&7)|0,0,j|0)|0,G=Ke()|0,y=j|y&~O,x=G|x&~D;e:do if(!T)if((j&O|0)==0&(G&D|0)==0)T=0;else if(O=An(y|0,x|0,52)|0,Ke()|0,O=O&15,!O)T=1;else{T=1;t:for(;;){switch(G=An(y|0,x|0,(15-T|0)*3|0)|0,Ke()|0,G&7){case 1:break t;case 0:break;default:{T=1;break e}}if(T>>>0<O>>>0)T=T+1|0;else{T=1;break e}}for(T=1;;)if(G=(15-T|0)*3|0,D=An(y|0,x|0,G|0)|0,Ke()|0,j=Dn(7,0,G|0)|0,x=x&~(Ke()|0),G=Dn(Gl(D&7)|0,0,G|0)|0,y=y&~j|G,x=x|(Ke()|0),T>>>0<O>>>0)T=T+1|0;else{T=1;break}}while(0);if(Z>>>0<ae>>>0)Z=Z+1|0;else break}return Hn(x|0),y|0}function ws(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0;if(O=An(y|0,x|0,52)|0,Ke()|0,O=O&15,!O)return T=x,O=y,Hn(T|0),O|0;for(T=1;j=(15-T|0)*3|0,G=An(y|0,x|0,j|0)|0,Ke()|0,D=Dn(7,0,j|0)|0,x=x&~(Ke()|0),j=Dn(Gl(G&7)|0,0,j|0)|0,y=j|y&~D,x=Ke()|0|x,T>>>0<O>>>0;)T=T+1|0;return Hn(x|0),y|0}function Fg(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0,ae=0;if(ae=An(y|0,x|0,52)|0,Ke()|0,ae=ae&15,!ae)return Z=x,ae=y,Hn(Z|0),ae|0;for(Z=1,T=0;;){j=(15-Z|0)*3|0,O=Dn(7,0,j|0)|0,D=Ke()|0,G=An(y|0,x|0,j|0)|0,Ke()|0,j=Dn(Bs(G&7)|0,0,j|0)|0,G=Ke()|0,y=j|y&~O,x=G|x&~D;e:do if(!T)if((j&O|0)==0&(G&D|0)==0)T=0;else if(O=An(y|0,x|0,52)|0,Ke()|0,O=O&15,!O)T=1;else{T=1;t:for(;;){switch(G=An(y|0,x|0,(15-T|0)*3|0)|0,Ke()|0,G&7){case 1:break t;case 0:break;default:{T=1;break e}}if(T>>>0<O>>>0)T=T+1|0;else{T=1;break e}}for(T=1;;)if(D=(15-T|0)*3|0,j=Dn(7,0,D|0)|0,G=x&~(Ke()|0),x=An(y|0,x|0,D|0)|0,Ke()|0,x=Dn(Bs(x&7)|0,0,D|0)|0,y=y&~j|x,x=G|(Ke()|0),T>>>0<O>>>0)T=T+1|0;else{T=1;break}}while(0);if(Z>>>0<ae>>>0)Z=Z+1|0;else break}return Hn(x|0),y|0}function mp(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0;if(O=An(y|0,x|0,52)|0,Ke()|0,O=O&15,!O)return T=x,O=y,Hn(T|0),O|0;for(T=1;G=(15-T|0)*3|0,j=Dn(7,0,G|0)|0,D=x&~(Ke()|0),x=An(y|0,x|0,G|0)|0,Ke()|0,x=Dn(Bs(x&7)|0,0,G|0)|0,y=x|y&~j,x=Ke()|0|D,T>>>0<O>>>0;)T=T+1|0;return Hn(x|0),y|0}function kg(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0;if(ae=Ve,Ve=Ve+64|0,Z=ae+40|0,O=ae+24|0,D=ae+12|0,j=ae,Dn(x|0,0,52)|0,T=Ke()|0|134225919,!x)return(w[y+4>>2]|0)>2||(w[y+8>>2]|0)>2||(w[y+12>>2]|0)>2?(G=0,Z=0,Hn(G|0),Ve=ae,Z|0):(Dn(vs(y)|0,0,45)|0,G=Ke()|0|T,Z=-1,Hn(G|0),Ve=ae,Z|0);if(w[Z>>2]=w[y>>2],w[Z+4>>2]=w[y+4>>2],w[Z+8>>2]=w[y+8>>2],w[Z+12>>2]=w[y+12>>2],G=Z+4|0,(x|0)>0)for(y=-1;w[O>>2]=w[G>>2],w[O+4>>2]=w[G+4>>2],w[O+8>>2]=w[G+8>>2],x&1?(T_(G),w[D>>2]=w[G>>2],w[D+4>>2]=w[G+4>>2],w[D+8>>2]=w[G+8>>2],Zu(D)):(lp(G),w[D>>2]=w[G>>2],w[D+4>>2]=w[G+4>>2],w[D+8>>2]=w[G+8>>2],Ds(D)),Ul(O,D,j),li(j),_e=(15-x|0)*3|0,pe=Dn(7,0,_e|0)|0,T=T&~(Ke()|0),_e=Dn(kf(j)|0,0,_e|0)|0,y=_e|y&~pe,T=Ke()|0|T,(x|0)>1;)x=x+-1|0;else y=-1;e:do if((w[G>>2]|0)<=2&&(w[Z+8>>2]|0)<=2&&(w[Z+12>>2]|0)<=2){if(O=vs(Z)|0,x=Dn(O|0,0,45)|0,x=x|y,y=Ke()|0|T&-1040385,j=Ig(Z)|0,!(Lr(O)|0)){if((j|0)<=0)break;for(D=0;;){if(O=An(x|0,y|0,52)|0,Ke()|0,O=O&15,O)for(T=1;_e=(15-T|0)*3|0,Z=An(x|0,y|0,_e|0)|0,Ke()|0,pe=Dn(7,0,_e|0)|0,y=y&~(Ke()|0),_e=Dn(Gl(Z&7)|0,0,_e|0)|0,x=x&~pe|_e,y=y|(Ke()|0),T>>>0<O>>>0;)T=T+1|0;if(D=D+1|0,(D|0)==(j|0))break e}}D=An(x|0,y|0,52)|0,Ke()|0,D=D&15;t:do if(D){T=1;n:for(;;){switch(_e=An(x|0,y|0,(15-T|0)*3|0)|0,Ke()|0,_e&7){case 1:break n;case 0:break;default:break t}if(T>>>0<D>>>0)T=T+1|0;else break t}if(lo(O,w[Z>>2]|0)|0)for(T=1;Z=(15-T|0)*3|0,pe=Dn(7,0,Z|0)|0,_e=y&~(Ke()|0),y=An(x|0,y|0,Z|0)|0,Ke()|0,y=Dn(Bs(y&7)|0,0,Z|0)|0,x=x&~pe|y,y=_e|(Ke()|0),T>>>0<D>>>0;)T=T+1|0;else for(T=1;_e=(15-T|0)*3|0,Z=An(x|0,y|0,_e|0)|0,Ke()|0,pe=Dn(7,0,_e|0)|0,y=y&~(Ke()|0),_e=Dn(Gl(Z&7)|0,0,_e|0)|0,x=x&~pe|_e,y=y|(Ke()|0),T>>>0<D>>>0;)T=T+1|0}while(0);if((j|0)>0){T=0;do x=gp(x,y)|0,y=Ke()|0,T=T+1|0;while((T|0)!=(j|0))}}else x=0,y=0;while(0);return pe=y,_e=x,Hn(pe|0),Ve=ae,_e|0}function Ua(y){return y=y|0,(y|0)%2|0|0}function zg(y,x){y=y|0,x=x|0;var T=0,O=0;return O=Ve,Ve=Ve+16|0,T=O,x>>>0<=15&&(w[y+4>>2]&2146435072|0)!=2146435072&&(w[y+8+4>>2]&2146435072|0)!=2146435072?(qh(y,x,T),x=kg(T,x)|0,y=Ke()|0):(y=0,x=0),Hn(y|0),Ve=O,x|0}function FA(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0;if(D=T+4|0,j=An(y|0,x|0,52)|0,Ke()|0,j=j&15,G=An(y|0,x|0,45)|0,Ke()|0,O=(j|0)==0,Lr(G&127)|0){if(O)return G=1,G|0;O=1}else{if(O)return G=0,G|0;!(w[D>>2]|0)&&!(w[T+8>>2]|0)?O=(w[T+12>>2]|0)!=0&1:O=1}for(T=1;T&1?Zu(D):Ds(D),G=An(y|0,x|0,(15-T|0)*3|0)|0,Ke()|0,Mg(D,G&7),T>>>0<j>>>0;)T=T+1|0;return O|0}function Hf(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0;_e=Ve,Ve=Ve+16|0,ae=_e,pe=An(y|0,x|0,45)|0,Ke()|0,pe=pe&127;e:do if(Lr(pe)|0&&(j=An(y|0,x|0,52)|0,Ke()|0,j=j&15,(j|0)!=0)){O=1;t:for(;;){switch(Z=An(y|0,x|0,(15-O|0)*3|0)|0,Ke()|0,Z&7){case 5:break t;case 0:break;default:{O=x;break e}}if(O>>>0<j>>>0)O=O+1|0;else{O=x;break e}}for(D=1,O=x;x=(15-D|0)*3|0,G=Dn(7,0,x|0)|0,Z=O&~(Ke()|0),O=An(y|0,O|0,x|0)|0,Ke()|0,O=Dn(Bs(O&7)|0,0,x|0)|0,y=y&~G|O,O=Z|(Ke()|0),D>>>0<j>>>0;)D=D+1|0}else O=x;while(0);if(Z=7728+(pe*28|0)|0,w[T>>2]=w[Z>>2],w[T+4>>2]=w[Z+4>>2],w[T+8>>2]=w[Z+8>>2],w[T+12>>2]=w[Z+12>>2],!(FA(y,O,T)|0)){Ve=_e;return}if(G=T+4|0,w[ae>>2]=w[G>>2],w[ae+4>>2]=w[G+4>>2],w[ae+8>>2]=w[G+8>>2],j=An(y|0,O|0,52)|0,Ke()|0,Z=j&15,j&1?(Ds(G),j=Z+1|0):j=Z,!(Lr(pe)|0))O=0;else{e:do if(!Z)O=0;else for(x=1;;){if(D=An(y|0,O|0,(15-x|0)*3|0)|0,Ke()|0,D=D&7,D|0){O=D;break e}if(x>>>0<Z>>>0)x=x+1|0;else{O=0;break}}while(0);O=(O|0)==4&1}if(!(Gf(T,j,O,0)|0))(j|0)!=(Z|0)&&(w[G>>2]=w[ae>>2],w[G+4>>2]=w[ae+4>>2],w[G+8>>2]=w[ae+8>>2]);else{if(Lr(pe)|0)do;while(Gf(T,j,0,0)|0);(j|0)!=(Z|0)&&lp(G)}Ve=_e}function du(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0;O=Ve,Ve=Ve+16|0,D=O,Hf(y,x,D),x=An(y|0,x|0,52)|0,Ke()|0,CA(D,x&15,T),Ve=O}function jl(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0;G=Ve,Ve=Ve+16|0,j=G,Hf(y,x,j),O=An(y|0,x|0,45)|0,Ke()|0,O=(Lr(O&127)|0)==0,D=An(y|0,x|0,52)|0,Ke()|0,D=D&15;e:do if(!O){if(D|0)for(O=1;;){if(Z=Dn(7,0,(15-O|0)*3|0)|0,!((Z&y|0)==0&((Ke()|0)&x|0)==0))break e;if(O>>>0<D>>>0)O=O+1|0;else break}PA(j,D,0,5,T),Ve=G;return}while(0);jf(j,D,0,6,T),Ve=G}function L_(y,x){y=y|0,x=x|0;var T=0,O=0,D=0;if(O=An(y|0,x|0,45)|0,Ke()|0,!(Lr(O&127)|0))return O=2,O|0;if(O=An(y|0,x|0,52)|0,Ke()|0,O=O&15,!O)return O=5,O|0;for(T=1;;){if(D=Dn(7,0,(15-T|0)*3|0)|0,!((D&y|0)==0&((Ke()|0)&x|0)==0)){T=2,y=6;break}if(T>>>0<O>>>0)T=T+1|0;else{T=5,y=6;break}}return(y|0)==6?T|0:0}function Ug(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0;Xe=Ve,Ve=Ve+128|0,pe=Xe+112|0,j=Xe+96|0,_e=Xe,D=An(y|0,x|0,52)|0,Ke()|0,Z=D&15,w[pe>>2]=Z,G=An(y|0,x|0,45)|0,Ke()|0,G=G&127;e:do if(Lr(G)|0){if(Z|0)for(O=1;;){if(ae=Dn(7,0,(15-O|0)*3|0)|0,!((ae&y|0)==0&((Ke()|0)&x|0)==0)){D=0;break e}if(O>>>0<Z>>>0)O=O+1|0;else break}if(D&1)D=1;else{ae=Dn(Z+1|0,0,52)|0,_e=Ke()|0|x&-15728641,pe=Dn(7,0,(14-Z|0)*3|0)|0,Ug((ae|y)&~pe,_e&~(Ke()|0),T),Ve=Xe;return}}else D=0;while(0);Hf(y,x,j),D?(Lg(j,pe,_e),ae=5):(fp(j,pe,_e),ae=6);e:do if(Lr(G)|0)if(!Z)O=20;else for(O=1;;){if(G=Dn(7,0,(15-O|0)*3|0)|0,!((G&y|0)==0&((Ke()|0)&x|0)==0)){O=8;break e}if(O>>>0<Z>>>0)O=O+1|0;else{O=20;break}}else O=8;while(0);if(Aa(T|0,-1,O|0)|0,D){D=0;do{for(j=_e+(D<<4)|0,IA(j,w[pe>>2]|0)|0,j=w[j>>2]|0,O=0;G=T+(O<<2)|0,Z=w[G>>2]|0,!((Z|0)==-1|(Z|0)==(j|0));)O=O+1|0;w[G>>2]=j,D=D+1|0}while((D|0)!=(ae|0))}else{D=0;do{for(j=_e+(D<<4)|0,Gf(j,w[pe>>2]|0,0,1)|0,j=w[j>>2]|0,O=0;G=T+(O<<2)|0,Z=w[G>>2]|0,!((Z|0)==-1|(Z|0)==(j|0));)O=O+1|0;w[G>>2]=j,D=D+1|0}while((D|0)!=(ae|0))}Ve=Xe}function ox(){return 12}function Ap(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0,ae=0;if(Dn(y|0,0,52)|0,Z=Ke()|0|134225919,(y|0)<1){O=0,T=0;do Lr(O)|0&&(Dn(O|0,0,45)|0,G=Z|(Ke()|0),y=x+(T<<3)|0,w[y>>2]=-1,w[y+4>>2]=G,T=T+1|0),O=O+1|0;while((O|0)!=122);return}G=0,T=0;do{if(Lr(G)|0){for(Dn(G|0,0,45)|0,O=1,D=-1,j=Z|(Ke()|0);ae=Dn(7,0,(15-O|0)*3|0)|0,D=D&~ae,j=j&~(Ke()|0),(O|0)!=(y|0);)O=O+1|0;ae=x+(T<<3)|0,w[ae>>2]=D,w[ae+4>>2]=j,T=T+1|0}G=G+1|0}while((G|0)!=122)}function kA(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0;var D=0,j=0,G=0,Z=0,ae=0,pe=0;if(Z=Ve,Ve=Ve+64|0,G=Z,(y|0)==(T|0)&(x|0)==(O|0)|(!1|(x&2013265920|0)!=134217728|(!1|(O&2013265920|0)!=134217728))||(D=An(y|0,x|0,52)|0,Ke()|0,D=D&15,j=An(T|0,O|0,52)|0,Ke()|0,(D|0)!=(j&15|0)))return G=0,Ve=Z,G|0;if(j=D+-1|0,D>>>0>1&&(pe=dp(y,x,j)|0,ae=Ke()|0,j=dp(T,O,j)|0,(pe|0)==(j|0)&(ae|0)==(Ke()|0))&&(j=(D^15)*3|0,D=An(y|0,x|0,j|0)|0,Ke()|0,D=D&7,j=An(T|0,O|0,j|0)|0,Ke()|0,j=j&7,(D|0)==0|(j|0)==0||(w[21136+(D<<2)>>2]|0)==(j|0)||(w[21168+(D<<2)>>2]|0)==(j|0)))return pe=1,Ve=Z,pe|0;D=G,j=D+56|0;do w[D>>2]=0,D=D+4|0;while((D|0)<(j|0));return Rs(y,x,1,G),pe=G,!((w[pe>>2]|0)==(T|0)&&(w[pe+4>>2]|0)==(O|0))&&(pe=G+8|0,!((w[pe>>2]|0)==(T|0)&&(w[pe+4>>2]|0)==(O|0)))&&(pe=G+16|0,!((w[pe>>2]|0)==(T|0)&&(w[pe+4>>2]|0)==(O|0)))&&(pe=G+24|0,!((w[pe>>2]|0)==(T|0)&&(w[pe+4>>2]|0)==(O|0)))&&(pe=G+32|0,!((w[pe>>2]|0)==(T|0)&&(w[pe+4>>2]|0)==(O|0)))&&(pe=G+40|0,!((w[pe>>2]|0)==(T|0)&&(w[pe+4>>2]|0)==(O|0)))?(D=G+48|0,D=((w[D>>2]|0)==(T|0)?(w[D+4>>2]|0)==(O|0):0)&1):D=1,pe=D,Ve=Z,pe|0}function _p(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0;var D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0;if(pe=Ve,Ve=Ve+16|0,G=pe,!(kA(y,x,T,O)|0))return Z=0,ae=0,Hn(Z|0),Ve=pe,ae|0;for(Z=x&-2130706433,D=(No(y,x)|0)==0,D=D?1:2;w[G>>2]=0,_e=ye(y,x,D,G)|0,j=D+1|0,!((_e|0)==(T|0)&(Ke()|0)==(O|0));)if(j>>>0<7)D=j;else{D=0,y=0,ae=6;break}return(ae|0)==6?(Hn(D|0),Ve=pe,y|0):(_e=Dn(D|0,0,56)|0,ae=Z|(Ke()|0)|268435456,_e=y|_e,Hn(ae|0),Ve=pe,_e|0)}function D_(y,x){y=y|0,x=x|0;var T=0;return T=!0&(x&2013265920|0)==268435456,Hn((T?x&-2130706433|134217728:0)|0),(T?y:0)|0}function Gg(y,x){y=y|0,x=x|0;var T=0,O=0,D=0;return O=Ve,Ve=Ve+16|0,T=O,!0&(x&2013265920|0)==268435456?(D=An(y|0,x|0,56)|0,Ke()|0,w[T>>2]=0,T=ye(y,x&-2130706433|134217728,D&7,T)|0,x=Ke()|0,Hn(x|0),Ve=O,T|0):(x=0,T=0,Hn(x|0),Ve=O,T|0)}function B_(y,x){y=y|0,x=x|0;var T=0;if(!(!0&(x&2013265920|0)==268435456))return T=0,T|0;switch(T=An(y|0,x|0,56)|0,Ke()|0,T&7){case 0:case 7:return T=0,T|0}return T=x&-2130706433|134217728,!0&(x&117440512|0)==16777216&(No(y,T)|0)!=0?(T=0,T|0):(T=Ng(y,T)|0,T|0)}function Zh(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0;j=Ve,Ve=Ve+16|0,O=j,G=!0&(x&2013265920|0)==268435456,D=x&-2130706433|134217728,Z=T,w[Z>>2]=G?y:0,w[Z+4>>2]=G?D:0,G?(x=An(y|0,x|0,56)|0,Ke()|0,w[O>>2]=0,y=ye(y,D,x&7,O)|0,x=Ke()|0):(y=0,x=0),Z=T+8|0,w[Z>>2]=y,w[Z+4>>2]=x,Ve=j}function sx(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0;D=(No(y,x)|0)==0,x=x&-2130706433,O=T,w[O>>2]=D?y:0,w[O+4>>2]=D?x|285212672:0,O=T+8|0,w[O>>2]=y,w[O+4>>2]=x|301989888,O=T+16|0,w[O>>2]=y,w[O+4>>2]=x|318767104,O=T+24|0,w[O>>2]=y,w[O+4>>2]=x|335544320,O=T+32|0,w[O>>2]=y,w[O+4>>2]=x|352321536,T=T+40|0,w[T>>2]=y,w[T+4>>2]=x|369098752}function jg(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0;if(G=Ve,Ve=Ve+16|0,j=G,O=An(y|0,x|0,56)|0,Ke()|0,Z=!0&(x&2013265920|0)==268435456,D=Z?y:0,y=Z?x&-2130706433|134217728:0,x=Ep(D,y,O&7)|0,(x|0)==-1){w[T>>2]=0,Ve=G;return}Hf(D,y,j),O=An(D|0,y|0,52)|0,Ke()|0,O=O&15,No(D,y)|0?PA(j,O,x,2,T):jf(j,O,x,2,T),Ve=G}function ax(y){y=y|0;var x=0,T=0,O=0;return x=ma(1,12)|0,x||gt(22691,22646,49,22704),T=y+4|0,O=w[T>>2]|0,O|0?(O=O+8|0,w[O>>2]=x,w[T>>2]=x,x|0):(w[y>>2]|0&&gt(22721,22646,61,22744),O=y,w[O>>2]=x,w[T>>2]=x,x|0)}function lx(y,x){y=y|0,x=x|0;var T=0,O=0;return O=Ga(24)|0,O||gt(22758,22646,78,22772),w[O>>2]=w[x>>2],w[O+4>>2]=w[x+4>>2],w[O+8>>2]=w[x+8>>2],w[O+12>>2]=w[x+12>>2],w[O+16>>2]=0,x=y+4|0,T=w[x>>2]|0,T|0?(w[T+16>>2]=O,w[x>>2]=O,O|0):(w[y>>2]|0&&gt(22787,22646,82,22772),w[y>>2]=O,w[x>>2]=O,O|0)}function ux(y){y=y|0;var x=0,T=0,O=0,D=0;if(y)for(O=1;;){if(x=w[y>>2]|0,x|0)do{if(T=w[x>>2]|0,T|0)do D=T,T=w[T+16>>2]|0,Mr(D);while(T|0);D=x,x=w[x+8>>2]|0,Mr(D)}while(x|0);if(x=y,y=w[y+8>>2]|0,O||Mr(x),y)O=0;else break}}function zA(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0,Vt=0,yn=0,Cn=0,Rt=0,fn=0,ot=0,On=0,Bn=0,Pn=0,Mt=0,br=0,ui=0,Vr=0,Jr=0,qt=0,xi=0,$i=0,gr=0;if(D=y+8|0,w[D>>2]|0)return gr=1,gr|0;if(O=w[y>>2]|0,!O)return gr=0,gr|0;x=O,T=0;do T=T+1|0,x=w[x+8>>2]|0;while(x|0);if(T>>>0<2)return gr=0,gr|0;xi=Ga(T<<2)|0,xi||gt(22807,22646,317,22826),qt=Ga(T<<5)|0,qt||gt(22848,22646,321,22826),w[y>>2]=0,Bn=y+4|0,w[Bn>>2]=0,w[D>>2]=0,T=0,Jr=0,On=0,Xe=0;e:for(;;){if(_e=w[O>>2]|0,_e){j=0,G=_e;do{if(ae=+Ue[G+8>>3],x=G,G=w[G+16>>2]|0,pe=(G|0)==0,D=pe?_e:G,Z=+Ue[D+8>>3],+rr(+(ae-Z))>3.141592653589793){gr=14;break}j=j+(Z-ae)*(+Ue[x>>3]+ +Ue[D>>3])}while(!pe);if((gr|0)==14){gr=0,j=0,x=_e;do ot=+Ue[x+8>>3],Vr=x+16|0,ui=w[Vr>>2]|0,ui=ui|0?ui:_e,fn=+Ue[ui+8>>3],j=j+(+Ue[x>>3]+ +Ue[ui>>3])*((fn<0?fn+6.283185307179586:fn)-(ot<0?ot+6.283185307179586:ot)),x=w[(x|0?Vr:O)>>2]|0;while(x|0)}j>0?(w[xi+(Jr<<2)>>2]=O,Jr=Jr+1|0,D=On,x=Xe):gr=19}else gr=19;if((gr|0)==19){gr=0;do if(T){if(x=T+8|0,w[x>>2]|0){gr=21;break e}if(T=ma(1,12)|0,!T){gr=23;break e}w[x>>2]=T,D=T+4|0,G=T,x=Xe}else if(Xe){D=Bn,G=Xe+8|0,x=O,T=y;break}else if(w[y>>2]|0){gr=27;break e}else{D=Bn,G=y,x=O,T=y;break}while(0);if(w[G>>2]=O,w[D>>2]=O,G=qt+(On<<5)|0,pe=w[O>>2]|0,pe){for(_e=qt+(On<<5)+8|0,Ue[_e>>3]=17976931348623157e292,Xe=qt+(On<<5)+24|0,Ue[Xe>>3]=17976931348623157e292,Ue[G>>3]=-17976931348623157e292,nt=qt+(On<<5)+16|0,Ue[nt>>3]=-17976931348623157e292,Cn=17976931348623157e292,Rt=-17976931348623157e292,D=0,mt=pe,ae=17976931348623157e292,Vt=17976931348623157e292,yn=-17976931348623157e292,Z=-17976931348623157e292;j=+Ue[mt>>3],ot=+Ue[mt+8>>3],mt=w[mt+16>>2]|0,kt=(mt|0)==0,fn=+Ue[(kt?pe:mt)+8>>3],j<ae&&(Ue[_e>>3]=j,ae=j),ot<Vt&&(Ue[Xe>>3]=ot,Vt=ot),j>yn?Ue[G>>3]=j:j=yn,ot>Z&&(Ue[nt>>3]=ot,Z=ot),Cn=ot>0&ot<Cn?ot:Cn,Rt=ot<0&ot>Rt?ot:Rt,D=D|+rr(+(ot-fn))>3.141592653589793,!kt;)yn=j;D&&(Ue[nt>>3]=Rt,Ue[Xe>>3]=Cn)}else w[G>>2]=0,w[G+4>>2]=0,w[G+8>>2]=0,w[G+12>>2]=0,w[G+16>>2]=0,w[G+20>>2]=0,w[G+24>>2]=0,w[G+28>>2]=0;D=On+1|0}if(Vr=O+8|0,O=w[Vr>>2]|0,w[Vr>>2]=0,O)On=D,Xe=x;else{gr=45;break}}if((gr|0)==21)gt(22624,22646,35,22658);else if((gr|0)==23)gt(22678,22646,37,22658);else if((gr|0)==27)gt(22721,22646,61,22744);else if((gr|0)==45){e:do if((Jr|0)>0){for(Vr=(D|0)==0,br=D<<2,ui=(y|0)==0,Mt=0,x=0;;){if(Pn=w[xi+(Mt<<2)>>2]|0,Vr)gr=73;else{if(On=Ga(br)|0,!On){gr=50;break}if(Bn=Ga(br)|0,!Bn){gr=52;break}t:do if(ui)T=0;else{for(D=0,T=0,G=y;O=qt+(D<<5)|0,yp(w[G>>2]|0,O,w[Pn>>2]|0)|0?(w[On+(T<<2)>>2]=G,w[Bn+(T<<2)>>2]=O,kt=T+1|0):kt=T,G=w[G+8>>2]|0,G;)D=D+1|0,T=kt;if((kt|0)>0)if(O=w[On>>2]|0,(kt|0)==1)T=O;else for(nt=0,mt=-1,T=O,Xe=O;;){for(pe=w[Xe>>2]|0,O=0,G=0;D=w[w[On+(G<<2)>>2]>>2]|0,(D|0)==(pe|0)?_e=O:_e=O+((yp(D,w[Bn+(G<<2)>>2]|0,w[pe>>2]|0)|0)&1)|0,G=G+1|0,(G|0)!=(kt|0);)O=_e;if(D=(_e|0)>(mt|0),T=D?Xe:T,O=nt+1|0,(O|0)==(kt|0))break t;nt=O,mt=D?_e:mt,Xe=w[On+(O<<2)>>2]|0}else T=0}while(0);if(Mr(On),Mr(Bn),T){if(D=T+4|0,O=w[D>>2]|0,O)T=O+8|0;else if(w[T>>2]|0){gr=70;break}w[T>>2]=Pn,w[D>>2]=Pn}else gr=73}if((gr|0)==73){if(gr=0,x=w[Pn>>2]|0,x|0)do Bn=x,x=w[x+16>>2]|0,Mr(Bn);while(x|0);Mr(Pn),x=2}if(Mt=Mt+1|0,(Mt|0)>=(Jr|0)){$i=x;break e}}(gr|0)==50?gt(22863,22646,249,22882):(gr|0)==52?gt(22901,22646,252,22882):(gr|0)==70&&gt(22721,22646,61,22744)}else $i=0;while(0);return Mr(xi),Mr(qt),gr=$i,gr|0}return 0}function yp(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0;if(!(Wh(x,T)|0)||(x=EA(x)|0,pe=+Ue[T>>3],O=+Ue[T+8>>3],O=x&O<0?O+6.283185307179586:O,y=w[y>>2]|0,!y))return y=0,y|0;if(x){x=0,T=y;e:for(;;){for(;G=+Ue[T>>3],ae=+Ue[T+8>>3],T=T+16|0,_e=w[T>>2]|0,_e=_e|0?_e:y,j=+Ue[_e>>3],D=+Ue[_e+8>>3],G>j?(Z=G,G=ae):(Z=j,j=G,G=D,D=ae),!!(pe<j|pe>Z);)if(T=w[T>>2]|0,!T){T=22;break e}if(ae=D<0?D+6.283185307179586:D,G=G<0?G+6.283185307179586:G,O=G==O|ae==O?O+-2220446049250313e-31:O,ae=ae+(pe-j)/(Z-j)*(G-ae),(ae<0?ae+6.283185307179586:ae)>O&&(x=x^1),T=w[T>>2]|0,!T){T=22;break}}if((T|0)==22)return x|0}else{x=0,T=y;e:for(;;){for(;G=+Ue[T>>3],ae=+Ue[T+8>>3],T=T+16|0,_e=w[T>>2]|0,_e=_e|0?_e:y,j=+Ue[_e>>3],D=+Ue[_e+8>>3],G>j?(Z=G,G=ae):(Z=j,j=G,G=D,D=ae),!!(pe<j|pe>Z);)if(T=w[T>>2]|0,!T){T=22;break e}if(O=G==O|D==O?O+-2220446049250313e-31:O,D+(pe-j)/(Z-j)*(G-D)>O&&(x=x^1),T=w[T>>2]|0,!T){T=22;break}}if((T|0)==22)return x|0}return 0}function ga(y,x,T,O,D){y=y|0,x=x|0,T=T|0,O=O|0,D=D|0;var j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0,Vt=0,yn=0,Cn=0,Rt=0;if(Rt=Ve,Ve=Ve+32|0,Cn=Rt+16|0,yn=Rt,j=An(y|0,x|0,52)|0,Ke()|0,j=j&15,mt=An(T|0,O|0,52)|0,Ke()|0,(j|0)!=(mt&15|0))return Cn=1,Ve=Rt,Cn|0;if(pe=An(y|0,x|0,45)|0,Ke()|0,pe=pe&127,_e=An(T|0,O|0,45)|0,Ke()|0,_e=_e&127,mt=(pe|0)!=(_e|0),mt){if(Z=sp(pe,_e)|0,(Z|0)==7)return Cn=2,Ve=Rt,Cn|0;ae=sp(_e,pe)|0,(ae|0)==7?gt(22925,22949,151,22959):(kt=Z,G=ae)}else kt=0,G=0;Xe=Lr(pe)|0,nt=Lr(_e)|0,w[Cn>>2]=0,w[Cn+4>>2]=0,w[Cn+8>>2]=0,w[Cn+12>>2]=0;do if(kt){if(_e=w[4304+(pe*28|0)+(kt<<2)>>2]|0,Z=(_e|0)>0,nt)if(Z){pe=0,ae=T,Z=O;do ae=Fg(ae,Z)|0,Z=Ke()|0,G=Bs(G)|0,(G|0)==1&&(G=Bs(1)|0),pe=pe+1|0;while((pe|0)!=(_e|0));_e=G,pe=ae,ae=Z}else _e=G,pe=T,ae=O;else if(Z){pe=0,ae=T,Z=O;do ae=mp(ae,Z)|0,Z=Ke()|0,G=Bs(G)|0,pe=pe+1|0;while((pe|0)!=(_e|0));_e=G,pe=ae,ae=Z}else _e=G,pe=T,ae=O;if(FA(pe,ae,Cn)|0,mt||gt(22972,22949,181,22959),Z=(Xe|0)!=0,G=(nt|0)!=0,Z&G&&gt(22999,22949,182,22959),Z){if(G=fs(y,x)|0,Gn[22032+(G*7|0)+kt>>0]|0){j=3;break}ae=w[21200+(G*28|0)+(kt<<2)>>2]|0,pe=ae,Vt=26}else if(G){if(G=fs(pe,ae)|0,Gn[22032+(G*7|0)+_e>>0]|0){j=4;break}pe=0,ae=w[21200+(_e*28|0)+(G<<2)>>2]|0,Vt=26}else G=0;if((Vt|0)==26)if((ae|0)<=-1&&gt(23030,22949,212,22959),(pe|0)<=-1&&gt(23053,22949,213,22959),(ae|0)>0){Z=Cn+4|0,G=0;do ol(Z),G=G+1|0;while((G|0)!=(ae|0));G=pe}else G=pe;if(w[yn>>2]=0,w[yn+4>>2]=0,w[yn+8>>2]=0,Mg(yn,kt),j|0)for(;Ua(j)|0?Zu(yn):Ds(yn),(j|0)>1;)j=j+-1|0;if((G|0)>0){j=0;do ol(yn),j=j+1|0;while((j|0)!=(G|0))}Vt=Cn+4|0,xs(Vt,yn,Vt),li(Vt),Vt=50}else if(FA(T,O,Cn)|0,(Xe|0)!=0&(nt|0)!=0)if((_e|0)!=(pe|0)&&gt(23077,22949,243,22959),G=fs(y,x)|0,j=fs(T,O)|0,Gn[22032+(G*7|0)+j>>0]|0)j=5;else if(G=w[21200+(G*28|0)+(j<<2)>>2]|0,(G|0)>0){Z=Cn+4|0,j=0;do ol(Z),j=j+1|0;while((j|0)!=(G|0));Vt=50}else Vt=50;else Vt=50;while(0);return(Vt|0)==50&&(j=Cn+4|0,w[D>>2]=w[j>>2],w[D+4>>2]=w[j+4>>2],w[D+8>>2]=w[j+8>>2],j=0),Cn=j,Ve=Rt,Cn|0}function UA(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0;var D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0,Vt=0,yn=0,Cn=0,Rt=0;if(kt=Ve,Ve=Ve+48|0,G=kt+36|0,Z=kt+24|0,ae=kt+12|0,pe=kt,j=An(y|0,x|0,52)|0,Ke()|0,j=j&15,nt=An(y|0,x|0,45)|0,Ke()|0,nt=nt&127,_e=Lr(nt)|0,Dn(j|0,0,52)|0,yn=Ke()|0|134225919,Vt=O,w[Vt>>2]=-1,w[Vt+4>>2]=yn,!j)return(w[T>>2]|0)>1||(w[T+4>>2]|0)>1||(w[T+8>>2]|0)>1||(D=op(nt,kf(T)|0)|0,(D|0)==127)?(yn=1,Ve=kt,yn|0):(mt=Dn(D|0,0,45)|0,Vt=Ke()|0,nt=O,Vt=w[nt+4>>2]&-1040385|Vt,yn=O,w[yn>>2]=w[nt>>2]|mt,w[yn+4>>2]=Vt,yn=0,Ve=kt,yn|0);for(w[G>>2]=w[T>>2],w[G+4>>2]=w[T+4>>2],w[G+8>>2]=w[T+8>>2];w[Z>>2]=w[G>>2],w[Z+4>>2]=w[G+4>>2],w[Z+8>>2]=w[G+8>>2],Ua(j)|0?(T_(G),w[ae>>2]=w[G>>2],w[ae+4>>2]=w[G+4>>2],w[ae+8>>2]=w[G+8>>2],Zu(ae)):(lp(G),w[ae>>2]=w[G>>2],w[ae+4>>2]=w[G+4>>2],w[ae+8>>2]=w[G+8>>2],Ds(ae)),Ul(Z,ae,pe),li(pe),Vt=O,Cn=w[Vt>>2]|0,Vt=w[Vt+4>>2]|0,Rt=(15-j|0)*3|0,T=Dn(7,0,Rt|0)|0,Vt=Vt&~(Ke()|0),Rt=Dn(kf(pe)|0,0,Rt|0)|0,Vt=Ke()|0|Vt,yn=O,w[yn>>2]=Rt|Cn&~T,w[yn+4>>2]=Vt,(j|0)>1;)j=j+-1|0;e:do if((w[G>>2]|0)<=1&&(w[G+4>>2]|0)<=1&&(w[G+8>>2]|0)<=1){j=kf(G)|0,Z=op(nt,j)|0,(Z|0)==127?pe=0:pe=Lr(Z)|0;t:do if(j){if(_e){if(G=21408+((fs(y,x)|0)*28|0)+(j<<2)|0,G=w[G>>2]|0,(G|0)>0){T=0;do j=Gl(j)|0,T=T+1|0;while((T|0)!=(G|0))}if((j|0)==1){D=3;break e}T=op(nt,j)|0,(T|0)==127&&gt(23104,22949,376,23134),Lr(T)|0?gt(23147,22949,377,23134):(mt=G,Xe=j,D=T)}else mt=0,Xe=j,D=Z;if(ae=w[4304+(nt*28|0)+(Xe<<2)>>2]|0,(ae|0)<=-1&&gt(23178,22949,384,23134),!pe){if((mt|0)<=-1&&gt(23030,22949,417,23134),mt|0){G=O,j=0,T=w[G>>2]|0,G=w[G+4>>2]|0;do T=ws(T,G)|0,G=Ke()|0,Rt=O,w[Rt>>2]=T,w[Rt+4>>2]=G,j=j+1|0;while((j|0)<(mt|0))}if((ae|0)<=0){j=54;break}for(G=O,j=0,T=w[G>>2]|0,G=w[G+4>>2]|0;;)if(T=ws(T,G)|0,G=Ke()|0,Rt=O,w[Rt>>2]=T,w[Rt+4>>2]=G,j=j+1|0,(j|0)==(ae|0)){j=54;break t}}if(Z=sp(D,nt)|0,(Z|0)==7&&gt(22925,22949,393,23134),j=O,T=w[j>>2]|0,j=w[j+4>>2]|0,(ae|0)>0){G=0;do T=ws(T,j)|0,j=Ke()|0,Rt=O,w[Rt>>2]=T,w[Rt+4>>2]=j,G=G+1|0;while((G|0)!=(ae|0))}if(T=fs(T,j)|0,Rt=ao(D)|0,T=w[(Rt?21824:21616)+(Z*28|0)+(T<<2)>>2]|0,(T|0)<=-1&&gt(23030,22949,412,23134),!T)j=54;else{Z=O,j=0,G=w[Z>>2]|0,Z=w[Z+4>>2]|0;do G=gp(G,Z)|0,Z=Ke()|0,Rt=O,w[Rt>>2]=G,w[Rt+4>>2]=Z,j=j+1|0;while((j|0)<(T|0));j=54}}else if((_e|0)!=0&(pe|0)!=0)if(Rt=fs(y,x)|0,j=O,j=21408+(Rt*28|0)+((fs(w[j>>2]|0,w[j+4>>2]|0)|0)<<2)|0,j=w[j>>2]|0,(j|0)<=-1&&gt(23201,22949,433,23134),!j)D=Z,j=55;else{G=O,D=0,T=w[G>>2]|0,G=w[G+4>>2]|0;do T=ws(T,G)|0,G=Ke()|0,Rt=O,w[Rt>>2]=T,w[Rt+4>>2]=G,D=D+1|0;while((D|0)<(j|0));D=Z,j=54}else D=Z,j=54;while(0);if((j|0)==54&&pe&&(j=55),(j|0)==55&&(Rt=O,(fs(w[Rt>>2]|0,w[Rt+4>>2]|0)|0)==1)){D=4;break}Rt=O,yn=w[Rt>>2]|0,Rt=w[Rt+4>>2]&-1040385,Cn=Dn(D|0,0,45)|0,Rt=Rt|(Ke()|0),D=O,w[D>>2]=yn|Cn,w[D+4>>2]=Rt,D=0}else D=2;while(0);return Rt=D,Ve=kt,Rt|0}function N_(y,x,T,O,D){y=y|0,x=x|0,T=T|0,O=O|0,D=D|0;var j=0,G=0;return G=Ve,Ve=Ve+16|0,j=G,y=ga(y,x,T,O,j)|0,y||(C_(j,D),y=0),Ve=G,y|0}function Yu(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0;var D=0,j=0;return D=Ve,Ve=Ve+16|0,j=D,Og(T,j),O=UA(y,x,j,O)|0,Ve=D,O|0}function Vg(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0;var D=0,j=0,G=0;return G=Ve,Ve=Ve+32|0,D=G+12|0,j=G,!(ga(y,x,y,x,D)|0)&&!(ga(y,x,T,O,j)|0)?y=Uf(D,j)|0:y=-1,Ve=G,y|0}function sl(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0;var D=0,j=0,G=0;return G=Ve,Ve=Ve+32|0,D=G+12|0,j=G,!(ga(y,x,y,x,D)|0)&&!(ga(y,x,T,O,j)|0)?y=Uf(D,j)|0:y=-1,Ve=G,(y>>>31^1)+y|0}function vp(y,x,T,O,D){y=y|0,x=x|0,T=T|0,O=O|0,D=D|0;var j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0,Vt=0,yn=0,Cn=0,Rt=0,fn=0,ot=0,On=0,Bn=0;if(On=Ve,Ve=Ve+48|0,j=On+24|0,G=On+12|0,ot=On,!(ga(y,x,y,x,j)|0)&&!(ga(y,x,T,O,G)|0)){if(fn=Uf(j,G)|0,(fn|0)<0)return ot=fn,Ve=On,ot|0;for(w[j>>2]=0,w[j+4>>2]=0,w[j+8>>2]=0,w[G>>2]=0,w[G+4>>2]=0,w[G+8>>2]=0,ga(y,x,y,x,j)|0,ga(y,x,T,O,G)|0,Rg(j),Rg(G),fn?(_e=w[j>>2]|0,mt=+(fn|0),yn=j+4|0,Xe=w[yn>>2]|0,Cn=j+8|0,nt=w[Cn>>2]|0,Rt=j,T=_e,O=Xe,j=nt,kt=+((w[G>>2]|0)-_e|0)/mt,Vt=+((w[G+4>>2]|0)-Xe|0)/mt,mt=+((w[G+8>>2]|0)-nt|0)/mt):(O=j+4|0,nt=j+8|0,yn=O,Cn=nt,Rt=j,T=w[j>>2]|0,O=w[O>>2]|0,j=w[nt>>2]|0,kt=0,Vt=0,mt=0),w[ot>>2]=T,nt=ot+4|0,w[nt>>2]=O,Xe=ot+8|0,w[Xe>>2]=j,_e=0;;){ae=+(_e|0),Bn=kt*ae+ +(T|0),Z=Vt*ae+ +(w[yn>>2]|0),ae=mt*ae+ +(w[Cn>>2]|0),O=~~+Jh(+Bn),G=~~+Jh(+Z),T=~~+Jh(+ae),Bn=+rr(+(+(O|0)-Bn)),Z=+rr(+(+(G|0)-Z)),ae=+rr(+(+(T|0)-ae));do if(Bn>Z&Bn>ae)O=0-(G+T)|0,j=G;else if(pe=0-O|0,Z>ae){j=pe-T|0;break}else{j=G,T=pe-G|0;break}while(0);if(w[ot>>2]=O,w[nt>>2]=j,w[Xe>>2]=T,TA(ot),UA(y,x,ot,D+(_e<<3)|0)|0,(_e|0)==(fn|0))break;_e=_e+1|0,T=w[Rt>>2]|0}return ot=0,Ve=On,ot|0}return ot=-1,Ve=On,ot|0}function xp(y,x){y=y|0,x=x|0;var T=0;if(!x)return T=1,T|0;T=y,y=1;do y=Bo(x&1|0?T:1,y)|0,x=x>>1,T=Bo(T,T)|0;while(x|0);return y|0}function Gc(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0;if(!(Wh(x,T)|0)||(x=EA(x)|0,nt=+Ue[T>>3],O=+Ue[T+8>>3],O=x&O<0?O+6.283185307179586:O,Xe=w[y>>2]|0,(Xe|0)<=0))return Xe=0,Xe|0;if(_e=w[y+4>>2]|0,x){x=0,T=-1,y=0;e:for(;;){for(pe=y;G=+Ue[_e+(pe<<4)>>3],ae=+Ue[_e+(pe<<4)+8>>3],y=(T+2|0)%(Xe|0)|0,j=+Ue[_e+(y<<4)>>3],D=+Ue[_e+(y<<4)+8>>3],G>j?(Z=G,G=ae):(Z=j,j=G,G=D,D=ae),!!(nt<j|nt>Z);)if(T=pe+1|0,(T|0)<(Xe|0))y=pe,pe=T,T=y;else{T=22;break e}if(ae=D<0?D+6.283185307179586:D,G=G<0?G+6.283185307179586:G,O=G==O|ae==O?O+-2220446049250313e-31:O,ae=ae+(nt-j)/(Z-j)*(G-ae),(ae<0?ae+6.283185307179586:ae)>O&&(x=x^1),y=pe+1|0,(y|0)>=(Xe|0)){T=22;break}else T=pe}if((T|0)==22)return x|0}else{x=0,T=-1,y=0;e:for(;;){for(pe=y;G=+Ue[_e+(pe<<4)>>3],ae=+Ue[_e+(pe<<4)+8>>3],y=(T+2|0)%(Xe|0)|0,j=+Ue[_e+(y<<4)>>3],D=+Ue[_e+(y<<4)+8>>3],G>j?(Z=G,G=ae):(Z=j,j=G,G=D,D=ae),!!(nt<j|nt>Z);)if(T=pe+1|0,(T|0)<(Xe|0))y=pe,pe=T,T=y;else{T=22;break e}if(O=G==O|D==O?O+-2220446049250313e-31:O,D+(nt-j)/(Z-j)*(G-D)>O&&(x=x^1),y=pe+1|0,(y|0)>=(Xe|0)){T=22;break}else T=pe}if((T|0)==22)return x|0}return 0}function jc(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0,Vt=0,yn=0,Cn=0,Rt=0;if(kt=w[y>>2]|0,!kt){w[x>>2]=0,w[x+4>>2]=0,w[x+8>>2]=0,w[x+12>>2]=0,w[x+16>>2]=0,w[x+20>>2]=0,w[x+24>>2]=0,w[x+28>>2]=0;return}if(Vt=x+8|0,Ue[Vt>>3]=17976931348623157e292,yn=x+24|0,Ue[yn>>3]=17976931348623157e292,Ue[x>>3]=-17976931348623157e292,Cn=x+16|0,Ue[Cn>>3]=-17976931348623157e292,!((kt|0)<=0)){for(nt=w[y+4>>2]|0,pe=17976931348623157e292,_e=-17976931348623157e292,Xe=0,y=-1,j=17976931348623157e292,G=17976931348623157e292,ae=-17976931348623157e292,O=-17976931348623157e292,mt=0;T=+Ue[nt+(mt<<4)>>3],Z=+Ue[nt+(mt<<4)+8>>3],y=y+2|0,D=+Ue[nt+(((y|0)==(kt|0)?0:y)<<4)+8>>3],T<j&&(Ue[Vt>>3]=T,j=T),Z<G&&(Ue[yn>>3]=Z,G=Z),T>ae?Ue[x>>3]=T:T=ae,Z>O&&(Ue[Cn>>3]=Z,O=Z),pe=Z>0&Z<pe?Z:pe,_e=Z<0&Z>_e?Z:_e,Xe=Xe|+rr(+(Z-D))>3.141592653589793,y=mt+1|0,(y|0)!=(kt|0);)Rt=mt,ae=T,mt=y,y=Rt;Xe&&(Ue[Cn>>3]=_e,Ue[yn>>3]=pe)}}function $g(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0,Vt=0,yn=0,Cn=0,Rt=0,fn=0,ot=0,On=0,Bn=0,Pn=0;if(kt=w[y>>2]|0,kt){if(Vt=x+8|0,Ue[Vt>>3]=17976931348623157e292,yn=x+24|0,Ue[yn>>3]=17976931348623157e292,Ue[x>>3]=-17976931348623157e292,Cn=x+16|0,Ue[Cn>>3]=-17976931348623157e292,(kt|0)>0){for(D=w[y+4>>2]|0,nt=17976931348623157e292,mt=-17976931348623157e292,O=0,T=-1,ae=17976931348623157e292,pe=17976931348623157e292,Xe=-17976931348623157e292,G=-17976931348623157e292,Rt=0;j=+Ue[D+(Rt<<4)>>3],_e=+Ue[D+(Rt<<4)+8>>3],Bn=T+2|0,Z=+Ue[D+(((Bn|0)==(kt|0)?0:Bn)<<4)+8>>3],j<ae&&(Ue[Vt>>3]=j,ae=j),_e<pe&&(Ue[yn>>3]=_e,pe=_e),j>Xe?Ue[x>>3]=j:j=Xe,_e>G&&(Ue[Cn>>3]=_e,G=_e),nt=_e>0&_e<nt?_e:nt,mt=_e<0&_e>mt?_e:mt,O=O|+rr(+(_e-Z))>3.141592653589793,T=Rt+1|0,(T|0)!=(kt|0);)Bn=Rt,Xe=j,Rt=T,T=Bn;O&&(Ue[Cn>>3]=mt,Ue[yn>>3]=nt)}}else w[x>>2]=0,w[x+4>>2]=0,w[x+8>>2]=0,w[x+12>>2]=0,w[x+16>>2]=0,w[x+20>>2]=0,w[x+24>>2]=0,w[x+28>>2]=0;if(Bn=y+8|0,T=w[Bn>>2]|0,!((T|0)<=0)){On=y+12|0,ot=0;do if(D=w[On>>2]|0,O=ot,ot=ot+1|0,yn=x+(ot<<5)|0,Cn=w[D+(O<<3)>>2]|0,Cn){if(Rt=x+(ot<<5)+8|0,Ue[Rt>>3]=17976931348623157e292,y=x+(ot<<5)+24|0,Ue[y>>3]=17976931348623157e292,Ue[yn>>3]=-17976931348623157e292,fn=x+(ot<<5)+16|0,Ue[fn>>3]=-17976931348623157e292,(Cn|0)>0){for(kt=w[D+(O<<3)+4>>2]|0,nt=17976931348623157e292,mt=-17976931348623157e292,D=0,O=-1,Vt=0,ae=17976931348623157e292,pe=17976931348623157e292,_e=-17976931348623157e292,G=-17976931348623157e292;j=+Ue[kt+(Vt<<4)>>3],Xe=+Ue[kt+(Vt<<4)+8>>3],O=O+2|0,Z=+Ue[kt+(((O|0)==(Cn|0)?0:O)<<4)+8>>3],j<ae&&(Ue[Rt>>3]=j,ae=j),Xe<pe&&(Ue[y>>3]=Xe,pe=Xe),j>_e?Ue[yn>>3]=j:j=_e,Xe>G&&(Ue[fn>>3]=Xe,G=Xe),nt=Xe>0&Xe<nt?Xe:nt,mt=Xe<0&Xe>mt?Xe:mt,D=D|+rr(+(Xe-Z))>3.141592653589793,O=Vt+1|0,(O|0)!=(Cn|0);)Pn=Vt,Vt=O,_e=j,O=Pn;D&&(Ue[fn>>3]=mt,Ue[y>>3]=nt)}}else w[yn>>2]=0,w[yn+4>>2]=0,w[yn+8>>2]=0,w[yn+12>>2]=0,w[yn+16>>2]=0,w[yn+20>>2]=0,w[yn+24>>2]=0,w[yn+28>>2]=0,T=w[Bn>>2]|0;while((ot|0)<(T|0))}}function Hg(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0;if(!(Gc(y,x,T)|0))return D=0,D|0;if(D=y+8|0,(w[D>>2]|0)<=0)return D=1,D|0;for(O=y+12|0,y=0;;){if(j=y,y=y+1|0,Gc((w[O>>2]|0)+(j<<3)|0,x+(y<<5)|0,T)|0){y=0,O=6;break}if((y|0)>=(w[D>>2]|0)){y=1,O=6;break}}return(O|0)==6?y|0:0}function Xr(){return 8}function bp(){return 16}function F_(){return 168}function Wg(){return 8}function Yh(){return 16}function k_(){return 12}function qg(){return 8}function Qu(y){y=y|0;var x=0,T=0;return T=+Ue[y>>3],x=+Ue[y+8>>3],+ +Tr(+(T*T+x*x))}function GA(y,x,T,O,D){y=y|0,x=x|0,T=T|0,O=O|0,D=D|0;var j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0;pe=+Ue[y>>3],ae=+Ue[x>>3]-pe,Z=+Ue[y+8>>3],G=+Ue[x+8>>3]-Z,Xe=+Ue[T>>3],j=+Ue[O>>3]-Xe,nt=+Ue[T+8>>3],_e=+Ue[O+8>>3]-nt,j=(j*(Z-nt)-(pe-Xe)*_e)/(ae*_e-G*j),Ue[D>>3]=pe+ae*j,Ue[D+8>>3]=Z+G*j}function wp(y,x){return y=y|0,x=x|0,+Ue[y>>3]!=+Ue[x>>3]?(x=0,x|0):(x=+Ue[y+8>>3]==+Ue[x+8>>3],x|0)}function Zi(y,x){y=y|0,x=x|0;var T=0,O=0,D=0;return D=+Ue[y>>3]-+Ue[x>>3],O=+Ue[y+8>>3]-+Ue[x+8>>3],T=+Ue[y+16>>3]-+Ue[x+16>>3],+(D*D+O*O+T*T)}function Qh(y,x){y=y|0,x=x|0;var T=0,O=0,D=0;T=+Ue[y>>3],O=+qr(+T),T=+jn(+T),Ue[x+16>>3]=T,T=+Ue[y+8>>3],D=O*+qr(+T),Ue[x>>3]=D,T=O*+jn(+T),Ue[x+8>>3]=T}function jA(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0;if(pe=Ve,Ve=Ve+32|0,D=pe+16|0,j=pe,Hf(y,x,D),G=O_(y,x)|0,ae=fs(y,x)|0,Hh(G,j),x=ha(G,w[D>>2]|0)|0,!(Lr(G)|0))return ae=x,Ve=pe,ae|0;do switch(G|0){case 4:{y=0,T=14;break}case 14:{y=1,T=14;break}case 24:{y=2,T=14;break}case 38:{y=3,T=14;break}case 49:{y=4,T=14;break}case 58:{y=5,T=14;break}case 63:{y=6,T=14;break}case 72:{y=7,T=14;break}case 83:{y=8,T=14;break}case 97:{y=9,T=14;break}case 107:{y=10,T=14;break}case 117:{y=11,T=14;break}default:Z=0,O=0}while(0);return(T|0)==14&&(Z=w[22096+(y*24|0)+8>>2]|0,O=w[22096+(y*24|0)+16>>2]|0),y=w[D>>2]|0,(y|0)!=(w[j>>2]|0)&&(G=ao(G)|0,y=w[D>>2]|0,G|(y|0)==(O|0)&&(x=(x+1|0)%6|0)),(ae|0)==3&(y|0)==(O|0)?(ae=(x+5|0)%6|0,Ve=pe,ae|0):(ae|0)==5&(y|0)==(Z|0)?(ae=(x+1|0)%6|0,Ve=pe,ae|0):(ae=x,Ve=pe,ae|0)}function Ep(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0;return O=No(y,x)|0,(T+-1|0)>>>0>5||(D=(O|0)!=0,(T|0)==1&D)?(T=-1,T|0):(O=jA(y,x)|0,D?(T=(5-O+(w[22384+(T<<2)>>2]|0)|0)%5|0,T|0):(T=(6-O+(w[22416+(T<<2)>>2]|0)|0)%6|0,T|0))}function Kh(y,x,T){y=y|0,x=x|0,T=T|0;var O=0;(x|0)>0?(O=ma(x,4)|0,w[y>>2]=O,O||gt(23230,23253,40,23267)):w[y>>2]=0,w[y+4>>2]=x,w[y+8>>2]=0,w[y+12>>2]=T}function Sp(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0;D=y+4|0,j=y+12|0,G=y+8|0;e:for(;;){for(T=w[D>>2]|0,x=0;;){if((x|0)>=(T|0))break e;if(O=w[y>>2]|0,Z=w[O+(x<<2)>>2]|0,!Z)x=x+1|0;else break}x=O+(~~(+rr(+(+qi(10,+ +(15-(w[j>>2]|0)|0))*(+Ue[Z>>3]+ +Ue[Z+8>>3])))%+(T|0))>>>0<<2)|0,T=w[x>>2]|0;t:do if(T|0){if(O=Z+32|0,(T|0)==(Z|0))w[x>>2]=w[O>>2];else{if(T=T+32|0,x=w[T>>2]|0,!x)break;for(;(x|0)!=(Z|0);)if(T=x+32|0,x=w[T>>2]|0,!x)break t;w[T>>2]=w[O>>2]}Mr(Z),w[G>>2]=(w[G>>2]|0)+-1}while(0)}Mr(w[y>>2]|0)}function Tp(y){y=y|0;var x=0,T=0,O=0;for(O=w[y+4>>2]|0,T=0;;){if((T|0)>=(O|0)){x=0,T=4;break}if(x=w[(w[y>>2]|0)+(T<<2)>>2]|0,!x)T=T+1|0;else{T=4;break}}return(T|0)==4?x|0:0}function Sn(y,x){y=y|0,x=x|0;var T=0,O=0,D=0,j=0;if(T=~~(+rr(+(+qi(10,+ +(15-(w[y+12>>2]|0)|0))*(+Ue[x>>3]+ +Ue[x+8>>3])))%+(w[y+4>>2]|0))>>>0,T=(w[y>>2]|0)+(T<<2)|0,O=w[T>>2]|0,!O)return j=1,j|0;j=x+32|0;do if((O|0)!=(x|0)){if(T=w[O+32>>2]|0,!T)return j=1,j|0;for(D=T;;){if((D|0)==(x|0)){D=8;break}if(T=w[D+32>>2]|0,T)O=D,D=T;else{T=1,D=10;break}}if((D|0)==8){w[O+32>>2]=w[j>>2];break}else if((D|0)==10)return T|0}else w[T>>2]=w[j>>2];while(0);return Mr(x),j=y+8|0,w[j>>2]=(w[j>>2]|0)+-1,j=0,j|0}function Vl(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0;j=Ga(40)|0,j||gt(23283,23253,98,23296),w[j>>2]=w[x>>2],w[j+4>>2]=w[x+4>>2],w[j+8>>2]=w[x+8>>2],w[j+12>>2]=w[x+12>>2],D=j+16|0,w[D>>2]=w[T>>2],w[D+4>>2]=w[T+4>>2],w[D+8>>2]=w[T+8>>2],w[D+12>>2]=w[T+12>>2],w[j+32>>2]=0,D=~~(+rr(+(+qi(10,+ +(15-(w[y+12>>2]|0)|0))*(+Ue[x>>3]+ +Ue[x+8>>3])))%+(w[y+4>>2]|0))>>>0,D=(w[y>>2]|0)+(D<<2)|0,O=w[D>>2]|0;do if(!O)w[D>>2]=j;else{for(;!(pa(O,x)|0&&pa(O+16|0,T)|0);)if(D=w[O+32>>2]|0,O=D|0?D:O,!(w[O+32>>2]|0)){G=10;break}if((G|0)==10){w[O+32>>2]=j;break}return Mr(j),G=O,G|0}while(0);return G=y+8|0,w[G>>2]=(w[G>>2]|0)+1,G=j,G|0}function z_(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0;if(D=~~(+rr(+(+qi(10,+ +(15-(w[y+12>>2]|0)|0))*(+Ue[x>>3]+ +Ue[x+8>>3])))%+(w[y+4>>2]|0))>>>0,D=w[(w[y>>2]|0)+(D<<2)>>2]|0,!D)return T=0,T|0;if(!T){for(y=D;;){if(pa(y,x)|0){O=10;break}if(y=w[y+32>>2]|0,!y){y=0,O=10;break}}if((O|0)==10)return y|0}for(y=D;;){if(pa(y,x)|0&&pa(y+16|0,T)|0){O=10;break}if(y=w[y+32>>2]|0,!y){y=0,O=10;break}}return(O|0)==10?y|0:0}function Cp(y,x){y=y|0,x=x|0;var T=0;if(T=~~(+rr(+(+qi(10,+ +(15-(w[y+12>>2]|0)|0))*(+Ue[x>>3]+ +Ue[x+8>>3])))%+(w[y+4>>2]|0))>>>0,y=w[(w[y>>2]|0)+(T<<2)>>2]|0,!y)return T=0,T|0;for(;;){if(pa(y,x)|0){x=5;break}if(y=w[y+32>>2]|0,!y){y=0,x=5;break}}return(x|0)==5?y|0:0}function Pp(){return 23312}function hs(y){return y=+y,+ +td(+y)}function Vc(y){return y=+y,~~+hs(y)|0}function Ga(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0,Vt=0,yn=0,Cn=0,Rt=0,fn=0,ot=0,On=0;On=Ve,Ve=Ve+16|0,nt=On;do if(y>>>0<245){if(pe=y>>>0<11?16:y+11&-8,y=pe>>>3,Xe=w[5829]|0,T=Xe>>>y,T&3|0)return x=(T&1^1)+y|0,y=23356+(x<<1<<2)|0,T=y+8|0,O=w[T>>2]|0,D=O+8|0,j=w[D>>2]|0,(j|0)==(y|0)?w[5829]=Xe&~(1<<x):(w[j+12>>2]=y,w[T>>2]=j),ot=x<<3,w[O+4>>2]=ot|3,ot=O+ot+4|0,w[ot>>2]=w[ot>>2]|1,ot=D,Ve=On,ot|0;if(_e=w[5831]|0,pe>>>0>_e>>>0){if(T|0)return x=2<<y,x=T<<y&(x|0-x),x=(x&0-x)+-1|0,Z=x>>>12&16,x=x>>>Z,T=x>>>5&8,x=x>>>T,j=x>>>2&4,x=x>>>j,y=x>>>1&2,x=x>>>y,O=x>>>1&1,O=(T|Z|j|y|O)+(x>>>O)|0,x=23356+(O<<1<<2)|0,y=x+8|0,j=w[y>>2]|0,Z=j+8|0,T=w[Z>>2]|0,(T|0)==(x|0)?(y=Xe&~(1<<O),w[5829]=y):(w[T+12>>2]=x,w[y>>2]=T,y=Xe),ot=O<<3,G=ot-pe|0,w[j+4>>2]=pe|3,D=j+pe|0,w[D+4>>2]=G|1,w[j+ot>>2]=G,_e|0&&(O=w[5834]|0,x=_e>>>3,T=23356+(x<<1<<2)|0,x=1<<x,y&x?(y=T+8|0,x=w[y>>2]|0):(w[5829]=y|x,x=T,y=T+8|0),w[y>>2]=O,w[x+12>>2]=O,w[O+8>>2]=x,w[O+12>>2]=T),w[5831]=G,w[5834]=D,ot=Z,Ve=On,ot|0;if(j=w[5830]|0,j){for(T=(j&0-j)+-1|0,D=T>>>12&16,T=T>>>D,O=T>>>5&8,T=T>>>O,G=T>>>2&4,T=T>>>G,Z=T>>>1&2,T=T>>>Z,ae=T>>>1&1,ae=w[23620+((O|D|G|Z|ae)+(T>>>ae)<<2)>>2]|0,T=ae,Z=ae,ae=(w[ae+4>>2]&-8)-pe|0;y=w[T+16>>2]|0,!(!y&&(y=w[T+20>>2]|0,!y));)G=(w[y+4>>2]&-8)-pe|0,D=G>>>0<ae>>>0,T=y,Z=D?y:Z,ae=D?G:ae;if(G=Z+pe|0,G>>>0>Z>>>0){D=w[Z+24>>2]|0,x=w[Z+12>>2]|0;do if((x|0)==(Z|0)){if(y=Z+20|0,x=w[y>>2]|0,!x&&(y=Z+16|0,x=w[y>>2]|0,!x)){T=0;break}for(;;)if(O=x+20|0,T=w[O>>2]|0,T)x=T,y=O;else if(O=x+16|0,T=w[O>>2]|0,T)x=T,y=O;else break;w[y>>2]=0,T=x}else T=w[Z+8>>2]|0,w[T+12>>2]=x,w[x+8>>2]=T,T=x;while(0);do if(D|0){if(x=w[Z+28>>2]|0,y=23620+(x<<2)|0,(Z|0)==(w[y>>2]|0)){if(w[y>>2]=T,!T){w[5830]=j&~(1<<x);break}}else if(ot=D+16|0,w[((w[ot>>2]|0)==(Z|0)?ot:D+20|0)>>2]=T,!T)break;w[T+24>>2]=D,x=w[Z+16>>2]|0,x|0&&(w[T+16>>2]=x,w[x+24>>2]=T),x=w[Z+20>>2]|0,x|0&&(w[T+20>>2]=x,w[x+24>>2]=T)}while(0);return ae>>>0<16?(ot=ae+pe|0,w[Z+4>>2]=ot|3,ot=Z+ot+4|0,w[ot>>2]=w[ot>>2]|1):(w[Z+4>>2]=pe|3,w[G+4>>2]=ae|1,w[G+ae>>2]=ae,_e|0&&(O=w[5834]|0,x=_e>>>3,T=23356+(x<<1<<2)|0,x=1<<x,x&Xe?(y=T+8|0,x=w[y>>2]|0):(w[5829]=x|Xe,x=T,y=T+8|0),w[y>>2]=O,w[x+12>>2]=O,w[O+8>>2]=x,w[O+12>>2]=T),w[5831]=ae,w[5834]=G),ot=Z+8|0,Ve=On,ot|0}else Xe=pe}else Xe=pe}else Xe=pe}else if(y>>>0<=4294967231)if(y=y+11|0,pe=y&-8,O=w[5830]|0,O){D=0-pe|0,y=y>>>8,y?pe>>>0>16777215?ae=31:(Xe=(y+1048320|0)>>>16&8,Vt=y<<Xe,Z=(Vt+520192|0)>>>16&4,Vt=Vt<<Z,ae=(Vt+245760|0)>>>16&2,ae=14-(Z|Xe|ae)+(Vt<<ae>>>15)|0,ae=pe>>>(ae+7|0)&1|ae<<1):ae=0,T=w[23620+(ae<<2)>>2]|0;e:do if(!T)T=0,y=0,Vt=61;else for(y=0,Z=pe<<((ae|0)==31?0:25-(ae>>>1)|0),j=0;;){if(G=(w[T+4>>2]&-8)-pe|0,G>>>0<D>>>0)if(G)y=T,D=G;else{y=T,D=0,Vt=65;break e}if(Vt=w[T+20>>2]|0,T=w[T+16+(Z>>>31<<2)>>2]|0,j=(Vt|0)==0|(Vt|0)==(T|0)?j:Vt,T)Z=Z<<1;else{T=j,Vt=61;break}}while(0);if((Vt|0)==61){if((T|0)==0&(y|0)==0){if(y=2<<ae,y=(y|0-y)&O,!y){Xe=pe;break}Xe=(y&0-y)+-1|0,G=Xe>>>12&16,Xe=Xe>>>G,j=Xe>>>5&8,Xe=Xe>>>j,Z=Xe>>>2&4,Xe=Xe>>>Z,ae=Xe>>>1&2,Xe=Xe>>>ae,T=Xe>>>1&1,y=0,T=w[23620+((j|G|Z|ae|T)+(Xe>>>T)<<2)>>2]|0}T?Vt=65:(Z=y,G=D)}if((Vt|0)==65)for(j=T;;)if(Xe=(w[j+4>>2]&-8)-pe|0,T=Xe>>>0<D>>>0,D=T?Xe:D,y=T?j:y,T=w[j+16>>2]|0,T||(T=w[j+20>>2]|0),T)j=T;else{Z=y,G=D;break}if(Z|0&&G>>>0<((w[5831]|0)-pe|0)>>>0&&(_e=Z+pe|0,_e>>>0>Z>>>0)){j=w[Z+24>>2]|0,x=w[Z+12>>2]|0;do if((x|0)==(Z|0)){if(y=Z+20|0,x=w[y>>2]|0,!x&&(y=Z+16|0,x=w[y>>2]|0,!x)){x=0;break}for(;;)if(D=x+20|0,T=w[D>>2]|0,T)x=T,y=D;else if(D=x+16|0,T=w[D>>2]|0,T)x=T,y=D;else break;w[y>>2]=0}else ot=w[Z+8>>2]|0,w[ot+12>>2]=x,w[x+8>>2]=ot;while(0);do if(j){if(y=w[Z+28>>2]|0,T=23620+(y<<2)|0,(Z|0)==(w[T>>2]|0)){if(w[T>>2]=x,!x){O=O&~(1<<y),w[5830]=O;break}}else if(ot=j+16|0,w[((w[ot>>2]|0)==(Z|0)?ot:j+20|0)>>2]=x,!x)break;w[x+24>>2]=j,y=w[Z+16>>2]|0,y|0&&(w[x+16>>2]=y,w[y+24>>2]=x),y=w[Z+20>>2]|0,y&&(w[x+20>>2]=y,w[y+24>>2]=x)}while(0);e:do if(G>>>0<16)ot=G+pe|0,w[Z+4>>2]=ot|3,ot=Z+ot+4|0,w[ot>>2]=w[ot>>2]|1;else{if(w[Z+4>>2]=pe|3,w[_e+4>>2]=G|1,w[_e+G>>2]=G,x=G>>>3,G>>>0<256){T=23356+(x<<1<<2)|0,y=w[5829]|0,x=1<<x,y&x?(y=T+8|0,x=w[y>>2]|0):(w[5829]=y|x,x=T,y=T+8|0),w[y>>2]=_e,w[x+12>>2]=_e,w[_e+8>>2]=x,w[_e+12>>2]=T;break}if(x=G>>>8,x?G>>>0>16777215?T=31:(fn=(x+1048320|0)>>>16&8,ot=x<<fn,Rt=(ot+520192|0)>>>16&4,ot=ot<<Rt,T=(ot+245760|0)>>>16&2,T=14-(Rt|fn|T)+(ot<<T>>>15)|0,T=G>>>(T+7|0)&1|T<<1):T=0,x=23620+(T<<2)|0,w[_e+28>>2]=T,y=_e+16|0,w[y+4>>2]=0,w[y>>2]=0,y=1<<T,!(O&y)){w[5830]=O|y,w[x>>2]=_e,w[_e+24>>2]=x,w[_e+12>>2]=_e,w[_e+8>>2]=_e;break}x=w[x>>2]|0;t:do if((w[x+4>>2]&-8|0)!=(G|0)){for(O=G<<((T|0)==31?0:25-(T>>>1)|0);T=x+16+(O>>>31<<2)|0,y=w[T>>2]|0,!!y;)if((w[y+4>>2]&-8|0)==(G|0)){x=y;break t}else O=O<<1,x=y;w[T>>2]=_e,w[_e+24>>2]=x,w[_e+12>>2]=_e,w[_e+8>>2]=_e;break e}while(0);fn=x+8|0,ot=w[fn>>2]|0,w[ot+12>>2]=_e,w[fn>>2]=_e,w[_e+8>>2]=ot,w[_e+12>>2]=x,w[_e+24>>2]=0}while(0);return ot=Z+8|0,Ve=On,ot|0}else Xe=pe}else Xe=pe;else Xe=-1;while(0);if(T=w[5831]|0,T>>>0>=Xe>>>0)return x=T-Xe|0,y=w[5834]|0,x>>>0>15?(ot=y+Xe|0,w[5834]=ot,w[5831]=x,w[ot+4>>2]=x|1,w[y+T>>2]=x,w[y+4>>2]=Xe|3):(w[5831]=0,w[5834]=0,w[y+4>>2]=T|3,ot=y+T+4|0,w[ot>>2]=w[ot>>2]|1),ot=y+8|0,Ve=On,ot|0;if(G=w[5832]|0,G>>>0>Xe>>>0)return Rt=G-Xe|0,w[5832]=Rt,ot=w[5835]|0,fn=ot+Xe|0,w[5835]=fn,w[fn+4>>2]=Rt|1,w[ot+4>>2]=Xe|3,ot=ot+8|0,Ve=On,ot|0;if(w[5947]|0?y=w[5949]|0:(w[5949]=4096,w[5948]=4096,w[5950]=-1,w[5951]=-1,w[5952]=0,w[5940]=0,w[5947]=nt&-16^1431655768,y=4096),Z=Xe+48|0,ae=Xe+47|0,j=y+ae|0,D=0-y|0,pe=j&D,pe>>>0<=Xe>>>0||(y=w[5939]|0,y|0&&(_e=w[5937]|0,nt=_e+pe|0,nt>>>0<=_e>>>0|nt>>>0>y>>>0)))return ot=0,Ve=On,ot|0;e:do if(w[5940]&4)x=0,Vt=143;else{T=w[5835]|0;t:do if(T){for(O=23764;nt=w[O>>2]|0,!(nt>>>0<=T>>>0&&(nt+(w[O+4>>2]|0)|0)>>>0>T>>>0);)if(y=w[O+8>>2]|0,y)O=y;else{Vt=128;break t}if(x=j-G&D,x>>>0<2147483647)if(y=al(x|0)|0,(y|0)==((w[O>>2]|0)+(w[O+4>>2]|0)|0)){if((y|0)!=-1){G=x,j=y,Vt=145;break e}}else O=y,Vt=136;else x=0}else Vt=128;while(0);do if((Vt|0)==128)if(T=al(0)|0,(T|0)!=-1&&(x=T,mt=w[5948]|0,kt=mt+-1|0,x=(kt&x|0?(kt+x&0-mt)-x|0:0)+pe|0,mt=w[5937]|0,kt=x+mt|0,x>>>0>Xe>>>0&x>>>0<2147483647)){if(nt=w[5939]|0,nt|0&&kt>>>0<=mt>>>0|kt>>>0>nt>>>0){x=0;break}if(y=al(x|0)|0,(y|0)==(T|0)){G=x,j=T,Vt=145;break e}else O=y,Vt=136}else x=0;while(0);do if((Vt|0)==136){if(T=0-x|0,!(Z>>>0>x>>>0&(x>>>0<2147483647&(O|0)!=-1)))if((O|0)==-1){x=0;break}else{G=x,j=O,Vt=145;break e}if(y=w[5949]|0,y=ae-x+y&0-y,y>>>0>=2147483647){G=x,j=O,Vt=145;break e}if((al(y|0)|0)==-1){al(T|0)|0,x=0;break}else{G=y+x|0,j=O,Vt=145;break e}}while(0);w[5940]=w[5940]|4,Vt=143}while(0);if((Vt|0)==143&&pe>>>0<2147483647&&(Rt=al(pe|0)|0,kt=al(0)|0,yn=kt-Rt|0,Cn=yn>>>0>(Xe+40|0)>>>0,!((Rt|0)==-1|Cn^1|Rt>>>0<kt>>>0&((Rt|0)!=-1&(kt|0)!=-1)^1))&&(G=Cn?yn:x,j=Rt,Vt=145),(Vt|0)==145){x=(w[5937]|0)+G|0,w[5937]=x,x>>>0>(w[5938]|0)>>>0&&(w[5938]=x),ae=w[5835]|0;e:do if(ae){for(x=23764;;){if(y=w[x>>2]|0,T=w[x+4>>2]|0,(j|0)==(y+T|0)){Vt=154;break}if(O=w[x+8>>2]|0,O)x=O;else break}if((Vt|0)==154&&(fn=x+4|0,(w[x+12>>2]&8|0)==0)&&j>>>0>ae>>>0&y>>>0<=ae>>>0){w[fn>>2]=T+G,ot=(w[5832]|0)+G|0,Rt=ae+8|0,Rt=Rt&7|0?0-Rt&7:0,fn=ae+Rt|0,Rt=ot-Rt|0,w[5835]=fn,w[5832]=Rt,w[fn+4>>2]=Rt|1,w[ae+ot+4>>2]=40,w[5836]=w[5951];break}for(j>>>0<(w[5833]|0)>>>0&&(w[5833]=j),T=j+G|0,x=23764;;){if((w[x>>2]|0)==(T|0)){Vt=162;break}if(y=w[x+8>>2]|0,y)x=y;else break}if((Vt|0)==162&&!(w[x+12>>2]&8|0)){w[x>>2]=j,_e=x+4|0,w[_e>>2]=(w[_e>>2]|0)+G,_e=j+8|0,_e=j+(_e&7|0?0-_e&7:0)|0,x=T+8|0,x=T+(x&7|0?0-x&7:0)|0,pe=_e+Xe|0,Z=x-_e-Xe|0,w[_e+4>>2]=Xe|3;t:do if((ae|0)==(x|0))ot=(w[5832]|0)+Z|0,w[5832]=ot,w[5835]=pe,w[pe+4>>2]=ot|1;else{if((w[5834]|0)==(x|0)){ot=(w[5831]|0)+Z|0,w[5831]=ot,w[5834]=pe,w[pe+4>>2]=ot|1,w[pe+ot>>2]=ot;break}if(y=w[x+4>>2]|0,(y&3|0)==1){G=y&-8,O=y>>>3;n:do if(y>>>0<256)if(y=w[x+8>>2]|0,T=w[x+12>>2]|0,(T|0)==(y|0)){w[5829]=w[5829]&~(1<<O);break}else{w[y+12>>2]=T,w[T+8>>2]=y;break}else{j=w[x+24>>2]|0,y=w[x+12>>2]|0;do if((y|0)==(x|0)){if(T=x+16|0,O=T+4|0,y=w[O>>2]|0,y)T=O;else if(y=w[T>>2]|0,!y){y=0;break}for(;;)if(D=y+20|0,O=w[D>>2]|0,O)y=O,T=D;else if(D=y+16|0,O=w[D>>2]|0,O)y=O,T=D;else break;w[T>>2]=0}else ot=w[x+8>>2]|0,w[ot+12>>2]=y,w[y+8>>2]=ot;while(0);if(!j)break;T=w[x+28>>2]|0,O=23620+(T<<2)|0;do if((w[O>>2]|0)!=(x|0)){if(ot=j+16|0,w[((w[ot>>2]|0)==(x|0)?ot:j+20|0)>>2]=y,!y)break n}else{if(w[O>>2]=y,y|0)break;w[5830]=w[5830]&~(1<<T);break n}while(0);if(w[y+24>>2]=j,T=x+16|0,O=w[T>>2]|0,O|0&&(w[y+16>>2]=O,w[O+24>>2]=y),T=w[T+4>>2]|0,!T)break;w[y+20>>2]=T,w[T+24>>2]=y}while(0);x=x+G|0,D=G+Z|0}else D=Z;if(x=x+4|0,w[x>>2]=w[x>>2]&-2,w[pe+4>>2]=D|1,w[pe+D>>2]=D,x=D>>>3,D>>>0<256){T=23356+(x<<1<<2)|0,y=w[5829]|0,x=1<<x,y&x?(y=T+8|0,x=w[y>>2]|0):(w[5829]=y|x,x=T,y=T+8|0),w[y>>2]=pe,w[x+12>>2]=pe,w[pe+8>>2]=x,w[pe+12>>2]=T;break}x=D>>>8;do if(!x)O=0;else{if(D>>>0>16777215){O=31;break}fn=(x+1048320|0)>>>16&8,ot=x<<fn,Rt=(ot+520192|0)>>>16&4,ot=ot<<Rt,O=(ot+245760|0)>>>16&2,O=14-(Rt|fn|O)+(ot<<O>>>15)|0,O=D>>>(O+7|0)&1|O<<1}while(0);if(x=23620+(O<<2)|0,w[pe+28>>2]=O,y=pe+16|0,w[y+4>>2]=0,w[y>>2]=0,y=w[5830]|0,T=1<<O,!(y&T)){w[5830]=y|T,w[x>>2]=pe,w[pe+24>>2]=x,w[pe+12>>2]=pe,w[pe+8>>2]=pe;break}x=w[x>>2]|0;n:do if((w[x+4>>2]&-8|0)!=(D|0)){for(O=D<<((O|0)==31?0:25-(O>>>1)|0);T=x+16+(O>>>31<<2)|0,y=w[T>>2]|0,!!y;)if((w[y+4>>2]&-8|0)==(D|0)){x=y;break n}else O=O<<1,x=y;w[T>>2]=pe,w[pe+24>>2]=x,w[pe+12>>2]=pe,w[pe+8>>2]=pe;break t}while(0);fn=x+8|0,ot=w[fn>>2]|0,w[ot+12>>2]=pe,w[fn>>2]=pe,w[pe+8>>2]=ot,w[pe+12>>2]=x,w[pe+24>>2]=0}while(0);return ot=_e+8|0,Ve=On,ot|0}for(x=23764;y=w[x>>2]|0,!(y>>>0<=ae>>>0&&(ot=y+(w[x+4>>2]|0)|0,ot>>>0>ae>>>0));)x=w[x+8>>2]|0;D=ot+-47|0,y=D+8|0,y=D+(y&7|0?0-y&7:0)|0,D=ae+16|0,y=y>>>0<D>>>0?ae:y,x=y+8|0,T=G+-40|0,Rt=j+8|0,Rt=Rt&7|0?0-Rt&7:0,fn=j+Rt|0,Rt=T-Rt|0,w[5835]=fn,w[5832]=Rt,w[fn+4>>2]=Rt|1,w[j+T+4>>2]=40,w[5836]=w[5951],T=y+4|0,w[T>>2]=27,w[x>>2]=w[5941],w[x+4>>2]=w[5942],w[x+8>>2]=w[5943],w[x+12>>2]=w[5944],w[5941]=j,w[5942]=G,w[5944]=0,w[5943]=x,x=y+24|0;do fn=x,x=x+4|0,w[x>>2]=7;while((fn+8|0)>>>0<ot>>>0);if((y|0)!=(ae|0)){if(j=y-ae|0,w[T>>2]=w[T>>2]&-2,w[ae+4>>2]=j|1,w[y>>2]=j,x=j>>>3,j>>>0<256){T=23356+(x<<1<<2)|0,y=w[5829]|0,x=1<<x,y&x?(y=T+8|0,x=w[y>>2]|0):(w[5829]=y|x,x=T,y=T+8|0),w[y>>2]=ae,w[x+12>>2]=ae,w[ae+8>>2]=x,w[ae+12>>2]=T;break}if(x=j>>>8,x?j>>>0>16777215?O=31:(fn=(x+1048320|0)>>>16&8,ot=x<<fn,Rt=(ot+520192|0)>>>16&4,ot=ot<<Rt,O=(ot+245760|0)>>>16&2,O=14-(Rt|fn|O)+(ot<<O>>>15)|0,O=j>>>(O+7|0)&1|O<<1):O=0,T=23620+(O<<2)|0,w[ae+28>>2]=O,w[ae+20>>2]=0,w[D>>2]=0,x=w[5830]|0,y=1<<O,!(x&y)){w[5830]=x|y,w[T>>2]=ae,w[ae+24>>2]=T,w[ae+12>>2]=ae,w[ae+8>>2]=ae;break}x=w[T>>2]|0;t:do if((w[x+4>>2]&-8|0)!=(j|0)){for(O=j<<((O|0)==31?0:25-(O>>>1)|0);T=x+16+(O>>>31<<2)|0,y=w[T>>2]|0,!!y;)if((w[y+4>>2]&-8|0)==(j|0)){x=y;break t}else O=O<<1,x=y;w[T>>2]=ae,w[ae+24>>2]=x,w[ae+12>>2]=ae,w[ae+8>>2]=ae;break e}while(0);fn=x+8|0,ot=w[fn>>2]|0,w[ot+12>>2]=ae,w[fn>>2]=ae,w[ae+8>>2]=ot,w[ae+12>>2]=x,w[ae+24>>2]=0}}else ot=w[5833]|0,(ot|0)==0|j>>>0<ot>>>0&&(w[5833]=j),w[5941]=j,w[5942]=G,w[5944]=0,w[5838]=w[5947],w[5837]=-1,w[5842]=23356,w[5841]=23356,w[5844]=23364,w[5843]=23364,w[5846]=23372,w[5845]=23372,w[5848]=23380,w[5847]=23380,w[5850]=23388,w[5849]=23388,w[5852]=23396,w[5851]=23396,w[5854]=23404,w[5853]=23404,w[5856]=23412,w[5855]=23412,w[5858]=23420,w[5857]=23420,w[5860]=23428,w[5859]=23428,w[5862]=23436,w[5861]=23436,w[5864]=23444,w[5863]=23444,w[5866]=23452,w[5865]=23452,w[5868]=23460,w[5867]=23460,w[5870]=23468,w[5869]=23468,w[5872]=23476,w[5871]=23476,w[5874]=23484,w[5873]=23484,w[5876]=23492,w[5875]=23492,w[5878]=23500,w[5877]=23500,w[5880]=23508,w[5879]=23508,w[5882]=23516,w[5881]=23516,w[5884]=23524,w[5883]=23524,w[5886]=23532,w[5885]=23532,w[5888]=23540,w[5887]=23540,w[5890]=23548,w[5889]=23548,w[5892]=23556,w[5891]=23556,w[5894]=23564,w[5893]=23564,w[5896]=23572,w[5895]=23572,w[5898]=23580,w[5897]=23580,w[5900]=23588,w[5899]=23588,w[5902]=23596,w[5901]=23596,w[5904]=23604,w[5903]=23604,ot=G+-40|0,Rt=j+8|0,Rt=Rt&7|0?0-Rt&7:0,fn=j+Rt|0,Rt=ot-Rt|0,w[5835]=fn,w[5832]=Rt,w[fn+4>>2]=Rt|1,w[j+ot+4>>2]=40,w[5836]=w[5951];while(0);if(x=w[5832]|0,x>>>0>Xe>>>0)return Rt=x-Xe|0,w[5832]=Rt,ot=w[5835]|0,fn=ot+Xe|0,w[5835]=fn,w[fn+4>>2]=Rt|1,w[ot+4>>2]=Xe|3,ot=ot+8|0,Ve=On,ot|0}return ot=Pp()|0,w[ot>>2]=12,ot=0,Ve=On,ot|0}function Mr(y){y=y|0;var x=0,T=0,O=0,D=0,j=0,G=0,Z=0,ae=0;if(y){T=y+-8|0,D=w[5833]|0,y=w[y+-4>>2]|0,x=y&-8,ae=T+x|0;do if(y&1)Z=T,G=T;else{if(O=w[T>>2]|0,!(y&3)||(G=T+(0-O)|0,j=O+x|0,G>>>0<D>>>0))return;if((w[5834]|0)==(G|0)){if(y=ae+4|0,x=w[y>>2]|0,(x&3|0)!=3){Z=G,x=j;break}w[5831]=j,w[y>>2]=x&-2,w[G+4>>2]=j|1,w[G+j>>2]=j;return}if(T=O>>>3,O>>>0<256)if(y=w[G+8>>2]|0,x=w[G+12>>2]|0,(x|0)==(y|0)){w[5829]=w[5829]&~(1<<T),Z=G,x=j;break}else{w[y+12>>2]=x,w[x+8>>2]=y,Z=G,x=j;break}D=w[G+24>>2]|0,y=w[G+12>>2]|0;do if((y|0)==(G|0)){if(x=G+16|0,T=x+4|0,y=w[T>>2]|0,y)x=T;else if(y=w[x>>2]|0,!y){y=0;break}for(;;)if(O=y+20|0,T=w[O>>2]|0,T)y=T,x=O;else if(O=y+16|0,T=w[O>>2]|0,T)y=T,x=O;else break;w[x>>2]=0}else Z=w[G+8>>2]|0,w[Z+12>>2]=y,w[y+8>>2]=Z;while(0);if(D){if(x=w[G+28>>2]|0,T=23620+(x<<2)|0,(w[T>>2]|0)==(G|0)){if(w[T>>2]=y,!y){w[5830]=w[5830]&~(1<<x),Z=G,x=j;break}}else if(Z=D+16|0,w[((w[Z>>2]|0)==(G|0)?Z:D+20|0)>>2]=y,!y){Z=G,x=j;break}w[y+24>>2]=D,x=G+16|0,T=w[x>>2]|0,T|0&&(w[y+16>>2]=T,w[T+24>>2]=y),x=w[x+4>>2]|0,x?(w[y+20>>2]=x,w[x+24>>2]=y,Z=G,x=j):(Z=G,x=j)}else Z=G,x=j}while(0);if(!(G>>>0>=ae>>>0)&&(y=ae+4|0,O=w[y>>2]|0,!!(O&1))){if(O&2)w[y>>2]=O&-2,w[Z+4>>2]=x|1,w[G+x>>2]=x,D=x;else{if((w[5835]|0)==(ae|0)){if(ae=(w[5832]|0)+x|0,w[5832]=ae,w[5835]=Z,w[Z+4>>2]=ae|1,(Z|0)!=(w[5834]|0))return;w[5834]=0,w[5831]=0;return}if((w[5834]|0)==(ae|0)){ae=(w[5831]|0)+x|0,w[5831]=ae,w[5834]=G,w[Z+4>>2]=ae|1,w[G+ae>>2]=ae;return}D=(O&-8)+x|0,T=O>>>3;do if(O>>>0<256)if(x=w[ae+8>>2]|0,y=w[ae+12>>2]|0,(y|0)==(x|0)){w[5829]=w[5829]&~(1<<T);break}else{w[x+12>>2]=y,w[y+8>>2]=x;break}else{j=w[ae+24>>2]|0,y=w[ae+12>>2]|0;do if((y|0)==(ae|0)){if(x=ae+16|0,T=x+4|0,y=w[T>>2]|0,y)x=T;else if(y=w[x>>2]|0,!y){T=0;break}for(;;)if(O=y+20|0,T=w[O>>2]|0,T)y=T,x=O;else if(O=y+16|0,T=w[O>>2]|0,T)y=T,x=O;else break;w[x>>2]=0,T=y}else T=w[ae+8>>2]|0,w[T+12>>2]=y,w[y+8>>2]=T,T=y;while(0);if(j|0){if(y=w[ae+28>>2]|0,x=23620+(y<<2)|0,(w[x>>2]|0)==(ae|0)){if(w[x>>2]=T,!T){w[5830]=w[5830]&~(1<<y);break}}else if(O=j+16|0,w[((w[O>>2]|0)==(ae|0)?O:j+20|0)>>2]=T,!T)break;w[T+24>>2]=j,y=ae+16|0,x=w[y>>2]|0,x|0&&(w[T+16>>2]=x,w[x+24>>2]=T),y=w[y+4>>2]|0,y|0&&(w[T+20>>2]=y,w[y+24>>2]=T)}}while(0);if(w[Z+4>>2]=D|1,w[G+D>>2]=D,(Z|0)==(w[5834]|0)){w[5831]=D;return}}if(y=D>>>3,D>>>0<256){T=23356+(y<<1<<2)|0,x=w[5829]|0,y=1<<y,x&y?(x=T+8|0,y=w[x>>2]|0):(w[5829]=x|y,y=T,x=T+8|0),w[x>>2]=Z,w[y+12>>2]=Z,w[Z+8>>2]=y,w[Z+12>>2]=T;return}y=D>>>8,y?D>>>0>16777215?O=31:(G=(y+1048320|0)>>>16&8,ae=y<<G,j=(ae+520192|0)>>>16&4,ae=ae<<j,O=(ae+245760|0)>>>16&2,O=14-(j|G|O)+(ae<<O>>>15)|0,O=D>>>(O+7|0)&1|O<<1):O=0,y=23620+(O<<2)|0,w[Z+28>>2]=O,w[Z+20>>2]=0,w[Z+16>>2]=0,x=w[5830]|0,T=1<<O;e:do if(!(x&T))w[5830]=x|T,w[y>>2]=Z,w[Z+24>>2]=y,w[Z+12>>2]=Z,w[Z+8>>2]=Z;else{y=w[y>>2]|0;t:do if((w[y+4>>2]&-8|0)!=(D|0)){for(O=D<<((O|0)==31?0:25-(O>>>1)|0);T=y+16+(O>>>31<<2)|0,x=w[T>>2]|0,!!x;)if((w[x+4>>2]&-8|0)==(D|0)){y=x;break t}else O=O<<1,y=x;w[T>>2]=Z,w[Z+24>>2]=y,w[Z+12>>2]=Z,w[Z+8>>2]=Z;break e}while(0);G=y+8|0,ae=w[G>>2]|0,w[ae+12>>2]=Z,w[G>>2]=Z,w[Z+8>>2]=ae,w[Z+12>>2]=y,w[Z+24>>2]=0}while(0);if(ae=(w[5837]|0)+-1|0,w[5837]=ae,!(ae|0)){for(y=23772;y=w[y>>2]|0,y;)y=y+8|0;w[5837]=-1}}}}function ma(y,x){y=y|0,x=x|0;var T=0;return y?(T=Bo(x,y)|0,(x|y)>>>0>65535&&(T=((T>>>0)/(y>>>0)|0|0)==(x|0)?T:-1)):T=0,y=Ga(T)|0,!y||!(w[y+-4>>2]&3)||Aa(y|0,0,T|0)|0,y|0}function U_(y,x,T,O){return y=y|0,x=x|0,T=T|0,O=O|0,T=y+T>>>0,Hn(x+O+(T>>>0<y>>>0|0)>>>0|0),T|0|0}function $c(y,x,T,O){return y=y|0,x=x|0,T=T|0,O=O|0,O=x-O-(T>>>0>y>>>0|0)>>>0,Hn(O|0),y-T>>>0|0|0}function Wf(y){return y=y|0,(y?31-($o(y^y-1)|0)|0:32)|0}function VA(y,x,T,O,D){y=y|0,x=x|0,T=T|0,O=O|0,D=D|0;var j=0,G=0,Z=0,ae=0,pe=0,_e=0,Xe=0,nt=0,mt=0,kt=0;if(_e=y,ae=x,pe=ae,G=T,nt=O,Z=nt,!pe)return j=(D|0)!=0,Z?j?(w[D>>2]=y|0,w[D+4>>2]=x&0,nt=0,D=0,Hn(nt|0),D|0):(nt=0,D=0,Hn(nt|0),D|0):(j&&(w[D>>2]=(_e>>>0)%(G>>>0),w[D+4>>2]=0),nt=0,D=(_e>>>0)/(G>>>0)>>>0,Hn(nt|0),D|0);j=(Z|0)==0;do if(G){if(!j){if(j=($o(Z|0)|0)-($o(pe|0)|0)|0,j>>>0<=31){Xe=j+1|0,Z=31-j|0,x=j-31>>31,G=Xe,y=_e>>>(Xe>>>0)&x|pe<<Z,x=pe>>>(Xe>>>0)&x,j=0,Z=_e<<Z;break}return D?(w[D>>2]=y|0,w[D+4>>2]=ae|x&0,nt=0,D=0,Hn(nt|0),D|0):(nt=0,D=0,Hn(nt|0),D|0)}if(j=G-1|0,j&G|0){Z=($o(G|0)|0)+33-($o(pe|0)|0)|0,kt=64-Z|0,Xe=32-Z|0,ae=Xe>>31,mt=Z-32|0,x=mt>>31,G=Z,y=Xe-1>>31&pe>>>(mt>>>0)|(pe<<Xe|_e>>>(Z>>>0))&x,x=x&pe>>>(Z>>>0),j=_e<<kt&ae,Z=(pe<<kt|_e>>>(mt>>>0))&ae|_e<<Xe&Z-33>>31;break}return D|0&&(w[D>>2]=j&_e,w[D+4>>2]=0),(G|0)==1?(mt=ae|x&0,kt=y|0|0,Hn(mt|0),kt|0):(kt=Wf(G|0)|0,mt=pe>>>(kt>>>0)|0,kt=pe<<32-kt|_e>>>(kt>>>0)|0,Hn(mt|0),kt|0)}else{if(j)return D|0&&(w[D>>2]=(pe>>>0)%(G>>>0),w[D+4>>2]=0),mt=0,kt=(pe>>>0)/(G>>>0)>>>0,Hn(mt|0),kt|0;if(!_e)return D|0&&(w[D>>2]=0,w[D+4>>2]=(pe>>>0)%(Z>>>0)),mt=0,kt=(pe>>>0)/(Z>>>0)>>>0,Hn(mt|0),kt|0;if(j=Z-1|0,!(j&Z))return D|0&&(w[D>>2]=y|0,w[D+4>>2]=j&pe|x&0),mt=0,kt=pe>>>((Wf(Z|0)|0)>>>0),Hn(mt|0),kt|0;if(j=($o(Z|0)|0)-($o(pe|0)|0)|0,j>>>0<=30){x=j+1|0,Z=31-j|0,G=x,y=pe<<Z|_e>>>(x>>>0),x=pe>>>(x>>>0),j=0,Z=_e<<Z;break}return D?(w[D>>2]=y|0,w[D+4>>2]=ae|x&0,mt=0,kt=0,Hn(mt|0),kt|0):(mt=0,kt=0,Hn(mt|0),kt|0)}while(0);if(!G)pe=Z,ae=0,Z=0;else{Xe=T|0|0,_e=nt|O&0,pe=U_(Xe|0,_e|0,-1,-1)|0,T=Ke()|0,ae=Z,Z=0;do O=ae,ae=j>>>31|ae<<1,j=Z|j<<1,O=y<<1|O>>>31|0,nt=y>>>31|x<<1|0,$c(pe|0,T|0,O|0,nt|0)|0,kt=Ke()|0,mt=kt>>31|((kt|0)<0?-1:0)<<1,Z=mt&1,y=$c(O|0,nt|0,mt&Xe|0,(((kt|0)<0?-1:0)>>31|((kt|0)<0?-1:0)<<1)&_e|0)|0,x=Ke()|0,G=G-1|0;while(G|0);pe=ae,ae=0}return G=0,D|0&&(w[D>>2]=y,w[D+4>>2]=x),mt=(j|0)>>>31|(pe|G)<<1|(G<<1|j>>>31)&0|ae,kt=(j<<1|0)&-2|Z,Hn(mt|0),kt|0}function Hc(y,x,T,O){y=y|0,x=x|0,T=T|0,O=O|0;var D=0,j=0;return j=Ve,Ve=Ve+16|0,D=j|0,VA(y,x,T,O,D)|0,Ve=j,Hn(w[D+4>>2]|0),w[D>>2]|0|0}function An(y,x,T){return y=y|0,x=x|0,T=T|0,(T|0)<32?(Hn(x>>>T|0),y>>>T|(x&(1<<T)-1)<<32-T):(Hn(0),x>>>T-32|0)}function Dn(y,x,T){return y=y|0,x=x|0,T=T|0,(T|0)<32?(Hn(x<<T|(y&(1<<T)-1<<32-T)>>>32-T|0),y<<T):(Hn(y<<T-32|0),0)}function Xg(y,x){return y=+y,x=+x,y!=y?+x:x!=x?+y:+ka(+y,+x)}function Jh(y){return y=+y,y>=0?+fr(y+.5):+Vo(y-.5)}function ed(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0;if((T|0)>=8192)return gi(y|0,x|0,T|0)|0,y|0;if(j=y|0,D=y+T|0,(y&3)==(x&3)){for(;y&3;){if(!T)return j|0;Gn[y>>0]=Gn[x>>0]|0,y=y+1|0,x=x+1|0,T=T-1|0}for(T=D&-4|0,O=T-64|0;(y|0)<=(O|0);)w[y>>2]=w[x>>2],w[y+4>>2]=w[x+4>>2],w[y+8>>2]=w[x+8>>2],w[y+12>>2]=w[x+12>>2],w[y+16>>2]=w[x+16>>2],w[y+20>>2]=w[x+20>>2],w[y+24>>2]=w[x+24>>2],w[y+28>>2]=w[x+28>>2],w[y+32>>2]=w[x+32>>2],w[y+36>>2]=w[x+36>>2],w[y+40>>2]=w[x+40>>2],w[y+44>>2]=w[x+44>>2],w[y+48>>2]=w[x+48>>2],w[y+52>>2]=w[x+52>>2],w[y+56>>2]=w[x+56>>2],w[y+60>>2]=w[x+60>>2],y=y+64|0,x=x+64|0;for(;(y|0)<(T|0);)w[y>>2]=w[x>>2],y=y+4|0,x=x+4|0}else for(T=D-4|0;(y|0)<(T|0);)Gn[y>>0]=Gn[x>>0]|0,Gn[y+1>>0]=Gn[x+1>>0]|0,Gn[y+2>>0]=Gn[x+2>>0]|0,Gn[y+3>>0]=Gn[x+3>>0]|0,y=y+4|0,x=x+4|0;for(;(y|0)<(D|0);)Gn[y>>0]=Gn[x>>0]|0,y=y+1|0,x=x+1|0;return j|0}function Aa(y,x,T){y=y|0,x=x|0,T=T|0;var O=0,D=0,j=0,G=0;if(j=y+T|0,x=x&255,(T|0)>=67){for(;y&3;)Gn[y>>0]=x,y=y+1|0;for(O=j&-4|0,G=x|x<<8|x<<16|x<<24,D=O-64|0;(y|0)<=(D|0);)w[y>>2]=G,w[y+4>>2]=G,w[y+8>>2]=G,w[y+12>>2]=G,w[y+16>>2]=G,w[y+20>>2]=G,w[y+24>>2]=G,w[y+28>>2]=G,w[y+32>>2]=G,w[y+36>>2]=G,w[y+40>>2]=G,w[y+44>>2]=G,w[y+48>>2]=G,w[y+52>>2]=G,w[y+56>>2]=G,w[y+60>>2]=G,y=y+64|0;for(;(y|0)<(O|0);)w[y>>2]=G,y=y+4|0}for(;(y|0)<(j|0);)Gn[y>>0]=x,y=y+1|0;return j-T|0}function td(y){return y=+y,y>=0?+fr(y+.5):+Vo(y-.5)}function al(y){y=y|0;var x=0,T=0,O=0;return O=Vi()|0,T=w[Ir>>2]|0,x=T+y|0,(y|0)>0&(x|0)<(T|0)|(x|0)<0?(fa(x|0)|0,za(12),-1):(x|0)>(O|0)&&!(Nf(x|0)|0)?(za(12),-1):(w[Ir>>2]=x,T|0)}return{___uremdi3:Hc,_bitshift64Lshr:An,_bitshift64Shl:Dn,_calloc:ma,_cellAreaKm2:LA,_cellAreaM2:M_,_cellAreaRads2:I_,_compact:ix,_destroyLinkedPolygon:ux,_edgeLengthKm:Bg,_edgeLengthM:RA,_emscripten_replace_memory:$h,_exactEdgeLengthKm:DA,_exactEdgeLengthM:nx,_exactEdgeLengthRads:$f,_experimentalH3ToLocalIj:N_,_experimentalLocalIjToH3:Yu,_free:Mr,_geoToH3:zg,_getDestinationH3IndexFromUnidirectionalEdge:Gg,_getH3IndexesFromUnidirectionalEdge:Zh,_getH3UnidirectionalEdge:_p,_getH3UnidirectionalEdgeBoundary:jg,_getH3UnidirectionalEdgesFromHexagon:sx,_getOriginH3IndexFromUnidirectionalEdge:D_,_getPentagonIndexes:Ap,_getRes0Indexes:il,_h3Distance:Vg,_h3GetBaseCell:O_,_h3GetFaces:Ug,_h3GetResolution:rx,_h3IndexesAreNeighbors:kA,_h3IsPentagon:No,_h3IsResClassIII:NA,_h3IsValid:Ng,_h3Line:vp,_h3LineSize:sl,_h3SetToLinkedGeo:Ao,_h3ToCenterChild:R_,_h3ToChildren:bs,_h3ToGeo:du,_h3ToGeoBoundary:jl,_h3ToParent:dp,_h3UnidirectionalEdgeIsValid:B_,_hexAreaKm2:OA,_hexAreaM2:Dg,_hexRing:Oe,_i64Subtract:$c,_kRing:Rs,_kRingDistances:xr,_llvm_minnum_f64:Xg,_llvm_round_f64:Jh,_malloc:Ga,_maxFaceCount:L_,_maxH3ToChildrenSize:BA,_maxKringSize:Os,_maxPolyfillSize:He,_maxUncompactSize:Xh,_memcpy:ed,_memset:Aa,_numHexagons:jr,_pentagonIndexCount:ox,_pointDistKm:Uc,_pointDistM:P_,_pointDistRads:Vf,_polyfill:Ot,_res0IndexCount:da,_round:td,_sbrk:al,_sizeOfCoordIJ:qg,_sizeOfGeoBoundary:F_,_sizeOfGeoCoord:bp,_sizeOfGeoPolygon:Yh,_sizeOfGeofence:Wg,_sizeOfH3Index:Xr,_sizeOfLinkedGeoPolygon:k_,_uncompact:pp,establishStackSpace:Cr,stackAlloc:cu,stackRestore:ur,stackSave:_n}}(Ae,ze,se);e.___uremdi3=Me.___uremdi3,e._bitshift64Lshr=Me._bitshift64Lshr,e._bitshift64Shl=Me._bitshift64Shl,e._calloc=Me._calloc,e._cellAreaKm2=Me._cellAreaKm2,e._cellAreaM2=Me._cellAreaM2,e._cellAreaRads2=Me._cellAreaRads2,e._compact=Me._compact,e._destroyLinkedPolygon=Me._destroyLinkedPolygon,e._edgeLengthKm=Me._edgeLengthKm,e._edgeLengthM=Me._edgeLengthM;var it=e._emscripten_replace_memory=Me._emscripten_replace_memory;e._exactEdgeLengthKm=Me._exactEdgeLengthKm,e._exactEdgeLengthM=Me._exactEdgeLengthM,e._exactEdgeLengthRads=Me._exactEdgeLengthRads,e._experimentalH3ToLocalIj=Me._experimentalH3ToLocalIj,e._experimentalLocalIjToH3=Me._experimentalLocalIjToH3,e._free=Me._free,e._geoToH3=Me._geoToH3,e._getDestinationH3IndexFromUnidirectionalEdge=Me._getDestinationH3IndexFromUnidirectionalEdge,e._getH3IndexesFromUnidirectionalEdge=Me._getH3IndexesFromUnidirectionalEdge,e._getH3UnidirectionalEdge=Me._getH3UnidirectionalEdge,e._getH3UnidirectionalEdgeBoundary=Me._getH3UnidirectionalEdgeBoundary,e._getH3UnidirectionalEdgesFromHexagon=Me._getH3UnidirectionalEdgesFromHexagon,e._getOriginH3IndexFromUnidirectionalEdge=Me._getOriginH3IndexFromUnidirectionalEdge,e._getPentagonIndexes=Me._getPentagonIndexes,e._getRes0Indexes=Me._getRes0Indexes,e._h3Distance=Me._h3Distance,e._h3GetBaseCell=Me._h3GetBaseCell,e._h3GetFaces=Me._h3GetFaces,e._h3GetResolution=Me._h3GetResolution,e._h3IndexesAreNeighbors=Me._h3IndexesAreNeighbors,e._h3IsPentagon=Me._h3IsPentagon,e._h3IsResClassIII=Me._h3IsResClassIII,e._h3IsValid=Me._h3IsValid,e._h3Line=Me._h3Line,e._h3LineSize=Me._h3LineSize,e._h3SetToLinkedGeo=Me._h3SetToLinkedGeo,e._h3ToCenterChild=Me._h3ToCenterChild,e._h3ToChildren=Me._h3ToChildren,e._h3ToGeo=Me._h3ToGeo,e._h3ToGeoBoundary=Me._h3ToGeoBoundary,e._h3ToParent=Me._h3ToParent,e._h3UnidirectionalEdgeIsValid=Me._h3UnidirectionalEdgeIsValid,e._hexAreaKm2=Me._hexAreaKm2,e._hexAreaM2=Me._hexAreaM2,e._hexRing=Me._hexRing,e._i64Subtract=Me._i64Subtract,e._kRing=Me._kRing,e._kRingDistances=Me._kRingDistances,e._llvm_minnum_f64=Me._llvm_minnum_f64,e._llvm_round_f64=Me._llvm_round_f64,e._malloc=Me._malloc,e._maxFaceCount=Me._maxFaceCount,e._maxH3ToChildrenSize=Me._maxH3ToChildrenSize,e._maxKringSize=Me._maxKringSize,e._maxPolyfillSize=Me._maxPolyfillSize,e._maxUncompactSize=Me._maxUncompactSize,e._memcpy=Me._memcpy,e._memset=Me._memset,e._numHexagons=Me._numHexagons,e._pentagonIndexCount=Me._pentagonIndexCount,e._pointDistKm=Me._pointDistKm,e._pointDistM=Me._pointDistM,e._pointDistRads=Me._pointDistRads,e._polyfill=Me._polyfill,e._res0IndexCount=Me._res0IndexCount,e._round=Me._round,e._sbrk=Me._sbrk,e._sizeOfCoordIJ=Me._sizeOfCoordIJ,e._sizeOfGeoBoundary=Me._sizeOfGeoBoundary,e._sizeOfGeoCoord=Me._sizeOfGeoCoord,e._sizeOfGeoPolygon=Me._sizeOfGeoPolygon,e._sizeOfGeofence=Me._sizeOfGeofence,e._sizeOfH3Index=Me._sizeOfH3Index,e._sizeOfLinkedGeoPolygon=Me._sizeOfLinkedGeoPolygon,e._uncompact=Me._uncompact,e.establishStackSpace=Me.establishStackSpace;var ht=e.stackAlloc=Me.stackAlloc,ft=e.stackRestore=Me.stackRestore,rt=e.stackSave=Me.stackSave;if(e.asm=Me,e.cwrap=k,e.setValue=P,e.getValue=R,e.getTempRet0=_,cr){Ri(cr)||(cr=o(cr));{qn();var wt=function(st){st.byteLength&&(st=new Uint8Array(st)),Ce.set(st,E),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,or()},sn=function(){a(cr,wt,function(){throw"could not load memory initializer "+cr})},dn=ge(cr);if(dn)wt(dn.buffer);else if(e.memoryInitializerRequest){var Qt=function(){var st=e.memoryInitializerRequest,Pt=st.response;if(st.status!==200&&st.status!==0){var rn=ge(e.memoryInitializerRequestURL);if(rn)Pt=rn.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+st.status+", retrying "+cr),sn();return}}wt(Pt)};e.memoryInitializerRequest.response?setTimeout(Qt,0):e.memoryInitializerRequest.addEventListener("load",Qt)}else sn()}}var sr;Ln=function st(){sr||pr(),sr||(Ln=st)};function pr(st){if(Jt>0||(Tn(),Jt>0))return;function Pt(){sr||(sr=!0,!B&&(Nt(),Zt(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),Wt()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),Pt()},1)):Pt()}e.run=pr;function tr(st){throw e.onAbort&&e.onAbort(st),st+="",s(st),u(st),B=!0,"abort("+st+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=tr,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return pr(),t}(typeof mn=="object"?mn:{}),dr="number",Eb=dr,Dr=dr,$r=dr,yu=dr,mi=dr,tGe=[["sizeOfH3Index",dr],["sizeOfGeoCoord",dr],["sizeOfGeoBoundary",dr],["sizeOfGeoPolygon",dr],["sizeOfGeofence",dr],["sizeOfLinkedGeoPolygon",dr],["sizeOfCoordIJ",dr],["h3IsValid",Eb,[Dr,$r]],["geoToH3",Dr,[dr,dr,yu]],["h3ToGeo",null,[Dr,$r,mi]],["h3ToGeoBoundary",null,[Dr,$r,mi]],["maxKringSize",dr,[dr]],["kRing",null,[Dr,$r,dr,mi]],["kRingDistances",null,[Dr,$r,dr,mi,mi]],["hexRing",null,[Dr,$r,dr,mi]],["maxPolyfillSize",dr,[mi,yu]],["polyfill",null,[mi,yu,mi]],["h3SetToLinkedGeo",null,[mi,dr,mi]],["destroyLinkedPolygon",null,[mi]],["compact",dr,[mi,mi,dr]],["uncompact",dr,[mi,dr,mi,dr,yu]],["maxUncompactSize",dr,[mi,dr,yu]],["h3IsPentagon",Eb,[Dr,$r]],["h3IsResClassIII",Eb,[Dr,$r]],["h3GetBaseCell",dr,[Dr,$r]],["h3GetResolution",dr,[Dr,$r]],["maxFaceCount",dr,[Dr,$r]],["h3GetFaces",null,[Dr,$r,mi]],["h3ToParent",Dr,[Dr,$r,yu]],["h3ToChildren",null,[Dr,$r,yu,mi]],["h3ToCenterChild",Dr,[Dr,$r,yu]],["maxH3ToChildrenSize",dr,[Dr,$r,yu]],["h3IndexesAreNeighbors",Eb,[Dr,$r,Dr,$r]],["getH3UnidirectionalEdge",Dr,[Dr,$r,Dr,$r]],["getOriginH3IndexFromUnidirectionalEdge",Dr,[Dr,$r]],["getDestinationH3IndexFromUnidirectionalEdge",Dr,[Dr,$r]],["h3UnidirectionalEdgeIsValid",Eb,[Dr,$r]],["getH3IndexesFromUnidirectionalEdge",null,[Dr,$r,mi]],["getH3UnidirectionalEdgesFromHexagon",null,[Dr,$r,mi]],["getH3UnidirectionalEdgeBoundary",null,[Dr,$r,mi]],["h3Distance",dr,[Dr,$r,Dr,$r]],["h3Line",dr,[Dr,$r,Dr,$r,mi]],["h3LineSize",dr,[Dr,$r,Dr,$r]],["experimentalH3ToLocalIj",dr,[Dr,$r,Dr,$r,mi]],["experimentalLocalIjToH3",dr,[Dr,$r,mi,mi]],["hexAreaM2",dr,[yu]],["hexAreaKm2",dr,[yu]],["edgeLengthM",dr,[yu]],["edgeLengthKm",dr,[yu]],["pointDistM",dr,[mi,mi]],["pointDistKm",dr,[mi,mi]],["pointDistRads",dr,[mi,mi]],["cellAreaM2",dr,[Dr,$r]],["cellAreaKm2",dr,[Dr,$r]],["cellAreaRads2",dr,[Dr,$r]],["exactEdgeLengthM",dr,[Dr,$r]],["exactEdgeLengthKm",dr,[Dr,$r]],["exactEdgeLengthRads",dr,[Dr,$r]],["numHexagons",dr,[yu]],["getRes0Indexes",null,[mi]],["res0IndexCount",dr],["getPentagonIndexes",null,[dr,mi]],["pentagonIndexCount",dr]],$n={};tGe.forEach(function(e){$n[e[0]]=mn.cwrap.apply(mn,e)});var av=16,Xl=4,dq=4,cA=8,Ll=$n.sizeOfH3Index(),oL=$n.sizeOfGeoCoord(),koe=$n.sizeOfGeoBoundary(),nGe=$n.sizeOfGeoPolygon(),pw=$n.sizeOfGeofence(),rGe=$n.sizeOfLinkedGeoPolygon(),zoe=$n.sizeOfCoordIJ(),Du={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function W1(t){if(typeof t!="number"||t<0||t>15||Math.floor(t)!==t)throw new Error("Invalid resolution: "+t)}var iGe=/[^0-9a-fA-F]/;function pi(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||iGe.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),av),n=parseInt(t.substring(t.length-8),av);return[n,e]}function pq(t){if(t>=0)return t.toString(av);t=t&2147483647;var e=Uoe(8,t.toString(av)),n=(parseInt(e[0],av)+8).toString(av);return e=n+e.substring(1),e}function sL(t,e){return pq(e)+Uoe(8,pq(t))}function Uoe(t,e){for(var n=t-e.length,r="",i=0;i<n;i++)r+="0";return r=r+e,r}function gq(t,e,n){for(var r=t.length,i=mn._calloc(r,oL),o=n?1:0,a=n?0:1,s=0;s<r*2;s+=2)mn.HEAPF64.set([t[s/2][o],t[s/2][a]].map(lL),i/cA+s);return mn.HEAPU32.set([r,i],e/Xl),e}function oGe(t,e){var n=t.length-1,r=mn._calloc(nGe),i=0,o=i+pw,a=o+Xl;gq(t[0],r+i,e);var s;if(n>0){s=mn._calloc(n,pw);for(var u=0;u<n;u++)gq(t[u+1],s+pw*u,e)}return mn.setValue(r+o,n,"i32"),mn.setValue(r+a,s,"i32"),r}function sGe(t){var e=0,n=e+pw,r=n+Xl,i=Xl;mn._free(mn.getValue(t+e+i,"i8*"));var o=mn.getValue(t+n,"i32");if(o>0){for(var a=mn.getValue(t+r,"i32"),s=0;s<o;s++)mn._free(mn.getValue(a+pw*s+i,"i8*"));mn._free(a)}mn._free(t)}function Goe(t){var e=mn.getTempRet0();return[t,e]}function q1(t){var e=Goe(t),n=e[0],r=e[1];return r?sL(n,r):null}function joe(t,e){e===void 0&&(e=0);var n=mn.getValue(t+Xl*e*2,"i32"),r=mn.getValue(t+Xl*(e*2+1),"i32");return r?sL(n,r):null}function aGe(t,e,n){mn.HEAPU32.set(pi(t),e/Xl+2*n)}function jh(t,e){for(var n=[],r=0;r<e;r++){var i=joe(t,r);i!==null&&n.push(i)}return n}function oU(t,e){for(var n=e.length,r=0;r<n;r++)aGe(e[r],t,r)}function mq(t,e){var n=mn._calloc(1,oL);return mn.HEAPF64.set([t,e].map(lL),n/cA),n}function nM(t){return Joe(mn.getValue(t,"double"))}function sU(t){return[nM(t),nM(t+cA)]}function Voe(t){return[nM(t+cA),nM(t)]}function $oe(t,e,n){for(var r=mn.getValue(t,"i32"),i=t+cA,o=[],a=e?Voe:sU,s=0;s<r*2;s+=2)o.push(a(i+cA*s));return n&&o.push(o[0]),o}function lGe(t,e){for(var n=[],r=e?Voe:sU,i,o,a,s;t;){for(n.push(i=[]),o=mn.getValue(t,"i8*");o;){for(i.push(a=[]),s=mn.getValue(o,"i8*");s;)a.push(r(s)),s=mn.getValue(s+cA*2,"i8*");e&&a.push(a[0]),o=mn.getValue(o+dq*2,"i8*")}t=mn.getValue(t+dq*2,"i8*")}return n}function uGe(t){return{i:mn.getValue(t,"i32"),j:mn.getValue(t+Xl,"i32")}}function cGe(t,e){var n=e.i,r=e.j;mn.setValue(t,n,"i32"),mn.setValue(t+Xl,r,"i32")}function fGe(t,e){for(var n=[],r=0;r<e;r++){var i=mn.getValue(t+Xl*r,"i32");i>=0&&n.push(i)}return n}function Hoe(t){var e=pi(t),n=e[0],r=e[1];return!!$n.h3IsValid(n,r)}function Woe(t){var e=pi(t),n=e[0],r=e[1];return!!$n.h3IsPentagon(n,r)}function hGe(t){var e=pi(t),n=e[0],r=e[1];return!!$n.h3IsResClassIII(n,r)}function dGe(t){var e=pi(t),n=e[0],r=e[1];return $n.h3GetBaseCell(n,r)}function pGe(t){var e=pi(t),n=e[0],r=e[1],i=$n.maxFaceCount(n,r),o=mn._malloc(Xl*i);$n.h3GetFaces(n,r,o);var a=fGe(o,i);return mn._free(o),a}function qoe(t){var e=pi(t),n=e[0],r=e[1];return $n.h3IsValid(n,r)?$n.h3GetResolution(n,r):-1}function Xoe(t,e,n){var r=mn._malloc(oL);mn.HEAPF64.set([t,e].map(lL),r/cA);var i=q1($n.geoToH3(r,n));return mn._free(r),i}function aL(t){var e=mn._malloc(oL),n=pi(t),r=n[0],i=n[1];$n.h3ToGeo(r,i,e);var o=sU(e);return mn._free(e),o}function Zoe(t,e){var n=mn._malloc(koe),r=pi(t),i=r[0],o=r[1];$n.h3ToGeoBoundary(i,o,n);var a=$oe(n,e,e);return mn._free(n),a}function gGe(t,e){var n=pi(t),r=n[0],i=n[1];return q1($n.h3ToParent(r,i,e))}function mGe(t,e){if(!Hoe(t))return[];var n=pi(t),r=n[0],i=n[1],o=$n.maxH3ToChildrenSize(r,i,e),a=mn._calloc(o,Ll);$n.h3ToChildren(r,i,e,a);var s=jh(a,o);return mn._free(a),s}function AGe(t,e){var n=pi(t),r=n[0],i=n[1];return q1($n.h3ToCenterChild(r,i,e))}function _Ge(t,e){var n=pi(t),r=n[0],i=n[1],o=$n.maxKringSize(e),a=mn._calloc(o,Ll);$n.kRing(r,i,e,a);var s=jh(a,o);return mn._free(a),s}function yGe(t,e){var n=pi(t),r=n[0],i=n[1],o=$n.maxKringSize(e),a=mn._calloc(o,Ll),s=mn._calloc(o,Xl);$n.kRingDistances(r,i,e,a,s);for(var u=[],d=0;d<e+1;d++)u.push([]);for(var g=0;g<o*2;g+=2){var _=mn.getValue(a+Xl*g,"i32"),E=mn.getValue(a+Xl*(g+1),"i32"),P=mn.getValue(s+Xl*(g/2),"i32");(_!==0||E!==0)&&u[P].push(sL(_,E))}return mn._free(a),mn._free(s),u}function vGe(t,e){var n=e===0?1:6*e,r=mn._calloc(n,Ll),i=$n.hexRing.apply($n,pi(t).concat([e],[r]));if(i!==0)throw mn._free(r),new Error("Failed to get hexRing (encountered a pentagon?)");var o=jh(r,n);return mn._free(r),o}function xGe(t,e,n){if(W1(e),n=!!n,t.length===0||t[0].length===0)return[];typeof t[0][0]=="number"&&(t=[t]);var r=oGe(t,n),i=$n.maxPolyfillSize(r,e),o=mn._calloc(i,Ll);$n.polyfill(r,e,o);var a=jh(o,i);return mn._free(o),sGe(r),a}function Yoe(t,e){if(!t||!t.length)return[];var n=t.length,r=mn._calloc(n,Ll);oU(r,t);var i=mn._calloc(rGe),o=i;$n.h3SetToLinkedGeo(r,n,i);var a=lGe(i,e);return $n.destroyLinkedPolygon(o),mn._free(o),mn._free(r),a}function bGe(t){if(!t||!t.length)return[];var e=t.length,n=mn._calloc(e,Ll);oU(n,t);var r=mn._calloc(e,Ll),i=$n.compact(n,r,e);if(i!==0)throw mn._free(n),mn._free(r),new Error("Failed to compact, malformed input data (duplicate hexagons?)");var o=jh(r,e);return mn._free(n),mn._free(r),o}function wGe(t,e){if(W1(e),!t||!t.length)return[];var n=t.length,r=mn._calloc(n,Ll);oU(r,t);var i=$n.maxUncompactSize(r,n,e),o=mn._calloc(i,Ll),a=$n.uncompact(r,n,o,i,e);if(a!==0)throw mn._free(r),mn._free(o),new Error("Failed to uncompact (bad resolution?)");var s=jh(o,i);return mn._free(r),mn._free(o),s}function EGe(t,e){var n=pi(t),r=n[0],i=n[1],o=pi(e),a=o[0],s=o[1];return!!$n.h3IndexesAreNeighbors(r,i,a,s)}function SGe(t,e){var n=pi(t),r=n[0],i=n[1],o=pi(e),a=o[0],s=o[1];return q1($n.getH3UnidirectionalEdge(r,i,a,s))}function TGe(t){var e=pi(t),n=e[0],r=e[1];return q1($n.getOriginH3IndexFromUnidirectionalEdge(n,r))}function CGe(t){var e=pi(t),n=e[0],r=e[1];return q1($n.getDestinationH3IndexFromUnidirectionalEdge(n,r))}function PGe(t){var e=pi(t),n=e[0],r=e[1];return!!$n.h3UnidirectionalEdgeIsValid(n,r)}function IGe(t){var e=pi(t),n=e[0],r=e[1],i=2,o=mn._calloc(i,Ll);$n.getH3IndexesFromUnidirectionalEdge(n,r,o);var a=jh(o,i);return mn._free(o),a}function MGe(t){var e=pi(t),n=e[0],r=e[1],i=6,o=mn._calloc(i,Ll);$n.getH3UnidirectionalEdgesFromHexagon(n,r,o);var a=jh(o,i);return mn._free(o),a}function OGe(t,e){var n=mn._malloc(koe),r=pi(t),i=r[0],o=r[1];$n.getH3UnidirectionalEdgeBoundary(i,o,n);var a=$oe(n,e);return mn._free(n),a}function Qoe(t,e){var n=pi(t),r=n[0],i=n[1],o=pi(e),a=o[0],s=o[1];return $n.h3Distance(r,i,a,s)}function RGe(t,e){var n=pi(t),r=n[0],i=n[1],o=pi(e),a=o[0],s=o[1],u=$n.h3LineSize(r,i,a,s);if(u<0)throw new Error("Line cannot be calculated");var d=mn._calloc(u,Ll);$n.h3Line(r,i,a,s,d);var g=jh(d,u);return mn._free(d),g}function LGe(t,e){var n=mn._malloc(zoe),r=$n.experimentalH3ToLocalIj.apply($n,pi(t).concat(pi(e),[n])),i=uGe(n);switch(mn._free(n),r){case 0:return i;case 1:throw new Error("Incompatible origin and index.");case 2:default:throw new Error("Local IJ coordinates undefined for this origin and index pair. The index may be too far from the origin.");case 3:case 4:case 5:throw new Error("Encountered possible pentagon distortion")}}function DGe(t,e){if(!e||typeof e.i!="number"||typeof e.j!="number")throw new Error("Coordinates must be provided as an {i, j} object");var n=mn._malloc(zoe),r=mn._malloc(Ll);cGe(n,e);var i=$n.experimentalLocalIjToH3.apply($n,pi(t).concat([n],[r])),o=joe(r);if(mn._free(n),mn._free(r),i!==0)throw new Error("Index not defined for this origin and IJ coordinates pair. IJ coordinates may be too far from origin, or a pentagon distortion was encountered.");return o}function BGe(t,e,n){var r=mq(t[0],t[1]),i=mq(e[0],e[1]),o;switch(n){case Du.m:o=$n.pointDistM(r,i);break;case Du.km:o=$n.pointDistKm(r,i);break;case Du.rads:o=$n.pointDistRads(r,i);break;default:o=null}if(mn._free(r),mn._free(i),o===null)throw new Error("Unknown unit: "+n);return o}function NGe(t,e){var n=pi(t),r=n[0],i=n[1];switch(e){case Du.m2:return $n.cellAreaM2(r,i);case Du.km2:return $n.cellAreaKm2(r,i);case Du.rads2:return $n.cellAreaRads2(r,i);default:throw new Error("Unknown unit: "+e)}}function FGe(t,e){var n=pi(t),r=n[0],i=n[1];switch(e){case Du.m:return $n.exactEdgeLengthM(r,i);case Du.km:return $n.exactEdgeLengthKm(r,i);case Du.rads:return $n.exactEdgeLengthRads(r,i);default:throw new Error("Unknown unit: "+e)}}function kGe(t,e){switch(W1(t),e){case Du.m2:return $n.hexAreaM2(t);case Du.km2:return $n.hexAreaKm2(t);default:throw new Error("Unknown unit: "+e)}}function Koe(t,e){switch(W1(t),e){case Du.m:return $n.edgeLengthM(t);case Du.km:return $n.edgeLengthKm(t);default:throw new Error("Unknown unit: "+e)}}function zGe(t){W1(t);var e=Goe($n.numHexagons(t)),n=e[0],r=e[1];return r?r*Math.pow(2,32)+n:n}function UGe(){var t=$n.res0IndexCount(),e=mn._malloc(Ll*t);$n.getRes0Indexes(e);var n=jh(e,t);return mn._free(e),n}function GGe(t){W1(t);var e=$n.pentagonIndexCount(),n=mn._malloc(Ll*e);$n.getPentagonIndexes(t,n);var r=jh(n,e);return mn._free(n),r}function lL(t){return t*Math.PI/180}function Joe(t){return t*180/Math.PI}const jGe=Object.freeze(Object.defineProperty({__proto__:null,UNITS:Du,cellArea:NGe,compact:bGe,degsToRads:lL,edgeLength:Koe,exactEdgeLength:FGe,experimentalH3ToLocalIj:LGe,experimentalLocalIjToH3:DGe,geoToH3:Xoe,getDestinationH3IndexFromUnidirectionalEdge:CGe,getH3IndexesFromUnidirectionalEdge:IGe,getH3UnidirectionalEdge:SGe,getH3UnidirectionalEdgeBoundary:OGe,getH3UnidirectionalEdgesFromHexagon:MGe,getOriginH3IndexFromUnidirectionalEdge:TGe,getPentagonIndexes:GGe,getRes0Indexes:UGe,h3Distance:Qoe,h3GetBaseCell:dGe,h3GetFaces:pGe,h3GetResolution:qoe,h3IndexToSplitLong:pi,h3IndexesAreNeighbors:EGe,h3IsPentagon:Woe,h3IsResClassIII:hGe,h3IsValid:Hoe,h3Line:RGe,h3SetToMultiPolygon:Yoe,h3ToCenterChild:AGe,h3ToChildren:mGe,h3ToGeo:aL,h3ToGeoBoundary:Zoe,h3ToParent:gGe,h3UnidirectionalEdgeIsValid:PGe,hexArea:kGe,hexRing:vGe,kRing:_Ge,kRingDistances:yGe,numHexagons:zGe,pointDist:BGe,polyfill:xGe,radsToDegs:Joe,splitLongToh3Index:sL,uncompact:wGe},Symbol.toStringTag,{value:"Module"})),VGe=10;function ese(t,e){e=e===void 0?t[0][0]:e;for(const n of t){const r=n[0]-e;r>180?n[0]-=360:r<-180&&(n[0]+=360)}}function $Ge(t,e,n){const[r,i]=aL(t),o=e.length;ese(e,i);const a=e[0]===e[o-1]?o-1:o;for(let s=0;s<a;s++)e[s][0]=pc(i,e[s][0],n),e[s][1]=pc(r,e[s][1],n)}function HGe(t,e,n){const r=t(e,n),[i,o]=aL(r);return[o,i]}function Aq(t,e=1){const n=Zoe(t,!0);return e!==1?$Ge(t,n,e):ese(n),n}function WGe(t){const e=new Float64Array(t.length*2);let n=0;for(const r of t)e[n++]=r[0],e[n++]=r[1];return e}function qGe(t,e){let n;return t==null?n=e:typeof t=="object"?n={...t,coverage:e}:n={getHexagon:t,coverage:e},n}const XGe={...bA.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:t=>t.hexagon},extruded:!0};class x_ extends Uh{constructor(...e){super(...e),q(this,"state",void 0)}initializeState(){x_._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:n}){if(e.highPrecision!==!0&&(n.dataChanged||n.updateTriggersChanged&&n.updateTriggersChanged.getHexagon)){const r=this._calculateH3DataProps();this.setState(r)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,n=!1,r=!1;const{iterable:i,objectInfo:o}=Tg(this.props.data);for(const a of i){o.index++;const s=this.props.getHexagon(a,o),u=qoe(s);if(e<0){if(e=u,!this.props.highPrecision)break}else if(e!==u){r=!0;break}if(Woe(s)){n=!0;break}}return{resolution:e,edgeLengthKM:e>=0?Koe(e,"km"):0,hasMultipleRes:r,hasPentagon:n}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:e,hasPentagon:n,hasMultipleRes:r}=this.state,{viewport:i}=this.context;return!!(i!=null&&i.resolution)||r||n||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:n,edgeLengthKM:r,centerHex:i}=this.state;if(n<0)return;const o=this.props.centerHexagon||Xoe(e.latitude,e.longitude,n);if(i===o)return;if(i){const E=Qoe(i,o);if(E>=0&&E*r<VGe)return}const{unitsPerMeter:a}=e.distanceScales;let s=Aq(o);const[u,d]=aL(o),[g,_]=e.projectFlat([d,u]);s=s.map(E=>{const P=e.projectFlat(E);return[(P[0]-g)/a[0],(P[1]-_)/a[1]]}),this.setState({centerHex:o,vertices:s})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:n,coverage:r,extruded:i,wireframe:o,stroked:a,filled:s,lineWidthUnits:u,lineWidthScale:d,lineWidthMinPixels:g,lineWidthMaxPixels:_,getFillColor:E,getElevation:P,getLineColor:R,getLineWidth:B,transitions:V,updateTriggers:z}=this.props;return{elevationScale:e,extruded:i,coverage:r,wireframe:o,stroked:a,filled:s,lineWidthUnits:u,lineWidthScale:d,lineWidthMinPixels:g,lineWidthMaxPixels:_,material:n,getElevation:P,getFillColor:E,getLineColor:R,getLineWidth:B,transitions:V,updateTriggers:{getFillColor:z.getFillColor,getElevation:z.getElevation,getLineColor:z.getLineColor,getLineWidth:z.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:n,updateTriggers:r,coverage:i}=this.props,o=this.getSubLayerClass("hexagon-cell-hifi",bA),a=this._getForwardProps();return a.updateTriggers.getPolygon=qGe(r.getHexagon,i),new o(a,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:a.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(s,u)=>{const d=n(s,u);return WGe(Aq(d,i))}})}_renderColumnLayer(){const{data:e,getHexagon:n,updateTriggers:r}=this.props,i=this.getSubLayerClass("hexagon-cell",i2),o=this._getForwardProps();return o.updateTriggers.getPosition=r.getHexagon,new i(o,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:o.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:HGe.bind(null,n)})}}q(x_,"defaultProps",XGe);q(x_,"layerName","H3HexagonLayer");q(x_,"_checkH3Lib",()=>{});const ZGe={getHexagons:{type:"accessor",value:t=>t.hexagons}};class aU extends v_{initializeState(){x_._checkH3Lib()}updateState({props:e,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&n.updateTriggersChanged.getHexagons){const{data:r,getHexagons:i}=e,o=[],{iterable:a,objectInfo:s}=Tg(r);for(const u of a){s.index++;const d=i(u,s),g=Yoe(d,!0);for(const _ of g)o.push(this.getSubLayerRow({polygon:_},u,s.index))}this.setState({polygons:o})}}indexToBounds(){const{getElevation:e,getFillColor:n,getLineColor:r,getLineWidth:i}=this.props;return{data:this.state.polygons,getPolygon:o=>o.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(n),getLineColor:this.getSubLayerAccessor(r),getLineWidth:this.getSubLayerAccessor(i)}}}q(aU,"layerName","H3ClusterLayer");q(aU,"defaultProps",ZGe);const PB=Math.PI/180,lT=new Float32Array(16),_q=new Float32Array(12);function yq(t,e,n){const r=e[0]*PB,i=e[1]*PB,o=e[2]*PB,a=Math.sin(o),s=Math.sin(r),u=Math.sin(i),d=Math.cos(o),g=Math.cos(r),_=Math.cos(i),E=n[0],P=n[1],R=n[2];t[0]=E*_*g,t[1]=E*u*g,t[2]=E*-s,t[3]=P*(-u*d+_*s*a),t[4]=P*(_*d+u*s*a),t[5]=P*g*a,t[6]=R*(u*a+_*s*d),t[7]=R*(-_*a+u*s*d),t[8]=R*g*d}function vq(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const tse={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:r,getOrientation:i,getScale:o,getTranslation:a,getTransformMatrix:s}=this.props,u=Array.isArray(s),d=u&&s.length===16,g=Array.isArray(o),_=Array.isArray(i),E=Array.isArray(a),P=d||!u&&!!s(r[0]);P?t.constant=d:t.constant=_&&g&&E;const R=t.value;if(t.constant){let B;P?(lT.set(s),B=vq(lT)):(B=_q,yq(B,i,o),B.set(a,9)),t.value=new Float32Array(B)}else{let B=e*t.size;const{iterable:V,objectInfo:z}=Tg(r,e,n);for(const F of V){z.index++;let k;if(P)lT.set(d?s:s(F,z)),k=vq(lT);else{k=_q;const X=_?i:i(F,z),Y=g?o:o(F,z);yq(k,X,Y),k.set(E?a:a(F,z),9)}R[B++]=k[0],R[B++]=k[1],R[B++]=k[2],R[B++]=k[3],R[B++]=k[4],R[B++]=k[5],R[B++]=k[6],R[B++]=k[7],R[B++]=k[8],R[B++]=k[9],R[B++]=k[10],R[B++]=k[11]}}}};function nse(t,e){return e===Br.CARTESIAN||e===Br.METER_OFFSETS||e===Br.DEFAULT&&!t.isGeospatial}const YGe=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,QGe=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function lU(t){let e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0;const s=t.POSITION?t.POSITION.value:[],u=s&&s.length;for(let d=0;d<u;d+=3){const g=s[d],_=s[d+1],E=s[d+2];e=g<e?g:e,n=_<n?_:n,r=E<r?E:r,i=g>i?g:i,o=_>o?_:o,a=E>a?E:a}return[[e,n,r],[i,o,a]]}function KGe(t,e){if(!t)throw new Error(e||"loader assertion failed.")}class lv{constructor(e,n){q(this,"fields",void 0),q(this,"metadata",void 0),KGe(Array.isArray(e)),JGe(e),this.fields=e,this.metadata=n||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let n=0;n<this.fields.length;++n)if(!this.fields[n].compareTo(e.fields[n]))return!1;return!0}select(){const e=Object.create(null);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(const a of r)e[a]=!0;const o=this.fields.filter(a=>e[a.name]);return new lv(o,this.metadata)}selectAt(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];const i=n.map(o=>this.fields[o]).filter(Boolean);return new lv(i,this.metadata)}assign(e){let n,r=this.metadata;if(e instanceof lv){const a=e;n=a.fields,r=xq(xq(new Map,this.metadata),a.metadata)}else n=e;const i=Object.create(null);for(const a of this.fields)i[a.name]=a;for(const a of n)i[a.name]=a;const o=Object.values(i);return new lv(o,r)}}function JGe(t){const e={};for(const n of t)e[n.name]&&console.warn("Schema: duplicated field name",n.name,n),e[n.name]=!0}function xq(t,e){return new Map([...t||new Map,...e||new Map])}class rM{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;q(this,"name",void 0),q(this,"type",void 0),q(this,"nullable",void 0),q(this,"metadata",void 0),this.name=e,this.type=n,this.nullable=r,this.metadata=i}get typeId(){return this.type&&this.type.typeId}clone(){return new rM(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let gs=function(t){return t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth",t}({}),rse,ise,ose;class uU{static isNull(e){return e&&e.typeId===gs.Null}static isInt(e){return e&&e.typeId===gs.Int}static isFloat(e){return e&&e.typeId===gs.Float}static isBinary(e){return e&&e.typeId===gs.Binary}static isUtf8(e){return e&&e.typeId===gs.Utf8}static isBool(e){return e&&e.typeId===gs.Bool}static isDecimal(e){return e&&e.typeId===gs.Decimal}static isDate(e){return e&&e.typeId===gs.Date}static isTime(e){return e&&e.typeId===gs.Time}static isTimestamp(e){return e&&e.typeId===gs.Timestamp}static isInterval(e){return e&&e.typeId===gs.Interval}static isList(e){return e&&e.typeId===gs.List}static isStruct(e){return e&&e.typeId===gs.Struct}static isUnion(e){return e&&e.typeId===gs.Union}static isFixedSizeBinary(e){return e&&e.typeId===gs.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===gs.FixedSizeList}static isMap(e){return e&&e.typeId===gs.Map}static isDictionary(e){return e&&e.typeId===gs.Dictionary}get typeId(){return gs.NONE}compareTo(e){return this===e}}rse=Symbol.toStringTag;class X1 extends uU{constructor(e,n){super(),q(this,"isSigned",void 0),q(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=n}get typeId(){return gs.Int}get[rse](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class eje extends X1{constructor(){super(!0,8)}}class tje extends X1{constructor(){super(!0,16)}}class nje extends X1{constructor(){super(!0,32)}}class rje extends X1{constructor(){super(!1,8)}}class ije extends X1{constructor(){super(!1,16)}}class oje extends X1{constructor(){super(!1,32)}}const sse={HALF:16,SINGLE:32,DOUBLE:64};ise=Symbol.toStringTag;class ase extends uU{constructor(e){super(),q(this,"precision",void 0),this.precision=e}get typeId(){return gs.Float}get[ise](){return"Float"}toString(){return"Float".concat(this.precision)}}class sje extends ase{constructor(){super(sse.SINGLE)}}class aje extends ase{constructor(){super(sse.DOUBLE)}}ose=Symbol.toStringTag;class lje extends uU{constructor(e,n){super(),q(this,"listSize",void 0),q(this,"children",void 0),this.listSize=e,this.children=[n]}get typeId(){return gs.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[ose](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function uje(t){switch(t.constructor){case Int8Array:return new eje;case Uint8Array:return new rje;case Int16Array:return new tje;case Uint16Array:return new ije;case Int32Array:return new nje;case Uint32Array:return new oje;case Float32Array:return new sje;case Float64Array:return new aje;default:throw new Error("array type not supported")}}function cje(t,e,n){const r=uje(e.value),i=n||fje(e);return new rM(t,new lje(e.size,new rM("value",r)),!1,i)}function fje(t){const e=new Map;return"byteOffset"in t&&e.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&e.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&e.set("normalized",t.normalized.toString()),e}function bq(t,e){(t.COLOR_0||t.colors)&&e||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),Or.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function wq(t,e){if(t.attributes)return bq(t.attributes,e),t instanceof Cs?t:new Cs(t);if(t.positions||t.POSITION)return bq(t,e),new Cs({attributes:t});throw Error("Invalid mesh")}const hje=[0,0,0,255],dje={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:hje},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class _1 extends nl{constructor(...e){super(...e),q(this,"state",void 0)}getShaders(){const e=!Hr(this.context.gl),n={};return RE(this.context.gl,Qi.GLSL_DERIVATIVES)&&(n.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:YGe,fs:QGe,modules:[Mc,kO,Oc],transpileToGLSL100:e,defines:n})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let n=this.state.positionBounds;if(n)return n;const{mesh:r}=this.props;if(!r)return null;if(n=(e=r.header)===null||e===void 0?void 0:e.boundingBox,!n){const{attributes:i}=wq(r,this.props._useMeshColors);i.POSITION=i.POSITION||i.positions,n=lU(i)}return this.state.positionBounds=n,n}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:tse}),this.setState({emptyTexture:new Pl(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e;if(n.mesh!==r.mesh||i.extensionsChanged){var o;if(this.state.positionBounds=null,(o=this.state.model)===null||o===void 0||o.delete(),n.mesh){this.state.model=this.getModel(n.mesh);const a=n.mesh.attributes||n.mesh;this.setState({hasNormals:!!(a.NORMAL||a.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==r.texture&&this.setTexture(n.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){if(!this.state.model)return;const{viewport:n}=this.context,{sizeScale:r,coordinateSystem:i,_instanced:o}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:r,composeModelMatrix:!o||nse(n,i),flatShading:!this.state.hasNormals}).draw()}getModel(e){const n=new Oa(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:wq(e,this.props._useMeshColors),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:i}=this.state;return n.setUniforms({sampler:r||i,hasTexture:!!r}),n}setTexture(e){const{emptyTexture:n,model:r}=this.state;r&&r.setUniforms({sampler:e||n,hasTexture:!!e})}}q(_1,"defaultProps",dje);q(_1,"layerName","SimpleMeshLayer");class xv{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n}=e;this.id=n||Ma(this.constructor.name),this.display=!0,this.position=new yt,this.rotation=new yt,this.scale=new yt(1,1,1),this.matrix=new vr,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(e){return Nn(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return Nn(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return Nn(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:n,rotation:r,scale:i,update:o=!0}=e;return n&&this.setPosition(n),r&&this.setRotation(r),i&&this.setScale(i),o&&this.updateMatrix(),this}updateMatrix(){const e=this.position,n=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(n),this.matrix.scale(r),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:n,rotation:r,scale:i}=e;return n&&this.setPosition(n),r&&this.setRotation(r),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,n){Nn(e),n=n||this.matrix;const r=new vr(e).multiplyRight(n),i=r.invert(),o=i.transpose();return{viewMatrix:e,modelMatrix:n,objectMatrix:n,worldMatrix:r,worldInverseMatrix:i,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class gw extends xv{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:n=[]}=e;Yn.assert(n.every(r=>r instanceof xv),"every child must an instance of ScenegraphNode"),super(e),this.children=n}add(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(const i of n)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(e){const n=this.children,r=n.indexOf(e);return r>-1&&n.splice(r,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((n,r)=>{let{worldMatrix:i}=r;const o=n.getBounds();if(!o)return;const[a,s]=o,u=new yt(a).add(s).divide([2,2,2]);i.transformAsPoint(u,u);const d=new yt(s).subtract(a).divide([2,2,2]);i.transformAsVector(d,d);for(let g=0;g<8;g++){const _=new yt(g&1?-1:1,g&2?-1:1,g&4?-1:1).multiply(d).add(u);for(let E=0;E<3;E++)e[0][E]=Math.min(e[0][E],_[E]),e[1][E]=Math.max(e[1][E],_[E])}}),Number.isFinite(e[0][0])?e:null}traverse(e){let{worldMatrix:n=new vr}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new vr(n).multiplyRight(this.matrix);for(const i of this.children)i instanceof gw?i.traverse(e,{worldMatrix:r}):e(i,{worldMatrix:r})}}const pje={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gje={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Eq(t){if(!t._animation){const e=gje[t.componentType],n=pje[t.type],r=n*t.count,{buffer:i,byteOffset:o}=t.bufferView.data,a=new e(i,o+(t.byteOffset||0),r);if(n===1)t._animation=Array.from(a);else{const s=[];for(let u=0;u<a.length;u+=n)s.push(Array.from(a.slice(u,u+n)));t._animation=s}}return t._animation}const mje=new vr;function Aje(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const n=mje.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}const IB=new Zm;function _je(t,e,n,r,i){if(e==="rotation"){IB.slerp({start:n,target:r,ratio:i});for(let o=0;o<IB.length;o++)t[e][o]=IB[o]}else for(let o=0;o<n.length;o++)t[e][o]=i*r[o]+(1-i)*n[o]}function yje(t,e,n){let{p0:r,outTangent0:i,inTangent1:o,p1:a,tDiff:s,ratio:u}=n;for(let d=0;d<t[e].length;d++){const g=i[d]*s,_=o[d]*s;t[e][d]=(2*Math.pow(u,3)-3*Math.pow(u,2)+1)*r[d]+(Math.pow(u,3)-2*Math.pow(u,2)+u)*g+(-2*Math.pow(u,3)+3*Math.pow(u,2))*a[d]+(Math.pow(u,3)-Math.pow(u,2))*_}}function vje(t,e,n){for(let r=0;r<n.length;r++)t[e][r]=n[r]}function xje(t,e,n,r){let{input:i,interpolation:o,output:a}=e;const s=i[i.length-1],u=t%s,d=i.findIndex(P=>P>=u),g=Math.max(0,d-1);if(!Array.isArray(n[r]))switch(r){case"translation":n[r]=[0,0,0];break;case"rotation":n[r]=[0,0,0,1];break;case"scale":n[r]=[1,1,1];break;default:Yn.warn("Bad animation path ".concat(r))()}Nn(n[r].length===a[g].length);const _=i[g],E=i[d];switch(o){case"STEP":vje(n,r,a[g]);break;case"LINEAR":if(E>_){const P=(u-_)/(E-_);_je(n,r,a[g],a[d],P)}break;case"CUBICSPLINE":if(E>_){const P=(u-_)/(E-_),R=E-_,B=a[3*g+1],V=a[3*g+2],z=a[3*d+0],F=a[3*d+1];yje(n,r,{p0:B,outTangent0:V,inTangent1:z,p1:F,tDiff:R,ratio:P})}break;default:Yn.warn("Interpolation ".concat(o," not supported"))();break}}class bje{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const r=(e/1e3-this.startTime)*this.speed;this.channels.forEach(i=>{let{sampler:o,target:a,path:s}=i;xje(r,o,a,s),Aje(a,a._node)})}}class wje{constructor(e){this.animations=e.animations.map((n,r)=>{const i=n.name||"Animation-".concat(r),o=n.samplers.map(s=>{let{input:u,interpolation:d="LINEAR",output:g}=s;return{input:Eq(e.accessors[u]),interpolation:d,output:Eq(e.accessors[g])}}),a=n.channels.map(s=>{let{sampler:u,target:d}=s;return{sampler:o[u],target:e.nodes[d.node],path:d.path}});return new bje({name:i,channels:a})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(n=>n.animate(e))}getAnimations(){return this.animations}}class Eje extends xv{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(n),this.onBeforeRender=null,this.AfterRender=null,e instanceof Oa?(this.model=e,this._setModelNodeProps(n)):this.model=new Oa(e,n),this.bounds=null,this.managedResources=n.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class lse{constructor(e,n){let{attributes:r,material:i,pbrDebug:o,imageBasedLightingEnvironment:a,lights:s,useTangents:u}=n;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},RE(e,Qi.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],a&&(this.uniforms.u_DiffuseEnvSampler=a.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=a.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=a.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),o&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(r.NORMAL,"HAS_NORMALS"),this.defineIfPresent(r.TANGENT&&u,"HAS_TANGENTS"),this.defineIfPresent(r.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(a,"USE_IBL"),this.defineIfPresent(s,"USE_LIGHTS"),this.defineIfPresent(o,"PBR_DEBUG"),i&&this.parseMaterial(i)}defineIfPresent(e,n){e&&(this.defines[n]=1)}parseTexture(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const i=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},o=e.texture.source.image;let a,s={};o.compressed?(a=o,s={[this.gl.TEXTURE_MIN_FILTER]:o.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):a={data:o};const u=new Pl(this.gl,{id:e.name||e.id,parameters:{...i,...s},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...a});this.uniforms[n]=u,this.defineIfPresent(r,r),this.generatedTextures.push(u)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:n=1,roughnessFactor:r=1}=e;this.uniforms.u_MetallicRoughnessValues=[n,r]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:n=1}=e.normalTexture;this.uniforms.u_NormalScale=n}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:n=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=n}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:n=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=n}else e.alphaMode==="BLEND"&&(Yn.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const Sje=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,Tje=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function Sq(t,e){return Hr(t)?`#version 300 es
`.concat(e):e}function Cje(t,e){const{id:n,drawMode:r,vertexCount:i,attributes:o,modelOptions:a}=e,s=new lse(t,e);Yn.info(4,"createGLTFModel defines: ",s.defines)();const u=[];u.push(...s.generatedTextures),u.push(...Object.values(o).map(g=>g.buffer));const d=new Eje(t,{id:n,drawMode:r,vertexCount:i,modules:[zO],parameters:s.parameters,vs:Sq(t,Sje),fs:Sq(t,Tje),managedResources:u,...a,defines:{...s.defines,...a.defines}});return d.setProps({attributes:o}),d.setUniforms(s.uniforms),d}const Pje={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ije={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class Mje{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},Ije,n)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new wje(this.gltf):null}createScene(e){const r=(e.nodes||[]).map(o=>this.createNode(o));return new gw({id:e.name||e.id,children:r})}createNode(e){if(!e._node){const r=(e.children||[]).map(o=>this.createNode(o));e.mesh&&r.push(this.createMesh(e.mesh));const i=new gw({id:e.name||e.id,children:r});if(e.matrix)i.setMatrix(e.matrix);else{if(i.matrix.identity(),e.translation&&i.matrix.translate(e.translation),e.rotation){const o=new vr().fromQuaternion(e.rotation);i.matrix.multiplyRight(o)}e.scale&&i.matrix.scale(e.scale)}e._node=i}return e._node}createMesh(e){if(!e._mesh){const r=(e.primitives||[]).map((o,a)=>this.createPrimitive(o,a,e)),i=new gw({id:e.name||e.id,children:r});e._mesh=i}return e._mesh}getVertexCount(e){Yn.warn("getVertexCount() not found")()}createPrimitive(e,n,r){const i=Cje(this.gl,Object.assign({id:e.name||"".concat(r.name||r.id,"-primitive-").concat(n),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return i.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],i}createAttributes(e,n){const r={};return Object.keys(e).forEach(i=>{r[i]=this.createAccessor(e[i],this.createBuffer(e[i],this.gl.ARRAY_BUFFER))}),n&&(r.indices=this.createAccessor(n,this.createBuffer(n,this.gl.ELEMENT_ARRAY_BUFFER))),Yn.info(4,"glTF Attributes",{attributes:e,indices:n,generated:r})(),r}createBuffer(e,n){e.bufferView||(e.bufferView={});const{bufferView:r}=e;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[n]||(r.lumaBuffers[n]=new ji(this.gl,{id:"from-".concat(r.id),data:r.data||e.value,target:n})),r.lumaBuffers[n]}createAccessor(e,n){return new wu({buffer:n,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:Pje[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function Oje(t,e,n){const r=new Mje(t,n),i=r.instantiate(e),o=r.createAnimator();return{scenes:i,animator:o}}const Rje="3.4.14",Lje="3.4.14",use="3.4.14",Dje="https://unpkg.com/@loaders.gl/textures@".concat(use,"/dist/libs/basis_encoder.wasm"),Bje="https://unpkg.com/@loaders.gl/textures@".concat(use,"/dist/libs/basis_encoder.js");let MB;async function Tq(t){const e=t.modules||{};return e.basis?e.basis:(MB=MB||Nje(t),await MB)}async function Nje(t){let e=null,n=null;return[e,n]=await Promise.all([await T0("basis_transcoder.js","textures",t),await T0("basis_transcoder.wasm","textures",t)]),e=e||globalThis.BASIS,await Fje(e,n)}function Fje(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(i=>{const{BasisFile:o,initializeBasis:a}=i;a(),r({BasisFile:o})})})}let OB;async function Cq(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(OB=OB||kje(t),await OB)}async function kje(t){let e=null,n=null;return[e,n]=await Promise.all([await T0(Bje,"textures",t),await T0(Dje,"textures",t)]),e=e||globalThis.BASIS,await zje(e,n)}function zje(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(i=>{const{BasisFile:o,KTX2File:a,initializeBasis:s,BasisEncoder:u}=i;s(),r({BasisFile:o,KTX2File:a,BasisEncoder:u})})})}const Ty={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},Uje=["","WEBKIT_","MOZ_"],Pq={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let uT=null;function Gje(t){if(!uT){t=t||jje()||void 0,uT=new Set;for(const e of Uje)for(const n in Pq)if(t&&t.getExtension("".concat(e).concat(n))){const r=Pq[n];uT.add(r)}}return uT}function jje(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var Iq,Mq,Oq,Rq,Lq,Dq,Bq,Nq;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(Iq||(Iq={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(Mq||(Mq={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(Oq||(Oq={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(Rq||(Rq={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(Lq||(Lq={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(Dq||(Dq={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(Bq||(Bq={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(Nq||(Nq={}));const rc=[171,75,84,88,32,50,48,187,13,10,26,10];function Vje(t){const e=new Uint8Array(t);return!(e.byteLength<rc.length||e[0]!==rc[0]||e[1]!==rc[1]||e[2]!==rc[2]||e[3]!==rc[3]||e[4]!==rc[4]||e[5]!==rc[5]||e[6]!==rc[6]||e[7]!==rc[7]||e[8]!==rc[8]||e[9]!==rc[9]||e[10]!==rc[10]||e[11]!==rc[11])}const $je={etc1:{basisFormat:0,compressed:!0,format:Ty.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Ty.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Ty.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Ty.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Ty.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Ty.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Hje(t,e){if(e.basis.containerFormat==="auto"){if(Vje(t)){const r=await Cq(e);return Fq(r.KTX2File,t,e)}const{BasisFile:n}=await Tq(e);return RB(n,t,e)}switch(e.basis.module){case"encoder":const n=await Cq(e);switch(e.basis.containerFormat){case"ktx2":return Fq(n.KTX2File,t,e);case"basis":default:return RB(n.BasisFile,t,e)}case"transcoder":default:const{BasisFile:r}=await Tq(e);return RB(r,t,e)}}function RB(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const i=r.getNumImages(),o=[];for(let a=0;a<i;a++){const s=r.getNumLevels(a),u=[];for(let d=0;d<s;d++)u.push(Wje(r,a,d,n));o.push(u)}return o}finally{r.close(),r.delete()}}function Wje(t,e,n,r){const i=t.getImageWidth(e,n),o=t.getImageHeight(e,n),a=t.getHasAlpha(),{compressed:s,format:u,basisFormat:d}=cse(r,a),g=t.getImageTranscodedSizeInBytes(e,n,d),_=new Uint8Array(g);if(!t.transcodeImage(_,e,n,d,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:o,data:_,compressed:s,format:u,hasAlpha:a}}function Fq(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=r.getLevels(),o=[];for(let a=0;a<i;a++){o.push(qje(r,a,n));break}return[o]}finally{r.close(),r.delete()}}function qje(t,e,n){const{alphaFlag:r,height:i,width:o}=t.getImageLevelInfo(e,0,0),{compressed:a,format:s,basisFormat:u}=cse(n,r),d=t.getImageTranscodedSizeInBytes(e,0,0,u),g=new Uint8Array(d);if(!t.transcodeImage(g,e,0,0,u,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:i,data:g,compressed:a,levelSize:d,hasAlpha:r,format:s}}function cse(t,e){let n=t&&t.basis&&t.basis.format;return n==="auto"&&(n=fse()),typeof n=="object"&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),$je[n]}function fse(){const t=Gje();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const Xje={name:"Basis",id:Kp?"basis":"basis-nodejs",module:"textures",version:Lje,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},Zje={...Xje,parse:Hje};function fc(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function hse(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return r.substr(0,r.lastIndexOf("/")+1)+t}function Yje(t,e,n){const r=t.bufferViews[n];fc(r);const i=r.buffer,o=e[i];fc(o);const a=(r.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,a,r.byteLength)}const kq=["SCALAR","VEC2","VEC3","VEC4"],Qje=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Kje=new Map(Qje),Jje={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},eVe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},tVe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function dse(t){return kq[t-1]||kq[0]}function pse(t){const e=Kje.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function cU(t,e){const n=tVe[t.componentType],r=Jje[t.type],i=eVe[t.componentType],o=t.count*r,a=t.count*r*i;return fc(a>=0&&a<=e.byteLength),{ArrayType:n,length:o,byteLength:a}}function gse(t){let{images:e,bufferViews:n}=t;e=e||[],n=n||[];const r=e.map(a=>a.bufferView);n=n.filter(a=>!r.includes(a));const i=n.reduce((a,s)=>a+s.byteLength,0),o=e.reduce((a,s)=>{const{width:u,height:d}=s.image;return a+u*d},0);return i+Math.ceil(4*o*1.33)}const nVe={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class ju{constructor(e){q(this,"gltf",void 0),q(this,"sourceBuffers",void 0),q(this,"byteLength",void 0),this.gltf=e||{json:{...nVe},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const n=this.getUsedExtensions().find(i=>i===e),r=this.json.extensions||{};return n?r[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,n){return(e.extensions||{})[n]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,n){if(typeof n=="object")return n;const r=this.json[e]&&this.json[e][n];if(!r)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(n,"]"));return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);const n=e.buffer,r=this.gltf.buffers[n];fc(r);const i=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),i=this.getBuffer(n.buffer).data,{ArrayType:o,length:a}=cU(e,n),s=n.byteOffset+e.byteOffset;return new o(i,s,a)}getTypedArrayForImageData(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),i=this.getBuffer(n.buffer).data,o=n.byteOffset||0;return new Uint8Array(i,o,n.byteLength)}addApplicationData(e,n){return this.json[e]=n,this}addExtraData(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}addObjectExtension(e,n,r){return e.extensions=e.extensions||{},e.extensions[n]=r,this.registerUsedExtension(n),this}setObjectExtension(e,n,r){const i=e.extensions||{};i[n]=r}removeObjectExtension(e,n){const r=e.extensions||{},i=r[n];return delete r[n],i}addExtension(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return fc(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}addRequiredExtension(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return fc(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:n}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(e){const{meshIndex:n,matrix:r}=e;this.json.nodes=this.json.nodes||[];const i={mesh:n};return r&&(i.matrix=r),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:n,indices:r,material:i,mode:o=4}=e,s={primitives:[{attributes:this._addAttributes(n),mode:o}]};if(r){const u=this._addIndices(r);s.primitives[0].indices=u}return Number.isFinite(i)&&(s.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,n){const r=n5(e),i=n||(r==null?void 0:r.mimeType),a={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(e){const n=e.byteLength;fc(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:0,byteOffset:this.byteLength,byteLength:n};return this.byteLength+=EE(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,n){const r={bufferView:e,type:dse(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const r=this.addBufferView(e);let i={min:n.min,max:n.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,n.size));const o={size:n.size,componentType:pse(e),count:Math.round(e.length/n.size),min:i.min,max:i.max};return this.addAccessor(r,Object.assign(o,n))}addTexture(e){const{imageIndex:n}=e,r={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,n;this.gltf.buffers=[];const r=this.byteLength,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(const s of this.sourceBuffers||[])a=dAe(s,o,a);(e=this.json)!==null&&e!==void 0&&(n=e.buffers)!==null&&n!==void 0&&n[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=i,this.sourceBuffers=[i]}_removeStringFromArray(e,n){let r=!0;for(;r;){const i=e.indexOf(n);i>-1?e.splice(i,1):r=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={};for(const r in e){const i=e[r],o=this._getGltfAttributeName(r),a=this.addBinaryBuffer(i.value,i);n[o]=a}return n}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,n){const r={min:null,max:null};if(e.length<n)return r;r.min=[],r.max=[];const i=e.subarray(0,n);for(const o of i)r.min.push(o),r.max.push(o);for(let o=n;o<e.length;o+=n)for(let a=0;a<n;a++)r.min[0+a]=Math.min(r.min[0+a],e[o+a]),r.max[0+a]=Math.max(r.max[0+a],e[o+a]);return r}}const rVe="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",iVe="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",oVe=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),sVe=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),aVe={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},lVe={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function uVe(t,e,n,r,i){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const a=await cVe();dVe(a,a.exports[lVe[i]],t,e,n,r,a.exports[aVe[o||"NONE"]])}let LB;async function cVe(){return LB||(LB=fVe()),LB}async function fVe(){let t=rVe;WebAssembly.validate(oVe)&&(t=iVe,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(hVe(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function hVe(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;++r){const i=t.charCodeAt(r);e[r]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let n=0;for(let r=0;r<t.length;++r)e[n++]=e[r]<60?sVe[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,n)}function dVe(t,e,n,r,i,o,a){const s=t.exports.sbrk,u=r+3&-4,d=s(u*i),g=s(o.length),_=new Uint8Array(t.exports.memory.buffer);_.set(o,g);const E=e(d,r,i,g,o.length);if(E===0&&a&&a(d,u,i),n.set(_.subarray(d,d+r*i)),s(d-s(0)),E!==0)throw new Error("Malformed buffer data: ".concat(E))}const fU="EXT_meshopt_compression",pVe=fU;async function gVe(t,e){var n;const r=new ju(t);if(!(e!=null&&(n=e.gltf)!==null&&n!==void 0&&n.decompressMeshes))return;const i=[];for(const o of t.json.bufferViews||[])i.push(mVe(r,o));await Promise.all(i),r.removeExtension(fU)}async function mVe(t,e){const n=t.getObjectExtension(e,fU);if(n){const{byteOffset:r=0,byteLength:i=0,byteStride:o,count:a,mode:s,filter:u="NONE",buffer:d}=n,g=t.gltf.buffers[d],_=new Uint8Array(g.arrayBuffer,g.byteOffset+r,i),E=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await uVe(E,a,o,_,s,u),E}return null}const AVe=Object.freeze(Object.defineProperty({__proto__:null,decode:gVe,name:pVe},Symbol.toStringTag,{value:"Module"})),ky="EXT_texture_webp",_Ve=ky;function yVe(t,e){const n=new ju(t);if(!h_e("image/webp")){if(n.getRequiredExtensions().includes(ky))throw new Error("gltf: Required extension ".concat(ky," not supported by browser"));return}const{json:r}=n;for(const i of r.textures||[]){const o=n.getObjectExtension(i,ky);o&&(i.source=o.source),n.removeObjectExtension(i,ky)}n.removeExtension(ky)}const vVe=Object.freeze(Object.defineProperty({__proto__:null,name:_Ve,preprocess:yVe},Symbol.toStringTag,{value:"Module"})),aP="KHR_texture_basisu",xVe=aP;function bVe(t,e){const n=new ju(t),{json:r}=n;for(const i of r.textures||[]){const o=n.getObjectExtension(i,aP);o&&(i.source=o.source),n.removeObjectExtension(i,aP)}n.removeExtension(aP)}const wVe=Object.freeze(Object.defineProperty({__proto__:null,name:xVe,preprocess:bVe},Symbol.toStringTag,{value:"Module"})),EVe="3.4.14",SVe={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},TVe={name:"Draco",id:Kp?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:EVe,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:SVe};function CVe(t,e,n){const r=mse(e.metadata),i=[],o=PVe(e.attributes);for(const a in t){const s=t[a],u=zq(a,s,o[a]);i.push(u)}if(n){const a=zq("indices",n);i.push(a)}return new lv(i,r)}function PVe(t){const e={};for(const n in t){const r=t[n];e[r.name||"undefined"]=r}return e}function zq(t,e,n){const r=n?mse(n.metadata):void 0;return cje(t,e,r)}function mse(t){const e=new Map;for(const n in t)e.set("".concat(n,".string"),JSON.stringify(t[n]));return e}const Uq={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},IVe={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},MVe=4;class OVe{constructor(e){q(this,"draco",void 0),q(this,"decoder",void 0),q(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);const i=this.decoder.GetEncodedGeometryType(r),o=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(i){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(r,o);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(r,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!o.ptr){const E="DRACO decompression failed: ".concat(a.error_msg());throw new Error(E)}const s=this._getDracoLoaderData(o,i,n),u=this._getMeshData(o,s,n),d=lU(u.attributes),g=CVe(u.attributes,s,u.indices);return{loader:"draco",loaderData:s,header:{vertexCount:o.num_points(),boundingBox:d},...u,schema:g}}finally{this.draco.destroy(r),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,n,r){const i=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,r);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:o}}_getDracoAttributes(e,n){const r={};for(let i=0;i<e.num_attributes();i++){const o=this.decoder.GetAttribute(e,i),a=this._getAttributeMetadata(e,i);r[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:i,metadata:a};const s=this._getQuantizationTransform(o,n);s&&(r[o.unique_id()].quantization_transform=s);const u=this._getOctahedronTransform(o,n);u&&(r[o.unique_id()].octahedron_transform=u)}return r}_getMeshData(e,n,r){const i=this._getMeshAttributes(n,e,r);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,n,r){const i={};for(const o of Object.values(e.attributes)){const a=this._deduceAttributeName(o,r);o.name=a;const{value:s,size:u}=this._getAttributeValues(n,o);i[a]={value:s,size:u,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}return i}_getTriangleListIndices(e){const r=e.num_faces()*3,i=r*MVe,o=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,o),new Uint32Array(this.draco.HEAPF32.buffer,o,r).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),DVe(n)}finally{this.draco.destroy(n)}}_getAttributeValues(e,n){const r=IVe[n.data_type],i=n.num_components,a=e.num_points()*i,s=a*r.BYTES_PER_ELEMENT,u=RVe(this.draco,r);let d;const g=this.draco._malloc(s);try{const _=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,_,u,s,g),d=new r(this.draco.HEAPF32.buffer,g,a).slice()}finally{this.draco._free(g)}return{value:d,size:i}}_deduceAttributeName(e,n){const r=e.unique_id;for(const[a,s]of Object.entries(n.extraAttributes||{}))if(s===r)return a;const i=e.attribute_type;for(const a in Uq)if(this.draco[a]===i)return Uq[a];const o=n.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:"CUSTOM_ATTRIBUTE_".concat(r)}_getTopLevelMetadata(e){const n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}_getAttributeMetadata(e,n){const r=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const n={},r=this.metadataQuerier.NumEntries(e);for(let i=0;i<r;i++){const o=this.metadataQuerier.GetEntryName(e,i);n[o]=this._getDracoMetadataField(e,o)}return n}_getDracoMetadataField(e,n){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,r);const i=LVe(r);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:i}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:n=[],octahedronAttributes:r=[]}=e,i=[...n,...r];for(const o of i)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,n){const{quantizedAttributes:r=[]}=n,i=e.attribute_type();if(r.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(s=>a.min_value(s))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(e,n){const{octahedronAttributes:r=[]}=n,i=e.attribute_type();if(r.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}}function RVe(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function LVe(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}function DVe(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}const BVe="1.5.5",hU="https://www.gstatic.com/draco/versioned/decoders/".concat(BVe),NVe="".concat(hU,"/draco_decoder.js"),FVe="".concat(hU,"/draco_wasm_wrapper.js"),kVe="".concat(hU,"/draco_decoder.wasm");let Sb;async function zVe(t){const e=t.modules||{};return e.draco3d?Sb=Sb||e.draco3d.createDecoderModule({}).then(n=>({draco:n})):Sb=Sb||UVe(t),await Sb}async function UVe(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await T0(NVe,"draco",t);break;case"wasm":default:[e,n]=await Promise.all([await T0(FVe,"draco",t),await T0(kVe,"draco",t)])}return e=e||globalThis.DracoDecoderModule,await GVe(e,n)}function GVe(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t({...n,onModuleLoaded:i=>r({draco:i})})})}const Ase={...TVe,parse:jVe};async function jVe(t,e){const{draco:n}=await zVe(e),r=new OVe(n);try{return r.parseSync(t,e==null?void 0:e.draco)}finally{r.destroy()}}function VVe(t){const e={};for(const n in t){const r=t[n];if(n!=="indices"){const i=_se(r);e[n]=i}}return e}function _se(t){const{buffer:e,size:n,count:r}=$Ve(t);return{value:e,size:n,byteOffset:0,count:r,type:dse(n),componentType:pse(e)}}function $Ve(t){let e=t,n=1,r=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=HVe(e,Float32Array)),r=e.length/n),{buffer:e,size:n,count:r}}function HVe(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return t?Array.isArray(t)?new e(t):n&&!(t instanceof e)?new e(t):t:null}const n_="KHR_draco_mesh_compression",WVe=n_;function qVe(t,e,n){const r=new ju(t);for(const i of yse(r))r.getObjectExtension(i,n_)}async function XVe(t,e,n){var r;if(!(e!=null&&(r=e.gltf)!==null&&r!==void 0&&r.decompressMeshes))return;const i=new ju(t),o=[];for(const a of yse(i))i.getObjectExtension(a,n_)&&o.push(YVe(i,a,e,n));await Promise.all(o),i.removeExtension(n_)}function ZVe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new ju(t);for(const r of n.json.meshes||[])QVe(r,e),n.addRequiredExtension(n_)}async function YVe(t,e,n,r){const i=t.getObjectExtension(e,n_);if(!i)return;const o=t.getTypedArrayForBufferView(i.bufferView),a=qz(o.buffer,o.byteOffset),{parse:s}=r,u={...n};delete u["3d-tiles"];const d=await s(a,Ase,u,r),g=VVe(d.attributes);for(const[_,E]of Object.entries(g))if(_ in e.attributes){const P=e.attributes[_],R=t.getAccessor(P);R!=null&&R.min&&R!==null&&R!==void 0&&R.max&&(E.min=R.min,E.max=R.max)}e.attributes=g,d.indices&&(e.indices=_se(d.indices)),KVe(e)}function QVe(t,e){var n;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const a=i.DracoWriter.encodeSync({attributes:t}),s=o==null||(n=o.parseSync)===null||n===void 0?void 0:n.call(o,{attributes:t}),u=i._addFauxAttributes(s.attributes),d=i.addBufferView(a);return{primitives:[{attributes:u,mode:r,extensions:{[n_]:{bufferView:d,attributes:u}}}]}}function KVe(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*yse(t){for(const e of t.json.meshes||[])for(const n of e.primitives)yield n}const JVe=Object.freeze(Object.defineProperty({__proto__:null,decode:XVe,encode:ZVe,name:WVe,preprocess:qVe},Symbol.toStringTag,{value:"Module"})),e9e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},t9e={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},dU="KHR_texture_transform",n9e=dU,cT=new yt,r9e=new is,i9e=new is;async function o9e(t,e){if(!new ju(t).getExtension(dU))return;const i=t.json.materials||[];for(let o=0;o<i.length;o++)s9e(o,t)}function s9e(t,e){var n,r,i;const o=[],a=(n=e.json.materials)===null||n===void 0?void 0:n[t],s=a==null||(r=a.pbrMetallicRoughness)===null||r===void 0?void 0:r.baseColorTexture;s&&Tb(e,t,s,o);const u=a==null?void 0:a.emissiveTexture;u&&Tb(e,t,u,o);const d=a==null?void 0:a.normalTexture;d&&Tb(e,t,d,o);const g=a==null?void 0:a.occlusionTexture;g&&Tb(e,t,g,o);const _=a==null||(i=a.pbrMetallicRoughness)===null||i===void 0?void 0:i.metallicRoughnessTexture;_&&Tb(e,t,_,o)}function Tb(t,e,n,r){const i=a9e(n,r);if(!i)return;const o=t.json.meshes||[];for(const a of o)for(const s of a.primitives){const u=s.material;Number.isFinite(u)&&e===u&&l9e(t,s,i)}}function a9e(t,e){var n;const r=(n=t.extensions)===null||n===void 0?void 0:n[dU],{texCoord:i=0}=t,{texCoord:o=i}=r;if(!(e.findIndex(s=>{let[u,d]=s;return u===i&&d===o})!==-1)){const s=f9e(r);return i!==o&&(t.texCoord=o),e.push([i,o]),{originalTexCoord:i,texCoord:o,matrix:s}}return null}function l9e(t,e,n){const{originalTexCoord:r,texCoord:i,matrix:o}=n,a=e.attributes["TEXCOORD_".concat(r)];if(Number.isFinite(a)){var s;const d=(s=t.json.accessors)===null||s===void 0?void 0:s[a];if(d&&d.bufferView){var u;const g=(u=t.json.bufferViews)===null||u===void 0?void 0:u[d.bufferView];if(g){const{arrayBuffer:_,byteOffset:E}=t.buffers[g.buffer],P=(E||0)+(d.byteOffset||0)+(g.byteOffset||0),{ArrayType:R,length:B}=cU(d,g),V=t9e[d.componentType],z=e9e[d.type],F=g.byteStride||V*z,k=new Float32Array(B);for(let X=0;X<d.count;X++){const Y=new R(_,P+X*F,2);cT.set(Y[0],Y[1],1),cT.transformByMatrix3(o),k.set([cT[0],cT[1]],X*z)}r===i?u9e(d,g,t.buffers,k):c9e(i,d,e,t,k)}}}}function u9e(t,e,n,r){t.componentType=5126,n.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=n.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function c9e(t,e,n,r,i){r.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const o=r.json.bufferViews;if(!o)return;o.push({buffer:r.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const a=r.json.accessors;a&&(a.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),n.attributes["TEXCOORD_".concat(t)]=a.length-1)}function f9e(t){const{offset:e=[0,0],rotation:n=0,scale:r=[1,1]}=t,i=new is().set(1,0,0,0,1,0,e[0],e[1],1),o=r9e.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),a=i9e.set(r[0],0,0,0,r[1],0,0,0,1);return i.multiplyRight(o).multiplyRight(a)}const h9e=Object.freeze(Object.defineProperty({__proto__:null,decode:o9e,name:n9e},Symbol.toStringTag,{value:"Module"})),w0="KHR_lights_punctual",d9e=w0;async function p9e(t){const e=new ju(t),{json:n}=e,r=e.getExtension(w0);r&&(e.json.lights=r.lights,e.removeExtension(w0));for(const i of n.nodes||[]){const o=e.getObjectExtension(i,w0);o&&(i.light=o.light),e.removeObjectExtension(i,w0)}}async function g9e(t){const e=new ju(t),{json:n}=e;if(n.lights){const r=e.addExtension(w0);fc(!r.lights),r.lights=n.lights,delete n.lights}if(e.json.lights){for(const r of e.json.lights){const i=r.node;e.addObjectExtension(i,w0,r)}delete e.json.lights}}const m9e=Object.freeze(Object.defineProperty({__proto__:null,decode:p9e,encode:g9e,name:d9e},Symbol.toStringTag,{value:"Module"})),hE="KHR_materials_unlit",A9e=hE;async function _9e(t){const e=new ju(t),{json:n}=e;for(const r of n.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,hE);e.removeExtension(hE)}function y9e(t){const e=new ju(t),{json:n}=e;if(e.materials)for(const r of n.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,hE,{}),e.addExtension(hE))}const v9e=Object.freeze(Object.defineProperty({__proto__:null,decode:_9e,encode:y9e,name:A9e},Symbol.toStringTag,{value:"Module"})),Qb="KHR_techniques_webgl",x9e=Qb;async function b9e(t){const e=new ju(t),{json:n}=e,r=e.getExtension(Qb);if(r){const i=E9e(r,e);for(const o of n.materials||[]){const a=e.getObjectExtension(o,Qb);a&&(o.technique=Object.assign({},a,i[a.technique]),o.technique.values=S9e(o.technique,e)),e.removeObjectExtension(o,Qb)}e.removeExtension(Qb)}}async function w9e(t,e){}function E9e(t,e){const{programs:n=[],shaders:r=[],techniques:i=[]}=t,o=new TextDecoder;return r.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=o.decode(e.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(a=>{a.fragmentShader=r[a.fragmentShader],a.vertexShader=r[a.vertexShader]}),i.forEach(a=>{a.program=n[a.program]}),i}function S9e(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(r=>{t.uniforms[r].value&&!(r in n)&&(n[r]=t.uniforms[r].value)}),Object.keys(n).forEach(r=>{typeof n[r]=="object"&&n[r].index!==void 0&&(n[r].texture=e.getTexture(n[r].index))}),n}const T9e=Object.freeze(Object.defineProperty({__proto__:null,decode:b9e,encode:w9e,name:x9e},Symbol.toStringTag,{value:"Module"})),vse="EXT_feature_metadata",C9e=vse;async function P9e(t){const e=new ju(t);I9e(e)}function I9e(t){var e;const n=t.getExtension(vse),r=n==null||(e=n.schema)===null||e===void 0?void 0:e.classes,i=n==null?void 0:n.featureTables;if((n==null?void 0:n.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),r&&i)for(const a in r){const s=r[a],u=R9e(i,a);u&&M9e(t,u,s)}}function M9e(t,e,n){for(const i in n.properties){var r;const o=n.properties[i],a=e==null||(r=e.properties)===null||r===void 0?void 0:r[i],s=e.count;if(a){const u=O9e(t,o,s,a);a.data=u}}}function O9e(t,e,n,r){const i=r.bufferView;let o=t.getTypedArrayForBufferView(i);switch(e.type){case"STRING":{const a=r.stringOffsetBufferView,s=t.getTypedArrayForBufferView(a);o=L9e(o,s,n);break}}return o}function R9e(t,e){for(const n in t){const r=t[n];if(r.class===e)return r}return null}function L9e(t,e,n){const r=[],i=new TextDecoder("utf8");let o=0;const a=4;for(let s=0;s<n;s++){const u=e[(s+1)*a]-e[s*a],d=t.subarray(o,u+o),g=i.decode(d);r.push(g),o+=u}return r}const D9e=Object.freeze(Object.defineProperty({__proto__:null,decode:P9e,name:C9e},Symbol.toStringTag,{value:"Module"})),xse=[AVe,vVe,wVe,JVe,m9e,v9e,T9e,h9e,D9e];function B9e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=xse.filter(o=>bse(o.name,e));for(const o of r){var i;(i=o.preprocess)===null||i===void 0||i.call(o,t,e,n)}}async function N9e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=xse.filter(o=>bse(o.name,e));for(const o of r){var i;await((i=o.decode)===null||i===void 0?void 0:i.call(o,t,e,n))}}function bse(t,e){var n;const r=(e==null||(n=e.gltf)===null||n===void 0?void 0:n.excludeExtensions)||{};return!(t in r&&!r[t])}const DB="KHR_binary_glTF";function F9e(t){const e=new ju(t),{json:n}=e;for(const r of n.images||[]){const i=e.getObjectExtension(r,DB);i&&Object.assign(r,i),e.removeObjectExtension(r,DB)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(DB)}const Gq={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},k9e={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class z9e{constructor(){q(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),q(this,"json",void 0)}normalize(e,n){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(r.asset.version));return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),F9e(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const n in Gq)this._convertTopLevelObjectToArray(e,n)}_convertTopLevelObjectToArray(e,n){const r=e[n];if(!(!r||Array.isArray(r))){e[n]=[];for(const i in r){const o=r[i];o.id=o.id||i;const a=e[n].length;e[n].push(o),this.idToIndexMap[n][i]=a}}}_convertObjectIdsToArrayIndices(e){for(const n in Gq)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const n of e.textures)this._convertTextureIds(n);for(const n of e.meshes)this._convertMeshIds(n);for(const n of e.nodes)this._convertNodeIds(n);for(const n of e.scenes)this._convertSceneIds(n)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const n of e.primitives){const{attributes:r,indices:i,material:o}=n;for(const a in r)r[a]=this._convertIdToIndex(r[a],"accessor");i&&(n.indices=this._convertIdToIndex(i,"accessor")),o&&(n.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(n=>this._convertIdToIndex(n,"node"))),e.meshes&&(e.meshes=e.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(e,n){e[n]||(console.warn("gltf v1: json doesn't contain attribute ".concat(n)),e[n]=[]);for(const r of e[n])for(const i in r){const o=r[i],a=this._convertIdToIndex(o,i);r[i]=a}}_convertIdToIndex(e,n){const r=k9e[n];if(r in this.idToIndexMap){const i=this.idToIndexMap[r][e];if(!Number.isFinite(i))throw new Error("gltf v1: failed to resolve ".concat(n," with id ").concat(e));return i}return e}_updateObjects(e){for(const n of this.json.buffers)delete n.type}_updateMaterial(e){for(const o of e.materials){var n,r,i;o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const a=((n=o.values)===null||n===void 0?void 0:n.tex)||((r=o.values)===null||r===void 0?void 0:r.texture2d_0)||((i=o.values)===null||i===void 0?void 0:i.diffuseTex),s=e.textures.findIndex(u=>u.id===a);s!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:s})}}}function U9e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new z9e().normalize(t,e)}const G9e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},j9e={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},rf={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},V9e={magFilter:rf.TEXTURE_MAG_FILTER,minFilter:rf.TEXTURE_MIN_FILTER,wrapS:rf.TEXTURE_WRAP_S,wrapT:rf.TEXTURE_WRAP_T},$9e={[rf.TEXTURE_MAG_FILTER]:rf.LINEAR,[rf.TEXTURE_MIN_FILTER]:rf.NEAREST_MIPMAP_LINEAR,[rf.TEXTURE_WRAP_S]:rf.REPEAT,[rf.TEXTURE_WRAP_T]:rf.REPEAT};function H9e(t){return j9e[t]}function W9e(t){return G9e[t]}class q9e{constructor(){q(this,"baseUri",""),q(this,"json",{}),q(this,"buffers",[]),q(this,"images",[])}postProcess(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:r,buffers:i=[],images:o=[],baseUri:a=""}=e;return fc(r),this.baseUri=a,this.json=r,this.buffers=i,this.images=o,this._resolveTree(this.json,n),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map((n,r)=>this._resolveBufferView(n,r))),e.images&&(e.images=e.images.map((n,r)=>this._resolveImage(n,r))),e.samplers&&(e.samplers=e.samplers.map((n,r)=>this._resolveSampler(n,r))),e.textures&&(e.textures=e.textures.map((n,r)=>this._resolveTexture(n,r))),e.accessors&&(e.accessors=e.accessors.map((n,r)=>this._resolveAccessor(n,r))),e.materials&&(e.materials=e.materials.map((n,r)=>this._resolveMaterial(n,r))),e.meshes&&(e.meshes=e.meshes.map((n,r)=>this._resolveMesh(n,r))),e.nodes&&(e.nodes=e.nodes.map((n,r)=>this._resolveNode(n,r))),e.skins&&(e.skins=e.skins.map((n,r)=>this._resolveSkin(n,r))),e.scenes&&(e.scenes=e.scenes.map((n,r)=>this._resolveScene(n,r))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,n){if(typeof n=="object")return n;const r=this.json[e]&&this.json[e][n];return r||console.warn("glTF file error: Could not find ".concat(e,"[").concat(n,"]")),r}_resolveScene(e,n){return e.id=e.id||"scene-".concat(n),e.nodes=(e.nodes||[]).map(r=>this.getNode(r)),e}_resolveNode(e,n){return e.id=e.id||"node-".concat(n),e.children&&(e.children=e.children.map(r=>this.getNode(r))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((r,i)=>{const o=this.getMesh(i);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,n){return e.id=e.id||"skin-".concat(n),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,n){return e.id=e.id||"mesh-".concat(n),e.primitives&&(e.primitives=e.primitives.map(r=>{r={...r};const i=r.attributes;r.attributes={};for(const o in i)r.attributes[o]=this.getAccessor(i[o]);return r.indices!==void 0&&(r.indices=this.getAccessor(r.indices)),r.material!==void 0&&(r.material=this.getMaterial(r.material)),r})),e}_resolveMaterial(e,n){if(e.id=e.id||"material-".concat(n),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const r=e.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,n){if(e.id=e.id||"accessor-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=H9e(e.componentType),e.components=W9e(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const r=e.bufferView.buffer,{ArrayType:i,byteLength:o}=cU(e,e.bufferView),a=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+r.byteOffset;let s=r.arrayBuffer.slice(a,a+o);e.bufferView.byteStride&&(s=this._getValueFromInterleavedBuffer(r,a,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new i(s)}return e}_getValueFromInterleavedBuffer(e,n,r,i,o){const a=new Uint8Array(o*i);for(let s=0;s<o;s++){const u=n+s*r;a.set(new Uint8Array(e.arrayBuffer.slice(u,u+i)),s*i)}return a.buffer}_resolveTexture(e,n){return e.id=e.id||"texture-".concat(n),e.sampler="sampler"in e?this.getSampler(e.sampler):$9e,e.source=this.getImage(e.source),e}_resolveSampler(e,n){e.id=e.id||"sampler-".concat(n),e.parameters={};for(const r in e){const i=this._enumSamplerParameter(r);i!==void 0&&(e.parameters[i]=e[r])}return e}_enumSamplerParameter(e){return V9e[e]}_resolveImage(e,n){e.id=e.id||"image-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const r=this.images[n];return r&&(e.image=r),e}_resolveBufferView(e,n){const r=e.buffer,i={id:"bufferView-".concat(n),...e,buffer:this.buffers[r]},o=this.buffers[r].arrayBuffer;let a=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(a+=e.byteOffset),i.data=new Uint8Array(o,a,e.byteLength),i}_resolveCamera(e,n){return e.id=e.id||"camera-".concat(n),e.perspective,e.orthographic,e}}function X9e(t,e){return new q9e().postProcess(t,e)}const jq=1735152710,pU=12,iM=8,Z9e=1313821514,Y9e=5130562,Q9e=0,K9e=1,J9e=0,y1=!0;function e$e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}function t$e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new DataView(t),{magic:i=jq}=n,o=r.getUint32(e,!1);return o===i||o===jq}function n$e(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e),i=e$e(r,n+0),o=r.getUint32(n+4,y1),a=r.getUint32(n+8,y1);switch(Object.assign(t,{header:{byteOffset:n,byteLength:a,hasBinChunk:!1},type:i,version:o,json:{},binChunks:[]}),n+=pU,t.version){case 1:return r$e(t,r,n);case 2:return i$e(t,r,n,{});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}function r$e(t,e,n){co(t.header.byteLength>pU+iM);const r=e.getUint32(n+0,y1),i=e.getUint32(n+4,y1);return n+=iM,co(i===J9e),S4(t,e,n,r),n+=r,n+=T4(t,e,n,t.header.byteLength),n}function i$e(t,e,n,r){return co(t.header.byteLength>pU+iM),o$e(t,e,n,r),n+t.header.byteLength}function o$e(t,e,n,r){for(;n+8<=t.header.byteLength;){const i=e.getUint32(n+0,y1),o=e.getUint32(n+4,y1);switch(n+=iM,o){case Z9e:S4(t,e,n,i);break;case Y9e:T4(t,e,n,i);break;case Q9e:r.strict||S4(t,e,n,i);break;case K9e:r.strict||T4(t,e,n,i);break}n+=EE(i,4)}return n}function S4(t,e,n,r){const i=new Uint8Array(e.buffer,n,r),a=new TextDecoder("utf8").decode(i);return t.json=JSON.parse(a),EE(r,4)}function T4(t,e,n,r){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:r,arrayBuffer:e.buffer}),EE(r,4)}async function s$e(t,e){var n,r,i,o;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;a$e(t,e,a,s),U9e(t,{normalize:s==null||(n=s.gltf)===null||n===void 0?void 0:n.normalize}),B9e(t,s,u);const d=[];if(s!=null&&(r=s.gltf)!==null&&r!==void 0&&r.loadBuffers&&t.json.buffers&&await l$e(t,s,u),s!=null&&(i=s.gltf)!==null&&i!==void 0&&i.loadImages){const _=u$e(t,s,u);d.push(_)}const g=N9e(t,s,u);return d.push(g),await Promise.all(d),s!=null&&(o=s.gltf)!==null&&o!==void 0&&o.postProcess?X9e(t,s):t}function a$e(t,e,n,r){if(r.uri&&(t.baseUri=r.uri),e instanceof ArrayBuffer&&!t$e(e,n,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=cAe(e);else if(e instanceof ArrayBuffer){const a={};n=n$e(a,e,n,r.glb),fc(a.type==="glTF","Invalid GLB magic string ".concat(a.type)),t._glb=a,t.json=a.json}else fc(!1,"GLTF: must be ArrayBuffer or string");const i=t.json.buffers||[];if(t.buffers=new Array(i.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:a}=t._glb;t.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}async function l$e(t,e,n){const r=t.json.buffers||[];for(let a=0;a<r.length;++a){const s=r[a];if(s.uri){var i,o;const{fetch:u}=n;fc(u);const d=hse(s.uri,e),g=await(n==null||(i=n.fetch)===null||i===void 0?void 0:i.call(n,d)),_=await(g==null||(o=g.arrayBuffer)===null||o===void 0?void 0:o.call(g));t.buffers[a]={arrayBuffer:_,byteOffset:0,byteLength:_.byteLength},delete s.uri}else t.buffers[a]===null&&(t.buffers[a]={arrayBuffer:new ArrayBuffer(s.byteLength),byteOffset:0,byteLength:s.byteLength})}}async function u$e(t,e,n){const r=c$e(t),i=t.json.images||[],o=[];for(const a of r)o.push(f$e(t,i[a],a,e,n));return await Promise.all(o)}function c$e(t){const e=new Set,n=t.json.textures||[];for(const r of n)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function f$e(t,e,n,r,i){const{fetch:o,parse:a}=i;let s;if(e.uri&&!e.hasOwnProperty("bufferView")){const d=hse(e.uri,r);s=await(await o(d)).arrayBuffer(),e.bufferView={data:s}}if(Number.isFinite(e.bufferView)){const d=Yje(t.json,t.buffers,e.bufferView);s=qz(d.buffer,d.byteOffset,d.byteLength)}fc(s,"glTF image has no data");let u=await a(s,[Bw,Zje],{mimeType:e.mimeType,basis:r.basis||{format:fse()}},i);u&&u[0]&&(u={compressed:!0,mipmaps:!1,width:u[0].width,height:u[0].height,data:u[0]}),t.images=t.images||[],t.images[n]=u}const dE={name:"glTF",id:"gltf",module:"gltf",version:Rje,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:h$e,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function h$e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;e={...dE.options,...e},e.gltf={...dE.options.gltf,...e.gltf};const{byteOffset:r=0}=e;return await s$e({},t,r,e,n)}async function d$e(t){const e=[];return t.scenes.forEach(n=>{n.traverse(r=>{Object.values(r.model.getUniforms()).forEach(i=>{i.loaded===!1&&e.push(i)})})}),await p$e(()=>e.some(n=>!n.loaded))}async function p$e(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const g$e=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,m$e=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,wse=[255,255,255,255],A$e={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:wse},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[dE]};class uL extends nl{constructor(...e){super(...e),q(this,"state",void 0)}getShaders(){const e=[Mc,Oc];return this.props._lighting==="pbr"&&e.push(zO),super.getShaders({vs:g$e,fs:m$e,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:wse,transition:!0},instanceModelMatrix:tse})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;n.scenegraph!==r.scenegraph?this._updateScenegraph():n._animations!==r._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,n._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}_updateScenegraph(){const e=this.props,{gl:n}=this.context;let r=null;if(e.scenegraph instanceof xv)r={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const s=e.scenegraph,u=Oje(n,s,this._getModelOptions());r={gltf:s,...u},d$e(u).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(Or.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),r=e.scenegraph);const i={layer:this,gl:n},o=e.getScene(r,i),a=e.getAnimator(r,i);o instanceof xv?(this._deleteScenegraph(),this._applyAllAttributes(o),this._applyAnimationsProp(o,a,e._animations),this.setState({scenegraph:o,animator:a})):o!==null&&Or.warn("invalid scenegraph:",o)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const n=this.getAttributeManager().getAttributes();e.traverse(r=>{this._setModelAttributes(r.model,n)})}}_applyAnimationsProp(e,n,r){if(!e||!n||!r)return;const i=n.getAnimations();Object.keys(r).sort().forEach(o=>{const a=r[o];if(o==="*")i.forEach(s=>{Object.assign(s,a)});else if(Number.isFinite(Number(o))){const s=Number(o);s>=0&&s<i.length?Object.assign(i[s],a):Or.warn("animation ".concat(o," not found"))()}else{const s=i.find(({name:u})=>u===o);s?Object.assign(s,a):Or.warn("animation ".concat(o," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof xv&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let n=null;return e&&(typeof e=="function"?n=e({gl:this.context.gl,layer:this}):n=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:n,modelOptions:{isInstanced:!0,transpileToGLSL100:!Hr(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(n=>{this._setModelAttributes(n.model,e)})}draw({moduleParameters:e=null,parameters:n={},context:r}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(r.timeline.getTime()),this.setNeedsRedraw());const{viewport:i}=this.context,{sizeScale:o,sizeMinPixels:a,sizeMaxPixels:s,opacity:u,coordinateSystem:d}=this.props,g=this.getNumInstances();this.state.scenegraph.traverse((_,{worldMatrix:E})=>{_.model.setInstanceCount(g),_.updateModuleSettings(e),_.draw({parameters:n,uniforms:{sizeScale:o,opacity:u,sizeMinPixels:a,sizeMaxPixels:s,composeModelMatrix:nse(i,d),sceneModelMatrix:E,u_Camera:_.model.getUniforms().project_uCameraPosition}})})}}q(uL,"defaultProps",A$e);q(uL,"layerName","ScenegraphLayer");const _$e=Object.freeze(Object.defineProperty({__proto__:null,ScenegraphLayer:uL,SimpleMeshLayer:_1},Symbol.toStringTag,{value:"Module"})),y$e=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,v$e=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function x$e(t){t.COLOR_0||t.colors||(t.colors={constant:!0,value:new Float32Array([1,1,1])})}const b$e={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class gU extends _1{getShaders(){const e=super.getShaders();return e.modules.push(zO),{...e,vs:y$e,fs:v$e}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const n=this.getAttributeManager();e&&n.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;n.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(n.pbrMaterial)}draw(e){const{featureIds:n}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!n}),super.draw(e))}getModel(e){const{id:n,pbrMaterial:r}=this.props,i=this.parseMaterial(r,e);this.setState({materialParser:i});const o=this.getShaders();return x$e(e.attributes),new Oa(this.context.gl,{...this.getShaders(),id:n,geometry:e,defines:{...o.defines,...i==null?void 0:i.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:i==null?void 0:i.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:n}=this.state;if(n){const{mesh:r}=this.props,i=this.parseMaterial(e,r);this.setState({materialParser:i}),n.setUniforms(i.uniforms)}}parseMaterial(e,n){var r;const i=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(r=this.state.materialParser)===null||r===void 0||r.delete(),new lse(this.context.gl,{attributes:{NORMAL:n.attributes.normals,TEXCOORD_0:n.attributes.texCoords},material:{unlit:i,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const n=this.props.featureIds,r=new Uint8ClampedArray(n.length*e.size),i=[];for(let o=0;o<n.length;o++)this.encodePickingColor(n[o],i),r[o*3]=i[0],r[o*3+1]=i[1],r[o*3+2]=i[2];e.value=r}finalizeState(e){var n;super.finalizeState(e),(n=this.state.materialParser)===null||n===void 0||n.delete(),this.setState({materialParser:null})}}q(gU,"layerName","MeshLayer");q(gU,"defaultProps",b$e);const w$e=6378137,E$e=6378137,S$e=6356752314245179e-9;function cL(t){return t}new yt;function T$e(t,e=[],n=cL){return"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):"x"in t?(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function C$e(t,e=[]){return T$e(t,e,fo._cartographicRadians?cL:vte)}function P$e(t,e,n=cL){return"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):"x"in e?(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function I$e(t,e){return P$e(t,e,fo._cartographicRadians?cL:xte)}const Cy=new yt,M$e=new yt,O$e=new yt;function R$e(t,e,n=[]){const{oneOverRadii:r,oneOverRadiiSquared:i,centerToleranceSquared:o}=e;Cy.from(t);const a=Cy.x,s=Cy.y,u=Cy.z,d=r.x,g=r.y,_=r.z,E=a*a*d*d,P=s*s*g*g,R=u*u*_*_,B=E+P+R,V=Math.sqrt(1/B);if(!Number.isFinite(V))return;const z=M$e;if(z.copy(t).scale(V),B<o)return z.to(n);const F=i.x,k=i.y,X=i.z,Y=O$e;Y.set(z.x*F*2,z.y*k*2,z.z*X*2);let J=(1-V)*Cy.len()/(.5*Y.len()),ie=0,ce,re,ue,se;do{J-=ie,ce=1/(1+J*F),re=1/(1+J*k),ue=1/(1+J*X);const me=ce*ce,Ce=re*re,be=ue*ue,Ye=me*ce,tt=Ce*re,pt=be*ue;se=E*me+P*Ce+R*be-1;const Ne=-2*(E*Ye*F+P*tt*k+R*pt*X);ie=se/Ne}while(Math.abs(se)>Fv.EPSILON12);return Cy.scale([ce,re,ue]).to(n)}const Vq=1e-14,L$e=new yt,$q={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},BB={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Cb={east:new yt,north:new yt,up:new yt,west:new yt,south:new yt,down:new yt},D$e=new yt,B$e=new yt,N$e=new yt;function Hq(t,e,n,r,i,o){const a=$q[e]&&$q[e][n];ac(a&&(!r||r===a));let s,u,d;const g=L$e.copy(i);if(Sl(g.x,0,Vq)&&Sl(g.y,0,Vq)){const E=Math.sign(g.z);s=D$e.fromArray(BB[e]),e!=="east"&&e!=="west"&&s.scale(E),u=B$e.fromArray(BB[n]),n!=="east"&&n!=="west"&&u.scale(E),d=N$e.fromArray(BB[r]),r!=="east"&&r!=="west"&&d.scale(E)}else{const{up:E,east:P,north:R}=Cb;P.set(-g.y,g.x,0).normalize(),t.geodeticSurfaceNormal(g,E),R.copy(E).cross(P);const{down:B,west:V,south:z}=Cb;B.copy(E).scale(-1),V.copy(P).scale(-1),z.copy(R).scale(-1),s=Cb[e],u=Cb[n],d=Cb[r]}return o[0]=s.x,o[1]=s.y,o[2]=s.z,o[3]=0,o[4]=u.x,o[5]=u.y,o[6]=u.z,o[7]=0,o[8]=d.x,o[9]=d.y,o[10]=d.z,o[11]=0,o[12]=g.x,o[13]=g.y,o[14]=g.z,o[15]=1,o}const fT=new yt,Wq=new yt,F$e=new yt,oh=new yt,k$e=new yt,hT=new yt;class ss{constructor(e=0,n=0,r=0){q(this,"radii",void 0),q(this,"radiiSquared",void 0),q(this,"radiiToTheFourth",void 0),q(this,"oneOverRadii",void 0),q(this,"oneOverRadiiSquared",void 0),q(this,"minimumRadius",void 0),q(this,"maximumRadius",void 0),q(this,"centerToleranceSquared",Fv.EPSILON1),q(this,"squaredXOverSquaredZ",void 0),ac(e>=0),ac(n>=0),ac(r>=0),this.radii=new yt(e,n,r),this.radiiSquared=new yt(e*e,n*n,r*r),this.radiiToTheFourth=new yt(e*e*e*e,n*n*n*n,r*r*r*r),this.oneOverRadii=new yt(e===0?0:1/e,n===0?0:1/n,r===0?0:1/r),this.oneOverRadiiSquared=new yt(e===0?0:1/(e*e),n===0?0:1/(n*n),r===0?0:1/(r*r)),this.minimumRadius=Math.min(e,n,r),this.maximumRadius=Math.max(e,n,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,n=[0,0,0]){const r=Wq,i=F$e,[,,o]=e;this.geodeticSurfaceNormalCartographic(e,r),i.copy(this.radiiSquared).scale(r);const a=Math.sqrt(r.dot(i));return i.scale(1/a),r.scale(o),i.add(r),i.to(n)}cartesianToCartographic(e,n=[0,0,0]){hT.from(e);const r=this.scaleToGeodeticSurface(hT,oh);if(!r)return;const i=this.geodeticSurfaceNormal(r,Wq),o=k$e;o.copy(hT).subtract(r);const a=Math.atan2(i.y,i.x),s=Math.asin(i.z),u=Math.sign(x5(o,hT))*v5(o);return I$e([a,s,u],n)}eastNorthUpToFixedFrame(e,n=new vr){return Hq(this,"east","north","up",e,n)}localFrameToFixedFrame(e,n,r,i,o=new vr){return Hq(this,e,n,r,i,o)}geocentricSurfaceNormal(e,n=[0,0,0]){return fT.from(e).normalize().to(n)}geodeticSurfaceNormalCartographic(e,n=[0,0,0]){const r=C$e(e),i=r[0],o=r[1],a=Math.cos(o);return fT.set(a*Math.cos(i),a*Math.sin(i),Math.sin(o)).normalize(),fT.to(n)}geodeticSurfaceNormal(e,n=[0,0,0]){return fT.from(e).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(e,n){return R$e(e,this,n)}scaleToGeocentricSurface(e,n=[0,0,0]){oh.from(e);const r=oh.x,i=oh.y,o=oh.z,a=this.oneOverRadiiSquared,s=1/Math.sqrt(r*r*a.x+i*i*a.y+o*o*a.z);return oh.multiplyScalar(s).to(n)}transformPositionToScaledSpace(e,n=[0,0,0]){return oh.from(e).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(e,n=[0,0,0]){return oh.from(e).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(e,n=0,r=[0,0,0]){ac(Sl(this.radii.x,this.radii.y,Fv.EPSILON15)),ac(this.radii.z>0),oh.from(e);const i=oh.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-n))return oh.set(0,0,i).to(r)}}q(ss,"WGS84",new ss(w$e,E$e,S$e));function qq(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Xq{constructor(e,n){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=qq(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(qq()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class z$e{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof Xq?i=e:i=new Xq(n,r),this.stats[n]=i),i}}class U$e{constructor(e,n,r){q(this,"item",void 0),q(this,"previous",void 0),q(this,"next",void 0),this.item=e,this.previous=n,this.next=r}}class G$e{constructor(){q(this,"head",null),q(this,"tail",null),q(this,"_length",0)}get length(){return this._length}add(e){const n=new U$e(e,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,n){e!==n&&(this.remove(n),this._insert(e,n))}_insert(e,n){const r=e.next;e.next=n,this.tail===e?this.tail=n:r.previous=n,n.next=r,n.previous=e,++this._length}}class j$e{constructor(){q(this,"_list",void 0),q(this,"_sentinel",void 0),q(this,"_trimTiles",void 0),this._list=new G$e,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const n=e._cacheNode;n&&this._list.splice(this._sentinel,n)}add(e,n,r){n._cacheNode||(n._cacheNode=this._list.add(n),r&&r(e,n))}unloadTile(e,n,r){const i=n._cacheNode;i&&(this._list.remove(i),n._cacheNode=null,r&&r(e,n))}unloadTiles(e,n){const r=this._trimTiles;this._trimTiles=!1;const i=this._list,o=e.maximumMemoryUsage*1024*1024,a=this._sentinel;let s=i.head;for(;s!==a&&(e.gpuMemoryUsageInBytes>o||r);){const u=s.item;s=s.next,this.unloadTile(e,u,n)}}trim(){this._trimTiles=!0}}function V$e(t,e){co(t),co(e);const{rtcCenter:n,gltfUpAxis:r}=e,{computedTransform:i,boundingVolume:{center:o}}=t;let a=new vr(i);switch(n&&a.translate(n),r){case"Z":break;case"Y":const _=new vr().rotateX(Math.PI/2);a=a.multiplyRight(_);break;case"X":const E=new vr().rotateY(-Math.PI/2);a=a.multiplyRight(E);break}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const s=new yt(o);e.cartesianModelMatrix=a,e.cartesianOrigin=s;const u=ss.WGS84.cartesianToCartographic(s,new yt),g=ss.WGS84.eastNorthUpToFixedFrame(s).invert();e.cartographicModelMatrix=g.multiplyRight(a),e.cartographicOrigin=u,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const Zq=new yt,NB=new yt,C4=new cc([new cf,new cf,new cf,new cf,new cf,new cf]);function $$e(t,e){const{cameraDirection:n,cameraUp:r,height:i}=t,{metersPerUnit:o}=t.distanceScales,a=lP(t,t.center),s=ss.WGS84.eastNorthUpToFixedFrame(a),u=t.unprojectPosition(t.cameraPosition),d=ss.WGS84.cartographicToCartesian(u,new yt),g=new yt(s.transformAsVector(new yt(n).scale(o))).normalize(),_=new yt(s.transformAsVector(new yt(r).scale(o))).normalize();W$e(t);const E=t.constructor,{longitude:P,latitude:R,width:B,bearing:V,zoom:z}=t,F=new E({longitude:P,latitude:R,height:i,width:B,bearing:V,zoom:z,pitch:0});return{camera:{position:d,direction:g,up:_},viewport:t,topDownViewport:F,height:i,cullingVolume:C4,frameNumber:e,sseDenominator:1.15}}function H$e(t,e,n){if(n===0||t.length<=n)return[t,[]];const r=[],{longitude:i,latitude:o}=e.viewport;for(const[d,g]of t.entries()){const[_,E]=g.header.mbs,P=Math.abs(i-_),R=Math.abs(o-E),B=Math.sqrt(R*R+P*P);r.push([d,B])}const a=r.sort((d,g)=>d[1]-g[1]),s=[];for(let d=0;d<n;d++)s.push(t[a[d][0]]);const u=[];for(let d=n;d<a.length;d++)u.push(t[a[d][0]]);return[s,u]}function W$e(t){const e=t.getFrustumPlanes(),n=Yq(e.near,t.cameraPosition),r=lP(t,n),i=lP(t,t.cameraPosition,NB);let o=0;C4.planes[o++].fromPointNormal(r,Zq.copy(r).subtract(i));for(const a in e){if(a==="near")continue;const s=e[a],u=Yq(s,n,NB),d=lP(t,u,NB);C4.planes[o++].fromPointNormal(d,Zq.copy(r).subtract(d))}}function Yq(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new yt;const r=t.normal.dot(e);return n.copy(t.normal).scale(t.distance-r).add(e),n}function lP(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new yt;const r=t.unprojectPosition(e);return ss.WGS84.cartographicToCartesian(r,n)}const q$e=6378137,X$e=6378137,P4=6356752314245179e-9,Qq=new yt;function Z$e(t,e){if(t instanceof l2){const{halfAxes:n}=t,r=Q$e(n);return Math.log2(P4/(r+e[2]))}else if(t instanceof a2){const{radius:n}=t;return Math.log2(P4/(n+e[2]))}else if(t.width&&t.height){const{width:n,height:r}=t,i=Math.log2(q$e/n),o=Math.log2(X$e/r);return(i+o)/2}return 1}function Ese(t,e,n){const r=ss.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],new yt),i=Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)+Math.pow(r[2]-n[2],2));return Math.log2(P4/(i+e[2]))}function Y$e(t,e,n){const[r,i,o,a]=t;return Ese({xmin:r,xmax:o,ymin:i,ymax:a,zmin:0,zmax:0},e,n)}function Q$e(t){t.getColumn(0,Qq);const e=t.getColumn(1),n=t.getColumn(2);return Qq.add(e).add(n).len()}const ic={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},tg={ADD:1,REPLACE:2},bv={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},tf={I3S:"I3S",TILES3D:"TILES3D"},fL={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},K$e={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function Sse(t){return t!=null}const vl=new yt,uP=new yt,J$e=new yt,eHe=new yt;function FB(t,e,n){if(co(t,"3D Tile: boundingVolume must be defined"),t.box)return nHe(t.box,e,n);if(t.region){const[r,i,o,a,s,u]=t.region,d=ss.WGS84.cartographicToCartesian([bl(r),bl(a),s],J$e),g=ss.WGS84.cartographicToCartesian([bl(o),bl(i),u],eHe),_=new yt().addVectors(d,g).multiplyScalar(.5),E=new yt().subVectors(d,g).len()/2;return Kq([_[0],_[1],_[2],E],new vr)}if(t.sphere)return Kq(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function tHe(t,e){if(t.box)return rHe(e);if(t.region){const[n,r,i,o,a,s]=t.region;return[[bl(n),bl(r),a],[bl(i),bl(o),s]]}if(t.sphere)return iHe(e);throw new Error("Unkown boundingVolume type")}function nHe(t,e,n){const r=new yt(t[0],t[1],t[2]);e.transform(r,r);let i=[];if(t.length===10){const d=t.slice(3,6),g=new Zm;g.fromArray(t,6);const _=new yt([1,0,0]),E=new yt([0,1,0]),P=new yt([0,0,1]);_.transformByQuaternion(g),_.scale(d[0]),E.transformByQuaternion(g),E.scale(d[1]),P.transformByQuaternion(g),P.scale(d[2]),i=[..._.toArray(),...E.toArray(),...P.toArray()]}else i=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const o=e.transformAsVector(i.slice(0,3)),a=e.transformAsVector(i.slice(3,6)),s=e.transformAsVector(i.slice(6,9)),u=new is([o[0],o[1],o[2],a[0],a[1],a[2],s[0],s[1],s[2]]);return Sse(n)?(n.center=r,n.halfAxes=u,n):new l2(r,u)}function Kq(t,e,n){const r=new yt(t[0],t[1],t[2]);e.transform(r,r);const i=e.getScale(uP),o=Math.max(Math.max(i[0],i[1]),i[2]),a=t[3]*o;return Sse(n)?(n.center=r,n.radius=a,n):new a2(r,a)}function rHe(t){const e=Tse(),{halfAxes:n}=t,r=new yt(n.getColumn(0)),i=new yt(n.getColumn(1)),o=new yt(n.getColumn(2));for(let a=0;a<2;a++){for(let s=0;s<2;s++){for(let u=0;u<2;u++)vl.copy(t.center),vl.add(r),vl.add(i),vl.add(o),Cse(e,vl),o.negate();i.negate()}r.negate()}return e}function iHe(t){const e=Tse(),{center:n,radius:r}=t,i=ss.WGS84.scaleToGeodeticSurface(n,vl);let o;i?o=ss.WGS84.geodeticSurfaceNormal(i):o=new yt(0,0,1);let a=new yt(o[2],-o[1],0);a.len()>0?a.normalize():a=new yt(0,1,0);const s=a.clone().cross(o);for(const u of[a,s,o]){uP.copy(u).scale(r);for(let d=0;d<2;d++)vl.copy(n),vl.add(uP),Cse(e,vl),uP.negate()}return e}function Tse(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function Cse(t,e){ss.WGS84.cartesianToCartographic(e,vl),t[0][0]=Math.min(t[0][0],vl[0]),t[0][1]=Math.min(t[0][1],vl[1]),t[0][2]=Math.min(t[0][2],vl[2]),t[1][0]=Math.max(t[1][0],vl[0]),t[1][1]=Math.max(t[1][1],vl[1]),t[1][2]=Math.max(t[1][2],vl[2])}new yt;new yt;new vr;new yt;new yt;new yt;function oHe(t,e){const n=t*e;return 1-Math.exp(-(n*n))}function sHe(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const n=t.dynamicScreenSpaceErrorComputedDensity,r=t.dynamicScreenSpaceErrorFactor;return oHe(e,n)*r}return 0}function aHe(t,e,n){const r=t.tileset,i=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,o=n?i:t.lodMetricValue;if(o===0)return 0;const a=Math.max(t._distanceToCamera,1e-7),{height:s,sseDenominator:u}=e,{viewDistanceScale:d}=r.options;let g=o*s*(d||1)/(a*u);return g-=sHe(r,a),g}const kB=new yt,Jq=new yt,mm=new yt,eX=new yt,lHe=new yt,zB=new vr,tX=new vr;function uHe(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const n=2*Pse(t,e);return n<2?"OUT":!t.header.children||n<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function Pse(t,e){const{topDownViewport:n}=e,r=t.header.mbs[1],i=t.header.mbs[0],o=t.header.mbs[2],a=t.header.mbs[3],s=[...t.boundingVolume.center],u=n.unprojectPosition(n.cameraPosition);ss.WGS84.cartographicToCartesian(u,kB),Jq.copy(kB).subtract(s).normalize(),ss.WGS84.eastNorthUpToFixedFrame(s,zB),tX.copy(zB).invert(),mm.copy(kB).transform(tX);const d=Math.sqrt(mm[0]*mm[0]+mm[1]*mm[1]),g=d*d/mm[2];eX.copy([mm[0],mm[1],g]);const E=eX.transform(zB).subtract(s).normalize(),R=Jq.cross(E).normalize().scale(a).add(s),B=ss.WGS84.cartesianToCartographic(R),V=n.project([i,r,o]),z=n.project(B);return lHe.copy(V).subtract(z).magnitude()}function cHe(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class nX{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;q(this,"_map",new Map),q(this,"_array",void 0),q(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return co(e<this._array.length),this._array[e]}set(e,n){co(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=n,this._map.set(n,e)}delete(e){const n=this._map.get(e);n>=0&&(this._array.splice(n,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const n=this.length++;this._array[n]=e,this._map.set(e,n)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){co(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){co(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const fHe={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class hL{traversalFinished(e){return!0}constructor(e){q(this,"options",void 0),q(this,"root",null),q(this,"selectedTiles",{}),q(this,"requestedTiles",{}),q(this,"emptyTiles",{}),q(this,"lastUpdate",new Date().getTime()),q(this,"updateDebounceTime",1e3),q(this,"_traversalStack",new nX),q(this,"_emptyTraversalStack",new nX),q(this,"_frameNumber",null),this.options={...fHe,...e}}traverse(e,n,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,n),this._frameNumber=n.frameNumber,this.executeTraversal(e,n)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,n){const r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){const o=r.pop();let a=!1;this.canTraverse(o,n)&&(this.updateChildTiles(o,n),a=this.updateAndPushChildren(o,n,r,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));const s=o.parent,u=!!(!s||s._shouldRefine),d=!a;o.hasRenderContent?o.refine===tg.ADD?(this.loadTile(o,n),this.selectTile(o,n)):o.refine===tg.REPLACE&&(this.loadTile(o,n),d&&this.selectTile(o,n)):(this.emptyTiles[o.id]=o,this.loadTile(o,n),d&&this.selectTile(o,n)),this.touchTile(o,n),o._shouldRefine=a&&u}const i=new Date().getTime();(this.traversalFinished(n)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(n))}updateChildTiles(e,n){const r=e.children;for(const i of r)this.updateTile(i,n)}updateAndPushChildren(e,n,r,i){const{loadSiblings:o,skipLevelOfDetail:a}=this.options,s=e.children;s.sort(this.compareDistanceToCamera.bind(this));const u=e.refine===tg.REPLACE&&e.hasRenderContent&&!a;let d=!1,g=!0;for(const _ of s)if(_._selectionDepth=i,_.isVisibleAndInRequestVolume?(r.find(_)&&r.delete(_),r.push(_),d=!0):(u||o)&&(this.loadTile(_,n),this.touchTile(_,n)),u){let E;if(_._inRequestVolume?_.hasRenderContent?E=_.contentAvailable:E=this.executeEmptyTraversal(_,n):E=!1,g=g&&E,!g)return!1}return d||(g=!1),g}updateTile(e,n){this.updateTileVisibility(e,n)}selectTile(e,n){this.shouldSelectTile(e)&&(e._selectedFrame=n.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,n){this.shouldLoadTile(e)&&(e._requestedFrame=n.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,n){e.tileset._cache.touch(e),e._touchedFrame=n.frameNumber}canTraverse(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!i&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,n,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=e._screenSpaceError;return r&&(i=e.getScreenSpaceError(n,!0)),i>this.options.maximumScreenSpaceError}updateTileVisibility(e,n){const r=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===n.viewport.id&&r.push(i);else r.push(n.viewport.id);e.updateVisibility(n,r)}compareDistanceToCamera(e,n){return e._distanceToCamera-n._distanceToCamera}anyChildrenVisible(e,n){let r=!1;for(const i of e.children)i.updateVisibility(n),r=r||i.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,n){let r=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0&&r;){const o=i.pop();if(this.updateTile(o,n),o.isVisibleAndInRequestVolume||this.loadTile(o,n),this.touchTile(o,n),!o.hasRenderContent&&this.canTraverse(o,n,!1,!0)){const s=o.children;for(const u of s)i.find(u)&&i.delete(u),i.push(u)}else!o.contentAvailable&&!o.hasEmptyContent&&(r=!1)}return r}}const rX=new yt;function hHe(t){return t!=null}class I4{constructor(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";q(this,"tileset",void 0),q(this,"header",void 0),q(this,"id",void 0),q(this,"url",void 0),q(this,"parent",void 0),q(this,"refine",void 0),q(this,"type",void 0),q(this,"contentUrl",void 0),q(this,"lodMetricType","geometricError"),q(this,"lodMetricValue",0),q(this,"boundingVolume",null),q(this,"content",null),q(this,"contentState",ic.UNLOADED),q(this,"gpuMemoryUsageInBytes",0),q(this,"children",[]),q(this,"depth",0),q(this,"viewportIds",[]),q(this,"transform",new vr),q(this,"extensions",null),q(this,"implicitTiling",null),q(this,"userData",{}),q(this,"computedTransform",void 0),q(this,"hasEmptyContent",!1),q(this,"hasTilesetContent",!1),q(this,"traverser",new hL({})),q(this,"_cacheNode",null),q(this,"_frameNumber",null),q(this,"_expireDate",null),q(this,"_expiredContent",null),q(this,"_boundingBox",void 0),q(this,"_distanceToCamera",0),q(this,"_screenSpaceError",0),q(this,"_visibilityPlaneMask",void 0),q(this,"_visible",void 0),q(this,"_contentBoundingVolume",void 0),q(this,"_viewerRequestVolume",void 0),q(this,"_initialTransform",new vr),q(this,"_priority",0),q(this,"_selectedFrame",0),q(this,"_requestedFrame",0),q(this,"_selectionDepth",0),q(this,"_touchedFrame",0),q(this,"_centerZDepth",0),q(this,"_shouldRefine",!1),q(this,"_stackLength",0),q(this,"_visitedFrame",0),q(this,"_inRequestVolume",!1),q(this,"_lodJudge",null),this.header=n,this.tileset=e,this.id=i||n.id,this.url=n.url,this.parent=r,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===ic.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===ic.UNLOADED}get contentExpired(){return this.contentState===ic.EXPIRED}get contentFailed(){return this.contentState===ic.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=tHe(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,n){switch(this.tileset.type){case tf.I3S:return Pse(this,e);case tf.TILES3D:return aHe(this,e,n);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:n}=e.options,r=this.refine===tg.ADD||n;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===ic.UNLOADED)return-1;const i=this.parent,a=i&&(!r||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,s=e.root?e.root._screenSpaceError:0;return Math.max(s-a,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=ic.LOADING;const n=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!n)return this.contentState=ic.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,o={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await ag(r,i,o),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=ic.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=ic.FAILED,r}finally{n.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=ic.UNLOADED,!0}updateVisibility(e,n){if(this._frameNumber===e.frameNumber)return;const r=this.parent,i=r?r._visibilityPlaneMask:cc.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const o=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==cc.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=n}visibility(e,n){const{cullingVolume:r}=e,{boundingVolume:i}=this;return r.computeVisibilityWithPlaneMask(i,n)}contentVisibility(){return!0}distanceToTile(e){const n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:n}=e;const r=this.boundingVolume;return rX.subVectors(r.center,n.position),n.direction.dot(rX)}insideViewerRequestVolume(e){const n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(hHe(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=ic.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new vr(e.transform):new vr;const n=this.parent,r=this.tileset,i=n&&n.computedTransform?n.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new vr(i).multiplyRight(this.transform);const o=n&&n._initialTransform?n._initialTransform.clone():new vr;this._initialTransform=new vr(o).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=ic.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=cc.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||tg.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=FB(e.boundingVolume,this.computedTransform,this.boundingVolume);const n=e.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=FB(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=FB(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const n=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new vr).clone().multiplyRight(this.transform);n.equals(this.computedTransform)||(this.computedTransform=n,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return cHe(this.tileset.tileset)}}}class dHe extends hL{compareDistanceToCamera(e,n){return n._distanceToCamera===0&&e._distanceToCamera===0?n._centerZDepth-e._centerZDepth:n._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,n){if(super.updateTileVisibility(e,n),!e.isVisibleAndInRequestVolume)return;const r=e.children.length>0;if(e.hasTilesetContent&&r){const a=e.children[0];this.updateTileVisibility(a,n),e._visible=a._visible;return}if(this.meetsScreenSpaceErrorEarly(e,n)){e._visible=!1;return}const i=e.refine===tg.REPLACE,o=e._optimChildrenWithinParent===K$e.USE_OPTIMIZATION;if(i&&o&&r&&!this.anyChildrenVisible(e,n)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,n){const{parent:r}=e;return!r||r.hasTilesetContent||r.refine!==tg.ADD?!1:!this.shouldRefine(e,n,!0)}}class pHe{constructor(){q(this,"frameNumberMap",new Map)}register(e,n){const r=this.frameNumberMap.get(e)||new Map,i=r.get(n)||0;r.set(n,i+1),this.frameNumberMap.set(e,r)}deregister(e,n){const r=this.frameNumberMap.get(e);if(!r)return;const i=r.get(n)||1;r.set(n,i-1)}isZero(e,n){var r;return(((r=this.frameNumberMap.get(e))===null||r===void 0?void 0:r.get(n))||0)===0}}const UB={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class gHe{constructor(){q(this,"_statusMap",void 0),q(this,"pendingTilesRegister",new pHe),this._statusMap={}}add(e,n,r,i){if(!this._statusMap[n]){const{frameNumber:o,viewport:{id:a}}=i;this._statusMap[n]={request:e,callback:r,key:n,frameState:i,status:UB.REQUESTED},this.pendingTilesRegister.register(a,o),e().then(s=>{this._statusMap[n].status=UB.COMPLETED;const{frameNumber:u,viewport:{id:d}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(d,u),this._statusMap[n].callback(s,i)}).catch(s=>{this._statusMap[n].status=UB.ERROR;const{frameNumber:u,viewport:{id:d}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(d,u),r(s)})}}update(e,n){if(this._statusMap[e]){const{frameNumber:r,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,r);const{frameNumber:o,viewport:{id:a}}=n;this.pendingTilesRegister.register(a,o),this._statusMap[e].frameState=n}}find(e){return this._statusMap[e]}hasPendingTiles(e,n){return!this.pendingTilesRegister.isZero(e,n)}}class mHe extends hL{constructor(e){super(e),q(this,"_tileManager",void 0),this._tileManager=new gHe}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,n){return e._lodJudge=uHe(e,n),e._lodJudge==="DIG"}updateChildTiles(e,n){const r=e.header.children||[],i=e.children,o=e.tileset;for(const a of r){const s="".concat(a.id,"-").concat(n.viewport.id),u=i&&i.find(d=>d.id===s);if(u)u&&this.updateTile(u,n);else{let d=()=>this._loadTile(a.id,o);this._tileManager.find(s)?this._tileManager.update(s,n):(o.tileset.nodePages&&(d=()=>o.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(d,s,_=>this._onTileLoad(_,e,s),n))}}return!1}async _loadTile(e,n){const{loader:r}=n,i=n.getTileUrl("".concat(n.url,"/nodes/").concat(e)),o={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await ag(i,r,o)}_onTileLoad(e,n,r){const i=new I4(n.tileset,e,n,r);n.children.push(i);const o=this._tileManager.find(i.id).frameState;this.updateTile(i,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,o)}}const AHe={description:"",ellipsoid:ss.WGS84,modelMatrix:new vr,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},dT="Tiles In Tileset(s)",GB="Tiles In Memory",iX="Tiles In View",oX="Tiles To Render",sX="Tiles Loaded",jB="Tiles Loading",aX="Tiles Unloaded",lX="Failed Tile Loads",uX="Points/Vertices",VB="Tile Memory Use";class _He{constructor(e,n){q(this,"options",void 0),q(this,"loadOptions",void 0),q(this,"type",void 0),q(this,"tileset",void 0),q(this,"loader",void 0),q(this,"url",void 0),q(this,"basePath",void 0),q(this,"modelMatrix",void 0),q(this,"ellipsoid",void 0),q(this,"lodMetricType",void 0),q(this,"lodMetricValue",void 0),q(this,"refine",void 0),q(this,"root",null),q(this,"roots",{}),q(this,"asset",{}),q(this,"description",""),q(this,"properties",void 0),q(this,"extras",null),q(this,"attributions",{}),q(this,"credits",{}),q(this,"stats",void 0),q(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),q(this,"cartographicCenter",null),q(this,"cartesianCenter",null),q(this,"zoom",1),q(this,"boundingVolume",null),q(this,"dynamicScreenSpaceErrorComputedDensity",0),q(this,"maximumMemoryUsage",32),q(this,"gpuMemoryUsageInBytes",0),q(this,"_frameNumber",0),q(this,"_queryParams",{}),q(this,"_extensionsUsed",[]),q(this,"_tiles",{}),q(this,"_pendingCount",0),q(this,"selectedTiles",[]),q(this,"traverseCounter",0),q(this,"geometricError",0),q(this,"lastUpdatedVieports",null),q(this,"_requestedTiles",[]),q(this,"_emptyTiles",[]),q(this,"frameStateData",{}),q(this,"_traverser",void 0),q(this,"_cache",new j$e),q(this,"_requestScheduler",void 0),q(this,"updatePromise",null),q(this,"tilesetInitializationPromise",void 0),this.options={...AHe,...n},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||Xz(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new mee({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new z$e({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(n=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),n(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const n=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;const r=[];for(const i of n){const o=i.id;this._needTraverse(o)?r.push(o):this.traverseCounter--}for(const i of n){const o=i.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!r.includes(o))continue;const a=$$e(i,this._frameNumber);this._traverser.traverse(this.roots[o],a,this.options)}}_needTraverse(e){let n=e;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[e]),n===e}_onTraversalEnd(e){const n=e.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[n],i=Object.values(this._traverser.selectedTiles),[o,a]=H$e(i,e,this.options.maximumTilesSelected);r.selectedTiles=o;for(const s of a)s.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const n=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,n){if(e.length!==n.length)return!0;const r=new Set(e.map(a=>a.id)),i=new Set(n.map(a=>a.id));let o=e.filter(a=>!i.has(a.id)).length>0;return o=o||n.filter(a=>!r.has(a.id)).length>0,o}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,n)=>e._unloadTile(n))}_updateStats(){let e=0,n=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(e++,r.content.pointCount?n+=r.content.pointCount:n+=r.content.vertexCount);this.stats.get(iX).count=this.selectedTiles.length,this.stats.get(oX).count=e,this.stats.get(uX).count=n}async _initializeTileSet(e){this.type===tf.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===tf.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===tf.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const n=this.tileset.fullExtent;if(n){const{xmin:i,xmax:o,ymin:a,ymax:s,zmin:u,zmax:d}=n;this.cartographicCenter=new yt(i+(o-i)/2,a+(s-a)/2,u+(d-u)/2),this.cartesianCenter=ss.WGS84.cartographicToCartesian(this.cartographicCenter,new yt),this.zoom=Ese(n,this.cartographicCenter,this.cartesianCenter);return}const r=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(r){const[i,o,a,s]=r;this.cartographicCenter=new yt(i+(a-i)/2,o+(s-o)/2,0),this.cartesianCenter=ss.WGS84.cartographicToCartesian(this.cartographicCenter,new yt),this.zoom=Y$e(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new yt,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:n}=e.boundingVolume;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new yt,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?this.cartographicCenter=ss.WGS84.cartesianToCartographic(n,new yt):this.cartographicCenter=new yt(0,0,-ss.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=Z$e(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(dT),this.stats.get(jB),this.stats.get(GB),this.stats.get(iX),this.stats.get(oX),this.stats.get(sX),this.stats.get(aX),this.stats.get(lX),this.stats.get(uX),this.stats.get(VB,"memory")}_initializeTileHeaders(e,n){const r=new I4(this,e.root,n);if(n&&(n.children.push(r),r.depth=n.depth+1),this.type===tf.TILES3D){const o=[];for(o.push(r);o.length>0;){const a=o.pop();this.stats.get(dT).incrementCount();const s=a.header.children||[];for(const u of s){var i;const d=new I4(this,u,a);if((i=d.contentUrl)!==null&&i!==void 0&&i.includes("?session=")){const _=new URL(d.contentUrl).searchParams.get("session");_&&(this._queryParams.session=_)}a.children.push(d),d.depth=a.depth+1,o.push(d)}}}return r}_initializeTraverser(){let e;switch(this.type){case tf.TILES3D:e=dHe;break;case tf.I3S:e=mHe;break;default:e=hL}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let n;try{this._onStartTileLoading(),n=await e.loadContent()}catch(r){this._onTileLoadError(e,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,n)}}_onTileLoadError(e,n){this.stats.get(lX).incrementCount();const r=n.message||n.toString(),i=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(r)),this.options.onTileError(e,r,i)}_onTileLoad(e,n){if(n){if(this.type===tf.I3S){var r,i;const o=((r=this.tileset)===null||r===void 0||(i=r.nodePagesTile)===null||i===void 0?void 0:i.nodesInNodePages)||0;this.stats.get(dT).reset(),this.stats.get(dT).addCount(o)}e&&e.content&&V$e(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===tf.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===tf.TILES3D){var n;const{extensionsRemoved:r=[]}=((n=e.content)===null||n===void 0?void 0:n.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(jB).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(jB).decrementCount()}_addTileToCache(e){this._cache.add(this,e,n=>n._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(sX).incrementCount(),this.stats.get(GB).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(VB).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(GB).decrementCount(),this.stats.get(aX).incrementCount(),this.stats.get(VB).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const n=e.pop();for(const r of n.children)e.push(r);this._destroyTile(n)}this.root=null}_destroySubtree(e){const n=e,r=[];for(r.push(n);r.length>0;){e=r.pop();for(const i of e.children)r.push(i);e!==n&&this._destroyTile(e)}n.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const n=new URLSearchParams(e.queryString),r=Object.fromEntries(n.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const Ise="3.4.14",Pb={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function Mse(t,e,n){co(t instanceof ArrayBuffer);const r=new TextDecoder("utf8"),i=new Uint8Array(t,e,n);return r.decode(i)}function yHe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=new DataView(t);return"".concat(String.fromCharCode(n.getUint8(e+0))).concat(String.fromCharCode(n.getUint8(e+1))).concat(String.fromCharCode(n.getUint8(e+2))).concat(String.fromCharCode(n.getUint8(e+3)))}const vHe={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Us={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},_i={...vHe,...Us},$B={[Us.DOUBLE]:Float64Array,[Us.FLOAT]:Float32Array,[Us.UNSIGNED_SHORT]:Uint16Array,[Us.UNSIGNED_INT]:Uint32Array,[Us.UNSIGNED_BYTE]:Uint8Array,[Us.BYTE]:Int8Array,[Us.SHORT]:Int16Array,[Us.INT]:Int32Array},xHe={DOUBLE:Us.DOUBLE,FLOAT:Us.FLOAT,UNSIGNED_SHORT:Us.UNSIGNED_SHORT,UNSIGNED_INT:Us.UNSIGNED_INT,UNSIGNED_BYTE:Us.UNSIGNED_BYTE,BYTE:Us.BYTE,SHORT:Us.SHORT,INT:Us.INT},HB="Failed to convert GL type";class Dd{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const n in $B)if($B[n]===e)return n;throw new Error(HB)}static fromName(e){const n=xHe[e];if(!n)throw new Error(HB);return n}static getArrayType(e){switch(e){case Us.UNSIGNED_SHORT_5_6_5:case Us.UNSIGNED_SHORT_4_4_4_4:case Us.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const n=$B[e];if(!n)throw new Error(HB);return n}}static getByteSize(e){return Dd.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Dd.getArrayType(e)}static createTypedArray(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;i===void 0&&(i=(n.byteLength-r)/Dd.getByteSize(e));const o=Dd.getArrayType(e);return new o(n,r,i)}}function bHe(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(e))}function wHe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=t>>11&31,r=t>>5&63,i=t&31;return e[0]=n<<3,e[1]=r<<2,e[2]=i<<3,e}new BO;new yt;new BO;new BO;function cX(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return Wi(t,0,e)/e*2-1}function fX(t){return t<0?-1:1}function EHe(t,e,n,r){if(bHe(r),t<0||t>n||e<0||e>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(r.x=cX(t,n),r.y=cX(e,n),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const i=r.x;r.x=(1-Math.abs(r.y))*fX(i),r.y=(1-Math.abs(i))*fX(r.y)}return r.normalize()}function SHe(t,e,n){return EHe(t,e,255,n)}class mU{constructor(e,n){q(this,"json",void 0),q(this,"buffer",void 0),q(this,"featuresLength",0),q(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=n}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_i.UNSIGNED_INT,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,n,r,1,i.byteOffset):i}getPropertyArray(e,n,r){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(n=Dd.fromName(i.componentType)),this._getTypedArrayFromBinary(e,n,r,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,n,i)}getProperty(e,n,r,i,o){const a=this.json[e];if(!a)return a;const s=this.getPropertyArray(e,n,r);if(r===1)return s[i];for(let u=0;u<r;++u)o[u]=s[r*i+u];return o}_getTypedArrayFromBinary(e,n,r,i,o){const a=this._cachedTypedArrays;let s=a[e];return s||(s=Dd.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+o,i*r),a[e]=s),s}_getTypedArrayFromArray(e,n,r){const i=this._cachedTypedArrays;let o=i[e];return o||(o=Dd.createTypedArray(n,r),i[e]=o),o}}const THe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},CHe={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},PHe={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}};function IHe(t,e,n,r){const{componentType:i}=t;co(t.componentType);const o=typeof i=="string"?Dd.fromName(i):i,a=THe[t.type],s=CHe[t.type],u=PHe[t.type];return n+=t.byteOffset,{values:Dd.createTypedArray(o,e,n,a*r),type:o,size:a,unpacker:s,packer:u}}const Md=t=>t!==void 0;function MHe(t,e,n){if(!e)return null;let r=t.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,r=i),r?OHe(r,n):null}function OHe(t,e){let n,r,i;const o=t.instancesLength,a=t.classes;let s=t.classIds,u=t.parentCounts,d=t.parentIds,g=o;Md(s.byteOffset)&&(s.componentType=defaultValue(s.componentType,GL.UNSIGNED_SHORT),s.type=AttributeType.SCALAR,i=getBinaryAccessor(s),s=i.createArrayBufferView(e.buffer,e.byteOffset+s.byteOffset,o));let _;if(Md(u))for(Md(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),u=i.createArrayBufferView(e.buffer,e.byteOffset+u.byteOffset,o)),_=new Uint16Array(o),g=0,n=0;n<o;++n)_[n]=g,g+=u[n];Md(d)&&Md(d.byteOffset)&&(d.componentType=defaultValue(d.componentType,GL.UNSIGNED_SHORT),d.type=AttributeType.SCALAR,i=getBinaryAccessor(d),d=i.createArrayBufferView(e.buffer,e.byteOffset+d.byteOffset,g));const E=a.length;for(n=0;n<E;++n){const V=a[n].length,z=a[n].instances,F=getBinaryProperties(V,z,e);a[n].instances=combine(F,z)}const P=new Array(E).fill(0),R=new Uint16Array(o);for(n=0;n<o;++n)r=s[n],R[n]=P[r],++P[r];const B={classes:a,classIds:s,classIndexes:R,parentCounts:u,parentIndexes:_,parentIds:d};return DHe(B),B}function Ib(t,e,n){if(!t)return;const r=t.parentCounts;return t.parentIds?n(t,e):r>0?RHe(t,e,n):LHe(t,e,n)}function RHe(t,e,n){const r=t.classIds,i=t.parentCounts,o=t.parentIds,a=t.parentIndexes,s=r.length,u=scratchVisited;u.length=Math.max(u.length,s);const d=++marker,g=scratchStack;for(g.length=0,g.push(e);g.length>0;){if(e=g.pop(),u[e]===d)continue;u[e]=d;const _=n(t,e);if(Md(_))return _;const E=i[e],P=a[e];for(let R=0;R<E;++R){const B=o[P+R];B!==e&&g.push(B)}}return null}function LHe(t,e,n){let r=!0;for(;r;){const i=n(t,e);if(Md(i))return i;const o=t.parentIds[e];r=o!==e,e=o}throw new Error("traverseHierarchySingleParent")}function DHe(t){const n=t.classIds.length;for(let r=0;r<n;++r)Ose(t,r,stack)}function Ose(t,e,n){const r=t.parentCounts,i=t.parentIds,o=t.parentIndexes,s=t.classIds.length;if(!Md(i))return;assert(e<s,"Parent index ".concat(e," exceeds the total number of instances: ").concat(s)),assert(n.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),n.push(e);const u=Md(r)?r[e]:1,d=Md(r)?o[e]:e;for(let g=0;g<u;++g){const _=i[d+g];_!==e&&Ose(t,_,n)}n.pop(e)}function vu(t){return t!=null}const pT=(t,e)=>t,BHe={HIERARCHY:!0,extensions:!0,extras:!0};class Rse{constructor(e,n,r){var i;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};q(this,"json",void 0),q(this,"binary",void 0),q(this,"featureCount",void 0),q(this,"_extensions",void 0),q(this,"_properties",void 0),q(this,"_binaryProperties",void 0),q(this,"_hierarchy",void 0),co(r>=0),this.json=e||{},this.binary=n,this.featureCount=r,this._extensions=((i=this.json)===null||i===void 0?void 0:i.extensions)||{},this._properties={};for(const a in this.json)BHe[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),o["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=MHe(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,n){if(this._checkBatchId(e),co(typeof n=="string",n),this._hierarchy){const r=Ib(this._hierarchy,e,(i,o)=>{const a=i.classIds[o];return i.classes[a].name===n});return vu(r)}return!1}isExactClass(e,n){return co(typeof n=="string",n),this.getExactClassName(e)===n}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const n=this._hierarchy.classIds[e];return this._hierarchy.classes[n].name}}hasProperty(e,n){return this._checkBatchId(e),co(typeof n=="string",n),vu(this._properties[n])||this._hasPropertyInHierarchy(e,n)}getPropertyNames(e,n){this._checkBatchId(e),n=vu(n)?n:[],n.length=0;const r=Object.keys(this._properties);return n.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,n),n}getProperty(e,n){if(this._checkBatchId(e),co(typeof n=="string",n),this._binaryProperties){const i=this._binaryProperties[n];if(vu(i))return this._getBinaryProperty(i,e)}const r=this._properties[n];if(vu(r))return pT(r[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,n);if(vu(i))return i}}setProperty(e,n,r){const i=this.featureCount;if(this._checkBatchId(e),co(typeof n=="string",n),this._binaryProperties){const a=this._binaryProperties[n];if(a){this._setBinaryProperty(a,e,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,n,r))return;let o=this._properties[n];vu(o)||(this._properties[n]=new Array(i),o=this._properties[n]),o[e]=pT(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,n){return e.unpack(e.typedArray,n)}_setBinaryProperty(e,n,r){e.pack(r,e.typedArray,n)}_initializeBinaryProperties(){let e=null;for(const n in this._properties){const r=this._properties[n],i=this._initializeBinaryProperty(n,r);i&&(e=e||{},e[n]=i)}return e}_initializeBinaryProperty(e,n){if("byteOffset"in n){const r=n;co(this.binary,"Property ".concat(e," requires a batch table binary.")),co(r.type,"Property ".concat(e," requires a type."));const i=IHe(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,n){if(!this._hierarchy)return!1;const r=Ib(this._hierarchy,e,(i,o)=>{const a=i.classIds[o],s=i.classes[a].instances;return vu(s[n])});return vu(r)}_getPropertyNamesInHierarchy(e,n){Ib(this._hierarchy,e,(r,i)=>{const o=r.classIds[i],a=r.classes[o].instances;for(const s in a)a.hasOwnProperty(s)&&n.indexOf(s)===-1&&n.push(s)})}_getHierarchyProperty(e,n){return Ib(this._hierarchy,e,(r,i)=>{const o=r.classIds[i],a=r.classes[o],s=r.classIndexes[i],u=a.instances[n];return vu(u)?vu(u.typedArray)?this._getBinaryProperty(u,s):pT(u[s]):null})}_setHierarchyProperty(e,n,r,i){const o=Ib(this._hierarchy,n,(a,s)=>{const u=a.classIds[s],d=a.classes[u],g=a.classIndexes[s],_=d.instances[r];return vu(_)?(co(s===n,'Inherited property "'.concat(r,'" is read-only.')),vu(_.typedArray)?this._setBinaryProperty(_,g,i):_[g]=pT(i),!0):!1});return vu(o)}}const WB=4;function dL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e);if(t.magic=r.getUint32(n,!0),n+=WB,t.version=r.getUint32(n,!0),n+=WB,t.byteLength=r.getUint32(n,!0),n+=WB,t.version!==1)throw new Error("3D Tile Version ".concat(t.version," not supported"));return n}const Py=4,hX="b3dm tile in legacy format.";function AU(t,e,n){const r=new DataView(e);let i;t.header=t.header||{};let o=r.getUint32(n,!0);n+=Py;let a=r.getUint32(n,!0);n+=Py;let s=r.getUint32(n,!0);n+=Py;let u=r.getUint32(n,!0);return n+=Py,s>=570425344?(n-=Py*2,i=o,s=a,u=0,o=0,a=0,console.warn(hX)):u>=570425344&&(n-=Py,i=s,s=o,u=a,o=0,a=0,console.warn(hX)),t.header.featureTableJsonByteLength=o,t.header.featureTableBinaryByteLength=a,t.header.batchTableJsonByteLength=s,t.header.batchTableBinaryByteLength=u,t.header.batchLength=i,n}function _U(t,e,n,r){return n=NHe(t,e,n),n=FHe(t,e,n),n}function NHe(t,e,n,r){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:o,batchLength:a}=t.header;if(t.featureTableJson={BATCH_LENGTH:a||0},i>0){const s=Mse(e,n,i);t.featureTableJson=JSON.parse(s)}return n+=i,t.featureTableBinary=new Uint8Array(e,n,o),n+=o,n}function FHe(t,e,n,r){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:o}=t.header;if(i>0){const a=Mse(e,n,i);t.batchTableJson=JSON.parse(a),n+=i,o>0&&(t.batchTableBinary=new Uint8Array(e,n,o),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=o)}return n}function Lse(t,e,n){if(!e&&(!t||!t.batchIds||!n))return null;const{batchIds:r,isRGB565:i,pointCount:o}=t;if(r&&n){const a=new Uint8ClampedArray(o*3);for(let s=0;s<o;s++){const u=r[s],g=n.getProperty(u,"dimensions").map(_=>_*255);a[s*3]=g[0],a[s*3+1]=g[1],a[s*3+2]=g[2]}return{type:_i.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(i){const a=new Uint8ClampedArray(o*3);for(let s=0;s<o;s++){const u=wHe(e[s]);a[s*3]=u[0],a[s*3+1]=u[1],a[s*3+2]=u[2]}return{type:_i.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return e&&e.length===o*3?{type:_i.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:_i.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const dX=new yt;function kHe(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array(t.pointsLength*3);for(let r=0;r<t.pointsLength;r++)SHe(e[r*2],e[r*2+1],dX),dX.toArray(n,r*3);return{type:_i.FLOAT,size:2,value:n}}return{type:_i.FLOAT,size:2,value:e}}function zHe(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,UHe(t,e)):{type:_i.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function UHe(t,e){const n=new yt,r=new Float32Array(t.pointCount*3);for(let i=0;i<t.pointCount;i++)n.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(r,i*3);return r}async function GHe(t,e,n,r,i){n=dL(t,e,n),n=AU(t,e,n),n=_U(t,e,n),jHe(t);const{featureTable:o,batchTable:a}=VHe(t);return await XHe(t,o,a,r,i),$He(t,o,r),HHe(t,o,a),WHe(t,o),n}function jHe(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function VHe(t){const e=new mU(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",_i.FLOAT,3);const r=qHe(t,e);return{featureTable:e,batchTable:r}}function $He(t,e,n){if(!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",_i.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const r=e.getPropertyArray("POSITION_QUANTIZED",_i.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65536-1,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",_i.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",_i.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=zHe(t,r,n)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function HHe(t,e,n){if(!t.attributes.colors){let r=null;e.hasProperty("RGBA")?(r=e.getPropertyArray("RGBA",_i.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?r=e.getPropertyArray("RGB",_i.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(r=e.getPropertyArray("RGB565",_i.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=Lse(t,r,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",_i.UNSIGNED_BYTE,4))}function WHe(t,e){if(!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",_i.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",_i.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=kHe(t,n)}}function qHe(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",_i.UNSIGNED_SHORT,1),t.batchIds)){const r=e.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:o}=t;n=new Rse(i,o,r)}return n}async function XHe(t,e,n,r,i){let o,a,s;const u=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];u&&(s=u.properties);const d=e.getExtension("3DTILES_draco_point_compression");if(d){a=d.properties;const _=d.byteOffset,E=d.byteLength;if(!a||!Number.isFinite(_)||!E)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=t.featureTableBinary.slice(_,_+E),t.hasPositions=Number.isFinite(a.POSITION),t.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),t.hasNormals=Number.isFinite(a.NORMAL),t.hasBatchIds=Number.isFinite(a.BATCH_ID),t.isTranslucent=Number.isFinite(a.RGBA)}if(!o)return!0;const g={buffer:o,properties:{...a,...s},featureTableProperties:a,batchTableProperties:s,dequantizeInShader:!1};return await ZHe(t,g,r,i)}async function ZHe(t,e,n,r){const{parse:i}=r,o={...n,draco:{...n.draco,extraAttributes:e.batchTableProperties||{}}};delete o["3d-tiles"];const a=await i(e.buffer,Ase,o),s=a.attributes.POSITION&&a.attributes.POSITION.value,u=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,d=a.attributes.NORMAL&&a.attributes.NORMAL.value,g=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,_=s&&a.attributes.POSITION.value.quantization,E=d&&a.attributes.NORMAL.value.quantization;if(_){const R=a.POSITION.data.quantization,B=R.range;t.quantizedVolumeScale=new yt(B,B,B),t.quantizedVolumeOffset=new yt(R.minValues),t.quantizedRange=(1<<R.quantizationBits)-1,t.isQuantizedDraco=!0}E&&(t.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const P={};if(e.batchTableProperties)for(const R of Object.keys(e.batchTableProperties))a.attributes[R]&&a.attributes[R].value&&(P[R.toLowerCase()]=a.attributes[R].value);t.attributes={positions:s,colors:Lse(t,u,void 0),normals:d,batchIds:g,...P}}const M4={URI:0,EMBEDDED:1};function Dse(t,e,n,r){t.rotateYtoZ=!0;const i=t.byteOffset+t.byteLength-n;if(i===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=qz(e,n,i),t.gltfByteOffset=0,t.gltfByteLength=i,n%4===0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}async function Bse(t,e,n,r){const i=n["3d-tiles"]||{};if(YHe(t,e),i.loadGLTF){const{parse:o,fetch:a}=r;t.gltfUrl&&(t.gltfArrayBuffer=await a(t.gltfUrl,n),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await o(t.gltfArrayBuffer,dE,n,r),t.gpuMemoryUsageInBytes=gse(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}function YHe(t,e,n){switch(e){case M4.URI:const r=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),o=new TextDecoder().decode(r);t.gltfUrl=o.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case M4.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function QHe(t,e,n,r,i){var o;n=KHe(t,e,n,r),await Bse(t,M4.EMBEDDED,r,i);const a=t==null||(o=t.gltf)===null||o===void 0?void 0:o.extensions;return a&&a.CESIUM_RTC&&(t.rtcCenter=a.CESIUM_RTC.center),n}function KHe(t,e,n,r,i){n=dL(t,e,n),n=AU(t,e,n),n=_U(t,e,n),n=Dse(t,e,n,r);const o=new mU(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=o.getGlobalProperty("RTC_CENTER",_i.FLOAT,3),n}async function JHe(t,e,n,r,i){return n=e7e(t,e,n,r),await Bse(t,t.gltfFormat,r,i),n}function e7e(t,e,n,r,i){if(n=dL(t,e,n),t.version!==1)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));n=AU(t,e,n);const o=new DataView(e);if(t.gltfFormat=o.getUint32(n,!0),n+=4,n=_U(t,e,n),n=Dse(t,e,n,r),t.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new mU(t.featureTableJson,t.featureTableBinary),s=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=a.getGlobalProperty("RTC_CENTER",_i.FLOAT,3);const u=new Rse(t.batchTableJson,t.batchTableBinary,s);return t7e(t,a,u,s),n}function t7e(t,e,n,r){const o={instances:new Array(r),batchTable:t._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,a=new yt;new yt,new yt,new yt;const s=new is,u=new Zm,d=new yt,g={},_=new vr,E=[],P=[],R=new yt,B=new yt;for(let V=0;V<r;V++){let z;if(e.hasProperty("POSITION"))z=e.getProperty("POSITION",_i.FLOAT,3,V,a);else if(e.hasProperty("POSITION_QUANTIZED")){z=e.getProperty("POSITION_QUANTIZED",_i.UNSIGNED_SHORT,3,V,a);const ie=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",_i.FLOAT,3,R);if(!ie)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const ce=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",_i.FLOAT,3,B);if(!ce)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const re=65535;for(let ue=0;ue<3;ue++)z[ue]=z[ue]/re*ce[ue]+ie[ue]}if(!z)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(a.copy(z),g.translation=a,t.normalUp=e.getProperty("NORMAL_UP",_i.FLOAT,3,V,E),t.normalRight=e.getProperty("NORMAL_RIGHT",_i.FLOAT,3,V,P),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",_i.UNSIGNED_SHORT,2,E),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",_i.UNSIGNED_SHORT,2,P),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(ss.WGS84.eastNorthUpToFixedFrame(a,_),_.getRotationMatrix3(s)):s.identity()}u.fromMatrix3(s),g.rotation=u,d.set(1,1,1);const F=e.getProperty("SCALE",_i.FLOAT,1,V);Number.isFinite(F)&&d.multiplyByScalar(F);const k=e.getProperty("SCALE_NON_UNIFORM",_i.FLOAT,3,V,E);k&&d.scale(k),g.scale=d;let X=e.getProperty("BATCH_ID",_i.UNSIGNED_SHORT,1,V);X===void 0&&(X=V);const Y=new vr().fromQuaternion(g.rotation);_.identity(),_.translate(g.translation),_.multiplyRight(Y),_.scale(g.scale);const J=_.clone();o[V]={modelMatrix:J,batchId:X}}t.instances=o}async function n7e(t,e,n,r,i,o){n=dL(t,e,n);const a=new DataView(e);for(t.tilesLength=a.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-n>12;){const s={};t.tiles.push(s),n=await o(e,n,r,i,s)}return n}async function r7e(t,e,n,r){t.rotateYtoZ=!0,t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y";const{parse:i}=r;t.gltf=await i(e,dE,n,r),t.gpuMemoryUsageInBytes=gse(t.gltf)}async function Nse(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(i.byteOffset=e,i.type=yHe(t,e),i.type){case Pb.COMPOSITE:return await n7e(i,t,e,n,r,Nse);case Pb.BATCHED_3D_MODEL:return await QHe(i,t,e,n,r);case Pb.GLTF:return await r7e(i,t,n,r);case Pb.INSTANCED_3D_MODEL:return await JHe(i,t,e,n,r);case Pb.POINT_CLOUD:return await GHe(i,t,e,n,r);default:throw new Error("3DTileLoader: unknown type ".concat(i.type))}}const i7e=1952609651,o7e=1;async function s7e(t,e,n){if(new Uint32Array(t.slice(0,4))[0]!==i7e)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==o7e)throw new Error("Wrong subtree file verson, must be 1");const o=pX(t.slice(8,16)),a=new Uint8Array(t,24,o),u=new TextDecoder("utf8").decode(a),d=JSON.parse(u),g=pX(t.slice(16,24));let _=new ArrayBuffer(0);return g&&(_=t.slice(24+o)),"bufferView"in d.tileAvailability&&(d.tileAvailability.explicitBitstream=await qB(d,"tileAvailability",_,n)),"bufferView"in d.contentAvailability&&(d.contentAvailability.explicitBitstream=await qB(d,"contentAvailability",_,n)),"bufferView"in d.childSubtreeAvailability&&(d.childSubtreeAvailability.explicitBitstream=await qB(d,"childSubtreeAvailability",_,n)),d}function a7e(t,e){if(e.startsWith("http")){const o=new URL(t,e);return decodeURI(o.toString())}const r="http://".concat(e),i=new URL(t,r);return"/".concat(i.host).concat(i.pathname)}async function qB(t,e,n,r){const i=t[e].bufferView,o=t.bufferViews[i],a=t.buffers[o.buffer];if(!(r!=null&&r.url)||!r.fetch)throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(a.uri){const s=a7e(a.uri,r==null?void 0:r.url),d=await(await r.fetch(s)).arrayBuffer();return new Uint8Array(d,o.byteOffset,o.byteLength)}return new Uint8Array(n,o.byteOffset,o.byteLength)}function pX(t){const e=new DataView(t),n=e.getUint32(0,!0),r=e.getUint32(4,!0);return n+2**32*r}const Fse={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:Ise,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:s7e,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var hf=null;try{hf=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Ji(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}Ji.prototype.__isLong__;Object.defineProperty(Ji.prototype,"__isLong__",{value:!0});function Dl(t){return(t&&t.__isLong__)===!0}function gX(t){var e=Math.clz32(t&-t);return t?31-e:e}Ji.isLong=Dl;var mX={},AX={};function b_(t,e){var n,r,i;return e?(t>>>=0,(i=0<=t&&t<256)&&(r=AX[t],r)?r:(n=Oi(t,0,!0),i&&(AX[t]=n),n)):(t|=0,(i=-128<=t&&t<128)&&(r=mX[t],r)?r:(n=Oi(t,t<0?-1:0,!1),i&&(mX[t]=n),n))}Ji.fromInt=b_;function df(t,e){if(isNaN(t))return e?Yp:mh;if(e){if(t<0)return Yp;if(t>=kse)return Gse}else{if(t<=-yX)return Tu;if(t+1>=yX)return Use}return t<0?df(-t,e).neg():Oi(t%v1|0,t/v1|0,e)}Ji.fromNumber=df;function Oi(t,e,n){return new Ji(t,e,n)}Ji.fromBits=Oi;var oM=Math.pow;function yU(t,e,n){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(n=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?Yp:mh;if(n=n||10,n<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return yU(t.substring(1),e,n).neg();for(var i=df(oM(n,8)),o=mh,a=0;a<t.length;a+=8){var s=Math.min(8,t.length-a),u=parseInt(t.substring(a,a+s),n);if(s<8){var d=df(oM(n,s));o=o.mul(d).add(df(u))}else o=o.mul(i),o=o.add(df(u))}return o.unsigned=e,o}Ji.fromString=yU;function Vh(t,e){return typeof t=="number"?df(t,e):typeof t=="string"?yU(t,e):Oi(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Ji.fromValue=Vh;var _X=65536,l7e=1<<24,v1=_X*_X,kse=v1*v1,yX=kse/2,vX=b_(l7e),mh=b_(0);Ji.ZERO=mh;var Yp=b_(0,!0);Ji.UZERO=Yp;var uv=b_(1);Ji.ONE=uv;var zse=b_(1,!0);Ji.UONE=zse;var O4=b_(-1);Ji.NEG_ONE=O4;var Use=Oi(-1,2147483647,!1);Ji.MAX_VALUE=Use;var Gse=Oi(-1,-1,!0);Ji.MAX_UNSIGNED_VALUE=Gse;var Tu=Oi(0,-2147483648,!1);Ji.MIN_VALUE=Tu;var wn=Ji.prototype;wn.toInt=function(){return this.unsigned?this.low>>>0:this.low};wn.toNumber=function(){return this.unsigned?(this.high>>>0)*v1+(this.low>>>0):this.high*v1+(this.low>>>0)};wn.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Tu)){var n=df(e),r=this.div(n),i=r.mul(n).sub(this);return r.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=df(oM(e,6),this.unsigned),a=this,s="";;){var u=a.div(o),d=a.sub(u.mul(o)).toInt()>>>0,g=d.toString(e);if(a=u,a.isZero())return g+s;for(;g.length<6;)g="0"+g;s=""+g+s}};wn.getHighBits=function(){return this.high};wn.getHighBitsUnsigned=function(){return this.high>>>0};wn.getLowBits=function(){return this.low};wn.getLowBitsUnsigned=function(){return this.low>>>0};wn.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Tu)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};wn.isZero=function(){return this.high===0&&this.low===0};wn.eqz=wn.isZero;wn.isNegative=function(){return!this.unsigned&&this.high<0};wn.isPositive=function(){return this.unsigned||this.high>=0};wn.isOdd=function(){return(this.low&1)===1};wn.isEven=function(){return(this.low&1)===0};wn.equals=function(e){return Dl(e)||(e=Vh(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};wn.eq=wn.equals;wn.notEquals=function(e){return!this.eq(e)};wn.neq=wn.notEquals;wn.ne=wn.notEquals;wn.lessThan=function(e){return this.comp(e)<0};wn.lt=wn.lessThan;wn.lessThanOrEqual=function(e){return this.comp(e)<=0};wn.lte=wn.lessThanOrEqual;wn.le=wn.lessThanOrEqual;wn.greaterThan=function(e){return this.comp(e)>0};wn.gt=wn.greaterThan;wn.greaterThanOrEqual=function(e){return this.comp(e)>=0};wn.gte=wn.greaterThanOrEqual;wn.ge=wn.greaterThanOrEqual;wn.compare=function(e){if(Dl(e)||(e=Vh(e)),this.eq(e))return 0;var n=this.isNegative(),r=e.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};wn.comp=wn.compare;wn.negate=function(){return!this.unsigned&&this.eq(Tu)?Tu:this.not().add(uv)};wn.neg=wn.negate;wn.add=function(e){Dl(e)||(e=Vh(e));var n=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,s=e.high&65535,u=e.low>>>16,d=e.low&65535,g=0,_=0,E=0,P=0;return P+=o+d,E+=P>>>16,P&=65535,E+=i+u,_+=E>>>16,E&=65535,_+=r+s,g+=_>>>16,_&=65535,g+=n+a,g&=65535,Oi(E<<16|P,g<<16|_,this.unsigned)};wn.subtract=function(e){return Dl(e)||(e=Vh(e)),this.add(e.neg())};wn.sub=wn.subtract;wn.multiply=function(e){if(this.isZero())return this;if(Dl(e)||(e=Vh(e)),hf){var n=hf.mul(this.low,this.high,e.low,e.high);return Oi(n,hf.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Yp:mh;if(this.eq(Tu))return e.isOdd()?Tu:mh;if(e.eq(Tu))return this.isOdd()?Tu:mh;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(vX)&&e.lt(vX))return df(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,i=this.high&65535,o=this.low>>>16,a=this.low&65535,s=e.high>>>16,u=e.high&65535,d=e.low>>>16,g=e.low&65535,_=0,E=0,P=0,R=0;return R+=a*g,P+=R>>>16,R&=65535,P+=o*g,E+=P>>>16,P&=65535,P+=a*d,E+=P>>>16,P&=65535,E+=i*g,_+=E>>>16,E&=65535,E+=o*d,_+=E>>>16,E&=65535,E+=a*u,_+=E>>>16,E&=65535,_+=r*g+i*d+o*u+a*s,_&=65535,Oi(P<<16|R,_<<16|E,this.unsigned)};wn.mul=wn.multiply;wn.divide=function(e){if(Dl(e)||(e=Vh(e)),e.isZero())throw Error("division by zero");if(hf){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?hf.div_u:hf.div_s)(this.low,this.high,e.low,e.high);return Oi(n,hf.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Yp:mh;var r,i,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Yp;if(e.gt(this.shru(1)))return zse;o=Yp}else{if(this.eq(Tu)){if(e.eq(uv)||e.eq(O4))return Tu;if(e.eq(Tu))return uv;var a=this.shr(1);return r=a.div(e).shl(1),r.eq(mh)?e.isNegative()?uv:O4:(i=this.sub(e.mul(r)),o=r.add(i.div(e)),o)}else if(e.eq(Tu))return this.unsigned?Yp:mh;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=mh}for(i=this;i.gte(e);){r=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:oM(2,s-48),d=df(r),g=d.mul(e);g.isNegative()||g.gt(i);)r-=u,d=df(r,this.unsigned),g=d.mul(e);d.isZero()&&(d=uv),o=o.add(d),i=i.sub(g)}return o};wn.div=wn.divide;wn.modulo=function(e){if(Dl(e)||(e=Vh(e)),hf){var n=(this.unsigned?hf.rem_u:hf.rem_s)(this.low,this.high,e.low,e.high);return Oi(n,hf.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};wn.mod=wn.modulo;wn.rem=wn.modulo;wn.not=function(){return Oi(~this.low,~this.high,this.unsigned)};wn.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};wn.clz=wn.countLeadingZeros;wn.countTrailingZeros=function(){return this.low?gX(this.low):gX(this.high)+32};wn.ctz=wn.countTrailingZeros;wn.and=function(e){return Dl(e)||(e=Vh(e)),Oi(this.low&e.low,this.high&e.high,this.unsigned)};wn.or=function(e){return Dl(e)||(e=Vh(e)),Oi(this.low|e.low,this.high|e.high,this.unsigned)};wn.xor=function(e){return Dl(e)||(e=Vh(e)),Oi(this.low^e.low,this.high^e.high,this.unsigned)};wn.shiftLeft=function(e){return Dl(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Oi(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Oi(0,this.low<<e-32,this.unsigned)};wn.shl=wn.shiftLeft;wn.shiftRight=function(e){return Dl(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Oi(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Oi(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};wn.shr=wn.shiftRight;wn.shiftRightUnsigned=function(e){return Dl(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Oi(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Oi(this.high,0,this.unsigned):Oi(this.high>>>e-32,0,this.unsigned)};wn.shru=wn.shiftRightUnsigned;wn.shr_u=wn.shiftRightUnsigned;wn.rotateLeft=function(e){var n;return Dl(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Oi(this.high,this.low,this.unsigned):e<32?(n=32-e,Oi(this.low<<e|this.high>>>n,this.high<<e|this.low>>>n,this.unsigned)):(e-=32,n=32-e,Oi(this.high<<e|this.low>>>n,this.low<<e|this.high>>>n,this.unsigned))};wn.rotl=wn.rotateLeft;wn.rotateRight=function(e){var n;return Dl(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Oi(this.high,this.low,this.unsigned):e<32?(n=32-e,Oi(this.high<<n|this.low>>>e,this.low<<n|this.high>>>e,this.unsigned)):(e-=32,n=32-e,Oi(this.low<<n|this.high>>>e,this.high<<n|this.low>>>e,this.unsigned))};wn.rotr=wn.rotateRight;wn.toSigned=function(){return this.unsigned?Oi(this.low,this.high,!1):this};wn.toUnsigned=function(){return this.unsigned?this:Oi(this.low,this.high,!0)};wn.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};wn.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};wn.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};Ji.fromBytes=function(e,n,r){return r?Ji.fromBytesLE(e,n):Ji.fromBytesBE(e,n)};Ji.fromBytesLE=function(e,n){return new Ji(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};Ji.fromBytesBE=function(e,n){return new Ji(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const u7e=16;function jse(t){t==="X"&&(t="");const e=t.padEnd(u7e,"0");return Ji.fromString(e,!0,16)}function c7e(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const n=e%4;e=(e-n)/4;const r=e;e*=4;const o=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-r-o.length).join("0")+o}function f7e(t,e){const n=h7e(t).shiftRightUnsigned(2);return t.add(Ji.fromNumber(2*e+1-4).multiply(n))}function h7e(t){return t.and(t.not().add(1))}const d7e=3,p7e=30,g7e=2*p7e+1,xX=180/Math.PI;function m7e(t){if(t.length===0)throw new Error("Invalid Hilbert quad key ".concat(t));const e=t.split("/"),n=parseInt(e[0],10),r=e[1],i=r.length;let o=0;const a=[0,0];for(let s=i-1;s>=0;s--){o=i-s;const u=r[s];let d=0,g=0;u==="1"?g=1:u==="2"?(d=1,g=1):u==="3"&&(d=1);const _=Math.pow(2,o-1);_7e(_,a,d,g),a[0]+=_*d,a[1]+=_*g}if(n%2===1){const s=a[0];a[0]=a[1],a[1]=s}return{face:n,ij:a,level:o}}function A7e(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<d7e+g7e;)e="0"+e;const n=e.lastIndexOf("1"),r=e.substring(0,3),i=e.substring(3,n),o=i.length/2,a=Ji.fromString(r,!0,2).toString(10);let s="";if(o!==0)for(s=Ji.fromString(i,!0,2).toString(4);s.length<o;)s="0"+s;return"".concat(a,"/").concat(s)}function Vse(t,e,n){const r=1<<e;return[(t[0]+n[0])/r,(t[1]+n[1])/r]}function bX(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function $se(t){return[bX(t[0]),bX(t[1])]}function Hse(t,e){let[n,r]=e;switch(t){case 0:return[1,n,r];case 1:return[-n,1,r];case 2:return[-n,-r,1];case 3:return[-1,-r,-n];case 4:return[r,-1,-n];case 5:return[r,n,-1];default:throw new Error("Invalid face")}}function Wse(t){let[e,n,r]=t;const i=Math.atan2(r,Math.sqrt(e*e+n*n));return[Math.atan2(n,e)*xX,i*xX]}function _7e(t,e,n,r){if(r===0){n===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function y7e(t){const e=Vse(t.ij,t.level,[.5,.5]),n=$se(e),r=Hse(t.face,n);return Wse(r)}const v7e=100;function wX(t){const{face:e,ij:n,level:r}=t,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil(v7e*Math.pow(2,-r))),a=new Float64Array(4*o*2+2);let s=0,u=0;for(let d=0;d<4;d++){const g=i[d].slice(0),_=i[d+1],E=(_[0]-g[0])/o,P=(_[1]-g[1])/o;for(let R=0;R<o;R++){g[0]+=E,g[1]+=P;const B=Vse(n,r,g),V=$se(B),z=Hse(e,V),F=Wse(z);Math.abs(F[1])>89.999&&(F[0]=u);const k=F[0]-u;F[0]+=k>180?-360:k<-180?360:0,a[s++]=F[0],a[s++]=F[1],u=F[0]}}return a[s++]=a[0],a[s++]=a[1],a}function vU(t){const e=x7e(t);return m7e(e)}function x7e(t){if(t.indexOf("/")>0)return t;const e=jse(t);return A7e(e)}function b7e(t){const e=vU(t);return y7e(e)}function w7e(t){let e;if(t.face===2||t.face===5){let n=null,r=0;for(let i=0;i<4;i++){const o="".concat(t.face,"/").concat(i),a=vU(o),s=wX(a);(typeof n>"u"||n===null)&&(n=new Float64Array(4*s.length)),n.set(s,r),r+=s.length}e=EX(n)}else{const n=wX(t);e=EX(n)}return e}function EX(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],n=[];for(let r=0;r<t.length;r+=2)e.push(t[r]),n.push(t[r+1]);return e.sort((r,i)=>r-i),n.sort((r,i)=>r-i),{west:e[0],east:e[e.length-1],north:n[n.length-1],south:n[0]}}function E7e(t,e){const n=(e==null?void 0:e.minimumHeight)||0,r=(e==null?void 0:e.maximumHeight)||0,i=vU(t),o=w7e(i),a=o.west,s=o.south,u=o.east,d=o.north,g=[];return g.push(new yt(a,d,n)),g.push(new yt(u,d,n)),g.push(new yt(u,s,n)),g.push(new yt(a,s,n)),g.push(new yt(a,d,r)),g.push(new yt(u,d,r)),g.push(new yt(u,s,r)),g.push(new yt(a,s,r)),g}function qse(t){const e=t.token,n={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},r=E7e(e,n),i=b7e(e),o=i[0],a=i[1],s=ss.WGS84.cartographicToCartesian([o,a,n.maximumHeight]),u=new yt(s[0],s[1],s[2]);r.push(u);const d=Roe(r);return[...d.center,...d.halfAxes]}const S7e=4,T7e=8,C7e={QUADTREE:S7e,OCTREE:T7e};function P7e(t,e,n){if(t!=null&&t.box){const r=jse(t.s2VolumeInfo.token),i=f7e(r,e),o=c7e(i),a={...t.s2VolumeInfo};switch(a.token=o,n){case"OCTREE":const d=t.s2VolumeInfo,g=d.maximumHeight-d.minimumHeight,_=g/2,E=d.minimumHeight+g/2;d.minimumHeight=E-_,d.maximumHeight=E+_;break}return{box:qse(a),s2VolumeInfo:a}}}async function Xse(t){const{options:e,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,globalData:i={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:o}=t;let{subtree:a,level:s=0}=t;const{subdivisionScheme:u,subtreeLevels:d,maximumLevel:g,contentUrlTemplate:_,subtreesUriTemplate:E,basePath:P}=e,R={children:[],lodMetricValue:0,contentUrl:""},B=C7e[u],V=r&1,z=r>>1&1,F=r>>2&1,k=(B**s-1)/(B-1);let X=u0(n.mortonIndex,r),Y=k+X,J=u0(n.x,V),ie=u0(n.y,z),ce=u0(n.z,F),re=!1;s+1>d&&(re=XB(a.childSubtreeAvailability,X));const ue=u0(i.x,J),se=u0(i.y,ie),me=u0(i.z,ce),Ce=s+i.level;if(re){const Ee="".concat(P,"/").concat(E),Ne=R4(Ee,Ce,ue,se,me);a=await ag(Ne,Fse),i.mortonIndex=X,i.x=J,i.y=ie,i.z=ce,i.level=s,X=0,Y=0,J=0,ie=0,ce=0,s=0}if(!XB(a.tileAvailability,Y)||s>g)return R;XB(a.contentAvailability,Y)&&(R.contentUrl=R4(_,Ce,ue,se,me));const tt=s+1,pt={mortonIndex:X,x:J,y:ie,z:ce};for(let Ee=0;Ee<B;Ee++){const Ne=P7e(o,Ee,u),Be=await Xse({subtree:a,options:e,parentData:pt,childIndex:Ee,level:tt,globalData:i,s2VolumeBox:Ne});if(Be.contentUrl||Be.children.length){const qe=Ce+1,Ct=I7e(Be,qe,{childTileX:J,childTileY:ie,childTileZ:ce},e,o);R.children.push(Ct)}}return R}function XB(t,e){return"constant"in t?!!t.constant:t.explicitBitstream?R7e(e,t.explicitBitstream):!1}function I7e(t,e,n,r,i){const{basePath:o,refine:a,getRefine:s,lodMetricType:u,getTileType:d,rootLodMetricValue:g,rootBoundingVolume:_}=r,E=t.contentUrl&&t.contentUrl.replace("".concat(o,"/"),""),P=g/2**e,R=i!=null&&i.box?{box:i.box}:_,B=M7e(e,R,n);return{children:t.children,contentUrl:t.contentUrl,content:{uri:E},id:t.contentUrl,refine:s(a),type:d(t),lodMetricType:u,lodMetricValue:P,geometricError:P,transform:t.transform,boundingVolume:B}}function M7e(t,e,n){if(e.region){const{childTileX:r,childTileY:i,childTileZ:o}=n,[a,s,u,d,g,_]=e.region,E=2**t,P=(u-a)/E,R=(d-s)/E,B=(_-g)/E,[V,z]=[a+P*r,a+P*(r+1)],[F,k]=[s+R*i,s+R*(i+1)],[X,Y]=[g+B*o,g+B*(o+1)];return{region:[V,F,z,k,X,Y]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}function u0(t,e){return parseInt(t.toString(2)+e.toString(2),2)}function R4(t,e,n,r,i){const o=O7e({level:e,x:n,y:r,z:i});return t.replace(/{level}|{x}|{y}|{z}/gi,a=>o[a])}function O7e(t){const e={};for(const n in t)e["{".concat(n,"}")]=t[n];return e}function R7e(t,e){const n=Math.floor(t/8),r=t%8;return(e[n]>>r&1)===1}function xU(t){if(!t.contentUrl)return bv.EMPTY;const n=t.contentUrl.split("?")[0].split(".").pop();switch(n){case"pnts":return bv.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return bv.SCENEGRAPH;default:return n}}function bU(t){switch(t){case"REPLACE":case"replace":return tg.REPLACE;case"ADD":case"add":return tg.ADD;default:return t}}function L4(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const r=new URL(t,"".concat(e,"/"));return decodeURI(r.toString())}else if(t.startsWith("/"))return t;return"".concat(e,"/").concat(t)}function SX(t,e){if(!t)return null;if(t.content){const n=t.content.uri||t.content.url;t.contentUrl=L4(n,e.basePath)}return t.id=t.contentUrl,t.lodMetricType=fL.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=xU(t),t.refine=bU(t.refine),t}async function L7e(t,e){const n=t.basePath;let r;const i=CX(t==null?void 0:t.root);i&&t.root?r=await TX(t.root,t,i,e):r=SX(t.root,t);const o=[];for(o.push(r);o.length>0;){const s=(o.pop()||{}).children||[];for(let u of s){const d=CX(u);d?u=await TX(u,t,d,e):SX(u,{basePath:n}),o.push(u)}}return r}async function TX(t,e,n,r){var i,o;const a=e.basePath,{subdivisionScheme:s,maximumLevel:u,subtreeLevels:d,subtrees:{uri:g}}=n,_=R4(g,0,0,0,0),E=L4(_,a),P=await ag(E,Fse,r),R=L4(t.content.uri,a),B=e==null||(i=e.root)===null||i===void 0?void 0:i.refine,V=t.geometricError,z=(o=t.boundingVolume.extensions)===null||o===void 0?void 0:o["3DTILES_bounding_volume_S2"];if(z){const Y={box:qse(z),s2VolumeInfo:z};t.boundingVolume=Y}const F=t.boundingVolume,k={contentUrlTemplate:R,subtreesUriTemplate:g,subdivisionScheme:s,subtreeLevels:d,maximumLevel:u,refine:B,basePath:a,lodMetricType:fL.GEOMETRIC_ERROR,rootLodMetricValue:V,rootBoundingVolume:F,getTileType:xU,getRefine:bU};return await D7e(t,P,k)}async function D7e(t,e,n){if(!t)return null;t.lodMetricType=fL.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform;const{children:r,contentUrl:i}=await Xse({subtree:e,options:n,s2VolumeBox:t});return i&&(t.contentUrl=i,t.content={uri:i.replace("".concat(n.basePath,"/"),"")}),t.refine=bU(t.refine),t.type=xU(t),t.children=r,t.id=t.contentUrl,t}function CX(t){var e;return(t==null||(e=t.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(t==null?void 0:t.implicitTiling)}const Zse={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:Ise,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:k7e,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function B7e(t){return Xz(t.url)}async function N7e(t,e,n){const r={content:{featureIds:null}};return await Nse(t,0,e,n,r.content),r.content}async function F7e(t,e,n){var r;const i=JSON.parse(new TextDecoder().decode(t));return i.loader=e.loader||Zse,i.url=n.url,i.queryString=n.queryString,i.basePath=B7e(i),i.root=await L7e(i,e),i.type=tf.TILES3D,i.lodMetricType=fL.GEOMETRIC_ERROR,i.lodMetricValue=((r=i.root)===null||r===void 0?void 0:r.lodMetricValue)||0,i}async function k7e(t,e,n){const r=e["3d-tiles"]||{};let i;return r.isTileset==="auto"?i=n.url&&n.url.indexOf(".json")!==-1:i=r.isTileset,i?t=await F7e(t,e,n):t=await N7e(t,e,n),t}const PX=[0],z7e={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Zse,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,n)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class wU extends Uh{constructor(...e){super(...e),q(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&Or.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){const{tileset3d:e}=this.state;return e!==null&&e.isLoaded()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:n,changeFlags:r}){if(e.data&&e.data!==n.data&&this._loadTileset(e.data),r.viewportChanged){const{activeViewports:i}=this.state;Object.keys(i).length&&(this._updateTileset(i),this.state.lastUpdatedViewports=i,this.state.activeViewports={})}if(r.propsChanged){const{layerMap:i}=this.state;for(const o in i)i[o].needsUpdate=!0}}activateViewport(e){const{activeViewports:n,lastUpdatedViewports:r}=this.state;this.internalState.viewport=e,n[e.id]=e;const i=r==null?void 0:r[e.id];(!i||!e.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:n}){const r=n&&n.props.tile;return e.picked&&(e.object=r),e.sourceTile=r,e}filterSubLayer({layer:e,viewport:n}){const{tile:r}=e.props,{id:i}=n;return r.selected&&r.viewportIds.includes(i)}_updateAutoHighlight(e){const n=e.sourceTile,r=this.state.layerMap[n==null?void 0:n.id];r&&r.layer&&r.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:n={}}=this.props;let r=this.props.loader||this.props.loaders;Array.isArray(r)&&(r=r[0]);const i={loadOptions:{...n}};let o=e;if(r.preload){const u=await r.preload(e,n);u.url&&(o=u.url),u.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:u.headers}),Object.assign(i,u)}const a=await ag(o,r,i.loadOptions),s=new _He(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:s,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(s)}_onTileLoad(e){const{lastUpdatedViewports:n}=this.state;this.props.onTileLoad(e),this._updateTileset(n),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:n}=this.state,{timeline:r}=this.context,i=Object.keys(e).length;!r||!i||!n||n.selectTiles(Object.values(e)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(e,n){if(!e.content)return null;switch(e.type){case bv.POINTCLOUD:return this._makePointCloudLayer(e,n);case bv.SCENEGRAPH:return this._make3DModelLayer(e);case bv.MESH:return this._makeSimpleMeshLayer(e,n);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,n){const{attributes:r,pointCount:i,constantRGBA:o,cartographicOrigin:a,modelMatrix:s}=e.content,{positions:u,normals:d,colors:g}=r;if(!u)return null;const _=n&&n.props.data||{header:{vertexCount:i},attributes:{POSITION:u,NORMAL:d,COLOR_0:g}},{pointSize:E,getPointColor:P}=this.props,R=this.getSubLayerClass("pointcloud",$R);return new R({pointSize:E},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:_,coordinateSystem:Br.METER_OFFSETS,coordinateOrigin:a,modelMatrix:s,getColor:o||P,_offset:0})}_make3DModelLayer(e){const{gltf:n,instances:r,cartographicOrigin:i,modelMatrix:o}=e.content,a=this.getSubLayerClass("scenegraph",uL);return new a({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:r||PX,scenegraph:n,coordinateSystem:Br.METER_OFFSETS,coordinateOrigin:i,modelMatrix:o,getTransformMatrix:s=>s.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,n){const r=e.content,{attributes:i,indices:o,modelMatrix:a,cartographicOrigin:s,coordinateSystem:u=Br.METER_OFFSETS,material:d,featureIds:g}=r,{_getMeshColor:_}=this.props,E=n&&n.props.mesh||new Cs({drawMode:4,attributes:U7e(i),indices:o}),P=this.getSubLayerClass("mesh",gU);return new P(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:E,data:PX,getColor:_(e),pbrMaterial:d,modelMatrix:a,coordinateOrigin:s,coordinateSystem:u,featureIds:g,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:n}=this.state;return e?e.tiles.map(r=>{const i=n[r.id]=n[r.id]||{tile:r};let{layer:o}=i;return r.selected&&(o?i.needsUpdate&&(o=this._getSubLayer(r,o),i.needsUpdate=!1):o=this._getSubLayer(r)),i.layer=o,o}).filter(Boolean):null}}q(wU,"defaultProps",z7e);q(wU,"layerName","Tile3DLayer");function U7e(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}function G7e(t,e,n,r){const i=r?V7e(r,t.POSITION.value):j7e(e),o=new t.POSITION.value.constructor(i.length*6),a=new t.TEXCOORD_0.value.constructor(i.length*4),s=new e.constructor(i.length*6);for(let d=0;d<i.length;d++){const g=i[d];$7e({edge:g,edgeIndex:d,attributes:t,skirtHeight:n,newPosition:o,newTexcoord0:a,newTriangles:s})}t.POSITION.value=OD(t.POSITION.value,o),t.TEXCOORD_0.value=OD(t.TEXCOORD_0.value,a);const u=e instanceof Array?e.concat(s):OD(e,s);return{attributes:t,triangles:u}}function j7e(t){const e=[];for(let a=0;a<t.length;a+=3)e.push([t[a],t[a+1]]),e.push([t[a+1],t[a+2]]),e.push([t[a+2],t[a]]);e.sort((a,s)=>Math.min(...a)-Math.min(...s)||Math.max(...a)-Math.max(...s));const n=[];let r=0;for(;r<e.length;){var i,o;e[r][0]===((i=e[r+1])===null||i===void 0?void 0:i[1])&&e[r][1]===((o=e[r+1])===null||o===void 0?void 0:o[0])?r+=2:(n.push(e[r]),r++)}return n}function V7e(t,e){t.westIndices.sort((r,i)=>e[3*r+1]-e[3*i+1]),t.eastIndices.sort((r,i)=>e[3*i+1]-e[3*r+1]),t.southIndices.sort((r,i)=>e[3*i]-e[3*r]),t.northIndices.sort((r,i)=>e[3*r]-e[3*i]);const n=[];for(const r in t){const i=t[r];for(let o=0;o<i.length-1;o++)n.push([i[o],i[o+1]])}return n}function $7e(t){let{edge:e,edgeIndex:n,attributes:r,skirtHeight:i,newPosition:o,newTexcoord0:a,newTriangles:s}=t;const u=r.POSITION.value.length,d=n*2,g=n*2+1;o.set(r.POSITION.value.subarray(e[0]*3,e[0]*3+3),d*3),o[d*3+2]=o[d*3+2]-i,o.set(r.POSITION.value.subarray(e[1]*3,e[1]*3+3),g*3),o[g*3+2]=o[g*3+2]-i,a.set(r.TEXCOORD_0.value.subarray(e[0]*2,e[0]*2+2),d*2),a.set(r.TEXCOORD_0.value.subarray(e[1]*2,e[1]*2+2),g*2);const _=n*2*3;s[_]=e[0],s[_+1]=u/3+g,s[_+2]=e[1],s[_+3]=u/3+g,s[_+4]=e[0],s[_+5]=u/3+d}class H7e{constructor(e=257){this.gridSize=e;const n=e-1;if(n&n-1)throw new Error(`Expected grid size to be 2^n+1, got ${e}.`);this.numTriangles=n*n*2-2,this.numParentTriangles=this.numTriangles-n*n,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(this.numTriangles*4);for(let r=0;r<this.numTriangles;r++){let i=r+2,o=0,a=0,s=0,u=0,d=0,g=0;for(i&1?s=u=d=n:o=a=g=n;(i>>=1)>1;){const E=o+s>>1,P=a+u>>1;i&1?(s=o,u=a,o=d,a=g):(o=s,a=u,s=d,u=g),d=E,g=P}const _=r*4;this.coords[_+0]=o,this.coords[_+1]=a,this.coords[_+2]=s,this.coords[_+3]=u}}createTile(e){return new W7e(e,this)}}class W7e{constructor(e,n){const r=n.gridSize;if(e.length!==r*r)throw new Error(`Expected terrain data of length ${r*r} (${r} x ${r}), got ${e.length}.`);this.terrain=e,this.martini=n,this.errors=new Float32Array(e.length),this.update()}update(){const{numTriangles:e,numParentTriangles:n,coords:r,gridSize:i}=this.martini,{terrain:o,errors:a}=this;for(let s=e-1;s>=0;s--){const u=s*4,d=r[u+0],g=r[u+1],_=r[u+2],E=r[u+3],P=d+_>>1,R=g+E>>1,B=P+R-g,V=R+d-P,z=(o[g*i+d]+o[E*i+_])/2,F=R*i+P,k=Math.abs(z-o[F]);if(a[F]=Math.max(a[F],k),s<n){const X=(g+V>>1)*i+(d+B>>1),Y=(E+V>>1)*i+(_+B>>1);a[F]=Math.max(a[F],a[X],a[Y])}}}getMesh(e=0){const{gridSize:n,indices:r}=this.martini,{errors:i}=this;let o=0,a=0;const s=n-1;r.fill(0);function u(P,R,B,V,z,F){const k=P+B>>1,X=R+V>>1;Math.abs(P-z)+Math.abs(R-F)>1&&i[X*n+k]>e?(u(z,F,P,R,k,X),u(B,V,z,F,k,X)):(r[R*n+P]=r[R*n+P]||++o,r[V*n+B]=r[V*n+B]||++o,r[F*n+z]=r[F*n+z]||++o,a++)}u(0,0,s,s,s,0),u(s,s,0,0,0,s);const d=new Uint16Array(o*2),g=new Uint32Array(a*3);let _=0;function E(P,R,B,V,z,F){const k=P+B>>1,X=R+V>>1;if(Math.abs(P-z)+Math.abs(R-F)>1&&i[X*n+k]>e)E(z,F,P,R,k,X),E(B,V,z,F,k,X);else{const Y=r[R*n+P]-1,J=r[V*n+B]-1,ie=r[F*n+z]-1;d[2*Y]=P,d[2*Y+1]=R,d[2*J]=B,d[2*J+1]=V,d[2*ie]=z,d[2*ie+1]=F,g[_++]=Y,g[_++]=J,g[_++]=ie}}return E(0,0,s,s,s,0),E(s,s,0,0,0,s),{vertices:d,triangles:g}}}class q7e{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:n;this.data=e,this.width=n,this.height=r,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;const i=n-1,o=r-1,a=this._addPoint(0,0),s=this._addPoint(i,0),u=this._addPoint(0,o),d=this._addPoint(i,o),g=this._addTriangle(d,a,u,-1,-1,-1);this._addTriangle(a,d,s,g,-1,-1),this._flush()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;for(;this.getMaxError()>e;)this.refine()}refine(){this._step(),this._flush()}getMaxError(){return this._errors[0]}getRMSD(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}heightAt(e,n){return this.data[this.width*n+e]}_flush(){const e=this.coords;for(let n=0;n<this._pendingLen;n++){const r=this._pending[n],i=2*this.triangles[r*3+0],o=2*this.triangles[r*3+1],a=2*this.triangles[r*3+2];this._findCandidate(e[i],e[i+1],e[o],e[o+1],e[a],e[a+1],r)}this._pendingLen=0}_findCandidate(e,n,r,i,o,a,s){const u=Math.min(e,r,o),d=Math.min(n,i,a),g=Math.max(e,r,o),_=Math.max(n,i,a);let E=c0(r,i,o,a,u,d),P=c0(o,a,e,n,u,d),R=c0(e,n,r,i,u,d);const B=i-n,V=e-r,z=a-i,F=r-o,k=n-a,X=o-e,Y=c0(e,n,r,i,o,a),J=this.heightAt(e,n)/Y,ie=this.heightAt(r,i)/Y,ce=this.heightAt(o,a)/Y;let re=0,ue=0,se=0,me=0;for(let Ce=d;Ce<=_;Ce++){let be=0;E<0&&z!==0&&(be=Math.max(be,Math.floor(-E/z))),P<0&&k!==0&&(be=Math.max(be,Math.floor(-P/k))),R<0&&B!==0&&(be=Math.max(be,Math.floor(-R/B)));let Ye=E+z*be,tt=P+k*be,pt=R+B*be,Ee=!1;for(let Ne=u+be;Ne<=g;Ne++){if(Ye>=0&&tt>=0&&pt>=0){Ee=!0;const Be=J*Ye+ie*tt+ce*pt,qe=Math.abs(Be-this.heightAt(Ne,Ce));me+=qe*qe,qe>re&&(re=qe,ue=Ne,se=Ce)}else if(Ee)break;Ye+=z,tt+=k,pt+=B}E+=F,P+=X,R+=V}(ue===e&&se===n||ue===r&&se===i||ue===o&&se===a)&&(re=0),this._candidates[2*s]=ue,this._candidates[2*s+1]=se,this._rms[s]=me,this._queuePush(s,re,me)}_step(){const e=this._queuePop(),n=e*3+0,r=e*3+1,i=e*3+2,o=this.triangles[n],a=this.triangles[r],s=this.triangles[i],u=this.coords[2*o],d=this.coords[2*o+1],g=this.coords[2*a],_=this.coords[2*a+1],E=this.coords[2*s],P=this.coords[2*s+1],R=this._candidates[2*e],B=this._candidates[2*e+1],V=this._addPoint(R,B);if(c0(u,d,g,_,R,B)===0)this._handleCollinear(V,n);else if(c0(g,_,E,P,R,B)===0)this._handleCollinear(V,r);else if(c0(E,P,u,d,R,B)===0)this._handleCollinear(V,i);else{const z=this._halfedges[n],F=this._halfedges[r],k=this._halfedges[i],X=this._addTriangle(o,a,V,z,-1,-1,n),Y=this._addTriangle(a,s,V,F,-1,X+1),J=this._addTriangle(s,o,V,k,X+2,Y+1);this._legalize(X),this._legalize(Y),this._legalize(J)}}_addPoint(e,n){const r=this.coords.length>>1;return this.coords.push(e,n),r}_addTriangle(e,n,r,i,o,a){let s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:this.triangles.length;const u=s/3;return this.triangles[s+0]=e,this.triangles[s+1]=n,this.triangles[s+2]=r,this._halfedges[s+0]=i,this._halfedges[s+1]=o,this._halfedges[s+2]=a,i>=0&&(this._halfedges[i]=s+0),o>=0&&(this._halfedges[o]=s+1),a>=0&&(this._halfedges[a]=s+2),this._candidates[2*u+0]=0,this._candidates[2*u+1]=0,this._queueIndices[u]=-1,this._rms[u]=0,this._pending[this._pendingLen++]=u,s}_legalize(e){const n=this._halfedges[e];if(n<0)return;const r=e-e%3,i=n-n%3,o=r+(e+1)%3,a=r+(e+2)%3,s=i+(n+2)%3,u=i+(n+1)%3,d=this.triangles[a],g=this.triangles[e],_=this.triangles[o],E=this.triangles[s],P=this.coords;if(!X7e(P[2*d],P[2*d+1],P[2*g],P[2*g+1],P[2*_],P[2*_+1],P[2*E],P[2*E+1]))return;const R=this._halfedges[o],B=this._halfedges[a],V=this._halfedges[s],z=this._halfedges[u];this._queueRemove(r/3),this._queueRemove(i/3);const F=this._addTriangle(d,E,_,-1,V,R,r),k=this._addTriangle(E,d,g,F,B,z,i);this._legalize(F+1),this._legalize(k+2)}_handleCollinear(e,n){const r=n-n%3,i=r+(n+1)%3,o=r+(n+2)%3,a=this.triangles[o],s=this.triangles[n],u=this.triangles[i],d=this._halfedges[i],g=this._halfedges[o],_=this._halfedges[n];if(_<0){const J=this._addTriangle(e,a,s,-1,g,-1,r),ie=this._addTriangle(a,e,u,J,-1,d);this._legalize(J+1),this._legalize(ie+2);return}const E=_-_%3,P=E+(_+2)%3,R=E+(_+1)%3,B=this.triangles[P],V=this._halfedges[P],z=this._halfedges[R];this._queueRemove(E/3);const F=this._addTriangle(a,s,e,g,-1,-1,r),k=this._addTriangle(s,B,e,z,-1,F+1,E),X=this._addTriangle(B,u,e,V,-1,k+1),Y=this._addTriangle(u,a,e,d,F+2,X+1);this._legalize(F),this._legalize(k),this._legalize(X),this._legalize(Y)}_queuePush(e,n,r){const i=this._queue.length;this._queueIndices[e]=i,this._queue.push(e),this._errors.push(n),this._rmsSum+=r,this._queueUp(i)}_queuePop(){const e=this._queue.length-1;return this._queueSwap(0,e),this._queueDown(0,e),this._queuePopBack()}_queuePopBack(){const e=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[e],this._queueIndices[e]=-1,e}_queueRemove(e){const n=this._queueIndices[e];if(n<0){const i=this._pending.indexOf(e);if(i!==-1)this._pending[i]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}const r=this._queue.length-1;r!==n&&(this._queueSwap(n,r),this._queueDown(n,r)||this._queueUp(n)),this._queuePopBack()}_queueLess(e,n){return this._errors[e]>this._errors[n]}_queueSwap(e,n){const r=this._queue[e],i=this._queue[n];this._queue[e]=i,this._queue[n]=r,this._queueIndices[r]=n,this._queueIndices[i]=e;const o=this._errors[e];this._errors[e]=this._errors[n],this._errors[n]=o}_queueUp(e){let n=e;for(;;){const r=n-1>>1;if(r===n||!this._queueLess(n,r))break;this._queueSwap(r,n),n=r}}_queueDown(e,n){let r=e;for(;;){const i=2*r+1;if(i>=n||i<0)break;const o=i+1;let a=i;if(o<n&&this._queueLess(o,i)&&(a=o),!this._queueLess(a,r))break;this._queueSwap(r,a),r=a}return r>e}}function c0(t,e,n,r,i,o){return(n-i)*(e-o)-(r-o)*(t-i)}function X7e(t,e,n,r,i,o,a,s){const u=t-a,d=e-s,g=n-a,_=r-s,E=i-a,P=o-s,R=u*u+d*d,B=g*g+_*_,V=E*E+P*P;return u*(_*V-B*P)-d*(g*V-B*E)+R*(g*P-_*E)<0}function gT(t,e,n,r,i){const{rScaler:o,bScaler:a,gScaler:s,offset:u}=r,d=new Float32Array((e+1)*(n+1));for(let g=0,_=0;_<n;_++)for(let E=0;E<e;E++,g++){const P=g*4,R=t[P+0],B=t[P+1],V=t[P+2];d[g+_]=R*o+B*s+V*a+u}if(i==="martini"){for(let g=(e+1)*e,_=0;_<e;_++,g++)d[g]=d[g-e-1];for(let g=n,_=0;_<n+1;_++,g+=n+1)d[g]=d[g-1]}return d}function Z7e(t,e,n,r,i){const o=n+1,a=t.length/2,s=new Float32Array(a*3),u=new Float32Array(a*2),[d,g,_,E]=i||[0,0,n,r],P=(_-d)/n,R=(E-g)/r;for(let B=0;B<a;B++){const V=t[B*2],z=t[B*2+1],F=z*o+V;s[3*B+0]=V*P+d,s[3*B+1]=-z*R+E,s[3*B+2]=e[F],u[2*B+0]=V/n,u[2*B+1]=z/r}return{POSITION:{value:s,size:3},TEXCOORD_0:{value:u,size:2}}}function Y7e(t,e){if(t===null)return null;const{meshMaxError:n,bounds:r,elevationDecoder:i}=e,{data:o,width:a,height:s}=t;let u,d;switch(e.tesselator){case"martini":u=gT(o,a,s,i,e.tesselator),d=IX(n,a,u);break;case"delatin":u=gT(o,a,s,i,e.tesselator),d=MX(n,a,s,u);break;default:a===s&&!(s&a-1)?(u=gT(o,a,s,i,"martini"),d=IX(n,a,u)):(u=gT(o,a,s,i,"delatin"),d=MX(n,a,s,u));break}const{vertices:g}=d;let{triangles:_}=d,E=Z7e(g,u,a,s,r);const P=lU(E);if(e.skirtHeight){const{attributes:R,triangles:B}=G7e(E,_,e.skirtHeight);E=R,_=B}return{loaderData:{header:{}},header:{vertexCount:_.length,boundingBox:P},mode:4,indices:{value:Uint32Array.from(_),size:1},attributes:E}}function IX(t,e,n){const r=e+1,o=new H7e(r).createTile(n),{vertices:a,triangles:s}=o.getMesh(t);return{vertices:a,triangles:s}}function MX(t,e,n,r){const i=new q7e(r,e+1,n+1);i.run(t);const{coords:o,triangles:a}=i;return{vertices:o,triangles:a}}async function Q7e(t,e,n){const r={...e,mimeType:"application/x.image",image:{...e.image,type:"data"}},i=await n.parse(t,r);return Y7e(i,e.terrain)}const K7e="3.4.14",Yse={name:"Terrain",id:"terrain",module:"terrain",version:K7e,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:null,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:null}}};({...Yse});const OX=[1],J7e={...H1.defaultProps,elevationData:tM,texture:{...tM,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[Yse]};function RX(t){return Array.isArray(t)?t.join(";"):t||""}class EU extends Uh{constructor(...e){super(...e),q(this,"state",void 0)}updateState({props:e,oldProps:n}){const r=e.elevationData!==n.elevationData;if(r){const{elevationData:o}=e,a=o&&(Array.isArray(o)||o.includes("{x}")&&o.includes("{y}"));this.setState({isTiled:a})}const i=r||e.meshMaxError!==n.meshMaxError||e.elevationDecoder!==n.elevationDecoder||e.bounds!==n.bounds;if(!this.state.isTiled&&i){const o=this.loadTerrain(e);this.setState({terrain:o})}e.workerUrl&&Or.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:n,elevationDecoder:r,meshMaxError:i,signal:o}){var a;if(!e)return null;let s=this.getLoadOptions();s={...s,terrain:{skirtHeight:this.state.isTiled?i*2:0,...(a=s)===null||a===void 0?void 0:a.terrain,bounds:n,meshMaxError:i,elevationDecoder:r}};const{fetch:u}=this.props;return u(e,{propName:"elevationData",layer:this,loadOptions:s,signal:o})}getTiledTerrainData(e){const{elevationData:n,fetch:r,texture:i,elevationDecoder:o,meshMaxError:a}=this.props,{viewport:s}=this.context,u=fE(n,e),d=i&&fE(i,e),{signal:g}=e;let _=[0,0],E=[0,0];if(s.isGeospatial){const V=e.bbox;_=s.projectFlat([V.west,V.south]),E=s.projectFlat([V.east,V.north])}else{const V=e.bbox;_=[V.left,V.bottom],E=[V.right,V.top]}const P=[_[0],_[1],E[0],E[1]],R=this.loadTerrain({elevationData:u,bounds:P,elevationDecoder:o,meshMaxError:a,signal:g}),B=d?r(d,{propName:"texture",layer:this,loaders:[],signal:g}).catch(V=>null):Promise.resolve(null);return Promise.all([R,B])}renderSubLayers(e){const n=this.getSubLayerClass("mesh",_1),{color:r,wireframe:i,material:o}=this.props,{data:a}=e;if(!a)return null;const[s,u]=a;return new n(e,{data:OX,mesh:s,texture:u,_instanced:!1,coordinateSystem:Br.CARTESIAN,getPosition:d=>[0,0,0],getColor:r,wireframe:i,material:o})}onViewportLoad(e){if(!e)return;const{zRange:n}=this.state,r=e.map(a=>a.content).filter(Boolean).map(a=>a[0].header.boundingBox.map(u=>u[2]));if(r.length===0)return;const i=Math.min(...r.map(a=>a[0])),o=Math.max(...r.map(a=>a[1]));(!n||i<n[0]||o>n[1])&&this.setState({zRange:[i,o]})}renderLayers(){const{color:e,material:n,elevationData:r,texture:i,wireframe:o,meshMaxError:a,elevationDecoder:s,tileSize:u,maxZoom:d,minZoom:g,extent:_,maxRequests:E,onTileLoad:P,onTileUnload:R,onTileError:B,maxCacheSize:V,maxCacheByteSize:z,refinementStrategy:F}=this.props;if(this.state.isTiled)return new H1(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:RX(r),texture:RX(i),meshMaxError:a,elevationDecoder:s}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:u,maxZoom:d,minZoom:g,extent:_,maxRequests:E,onTileLoad:P,onTileUnload:R,onTileError:B,maxCacheSize:V,maxCacheByteSize:z,refinementStrategy:F});const k=this.getSubLayerClass("mesh",_1);return new k(this.getSubLayerProps({id:"mesh"}),{data:OX,mesh:this.state.terrain,texture:i,_instanced:!1,getPosition:X=>[0,0,0],getColor:e,material:n,wireframe:o})}}q(EU,"defaultProps",J7e);q(EU,"layerName","TerrainLayer");const eWe={clipBounds:[0,0,1,1],clipByInstance:void 0},Qse=`
uniform vec4 clip_bounds;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,tWe={name:"clip-vs",vs:Qse},nWe={"vs:#decl":`
varying float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
varying float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},rWe={name:"clip-fs",fs:Qse},iWe={"vs:#decl":`
varying vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
varying vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class SU extends WO{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[tWe],inject:nWe}:{modules:[rWe],inject:iWe}}draw({uniforms:e}){const{clipBounds:n}=this.props;if(this.state.clipByInstance)e.clip_bounds=n;else{const r=this.projectPosition([n[0],n[1],0]),i=this.projectPosition([n[2],n[3],0]);e.clip_bounds=[Math.min(r[0],i[0]),Math.min(r[1],i[1]),Math.max(r[0],i[0]),Math.max(r[1],i[1])]}}}q(SU,"defaultProps",eWe);q(SU,"extensionName","ClipExtension");function oWe(t,e,n){const r=sWe(t),i=Object.keys(r).filter(o=>r[o]!==Array);return aWe(t,{propArrayTypes:r,...e},{numericPropKeys:n&&n.numericPropKeys||i,PositionDataType:n?n.PositionDataType:Float32Array,triangulate:n?n.triangulate:!0})}function sWe(t){const e={};for(const n of t)if(n.properties)for(const r in n.properties){const i=n.properties[r];e[r]=dWe(i,e[r])}return e}function aWe(t,e,n){const{pointPositionsCount:r,pointFeaturesCount:i,linePositionsCount:o,linePathsCount:a,lineFeaturesCount:s,polygonPositionsCount:u,polygonObjectsCount:d,polygonRingsCount:g,polygonFeaturesCount:_,propArrayTypes:E,coordLength:P}=e,{numericPropKeys:R=[],PositionDataType:B=Float32Array,triangulate:V=!0}=n,z=t[0]&&"id"in t[0],F=t.length>65535?Uint32Array:Uint16Array,k={type:"Point",positions:new B(r*P),globalFeatureIds:new F(r),featureIds:i>65535?new Uint32Array(r):new Uint16Array(r),numericProps:{},properties:[],fields:[]},X={type:"LineString",pathIndices:o>65535?new Uint32Array(a+1):new Uint16Array(a+1),positions:new B(o*P),globalFeatureIds:new F(o),featureIds:s>65535?new Uint32Array(o):new Uint16Array(o),numericProps:{},properties:[],fields:[]},Y={type:"Polygon",polygonIndices:u>65535?new Uint32Array(d+1):new Uint16Array(d+1),primitivePolygonIndices:u>65535?new Uint32Array(g+1):new Uint16Array(g+1),positions:new B(u*P),globalFeatureIds:new F(u),featureIds:_>65535?new Uint32Array(u):new Uint16Array(u),numericProps:{},properties:[],fields:[]};V&&(Y.triangles=[]);for(const ie of[k,X,Y])for(const ce of R){const re=E[ce];ie.numericProps[ce]=new re(ie.positions.length/P)}X.pathIndices[a]=o,Y.polygonIndices[d]=u,Y.primitivePolygonIndices[g]=u;const J={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const ie of t){const ce=ie.geometry,re=ie.properties||{};switch(ce.type){case"Point":lWe(ce,k,J,P,re),k.properties.push(YB(re,R)),z&&k.fields.push({id:ie.id}),J.pointFeature++;break;case"LineString":uWe(ce,X,J,P,re),X.properties.push(YB(re,R)),z&&X.fields.push({id:ie.id}),J.lineFeature++;break;case"Polygon":cWe(ce,Y,J,P,re),Y.properties.push(YB(re,R)),z&&Y.fields.push({id:ie.id}),J.polygonFeature++;break;default:throw new Error("Invalid geometry type")}J.feature++}return hWe(k,X,Y,P)}function lWe(t,e,n,r,i){e.positions.set(t.data,n.pointPosition*r);const o=t.data.length/r;TU(e,i,n.pointPosition,o),e.globalFeatureIds.fill(n.feature,n.pointPosition,n.pointPosition+o),e.featureIds.fill(n.pointFeature,n.pointPosition,n.pointPosition+o),n.pointPosition+=o}function uWe(t,e,n,r,i){e.positions.set(t.data,n.linePosition*r);const o=t.data.length/r;TU(e,i,n.linePosition,o),e.globalFeatureIds.fill(n.feature,n.linePosition,n.linePosition+o),e.featureIds.fill(n.lineFeature,n.linePosition,n.linePosition+o);for(let a=0,s=t.indices.length;a<s;++a){const u=t.indices[a],d=a===s-1?t.data.length:t.indices[a+1];e.pathIndices[n.linePath++]=n.linePosition,n.linePosition+=(d-u)/r}}function cWe(t,e,n,r,i){e.positions.set(t.data,n.polygonPosition*r);const o=t.data.length/r;TU(e,i,n.polygonPosition,o),e.globalFeatureIds.fill(n.feature,n.polygonPosition,n.polygonPosition+o),e.featureIds.fill(n.polygonFeature,n.polygonPosition,n.polygonPosition+o);for(let a=0,s=t.indices.length;a<s;++a){const u=n.polygonPosition;e.polygonIndices[n.polygonObject++]=u;const d=t.areas[a],g=t.indices[a],_=t.indices[a+1];for(let P=0,R=g.length;P<R;++P){const B=g[P],V=P===R-1?_===void 0?t.data.length:_[0]:g[P+1];e.primitivePolygonIndices[n.polygonRing++]=n.polygonPosition,n.polygonPosition+=(V-B)/r}const E=n.polygonPosition;fWe(e,d,g,{startPosition:u,endPosition:E,coordLength:r})}}function fWe(t,e,n,r){let{startPosition:i,endPosition:o,coordLength:a}=r;if(!t.triangles)return;const s=i*a,u=o*a,d=t.positions.subarray(s,u),g=n[0],_=n.slice(1).map(P=>(P-g)/a),E=Z4e(d,_,a,e);for(let P=0,R=E.length;P<R;++P)t.triangles.push(i+E[P])}function ZB(t,e){const n={};for(const r in t)n[r]={value:t[r],size:e};return n}function hWe(t,e,n,r){const i={points:{...t,positions:{value:t.positions,size:r},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:ZB(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:r},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:ZB(e.numericProps,1)},polygons:{...n,positions:{value:n.positions,size:r},polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:ZB(n.numericProps,1)}};return n.triangles&&(i.polygons.triangles={value:new Uint32Array(n.triangles),size:1}),i}function TU(t,e,n,r){for(const i in t.numericProps)if(i in e){const o=e[i];t.numericProps[i].fill(o,n,n+r)}}function YB(t,e){const n={};for(const r in t)e.includes(r)||(n[r]=t[r]);return n}function dWe(t,e){return e===Array||!Number.isFinite(t)?Array:e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}function LX(t,e){const n=e==null?void 0:e.globalFeatureId;return n!==void 0?pWe(t,n):gWe(t,e==null?void 0:e.type)}function pWe(t,e){const n=Kse(t);for(const r of n){let i=0,o=r.featureIds.value[0];for(let a=0;a<r.featureIds.value.length;a++){const s=r.featureIds.value[a];if(s!==o){if(e===r.globalFeatureIds.value[i])return sM(r,i,a);i=a,o=s}}if(e===r.globalFeatureIds.value[i])return sM(r,i,r.featureIds.value.length)}throw new Error("featureId:".concat(e," not found"))}function gWe(t,e){const n=Kse(t,e);return AWe(n)}function mWe(t,e,n){switch(t.type){case"Point":return xWe(t,e,n);case"LineString":return vWe(t,e,n);case"Polygon":return Jse(t,e,n);default:const r=t;throw new Error("Unsupported geometry type: ".concat(r==null?void 0:r.type))}}function Kse(t,e){if(!!!(t.points||t.lines||t.polygons))return t.type=e||bWe(t),[t];const r=[];return t.points&&(t.points.type="Point",r.push(t.points)),t.lines&&(t.lines.type="LineString",r.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",r.push(t.polygons)),r}function AWe(t){const e=[];for(const n of t){if(n.featureIds.value.length===0)continue;let r=0,i=n.featureIds.value[0];for(let o=0;o<n.featureIds.value.length;o++){const a=n.featureIds.value[o];a!==i&&(e.push(sM(n,r,o)),r=o,i=a)}e.push(sM(n,r,n.featureIds.value.length))}return e}function sM(t,e,n){const r=mWe(t,e,n),i=yWe(t,e,n),o=_We(t,e,n);return{type:"Feature",geometry:r,properties:i,...o}}function _We(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return t.fields&&t.fields[t.featureIds.value[e]]}function yWe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=Object.assign({},t.properties[t.featureIds.value[e]]);for(const r in t.numericProps)n[r]=t.numericProps[r].value[e];return n}function Jse(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1/0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0;const{positions:r}=t,i=t.polygonIndices.value.filter(u=>u>=e&&u<=n),o=t.primitivePolygonIndices.value.filter(u=>u>=e&&u<=n);if(!(i.length>2)){const u=[];for(let d=0;d<o.length-1;d++){const g=o[d],_=o[d+1],E=aM(r,g,_);u.push(E)}return{type:"Polygon",coordinates:u}}const s=[];for(let u=0;u<i.length-1;u++){const d=i[u],g=i[u+1],_=Jse(t,d,g).coordinates;s.push(_)}return{type:"MultiPolygon",coordinates:s}}function vWe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1/0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0;const{positions:r}=t,i=t.pathIndices.value.filter(s=>s>=e&&s<=n);if(!(i.length>2))return{type:"LineString",coordinates:aM(r,i[0],i[1])};const a=[];for(let s=0;s<i.length-1;s++){const u=aM(r,i[s],i[s+1]);a.push(u)}return{type:"MultiLineString",coordinates:a}}function xWe(t,e,n){const{positions:r}=t,i=aM(r,e,n);return i.length>1?{type:"MultiPoint",coordinates:i}:{type:"Point",coordinates:i[0]}}function aM(t,e,n){e=e||0,n=n||t.value.length/t.size;const r=[];for(let i=e;i<n;i++){const o=Array();for(let a=i*t.size;a<(i+1)*t.size;a++)o.push(Number(t.value[a]));r.push(o)}return r}function bWe(t){return t.pathIndices?"LineString":t.polygonIndices?"Polygon":"Point"}var CU={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */CU.read=function(t,e,n,r,i){var o,a,s=i*8-r-1,u=(1<<s)-1,d=u>>1,g=-7,_=n?i-1:0,E=n?-1:1,P=t[e+_];for(_+=E,o=P&(1<<-g)-1,P>>=-g,g+=s;g>0;o=o*256+t[e+_],_+=E,g-=8);for(a=o&(1<<-g)-1,o>>=-g,g+=r;g>0;a=a*256+t[e+_],_+=E,g-=8);if(o===0)o=1-d;else{if(o===u)return a?NaN:(P?-1:1)*(1/0);a=a+Math.pow(2,r),o=o-d}return(P?-1:1)*a*Math.pow(2,o-r)};CU.write=function(t,e,n,r,i,o){var a,s,u,d=o*8-i-1,g=(1<<d)-1,_=g>>1,E=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=r?0:o-1,R=r?1:-1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=g):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),a+_>=1?e+=E/u:e+=E*Math.pow(2,1-_),e*u>=2&&(a++,u/=2),a+_>=g?(s=0,a=g):a+_>=1?(s=(e*u-1)*Math.pow(2,i),a=a+_):(s=e*Math.pow(2,_-1)*Math.pow(2,i),a=0));i>=8;t[n+P]=s&255,P+=R,s/=256,i-=8);for(a=a<<i|s,d+=i;d>0;t[n+P]=a&255,P+=R,a/=256,d-=8);t[n+P-R]|=B*128};var wWe=zi,mT=CU;function zi(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}zi.Varint=0;zi.Fixed64=1;zi.Bytes=2;zi.Fixed32=5;var D4=65536*65536,DX=1/D4,EWe=12,eae=typeof TextDecoder>"u"?null:new TextDecoder("utf8");zi.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=r&7,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=AT(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=NX(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=AT(this.buf,this.pos)+AT(this.buf,this.pos+4)*D4;return this.pos+=8,t},readSFixed64:function(){var t=AT(this.buf,this.pos)+NX(this.buf,this.pos+4)*D4;return this.pos+=8,t},readFloat:function(){var t=mT.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=mT.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,n,r;return r=e[this.pos++],n=r&127,r<128||(r=e[this.pos++],n|=(r&127)<<7,r<128)||(r=e[this.pos++],n|=(r&127)<<14,r<128)||(r=e[this.pos++],n|=(r&127)<<21,r<128)?n:(r=e[this.pos],n|=(r&15)<<28,SWe(n,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=EWe&&eae?zWe(this.buf,e,t):kWe(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==zi.Bytes)return t.push(this.readVarint(e));var n=Up(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==zi.Bytes)return t.push(this.readSVarint());var e=Up(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==zi.Bytes)return t.push(this.readBoolean());var e=Up(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==zi.Bytes)return t.push(this.readFloat());var e=Up(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==zi.Bytes)return t.push(this.readDouble());var e=Up(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==zi.Bytes)return t.push(this.readFixed32());var e=Up(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==zi.Bytes)return t.push(this.readSFixed32());var e=Up(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==zi.Bytes)return t.push(this.readFixed64());var e=Up(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==zi.Bytes)return t.push(this.readSFixed64());var e=Up(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===zi.Varint)for(;this.buf[this.pos++]>127;);else if(e===zi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===zi.Fixed32)this.pos+=4;else if(e===zi.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),My(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),My(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),My(this.buf,t&-1,this.pos),My(this.buf,Math.floor(t*DX),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),My(this.buf,t&-1,this.pos),My(this.buf,Math.floor(t*DX),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){TWe(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=UWe(this.buf,t,this.pos);var n=this.pos-e;n>=128&&BX(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),mT.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),mT.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&BX(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,zi.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,IWe,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,MWe,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,LWe,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,OWe,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,RWe,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,DWe,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,BWe,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,NWe,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,FWe,e)},writeBytesField:function(t,e){this.writeTag(t,zi.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,zi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,zi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,zi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,zi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,zi.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,zi.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,zi.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,zi.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,zi.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function SWe(t,e,n){var r=n.buf,i,o;if(o=r[n.pos++],i=(o&112)>>4,o<128||(o=r[n.pos++],i|=(o&127)<<3,o<128)||(o=r[n.pos++],i|=(o&127)<<10,o<128)||(o=r[n.pos++],i|=(o&127)<<17,o<128)||(o=r[n.pos++],i|=(o&127)<<24,o<128)||(o=r[n.pos++],i|=(o&1)<<31,o<128))return Iy(t,i,e);throw new Error("Expected varint not more than 10 bytes")}function Up(t){return t.type===zi.Bytes?t.readVarint()+t.pos:t.pos+1}function Iy(t,e,n){return n?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function TWe(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(n=~(-t%4294967296),r=~(-t/4294967296),n^4294967295?n=n+1|0:(n=0,r=r+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),CWe(n,r,e),PWe(r,e)}function CWe(t,e,n){n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos]=t&127}function PWe(t,e){var n=(t&7)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function BX(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function IWe(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function MWe(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function OWe(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function RWe(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function LWe(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function DWe(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function BWe(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function NWe(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function FWe(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function AT(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function My(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function NX(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function kWe(t,e,n){for(var r="",i=e;i<n;){var o=t[i],a=null,s=o>239?4:o>223?3:o>191?2:1;if(i+s>n)break;var u,d,g;s===1?o<128&&(a=o):s===2?(u=t[i+1],(u&192)===128&&(a=(o&31)<<6|u&63,a<=127&&(a=null))):s===3?(u=t[i+1],d=t[i+2],(u&192)===128&&(d&192)===128&&(a=(o&15)<<12|(u&63)<<6|d&63,(a<=2047||a>=55296&&a<=57343)&&(a=null))):s===4&&(u=t[i+1],d=t[i+2],g=t[i+3],(u&192)===128&&(d&192)===128&&(g&192)===128&&(a=(o&15)<<18|(u&63)<<12|(d&63)<<6|g&63,(a<=65535||a>=1114112)&&(a=null))),a===null?(a=65533,s=1):a>65535&&(a-=65536,r+=String.fromCharCode(a>>>10&1023|55296),a=56320|a&1023),r+=String.fromCharCode(a),i+=s}return r}function zWe(t,e,n){return eae.decode(t.subarray(e,n))}function UWe(t,e,n){for(var r=0,i,o;r<e.length;r++){if(i=e.charCodeAt(r),i>55295&&i<57344)if(o)if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,o=i;continue}else i=o-55296<<10|i-56320|65536,o=null;else{i>56319||r+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):o=i;continue}else o&&(t[n++]=239,t[n++]=191,t[n++]=189,o=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=i&63|128)}return n}const tae=mA(wWe);function GWe(t){const e=t.length;if(e<=1)return[t];const n=[];let r,i;for(let o=0;o<e;o++){const a=jWe(t[o]);a!==0&&(i===void 0&&(i=a<0),i===a<0?(r&&n.push(r),r=[t[o]]):r&&r.push(t[o]))}return r&&n.push(r),n}function jWe(t){let e=0;for(let n=0,r=t.length-1,i,o;n<t.length;r=n++)i=t[n],o=t[r],e+=(o[0]-i[0])*(i[1]+o[1]);return e}function VWe(t,e,n){e&&n&&(t===1?e.id=n.readVarint():t===2?$We(n,e):t===3?e.type=n.readVarint():t===4&&(e._geometry=n.pos))}function $We(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}let HWe=class nae{static get types(){return["Unknown","Point","LineString","Polygon"]}constructor(e,n,r,i,o){q(this,"properties",void 0),q(this,"extent",void 0),q(this,"type",void 0),q(this,"id",void 0),q(this,"_pbf",void 0),q(this,"_geometry",void 0),q(this,"_keys",void 0),q(this,"_values",void 0),this.properties={},this.extent=r,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=i,this._values=o,e.readFields(VWe,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let r=1,i=0,o=0,a=0;const s=[];let u;for(;e.pos<n;){if(i<=0){const d=e.readVarint();r=d&7,i=d>>3}if(i--,r===1||r===2)o+=e.readSVarint(),a+=e.readSVarint(),r===1&&(u&&s.push(u),u=[]),u&&u.push([o,a]);else if(r===7)u&&u.push(u[0].slice());else throw new Error("unknown command ".concat(r))}return u&&s.push(u),s}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let r=1,i=0,o=0,a=0,s=1/0,u=-1/0,d=1/0,g=-1/0;for(;e.pos<n;){if(i<=0){const _=e.readVarint();r=_&7,i=_>>3}if(i--,r===1||r===2)o+=e.readSVarint(),a+=e.readSVarint(),o<s&&(s=o),o>u&&(u=o),a<d&&(d=a),a>g&&(g=a);else if(r!==7)throw new Error("unknown command ".concat(r))}return[s,d,u,g]}_toGeoJSON(e){let n=this.loadGeometry(),r=nae.types[this.type],i,o;switch(this.type){case 1:const s=[];for(i=0;i<n.length;i++)s[i]=n[i][0];n=s,e(n,this);break;case 2:for(i=0;i<n.length;i++)e(n[i],this);break;case 3:for(n=GWe(n),i=0;i<n.length;i++)for(o=0;o<n[i].length;o++)e(n[i][o],this);break}n.length===1?n=n[0]:r="Multi".concat(r);const a={type:"Feature",geometry:{type:r,coordinates:n},properties:this.properties};return this.id!==null&&(a.id=this.id),a}toGeoJSON(e){if(typeof e=="function")return this._toGeoJSON(e);const{x:n,y:r,z:i}=e,o=this.extent*Math.pow(2,i),a=this.extent*n,s=this.extent*r;function u(d){for(let g=0;g<d.length;g++){const _=d[g];_[0]=(_[0]+a)*360/o-180;const E=180-(_[1]+s)*360/o;_[1]=360/Math.PI*Math.atan(Math.exp(E*Math.PI/180))-90}}return this._toGeoJSON(u)}},WWe=class{constructor(e,n){q(this,"version",void 0),q(this,"name",void 0),q(this,"extent",void 0),q(this,"length",void 0),q(this,"_pbf",void 0),q(this,"_keys",void 0),q(this,"_values",void 0),q(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(qWe,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new HWe(this._pbf,n,this.extent,this._keys,this._values)}};function qWe(t,e,n){e&&n&&(t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(XWe(n)))}function XWe(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const r=t.readVarint()>>3;e=r===1?t.readString():r===2?t.readFloat():r===3?t.readDouble():r===4?t.readVarint64():r===5?t.readVarint():r===6?t.readSVarint():r===7?t.readBoolean():null}return e}let ZWe=class{constructor(e,n){q(this,"layers",void 0),this.layers=e.readFields(YWe,{},n)}};function YWe(t,e,n){if(t===3&&n){const r=new WWe(n,n.readVarint()+n.pos);r.length&&e&&(e[r.name]=r)}}function QWe(t){const e=t.indices.length,n="Polygon";if(e<=1)return{type:n,data:t.data,areas:[[QI(t.data)]],indices:[t.indices]};const r=[],i=[];let o=[],a=[],s,u=0;for(let d,g=0,_;g<e;g++){_=t.indices[g]-u,d=t.indices[g+1]-u||t.data.length;const E=t.data.slice(_,d),P=QI(E);if(P===0){const R=t.data.slice(0,_),B=t.data.slice(d);t.data=R.concat(B),u+=d-_;continue}s===void 0&&(s=P<0),s===P<0?(a.length&&(r.push(o),i.push(a)),a=[_],o=[P]):(o.push(P),a.push(_))}return o&&r.push(o),a.length&&i.push(a),{type:n,areas:r,indices:i,data:t.data}}function KWe(t,e,n,r){for(let i=0,o=t.length;i<o;i+=2){t[i]=(t[i]+e)*360/r-180;const a=180-(t[i+1]+n)*360/r;t[i+1]=360/Math.PI*Math.atan(Math.exp(a*Math.PI/180))-90}}function JWe(t,e,n){e&&n&&(t===1?e.id=n.readVarint():t===2?eqe(n,e):t===3?e.type=n.readVarint():t===4&&(e._geometry=n.pos))}function eqe(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}let FX,f0,QB,_T,KB,JB,Mb;class tqe{constructor(e,n,r,i,o,a){q(this,"properties",void 0),q(this,"extent",void 0),q(this,"type",void 0),q(this,"id",void 0),q(this,"_pbf",void 0),q(this,"_geometry",void 0),q(this,"_keys",void 0),q(this,"_values",void 0),q(this,"_geometryInfo",void 0),this.properties={},this.extent=r,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=i,this._values=o,this._geometryInfo=a,e.readFields(JWe,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry,FX=e.readVarint()+e.pos,f0=1,_T=0,KB=0,JB=0,Mb=0;const n=[],r=[];for(;e.pos<FX;)if(_T<=0&&(QB=e.readVarint(),f0=QB&7,_T=QB>>3),_T--,f0===1||f0===2)KB+=e.readSVarint(),JB+=e.readSVarint(),f0===1&&n.push(Mb),r.push(KB,JB),Mb+=2;else if(f0===7){if(Mb>0){const i=n[n.length-1];r.push(r[i],r[i+1]),Mb+=2}}else throw new Error("unknown command ".concat(f0));return{data:r,indices:n}}_toBinaryCoordinates(e){const n=this.loadGeometry();let r;e(n.data,this);const i=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=n.indices.length,r={type:"Point",...n};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=n.indices.length,this._geometryInfo.linePositionsCount+=n.data.length/i,r={type:"LineString",...n};break;case 3:r=QWe(n),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=r.indices.length;for(const a of r.indices)this._geometryInfo.polygonRingsCount+=a.length;this._geometryInfo.polygonPositionsCount+=r.data.length/i;break;default:throw new Error("Invalid geometry type: ".concat(this.type))}const o={type:"Feature",geometry:r,properties:this.properties};return this.id!==null&&(o.id=this.id),o}toBinaryCoordinates(e){if(typeof e=="function")return this._toBinaryCoordinates(e);const{x:n,y:r,z:i}=e,o=this.extent*Math.pow(2,i),a=this.extent*n,s=this.extent*r;return this._toBinaryCoordinates(u=>KWe(u,a,s,o))}}class nqe{constructor(e,n){q(this,"version",void 0),q(this,"name",void 0),q(this,"extent",void 0),q(this,"length",void 0),q(this,"_pbf",void 0),q(this,"_keys",void 0),q(this,"_values",void 0),q(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(rqe,this,n),this.length=this._features.length}feature(e,n){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new tqe(this._pbf,r,this.extent,this._keys,this._values,n)}}function rqe(t,e,n){e&&n&&(t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(iqe(n)))}function iqe(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const r=t.readVarint()>>3;e=r===1?t.readString():r===2?t.readFloat():r===3?t.readDouble():r===4?t.readVarint64():r===5?t.readVarint():r===6?t.readSVarint():r===7?t.readBoolean():null}return e}class oqe{constructor(e,n){q(this,"layers",void 0),this.layers=e.readFields(sqe,{},n)}}function sqe(t,e,n){if(t===3&&n){const r=new nqe(n,n.readVarint()+n.pos);r.length&&e&&(e[r.name]=r)}}function kX(t,e){var n,r;const i=lqe(e),o=(e==null||(n=e.gis)===null||n===void 0?void 0:n.format)||(e==null||(r=e.mvt)===null||r===void 0?void 0:r.shape);switch(o){case"columnar-table":return{shape:"columnar-table",data:eN(t,i)};case"geojson-row-table":return{shape:"geojson-row-table",data:zX(t,i)};case"geojson":return zX(t,i);case"binary-geometry":return eN(t,i);case"binary":return eN(t,i);default:throw new Error(o)}}function eN(t,e){const[n,r]=aqe(t,e),i=oWe(n,r);return i.byteLength=t.byteLength,i}function aqe(t,e){const n=[],r={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[n,r];const i=new oqe(new tae(t));return(e&&Array.isArray(e.layers)?e.layers:Object.keys(i.layers)).forEach(a=>{const s=i.layers[a];if(s)for(let u=0;u<s.length;u++){const d=s.feature(u,r),g=cqe(d,e,a);n.push(g)}}),[n,r]}function zX(t,e){if(t.byteLength<=0)return[];const n=[],r=new ZWe(new tae(t));return(Array.isArray(e.layers)?e.layers:Object.keys(r.layers)).forEach(o=>{const a=r.layers[o];if(a)for(let s=0;s<a.length;s++){const u=a.feature(s),d=uqe(u,e,o);n.push(d)}}),n}function lqe(t){var e;if(!(t!=null&&t.mvt))throw new Error("mvt options required");const n=((e=t.mvt)===null||e===void 0?void 0:e.coordinates)==="wgs84",{tileIndex:r}=t.mvt,i=r&&Number.isFinite(r.x)&&Number.isFinite(r.y)&&Number.isFinite(r.z);if(n&&!i)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return t.mvt}function uqe(t,e,n){const r=t.toGeoJSON(e.coordinates==="wgs84"?e.tileIndex:fqe);return e.layerProperty&&(r.properties[e.layerProperty]=n),r}function cqe(t,e,n){const r=t.toBinaryCoordinates(e.coordinates==="wgs84"?e.tileIndex:hqe);return e.layerProperty&&r.properties&&(r.properties[e.layerProperty]=n),r}function fqe(t,e){const{extent:n}=e;for(let r=0;r<t.length;r++){const i=t[r];i[0]/=n,i[1]/=n}}function hqe(t,e){const{extent:n}=e;for(let r=0,i=t.length;r<i;++r)t[r]/=n}const dqe="3.4.14",pqe={mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}},rae={name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:dqe,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:pqe};({...rae});const gqe={Point:iae,MultiPoint:mqe,LineString:oae,MultiLineString:Aqe,Polygon:sae,MultiPolygon:_qe};function iae([t,e],[n,r],i){const o=pc(n[0],r[0],t),a=pc(n[1],r[1],e);return i.unprojectFlat([o,a])}function PU(t,e,n){return t.map(r=>iae(r,e,n))}function mqe(t,e,n){return PU(t,e,n)}function oae(t,e,n){return PU(t,e,n)}function Aqe(t,e,n){return t.map(r=>oae(r,e,n))}function sae(t,e,n){return t.map(r=>PU(r,e,n))}function _qe(t,e,n){return t.map(r=>sae(r,e,n))}function yqe(t,e,n){const r=n.projectFlat([e.west,e.north]),i=n.projectFlat([e.east,e.south]),o=[r,i];return{...t,coordinates:gqe[t.type](t.coordinates,o,n)}}const vqe=["points","lines","polygons"];function xqe(t,e,n,r){for(const i of vqe){const o=t[i]&&bqe(t[i],e,n,r);if(o>=0)return o}return-1}function bqe(t,e,n,r){const i=t.featureIds.value;if(!i.length)return-1;let o=0,a=i[i.length-1]+1;if(r){const u=wqe(t,r);if(u)o=u[0],a=u[1]+1;else return-1}let s=-1;if(e in t.numericProps){const u=t.numericProps[e].value.findIndex((d,g)=>d===n&&i[g]>=o&&i[g]<a);return u>=0?t.globalFeatureIds.value[u]:-1}else e?s=UX(t.properties,u=>u[e]===n,o,a):t.fields&&(s=UX(t.fields,u=>u.id===n,o,a));return s>=0?Eqe(t,s):-1}function wqe(t,e){if(!t.__layers){const n={},{properties:r}=t;for(let i=0;i<r.length;i++){const{layerName:o}=r[i];o&&(n[o]?n[o][1]=i:n[o]=[i,i])}t.__layers=n}return t.__layers[e]}function Eqe(t,e){if(!t.__ids){const n=[],r=t.featureIds.value,i=t.globalFeatureIds.value;for(let o=0;o<r.length;o++)n[r[o]]=i[o];t.__ids=n}return t.__ids[e]}function UX(t,e,n,r){for(let i=n;i<r;i++)if(e(t[i],i))return i;return-1}const tN=512,Sqe={...$1.defaultProps,data:tM,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[rae],binary:!0};class IU extends H1{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null})}get isLoaded(){return this.state&&this.state.data&&this.state.tileset&&super.isLoaded}updateState({props:e,oldProps:n,context:r,changeFlags:i}){var o;i.dataChanged&&this._updateTileData(),(o=this.state)!==null&&o!==void 0&&o.data&&(super.updateState({props:e,oldProps:n,context:r,changeFlags:i}),this._setWGS84PropertyForTiles());const{highlightColor:a}=e;a!==n.highlightColor&&Array.isArray(a)&&this.setState({highlightColor:a})}async _updateTileData(){let e=this.props.data,n=null;if(typeof e=="string"&&!j8e(e)){const{onDataLoad:r,fetch:i}=this.props;this.setState({data:null,tileJSON:null});try{n=await i(e,{propName:"data",layer:this,loaders:[]})}catch(o){this.raiseError(o,"loading TileJSON"),e=null}r&&r(n,{propName:"data",layer:this})}else e.tilejson&&(n=e);n&&(e=n.tiles),this.setState({data:e,tileJSON:n})}_getTilesetOptions(){const e=super._getTilesetOptions(),n=this.state.tileJSON,{minZoom:r,maxZoom:i}=this.props;return n&&(Number.isFinite(n.minzoom)&&n.minzoom>r&&(e.minZoom=n.minzoom),Number.isFinite(n.maxzoom)&&(!Number.isFinite(i)||n.maxzoom<i)&&(e.maxZoom=n.maxzoom)),e}renderLayers(){var e;return(e=this.state)!==null&&e!==void 0&&e.data?super.renderLayers():null}getTileData(e){var n;const{data:r,binary:i}=this.state,{index:o,signal:a}=e,s=fE(r,e);if(!s)return Promise.reject("Invalid URL");let u=this.getLoadOptions();const{fetch:d}=this.props;return u={...u,mimeType:"application/x-protobuf",mvt:{...(n=u)===null||n===void 0?void 0:n.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:o},gis:i?{format:"binary"}:{}},d(s,{propName:"data",layer:this,loadOptions:u,signal:a})}renderSubLayers(e){const{x:n,y:r,z:i}=e.tile.index,o=Math.pow(2,i),a=tN/o,s=-a,u=tN*n/o,d=tN*(1-r/o),g=new vr().scale([a,s,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=g,e.coordinateOrigin=[u,d,0],e.coordinateSystem=Br.CARTESIAN,e.extensions=[...e.extensions||[],new SU]);const _=super.renderSubLayers(e);return this.state.binary&&!(_ instanceof $1)&&Or.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),_}_updateAutoHighlight(e){const{uniqueIdProperty:n}=this.props,{hoveredFeatureId:r,hoveredFeatureLayerName:i}=this.state,o=e.object;let a,s;o&&(a=nN(o,n),s=GX(o));let{highlightColor:u}=this.props;typeof u=="function"&&(u=u(e)),(r!==a||i!==s)&&this.setState({highlightColor:u,hoveredFeatureId:a,hoveredFeatureLayerName:s})}getPickingInfo(e){const n=super.getPickingInfo(e),r=!!this.context.viewport.resolution;if(this.state.binary&&n.index!==-1){const{data:i}=e.sourceLayer.props;n.object=LX(i,{globalFeatureId:n.index})}return n.object&&!r&&(n.object=VX(n.object,n.tile.bbox,this.context.viewport)),n}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:n,hoveredFeatureLayerName:r,binary:i}=this.state,{uniqueIdProperty:o,highlightedFeatureId:a}=this.props,s=e.content,u=jX(a);if(!(jX(n)||u))return-1;const g=u?a:n;return Array.isArray(s)?s.findIndex(_=>{const E=nN(_,o)===g,P=u||GX(_)===r;return E&&P}):s&&i?xqe(s,o,g,u?"":r):-1}_pickObjects(e){const{deck:n,viewport:r}=this.context,i=r.width,o=r.height,a=r.x,s=r.y,u=[this.id];return n.pickObjects({x:a,y:s,width:i,height:o,layerIds:u,maxObjects:e})}getRenderedFeatures(e=null){const n=this._pickObjects(e),r=new Set,i=[];for(const o of n){const a=nN(o.object,this.props.uniqueIdProperty);a===void 0?i.push(o.object):r.has(a)||(r.add(a),i.push(o.object))}return i}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(r=>{r.hasOwnProperty(e)||Object.defineProperty(r,e,{get:()=>{if(!r.content)return null;if(this.state.binary&&Array.isArray(r.content)&&!r.content.length)return[];const{bbox:i}=r;if(r._contentWGS84===void 0&&V8e(i)){const o=this.state.binary?LX(r.content):r.content;r._contentWGS84=o.map(a=>VX(a,i,this.context.viewport))}return r._contentWGS84}})})}}q(IU,"layerName","MVTLayer");q(IU,"defaultProps",Sqe);function nN(t,e){if(t.properties&&e)return t.properties[e];if("id"in t)return t.id}function GX(t){var e;return((e=t.properties)===null||e===void 0?void 0:e.layerName)||null}function jX(t){return t!=null&&t!==""}function VX(t,e,n){const r={...t,geometry:{type:t.geometry.type}};return Object.defineProperty(r.geometry,"coordinates",{get:()=>yqe(t.geometry,e,n).coordinates}),r}const $X="0123456789bcdefghjkmnpqrstuvwxyz",aae={};for(let t=0;t<$X.length;t++)aae[$X.charAt(t)]=t;const Tqe=-90,Cqe=90,Pqe=-180,Iqe=180;function Mqe(t){let e=!0,n=Cqe,r=Tqe,i=Iqe,o=Pqe,a,s=0;for(let u=0,d=t.length;u<d;u++){const g=t[u].toLowerCase();s=aae[g];for(let _=4;_>=0;_--){const E=s>>_&1;e?(a=(i+o)/2,E===1?o=a:i=a):(a=(n+r)/2,E===1?r=a:n=a),e=!e}}return[r,o,n,i]}function Oqe(t){const[e,n,r,i]=Mqe(t);return[i,r,i,e,n,e,n,r,i,r]}const Rqe={getGeohash:{type:"accessor",value:t=>t.geohash}};class MU extends v_{indexToBounds(){const{data:e,getGeohash:n}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(r,i)=>Oqe(n(r,i))}}}q(MU,"layerName","GeohashLayer");q(MU,"defaultProps",Rqe);const Lqe=Object.freeze(Object.defineProperty({__proto__:null,GeohashLayer:MU,GreatCircleLayer:Q6,H3ClusterLayer:aU,H3HexagonLayer:x_,MVTLayer:IU,QuadkeyLayer:J6,S2Layer:K6,TerrainLayer:EU,Tile3DLayer:wU,TileLayer:H1,TripsLayer:iU,_GeoCellLayer:v_,_Tile2DHeader:Ooe,_Tileset2D:Noe,_WMSLayer:Y6,_getURLFromTemplate:fE},Symbol.toStringTag,{value:"Module"})),Dqe=ti(Lqe),Bqe=ti(jGe);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=Dqe,n=Hp,r=Bqe,i=uA,o=s(GR),a=s(V6);function s(Ne){return Ne&&Ne.__esModule?Ne:{default:Ne}}function u(Ne){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?u=function(qe){return typeof qe}:u=function(qe){return qe&&typeof Symbol=="function"&&qe.constructor===Symbol&&qe!==Symbol.prototype?"symbol":typeof qe},u(Ne)}function d(Ne){return P(Ne)||E(Ne)||_(Ne)||g()}function g(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _(Ne,Be){if(Ne){if(typeof Ne=="string")return R(Ne,Be);var qe=Object.prototype.toString.call(Ne).slice(8,-1);if(qe==="Object"&&Ne.constructor&&(qe=Ne.constructor.name),qe==="Map"||qe==="Set")return Array.from(qe);if(qe==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(qe))return R(Ne,Be)}}function E(Ne){if(typeof Symbol<"u"&&Symbol.iterator in Object(Ne))return Array.from(Ne)}function P(Ne){if(Array.isArray(Ne))return R(Ne)}function R(Ne,Be){(Be==null||Be>Ne.length)&&(Be=Ne.length);for(var qe=0,ct=new Array(Be);qe<Be;qe++)ct[qe]=Ne[qe];return ct}function B(Ne,Be){if(!(Ne instanceof Be))throw new TypeError("Cannot call a class as a function")}function V(Ne,Be){for(var qe=0;qe<Be.length;qe++){var ct=Be[qe];ct.enumerable=ct.enumerable||!1,ct.configurable=!0,"value"in ct&&(ct.writable=!0),Object.defineProperty(Ne,ct.key,ct)}}function z(Ne,Be,qe){return Be&&V(Ne.prototype,Be),qe&&V(Ne,qe),Ne}function F(Ne,Be,qe){return typeof Reflect<"u"&&Reflect.get?F=Reflect.get:F=function(Ct,Dt,In){var Mn=k(Ct,Dt);if(Mn){var Tn=Object.getOwnPropertyDescriptor(Mn,Dt);return Tn.get?Tn.get.call(In):Tn.value}},F(Ne,Be,qe||Ne)}function k(Ne,Be){for(;!Object.prototype.hasOwnProperty.call(Ne,Be)&&(Ne=ce(Ne),Ne!==null););return Ne}function X(Ne){return function(){var Be=ce(Ne),qe;if(ie()){var ct=ce(this).constructor;qe=Reflect.construct(Be,arguments,ct)}else qe=Be.apply(this,arguments);return Y(this,qe)}}function Y(Ne,Be){return Be&&(u(Be)==="object"||typeof Be=="function")?Be:J(Ne)}function J(Ne){if(Ne===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Ne}function ie(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function ce(Ne){return ce=Object.setPrototypeOf?Object.getPrototypeOf:function(qe){return qe.__proto__||Object.getPrototypeOf(qe)},ce(Ne)}function re(Ne,Be){if(typeof Be!="function"&&Be!==null)throw new TypeError("Super expression must either be null or a function");Ne.prototype=Object.create(Be&&Be.prototype,{constructor:{value:Ne,writable:!0,configurable:!0}}),Be&&ue(Ne,Be)}function ue(Ne,Be){return ue=Object.setPrototypeOf||function(ct,Ct){return ct.__proto__=Ct,ct},ue(Ne,Be)}function se(Ne,Be){var qe=Object.keys(Ne);if(Object.getOwnPropertySymbols){var ct=Object.getOwnPropertySymbols(Ne);Be&&(ct=ct.filter(function(Ct){return Object.getOwnPropertyDescriptor(Ne,Ct).enumerable})),qe.push.apply(qe,ct)}return qe}function me(Ne){for(var Be=1;Be<arguments.length;Be++){var qe=arguments[Be]!=null?arguments[Be]:{};Be%2?se(Object(qe),!0).forEach(function(ct){Ce(Ne,ct,qe[ct])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ne,Object.getOwnPropertyDescriptors(qe)):se(Object(qe)).forEach(function(ct){Object.defineProperty(Ne,ct,Object.getOwnPropertyDescriptor(qe,ct))})}return Ne}function Ce(Ne,Be,qe){return Be in Ne?Object.defineProperty(Ne,Be,{value:qe,enumerable:!0,configurable:!0,writable:!0}):Ne[Be]=qe,Ne}var be=n.ViewMode,Ye=9,tt={type:"FeatureCollection",features:[]},pt=me({mode:be},o.default.defaultProps,{data:[],selectedIndexes:[],filled:!1,stroked:!0,lineWidthScale:i.PROJECTED_PIXEL_SIZE_MULTIPLIER,lineWidthMinPixels:1,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineWidthUnits:"pixels",getHexagons:function(Be){return Be.hexIds},getEditedCluster:function(Be,qe){return qe?me({},qe,{hexIds:Be}):{hexIds:Be}},resolution:Ye}),Ee=function(Ne){re(qe,Ne);var Be=X(qe);function qe(){return B(this,qe),Be.apply(this,arguments)}return z(qe,[{key:"initializeState",value:function(){F(ce(qe.prototype),"initializeState",this).call(this),this.setState({tentativeHexagonIDs:[]})}},{key:"getDerivedHexagonIDs",value:function(Ct){return(0,r.polyfill)(Ct,this.props.resolution,!0)}},{key:"getDerivedHexagonID",value:function(Ct){return(0,r.geoToH3)(Ct[1],Ct[0],this.props.resolution)}},{key:"renderLayers",value:function(){var Ct=this,Dt=[new o.default(this.getSubLayerProps({id:"editable-geojson",mode:this.props.mode,data:tt,selectedFeatureIndexes:[],onEdit:function(Mn){var Tn=Mn.editType,Nt=Mn.editContext;switch(Tn){case"updateTentativeFeature":if(Nt.feature.geometry.type==="Polygon"){var Zt=Nt.feature.geometry.coordinates,Wt=Ct.getDerivedHexagonIDs(Zt);Ct.setState({tentativeHexagonIDs:Wt})}else if(Nt.feature.geometry.type==="Point"){var hn=Nt.feature.geometry.coordinates,lr=Ct.getDerivedHexagonID(hn);Ct.setState({tentativeHexagonIDs:[lr]})}break;case"addFeature":var It=d(Ct.props.data),Xt=Ct.props.modeConfig;if(!Xt||!Xt.booleanOperation)It.push(Ct.props.getEditedCluster(Ct.state.tentativeHexagonIDs,null));else if(Ct.props.selectedIndexes.length!==1)console.warn("booleanOperation only supported for single cluster selection");else{var $t,cn=new Set(Ct.getSelectedHexIDs()),Jt=new Set(Ct.state.tentativeHexagonIDs);switch(Xt.booleanOperation){case"union":default:$t=d(new Set([].concat(d(cn),d(Jt))));break;case"intersection":$t=d(cn).filter(function(or){return Jt.has(or)});break;case"difference":$t=d(cn).filter(function(or){return!Jt.has(or)});break}var Ln=Ct.props.selectedIndexes[0],qn=Ct.props.data[Ln];It[Ln]=Ct.props.getEditedCluster($t,qn)}Ct.setState({tentativeHexagonIDs:[]}),Ct.props.onEdit({updatedData:It});break}}})),new e.H3ClusterLayer(this.getSubLayerProps({id:"hexagons",data:this.props.data,getHexagons:this.props.getHexagons})),new e.H3ClusterLayer(this.getSubLayerProps({id:"tentative-hexagons",data:[{hexIds:this.state.tentativeHexagonIDs}],getHexagons:function(Mn){return Mn.hexIds}}))];return Dt}},{key:"getSelectedHexIDs",value:function(){var Ct=this,Dt=[];return this.props.selectedIndexes.forEach(function(In){var Mn=Ct.props.data[In],Tn=Ct.props.getHexagons(Mn);Dt=Dt.concat(Tn)}),Dt}},{key:"getCursor",value:function(Ct){var Dt=Ct.isDragging,In=this.state||{},Mn=In.cursor;return Mn||(Mn=Dt?"grabbing":"grab"),Mn}}]),qe}(a.default);t.default=Ee,Ce(Ee,"layerName","EditableH3ClusterLayer"),Ce(Ee,"defaultProps",pt)})(boe);var lae={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SELECTION_TYPE=void 0;var e=s2,n=y_,r=rl,i=d(Pie),o=d(K5),a=Hp,s=d(GR),u;function d(Nt){return Nt&&Nt.__esModule?Nt:{default:Nt}}function g(Nt){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?g=function(Wt){return typeof Wt}:g=function(Wt){return Wt&&typeof Symbol=="function"&&Wt.constructor===Symbol&&Wt!==Symbol.prototype?"symbol":typeof Wt},g(Nt)}function _(Nt,Zt){var Wt=Object.keys(Nt);if(Object.getOwnPropertySymbols){var hn=Object.getOwnPropertySymbols(Nt);Zt&&(hn=hn.filter(function(lr){return Object.getOwnPropertyDescriptor(Nt,lr).enumerable})),Wt.push.apply(Wt,hn)}return Wt}function E(Nt){for(var Zt=1;Zt<arguments.length;Zt++){var Wt=arguments[Zt]!=null?arguments[Zt]:{};Zt%2?_(Object(Wt),!0).forEach(function(hn){pt(Nt,hn,Wt[hn])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Nt,Object.getOwnPropertyDescriptors(Wt)):_(Object(Wt)).forEach(function(hn){Object.defineProperty(Nt,hn,Object.getOwnPropertyDescriptor(Wt,hn))})}return Nt}function P(Nt){return V(Nt)||B(Nt)||k(Nt)||R()}function R(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function B(Nt){if(typeof Symbol<"u"&&Symbol.iterator in Object(Nt))return Array.from(Nt)}function V(Nt){if(Array.isArray(Nt))return X(Nt)}function z(Nt,Zt){return J(Nt)||Y(Nt,Zt)||k(Nt,Zt)||F()}function F(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k(Nt,Zt){if(Nt){if(typeof Nt=="string")return X(Nt,Zt);var Wt=Object.prototype.toString.call(Nt).slice(8,-1);if(Wt==="Object"&&Nt.constructor&&(Wt=Nt.constructor.name),Wt==="Map"||Wt==="Set")return Array.from(Wt);if(Wt==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Wt))return X(Nt,Zt)}}function X(Nt,Zt){(Zt==null||Zt>Nt.length)&&(Zt=Nt.length);for(var Wt=0,hn=new Array(Zt);Wt<Zt;Wt++)hn[Wt]=Nt[Wt];return hn}function Y(Nt,Zt){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(Nt)))){var Wt=[],hn=!0,lr=!1,It=void 0;try{for(var Xt=Nt[Symbol.iterator](),$t;!(hn=($t=Xt.next()).done)&&(Wt.push($t.value),!(Zt&&Wt.length===Zt));hn=!0);}catch(cn){lr=!0,It=cn}finally{try{!hn&&Xt.return!=null&&Xt.return()}finally{if(lr)throw It}}return Wt}}function J(Nt){if(Array.isArray(Nt))return Nt}function ie(Nt,Zt){if(!(Nt instanceof Zt))throw new TypeError("Cannot call a class as a function")}function ce(Nt,Zt){for(var Wt=0;Wt<Zt.length;Wt++){var hn=Zt[Wt];hn.enumerable=hn.enumerable||!1,hn.configurable=!0,"value"in hn&&(hn.writable=!0),Object.defineProperty(Nt,hn.key,hn)}}function re(Nt,Zt,Wt){return Zt&&ce(Nt.prototype,Zt),Wt&&ce(Nt,Wt),Nt}function ue(Nt){return function(){var Zt=be(Nt),Wt;if(Ce()){var hn=be(this).constructor;Wt=Reflect.construct(Zt,arguments,hn)}else Wt=Zt.apply(this,arguments);return se(this,Wt)}}function se(Nt,Zt){return Zt&&(g(Zt)==="object"||typeof Zt=="function")?Zt:me(Nt)}function me(Nt){if(Nt===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Nt}function Ce(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function be(Nt){return be=Object.setPrototypeOf?Object.getPrototypeOf:function(Wt){return Wt.__proto__||Object.getPrototypeOf(Wt)},be(Nt)}function Ye(Nt,Zt){if(typeof Zt!="function"&&Zt!==null)throw new TypeError("Super expression must either be null or a function");Nt.prototype=Object.create(Zt&&Zt.prototype,{constructor:{value:Nt,writable:!0,configurable:!0}}),Zt&&tt(Nt,Zt)}function tt(Nt,Zt){return tt=Object.setPrototypeOf||function(hn,lr){return hn.__proto__=lr,hn},tt(Nt,Zt)}function pt(Nt,Zt,Wt){return Zt in Nt?Object.defineProperty(Nt,Zt,{value:Wt,enumerable:!0,configurable:!0,writable:!0}):Nt[Zt]=Wt,Nt}var Ee={NONE:null,RECTANGLE:"rectangle",POLYGON:"polygon"};t.SELECTION_TYPE=Ee;var Ne=(u={},pt(u,Ee.RECTANGLE,a.DrawRectangleMode),pt(u,Ee.POLYGON,a.DrawPolygonMode),u),Be=pt({},Ee.RECTANGLE,{dragToDraw:!0}),qe={selectionType:Ee.RECTANGLE,layerIds:[],onSelect:function(){}},ct={type:"FeatureCollection",features:[]},Ct=50,Dt="selection-geojson",In="selection-blocker",Mn=["lineWidthScale","lineWidthMinPixels","lineWidthMaxPixels","lineWidthUnits","lineJointRounded","lineCapRounded","lineMiterLimit","pointRadiusScale","pointRadiusMinPixels","pointRadiusMaxPixels","lineDashJustified","getLineColor","getFillColor","getRadius","getLineWidth","getLineDashArray","getTentativeLineDashArray","getTentativeLineColor","getTentativeFillColor","getTentativeLineWidth"],Tn=function(Nt){Ye(Wt,Nt);var Zt=ue(Wt);function Wt(){return ie(this,Wt),Zt.apply(this,arguments)}return re(Wt,[{key:"_selectRectangleObjects",value:function(lr){var It=this.props,Xt=It.layerIds,$t=It.onSelect,cn=this.context.viewport.project(lr[0][0]),Jt=z(cn,2),Ln=Jt[0],qn=Jt[1],or=this.context.viewport.project(lr[0][2]),cr=z(or,2),cs=cr[0],Ri=cr[1],Do=this.context.deck.pickObjects({x:Math.min(Ln,cs),y:Math.min(qn,Ri),width:Math.abs(cs-Ln),height:Math.abs(Ri-qn),layerIds:Xt});$t({pickingInfos:Do})}},{key:"_selectPolygonObjects",value:function(lr){var It=this,Xt=this.props,$t=Xt.layerIds,cn=Xt.onSelect,Jt=lr[0].map(function(mo){return It.context.viewport.project(mo)}),Ln=Jt.map(function(mo){return mo[0]}),qn=Jt.map(function(mo){return mo[1]}),or=Math.min.apply(Math,P(Ln)),cr=Math.min.apply(Math,P(qn)),cs=Math.max.apply(Math,P(Ln)),Ri=Math.max.apply(Math,P(qn)),Do=(0,r.polygon)(lr),Fa=(0,i.default)(Do,Ct),Nl;try{Nl=(0,o.default)(Fa,Do)}catch(mo){console.log("turfDifference() error",mo);return}this.setState({pendingPolygonSelection:{bigPolygon:Nl}});var _s="".concat(this.props.id,"-").concat(In);setTimeout(function(){var mo=It.context.deck.pickObjects({x:or,y:cr,width:cs-or,height:Ri-cr,layerIds:[_s].concat(P($t))});cn({pickingInfos:mo.filter(function(Fl){return Fl.layer.id!==It.props.id})})},250)}},{key:"renderLayers",value:function(){var lr=this,It=this.state.pendingPolygonSelection,Xt=Ne[this.props.selectionType]||a.ViewMode,$t=Be[this.props.selectionType],cn={};Mn.forEach(function(qn){lr.props[qn]!==void 0&&(cn[qn]=lr.props[qn])});var Jt=[new s.default(this.getSubLayerProps(E({id:Dt,pickable:!0,mode:Xt,modeConfig:$t,selectedFeatureIndexes:[],data:ct,onEdit:function(or){var cr=or.updatedData,cs=or.editType;if(cs==="addFeature"){var Ri=cr.features[0].geometry.coordinates;lr.props.selectionType===Ee.RECTANGLE?lr._selectRectangleObjects(Ri):lr.props.selectionType===Ee.POLYGON&&lr._selectPolygonObjects(Ri)}}},cn)))];if(It){var Ln=It.bigPolygon;Jt.push(new n.PolygonLayer(this.getSubLayerProps({id:In,pickable:!0,stroked:!1,opacity:1,data:[Ln],getLineColor:function(or){return[0,0,0,1]},getFillColor:function(or){return[0,0,0,1]},getPolygon:function(or){return or.geometry.coordinates}})))}return Jt}},{key:"shouldUpdateState",value:function(lr){var It=lr.changeFlags,Xt=It.stateChanged,$t=It.propsOrDataChanged;return Xt||$t}}]),Wt}(e.CompositeLayer);t.default=Tn,pt(Tn,"layerName","SelectionLayer"),pt(Tn,"defaultProps",qe)})(lae);var uae={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=s2,n=y_;function r(z){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?r=function(k){return typeof k}:r=function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},r(z)}function i(z,F){if(!(z instanceof F))throw new TypeError("Cannot call a class as a function")}function o(z,F){for(var k=0;k<F.length;k++){var X=F[k];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(z,X.key,X)}}function a(z,F,k){return F&&o(z.prototype,F),k&&o(z,k),z}function s(z){return function(){var F=_(z),k;if(g()){var X=_(this).constructor;k=Reflect.construct(F,arguments,X)}else k=F.apply(this,arguments);return u(this,k)}}function u(z,F){return F&&(r(F)==="object"||typeof F=="function")?F:d(z)}function d(z){if(z===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return z}function g(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function _(z){return _=Object.setPrototypeOf?Object.getPrototypeOf:function(k){return k.__proto__||Object.getPrototypeOf(k)},_(z)}function E(z,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function");z.prototype=Object.create(F&&F.prototype,{constructor:{value:z,writable:!0,configurable:!0}}),F&&P(z,F)}function P(z,F){return P=Object.setPrototypeOf||function(X,Y){return X.__proto__=Y,X},P(z,F)}function R(z,F,k){return F in z?Object.defineProperty(z,F,{value:k,enumerable:!0,configurable:!0,writable:!0}):z[F]=k,z}var B={},V=function(z){E(k,z);var F=s(k);function k(){return i(this,k),F.apply(this,arguments)}return a(k,[{key:"renderLayers",value:function(){var Y=new n.ScatterplotLayer(Object.assign({},this.props,{id:"".concat(this.props.id,"-ScatterplotLayer"),data:this.props.data})),J=new n.LineLayer(Object.assign({},this.props,{id:"".concat(this.props.id,"-LineLayer"),data:this.props.data,pickable:!1,getSourcePosition:function(ce){var re=ce.position;return[re[0],re[1],0]},getTargetPosition:function(ce){var re=ce.position;return[re[0],re[1],re[2]||0]},getColor:[150,150,150,200],getStrokeWidth:3}));return[Y,J]}}]),k}(e.CompositeLayer);t.default=V,R(V,"layerName","ElevatedEditHandleLayer"),R(V,"defaultProps",B)})(uae);var OU={};const Nqe={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795},Fqe=Object.freeze(Object.defineProperty({__proto__:null,default:Nqe},Symbol.toStringTag,{value:"Module"})),kqe=ti(Fqe),cae=ti(uEe);var fae={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e={outlineEnabled:!1,outlineRenderShadowmap:!1,outlineShadowmap:null};function n(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e,s=a.outlineEnabled,u=a.outlineRenderShadowmap,d=a.outlineShadowmap,g={};return s!==void 0&&(g.outline_uEnabled=s),u!==void 0&&(g.outline_uRenderOutlines=u),d!==void 0&&(g.outline_uShadowmap=d),g}var r=`attribute float instanceZLevel;
varying float outline_vzLevel;
varying vec4 outline_vPosition;

// Set the z level for the outline shadowmap rendering
void outline_setZLevel(float zLevel) {
  outline_vzLevel = zLevel;
}

// Store an adjusted position for texture2DProj
void outline_setUV(vec4 position) {
  // mat4(
  //   0.5, 0.0, 0.0, 0.0,
  //   0.0, 0.5, 0.0, 0.0,
  //   0.0, 0.0, 0.5, 0.0,
  //   0.5, 0.5, 0.5, 1.0
  // ) * position;
  outline_vPosition = vec4(position.xyz * 0.5 + position.w * 0.5, position.w);
}
`,i=`uniform bool outline_uEnabled;
uniform bool outline_uRenderOutlines;
uniform sampler2D outline_uShadowmap;

varying float outline_vzLevel;
// varying vec2 outline_vUV;
varying vec4 outline_vPosition;

const float OUTLINE_Z_LEVEL_ERROR = 0.01;

// Return a darker color in shadowmap
vec4 outline_filterShadowColor(vec4 color) {
  return vec4(outline_vzLevel / 255., outline_vzLevel / 255., outline_vzLevel / 255., 1.);
}

// Return a darker color if in shadowmap
vec4 outline_filterDarkenColor(vec4 color) {
  if (outline_uEnabled) {
    float maxZLevel;
    if (outline_vPosition.q > 0.0) {
      maxZLevel = texture2DProj(outline_uShadowmap, outline_vPosition).r * 255.;
    } else {
      discard;
    }
    if (maxZLevel < outline_vzLevel + OUTLINE_Z_LEVEL_ERROR) {
      vec4(color.rgb * 0.5, color.a);
    } else {
      discard;
    }
  }
  return color;
}

// if enabled and rendering outlines - Render depth to shadowmap
// if enabled and rendering colors - Return a darker color if in shadowmap
// if disabled, just return color
vec4 outline_filterColor(vec4 color) {
  if (outline_uEnabled) {
    return outline_uRenderOutlines ?
      outline_filterShadowColor(color) :
      outline_filterDarkenColor(color);
  }
  return color;
}
`,o={name:"outline",vs:r,fs:i,getUniforms:n};t.default=o})(fae);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=y_,n=a(kqe),r=cae,i=a(fae),o=uA;function a(ue){return ue&&ue.__esModule?ue:{default:ue}}function s(ue){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?s=function(me){return typeof me}:s=function(me){return me&&typeof Symbol=="function"&&me.constructor===Symbol&&me!==Symbol.prototype?"symbol":typeof me},s(ue)}function u(ue,se){if(!(ue instanceof se))throw new TypeError("Cannot call a class as a function")}function d(ue,se){for(var me=0;me<se.length;me++){var Ce=se[me];Ce.enumerable=Ce.enumerable||!1,Ce.configurable=!0,"value"in Ce&&(Ce.writable=!0),Object.defineProperty(ue,Ce.key,Ce)}}function g(ue,se,me){return se&&d(ue.prototype,se),me&&d(ue,me),ue}function _(ue,se,me){return typeof Reflect<"u"&&Reflect.get?_=Reflect.get:_=function(be,Ye,tt){var pt=E(be,Ye);if(pt){var Ee=Object.getOwnPropertyDescriptor(pt,Ye);return Ee.get?Ee.get.call(tt):Ee.value}},_(ue,se,me||ue)}function E(ue,se){for(;!Object.prototype.hasOwnProperty.call(ue,se)&&(ue=z(ue),ue!==null););return ue}function P(ue){return function(){var se=z(ue),me;if(V()){var Ce=z(this).constructor;me=Reflect.construct(se,arguments,Ce)}else me=se.apply(this,arguments);return R(this,me)}}function R(ue,se){return se&&(s(se)==="object"||typeof se=="function")?se:B(ue)}function B(ue){if(ue===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ue}function V(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function z(ue){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(me){return me.__proto__||Object.getPrototypeOf(me)},z(ue)}function F(ue,se){if(typeof se!="function"&&se!==null)throw new TypeError("Super expression must either be null or a function");ue.prototype=Object.create(se&&se.prototype,{constructor:{value:ue,writable:!0,configurable:!0}}),se&&k(ue,se)}function k(ue,se){return k=Object.setPrototypeOf||function(Ce,be){return Ce.__proto__=be,Ce},k(ue,se)}function X(ue,se,me){return se in ue?Object.defineProperty(ue,se,{value:me,enumerable:!0,configurable:!0,writable:!0}):ue[se]=me,ue}function Y(ue){var se=ue.source,me=ue.code,Ce=me===void 0?"":me,be=/}[^{}]*$/;return se.replace(be,Ce.concat(`
}
`))}var J=`  outline_setUV(gl_Position);
  outline_setZLevel(instanceZLevel);
`,ie=`  gl_FragColor = outline_filterColor(gl_FragColor);
`,ce={getZLevel:function(){return 0}},re=function(ue){F(me,ue);var se=P(me);function me(){return u(this,me),se.apply(this,arguments)}return g(me,[{key:"getShaders",value:function(){var be=_(z(me.prototype),"getShaders",this).call(this);return Object.assign({},be,{modules:be.modules.concat([i.default]),vs:Y({source:be.vs,code:J}),fs:Y({source:be.fs,code:ie})})}},{key:"initializeState",value:function(be){_(z(me.prototype),"initializeState",this).call(this,be),this.setState({outlineFramebuffer:new r.Framebuffer(be.gl),dummyTexture:new r.Texture2D(be.gl)}),this.state.attributeManager.addInstanced({instanceZLevel:{size:1,type:n.default.UNSIGNED_BYTE,accessor:"getZLevel"}})}},{key:"draw",value:function(be){be.moduleParameters,be.parameters;var Ye=be.uniforms;be.context;var tt=this.props,pt=tt.jointRounded,Ee=tt.capRounded,Ne=tt.billboard,Be=tt.miterLimit,qe=tt.widthUnits,ct=tt.widthScale,Ct=tt.widthMinPixels,Dt=tt.widthMaxPixels;Ye=Object.assign({},Ye,{jointType:Number(pt),capType:Number(Ee),billboard:Ne,widthUnits:o.UNIT[qe],widthScale:ct,miterLimit:Be,widthMinPixels:Ct,widthMaxPixels:Dt});var In=this.state,Mn=In.outlineFramebuffer,Tn=In.dummyTexture;Mn.resize(),Mn.clear({color:!0,depth:!0}),this.state.model.updateModuleSettings({outlineEnabled:!0,outlineRenderShadowmap:!0,outlineShadowmap:Tn}),this.state.model.draw({uniforms:Object.assign({},Ye,{jointType:0,widthScale:this.props.widthScale*1.3}),parameters:{depthTest:!1,blendEquation:n.default.MAX},framebuffer:Mn}),this.state.model.updateModuleSettings({outlineEnabled:!0,outlineRenderShadowmap:!1,outlineShadowmap:Mn}),this.state.model.draw({uniforms:Object.assign({},Ye,{jointType:Number(pt),capType:Number(Ee),widthScale:this.props.widthScale}),parameters:{depthTest:!1}})}}]),me}(e.PathLayer);t.default=re,X(re,"layerName","PathOutlineLayer"),X(re,"defaultProps",ce)})(OU);var hae={};const zqe=ti(_$e);var dae={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=cae;function n(P){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(B){return typeof B}:n=function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B},n(P)}function r(P,R){if(!(P instanceof R))throw new TypeError("Cannot call a class as a function")}function i(P){return function(){var R=u(P),B;if(s()){var V=u(this).constructor;B=Reflect.construct(R,arguments,V)}else B=R.apply(this,arguments);return o(this,B)}}function o(P,R){return R&&(n(R)==="object"||typeof R=="function")?R:a(P)}function a(P){if(P===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P}function s(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function u(P){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(B){return B.__proto__||Object.getPrototypeOf(B)},u(P)}function d(P,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function");P.prototype=Object.create(R&&R.prototype,{constructor:{value:P,writable:!0,configurable:!0}}),R&&g(P,R)}function g(P,R){return g=Object.setPrototypeOf||function(V,z){return V.__proto__=z,V},g(P,R)}var _=function(P){d(B,P);var R=i(B);function B(){var V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return r(this,B),R.call(this,Object.assign({},V,{attributes:E(V)}))}return B}(e.Geometry);t.default=_;function E(P){for(var R=P.length,B=R===void 0?1:R,V=P.headSize,z=V===void 0?.2:V,F=P.tailWidth,k=F===void 0?.05:F,X=P.tailStart,Y=X===void 0?.05:X,J=[.5,1,0,.5-z/2,1-z,0,.5+z/2,1-z,0,.5-k/2,Y,0,.5+k/2,1-z,0,.5+k/2,Y,0,.5-k/2,Y,0,.5-k/2,1-z,0,.5+k/2,1-z,0],ie=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],ce=new Array(J.length),re=0;re<J.length/3;re++){var ue=re*3;ce[ue+0]=(J[ue+0]-.5)*B,ce[ue+1]=(J[ue+1]-.5)*B,ce[ue+2]=0}return{positions:new Float32Array(ce),normals:new Float32Array(ie),texCoords:new Float32Array(J)}}})(dae);var pae={};const Uqe=Object.freeze(Object.defineProperty({__proto__:null,Euler:ms,Matrix3:is,Matrix4:vr,Pose:x$,Quaternion:Zm,SphericalCoordinates:Nv,Vector2:BO,Vector3:yt,Vector4:NO,_Euler:ms,_MathUtils:Fv,_Pose:x$,_SphericalCoordinates:Nv,acos:Sxe,asin:Exe,assert:ac,atan:Txe,clamp:Wi,clone:vxe,config:fo,configure:yxe,cos:bxe,degrees:bl,equals:Sl,exactEquals:bte,formatValue:A5,isArray:wh,lerp:pc,radians:Jy,sin:xxe,tan:wxe,toDegrees:xte,toRadians:vte,withEpsilon:Cxe},Symbol.toStringTag,{value:"Module"})),gae=ti(Uqe);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var e=gae;function n(g){if(typeof Symbol>"u"||g[Symbol.iterator]==null){if(Array.isArray(g)||(g=r(g))){var _=0,E=function(){};return{s:E,n:function(){return _>=g.length?{done:!0}:{done:!1,value:g[_++]}},e:function(F){throw F},f:E}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var P,R=!0,B=!1,V;return{s:function(){P=g[Symbol.iterator]()},n:function(){var F=P.next();return R=F.done,F},e:function(F){B=!0,V=F},f:function(){try{!R&&P.return!=null&&P.return()}finally{if(B)throw V}}}}function r(g,_){if(g){if(typeof g=="string")return i(g,_);var E=Object.prototype.toString.call(g).slice(8,-1);if(E==="Object"&&g.constructor&&(E=g.constructor.name),E==="Map"||E==="Set")return Array.from(E);if(E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E))return i(g,_)}}function i(g,_){(_==null||_>g.length)&&(_=g.length);for(var E=0,P=new Array(_);E<_;E++)P[E]=g[E];return P}function o(g){for(var _=0,E=0;E<g.length-1;E++)_+=g[E].distance(g[E+1]);return _}var a=[0,0,0,255],s={forward:!0,backward:!1};function u(g){var _=g.data,E=g.getPath,P=E===void 0?function(qe){return qe.path}:E,R=g.getDirection,B=R===void 0?function(qe){return qe.direction}:R,V=g.getColor,z=V===void 0?function(qe){return a}:V,F=g.getMarkerPercentages,k=F===void 0?function(qe,ct){return[.5]}:F,X=g.projectFlat,Y=[],J=n(_),ie;try{for(J.s();!(ie=J.n()).done;){var ce=ie.value,re=P(ce),ue=B(ce)||s,se=z(ce),me=re.map(function(qe){return new e.Vector2(qe)}),Ce=me.slice(0).reverse(),be=o(me),Ye=k(ce,{lineLength:be}),tt=n(Ye),pt;try{for(tt.s();!(pt=tt.n()).done;){var Ee=pt.value;if(ue.forward){var Ne=d({path:me,percentage:Ee,lineLength:be,color:se,object:ce,projectFlat:X});Y.push(Ne)}if(ue.backward){var Be=d({path:Ce,percentage:Ee,lineLength:be,color:se,object:ce,projectFlat:X});Y.push(Be)}}}catch(qe){tt.e(qe)}finally{tt.f()}}}catch(qe){J.e(qe)}finally{J.f()}return Y}function d(g){var _=g.path,E=g.percentage,P=g.lineLength,R=g.color,B=g.object,V=g.projectFlat,z=P*E,F=0,k=0,X=0;for(X=0;X<_.length-1&&(F+=_[X].distance(_[X+1]),!(F>z));X++)k=F;X===_.length-1&&(X-=1);var Y=_[X+1].clone().subtract(_[X]).normalize(),J=z-k,ie=Y.clone().multiply(new e.Vector2(J,J)).add(_[X]),ce=new e.Vector2(V(_[X+1])).subtract(V(_[X])),re=ce.verticalAngle()*180/Math.PI;return{position:[ie.x,ie.y,0],angle:re,color:R,object:B}}})(pae);var pL={};Object.defineProperty(pL,"__esModule",{value:!0});pL.getClosestPointOnLine=mae;pL.getClosestPointOnPolyline=Gqe;var cP=gae;function mae(t){var e=t.p,n=t.p1,r=t.p2,i=t.clampToLine,o=i===void 0?!0:i,a=new cP.Vector3(r).subtract(n),s=new cP.Vector3(e).subtract(n),u=a.dot(s);return o&&(u=(0,cP.clamp)(u,0,1)),a.lerp(u)}function Gqe(t){var e=t.p,n=t.points;e=new cP.Vector3(e);for(var r=null,i=1/0,o=-1,a=0;a<n.length-1;++a){var s=n[a],u=n[a+1],d=mae({p:e,p1:s,p2:u}),g=e.distanceSquared(d);g<i&&(i=g,r=d,o=a)}return{point:r,index:o,p1:n[o],p2:n[o+1],distanceSquared:i,distance:Math.sqrt(i)}}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=s2,n=y_,r=zqe,i=u(OU),o=u(dae),a=u(pae),s=pL;function u(Ee){return Ee&&Ee.__esModule?Ee:{default:Ee}}function d(Ee){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?d=function(Be){return typeof Be}:d=function(Be){return Be&&typeof Symbol=="function"&&Be.constructor===Symbol&&Be!==Symbol.prototype?"symbol":typeof Be},d(Ee)}function g(Ee,Ne){return B(Ee)||R(Ee,Ne)||E(Ee,Ne)||_()}function _(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E(Ee,Ne){if(Ee){if(typeof Ee=="string")return P(Ee,Ne);var Be=Object.prototype.toString.call(Ee).slice(8,-1);if(Be==="Object"&&Ee.constructor&&(Be=Ee.constructor.name),Be==="Map"||Be==="Set")return Array.from(Be);if(Be==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Be))return P(Ee,Ne)}}function P(Ee,Ne){(Ne==null||Ne>Ee.length)&&(Ne=Ee.length);for(var Be=0,qe=new Array(Ne);Be<Ne;Be++)qe[Be]=Ee[Be];return qe}function R(Ee,Ne){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(Ee)))){var Be=[],qe=!0,ct=!1,Ct=void 0;try{for(var Dt=Ee[Symbol.iterator](),In;!(qe=(In=Dt.next()).done)&&(Be.push(In.value),!(Ne&&Be.length===Ne));qe=!0);}catch(Mn){ct=!0,Ct=Mn}finally{try{!qe&&Dt.return!=null&&Dt.return()}finally{if(ct)throw Ct}}return Be}}function B(Ee){if(Array.isArray(Ee))return Ee}function V(Ee,Ne){if(!(Ee instanceof Ne))throw new TypeError("Cannot call a class as a function")}function z(Ee,Ne){for(var Be=0;Be<Ne.length;Be++){var qe=Ne[Be];qe.enumerable=qe.enumerable||!1,qe.configurable=!0,"value"in qe&&(qe.writable=!0),Object.defineProperty(Ee,qe.key,qe)}}function F(Ee,Ne,Be){return Ne&&z(Ee.prototype,Ne),Be&&z(Ee,Be),Ee}function k(Ee){return function(){var Ne=ie(Ee),Be;if(J()){var qe=ie(this).constructor;Be=Reflect.construct(Ne,arguments,qe)}else Be=Ne.apply(this,arguments);return X(this,Be)}}function X(Ee,Ne){return Ne&&(d(Ne)==="object"||typeof Ne=="function")?Ne:Y(Ee)}function Y(Ee){if(Ee===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Ee}function J(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function ie(Ee){return ie=Object.setPrototypeOf?Object.getPrototypeOf:function(Be){return Be.__proto__||Object.getPrototypeOf(Be)},ie(Ee)}function ce(Ee,Ne){if(typeof Ne!="function"&&Ne!==null)throw new TypeError("Super expression must either be null or a function");Ee.prototype=Object.create(Ne&&Ne.prototype,{constructor:{value:Ee,writable:!0,configurable:!0}}),Ne&&re(Ee,Ne)}function re(Ee,Ne){return re=Object.setPrototypeOf||function(qe,ct){return qe.__proto__=ct,qe},re(Ee,Ne)}function ue(Ee,Ne,Be){return Ne in Ee?Object.defineProperty(Ee,Ne,{value:Be,enumerable:!0,configurable:!0,writable:!0}):Ee[Ne]=Be,Ee}var se=.1,me=.2,Ce=.05,be=r.SimpleMeshLayer,Ye={mesh:new o.default({headSize:me,tailWidth:Ce})},tt=Object.assign({},i.default.defaultProps,{MarkerLayer:be,markerLayerProps:Ye,sizeScale:100,fp64:!1,highlightIndex:-1,highlightPoint:null,getPath:function(Ne){return Ne.path},getColor:function(Ne){return Ne.color},getMarkerColor:function(Ne){return[0,0,0,255]},getDirection:function(Ne){return Ne.direction},getMarkerPercentages:function(Ne,Be){var qe=Be.lineLength;return qe>se?[.25,.5,.75]:[.5]}}),pt=function(Ee){ce(Be,Ee);var Ne=k(Be);function Be(){return V(this,Be),Ne.apply(this,arguments)}return F(Be,[{key:"initializeState",value:function(){this.state={markers:[],mesh:new o.default({headSize:me,tailWidth:Ce}),closestPoint:null}}},{key:"projectFlat",value:function(ct,Ct,Dt,In){if(Dt===e.COORDINATE_SYSTEM.METER_OFFSETS){var Mn=Ct.metersToLngLatDelta(ct),Tn=g(Mn,2),Nt=Tn[0],Zt=Tn[1],Wt=g(In,2),hn=Wt[0],lr=Wt[1];return Ct.projectFlat([hn+Nt,Zt+lr])}else if(Dt===e.COORDINATE_SYSTEM.LNGLAT_OFFSETS){var It=g(ct,2),Xt=It[0],$t=It[1],cn=g(In,2),Jt=cn[0],Ln=cn[1];return Ct.projectFlat([Jt+Xt,$t+Ln])}return Ct.projectFlat(ct)}},{key:"updateState",value:function(ct){var Ct=this,Dt=ct.props,In=ct.oldProps,Mn=ct.changeFlags;if(Mn.dataChanged||Mn.updateTriggersChanged){var Tn=this.props,Nt=Tn.data,Zt=Tn.getPath,Wt=Tn.getDirection,hn=Tn.getMarkerColor,lr=Tn.getMarkerPercentages,It=Tn.coordinateSystem,Xt=Tn.coordinateOrigin,$t=this.context.viewport,cn=function(Ln){return Ct.projectFlat(Ln,$t,It,Xt)};this.state.markers=(0,a.default)({data:Nt,getPath:Zt,getDirection:Wt,getColor:hn,getMarkerPercentages:lr,projectFlat:cn}),this._recalculateClosestPoint()}Mn.propsChanged&&Dt.point!==In.point&&this._recalculateClosestPoint()}},{key:"_recalculateClosestPoint",value:function(){var ct=this.props,Ct=ct.highlightPoint,Dt=ct.highlightIndex;if(Ct&&Dt>=0){var In=this.props.data[Dt],Mn=this.props.getPath(In),Tn=(0,s.getClosestPointOnPolyline)({points:Mn,p:Ct}),Nt=Tn.point;this.state.closestPoints=[{position:Nt}]}else this.state.closestPoints=[]}},{key:"getPickingInfo",value:function(ct){var Ct=ct.info;return Object.assign(Ct,{object:Ct.object&&Ct.object.path||Ct.object})}},{key:"renderLayers",value:function(){return[new i.default(this.props,this.getSubLayerProps({id:"paths",data:this.props.data})),new this.props.MarkerLayer(this.getSubLayerProps(Object.assign({},this.props.markerLayerProps,{id:"markers",data:this.state.markers,getOrientation:function(Ct){return[0,-Ct.angle,0]},getColor:function(Ct){return Ct.color},sizeScale:this.props.sizeScale,fp64:this.props.fp64,pickable:!1,parameters:{blend:!1,depthTest:!1}}))),this.state.closestPoints&&new n.ScatterplotLayer({id:"".concat(this.props.id,"-highlight"),data:this.state.closestPoints,fp64:this.props.fp64})]}}]),Be}(e.CompositeLayer);t.default=pt,ue(pt,"layerName","PathMarkerLayer"),ue(pt,"defaultProps",tt)})(hae);var Aae={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=s2,n=y_;function r(F){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?r=function(X){return typeof X}:r=function(X){return X&&typeof Symbol=="function"&&X.constructor===Symbol&&X!==Symbol.prototype?"symbol":typeof X},r(F)}function i(F,k){var X=Object.keys(F);if(Object.getOwnPropertySymbols){var Y=Object.getOwnPropertySymbols(F);k&&(Y=Y.filter(function(J){return Object.getOwnPropertyDescriptor(F,J).enumerable})),X.push.apply(X,Y)}return X}function o(F){for(var k=1;k<arguments.length;k++){var X=arguments[k]!=null?arguments[k]:{};k%2?i(Object(X),!0).forEach(function(Y){V(F,Y,X[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(X)):i(Object(X)).forEach(function(Y){Object.defineProperty(F,Y,Object.getOwnPropertyDescriptor(X,Y))})}return F}function a(F,k){if(!(F instanceof k))throw new TypeError("Cannot call a class as a function")}function s(F,k){for(var X=0;X<k.length;X++){var Y=k[X];Y.enumerable=Y.enumerable||!1,Y.configurable=!0,"value"in Y&&(Y.writable=!0),Object.defineProperty(F,Y.key,Y)}}function u(F,k,X){return k&&s(F.prototype,k),X&&s(F,X),F}function d(F){return function(){var k=P(F),X;if(E()){var Y=P(this).constructor;X=Reflect.construct(k,arguments,Y)}else X=k.apply(this,arguments);return g(this,X)}}function g(F,k){return k&&(r(k)==="object"||typeof k=="function")?k:_(F)}function _(F){if(F===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return F}function E(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function P(F){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(X){return X.__proto__||Object.getPrototypeOf(X)},P(F)}function R(F,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function");F.prototype=Object.create(k&&k.prototype,{constructor:{value:F,writable:!0,configurable:!0}}),k&&B(F,k)}function B(F,k){return B=Object.setPrototypeOf||function(Y,J){return Y.__proto__=J,Y},B(F,k)}function V(F,k,X){return k in F?Object.defineProperty(F,k,{value:X,enumerable:!0,configurable:!0,writable:!0}):F[k]=X,F}var z=function(F){R(X,F);var k=d(X);function X(){return a(this,X),k.apply(this,arguments)}return u(X,[{key:"renderLayers",value:function(){var J=this.props,ie=J.id,ce=J.getFillColor,re=J.getStrokeColor,ue=J.getInnerRadius,se=J.updateTriggers;return[new n.ScatterplotLayer(o({},this.props,{id:"".concat(ie,"-full"),data:this.props.data,getLineColor:re,updateTriggers:o({},se,{getStrokeColor:se.getStrokeColor})})),new n.ScatterplotLayer(o({},this.props,{id:"".concat(ie,"-inner"),data:this.props.data,getFillColor:ce,getRadius:ue,pickable:!1,updateTriggers:o({},se,{getFillColor:se.getFillColor,getRadius:se.getInnerRadius})}))]}}]),X}(e.CompositeLayer);t.default=z,V(z,"layerName","JunctionScatterplotLayer"),V(z,"defaultProps",o({},n.ScatterplotLayer.defaultProps,{getFillColor:function(k){return[0,0,0,255]},getStrokeColor:function(k){return[255,255,255,255]},getInnerRadius:function(k){return 1}}))})(Aae);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ArrowStyles",{enumerable:!0,get:function(){return e.ArrowStyles}}),Object.defineProperty(t,"DEFAULT_ARROWS",{enumerable:!0,get:function(){return e.DEFAULT_ARROWS}}),Object.defineProperty(t,"MAX_ARROWS",{enumerable:!0,get:function(){return e.MAX_ARROWS}}),Object.defineProperty(t,"EditableGeoJsonLayer",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"EditableH3ClusterLayer",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"SelectionLayer",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"ElevatedEditHandleLayer",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"PathOutlineLayer",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"PathMarkerLayer",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"JunctionScatterplotLayer",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"toDeckColor",{enumerable:!0,get:function(){return d.toDeckColor}});var e=Hm,n=g(GR),r=g(boe),i=g(lae),o=g(uae),a=g(OU),s=g(hae),u=g(Aae),d=rp;function g(_){return _&&_.__esModule?_:{default:_}}})(qie);const jqe="modulepreload",Vqe=function(t){return"/"+t},HX={},$qe=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(o=>{if(o=Vqe(o),o in HX)return;HX[o]=!0;const a=o.endsWith(".css"),s=a?'[rel="stylesheet"]':"";if(!!r)for(let g=i.length-1;g>=0;g--){const _=i[g];if(_.href===o&&(!a||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${s}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":jqe,a||(d.as="script",d.crossOrigin=""),d.href=o,document.head.appendChild(d),a)return new Promise((g,_)=>{d.addEventListener("load",g),d.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e()).catch(o=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o})},Hqe=we.createContext(null);function Wqe(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,o=Array.isArray(e)?e[1]:e?e.y:0;return n===i&&r===o}function Wp(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Wp(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const i of n)if(!e.hasOwnProperty(i)||!Wp(t[i],e[i]))return!1;return!0}return!1}function qqe(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function WX(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();Wp(n,r)||e.setProjection(n)}function qX(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function XX(t,e){const n=e.viewState||e;let r=!1;if("longitude"in n&&"latitude"in n){const i=t.center;t.center=new i.constructor(n.longitude,n.latitude),r=r||i!==t.center}if("zoom"in n){const i=t.zoom;t.zoom=n.zoom,r=r||i!==t.zoom}if("bearing"in n){const i=t.bearing;t.bearing=n.bearing,r=r||i!==t.bearing}if("pitch"in n){const i=t.pitch;t.pitch=n.pitch,r=r||i!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),r}const Xqe=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ZX(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const o=e[r.ref];if(o){i=i||Object.assign({},r),delete i.ref;for(const a of Xqe)a in o&&(i[a]=o[a])}return i||r});return{...t,layers:n}}const YX={version:8,sources:{},layers:[]},QX={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},rN={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},KX={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Zqe=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Yqe=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class x1{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const o=this.props[KX[i.type]];o?o(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const o=this.props[QX[i.type]];o&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),o(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const o=this.props[rN[i.type]];o&&o(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const i=this._updateSize(e),o=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||i||o&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=x1.savedMaps.pop();if(!r)return null;const i=r.map,o=i.getContainer();for(n.className=o.className;o.childNodes.length>0;)n.appendChild(o.childNodes[0]);i._container=n;const a=i._resizeObserver;a&&(a.disconnect(),a.observe(n)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:s}=e;return s&&(s.bounds?i.fitBounds(s.bounds,{...s.fitBoundsOptions,duration:0}):r._updateViewState(s,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=YX}=n,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||Qqe()||null,container:e,style:ZX(r)},o=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[o.longitude||0,o.latitude||0],zoom:o.zoom||0,pitch:o.pitch||0,bearing:o.bearing||0}),n.gl){const g=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=g,n.gl)}const a=new this._MapClass(i);o.padding&&a.setPadding(o.padding),n.cursor&&(a.getCanvas().style.cursor=n.cursor),this._createShadowTransform(a);const s=a._render;a._render=g=>{this._inRender=!0,s.call(a,g),this._inRender=!1};const u=a._renderTaskQueue.run;a._renderTaskQueue.run=g=>{u.call(a._renderTaskQueue,g),this._onBeforeRepaint()},a.on("render",()=>this._onAfterRepaint());const d=a.fire;a.fire=this._fireEvent.bind(this,d),a.on("resize",()=>{this._renderTransform.resize(a.transform.width,a.transform.height)}),a.on("styledata",()=>{this._updateStyleComponents(this.props,{}),WX(a.transform,this._renderTransform)}),a.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const g in QX)a.on(g,this._onPointerEvent);for(const g in rN)a.on(g,this._onCameraEvent);for(const g in KX)a.on(g,this._onEvent);this._map=a}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),x1.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=qqe(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,i=this._renderTransform,{zoom:o,pitch:a,bearing:s}=i,u=r.isMoving();u&&(i.cameraElevationReference="sea");const d=XX(i,{...qX(r.transform),...e});if(u&&(i.cameraElevationReference="ground"),d&&n){const g=this._deferredEvents;g.move=!0,g.zoom||(g.zoom=o!==i.zoom),g.rotate||(g.rotate=s!==i.bearing),g.pitch||(g.pitch=a!==i.pitch)}return u||XX(r.transform,e),d}_updateSettings(e,n){const r=this._map;let i=!1;for(const o of Zqe)if(o in e&&!Wp(e[o],n[o])){i=!0;const a=r[`set${o[0].toUpperCase()}${o.slice(1)}`];a==null||a.call(r,e[o])}return i}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:r=YX,styleDiffing:i=!0}=e,o={diff:i};return"localIdeographFontFamily"in e&&(o.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(ZX(r),o),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let i=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!Wp(e.light,n.light)&&(i=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!Wp(e.fog,n.fog)&&(i=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!Wp(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(i=!0,r.setTerrain(e.terrain))),i}_updateHandlers(e,n){var r,i;const o=this._map;let a=!1;for(const s of Yqe){const u=(r=e[s])!==null&&r!==void 0?r:!0,d=(i=n[s])!==null&&i!==void 0?i:!0;Wp(u,d)||(a=!0,u?o[s].enable(u):o[s].disable())}return a}_queryRenderedFeatures(e){const n=this._map,r=n.transform,{interactiveLayerIds:i=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=r}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const o=e.type,a=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,s=this._queryRenderedFeatures(e.point),u=s.length>0;!u&&a&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=s,u&&!a&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=o}else this._hoveredFeatures=null}_fireEvent(e,n,r){const i=this._map,o=i.transform,a=typeof n=="string"?n:n.type;return a==="move"&&this._updateViewState(this.props,!1),a in rN&&(typeof n=="object"&&(n.viewState=qX(o)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,n,r),i.transform=o,i):(e.call(i,n,r),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{WX(this._renderTransform,n),e.transform=n}}}x1.savedMaps=[];function Qqe(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const Kqe=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Jqe(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const i=e.transform;e.transform=t.transform;const o=e.project(r);return e.transform=i,o},unproject:r=>{const i=e.transform;e.transform=t.transform;const o=e.unproject(r);return e.transform=i,o},queryTerrainElevation:(r,i)=>{const o=e.transform;e.transform=t.transform;const a=e.queryTerrainElevation(r,i);return e.transform=o,a},queryRenderedFeatures:(r,i)=>{const o=e.transform;e.transform=t.transform;const a=e.queryRenderedFeatures(r,i);return e.transform=o,a}};for(const r of eXe(e))!(r in n)&&!Kqe.includes(r)&&(n[r]=e[r].bind(e));return n}function eXe(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const tXe=typeof document<"u"?we.useLayoutEffect:we.useEffect,nXe=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function rXe(t,e){for(const r of nXe)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!1)}const gL=we.createContext(null);function iXe(t,e,n){const r=we.useContext(Hqe),[i,o]=we.useState(null),a=we.useRef(),{current:s}=we.useRef({mapLib:null,map:null});we.useEffect(()=>{const g=t.mapLib;let _=!0,E;return Promise.resolve(g||n).then(P=>{if(!_)return;if(!P)throw new Error("Invalid mapLib");const R="Map"in P?P:P.default;if(!R.Map)throw new Error("Invalid mapLib");if(rXe(R,t),!R.supported||R.supported(t))t.reuseMaps&&(E=x1.reuse(t,a.current)),E||(E=new x1(R.Map,t,a.current)),s.map=Jqe(E),s.mapLib=R,o(E),r==null||r.onMapMount(s.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(P=>{const{onError:R}=t;R?R({type:"error",target:null,originalEvent:null,error:P}):console.error(P)}),()=>{_=!1,E&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?E.recycle():E.destroy())}},[]),tXe(()=>{i&&i.setProps(t)}),we.useImperativeHandle(e,()=>s.map,[i]);const u=we.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),d={height:"100%"};return we.createElement("div",{id:t.id,ref:a,style:u},i&&we.createElement(gL.Provider,{value:s},we.createElement("div",{"mapboxgl-children":"",style:d},t.children)))}const oXe=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function w_(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!oXe.test(r)?n[r]=`${i}px`:n[r]=i}}function sXe(t,e){const{map:n,mapLib:r}=we.useContext(gL),i=we.useRef({props:t});i.current.props=t;const o=we.useMemo(()=>{let B=!1;we.Children.forEach(t.children,F=>{F&&(B=!0)});const V={...t,element:B?document.createElement("div"):null},z=new r.Marker(V);return z.setLngLat([t.longitude,t.latitude]),z.getElement().addEventListener("click",F=>{var k,X;(X=(k=i.current.props).onClick)===null||X===void 0||X.call(k,{type:"click",target:z,originalEvent:F})}),z.on("dragstart",F=>{var k,X;const Y=F;Y.lngLat=o.getLngLat(),(X=(k=i.current.props).onDragStart)===null||X===void 0||X.call(k,Y)}),z.on("drag",F=>{var k,X;const Y=F;Y.lngLat=o.getLngLat(),(X=(k=i.current.props).onDrag)===null||X===void 0||X.call(k,Y)}),z.on("dragend",F=>{var k,X;const Y=F;Y.lngLat=o.getLngLat(),(X=(k=i.current.props).onDragEnd)===null||X===void 0||X.call(k,Y)}),z},[]);we.useEffect(()=>(o.addTo(n.getMap()),()=>{o.remove()}),[]);const{longitude:a,latitude:s,offset:u,style:d,draggable:g=!1,popup:_=null,rotation:E=0,rotationAlignment:P="auto",pitchAlignment:R="auto"}=t;return we.useEffect(()=>{w_(o.getElement(),d)},[d]),we.useImperativeHandle(e,()=>o,[]),(o.getLngLat().lng!==a||o.getLngLat().lat!==s)&&o.setLngLat([a,s]),u&&!Wqe(o.getOffset(),u)&&o.setOffset(u),o.isDraggable()!==g&&o.setDraggable(g),o.getRotation()!==E&&o.setRotation(E),o.getRotationAlignment()!==P&&o.setRotationAlignment(P),o.getPitchAlignment()!==R&&o.setPitchAlignment(R),o.getPopup()!==_&&o.setPopup(_),wE.createPortal(t.children,o.getElement())}we.memo(we.forwardRef(sXe));function JX(t){return new Set(t?t.trim().split(/\s+/):[])}function aXe(t,e){const{map:n,mapLib:r}=we.useContext(gL),i=we.useMemo(()=>document.createElement("div"),[]),o=we.useRef({props:t});o.current.props=t;const a=we.useMemo(()=>{const s={...t},u=new r.Popup(s);return u.setLngLat([t.longitude,t.latitude]),u.once("open",d=>{var g,_;(_=(g=o.current.props).onOpen)===null||_===void 0||_.call(g,d)}),u},[]);if(we.useEffect(()=>{const s=u=>{var d,g;(g=(d=o.current.props).onClose)===null||g===void 0||g.call(d,u)};return a.on("close",s),a.setDOMContent(i).addTo(n.getMap()),()=>{a.off("close",s),a.isOpen()&&a.remove()}},[]),we.useEffect(()=>{w_(a.getElement(),t.style)},[t.style]),we.useImperativeHandle(e,()=>a,[]),a.isOpen()&&((a.getLngLat().lng!==t.longitude||a.getLngLat().lat!==t.latitude)&&a.setLngLat([t.longitude,t.latitude]),t.offset&&!Wp(a.options.offset,t.offset)&&a.setOffset(t.offset),(a.options.anchor!==t.anchor||a.options.maxWidth!==t.maxWidth)&&(a.options.anchor=t.anchor,a.setMaxWidth(t.maxWidth)),a.options.className!==t.className)){const s=JX(a.options.className),u=JX(t.className);for(const d of s)u.has(d)||a.removeClassName(d);for(const d of u)s.has(d)||a.addClassName(d);a.options.className=t.className}return wE.createPortal(t.children,i)}we.memo(we.forwardRef(aXe));function u2(t,e,n,r){const i=we.useContext(gL),o=we.useMemo(()=>t(i),[]);return we.useEffect(()=>{const a=r||n||e,s=typeof e=="function"&&typeof n=="function"?e:null,u=typeof n=="function"?n:typeof e=="function"?e:null,{map:d}=i;return d.hasControl(o)||(d.addControl(o,a==null?void 0:a.position),s&&s(i)),()=>{u&&u(i),d.hasControl(o)&&d.removeControl(o)}},[]),o}function lXe(t){const e=u2(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return we.useEffect(()=>{w_(e._container,t.style)},[t.style]),null}we.memo(lXe);function uXe(t){const e=u2(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return we.useEffect(()=>{w_(e._controlContainer,t.style)},[t.style]),null}we.memo(uXe);function cXe(t,e){const n=we.useRef({props:t}),r=u2(({mapLib:i})=>{const o=new i.GeolocateControl(t),a=o._setupUI;return o._setupUI=s=>{o._container.hasChildNodes()||a(s)},o.on("geolocate",s=>{var u,d;(d=(u=n.current.props).onGeolocate)===null||d===void 0||d.call(u,s)}),o.on("error",s=>{var u,d;(d=(u=n.current.props).onError)===null||d===void 0||d.call(u,s)}),o.on("outofmaxbounds",s=>{var u,d;(d=(u=n.current.props).onOutOfMaxBounds)===null||d===void 0||d.call(u,s)}),o.on("trackuserlocationstart",s=>{var u,d;(d=(u=n.current.props).onTrackUserLocationStart)===null||d===void 0||d.call(u,s)}),o.on("trackuserlocationend",s=>{var u,d;(d=(u=n.current.props).onTrackUserLocationEnd)===null||d===void 0||d.call(u,s)}),o},{position:t.position});return n.current.props=t,we.useImperativeHandle(e,()=>r,[]),we.useEffect(()=>{w_(r._container,t.style)},[t.style]),null}we.memo(we.forwardRef(cXe));function fXe(t){const e=u2(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return we.useEffect(()=>{w_(e._container,t.style)},[t.style]),null}we.memo(fXe);function hXe(t){const e=u2(({mapLib:o})=>new o.ScaleControl(t),{position:t.position}),n=we.useRef(t),r=n.current;n.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),we.useEffect(()=>{w_(e._container,i)},[i]),null}we.memo(hXe);const dXe=$qe(()=>Promise.resolve().then(()=>Ost),void 0),pXe=(()=>we.forwardRef(function(e,n){return iXe(e,n,dXe)}))();var Od=function(){return Od=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Od.apply(this,arguments)};function _ae(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function gXe(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var fP="right-scroll-bar-position",hP="width-before-scroll-bar",mXe="with-scroll-bars-hidden",AXe="--removed-body-scroll-bar-size";function _Xe(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function yXe(t,e){var n=we.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var i=n.value;i!==r&&(n.value=r,n.callback(r,i))}}}})[0];return n.callback=e,n.facade}function vXe(t,e){return yXe(e||null,function(n){return t.forEach(function(r){return _Xe(r,n)})})}function xXe(t){return t}function bXe(t,e){e===void 0&&(e=xXe);var n=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(o){var a=e(o,r);return n.push(a),function(){n=n.filter(function(s){return s!==a})}},assignSyncMedium:function(o){for(r=!0;n.length;){var a=n;n=[],a.forEach(o)}n={push:function(s){return o(s)},filter:function(){return n}}},assignMedium:function(o){r=!0;var a=[];if(n.length){var s=n;n=[],s.forEach(o),a=n}var u=function(){var g=a;a=[],g.forEach(o)},d=function(){return Promise.resolve().then(u)};d(),n={push:function(g){a.push(g),d()},filter:function(g){return a=a.filter(g),n}}}};return i}function wXe(t){t===void 0&&(t={});var e=bXe(null);return e.options=Od({async:!0,ssr:!1},t),e}var yae=function(t){var e=t.sideCar,n=_ae(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return we.createElement(r,Od({},n))};yae.isSideCarExport=!0;function EXe(t,e){return t.useMedium(e),yae}var vae=wXe(),iN=function(){},mL=we.forwardRef(function(t,e){var n=we.useRef(null),r=we.useState({onScrollCapture:iN,onWheelCapture:iN,onTouchMoveCapture:iN}),i=r[0],o=r[1],a=t.forwardProps,s=t.children,u=t.className,d=t.removeScrollBar,g=t.enabled,_=t.shards,E=t.sideCar,P=t.noIsolation,R=t.inert,B=t.allowPinchZoom,V=t.as,z=V===void 0?"div":V,F=t.gapMode,k=_ae(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),X=E,Y=vXe([n,e]),J=Od(Od({},k),i);return we.createElement(we.Fragment,null,g&&we.createElement(X,{sideCar:vae,removeScrollBar:d,shards:_,noIsolation:P,inert:R,setCallbacks:o,allowPinchZoom:!!B,lockRef:n,gapMode:F}),a?we.cloneElement(we.Children.only(s),Od(Od({},J),{ref:Y})):we.createElement(z,Od({},J,{className:u,ref:Y}),s))});mL.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};mL.classNames={fullWidth:hP,zeroRight:fP};var eZ,SXe=function(){if(eZ)return eZ;if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function TXe(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=SXe();return e&&t.setAttribute("nonce",e),t}function CXe(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function PXe(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var IXe=function(){var t=0,e=null;return{add:function(n){t==0&&(e=TXe())&&(CXe(e,n),PXe(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},MXe=function(){var t=IXe();return function(e,n){we.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},xae=function(){var t=MXe(),e=function(n){var r=n.styles,i=n.dynamic;return t(r,i),null};return e},OXe={left:0,top:0,right:0,gap:0},oN=function(t){return parseInt(t||"",10)||0},RXe=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],i=e[t==="padding"?"paddingRight":"marginRight"];return[oN(n),oN(r),oN(i)]},LXe=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return OXe;var e=RXe(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},DXe=xae(),BXe=function(t,e,n,r){var i=t.left,o=t.top,a=t.right,s=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(mXe,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(s,"px ").concat(r,`;
  }
  body {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(s,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(fP,` {
    right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(hP,` {
    margin-right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(fP," .").concat(fP,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(hP," .").concat(hP,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body {
    `).concat(AXe,": ").concat(s,`px;
  }
`)},NXe=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,i=r===void 0?"margin":r,o=we.useMemo(function(){return LXe(i)},[i]);return we.createElement(DXe,{styles:BXe(o,!e,i,n?"":"!important")})},B4=!1;if(typeof window<"u")try{var yT=Object.defineProperty({},"passive",{get:function(){return B4=!0,!0}});window.addEventListener("test",yT,yT),window.removeEventListener("test",yT,yT)}catch{B4=!1}var Oy=B4?{passive:!1}:!1,FXe=function(t){return t.tagName==="TEXTAREA"},bae=function(t,e){var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!FXe(t)&&n[e]==="visible")},kXe=function(t){return bae(t,"overflowY")},zXe=function(t){return bae(t,"overflowX")},tZ=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=wae(t,r);if(i){var o=Eae(t,r),a=o[1],s=o[2];if(a>s)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},UXe=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},GXe=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},wae=function(t,e){return t==="v"?kXe(e):zXe(e)},Eae=function(t,e){return t==="v"?UXe(e):GXe(e)},jXe=function(t,e){return t==="h"&&e==="rtl"?-1:1},VXe=function(t,e,n,r,i){var o=jXe(t,window.getComputedStyle(e).direction),a=o*r,s=n.target,u=e.contains(s),d=!1,g=a>0,_=0,E=0;do{var P=Eae(t,s),R=P[0],B=P[1],V=P[2],z=B-V-o*R;(R||z)&&wae(t,s)&&(_+=z,E+=R),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!u&&s!==document.body||u&&(e.contains(s)||e===s));return(g&&(i&&Math.abs(_)<1||!i&&a>_)||!g&&(i&&Math.abs(E)<1||!i&&-a>E))&&(d=!0),d},vT=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},nZ=function(t){return[t.deltaX,t.deltaY]},rZ=function(t){return t&&"current"in t?t.current:t},$Xe=function(t,e){return t[0]===e[0]&&t[1]===e[1]},HXe=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},WXe=0,Ry=[];function qXe(t){var e=we.useRef([]),n=we.useRef([0,0]),r=we.useRef(),i=we.useState(WXe++)[0],o=we.useState(xae)[0],a=we.useRef(t);we.useEffect(function(){a.current=t},[t]),we.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var B=gXe([t.lockRef.current],(t.shards||[]).map(rZ),!0).filter(Boolean);return B.forEach(function(V){return V.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),B.forEach(function(V){return V.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var s=we.useCallback(function(B,V){if("touches"in B&&B.touches.length===2)return!a.current.allowPinchZoom;var z=vT(B),F=n.current,k="deltaX"in B?B.deltaX:F[0]-z[0],X="deltaY"in B?B.deltaY:F[1]-z[1],Y,J=B.target,ie=Math.abs(k)>Math.abs(X)?"h":"v";if("touches"in B&&ie==="h"&&J.type==="range")return!1;var ce=tZ(ie,J);if(!ce)return!0;if(ce?Y=ie:(Y=ie==="v"?"h":"v",ce=tZ(ie,J)),!ce)return!1;if(!r.current&&"changedTouches"in B&&(k||X)&&(r.current=Y),!Y)return!0;var re=r.current||Y;return VXe(re,V,B,re==="h"?k:X,!0)},[]),u=we.useCallback(function(B){var V=B;if(!(!Ry.length||Ry[Ry.length-1]!==o)){var z="deltaY"in V?nZ(V):vT(V),F=e.current.filter(function(Y){return Y.name===V.type&&(Y.target===V.target||V.target===Y.shadowParent)&&$Xe(Y.delta,z)})[0];if(F&&F.should){V.cancelable&&V.preventDefault();return}if(!F){var k=(a.current.shards||[]).map(rZ).filter(Boolean).filter(function(Y){return Y.contains(V.target)}),X=k.length>0?s(V,k[0]):!a.current.noIsolation;X&&V.cancelable&&V.preventDefault()}}},[]),d=we.useCallback(function(B,V,z,F){var k={name:B,delta:V,target:z,should:F,shadowParent:XXe(z)};e.current.push(k),setTimeout(function(){e.current=e.current.filter(function(X){return X!==k})},1)},[]),g=we.useCallback(function(B){n.current=vT(B),r.current=void 0},[]),_=we.useCallback(function(B){d(B.type,nZ(B),B.target,s(B,t.lockRef.current))},[]),E=we.useCallback(function(B){d(B.type,vT(B),B.target,s(B,t.lockRef.current))},[]);we.useEffect(function(){return Ry.push(o),t.setCallbacks({onScrollCapture:_,onWheelCapture:_,onTouchMoveCapture:E}),document.addEventListener("wheel",u,Oy),document.addEventListener("touchmove",u,Oy),document.addEventListener("touchstart",g,Oy),function(){Ry=Ry.filter(function(B){return B!==o}),document.removeEventListener("wheel",u,Oy),document.removeEventListener("touchmove",u,Oy),document.removeEventListener("touchstart",g,Oy)}},[]);var P=t.removeScrollBar,R=t.inert;return we.createElement(we.Fragment,null,R?we.createElement(o,{styles:HXe(i)}):null,P?we.createElement(NXe,{gapMode:t.gapMode}):null)}function XXe(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const ZXe=EXe(vae,qXe);var Sae=we.forwardRef(function(t,e){return we.createElement(mL,Od({},t,{ref:e,sideCar:ZXe}))});Sae.classNames=mL.classNames;const YXe=Sae;function AL(t){const e=we.createContext(null);return[({children:i,value:o})=>ut.createElement(e.Provider,{value:o},i),()=>{const i=we.useContext(e);if(i===null)throw new Error(t);return i}]}function QXe(t){return Array.isArray(t)?t:[t]}const KXe=()=>{};function JXe(t,e={active:!0}){return typeof t!="function"||!e.active?e.onKeyDown||KXe:n=>{var r;n.key==="Escape"&&(t(n),(r=e.onTrigger)==null||r.call(e))}}function lM(t,e){return n=>{t==null||t(n),e==null||e(n)}}function c2(t){return Array.isArray(t)||t===null?!1:typeof t=="object"?t.type!==ut.Fragment:!1}function Tae(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(n=Tae(t[e]))&&(r&&(r+=" "),r+=n);else for(e in t)t[e]&&(r&&(r+=" "),r+=e);return r}function Cae(){for(var t=0,e,n,r="";t<arguments.length;)(e=arguments[t++])&&(n=Tae(e))&&(r&&(r+=" "),r+=n);return r}const eZe={dark:["#C1C2C5","#A6A7AB","#909296","#5c5f66","#373A40","#2C2E33","#25262b","#1A1B1E","#141517","#101113"],gray:["#f8f9fa","#f1f3f5","#e9ecef","#dee2e6","#ced4da","#adb5bd","#868e96","#495057","#343a40","#212529"],red:["#fff5f5","#ffe3e3","#ffc9c9","#ffa8a8","#ff8787","#ff6b6b","#fa5252","#f03e3e","#e03131","#c92a2a"],pink:["#fff0f6","#ffdeeb","#fcc2d7","#faa2c1","#f783ac","#f06595","#e64980","#d6336c","#c2255c","#a61e4d"],grape:["#f8f0fc","#f3d9fa","#eebefa","#e599f7","#da77f2","#cc5de8","#be4bdb","#ae3ec9","#9c36b5","#862e9c"],violet:["#f3f0ff","#e5dbff","#d0bfff","#b197fc","#9775fa","#845ef7","#7950f2","#7048e8","#6741d9","#5f3dc4"],indigo:["#edf2ff","#dbe4ff","#bac8ff","#91a7ff","#748ffc","#5c7cfa","#4c6ef5","#4263eb","#3b5bdb","#364fc7"],blue:["#e7f5ff","#d0ebff","#a5d8ff","#74c0fc","#4dabf7","#339af0","#228be6","#1c7ed6","#1971c2","#1864ab"],cyan:["#e3fafc","#c5f6fa","#99e9f2","#66d9e8","#3bc9db","#22b8cf","#15aabf","#1098ad","#0c8599","#0b7285"],teal:["#e6fcf5","#c3fae8","#96f2d7","#63e6be","#38d9a9","#20c997","#12b886","#0ca678","#099268","#087f5b"],green:["#ebfbee","#d3f9d8","#b2f2bb","#8ce99a","#69db7c","#51cf66","#40c057","#37b24d","#2f9e44","#2b8a3e"],lime:["#f4fce3","#e9fac8","#d8f5a2","#c0eb75","#a9e34b","#94d82d","#82c91e","#74b816","#66a80f","#5c940d"],yellow:["#fff9db","#fff3bf","#ffec99","#ffe066","#ffd43b","#fcc419","#fab005","#f59f00","#f08c00","#e67700"],orange:["#fff4e6","#ffe8cc","#ffd8a8","#ffc078","#ffa94d","#ff922b","#fd7e14","#f76707","#e8590c","#d9480f"]};function tZe(t){return()=>({fontFamily:t.fontFamily||"sans-serif"})}var nZe=Object.defineProperty,iZ=Object.getOwnPropertySymbols,rZe=Object.prototype.hasOwnProperty,iZe=Object.prototype.propertyIsEnumerable,oZ=(t,e,n)=>e in t?nZe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,sZ=(t,e)=>{for(var n in e||(e={}))rZe.call(e,n)&&oZ(t,n,e[n]);if(iZ)for(var n of iZ(e))iZe.call(e,n)&&oZ(t,n,e[n]);return t};function oZe(t){return e=>({WebkitTapHighlightColor:"transparent",[e||"&:focus"]:sZ({},t.focusRing==="always"||t.focusRing==="auto"?t.focusRingStyles.styles(t):t.focusRingStyles.resetStyles(t)),[e?e.replace(":focus",":focus:not(:focus-visible)"):"&:focus:not(:focus-visible)"]:sZ({},t.focusRing==="auto"||t.focusRing==="never"?t.focusRingStyles.resetStyles(t):null)})}function f2(t){return e=>typeof t.primaryShade=="number"?t.primaryShade:t.primaryShade[e||t.colorScheme]}function RU(t){const e=f2(t);return(n,r,i=!0,o=!0)=>{if(typeof n=="string"&&n.includes(".")){const[s,u]=n.split("."),d=parseInt(u,10);if(s in t.colors&&d>=0&&d<10)return t.colors[s][typeof r=="number"&&!o?r:d]}const a=typeof r=="number"?r:e();return n in t.colors?t.colors[n][a]:i?t.colors[t.primaryColor][a]:n}}function Pae(t){let e="";for(let n=1;n<t.length-1;n+=1)e+=`${t[n]} ${n/(t.length-1)*100}%, `;return`${t[0]} 0%, ${e}${t[t.length-1]} 100%`}function sZe(t,...e){return`linear-gradient(${t}deg, ${Pae(e)})`}function aZe(...t){return`radial-gradient(circle, ${Pae(t)})`}function Iae(t){const e=RU(t),n=f2(t);return r=>{const i={from:(r==null?void 0:r.from)||t.defaultGradient.from,to:(r==null?void 0:r.to)||t.defaultGradient.to,deg:(r==null?void 0:r.deg)||t.defaultGradient.deg};return`linear-gradient(${i.deg}deg, ${e(i.from,n(),!1)} 0%, ${e(i.to,n(),!1)} 100%)`}}function Mae(t){return e=>{if(typeof e=="number")return`${e/16}${t}`;if(typeof e=="string"){const n=e.replace("px","");if(!Number.isNaN(Number(n)))return`${Number(n)/16}${t}`}return e}}const pn=Mae("rem"),_L=Mae("em");function Zr({size:t,sizes:e,units:n}){return t in e?e[t]:typeof t=="number"?n==="em"?_L(t):pn(t):t||e.md}function b1(t){return typeof t=="number"?t:typeof t=="string"&&t.includes("rem")?Number(t.replace("rem",""))*16:typeof t=="string"&&t.includes("em")?Number(t.replace("em",""))*16:Number(t)}function lZe(t){return e=>`@media (min-width: ${_L(b1(Zr({size:e,sizes:t.breakpoints})))})`}function uZe(t){return e=>`@media (max-width: ${_L(b1(Zr({size:e,sizes:t.breakpoints}))-1)})`}function cZe(t){return/^#?([0-9A-F]{3}){1,2}$/i.test(t)}function fZe(t){let e=t.replace("#","");if(e.length===3){const a=e.split("");e=[a[0],a[0],a[1],a[1],a[2],a[2]].join("")}const n=parseInt(e,16),r=n>>16&255,i=n>>8&255,o=n&255;return{r,g:i,b:o,a:1}}function hZe(t){const[e,n,r,i]=t.replace(/[^0-9,.]/g,"").split(",").map(Number);return{r:e,g:n,b:r,a:i||1}}function LU(t){return cZe(t)?fZe(t):t.startsWith("rgb")?hZe(t):{r:0,g:0,b:0,a:1}}function zy(t,e){if(typeof t!="string"||e>1||e<0)return"rgba(0, 0, 0, 1)";if(t.startsWith("var(--"))return t;const{r:n,g:r,b:i}=LU(t);return`rgba(${n}, ${r}, ${i}, ${e})`}function dZe(t=0){return{position:"absolute",top:pn(t),right:pn(t),left:pn(t),bottom:pn(t)}}function pZe(t,e){if(typeof t=="string"&&t.startsWith("var(--"))return t;const{r:n,g:r,b:i,a:o}=LU(t),a=1-e,s=u=>Math.round(u*a);return`rgba(${s(n)}, ${s(r)}, ${s(i)}, ${o})`}function gZe(t,e){if(typeof t=="string"&&t.startsWith("var(--"))return t;const{r:n,g:r,b:i,a:o}=LU(t),a=s=>Math.round(s+(255-s)*e);return`rgba(${a(n)}, ${a(r)}, ${a(i)}, ${o})`}function mZe(t){return e=>{if(typeof e=="number")return pn(e);const n=typeof t.defaultRadius=="number"?t.defaultRadius:t.radius[t.defaultRadius]||t.defaultRadius;return t.radius[e]||e||n}}function AZe(t,e){if(typeof t=="string"&&t.includes(".")){const[n,r]=t.split("."),i=parseInt(r,10);if(n in e.colors&&i>=0&&i<10)return{isSplittedColor:!0,key:n,shade:i}}return{isSplittedColor:!1}}function _Ze(t){const e=RU(t),n=f2(t),r=Iae(t);return({variant:i,color:o,gradient:a,primaryFallback:s})=>{const u=AZe(o,t);switch(i){case"light":return{border:"transparent",background:zy(e(o,t.colorScheme==="dark"?8:0,s,!1),t.colorScheme==="dark"?.2:1),color:o==="dark"?t.colorScheme==="dark"?t.colors.dark[0]:t.colors.dark[9]:e(o,t.colorScheme==="dark"?2:n("light")),hover:zy(e(o,t.colorScheme==="dark"?7:1,s,!1),t.colorScheme==="dark"?.25:.65)};case"subtle":return{border:"transparent",background:"transparent",color:o==="dark"?t.colorScheme==="dark"?t.colors.dark[0]:t.colors.dark[9]:e(o,t.colorScheme==="dark"?2:n("light")),hover:zy(e(o,t.colorScheme==="dark"?8:0,s,!1),t.colorScheme==="dark"?.2:1)};case"outline":return{border:e(o,t.colorScheme==="dark"?5:n("light")),background:"transparent",color:e(o,t.colorScheme==="dark"?5:n("light")),hover:t.colorScheme==="dark"?zy(e(o,5,s,!1),.05):zy(e(o,0,s,!1),.35)};case"default":return{border:t.colorScheme==="dark"?t.colors.dark[4]:t.colors.gray[4],background:t.colorScheme==="dark"?t.colors.dark[6]:t.white,color:t.colorScheme==="dark"?t.white:t.black,hover:t.colorScheme==="dark"?t.colors.dark[5]:t.colors.gray[0]};case"white":return{border:"transparent",background:t.white,color:e(o,n()),hover:null};case"transparent":return{border:"transparent",color:o==="dark"?t.colorScheme==="dark"?t.colors.dark[0]:t.colors.dark[9]:e(o,t.colorScheme==="dark"?2:n("light")),background:"transparent",hover:null};case"gradient":return{background:r(a),color:t.white,border:"transparent",hover:null};default:{const d=n(),g=u.isSplittedColor?u.shade:d,_=u.isSplittedColor?u.key:o;return{border:"transparent",background:e(_,g,s),color:t.white,hover:e(_,g===9?8:g+1)}}}}}function yZe(t){return e=>{const n=f2(t)(e);return t.colors[t.primaryColor][n]}}function vZe(t){return{"@media (hover: hover)":{"&:hover":t},"@media (hover: none)":{"&:active":t}}}function xZe(t){return()=>({userSelect:"none",color:t.colorScheme==="dark"?t.colors.dark[3]:t.colors.gray[5]})}function bZe(t){return()=>t.colorScheme==="dark"?t.colors.dark[2]:t.colors.gray[6]}const Js={fontStyles:tZe,themeColor:RU,focusStyles:oZe,linearGradient:sZe,radialGradient:aZe,smallerThan:uZe,largerThan:lZe,rgba:zy,cover:dZe,darken:pZe,lighten:gZe,radius:mZe,variant:_Ze,primaryShade:f2,hover:vZe,gradient:Iae,primaryColor:yZe,placeholderStyles:xZe,dimmed:bZe};var wZe=Object.defineProperty,EZe=Object.defineProperties,SZe=Object.getOwnPropertyDescriptors,aZ=Object.getOwnPropertySymbols,TZe=Object.prototype.hasOwnProperty,CZe=Object.prototype.propertyIsEnumerable,lZ=(t,e,n)=>e in t?wZe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,PZe=(t,e)=>{for(var n in e||(e={}))TZe.call(e,n)&&lZ(t,n,e[n]);if(aZ)for(var n of aZ(e))CZe.call(e,n)&&lZ(t,n,e[n]);return t},IZe=(t,e)=>EZe(t,SZe(e));function Oae(t){return IZe(PZe({},t),{fn:{fontStyles:Js.fontStyles(t),themeColor:Js.themeColor(t),focusStyles:Js.focusStyles(t),largerThan:Js.largerThan(t),smallerThan:Js.smallerThan(t),radialGradient:Js.radialGradient,linearGradient:Js.linearGradient,gradient:Js.gradient(t),rgba:Js.rgba,cover:Js.cover,lighten:Js.lighten,darken:Js.darken,primaryShade:Js.primaryShade(t),radius:Js.radius(t),variant:Js.variant(t),hover:Js.hover,primaryColor:Js.primaryColor(t),placeholderStyles:Js.placeholderStyles(t),dimmed:Js.dimmed(t)}})}const MZe={dir:"ltr",primaryShade:{light:6,dark:8},focusRing:"auto",loader:"oval",colorScheme:"light",white:"#fff",black:"#000",defaultRadius:"sm",transitionTimingFunction:"ease",colors:eZe,lineHeight:1.55,fontFamily:"-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji",fontFamilyMonospace:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace",primaryColor:"blue",respectReducedMotion:!0,cursorType:"default",defaultGradient:{from:"indigo",to:"cyan",deg:45},shadows:{xs:"0 0.0625rem 0.1875rem rgba(0, 0, 0, 0.05), 0 0.0625rem 0.125rem rgba(0, 0, 0, 0.1)",sm:"0 0.0625rem 0.1875rem rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 0.625rem 0.9375rem -0.3125rem, rgba(0, 0, 0, 0.04) 0 0.4375rem 0.4375rem -0.3125rem",md:"0 0.0625rem 0.1875rem rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 1.25rem 1.5625rem -0.3125rem, rgba(0, 0, 0, 0.04) 0 0.625rem 0.625rem -0.3125rem",lg:"0 0.0625rem 0.1875rem rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 1.75rem 1.4375rem -0.4375rem, rgba(0, 0, 0, 0.04) 0 0.75rem 0.75rem -0.4375rem",xl:"0 0.0625rem 0.1875rem rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 2.25rem 1.75rem -0.4375rem, rgba(0, 0, 0, 0.04) 0 1.0625rem 1.0625rem -0.4375rem"},fontSizes:{xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem"},radius:{xs:"0.125rem",sm:"0.25rem",md:"0.5rem",lg:"1rem",xl:"2rem"},spacing:{xs:"0.625rem",sm:"0.75rem",md:"1rem",lg:"1.25rem",xl:"1.5rem"},breakpoints:{xs:"36em",sm:"48em",md:"62em",lg:"75em",xl:"88em"},headings:{fontFamily:"-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji",fontWeight:700,sizes:{h1:{fontSize:"2.125rem",lineHeight:1.3,fontWeight:void 0},h2:{fontSize:"1.625rem",lineHeight:1.35,fontWeight:void 0},h3:{fontSize:"1.375rem",lineHeight:1.4,fontWeight:void 0},h4:{fontSize:"1.125rem",lineHeight:1.45,fontWeight:void 0},h5:{fontSize:"1rem",lineHeight:1.5,fontWeight:void 0},h6:{fontSize:"0.875rem",lineHeight:1.5,fontWeight:void 0}}},other:{},components:{},activeStyles:{transform:"translateY(0.0625rem)"},datesLocale:"en",globalStyles:void 0,focusRingStyles:{styles:t=>({outlineOffset:"0.125rem",outline:`0.125rem solid ${t.colors[t.primaryColor][t.colorScheme==="dark"?7:5]}`}),resetStyles:()=>({outline:"none"}),inputStyles:t=>({outline:"none",borderColor:t.colors[t.primaryColor][typeof t.primaryShade=="object"?t.primaryShade[t.colorScheme]:t.primaryShade]})}},DU=Oae(MZe);function OZe(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}function RZe(t){var e=document.createElement("style");return e.setAttribute("data-emotion",t.key),t.nonce!==void 0&&e.setAttribute("nonce",t.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var LZe=function(){function t(n){var r=this;this._insertTag=function(i){var o;r.tags.length===0?r.insertionPoint?o=r.insertionPoint.nextSibling:r.prepend?o=r.container.firstChild:o=r.before:o=r.tags[r.tags.length-1].nextSibling,r.container.insertBefore(i,o),r.tags.push(i)},this.isSpeedy=n.speedy===void 0?!0:n.speedy,this.tags=[],this.ctr=0,this.nonce=n.nonce,this.key=n.key,this.container=n.container,this.prepend=n.prepend,this.insertionPoint=n.insertionPoint,this.before=null}var e=t.prototype;return e.hydrate=function(r){r.forEach(this._insertTag)},e.insert=function(r){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(RZe(this));var i=this.tags[this.tags.length-1];if(this.isSpeedy){var o=OZe(i);try{o.insertRule(r,o.cssRules.length)}catch{}}else i.appendChild(document.createTextNode(r));this.ctr++},e.flush=function(){this.tags.forEach(function(r){return r.parentNode&&r.parentNode.removeChild(r)}),this.tags=[],this.ctr=0},t}(),Al="-ms-",uM="-moz-",ki="-webkit-",Rae="comm",BU="rule",NU="decl",DZe="@import",Lae="@keyframes",BZe="@layer",NZe=Math.abs,yL=String.fromCharCode,FZe=Object.assign;function kZe(t,e){return Wa(t,0)^45?(((e<<2^Wa(t,0))<<2^Wa(t,1))<<2^Wa(t,2))<<2^Wa(t,3):0}function Dae(t){return t.trim()}function zZe(t,e){return(t=e.exec(t))?t[0]:t}function Ui(t,e,n){return t.replace(e,n)}function N4(t,e){return t.indexOf(e)}function Wa(t,e){return t.charCodeAt(e)|0}function pE(t,e,n){return t.slice(e,n)}function Td(t){return t.length}function FU(t){return t.length}function xT(t,e){return e.push(t),t}function UZe(t,e){return t.map(e).join("")}var vL=1,w1=1,Bae=0,zu=0,js=0,Z1="";function xL(t,e,n,r,i,o,a){return{value:t,root:e,parent:n,type:r,props:i,children:o,line:vL,column:w1,length:a,return:""}}function Ob(t,e){return FZe(xL("",null,null,"",null,null,0),t,{length:-t.length},e)}function GZe(){return js}function jZe(){return js=zu>0?Wa(Z1,--zu):0,w1--,js===10&&(w1=1,vL--),js}function _c(){return js=zu<Bae?Wa(Z1,zu++):0,w1++,js===10&&(w1=1,vL++),js}function Ud(){return Wa(Z1,zu)}function dP(){return zu}function h2(t,e){return pE(Z1,t,e)}function gE(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Nae(t){return vL=w1=1,Bae=Td(Z1=t),zu=0,[]}function Fae(t){return Z1="",t}function pP(t){return Dae(h2(zu-1,F4(t===91?t+2:t===40?t+1:t)))}function VZe(t){for(;(js=Ud())&&js<33;)_c();return gE(t)>2||gE(js)>3?"":" "}function $Ze(t,e){for(;--e&&_c()&&!(js<48||js>102||js>57&&js<65||js>70&&js<97););return h2(t,dP()+(e<6&&Ud()==32&&_c()==32))}function F4(t){for(;_c();)switch(js){case t:return zu;case 34:case 39:t!==34&&t!==39&&F4(js);break;case 40:t===41&&F4(t);break;case 92:_c();break}return zu}function HZe(t,e){for(;_c()&&t+js!==47+10;)if(t+js===42+42&&Ud()===47)break;return"/*"+h2(e,zu-1)+"*"+yL(t===47?t:_c())}function WZe(t){for(;!gE(Ud());)_c();return h2(t,zu)}function qZe(t){return Fae(gP("",null,null,null,[""],t=Nae(t),0,[0],t))}function gP(t,e,n,r,i,o,a,s,u){for(var d=0,g=0,_=a,E=0,P=0,R=0,B=1,V=1,z=1,F=0,k="",X=i,Y=o,J=r,ie=k;V;)switch(R=F,F=_c()){case 40:if(R!=108&&Wa(ie,_-1)==58){N4(ie+=Ui(pP(F),"&","&\f"),"&\f")!=-1&&(z=-1);break}case 34:case 39:case 91:ie+=pP(F);break;case 9:case 10:case 13:case 32:ie+=VZe(R);break;case 92:ie+=$Ze(dP()-1,7);continue;case 47:switch(Ud()){case 42:case 47:xT(XZe(HZe(_c(),dP()),e,n),u);break;default:ie+="/"}break;case 123*B:s[d++]=Td(ie)*z;case 125*B:case 59:case 0:switch(F){case 0:case 125:V=0;case 59+g:z==-1&&(ie=Ui(ie,/\f/g,"")),P>0&&Td(ie)-_&&xT(P>32?cZ(ie+";",r,n,_-1):cZ(Ui(ie," ","")+";",r,n,_-2),u);break;case 59:ie+=";";default:if(xT(J=uZ(ie,e,n,d,g,i,s,k,X=[],Y=[],_),o),F===123)if(g===0)gP(ie,e,J,J,X,o,_,s,Y);else switch(E===99&&Wa(ie,3)===110?100:E){case 100:case 108:case 109:case 115:gP(t,J,J,r&&xT(uZ(t,J,J,0,0,i,s,k,i,X=[],_),Y),i,Y,_,s,r?X:Y);break;default:gP(ie,J,J,J,[""],Y,0,s,Y)}}d=g=P=0,B=z=1,k=ie="",_=a;break;case 58:_=1+Td(ie),P=R;default:if(B<1){if(F==123)--B;else if(F==125&&B++==0&&jZe()==125)continue}switch(ie+=yL(F),F*B){case 38:z=g>0?1:(ie+="\f",-1);break;case 44:s[d++]=(Td(ie)-1)*z,z=1;break;case 64:Ud()===45&&(ie+=pP(_c())),E=Ud(),g=_=Td(k=ie+=WZe(dP())),F++;break;case 45:R===45&&Td(ie)==2&&(B=0)}}return o}function uZ(t,e,n,r,i,o,a,s,u,d,g){for(var _=i-1,E=i===0?o:[""],P=FU(E),R=0,B=0,V=0;R<r;++R)for(var z=0,F=pE(t,_+1,_=NZe(B=a[R])),k=t;z<P;++z)(k=Dae(B>0?E[z]+" "+F:Ui(F,/&\f/g,E[z])))&&(u[V++]=k);return xL(t,e,n,i===0?BU:s,u,d,g)}function XZe(t,e,n){return xL(t,e,n,Rae,yL(GZe()),pE(t,2,-2),0)}function cZ(t,e,n,r){return xL(t,e,n,NU,pE(t,0,r),pE(t,r+1,-1),r)}function wv(t,e){for(var n="",r=FU(t),i=0;i<r;i++)n+=e(t[i],i,t,e)||"";return n}function ZZe(t,e,n,r){switch(t.type){case BZe:if(t.children.length)break;case DZe:case NU:return t.return=t.return||t.value;case Rae:return"";case Lae:return t.return=t.value+"{"+wv(t.children,r)+"}";case BU:t.value=t.props.join(",")}return Td(n=wv(t.children,r))?t.return=t.value+"{"+n+"}":""}function YZe(t){var e=FU(t);return function(n,r,i,o){for(var a="",s=0;s<e;s++)a+=t[s](n,r,i,o)||"";return a}}function QZe(t){return function(e){e.root||(e=e.return)&&t(e)}}var fZ=function(e){var n=new WeakMap;return function(r){if(n.has(r))return n.get(r);var i=e(r);return n.set(r,i),i}};function KZe(t){var e=Object.create(null);return function(n){return e[n]===void 0&&(e[n]=t(n)),e[n]}}var JZe=function(e,n,r){for(var i=0,o=0;i=o,o=Ud(),i===38&&o===12&&(n[r]=1),!gE(o);)_c();return h2(e,zu)},eYe=function(e,n){var r=-1,i=44;do switch(gE(i)){case 0:i===38&&Ud()===12&&(n[r]=1),e[r]+=JZe(zu-1,n,r);break;case 2:e[r]+=pP(i);break;case 4:if(i===44){e[++r]=Ud()===58?"&\f":"",n[r]=e[r].length;break}default:e[r]+=yL(i)}while(i=_c());return e},tYe=function(e,n){return Fae(eYe(Nae(e),n))},hZ=new WeakMap,nYe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var n=e.value,r=e.parent,i=e.column===r.column&&e.line===r.line;r.type!=="rule";)if(r=r.parent,!r)return;if(!(e.props.length===1&&n.charCodeAt(0)!==58&&!hZ.get(r))&&!i){hZ.set(e,!0);for(var o=[],a=tYe(n,o),s=r.props,u=0,d=0;u<a.length;u++)for(var g=0;g<s.length;g++,d++)e.props[d]=o[u]?a[u].replace(/&\f/g,s[g]):s[g]+" "+a[u]}}},rYe=function(e){if(e.type==="decl"){var n=e.value;n.charCodeAt(0)===108&&n.charCodeAt(2)===98&&(e.return="",e.value="")}};function kae(t,e){switch(kZe(t,e)){case 5103:return ki+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ki+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return ki+t+uM+t+Al+t+t;case 6828:case 4268:return ki+t+Al+t+t;case 6165:return ki+t+Al+"flex-"+t+t;case 5187:return ki+t+Ui(t,/(\w+).+(:[^]+)/,ki+"box-$1$2"+Al+"flex-$1$2")+t;case 5443:return ki+t+Al+"flex-item-"+Ui(t,/flex-|-self/,"")+t;case 4675:return ki+t+Al+"flex-line-pack"+Ui(t,/align-content|flex-|-self/,"")+t;case 5548:return ki+t+Al+Ui(t,"shrink","negative")+t;case 5292:return ki+t+Al+Ui(t,"basis","preferred-size")+t;case 6060:return ki+"box-"+Ui(t,"-grow","")+ki+t+Al+Ui(t,"grow","positive")+t;case 4554:return ki+Ui(t,/([^-])(transform)/g,"$1"+ki+"$2")+t;case 6187:return Ui(Ui(Ui(t,/(zoom-|grab)/,ki+"$1"),/(image-set)/,ki+"$1"),t,"")+t;case 5495:case 3959:return Ui(t,/(image-set\([^]*)/,ki+"$1$`$1");case 4968:return Ui(Ui(t,/(.+:)(flex-)?(.*)/,ki+"box-pack:$3"+Al+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ki+t+t;case 4095:case 3583:case 4068:case 2532:return Ui(t,/(.+)-inline(.+)/,ki+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Td(t)-1-e>6)switch(Wa(t,e+1)){case 109:if(Wa(t,e+4)!==45)break;case 102:return Ui(t,/(.+:)(.+)-([^]+)/,"$1"+ki+"$2-$3$1"+uM+(Wa(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~N4(t,"stretch")?kae(Ui(t,"stretch","fill-available"),e)+t:t}break;case 4949:if(Wa(t,e+1)!==115)break;case 6444:switch(Wa(t,Td(t)-3-(~N4(t,"!important")&&10))){case 107:return Ui(t,":",":"+ki)+t;case 101:return Ui(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ki+(Wa(t,14)===45?"inline-":"")+"box$3$1"+ki+"$2$3$1"+Al+"$2box$3")+t}break;case 5936:switch(Wa(t,e+11)){case 114:return ki+t+Al+Ui(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return ki+t+Al+Ui(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return ki+t+Al+Ui(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return ki+t+Al+t+t}return t}var iYe=function(e,n,r,i){if(e.length>-1&&!e.return)switch(e.type){case NU:e.return=kae(e.value,e.length);break;case Lae:return wv([Ob(e,{value:Ui(e.value,"@","@"+ki)})],i);case BU:if(e.length)return UZe(e.props,function(o){switch(zZe(o,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return wv([Ob(e,{props:[Ui(o,/:(read-\w+)/,":"+uM+"$1")]})],i);case"::placeholder":return wv([Ob(e,{props:[Ui(o,/:(plac\w+)/,":"+ki+"input-$1")]}),Ob(e,{props:[Ui(o,/:(plac\w+)/,":"+uM+"$1")]}),Ob(e,{props:[Ui(o,/:(plac\w+)/,Al+"input-$1")]})],i)}return""})}},oYe=[iYe],zae=function(e){var n=e.key;if(n==="css"){var r=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(r,function(B){var V=B.getAttribute("data-emotion");V.indexOf(" ")!==-1&&(document.head.appendChild(B),B.setAttribute("data-s",""))})}var i=e.stylisPlugins||oYe,o={},a,s=[];a=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+n+' "]'),function(B){for(var V=B.getAttribute("data-emotion").split(" "),z=1;z<V.length;z++)o[V[z]]=!0;s.push(B)});var u,d=[nYe,rYe];{var g,_=[ZZe,QZe(function(B){g.insert(B)})],E=YZe(d.concat(i,_)),P=function(V){return wv(qZe(V),E)};u=function(V,z,F,k){g=F,P(V?V+"{"+z.styles+"}":z.styles),k&&(R.inserted[z.name]=!0)}}var R={key:n,sheet:new LZe({key:n,container:a,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:o,registered:{},insert:u};return R.sheet.hydrate(s),R};function k4(){return k4=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},k4.apply(this,arguments)}var Uae={exports:{}},to={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Na=typeof Symbol=="function"&&Symbol.for,kU=Na?Symbol.for("react.element"):60103,zU=Na?Symbol.for("react.portal"):60106,bL=Na?Symbol.for("react.fragment"):60107,wL=Na?Symbol.for("react.strict_mode"):60108,EL=Na?Symbol.for("react.profiler"):60114,SL=Na?Symbol.for("react.provider"):60109,TL=Na?Symbol.for("react.context"):60110,UU=Na?Symbol.for("react.async_mode"):60111,CL=Na?Symbol.for("react.concurrent_mode"):60111,PL=Na?Symbol.for("react.forward_ref"):60112,IL=Na?Symbol.for("react.suspense"):60113,sYe=Na?Symbol.for("react.suspense_list"):60120,ML=Na?Symbol.for("react.memo"):60115,OL=Na?Symbol.for("react.lazy"):60116,aYe=Na?Symbol.for("react.block"):60121,lYe=Na?Symbol.for("react.fundamental"):60117,uYe=Na?Symbol.for("react.responder"):60118,cYe=Na?Symbol.for("react.scope"):60119;function Nc(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case kU:switch(t=t.type,t){case UU:case CL:case bL:case EL:case wL:case IL:return t;default:switch(t=t&&t.$$typeof,t){case TL:case PL:case OL:case ML:case SL:return t;default:return e}}case zU:return e}}}function Gae(t){return Nc(t)===CL}to.AsyncMode=UU;to.ConcurrentMode=CL;to.ContextConsumer=TL;to.ContextProvider=SL;to.Element=kU;to.ForwardRef=PL;to.Fragment=bL;to.Lazy=OL;to.Memo=ML;to.Portal=zU;to.Profiler=EL;to.StrictMode=wL;to.Suspense=IL;to.isAsyncMode=function(t){return Gae(t)||Nc(t)===UU};to.isConcurrentMode=Gae;to.isContextConsumer=function(t){return Nc(t)===TL};to.isContextProvider=function(t){return Nc(t)===SL};to.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===kU};to.isForwardRef=function(t){return Nc(t)===PL};to.isFragment=function(t){return Nc(t)===bL};to.isLazy=function(t){return Nc(t)===OL};to.isMemo=function(t){return Nc(t)===ML};to.isPortal=function(t){return Nc(t)===zU};to.isProfiler=function(t){return Nc(t)===EL};to.isStrictMode=function(t){return Nc(t)===wL};to.isSuspense=function(t){return Nc(t)===IL};to.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===bL||t===CL||t===EL||t===wL||t===IL||t===sYe||typeof t=="object"&&t!==null&&(t.$$typeof===OL||t.$$typeof===ML||t.$$typeof===SL||t.$$typeof===TL||t.$$typeof===PL||t.$$typeof===lYe||t.$$typeof===uYe||t.$$typeof===cYe||t.$$typeof===aYe)};to.typeOf=Nc;Uae.exports=to;var fYe=Uae.exports,jae=fYe,hYe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},dYe={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Vae={};Vae[jae.ForwardRef]=hYe;Vae[jae.Memo]=dYe;var pYe=!0;function gYe(t,e,n){var r="";return n.split(" ").forEach(function(i){t[i]!==void 0?e.push(t[i]+";"):r+=i+" "}),r}var mYe=function(e,n,r){var i=e.key+"-"+n.name;(r===!1||pYe===!1)&&e.registered[i]===void 0&&(e.registered[i]=n.styles)},$ae=function(e,n,r){mYe(e,n,r);var i=e.key+"-"+n.name;if(e.inserted[n.name]===void 0){var o=n;do e.insert(n===o?"."+i:"",o,e.sheet,!0),o=o.next;while(o!==void 0)}};function AYe(t){for(var e=0,n,r=0,i=t.length;i>=4;++r,i-=4)n=t.charCodeAt(r)&255|(t.charCodeAt(++r)&255)<<8|(t.charCodeAt(++r)&255)<<16|(t.charCodeAt(++r)&255)<<24,n=(n&65535)*1540483477+((n>>>16)*59797<<16),n^=n>>>24,e=(n&65535)*1540483477+((n>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(i){case 3:e^=(t.charCodeAt(r+2)&255)<<16;case 2:e^=(t.charCodeAt(r+1)&255)<<8;case 1:e^=t.charCodeAt(r)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var _Ye={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},yYe=/[A-Z]|^ms/g,vYe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Hae=function(e){return e.charCodeAt(1)===45},dZ=function(e){return e!=null&&typeof e!="boolean"},sN=KZe(function(t){return Hae(t)?t:t.replace(yYe,"-$&").toLowerCase()}),pZ=function(e,n){switch(e){case"animation":case"animationName":if(typeof n=="string")return n.replace(vYe,function(r,i,o){return Cd={name:i,styles:o,next:Cd},i})}return _Ye[e]!==1&&!Hae(e)&&typeof n=="number"&&n!==0?n+"px":n};function mE(t,e,n){if(n==null)return"";if(n.__emotion_styles!==void 0)return n;switch(typeof n){case"boolean":return"";case"object":{if(n.anim===1)return Cd={name:n.name,styles:n.styles,next:Cd},n.name;if(n.styles!==void 0){var r=n.next;if(r!==void 0)for(;r!==void 0;)Cd={name:r.name,styles:r.styles,next:Cd},r=r.next;var i=n.styles+";";return i}return xYe(t,e,n)}case"function":{if(t!==void 0){var o=Cd,a=n(t);return Cd=o,mE(t,e,a)}break}}if(e==null)return n;var s=e[n];return s!==void 0?s:n}function xYe(t,e,n){var r="";if(Array.isArray(n))for(var i=0;i<n.length;i++)r+=mE(t,e,n[i])+";";else for(var o in n){var a=n[o];if(typeof a!="object")e!=null&&e[a]!==void 0?r+=o+"{"+e[a]+"}":dZ(a)&&(r+=sN(o)+":"+pZ(o,a)+";");else if(Array.isArray(a)&&typeof a[0]=="string"&&(e==null||e[a[0]]===void 0))for(var s=0;s<a.length;s++)dZ(a[s])&&(r+=sN(o)+":"+pZ(o,a[s])+";");else{var u=mE(t,e,a);switch(o){case"animation":case"animationName":{r+=sN(o)+":"+u+";";break}default:r+=o+"{"+u+"}"}}}return r}var gZ=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Cd,GU=function(e,n,r){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var i=!0,o="";Cd=void 0;var a=e[0];a==null||a.raw===void 0?(i=!1,o+=mE(r,n,a)):o+=a[0];for(var s=1;s<e.length;s++)o+=mE(r,n,e[s]),i&&(o+=a[s]);gZ.lastIndex=0;for(var u="",d;(d=gZ.exec(o))!==null;)u+="-"+d[1];var g=AYe(o)+u;return{name:g,styles:o,next:Cd}},bYe=wP["useInsertionEffect"]?wP["useInsertionEffect"]:!1,mZ=bYe||we.useLayoutEffect,Wae=we.createContext(typeof HTMLElement<"u"?zae({key:"css"}):null);Wae.Provider;var wYe=function(e){return we.forwardRef(function(n,r){var i=we.useContext(Wae);return e(n,i,r)})},z4=we.createContext({}),EYe=function(e,n){if(typeof n=="function"){var r=n(e);return r}return k4({},e,n)},SYe=fZ(function(t){return fZ(function(e){return EYe(t,e)})}),TYe=function(e){var n=we.useContext(z4);return e.theme!==n&&(n=SYe(n)(e.theme)),we.createElement(z4.Provider,{value:n},e.children)},RL=wYe(function(t,e){var n=t.styles,r=GU([n],void 0,we.useContext(z4)),i=we.useRef();return mZ(function(){var o=e.key+"-global",a=new e.sheet.constructor({key:o,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),s=!1,u=document.querySelector('style[data-emotion="'+o+" "+r.name+'"]');return e.sheet.tags.length&&(a.before=e.sheet.tags[0]),u!==null&&(s=!0,u.setAttribute("data-emotion",o),a.hydrate([u])),i.current=[a,s],function(){a.flush()}},[e]),mZ(function(){var o=i.current,a=o[0],s=o[1];if(s){o[1]=!1;return}if(r.next!==void 0&&$ae(e,r.next,!0),a.tags.length){var u=a.tags[a.tags.length-1].nextElementSibling;a.before=u,a.flush()}e.insert("",r,a,!1)},[e,r.name]),null});function CYe(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return GU(e)}var PYe=function(){var e=CYe.apply(void 0,arguments),n="animation-"+e.name;return{name:n,styles:"@keyframes "+n+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},IYe=Object.defineProperty,MYe=Object.defineProperties,OYe=Object.getOwnPropertyDescriptors,AZ=Object.getOwnPropertySymbols,RYe=Object.prototype.hasOwnProperty,LYe=Object.prototype.propertyIsEnumerable,_Z=(t,e,n)=>e in t?IYe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,DYe=(t,e)=>{for(var n in e||(e={}))RYe.call(e,n)&&_Z(t,n,e[n]);if(AZ)for(var n of AZ(e))LYe.call(e,n)&&_Z(t,n,e[n]);return t},BYe=(t,e)=>MYe(t,OYe(e));function NYe({theme:t}){return ut.createElement(RL,{styles:{"*, *::before, *::after":{boxSizing:"border-box"},html:{colorScheme:t.colorScheme==="dark"?"dark":"light"},body:BYe(DYe({},t.fn.fontStyles()),{backgroundColor:t.colorScheme==="dark"?t.colors.dark[7]:t.white,color:t.colorScheme==="dark"?t.colors.dark[0]:t.black,lineHeight:t.lineHeight,fontSize:t.fontSizes.md,WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale"})}})}function Rb(t,e,n,r=pn){Object.keys(e).forEach(i=>{t[`--mantine-${n}-${i}`]=r(e[i])})}function FYe({theme:t}){const e={"--mantine-color-white":t.white,"--mantine-color-black":t.black,"--mantine-transition-timing-function":t.transitionTimingFunction,"--mantine-line-height":`${t.lineHeight}`,"--mantine-font-family":t.fontFamily,"--mantine-font-family-monospace":t.fontFamilyMonospace,"--mantine-font-family-headings":t.headings.fontFamily,"--mantine-heading-font-weight":`${t.headings.fontWeight}`};Rb(e,t.shadows,"shadow"),Rb(e,t.fontSizes,"font-size"),Rb(e,t.radius,"radius"),Rb(e,t.spacing,"spacing"),Rb(e,t.breakpoints,"breakpoints",_L),Object.keys(t.colors).forEach(r=>{t.colors[r].forEach((i,o)=>{e[`--mantine-color-${r}-${o}`]=i})});const n=t.headings.sizes;return Object.keys(n).forEach(r=>{e[`--mantine-${r}-font-size`]=n[r].fontSize,e[`--mantine-${r}-line-height`]=`${n[r].lineHeight}`}),ut.createElement(RL,{styles:{":root":e}})}var kYe=Object.defineProperty,zYe=Object.defineProperties,UYe=Object.getOwnPropertyDescriptors,yZ=Object.getOwnPropertySymbols,GYe=Object.prototype.hasOwnProperty,jYe=Object.prototype.propertyIsEnumerable,vZ=(t,e,n)=>e in t?kYe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_d=(t,e)=>{for(var n in e||(e={}))GYe.call(e,n)&&vZ(t,n,e[n]);if(yZ)for(var n of yZ(e))jYe.call(e,n)&&vZ(t,n,e[n]);return t},aN=(t,e)=>zYe(t,UYe(e));function VYe(t,e){var n;if(!e)return t;const r=Object.keys(t).reduce((i,o)=>{if(o==="headings"&&e.headings){const a=e.headings.sizes?Object.keys(t.headings.sizes).reduce((s,u)=>(s[u]=_d(_d({},t.headings.sizes[u]),e.headings.sizes[u]),s),{}):t.headings.sizes;return aN(_d({},i),{headings:aN(_d(_d({},t.headings),e.headings),{sizes:a})})}if(o==="breakpoints"&&e.breakpoints){const a=_d(_d({},t.breakpoints),e.breakpoints);return aN(_d({},i),{breakpoints:Object.fromEntries(Object.entries(a).sort((s,u)=>b1(s[1])-b1(u[1])))})}return i[o]=typeof e[o]=="object"?_d(_d({},t[o]),e[o]):typeof e[o]=="number"||typeof e[o]=="boolean"||typeof e[o]=="function"?e[o]:e[o]||t[o],i},{});if(e!=null&&e.fontFamily&&!((n=e==null?void 0:e.headings)!=null&&n.fontFamily)&&(r.headings.fontFamily=e.fontFamily),!(r.primaryColor in r.colors))throw new Error("MantineProvider: Invalid theme.primaryColor, it accepts only key of theme.colors, learn more – https://mantine.dev/theming/colors/#primary-color");return r}function $Ye(t,e){return Oae(VYe(t,e))}function qae(t){return Object.keys(t).reduce((e,n)=>(t[n]!==void 0&&(e[n]=t[n]),e),{})}const HYe={html:{fontFamily:"sans-serif",lineHeight:"1.15",textSizeAdjust:"100%"},body:{margin:0},"article, aside, footer, header, nav, section, figcaption, figure, main":{display:"block"},h1:{fontSize:"2em"},hr:{boxSizing:"content-box",height:0,overflow:"visible"},pre:{fontFamily:"monospace, monospace",fontSize:"1em"},a:{background:"transparent",textDecorationSkip:"objects"},"a:active, a:hover":{outlineWidth:0},"abbr[title]":{borderBottom:"none",textDecoration:"underline"},"b, strong":{fontWeight:"bolder"},"code, kbp, samp":{fontFamily:"monospace, monospace",fontSize:"1em"},dfn:{fontStyle:"italic"},mark:{backgroundColor:"#ff0",color:"#000"},small:{fontSize:"80%"},"sub, sup":{fontSize:"75%",lineHeight:0,position:"relative",verticalAlign:"baseline"},sup:{top:"-0.5em"},sub:{bottom:"-0.25em"},"audio, video":{display:"inline-block"},"audio:not([controls])":{display:"none",height:0},img:{borderStyle:"none",verticalAlign:"middle"},"svg:not(:root)":{overflow:"hidden"},"button, input, optgroup, select, textarea":{fontFamily:"sans-serif",fontSize:"100%",lineHeight:"1.15",margin:0},"button, input":{overflow:"visible"},"button, select":{textTransform:"none"},"button, [type=reset], [type=submit]":{WebkitAppearance:"button"},"button::-moz-focus-inner, [type=button]::-moz-focus-inner, [type=reset]::-moz-focus-inner, [type=submit]::-moz-focus-inner":{borderStyle:"none",padding:0},"button:-moz-focusring, [type=button]:-moz-focusring, [type=reset]:-moz-focusring, [type=submit]:-moz-focusring":{outline:`${pn(1)} dotted ButtonText`},legend:{boxSizing:"border-box",color:"inherit",display:"table",maxWidth:"100%",padding:0,whiteSpace:"normal"},progress:{display:"inline-block",verticalAlign:"baseline"},textarea:{overflow:"auto"},"[type=checkbox], [type=radio]":{boxSizing:"border-box",padding:0},"[type=number]::-webkit-inner-spin-button, [type=number]::-webkit-outer-spin-button":{height:"auto"},"[type=search]":{appearance:"none"},"[type=search]::-webkit-search-cancel-button, [type=search]::-webkit-search-decoration":{appearance:"none"},"::-webkit-file-upload-button":{appearance:"button",font:"inherit"},"details, menu":{display:"block"},summary:{display:"list-item"},canvas:{display:"inline-block"},template:{display:"none"}};function WYe(){return ut.createElement(RL,{styles:HYe})}var qYe=Object.defineProperty,xZ=Object.getOwnPropertySymbols,XYe=Object.prototype.hasOwnProperty,ZYe=Object.prototype.propertyIsEnumerable,bZ=(t,e,n)=>e in t?qYe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,mw=(t,e)=>{for(var n in e||(e={}))XYe.call(e,n)&&bZ(t,n,e[n]);if(xZ)for(var n of xZ(e))ZYe.call(e,n)&&bZ(t,n,e[n]);return t};const cM=we.createContext({theme:DU});function ip(){var t;return((t=we.useContext(cM))==null?void 0:t.theme)||DU}function YYe(t){const e=ip(),n=r=>{var i,o,a,s;return{styles:((i=e.components[r])==null?void 0:i.styles)||{},classNames:((o=e.components[r])==null?void 0:o.classNames)||{},variants:(a=e.components[r])==null?void 0:a.variants,sizes:(s=e.components[r])==null?void 0:s.sizes}};return Array.isArray(t)?t.map(n):[n(t)]}function Xae(){var t;return(t=we.useContext(cM))==null?void 0:t.emotionCache}function Gr(t,e,n){var r;const i=ip(),o=(r=i.components[t])==null?void 0:r.defaultProps,a=typeof o=="function"?o(i):o;return mw(mw(mw({},e),a),qae(n))}function U4({theme:t,emotionCache:e,withNormalizeCSS:n=!1,withGlobalStyles:r=!1,withCSSVariables:i=!1,inherit:o=!1,children:a}){const s=we.useContext(cM),u=$Ye(DU,o?mw(mw({},s.theme),t):t);return ut.createElement(TYe,{theme:u},ut.createElement(cM.Provider,{value:{theme:u,emotionCache:e}},n&&ut.createElement(WYe,null),r&&ut.createElement(NYe,{theme:u}),i&&ut.createElement(FYe,{theme:u}),typeof u.globalStyles=="function"&&ut.createElement(RL,{styles:u.globalStyles(u)}),a))}U4.displayName="@mantine/core/MantineProvider";const QYe={app:100,modal:200,popover:300,overlay:400,max:9999};function d2(t){return QYe[t]}function KYe(t,e){const n=we.useRef();return(!n.current||e.length!==n.current.prevDeps.length||n.current.prevDeps.map((r,i)=>r===e[i]).indexOf(!1)>=0)&&(n.current={v:t(),prevDeps:[...e]}),n.current.v}const JYe=zae({key:"mantine",prepend:!0});function eQe(){return Xae()||JYe}var tQe=Object.defineProperty,wZ=Object.getOwnPropertySymbols,nQe=Object.prototype.hasOwnProperty,rQe=Object.prototype.propertyIsEnumerable,EZ=(t,e,n)=>e in t?tQe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,iQe=(t,e)=>{for(var n in e||(e={}))nQe.call(e,n)&&EZ(t,n,e[n]);if(wZ)for(var n of wZ(e))rQe.call(e,n)&&EZ(t,n,e[n]);return t};const lN="ref";function oQe(t){let e;if(t.length!==1)return{args:t,ref:e};const[n]=t;if(!(n instanceof Object))return{args:t,ref:e};if(!(lN in n))return{args:t,ref:e};e=n[lN];const r=iQe({},n);return delete r[lN],{args:[r],ref:e}}const{cssFactory:sQe}=(()=>{function t(n,r,i){const o=[],a=gYe(n,o,i);return o.length<2?i:a+r(o)}function e(n){const{cache:r}=n,i=(...a)=>{const{ref:s,args:u}=oQe(a),d=GU(u,r.registered);return $ae(r,d,!1),`${r.key}-${d.name}${s===void 0?"":` ${s}`}`};return{css:i,cx:(...a)=>t(r.registered,i,Cae(a))}}return{cssFactory:e}})();function Zae(){const t=eQe();return KYe(()=>sQe({cache:t}),[t])}function aQe({cx:t,classes:e,context:n,classNames:r,name:i,cache:o}){const a=n.reduce((s,u)=>(Object.keys(u.classNames).forEach(d=>{typeof s[d]!="string"?s[d]=`${u.classNames[d]}`:s[d]=`${s[d]} ${u.classNames[d]}`}),s),{});return Object.keys(e).reduce((s,u)=>(s[u]=t(e[u],a[u],r!=null&&r[u],Array.isArray(i)?i.filter(Boolean).map(d=>`${(o==null?void 0:o.key)||"mantine"}-${d}-${u}`).join(" "):i?`${(o==null?void 0:o.key)||"mantine"}-${i}-${u}`:null),s),{})}var lQe=Object.defineProperty,SZ=Object.getOwnPropertySymbols,uQe=Object.prototype.hasOwnProperty,cQe=Object.prototype.propertyIsEnumerable,TZ=(t,e,n)=>e in t?lQe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,uN=(t,e)=>{for(var n in e||(e={}))uQe.call(e,n)&&TZ(t,n,e[n]);if(SZ)for(var n of SZ(e))cQe.call(e,n)&&TZ(t,n,e[n]);return t};function G4(t,e){return e&&Object.keys(e).forEach(n=>{t[n]?t[n]=uN(uN({},t[n]),e[n]):t[n]=uN({},e[n])}),t}function CZ(t,e,n,r){const i=o=>typeof o=="function"?o(e,n||{},r):o||{};return Array.isArray(t)?t.map(o=>i(o.styles)).reduce((o,a)=>G4(o,a),{}):i(t)}function fQe({ctx:t,theme:e,params:n,variant:r,size:i}){return t.reduce((o,a)=>(a.variants&&r in a.variants&&G4(o,a.variants[r](e,n,{variant:r,size:i})),a.sizes&&i in a.sizes&&G4(o,a.sizes[i](e,n,{variant:r,size:i})),o),{})}function no(t){const e=typeof t=="function"?t:()=>t;function n(r,i){const o=ip(),a=YYe(i==null?void 0:i.name),s=Xae(),u={variant:i==null?void 0:i.variant,size:i==null?void 0:i.size},{css:d,cx:g}=Zae(),_=e(o,r,u),E=CZ(i==null?void 0:i.styles,o,r,u),P=CZ(a,o,r,u),R=fQe({ctx:a,theme:o,params:r,variant:i==null?void 0:i.variant,size:i==null?void 0:i.size}),B=Object.fromEntries(Object.keys(_).map(V=>{const z=g({[d(_[V])]:!(i!=null&&i.unstyled)},d(R[V]),d(P[V]),d(E[V]));return[V,z]}));return{classes:aQe({cx:g,classes:B,context:a,classNames:i==null?void 0:i.classNames,name:i==null?void 0:i.name,cache:s}),cx:g,theme:o}}return n}function Lb(t){return`___ref-${t||""}`}var hQe=Object.defineProperty,dQe=Object.defineProperties,pQe=Object.getOwnPropertyDescriptors,PZ=Object.getOwnPropertySymbols,gQe=Object.prototype.hasOwnProperty,mQe=Object.prototype.propertyIsEnumerable,IZ=(t,e,n)=>e in t?hQe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Db=(t,e)=>{for(var n in e||(e={}))gQe.call(e,n)&&IZ(t,n,e[n]);if(PZ)for(var n of PZ(e))mQe.call(e,n)&&IZ(t,n,e[n]);return t},Bb=(t,e)=>dQe(t,pQe(e));const Nb={in:{opacity:1,transform:"scale(1)"},out:{opacity:0,transform:`scale(.9) translateY(${pn(10)})`},transitionProperty:"transform, opacity"},bT={fade:{in:{opacity:1},out:{opacity:0},transitionProperty:"opacity"},scale:{in:{opacity:1,transform:"scale(1)"},out:{opacity:0,transform:"scale(0)"},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"scale-y":{in:{opacity:1,transform:"scaleY(1)"},out:{opacity:0,transform:"scaleY(0)"},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"scale-x":{in:{opacity:1,transform:"scaleX(1)"},out:{opacity:0,transform:"scaleX(0)"},common:{transformOrigin:"left"},transitionProperty:"transform, opacity"},"skew-up":{in:{opacity:1,transform:"translateY(0) skew(0deg, 0deg)"},out:{opacity:0,transform:`translateY(-${pn(20)}) skew(-10deg, -5deg)`},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"skew-down":{in:{opacity:1,transform:"translateY(0) skew(0deg, 0deg)"},out:{opacity:0,transform:`translateY(${pn(20)}) skew(-10deg, -5deg)`},common:{transformOrigin:"bottom"},transitionProperty:"transform, opacity"},"rotate-left":{in:{opacity:1,transform:"translateY(0) rotate(0deg)"},out:{opacity:0,transform:`translateY(${pn(20)}) rotate(-5deg)`},common:{transformOrigin:"bottom"},transitionProperty:"transform, opacity"},"rotate-right":{in:{opacity:1,transform:"translateY(0) rotate(0deg)"},out:{opacity:0,transform:`translateY(${pn(20)}) rotate(5deg)`},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"slide-down":{in:{opacity:1,transform:"translateY(0)"},out:{opacity:0,transform:"translateY(-100%)"},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"slide-up":{in:{opacity:1,transform:"translateY(0)"},out:{opacity:0,transform:"translateY(100%)"},common:{transformOrigin:"bottom"},transitionProperty:"transform, opacity"},"slide-left":{in:{opacity:1,transform:"translateX(0)"},out:{opacity:0,transform:"translateX(100%)"},common:{transformOrigin:"left"},transitionProperty:"transform, opacity"},"slide-right":{in:{opacity:1,transform:"translateX(0)"},out:{opacity:0,transform:"translateX(-100%)"},common:{transformOrigin:"right"},transitionProperty:"transform, opacity"},pop:Bb(Db({},Nb),{common:{transformOrigin:"center center"}}),"pop-bottom-left":Bb(Db({},Nb),{common:{transformOrigin:"bottom left"}}),"pop-bottom-right":Bb(Db({},Nb),{common:{transformOrigin:"bottom right"}}),"pop-top-left":Bb(Db({},Nb),{common:{transformOrigin:"top left"}}),"pop-top-right":Bb(Db({},Nb),{common:{transformOrigin:"top right"}})},MZ=["mousedown","touchstart"];function AQe(t,e,n){const r=we.useRef();return we.useEffect(()=>{const i=o=>{const{target:a}=o??{};if(Array.isArray(n)){const s=(a==null?void 0:a.hasAttribute("data-ignore-outside-clicks"))||!document.body.contains(a)&&a.tagName!=="HTML";n.every(d=>!!d&&!o.composedPath().includes(d))&&!s&&t()}else r.current&&!r.current.contains(a)&&t()};return(e||MZ).forEach(o=>document.addEventListener(o,i)),()=>{(e||MZ).forEach(o=>document.removeEventListener(o,i))}},[r,t,n]),r}function _Qe(t,e){try{return t.addEventListener("change",e),()=>t.removeEventListener("change",e)}catch{return t.addListener(e),()=>t.removeListener(e)}}function yQe(t,e){return typeof e=="boolean"?e:typeof window<"u"&&"matchMedia"in window?window.matchMedia(t).matches:!1}function vQe(t,e,{getInitialValueInEffect:n}={getInitialValueInEffect:!0}){const[r,i]=we.useState(n?e:yQe(t,e)),o=we.useRef();return we.useEffect(()=>{if("matchMedia"in window)return o.current=window.matchMedia(t),i(o.current.matches),_Qe(o.current,a=>i(a.matches))},[t]),r}const LL=typeof document<"u"?we.useLayoutEffect:we.useEffect;function fA(t,e){const n=we.useRef(!1);we.useEffect(()=>()=>{n.current=!1},[]),we.useEffect(()=>{if(n.current)return t();n.current=!0},e)}function Yae({opened:t,shouldReturnFocus:e=!0}){const n=we.useRef(),r=()=>{var i;n.current&&"focus"in n.current&&typeof n.current.focus=="function"&&((i=n.current)==null||i.focus({preventScroll:!0}))};return fA(()=>{let i=-1;const o=a=>{a.key==="Tab"&&window.clearTimeout(i)};return document.addEventListener("keydown",o),t?n.current=document.activeElement:e&&(i=window.setTimeout(r,10)),()=>{window.clearTimeout(i),document.removeEventListener("keydown",o)}},[t,e]),r}const xQe=/input|select|textarea|button|object/,Qae="a, input, select, textarea, button, object, [tabindex]";function bQe(t){return t.style.display==="none"}function wQe(t){if(t.getAttribute("aria-hidden")||t.getAttribute("hidden")||t.getAttribute("type")==="hidden")return!1;let n=t;for(;n&&!(n===document.body||n.nodeType===11);){if(bQe(n))return!1;n=n.parentNode}return!0}function Kae(t){let e=t.getAttribute("tabindex");return e===null&&(e=void 0),parseInt(e,10)}function j4(t){const e=t.nodeName.toLowerCase(),n=!Number.isNaN(Kae(t));return(xQe.test(e)&&!t.disabled||t instanceof HTMLAnchorElement&&t.href||n)&&wQe(t)}function Jae(t){const e=Kae(t);return(Number.isNaN(e)||e>=0)&&j4(t)}function EQe(t){return Array.from(t.querySelectorAll(Qae)).filter(Jae)}function SQe(t,e){const n=EQe(t);if(!n.length){e.preventDefault();return}const r=n[e.shiftKey?0:n.length-1],i=t.getRootNode();if(!(r===i.activeElement||t===i.activeElement))return;e.preventDefault();const a=n[e.shiftKey?n.length-1:0];a&&a.focus()}function ele(){return`mantine-${Math.random().toString(36).slice(2,11)}`}function TQe(t,e="body > :not(script)"){const n=ele(),r=Array.from(document.querySelectorAll(e)).map(i=>{var o;if((o=i==null?void 0:i.shadowRoot)!=null&&o.contains(t)||i.contains(t))return;const a=i.getAttribute("aria-hidden"),s=i.getAttribute("data-hidden"),u=i.getAttribute("data-focus-id");return i.setAttribute("data-focus-id",n),a===null||a==="false"?i.setAttribute("aria-hidden","true"):!s&&!u&&i.setAttribute("data-hidden",a),{node:i,ariaHidden:s||null}});return()=>{r.forEach(i=>{!i||n!==i.node.getAttribute("data-focus-id")||(i.ariaHidden===null?i.node.removeAttribute("aria-hidden"):i.node.setAttribute("aria-hidden",i.ariaHidden),i.node.removeAttribute("data-focus-id"),i.node.removeAttribute("data-hidden"))})}}function CQe(t=!0){const e=we.useRef(),n=we.useRef(null),r=o=>{let a=o.querySelector("[data-autofocus]");if(!a){const s=Array.from(o.querySelectorAll(Qae));a=s.find(Jae)||s.find(j4)||null,!a&&j4(o)&&(a=o)}a&&a.focus({preventScroll:!0})},i=we.useCallback(o=>{if(t){if(o===null){n.current&&(n.current(),n.current=null);return}n.current=TQe(o),e.current!==o&&(o?(setTimeout(()=>{o.getRootNode()&&r(o)}),e.current=o):e.current=null)}},[t]);return we.useEffect(()=>{if(!t)return;e.current&&setTimeout(()=>r(e.current));const o=a=>{a.key==="Tab"&&e.current&&SQe(e.current,a)};return document.addEventListener("keydown",o),()=>{document.removeEventListener("keydown",o),n.current&&n.current()}},[t]),i}const PQe=ut["useId".toString()]||(()=>{});function IQe(){const t=PQe();return t?`mantine-${t.replace(/:/g,"")}`:""}function p2(t){const e=IQe(),[n,r]=we.useState(e);return LL(()=>{r(ele())},[]),typeof t=="string"?t:typeof window>"u"?e:n}function MQe(t,e,n){we.useEffect(()=>(window.addEventListener(t,e,n),()=>window.removeEventListener(t,e,n)),[t,e])}function tle(t,e){typeof t=="function"?t(e):typeof t=="object"&&t!==null&&"current"in t&&(t.current=e)}function OQe(...t){return e=>{t.forEach(n=>tle(n,e))}}function Y1(...t){return we.useCallback(OQe(...t),t)}function jU({value:t,defaultValue:e,finalValue:n,onChange:r=()=>{}}){const[i,o]=we.useState(e!==void 0?e:n),a=s=>{o(s),r==null||r(s)};return t!==void 0?[t,r,!0]:[i,a,!1]}function VU(t,e){return vQe("(prefers-reduced-motion: reduce)",t,e)}const RQe={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};function LQe(){const t=we.useRef(0),e=we.useRef(null),[n,r]=we.useState(RQe),i=we.useMemo(()=>typeof window<"u"?new ResizeObserver(o=>{const a=o[0];a&&(cancelAnimationFrame(t.current),t.current=requestAnimationFrame(()=>{e.current&&r(a.contentRect)}))}):null,[]);return LL(()=>(e.current&&(i.observe(e.current),r(e.current.getBoundingClientRect())),()=>{i.disconnect(),t.current&&cancelAnimationFrame(t.current)}),[e.current]),[e,n]}function V4(t=!1,e){const{onOpen:n,onClose:r}=e||{},[i,o]=we.useState(t),a=we.useCallback(()=>{o(d=>d||(n==null||n(),!0))},[n]),s=we.useCallback(()=>{o(d=>d&&(r==null||r(),!1))},[r]),u=we.useCallback(()=>{i?s():a()},[s,a,i]);return[i,{open:a,close:s,toggle:u}]}var OZ=Object.getOwnPropertySymbols,DQe=Object.prototype.hasOwnProperty,BQe=Object.prototype.propertyIsEnumerable,NQe=(t,e)=>{var n={};for(var r in t)DQe.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&OZ)for(var r of OZ(t))e.indexOf(r)<0&&BQe.call(t,r)&&(n[r]=t[r]);return n};function $U(t){const e=t,{m:n,mx:r,my:i,mt:o,mb:a,ml:s,mr:u,p:d,px:g,py:_,pt:E,pb:P,pl:R,pr:B,bg:V,c:z,opacity:F,ff:k,fz:X,fw:Y,lts:J,ta:ie,lh:ce,fs:re,tt:ue,td:se,w:me,miw:Ce,maw:be,h:Ye,mih:tt,mah:pt,bgsz:Ee,bgp:Ne,bgr:Be,bga:qe,pos:ct,top:Ct,left:Dt,bottom:In,right:Mn,inset:Tn,display:Nt}=e,Zt=NQe(e,["m","mx","my","mt","mb","ml","mr","p","px","py","pt","pb","pl","pr","bg","c","opacity","ff","fz","fw","lts","ta","lh","fs","tt","td","w","miw","maw","h","mih","mah","bgsz","bgp","bgr","bga","pos","top","left","bottom","right","inset","display"]);return{systemStyles:qae({m:n,mx:r,my:i,mt:o,mb:a,ml:s,mr:u,p:d,px:g,py:_,pt:E,pb:P,pl:R,pr:B,bg:V,c:z,opacity:F,ff:k,fz:X,fw:Y,lts:J,ta:ie,lh:ce,fs:re,tt:ue,td:se,w:me,miw:Ce,maw:be,h:Ye,mih:tt,mah:pt,bgsz:Ee,bgp:Ne,bgr:Be,bga:qe,pos:ct,top:Ct,left:Dt,bottom:In,right:Mn,inset:Tn,display:Nt}),rest:Zt}}function FQe(t,e){const n=Object.keys(t).filter(r=>r!=="base").sort((r,i)=>b1(Zr({size:r,sizes:e.breakpoints}))-b1(Zr({size:i,sizes:e.breakpoints})));return"base"in t?["base",...n]:n}function kQe({value:t,theme:e,getValue:n,property:r}){if(t==null)return;if(typeof t=="object")return FQe(t,e).reduce((a,s)=>{if(s==="base"&&t.base!==void 0){const d=n(t.base,e);return Array.isArray(r)?(r.forEach(g=>{a[g]=d}),a):(a[r]=d,a)}const u=n(t[s],e);return Array.isArray(r)?(a[e.fn.largerThan(s)]={},r.forEach(d=>{a[e.fn.largerThan(s)][d]=u}),a):(a[e.fn.largerThan(s)]={[r]:u},a)},{});const i=n(t,e);return Array.isArray(r)?r.reduce((o,a)=>(o[a]=i,o),{}):{[r]:i}}function zQe(t,e){return t==="dimmed"?e.colorScheme==="dark"?e.colors.dark[2]:e.colors.gray[6]:e.fn.variant({variant:"filled",color:t,primaryFallback:!1}).background}function UQe(t){return pn(t)}function GQe(t){return t}function jQe(t,e){return Zr({size:t,sizes:e.fontSizes})}const VQe=["-xs","-sm","-md","-lg","-xl"];function $Qe(t,e){return VQe.includes(t)?`calc(${Zr({size:t.replace("-",""),sizes:e.spacing})} * -1)`:Zr({size:t,sizes:e.spacing})}const HQe={identity:GQe,color:zQe,size:UQe,fontSize:jQe,spacing:$Qe},WQe={m:{type:"spacing",property:"margin"},mt:{type:"spacing",property:"marginTop"},mb:{type:"spacing",property:"marginBottom"},ml:{type:"spacing",property:"marginLeft"},mr:{type:"spacing",property:"marginRight"},mx:{type:"spacing",property:["marginRight","marginLeft"]},my:{type:"spacing",property:["marginTop","marginBottom"]},p:{type:"spacing",property:"padding"},pt:{type:"spacing",property:"paddingTop"},pb:{type:"spacing",property:"paddingBottom"},pl:{type:"spacing",property:"paddingLeft"},pr:{type:"spacing",property:"paddingRight"},px:{type:"spacing",property:["paddingRight","paddingLeft"]},py:{type:"spacing",property:["paddingTop","paddingBottom"]},bg:{type:"color",property:"background"},c:{type:"color",property:"color"},opacity:{type:"identity",property:"opacity"},ff:{type:"identity",property:"fontFamily"},fz:{type:"fontSize",property:"fontSize"},fw:{type:"identity",property:"fontWeight"},lts:{type:"size",property:"letterSpacing"},ta:{type:"identity",property:"textAlign"},lh:{type:"identity",property:"lineHeight"},fs:{type:"identity",property:"fontStyle"},tt:{type:"identity",property:"textTransform"},td:{type:"identity",property:"textDecoration"},w:{type:"spacing",property:"width"},miw:{type:"spacing",property:"minWidth"},maw:{type:"spacing",property:"maxWidth"},h:{type:"spacing",property:"height"},mih:{type:"spacing",property:"minHeight"},mah:{type:"spacing",property:"maxHeight"},bgsz:{type:"size",property:"backgroundSize"},bgp:{type:"identity",property:"backgroundPosition"},bgr:{type:"identity",property:"backgroundRepeat"},bga:{type:"identity",property:"backgroundAttachment"},pos:{type:"identity",property:"position"},top:{type:"identity",property:"top"},left:{type:"size",property:"left"},bottom:{type:"size",property:"bottom"},right:{type:"size",property:"right"},inset:{type:"size",property:"inset"},display:{type:"identity",property:"display"}};var qQe=Object.defineProperty,RZ=Object.getOwnPropertySymbols,XQe=Object.prototype.hasOwnProperty,ZQe=Object.prototype.propertyIsEnumerable,LZ=(t,e,n)=>e in t?qQe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,DZ=(t,e)=>{for(var n in e||(e={}))XQe.call(e,n)&&LZ(t,n,e[n]);if(RZ)for(var n of RZ(e))ZQe.call(e,n)&&LZ(t,n,e[n]);return t};function BZ(t,e,n=WQe){return Object.keys(n).reduce((i,o)=>(o in t&&t[o]!==void 0&&i.push(kQe({value:t[o],getValue:HQe[n[o].type],property:n[o].property,theme:e})),i),[]).reduce((i,o)=>(Object.keys(o).forEach(a=>{typeof o[a]=="object"&&o[a]!==null&&a in i?i[a]=DZ(DZ({},i[a]),o[a]):i[a]=o[a]}),i),{})}function NZ(t,e){return typeof t=="function"?t(e):t}function YQe(t,e,n){const r=ip(),{css:i,cx:o}=Zae();return Array.isArray(t)?o(n,i(BZ(e,r)),t.map(a=>i(NZ(a,r)))):o(n,i(NZ(t,r)),i(BZ(e,r)))}var QQe=Object.defineProperty,fM=Object.getOwnPropertySymbols,nle=Object.prototype.hasOwnProperty,rle=Object.prototype.propertyIsEnumerable,FZ=(t,e,n)=>e in t?QQe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,KQe=(t,e)=>{for(var n in e||(e={}))nle.call(e,n)&&FZ(t,n,e[n]);if(fM)for(var n of fM(e))rle.call(e,n)&&FZ(t,n,e[n]);return t},JQe=(t,e)=>{var n={};for(var r in t)nle.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&fM)for(var r of fM(t))e.indexOf(r)<0&&rle.call(t,r)&&(n[r]=t[r]);return n};const ile=we.forwardRef((t,e)=>{var n=t,{className:r,component:i,style:o,sx:a}=n,s=JQe(n,["className","component","style","sx"]);const{systemStyles:u,rest:d}=$U(s),g=i||"div";return ut.createElement(g,KQe({ref:e,className:YQe(a,u,r),style:o},d))});ile.displayName="@mantine/core/Box";const go=ile;var eKe=Object.defineProperty,tKe=Object.defineProperties,nKe=Object.getOwnPropertyDescriptors,kZ=Object.getOwnPropertySymbols,rKe=Object.prototype.hasOwnProperty,iKe=Object.prototype.propertyIsEnumerable,zZ=(t,e,n)=>e in t?eKe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,UZ=(t,e)=>{for(var n in e||(e={}))rKe.call(e,n)&&zZ(t,n,e[n]);if(kZ)for(var n of kZ(e))iKe.call(e,n)&&zZ(t,n,e[n]);return t},oKe=(t,e)=>tKe(t,nKe(e)),sKe=no(t=>({root:oKe(UZ(UZ({},t.fn.focusStyles()),t.fn.fontStyles()),{cursor:"pointer",border:0,padding:0,appearance:"none",fontSize:t.fontSizes.md,backgroundColor:"transparent",textAlign:"left",color:t.colorScheme==="dark"?t.colors.dark[0]:t.black,textDecoration:"none",boxSizing:"border-box"})}));const aKe=sKe;var lKe=Object.defineProperty,hM=Object.getOwnPropertySymbols,ole=Object.prototype.hasOwnProperty,sle=Object.prototype.propertyIsEnumerable,GZ=(t,e,n)=>e in t?lKe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,uKe=(t,e)=>{for(var n in e||(e={}))ole.call(e,n)&&GZ(t,n,e[n]);if(hM)for(var n of hM(e))sle.call(e,n)&&GZ(t,n,e[n]);return t},cKe=(t,e)=>{var n={};for(var r in t)ole.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&hM)for(var r of hM(t))e.indexOf(r)<0&&sle.call(t,r)&&(n[r]=t[r]);return n};const ale=we.forwardRef((t,e)=>{const n=Gr("UnstyledButton",{},t),{className:r,component:i="button",unstyled:o,variant:a}=n,s=cKe(n,["className","component","unstyled","variant"]),{classes:u,cx:d}=aKe(null,{name:"UnstyledButton",unstyled:o,variant:a});return ut.createElement(go,uKe({component:i,ref:e,className:d(u.root,r),type:i==="button"?"button":void 0},s))});ale.displayName="@mantine/core/UnstyledButton";const fKe=ale;var hKe=Object.defineProperty,dKe=Object.defineProperties,pKe=Object.getOwnPropertyDescriptors,jZ=Object.getOwnPropertySymbols,gKe=Object.prototype.hasOwnProperty,mKe=Object.prototype.propertyIsEnumerable,VZ=(t,e,n)=>e in t?hKe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$4=(t,e)=>{for(var n in e||(e={}))gKe.call(e,n)&&VZ(t,n,e[n]);if(jZ)for(var n of jZ(e))mKe.call(e,n)&&VZ(t,n,e[n]);return t},$Z=(t,e)=>dKe(t,pKe(e));const AKe=["subtle","filled","outline","light","default","transparent","gradient"],wT={xs:pn(18),sm:pn(22),md:pn(28),lg:pn(34),xl:pn(44)};function _Ke({variant:t,theme:e,color:n,gradient:r}){const i=e.fn.variant({color:n,variant:t,gradient:r});return t==="gradient"?{border:0,backgroundImage:i.background,color:i.color,"&:hover":e.fn.hover({backgroundSize:"200%"})}:AKe.includes(t)?$4({border:`${pn(1)} solid ${i.border}`,backgroundColor:i.background,color:i.color},e.fn.hover({backgroundColor:i.hover})):null}var yKe=no((t,{radius:e,color:n,gradient:r},{variant:i,size:o})=>({root:$Z($4({position:"relative",borderRadius:t.fn.radius(e),padding:0,lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",height:Zr({size:o,sizes:wT}),minHeight:Zr({size:o,sizes:wT}),width:Zr({size:o,sizes:wT}),minWidth:Zr({size:o,sizes:wT})},_Ke({variant:i,theme:t,color:n,gradient:r})),{"&:active":t.activeStyles,"& [data-action-icon-loader]":{maxWidth:"70%"},"&:disabled, &[data-disabled]":{color:t.colors.gray[t.colorScheme==="dark"?6:4],cursor:"not-allowed",backgroundColor:i==="transparent"?void 0:t.fn.themeColor("gray",t.colorScheme==="dark"?8:1),borderColor:i==="transparent"?void 0:t.fn.themeColor("gray",t.colorScheme==="dark"?8:1),backgroundImage:"none",pointerEvents:"none","&:active":{transform:"none"}},"&[data-loading]":{pointerEvents:"none","&::before":$Z($4({content:'""'},t.fn.cover(pn(-1))),{backgroundColor:t.colorScheme==="dark"?t.fn.rgba(t.colors.dark[7],.5):"rgba(255, 255, 255, .5)",borderRadius:t.fn.radius(e),cursor:"not-allowed"})}})}));const vKe=yKe;var xKe=Object.defineProperty,dM=Object.getOwnPropertySymbols,lle=Object.prototype.hasOwnProperty,ule=Object.prototype.propertyIsEnumerable,HZ=(t,e,n)=>e in t?xKe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,WZ=(t,e)=>{for(var n in e||(e={}))lle.call(e,n)&&HZ(t,n,e[n]);if(dM)for(var n of dM(e))ule.call(e,n)&&HZ(t,n,e[n]);return t},qZ=(t,e)=>{var n={};for(var r in t)lle.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&dM)for(var r of dM(t))e.indexOf(r)<0&&ule.call(t,r)&&(n[r]=t[r]);return n};function bKe(t){var e=t,{size:n,color:r}=e,i=qZ(e,["size","color"]);const o=i,{style:a}=o,s=qZ(o,["style"]);return ut.createElement("svg",WZ({viewBox:"0 0 135 140",xmlns:"http://www.w3.org/2000/svg",fill:r,style:WZ({width:n},a)},s),ut.createElement("rect",{y:"10",width:"15",height:"120",rx:"6"},ut.createElement("animate",{attributeName:"height",begin:"0.5s",dur:"1s",values:"120;110;100;90;80;70;60;50;40;140;120",calcMode:"linear",repeatCount:"indefinite"}),ut.createElement("animate",{attributeName:"y",begin:"0.5s",dur:"1s",values:"10;15;20;25;30;35;40;45;50;0;10",calcMode:"linear",repeatCount:"indefinite"})),ut.createElement("rect",{x:"30",y:"10",width:"15",height:"120",rx:"6"},ut.createElement("animate",{attributeName:"height",begin:"0.25s",dur:"1s",values:"120;110;100;90;80;70;60;50;40;140;120",calcMode:"linear",repeatCount:"indefinite"}),ut.createElement("animate",{attributeName:"y",begin:"0.25s",dur:"1s",values:"10;15;20;25;30;35;40;45;50;0;10",calcMode:"linear",repeatCount:"indefinite"})),ut.createElement("rect",{x:"60",width:"15",height:"140",rx:"6"},ut.createElement("animate",{attributeName:"height",begin:"0s",dur:"1s",values:"120;110;100;90;80;70;60;50;40;140;120",calcMode:"linear",repeatCount:"indefinite"}),ut.createElement("animate",{attributeName:"y",begin:"0s",dur:"1s",values:"10;15;20;25;30;35;40;45;50;0;10",calcMode:"linear",repeatCount:"indefinite"})),ut.createElement("rect",{x:"90",y:"10",width:"15",height:"120",rx:"6"},ut.createElement("animate",{attributeName:"height",begin:"0.25s",dur:"1s",values:"120;110;100;90;80;70;60;50;40;140;120",calcMode:"linear",repeatCount:"indefinite"}),ut.createElement("animate",{attributeName:"y",begin:"0.25s",dur:"1s",values:"10;15;20;25;30;35;40;45;50;0;10",calcMode:"linear",repeatCount:"indefinite"})),ut.createElement("rect",{x:"120",y:"10",width:"15",height:"120",rx:"6"},ut.createElement("animate",{attributeName:"height",begin:"0.5s",dur:"1s",values:"120;110;100;90;80;70;60;50;40;140;120",calcMode:"linear",repeatCount:"indefinite"}),ut.createElement("animate",{attributeName:"y",begin:"0.5s",dur:"1s",values:"10;15;20;25;30;35;40;45;50;0;10",calcMode:"linear",repeatCount:"indefinite"})))}var wKe=Object.defineProperty,pM=Object.getOwnPropertySymbols,cle=Object.prototype.hasOwnProperty,fle=Object.prototype.propertyIsEnumerable,XZ=(t,e,n)=>e in t?wKe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ZZ=(t,e)=>{for(var n in e||(e={}))cle.call(e,n)&&XZ(t,n,e[n]);if(pM)for(var n of pM(e))fle.call(e,n)&&XZ(t,n,e[n]);return t},YZ=(t,e)=>{var n={};for(var r in t)cle.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&pM)for(var r of pM(t))e.indexOf(r)<0&&fle.call(t,r)&&(n[r]=t[r]);return n};function EKe(t){var e=t,{size:n,color:r}=e,i=YZ(e,["size","color"]);const o=i,{style:a}=o,s=YZ(o,["style"]);return ut.createElement("svg",ZZ({viewBox:"0 0 38 38",xmlns:"http://www.w3.org/2000/svg",stroke:r,style:ZZ({width:n,height:n},a)},s),ut.createElement("g",{fill:"none",fillRule:"evenodd"},ut.createElement("g",{transform:"translate(2.5 2.5)",strokeWidth:"5"},ut.createElement("circle",{strokeOpacity:".5",cx:"16",cy:"16",r:"16"}),ut.createElement("path",{d:"M32 16c0-9.94-8.06-16-16-16"},ut.createElement("animateTransform",{attributeName:"transform",type:"rotate",from:"0 16 16",to:"360 16 16",dur:"1s",repeatCount:"indefinite"})))))}var SKe=Object.defineProperty,gM=Object.getOwnPropertySymbols,hle=Object.prototype.hasOwnProperty,dle=Object.prototype.propertyIsEnumerable,QZ=(t,e,n)=>e in t?SKe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,KZ=(t,e)=>{for(var n in e||(e={}))hle.call(e,n)&&QZ(t,n,e[n]);if(gM)for(var n of gM(e))dle.call(e,n)&&QZ(t,n,e[n]);return t},JZ=(t,e)=>{var n={};for(var r in t)hle.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&gM)for(var r of gM(t))e.indexOf(r)<0&&dle.call(t,r)&&(n[r]=t[r]);return n};function TKe(t){var e=t,{size:n,color:r}=e,i=JZ(e,["size","color"]);const o=i,{style:a}=o,s=JZ(o,["style"]);return ut.createElement("svg",KZ({viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",fill:r,style:KZ({width:n},a)},s),ut.createElement("circle",{cx:"15",cy:"15",r:"15"},ut.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),ut.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})),ut.createElement("circle",{cx:"60",cy:"15",r:"9",fillOpacity:"0.3"},ut.createElement("animate",{attributeName:"r",from:"9",to:"9",begin:"0s",dur:"0.8s",values:"9;15;9",calcMode:"linear",repeatCount:"indefinite"}),ut.createElement("animate",{attributeName:"fill-opacity",from:"0.5",to:"0.5",begin:"0s",dur:"0.8s",values:".5;1;.5",calcMode:"linear",repeatCount:"indefinite"})),ut.createElement("circle",{cx:"105",cy:"15",r:"15"},ut.createElement("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),ut.createElement("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})))}var CKe=Object.defineProperty,mM=Object.getOwnPropertySymbols,ple=Object.prototype.hasOwnProperty,gle=Object.prototype.propertyIsEnumerable,eY=(t,e,n)=>e in t?CKe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,PKe=(t,e)=>{for(var n in e||(e={}))ple.call(e,n)&&eY(t,n,e[n]);if(mM)for(var n of mM(e))gle.call(e,n)&&eY(t,n,e[n]);return t},IKe=(t,e)=>{var n={};for(var r in t)ple.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&mM)for(var r of mM(t))e.indexOf(r)<0&&gle.call(t,r)&&(n[r]=t[r]);return n};const cN={bars:bKe,oval:EKe,dots:TKe},MKe={xs:pn(18),sm:pn(22),md:pn(36),lg:pn(44),xl:pn(58)},OKe={size:"md"};function mle(t){const e=Gr("Loader",OKe,t),{size:n,color:r,variant:i}=e,o=IKe(e,["size","color","variant"]),a=ip(),s=i in cN?i:a.loader;return ut.createElement(go,PKe({role:"presentation",component:cN[s]||cN.bars,size:Zr({size:n,sizes:MKe}),color:a.fn.variant({variant:"filled",primaryFallback:!1,color:r||a.primaryColor}).background},o))}mle.displayName="@mantine/core/Loader";var RKe=Object.defineProperty,AM=Object.getOwnPropertySymbols,Ale=Object.prototype.hasOwnProperty,_le=Object.prototype.propertyIsEnumerable,tY=(t,e,n)=>e in t?RKe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,nY=(t,e)=>{for(var n in e||(e={}))Ale.call(e,n)&&tY(t,n,e[n]);if(AM)for(var n of AM(e))_le.call(e,n)&&tY(t,n,e[n]);return t},LKe=(t,e)=>{var n={};for(var r in t)Ale.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&AM)for(var r of AM(t))e.indexOf(r)<0&&_le.call(t,r)&&(n[r]=t[r]);return n};const DKe={color:"gray",size:"md",variant:"subtle"},yle=we.forwardRef((t,e)=>{const n=Gr("ActionIcon",DKe,t),{className:r,color:i,children:o,radius:a,size:s,variant:u,gradient:d,disabled:g,loaderProps:_,loading:E,unstyled:P,__staticSelector:R}=n,B=LKe(n,["className","color","children","radius","size","variant","gradient","disabled","loaderProps","loading","unstyled","__staticSelector"]),{classes:V,cx:z,theme:F}=vKe({radius:a,color:i,gradient:d},{name:["ActionIcon",R],unstyled:P,size:s,variant:u}),k=ut.createElement(mle,nY({color:F.fn.variant({color:i,variant:u}).color,size:"100%","data-action-icon-loader":!0},_));return ut.createElement(fKe,nY({className:z(V.root,r),ref:e,disabled:g,"data-disabled":g||void 0,"data-loading":E||void 0,unstyled:P},B),E?k:o)});yle.displayName="@mantine/core/ActionIcon";const BKe=yle;var NKe=Object.defineProperty,FKe=Object.defineProperties,kKe=Object.getOwnPropertyDescriptors,_M=Object.getOwnPropertySymbols,vle=Object.prototype.hasOwnProperty,xle=Object.prototype.propertyIsEnumerable,rY=(t,e,n)=>e in t?NKe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,zKe=(t,e)=>{for(var n in e||(e={}))vle.call(e,n)&&rY(t,n,e[n]);if(_M)for(var n of _M(e))xle.call(e,n)&&rY(t,n,e[n]);return t},UKe=(t,e)=>FKe(t,kKe(e)),GKe=(t,e)=>{var n={};for(var r in t)vle.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&_M)for(var r of _M(t))e.indexOf(r)<0&&xle.call(t,r)&&(n[r]=t[r]);return n};function ble(t){const e=Gr("Portal",{},t),{children:n,target:r,className:i,innerRef:o}=e,a=GKe(e,["children","target","className","innerRef"]),s=ip(),[u,d]=we.useState(!1),g=we.useRef();return LL(()=>(d(!0),g.current=r?typeof r=="string"?document.querySelector(r):r:document.createElement("div"),r||document.body.appendChild(g.current),()=>{!r&&document.body.removeChild(g.current)}),[r]),u?wE.createPortal(ut.createElement("div",UKe(zKe({className:i,dir:s.dir},a),{ref:o}),n),g.current):null}ble.displayName="@mantine/core/Portal";var jKe=Object.defineProperty,yM=Object.getOwnPropertySymbols,wle=Object.prototype.hasOwnProperty,Ele=Object.prototype.propertyIsEnumerable,iY=(t,e,n)=>e in t?jKe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,VKe=(t,e)=>{for(var n in e||(e={}))wle.call(e,n)&&iY(t,n,e[n]);if(yM)for(var n of yM(e))Ele.call(e,n)&&iY(t,n,e[n]);return t},$Ke=(t,e)=>{var n={};for(var r in t)wle.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&yM)for(var r of yM(t))e.indexOf(r)<0&&Ele.call(t,r)&&(n[r]=t[r]);return n};function g2(t){var e=t,{withinPortal:n=!0,children:r}=e,i=$Ke(e,["withinPortal","children"]);return n?ut.createElement(ble,VKe({},i),r):ut.createElement(ut.Fragment,null,r)}g2.displayName="@mantine/core/OptionalPortal";var HKe=Object.defineProperty,vM=Object.getOwnPropertySymbols,Sle=Object.prototype.hasOwnProperty,Tle=Object.prototype.propertyIsEnumerable,oY=(t,e,n)=>e in t?HKe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,sY=(t,e)=>{for(var n in e||(e={}))Sle.call(e,n)&&oY(t,n,e[n]);if(vM)for(var n of vM(e))Tle.call(e,n)&&oY(t,n,e[n]);return t},WKe=(t,e)=>{var n={};for(var r in t)Sle.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&vM)for(var r of vM(t))e.indexOf(r)<0&&Tle.call(t,r)&&(n[r]=t[r]);return n};function Cle(t){const e=t,{width:n,height:r,style:i}=e,o=WKe(e,["width","height","style"]);return ut.createElement("svg",sY({viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:sY({width:n,height:r},i)},o),ut.createElement("path",{d:"M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}Cle.displayName="@mantine/core/CloseIcon";var qKe=Object.defineProperty,xM=Object.getOwnPropertySymbols,Ple=Object.prototype.hasOwnProperty,Ile=Object.prototype.propertyIsEnumerable,aY=(t,e,n)=>e in t?qKe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,XKe=(t,e)=>{for(var n in e||(e={}))Ple.call(e,n)&&aY(t,n,e[n]);if(xM)for(var n of xM(e))Ile.call(e,n)&&aY(t,n,e[n]);return t},ZKe=(t,e)=>{var n={};for(var r in t)Ple.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&xM)for(var r of xM(t))e.indexOf(r)<0&&Ile.call(t,r)&&(n[r]=t[r]);return n};const YKe={xs:pn(12),sm:pn(16),md:pn(20),lg:pn(28),xl:pn(34)},QKe={size:"sm"},Mle=we.forwardRef((t,e)=>{const n=Gr("CloseButton",QKe,t),{iconSize:r,size:i,children:o}=n,a=ZKe(n,["iconSize","size","children"]),s=pn(r||YKe[i]);return ut.createElement(BKe,XKe({ref:e,__staticSelector:"CloseButton",size:i},a),o||ut.createElement(Cle,{width:s,height:s}))});Mle.displayName="@mantine/core/CloseButton";const Ole=Mle;var KKe=Object.defineProperty,JKe=Object.defineProperties,eJe=Object.getOwnPropertyDescriptors,lY=Object.getOwnPropertySymbols,tJe=Object.prototype.hasOwnProperty,nJe=Object.prototype.propertyIsEnumerable,uY=(t,e,n)=>e in t?KKe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ET=(t,e)=>{for(var n in e||(e={}))tJe.call(e,n)&&uY(t,n,e[n]);if(lY)for(var n of lY(e))nJe.call(e,n)&&uY(t,n,e[n]);return t},rJe=(t,e)=>JKe(t,eJe(e));function iJe({underline:t,strikethrough:e}){const n=[];return t&&n.push("underline"),e&&n.push("line-through"),n.length>0?n.join(" "):"none"}function oJe({theme:t,color:e}){return e==="dimmed"?t.fn.dimmed():typeof e=="string"&&(e in t.colors||e.split(".")[0]in t.colors)?t.fn.variant({variant:"filled",color:e}).background:e||"inherit"}function sJe(t){return typeof t=="number"?{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:t,WebkitBoxOrient:"vertical"}:null}function aJe({theme:t,truncate:e}){return e==="start"?{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",direction:t.dir==="ltr"?"rtl":"ltr",textAlign:t.dir==="ltr"?"right":"left"}:e?{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}:null}var lJe=no((t,{color:e,lineClamp:n,truncate:r,inline:i,inherit:o,underline:a,gradient:s,weight:u,transform:d,align:g,strikethrough:_,italic:E},{size:P})=>{const R=t.fn.variant({variant:"gradient",gradient:s});return{root:rJe(ET(ET(ET(ET({},t.fn.fontStyles()),t.fn.focusStyles()),sJe(n)),aJe({theme:t,truncate:r})),{color:oJe({color:e,theme:t}),fontFamily:o?"inherit":t.fontFamily,fontSize:o||P===void 0?"inherit":Zr({size:P,sizes:t.fontSizes}),lineHeight:o?"inherit":i?1:t.lineHeight,textDecoration:iJe({underline:a,strikethrough:_}),WebkitTapHighlightColor:"transparent",fontWeight:o?"inherit":u,textTransform:d,textAlign:g,fontStyle:E?"italic":void 0}),gradient:{backgroundImage:R.background,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}});const uJe=lJe;var cJe=Object.defineProperty,bM=Object.getOwnPropertySymbols,Rle=Object.prototype.hasOwnProperty,Lle=Object.prototype.propertyIsEnumerable,cY=(t,e,n)=>e in t?cJe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,fJe=(t,e)=>{for(var n in e||(e={}))Rle.call(e,n)&&cY(t,n,e[n]);if(bM)for(var n of bM(e))Lle.call(e,n)&&cY(t,n,e[n]);return t},hJe=(t,e)=>{var n={};for(var r in t)Rle.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&bM)for(var r of bM(t))e.indexOf(r)<0&&Lle.call(t,r)&&(n[r]=t[r]);return n};const dJe={variant:"text"},Dle=we.forwardRef((t,e)=>{const n=Gr("Text",dJe,t),{className:r,size:i,weight:o,transform:a,color:s,align:u,variant:d,lineClamp:g,truncate:_,gradient:E,inline:P,inherit:R,underline:B,strikethrough:V,italic:z,classNames:F,styles:k,unstyled:X,span:Y,__staticSelector:J}=n,ie=hJe(n,["className","size","weight","transform","color","align","variant","lineClamp","truncate","gradient","inline","inherit","underline","strikethrough","italic","classNames","styles","unstyled","span","__staticSelector"]),{classes:ce,cx:re}=uJe({color:s,lineClamp:g,truncate:_,inline:P,inherit:R,underline:B,strikethrough:V,italic:z,weight:o,transform:a,align:u,gradient:E},{unstyled:X,name:J||"Text",variant:d,size:i});return ut.createElement(go,fJe({ref:e,className:re(ce.root,{[ce.gradient]:d==="gradient"},r),component:Y?"span":"div"},ie))});Dle.displayName="@mantine/core/Text";const Nh=Dle,ST={xs:pn(1),sm:pn(2),md:pn(3),lg:pn(4),xl:pn(5)};function TT(t,e){const n=t.fn.variant({variant:"outline",color:e}).border;return typeof e=="string"&&(e in t.colors||e.split(".")[0]in t.colors)?n:e===void 0?t.colorScheme==="dark"?t.colors.dark[4]:t.colors.gray[4]:e}var pJe=no((t,{color:e},{size:n,variant:r})=>({root:{},withLabel:{borderTop:"0 !important"},left:{"&::before":{display:"none"}},right:{"&::after":{display:"none"}},label:{display:"flex",alignItems:"center","&::before":{content:'""',flex:1,height:pn(1),borderTop:`${Zr({size:n,sizes:ST})} ${r} ${TT(t,e)}`,marginRight:t.spacing.xs},"&::after":{content:'""',flex:1,borderTop:`${Zr({size:n,sizes:ST})} ${r} ${TT(t,e)}`,marginLeft:t.spacing.xs}},labelDefaultStyles:{color:e==="dark"?t.colors.dark[1]:t.fn.themeColor(e,t.colorScheme==="dark"?5:t.fn.primaryShade(),!1)},horizontal:{border:0,borderTopWidth:pn(Zr({size:n,sizes:ST})),borderTopColor:TT(t,e),borderTopStyle:r,margin:0},vertical:{border:0,alignSelf:"stretch",height:"auto",borderLeftWidth:pn(Zr({size:n,sizes:ST})),borderLeftColor:TT(t,e),borderLeftStyle:r}}));const gJe=pJe;var mJe=Object.defineProperty,AJe=Object.defineProperties,_Je=Object.getOwnPropertyDescriptors,wM=Object.getOwnPropertySymbols,Ble=Object.prototype.hasOwnProperty,Nle=Object.prototype.propertyIsEnumerable,fY=(t,e,n)=>e in t?mJe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,hY=(t,e)=>{for(var n in e||(e={}))Ble.call(e,n)&&fY(t,n,e[n]);if(wM)for(var n of wM(e))Nle.call(e,n)&&fY(t,n,e[n]);return t},yJe=(t,e)=>AJe(t,_Je(e)),vJe=(t,e)=>{var n={};for(var r in t)Ble.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&wM)for(var r of wM(t))e.indexOf(r)<0&&Nle.call(t,r)&&(n[r]=t[r]);return n};const xJe={orientation:"horizontal",size:"xs",labelPosition:"left",variant:"solid"},Fle=we.forwardRef((t,e)=>{const n=Gr("Divider",xJe,t),{className:r,color:i,orientation:o,size:a,label:s,labelPosition:u,labelProps:d,variant:g,styles:_,classNames:E,unstyled:P}=n,R=vJe(n,["className","color","orientation","size","label","labelPosition","labelProps","variant","styles","classNames","unstyled"]),{classes:B,cx:V}=gJe({color:i},{classNames:E,styles:_,unstyled:P,name:"Divider",variant:g,size:a}),z=o==="vertical",F=o==="horizontal",k=!!s&&F,X=!(d!=null&&d.color);return ut.createElement(go,hY({ref:e,className:V(B.root,{[B.vertical]:z,[B.horizontal]:F,[B.withLabel]:k},r),role:"separator"},R),k&&ut.createElement(Nh,yJe(hY({},d),{size:(d==null?void 0:d.size)||"xs",mt:pn(2),className:V(B.label,B[u],{[B.labelDefaultStyles]:X})}),s))});Fle.displayName="@mantine/core/Divider";const Fh=Math.min,wl=Math.max,EM=Math.round,CT=Math.floor,hA=t=>({x:t,y:t}),bJe={left:"right",right:"left",bottom:"top",top:"bottom"},wJe={start:"end",end:"start"};function H4(t,e,n){return wl(t,Fh(e,n))}function vg(t,e){return typeof t=="function"?t(e):t}function kh(t){return t.split("-")[0]}function Q1(t){return t.split("-")[1]}function HU(t){return t==="x"?"y":"x"}function WU(t){return t==="y"?"height":"width"}function E_(t){return["top","bottom"].includes(kh(t))?"y":"x"}function qU(t){return HU(E_(t))}function EJe(t,e,n){n===void 0&&(n=!1);const r=Q1(t),i=qU(t),o=WU(i);let a=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(a=SM(a)),[a,SM(a)]}function SJe(t){const e=SM(t);return[W4(t),e,W4(e)]}function W4(t){return t.replace(/start|end/g,e=>wJe[e])}function TJe(t,e,n){const r=["left","right"],i=["right","left"],o=["top","bottom"],a=["bottom","top"];switch(t){case"top":case"bottom":return n?e?i:r:e?r:i;case"left":case"right":return e?o:a;default:return[]}}function CJe(t,e,n,r){const i=Q1(t);let o=TJe(kh(t),n==="start",r);return i&&(o=o.map(a=>a+"-"+i),e&&(o=o.concat(o.map(W4)))),o}function SM(t){return t.replace(/left|right|bottom|top/g,e=>bJe[e])}function PJe(t){return{top:0,right:0,bottom:0,left:0,...t}}function XU(t){return typeof t!="number"?PJe(t):{top:t,right:t,bottom:t,left:t}}function E1(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}function dY(t,e,n){let{reference:r,floating:i}=t;const o=E_(e),a=qU(e),s=WU(a),u=kh(e),d=o==="y",g=r.x+r.width/2-i.width/2,_=r.y+r.height/2-i.height/2,E=r[s]/2-i[s]/2;let P;switch(u){case"top":P={x:g,y:r.y-i.height};break;case"bottom":P={x:g,y:r.y+r.height};break;case"right":P={x:r.x+r.width,y:_};break;case"left":P={x:r.x-i.width,y:_};break;default:P={x:r.x,y:r.y}}switch(Q1(e)){case"start":P[a]-=E*(n&&d?-1:1);break;case"end":P[a]+=E*(n&&d?-1:1);break}return P}const IJe=async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:a}=n,s=o.filter(Boolean),u=await(a.isRTL==null?void 0:a.isRTL(e));let d=await a.getElementRects({reference:t,floating:e,strategy:i}),{x:g,y:_}=dY(d,r,u),E=r,P={},R=0;for(let B=0;B<s.length;B++){const{name:V,fn:z}=s[B],{x:F,y:k,data:X,reset:Y}=await z({x:g,y:_,initialPlacement:r,placement:E,strategy:i,middlewareData:P,rects:d,platform:a,elements:{reference:t,floating:e}});if(g=F??g,_=k??_,P={...P,[V]:{...P[V],...X}},Y&&R<=50){R++,typeof Y=="object"&&(Y.placement&&(E=Y.placement),Y.rects&&(d=Y.rects===!0?await a.getElementRects({reference:t,floating:e,strategy:i}):Y.rects),{x:g,y:_}=dY(d,E,u)),B=-1;continue}}return{x:g,y:_,placement:E,strategy:i,middlewareData:P}};async function ZU(t,e){var n;e===void 0&&(e={});const{x:r,y:i,platform:o,rects:a,elements:s,strategy:u}=t,{boundary:d="clippingAncestors",rootBoundary:g="viewport",elementContext:_="floating",altBoundary:E=!1,padding:P=0}=vg(e,t),R=XU(P),V=s[E?_==="floating"?"reference":"floating":_],z=E1(await o.getClippingRect({element:(n=await(o.isElement==null?void 0:o.isElement(V)))==null||n?V:V.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(s.floating)),boundary:d,rootBoundary:g,strategy:u})),F=_==="floating"?{...a.floating,x:r,y:i}:a.reference,k=await(o.getOffsetParent==null?void 0:o.getOffsetParent(s.floating)),X=await(o.isElement==null?void 0:o.isElement(k))?await(o.getScale==null?void 0:o.getScale(k))||{x:1,y:1}:{x:1,y:1},Y=E1(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:F,offsetParent:k,strategy:u}):F);return{top:(z.top-Y.top+R.top)/X.y,bottom:(Y.bottom-z.bottom+R.bottom)/X.y,left:(z.left-Y.left+R.left)/X.x,right:(Y.right-z.right+R.right)/X.x}}const pY=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:i,rects:o,platform:a,elements:s,middlewareData:u}=e,{element:d,padding:g=0}=vg(t,e)||{};if(d==null)return{};const _=XU(g),E={x:n,y:r},P=qU(i),R=WU(P),B=await a.getDimensions(d),V=P==="y",z=V?"top":"left",F=V?"bottom":"right",k=V?"clientHeight":"clientWidth",X=o.reference[R]+o.reference[P]-E[P]-o.floating[R],Y=E[P]-o.reference[P],J=await(a.getOffsetParent==null?void 0:a.getOffsetParent(d));let ie=J?J[k]:0;(!ie||!await(a.isElement==null?void 0:a.isElement(J)))&&(ie=s.floating[k]||o.floating[R]);const ce=X/2-Y/2,re=ie/2-B[R]/2-1,ue=Fh(_[z],re),se=Fh(_[F],re),me=ue,Ce=ie-B[R]-se,be=ie/2-B[R]/2+ce,Ye=H4(me,be,Ce),tt=!u.arrow&&Q1(i)!=null&&be!=Ye&&o.reference[R]/2-(be<me?ue:se)-B[R]/2<0,pt=tt?be<me?be-me:be-Ce:0;return{[P]:E[P]+pt,data:{[P]:Ye,centerOffset:be-Ye-pt,...tt&&{alignmentOffset:pt}},reset:tt}}}),kle=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:i,middlewareData:o,rects:a,initialPlacement:s,platform:u,elements:d}=e,{mainAxis:g=!0,crossAxis:_=!0,fallbackPlacements:E,fallbackStrategy:P="bestFit",fallbackAxisSideDirection:R="none",flipAlignment:B=!0,...V}=vg(t,e);if((n=o.arrow)!=null&&n.alignmentOffset)return{};const z=kh(i),F=kh(s)===s,k=await(u.isRTL==null?void 0:u.isRTL(d.floating)),X=E||(F||!B?[SM(s)]:SJe(s));!E&&R!=="none"&&X.push(...CJe(s,B,R,k));const Y=[s,...X],J=await ZU(e,V),ie=[];let ce=((r=o.flip)==null?void 0:r.overflows)||[];if(g&&ie.push(J[z]),_){const me=EJe(i,a,k);ie.push(J[me[0]],J[me[1]])}if(ce=[...ce,{placement:i,overflows:ie}],!ie.every(me=>me<=0)){var re,ue;const me=(((re=o.flip)==null?void 0:re.index)||0)+1,Ce=Y[me];if(Ce)return{data:{index:me,overflows:ce},reset:{placement:Ce}};let be=(ue=ce.filter(Ye=>Ye.overflows[0]<=0).sort((Ye,tt)=>Ye.overflows[1]-tt.overflows[1])[0])==null?void 0:ue.placement;if(!be)switch(P){case"bestFit":{var se;const Ye=(se=ce.map(tt=>[tt.placement,tt.overflows.filter(pt=>pt>0).reduce((pt,Ee)=>pt+Ee,0)]).sort((tt,pt)=>tt[1]-pt[1])[0])==null?void 0:se[0];Ye&&(be=Ye);break}case"initialPlacement":be=s;break}if(i!==be)return{reset:{placement:be}}}return{}}}};function zle(t){const e=Fh(...t.map(o=>o.left)),n=Fh(...t.map(o=>o.top)),r=wl(...t.map(o=>o.right)),i=wl(...t.map(o=>o.bottom));return{x:e,y:n,width:r-e,height:i-n}}function MJe(t){const e=t.slice().sort((i,o)=>i.y-o.y),n=[];let r=null;for(let i=0;i<e.length;i++){const o=e[i];!r||o.y-r.y>r.height/2?n.push([o]):n[n.length-1].push(o),r=o}return n.map(i=>E1(zle(i)))}const Ule=function(t){return t===void 0&&(t={}),{name:"inline",options:t,async fn(e){const{placement:n,elements:r,rects:i,platform:o,strategy:a}=e,{padding:s=2,x:u,y:d}=vg(t,e),g=Array.from(await(o.getClientRects==null?void 0:o.getClientRects(r.reference))||[]),_=MJe(g),E=E1(zle(g)),P=XU(s);function R(){if(_.length===2&&_[0].left>_[1].right&&u!=null&&d!=null)return _.find(V=>u>V.left-P.left&&u<V.right+P.right&&d>V.top-P.top&&d<V.bottom+P.bottom)||E;if(_.length>=2){if(E_(n)==="y"){const ue=_[0],se=_[_.length-1],me=kh(n)==="top",Ce=ue.top,be=se.bottom,Ye=me?ue.left:se.left,tt=me?ue.right:se.right,pt=tt-Ye,Ee=be-Ce;return{top:Ce,bottom:be,left:Ye,right:tt,width:pt,height:Ee,x:Ye,y:Ce}}const V=kh(n)==="left",z=wl(..._.map(ue=>ue.right)),F=Fh(..._.map(ue=>ue.left)),k=_.filter(ue=>V?ue.left===F:ue.right===z),X=k[0].top,Y=k[k.length-1].bottom,J=F,ie=z,ce=ie-J,re=Y-X;return{top:X,bottom:Y,left:J,right:ie,width:ce,height:re,x:J,y:X}}return E}const B=await o.getElementRects({reference:{getBoundingClientRect:R},floating:r.floating,strategy:a});return i.reference.x!==B.reference.x||i.reference.y!==B.reference.y||i.reference.width!==B.reference.width||i.reference.height!==B.reference.height?{reset:{rects:B}}:{}}}};async function OJe(t,e){const{placement:n,platform:r,elements:i}=t,o=await(r.isRTL==null?void 0:r.isRTL(i.floating)),a=kh(n),s=Q1(n),u=E_(n)==="y",d=["left","top"].includes(a)?-1:1,g=o&&u?-1:1,_=vg(e,t);let{mainAxis:E,crossAxis:P,alignmentAxis:R}=typeof _=="number"?{mainAxis:_,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,..._};return s&&typeof R=="number"&&(P=s==="end"?R*-1:R),u?{x:P*g,y:E*d}:{x:E*d,y:P*g}}const Gle=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){const{x:n,y:r}=e,i=await OJe(e,t);return{x:n+i.x,y:r+i.y,data:i}}}},YU=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:i}=e,{mainAxis:o=!0,crossAxis:a=!1,limiter:s={fn:V=>{let{x:z,y:F}=V;return{x:z,y:F}}},...u}=vg(t,e),d={x:n,y:r},g=await ZU(e,u),_=E_(kh(i)),E=HU(_);let P=d[E],R=d[_];if(o){const V=E==="y"?"top":"left",z=E==="y"?"bottom":"right",F=P+g[V],k=P-g[z];P=H4(F,P,k)}if(a){const V=_==="y"?"top":"left",z=_==="y"?"bottom":"right",F=R+g[V],k=R-g[z];R=H4(F,R,k)}const B=s.fn({...e,[E]:P,[_]:R});return{...B,data:{x:B.x-n,y:B.y-r}}}}},RJe=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:i,rects:o,middlewareData:a}=e,{offset:s=0,mainAxis:u=!0,crossAxis:d=!0}=vg(t,e),g={x:n,y:r},_=E_(i),E=HU(_);let P=g[E],R=g[_];const B=vg(s,e),V=typeof B=="number"?{mainAxis:B,crossAxis:0}:{mainAxis:0,crossAxis:0,...B};if(u){const k=E==="y"?"height":"width",X=o.reference[E]-o.floating[k]+V.mainAxis,Y=o.reference[E]+o.reference[k]-V.mainAxis;P<X?P=X:P>Y&&(P=Y)}if(d){var z,F;const k=E==="y"?"width":"height",X=["top","left"].includes(kh(i)),Y=o.reference[_]-o.floating[k]+(X&&((z=a.offset)==null?void 0:z[_])||0)+(X?0:V.crossAxis),J=o.reference[_]+o.reference[k]+(X?0:((F=a.offset)==null?void 0:F[_])||0)-(X?V.crossAxis:0);R<Y?R=Y:R>J&&(R=J)}return{[E]:P,[_]:R}}}},LJe=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){const{placement:n,rects:r,platform:i,elements:o}=e,{apply:a=()=>{},...s}=vg(t,e),u=await ZU(e,s),d=kh(n),g=Q1(n),_=E_(n)==="y",{width:E,height:P}=r.floating;let R,B;d==="top"||d==="bottom"?(R=d,B=g===(await(i.isRTL==null?void 0:i.isRTL(o.floating))?"start":"end")?"left":"right"):(B=d,R=g==="end"?"top":"bottom");const V=P-u[R],z=E-u[B],F=!e.middlewareData.shift;let k=V,X=z;if(_){const J=E-u.left-u.right;X=g||F?Fh(z,J):J}else{const J=P-u.top-u.bottom;k=g||F?Fh(V,J):J}if(F&&!g){const J=wl(u.left,0),ie=wl(u.right,0),ce=wl(u.top,0),re=wl(u.bottom,0);_?X=E-2*(J!==0||ie!==0?J+ie:wl(u.left,u.right)):k=P-2*(ce!==0||re!==0?ce+re:wl(u.top,u.bottom))}await a({...e,availableWidth:X,availableHeight:k});const Y=await i.getDimensions(o.floating);return E!==Y.width||P!==Y.height?{reset:{rects:!0}}:{}}}};function dA(t){return jle(t)?(t.nodeName||"").toLowerCase():"#document"}function yc(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Pg(t){var e;return(e=(jle(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function jle(t){return t instanceof Node||t instanceof yc(t).Node}function xg(t){return t instanceof Element||t instanceof yc(t).Element}function Yd(t){return t instanceof HTMLElement||t instanceof yc(t).HTMLElement}function gY(t){return typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof yc(t).ShadowRoot}function m2(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=Rf(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(i)}function DJe(t){return["table","td","th"].includes(dA(t))}function QU(t){const e=KU(),n=Rf(t);return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function BJe(t){let e=S1(t);for(;Yd(e)&&!DL(e);){if(QU(e))return e;e=S1(e)}return null}function KU(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function DL(t){return["html","body","#document"].includes(dA(t))}function Rf(t){return yc(t).getComputedStyle(t)}function BL(t){return xg(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function S1(t){if(dA(t)==="html")return t;const e=t.assignedSlot||t.parentNode||gY(t)&&t.host||Pg(t);return gY(e)?e.host:e}function Vle(t){const e=S1(t);return DL(e)?t.ownerDocument?t.ownerDocument.body:t.body:Yd(e)&&m2(e)?e:Vle(e)}function ng(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=Vle(t),o=i===((r=t.ownerDocument)==null?void 0:r.body),a=yc(i);return o?e.concat(a,a.visualViewport||[],m2(i)?i:[],a.frameElement&&n?ng(a.frameElement):[]):e.concat(i,ng(i,[],n))}function $le(t){const e=Rf(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Yd(t),o=i?t.offsetWidth:n,a=i?t.offsetHeight:r,s=EM(n)!==o||EM(r)!==a;return s&&(n=o,r=a),{width:n,height:r,$:s}}function JU(t){return xg(t)?t:t.contextElement}function Ev(t){const e=JU(t);if(!Yd(e))return hA(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:o}=$le(e);let a=(o?EM(n.width):n.width)/r,s=(o?EM(n.height):n.height)/i;return(!a||!Number.isFinite(a))&&(a=1),(!s||!Number.isFinite(s))&&(s=1),{x:a,y:s}}const NJe=hA(0);function Hle(t){const e=yc(t);return!KU()||!e.visualViewport?NJe:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function FJe(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==yc(t)?!1:e}function r_(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),o=JU(t);let a=hA(1);e&&(r?xg(r)&&(a=Ev(r)):a=Ev(t));const s=FJe(o,n,r)?Hle(o):hA(0);let u=(i.left+s.x)/a.x,d=(i.top+s.y)/a.y,g=i.width/a.x,_=i.height/a.y;if(o){const E=yc(o),P=r&&xg(r)?yc(r):r;let R=E.frameElement;for(;R&&r&&P!==E;){const B=Ev(R),V=R.getBoundingClientRect(),z=Rf(R),F=V.left+(R.clientLeft+parseFloat(z.paddingLeft))*B.x,k=V.top+(R.clientTop+parseFloat(z.paddingTop))*B.y;u*=B.x,d*=B.y,g*=B.x,_*=B.y,u+=F,d+=k,R=yc(R).frameElement}}return E1({width:g,height:_,x:u,y:d})}function kJe(t){let{rect:e,offsetParent:n,strategy:r}=t;const i=Yd(n),o=Pg(n);if(n===o)return e;let a={scrollLeft:0,scrollTop:0},s=hA(1);const u=hA(0);if((i||!i&&r!=="fixed")&&((dA(n)!=="body"||m2(o))&&(a=BL(n)),Yd(n))){const d=r_(n);s=Ev(n),u.x=d.x+n.clientLeft,u.y=d.y+n.clientTop}return{width:e.width*s.x,height:e.height*s.y,x:e.x*s.x-a.scrollLeft*s.x+u.x,y:e.y*s.y-a.scrollTop*s.y+u.y}}function zJe(t){return Array.from(t.getClientRects())}function Wle(t){return r_(Pg(t)).left+BL(t).scrollLeft}function UJe(t){const e=Pg(t),n=BL(t),r=t.ownerDocument.body,i=wl(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),o=wl(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let a=-n.scrollLeft+Wle(t);const s=-n.scrollTop;return Rf(r).direction==="rtl"&&(a+=wl(e.clientWidth,r.clientWidth)-i),{width:i,height:o,x:a,y:s}}function GJe(t,e){const n=yc(t),r=Pg(t),i=n.visualViewport;let o=r.clientWidth,a=r.clientHeight,s=0,u=0;if(i){o=i.width,a=i.height;const d=KU();(!d||d&&e==="fixed")&&(s=i.offsetLeft,u=i.offsetTop)}return{width:o,height:a,x:s,y:u}}function jJe(t,e){const n=r_(t,!0,e==="fixed"),r=n.top+t.clientTop,i=n.left+t.clientLeft,o=Yd(t)?Ev(t):hA(1),a=t.clientWidth*o.x,s=t.clientHeight*o.y,u=i*o.x,d=r*o.y;return{width:a,height:s,x:u,y:d}}function mY(t,e,n){let r;if(e==="viewport")r=GJe(t,n);else if(e==="document")r=UJe(Pg(t));else if(xg(e))r=jJe(e,n);else{const i=Hle(t);r={...e,x:e.x-i.x,y:e.y-i.y}}return E1(r)}function qle(t,e){const n=S1(t);return n===e||!xg(n)||DL(n)?!1:Rf(n).position==="fixed"||qle(n,e)}function VJe(t,e){const n=e.get(t);if(n)return n;let r=ng(t,[],!1).filter(s=>xg(s)&&dA(s)!=="body"),i=null;const o=Rf(t).position==="fixed";let a=o?S1(t):t;for(;xg(a)&&!DL(a);){const s=Rf(a),u=QU(a);!u&&s.position==="fixed"&&(i=null),(o?!u&&!i:!u&&s.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||m2(a)&&!u&&qle(t,a))?r=r.filter(g=>g!==a):i=s,a=S1(a)}return e.set(t,r),r}function $Je(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const a=[...n==="clippingAncestors"?VJe(e,this._c):[].concat(n),r],s=a[0],u=a.reduce((d,g)=>{const _=mY(e,g,i);return d.top=wl(_.top,d.top),d.right=Fh(_.right,d.right),d.bottom=Fh(_.bottom,d.bottom),d.left=wl(_.left,d.left),d},mY(e,s,i));return{width:u.right-u.left,height:u.bottom-u.top,x:u.left,y:u.top}}function HJe(t){return $le(t)}function WJe(t,e,n){const r=Yd(e),i=Pg(e),o=n==="fixed",a=r_(t,!0,o,e);let s={scrollLeft:0,scrollTop:0};const u=hA(0);if(r||!r&&!o)if((dA(e)!=="body"||m2(i))&&(s=BL(e)),r){const d=r_(e,!0,o,e);u.x=d.x+e.clientLeft,u.y=d.y+e.clientTop}else i&&(u.x=Wle(i));return{x:a.left+s.scrollLeft-u.x,y:a.top+s.scrollTop-u.y,width:a.width,height:a.height}}function AY(t,e){return!Yd(t)||Rf(t).position==="fixed"?null:e?e(t):t.offsetParent}function Xle(t,e){const n=yc(t);if(!Yd(t))return n;let r=AY(t,e);for(;r&&DJe(r)&&Rf(r).position==="static";)r=AY(r,e);return r&&(dA(r)==="html"||dA(r)==="body"&&Rf(r).position==="static"&&!QU(r))?n:r||BJe(t)||n}const qJe=async function(t){let{reference:e,floating:n,strategy:r}=t;const i=this.getOffsetParent||Xle,o=this.getDimensions;return{reference:WJe(e,await i(n),r),floating:{x:0,y:0,...await o(n)}}};function XJe(t){return Rf(t).direction==="rtl"}const ZJe={convertOffsetParentRelativeRectToViewportRelativeRect:kJe,getDocumentElement:Pg,getClippingRect:$Je,getOffsetParent:Xle,getElementRects:qJe,getClientRects:zJe,getDimensions:HJe,getScale:Ev,isElement:xg,isRTL:XJe};function YJe(t,e){let n=null,r;const i=Pg(t);function o(){clearTimeout(r),n&&n.disconnect(),n=null}function a(s,u){s===void 0&&(s=!1),u===void 0&&(u=1),o();const{left:d,top:g,width:_,height:E}=t.getBoundingClientRect();if(s||e(),!_||!E)return;const P=CT(g),R=CT(i.clientWidth-(d+_)),B=CT(i.clientHeight-(g+E)),V=CT(d),F={rootMargin:-P+"px "+-R+"px "+-B+"px "+-V+"px",threshold:wl(0,Fh(1,u))||1};let k=!0;function X(Y){const J=Y[0].intersectionRatio;if(J!==u){if(!k)return a();J?a(!1,J):r=setTimeout(()=>{a(!1,1e-7)},100)}k=!1}try{n=new IntersectionObserver(X,{...F,root:i.ownerDocument})}catch{n=new IntersectionObserver(X,F)}n.observe(t)}return a(!0),o}function QJe(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:u=!1}=r,d=JU(t),g=i||o?[...d?ng(d):[],...ng(e)]:[];g.forEach(z=>{i&&z.addEventListener("scroll",n,{passive:!0}),o&&z.addEventListener("resize",n)});const _=d&&s?YJe(d,n):null;let E=-1,P=null;a&&(P=new ResizeObserver(z=>{let[F]=z;F&&F.target===d&&P&&(P.unobserve(e),cancelAnimationFrame(E),E=requestAnimationFrame(()=>{P&&P.observe(e)})),n()}),d&&!u&&P.observe(d),P.observe(e));let R,B=u?r_(t):null;u&&V();function V(){const z=r_(t);B&&(z.x!==B.x||z.y!==B.y||z.width!==B.width||z.height!==B.height)&&n(),B=z,R=requestAnimationFrame(V)}return n(),()=>{g.forEach(z=>{i&&z.removeEventListener("scroll",n),o&&z.removeEventListener("resize",n)}),_&&_(),P&&P.disconnect(),P=null,u&&cancelAnimationFrame(R)}}const KJe=(t,e,n)=>{const r=new Map,i={platform:ZJe,...n},o={...i.platform,_c:r};return IJe(t,e,{...i,platform:o})},Zle=t=>{const{element:e,padding:n}=t;function r(i){return Object.prototype.hasOwnProperty.call(i,"current")}return{name:"arrow",options:t,fn(i){return r(e)?e.current!=null?pY({element:e.current,padding:n}).fn(i):{}:e?pY({element:e,padding:n}).fn(i):{}}}};var mP=typeof document<"u"?we.useLayoutEffect:we.useEffect;function TM(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,i;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!TM(t[r],e[r]))return!1;return!0}if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;for(r=n;r--!==0;){const o=i[r];if(!(o==="_owner"&&t.$$typeof)&&!TM(t[o],e[o]))return!1}return!0}return t!==t&&e!==e}function _Y(t){const e=we.useRef(t);return mP(()=>{e.current=t}),e}function JJe(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:i,whileElementsMounted:o,open:a}=t,[s,u]=we.useState({x:null,y:null,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[d,g]=we.useState(r);TM(d,r)||g(r);const _=we.useRef(null),E=we.useRef(null),P=we.useRef(s),R=_Y(o),B=_Y(i),[V,z]=we.useState(null),[F,k]=we.useState(null),X=we.useCallback(ue=>{_.current!==ue&&(_.current=ue,z(ue))},[]),Y=we.useCallback(ue=>{E.current!==ue&&(E.current=ue,k(ue))},[]),J=we.useCallback(()=>{if(!_.current||!E.current)return;const ue={placement:e,strategy:n,middleware:d};B.current&&(ue.platform=B.current),KJe(_.current,E.current,ue).then(se=>{const me={...se,isPositioned:!0};ie.current&&!TM(P.current,me)&&(P.current=me,wE.flushSync(()=>{u(me)}))})},[d,e,n,B]);mP(()=>{a===!1&&P.current.isPositioned&&(P.current.isPositioned=!1,u(ue=>({...ue,isPositioned:!1})))},[a]);const ie=we.useRef(!1);mP(()=>(ie.current=!0,()=>{ie.current=!1}),[]),mP(()=>{if(V&&F){if(R.current)return R.current(V,F,J);J()}},[V,F,J,R]);const ce=we.useMemo(()=>({reference:_,floating:E,setReference:X,setFloating:Y}),[X,Y]),re=we.useMemo(()=>({reference:V,floating:F}),[V,F]);return we.useMemo(()=>({...s,update:J,refs:ce,elements:re,reference:X,floating:Y}),[s,J,ce,re,X,Y])}var T1=typeof document<"u"?we.useLayoutEffect:we.useEffect;let fN=!1,eet=0;const yY=()=>"floating-ui-"+eet++;function tet(){const[t,e]=we.useState(()=>fN?yY():void 0);return T1(()=>{t==null&&e(yY())},[]),we.useEffect(()=>{fN||(fN=!0)},[]),t}const net=wP["useId".toString()],vY=net||tet;function ret(){const t=new Map;return{emit(e,n){var r;(r=t.get(e))==null||r.forEach(i=>i(n))},on(e,n){t.set(e,[...t.get(e)||[],n])},off(e,n){t.set(e,(t.get(e)||[]).filter(r=>r!==n))}}}const iet=we.createContext(null),oet=we.createContext(null),Yle=()=>{var t;return((t=we.useContext(iet))==null?void 0:t.id)||null},e8=()=>we.useContext(oet);function Om(t){return(t==null?void 0:t.ownerDocument)||document}function set(){const t=navigator.userAgentData;return t!=null&&t.platform?t.platform:navigator.platform}function aet(){const t=navigator.userAgentData;return t&&Array.isArray(t.brands)?t.brands.map(e=>{let{brand:n,version:r}=e;return n+"/"+r}).join(" "):navigator.userAgent}function t8(t){return Om(t).defaultView||window}function Bd(t){return t?t instanceof t8(t).Element:!1}function Qle(t){return t?t instanceof t8(t).HTMLElement:!1}function uet(t){if(typeof ShadowRoot>"u")return!1;const e=t8(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function cet(t){if(t.mozInputSource===0&&t.isTrusted)return!0;const e=/Android/i;return(e.test(set())||e.test(aet()))&&t.pointerType?t.type==="click"&&t.buttons===1:t.detail===0&&!t.pointerType}function fet(t){return t.width===0&&t.height===0||t.width===1&&t.height===1&&t.pressure===0&&t.detail===0&&t.pointerType!=="mouse"||t.width<1&&t.height<1&&t.pressure===0&&t.detail===0}function Kle(t,e){const n=["mouse","pen"];return e||n.push("",void 0),n.includes(t)}function xY(t){const e=we.useRef(t);return T1(()=>{e.current=t}),e}const bY="data-floating-ui-safe-polygon";function AP(t,e,n){return n&&!Kle(n)?0:typeof t=="number"?t:t==null?void 0:t[e]}const het=function(t,e){let{enabled:n=!0,delay:r=0,handleClose:i=null,mouseOnly:o=!1,restMs:a=0,move:s=!0}=e===void 0?{}:e;const{open:u,onOpenChange:d,dataRef:g,events:_,elements:{domReference:E,floating:P},refs:R}=t,B=e8(),V=Yle(),z=xY(i),F=xY(r),k=we.useRef(),X=we.useRef(),Y=we.useRef(),J=we.useRef(),ie=we.useRef(!0),ce=we.useRef(!1),re=we.useRef(()=>{}),ue=we.useCallback(()=>{var be;const Ye=(be=g.current.openEvent)==null?void 0:be.type;return(Ye==null?void 0:Ye.includes("mouse"))&&Ye!=="mousedown"},[g]);we.useEffect(()=>{if(!n)return;function be(){clearTimeout(X.current),clearTimeout(J.current),ie.current=!0}return _.on("dismiss",be),()=>{_.off("dismiss",be)}},[n,_]),we.useEffect(()=>{if(!n||!z.current||!u)return;function be(){ue()&&d(!1)}const Ye=Om(P).documentElement;return Ye.addEventListener("mouseleave",be),()=>{Ye.removeEventListener("mouseleave",be)}},[P,u,d,n,z,g,ue]);const se=we.useCallback(function(be){be===void 0&&(be=!0);const Ye=AP(F.current,"close",k.current);Ye&&!Y.current?(clearTimeout(X.current),X.current=setTimeout(()=>d(!1),Ye)):be&&(clearTimeout(X.current),d(!1))},[F,d]),me=we.useCallback(()=>{re.current(),Y.current=void 0},[]),Ce=we.useCallback(()=>{if(ce.current){const be=Om(R.floating.current).body;be.style.pointerEvents="",be.removeAttribute(bY),ce.current=!1}},[R]);return we.useEffect(()=>{if(!n)return;function be(){return g.current.openEvent?["click","mousedown"].includes(g.current.openEvent.type):!1}function Ye(Ee){if(clearTimeout(X.current),ie.current=!1,o&&!Kle(k.current)||a>0&&AP(F.current,"open")===0)return;g.current.openEvent=Ee;const Ne=AP(F.current,"open",k.current);Ne?X.current=setTimeout(()=>{d(!0)},Ne):d(!0)}function tt(Ee){if(be())return;re.current();const Ne=Om(P);if(clearTimeout(J.current),z.current){u||clearTimeout(X.current),Y.current=z.current({...t,tree:B,x:Ee.clientX,y:Ee.clientY,onClose(){Ce(),me(),se()}});const Be=Y.current;Ne.addEventListener("mousemove",Be),re.current=()=>{Ne.removeEventListener("mousemove",Be)};return}se()}function pt(Ee){be()||z.current==null||z.current({...t,tree:B,x:Ee.clientX,y:Ee.clientY,onClose(){Ce(),me(),se()}})(Ee)}if(Bd(E)){const Ee=E;return u&&Ee.addEventListener("mouseleave",pt),P==null||P.addEventListener("mouseleave",pt),s&&Ee.addEventListener("mousemove",Ye,{once:!0}),Ee.addEventListener("mouseenter",Ye),Ee.addEventListener("mouseleave",tt),()=>{u&&Ee.removeEventListener("mouseleave",pt),P==null||P.removeEventListener("mouseleave",pt),s&&Ee.removeEventListener("mousemove",Ye),Ee.removeEventListener("mouseenter",Ye),Ee.removeEventListener("mouseleave",tt)}}},[E,P,n,t,o,a,s,se,me,Ce,d,u,B,F,z,g]),T1(()=>{var be;if(n&&u&&(be=z.current)!=null&&be.__options.blockPointerEvents&&ue()){const pt=Om(P).body;if(pt.setAttribute(bY,""),pt.style.pointerEvents="none",ce.current=!0,Bd(E)&&P){var Ye,tt;const Ee=E,Ne=B==null||(Ye=B.nodesRef.current.find(Be=>Be.id===V))==null||(tt=Ye.context)==null?void 0:tt.elements.floating;return Ne&&(Ne.style.pointerEvents=""),Ee.style.pointerEvents="auto",P.style.pointerEvents="auto",()=>{Ee.style.pointerEvents="",P.style.pointerEvents=""}}}},[n,u,V,P,E,B,z,g,ue]),T1(()=>{u||(k.current=void 0,me(),Ce())},[u,me,Ce]),we.useEffect(()=>()=>{me(),clearTimeout(X.current),clearTimeout(J.current),Ce()},[n,me,Ce]),we.useMemo(()=>{if(!n)return{};function be(Ye){k.current=Ye.pointerType}return{reference:{onPointerDown:be,onPointerEnter:be,onMouseMove(){u||a===0||(clearTimeout(J.current),J.current=setTimeout(()=>{ie.current||d(!0)},a))}},floating:{onMouseEnter(){clearTimeout(X.current)},onMouseLeave(){_.emit("dismiss",{type:"mouseLeave",data:{returnFocus:!1}}),se(!1)}}}},[_,n,a,u,d,se])},Jle=we.createContext({delay:0,initialDelay:0,timeoutMs:0,currentId:null,setCurrentId:()=>{},setState:()=>{},isInstantPhase:!1}),eue=()=>we.useContext(Jle),det=t=>{let{children:e,delay:n,timeoutMs:r=0}=t;const[i,o]=we.useReducer((u,d)=>({...u,...d}),{delay:n,timeoutMs:r,initialDelay:n,currentId:null,isInstantPhase:!1}),a=we.useRef(null),s=we.useCallback(u=>{o({currentId:u})},[]);return T1(()=>{i.currentId?a.current===null?a.current=i.currentId:o({isInstantPhase:!0}):(o({isInstantPhase:!1}),a.current=null)},[i.currentId]),we.createElement(Jle.Provider,{value:we.useMemo(()=>({...i,setState:o,setCurrentId:s}),[i,o,s])},e)},pet=(t,e)=>{let{open:n,onOpenChange:r}=t,{id:i}=e;const{currentId:o,setCurrentId:a,initialDelay:s,setState:u,timeoutMs:d}=eue();we.useEffect(()=>{o&&(u({delay:{open:1,close:AP(s,"close")}}),o!==i&&r(!1))},[i,r,u,o,s]),we.useEffect(()=>{function g(){r(!1),u({delay:s,currentId:null})}if(!n&&o===i)if(d){const _=window.setTimeout(g,d);return()=>{clearTimeout(_)}}else g()},[n,u,o,i,r,s,d]),we.useEffect(()=>{n&&a(i)},[n,a,i])};function get(t){let e=t.activeElement;for(;((n=e)==null||(r=n.shadowRoot)==null?void 0:r.activeElement)!=null;){var n,r;e=e.shadowRoot.activeElement}return e}function wY(t,e){if(!t||!e)return!1;const n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&uet(n)){let r=e;do{if(r&&t===r)return!0;r=r.parentNode||r.host}while(r)}return!1}function hN(t,e){let n=t.filter(i=>{var o;return i.parentId===e&&((o=i.context)==null?void 0:o.open)})||[],r=n;for(;r.length;)r=t.filter(i=>{var o;return(o=r)==null?void 0:o.some(a=>{var s;return i.parentId===a.id&&((s=i.context)==null?void 0:s.open)})})||[],n=n.concat(r);return n}function met(t){return"composedPath"in t?t.composedPath()[0]:t.target}const Aet=wP["useInsertionEffect".toString()],_et=Aet||(t=>t());function tue(t){const e=we.useRef(()=>{});return _et(()=>{e.current=t}),we.useCallback(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e.current==null?void 0:e.current(...r)},[])}function _P(t,e){if(e==null)return!1;if("composedPath"in t)return t.composedPath().includes(e);const n=t;return n.target!=null&&e.contains(n.target)}const yet={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},vet={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},xet=function(t){var e,n;return t===void 0&&(t=!0),{escapeKeyBubbles:typeof t=="boolean"?t:(e=t.escapeKey)!=null?e:!0,outsidePressBubbles:typeof t=="boolean"?t:(n=t.outsidePress)!=null?n:!0}},bet=function(t,e){let{open:n,onOpenChange:r,events:i,nodeId:o,elements:{reference:a,domReference:s,floating:u},dataRef:d}=t,{enabled:g=!0,escapeKey:_=!0,outsidePress:E=!0,outsidePressEvent:P="pointerdown",referencePress:R=!1,referencePressEvent:B="pointerdown",ancestorScroll:V=!1,bubbles:z=!0}=e===void 0?{}:e;const F=e8(),k=Yle()!=null,X=tue(typeof E=="function"?E:()=>!1),Y=typeof E=="function"?X:E,J=we.useRef(!1),{escapeKeyBubbles:ie,outsidePressBubbles:ce}=xet(z);return we.useEffect(()=>{if(!n||!g)return;d.current.__escapeKeyBubbles=ie,d.current.__outsidePressBubbles=ce;function re(be){if(be.key==="Escape"){const Ye=F?hN(F.nodesRef.current,o):[];if(Ye.length>0){let tt=!0;if(Ye.forEach(pt=>{var Ee;if((Ee=pt.context)!=null&&Ee.open&&!pt.context.dataRef.current.__escapeKeyBubbles){tt=!1;return}}),!tt)return}i.emit("dismiss",{type:"escapeKey",data:{returnFocus:{preventScroll:!1}}}),r(!1)}}function ue(be){const Ye=J.current;if(J.current=!1,Ye||typeof Y=="function"&&!Y(be))return;const tt=met(be);if(Qle(tt)&&u){const Ne=u.ownerDocument.defaultView||window,Be=tt.scrollWidth>tt.clientWidth,qe=tt.scrollHeight>tt.clientHeight;let ct=qe&&be.offsetX>tt.clientWidth;if(qe&&Ne.getComputedStyle(tt).direction==="rtl"&&(ct=be.offsetX<=tt.offsetWidth-tt.clientWidth),ct||Be&&be.offsetY>tt.clientHeight)return}const pt=F&&hN(F.nodesRef.current,o).some(Ne=>{var Be;return _P(be,(Be=Ne.context)==null?void 0:Be.elements.floating)});if(_P(be,u)||_P(be,s)||pt)return;const Ee=F?hN(F.nodesRef.current,o):[];if(Ee.length>0){let Ne=!0;if(Ee.forEach(Be=>{var qe;if((qe=Be.context)!=null&&qe.open&&!Be.context.dataRef.current.__outsidePressBubbles){Ne=!1;return}}),!Ne)return}i.emit("dismiss",{type:"outsidePress",data:{returnFocus:k?{preventScroll:!0}:cet(be)||fet(be)}}),r(!1)}function se(){r(!1)}const me=Om(u);_&&me.addEventListener("keydown",re),Y&&me.addEventListener(P,ue);let Ce=[];return V&&(Bd(s)&&(Ce=ng(s)),Bd(u)&&(Ce=Ce.concat(ng(u))),!Bd(a)&&a&&a.contextElement&&(Ce=Ce.concat(ng(a.contextElement)))),Ce=Ce.filter(be=>{var Ye;return be!==((Ye=me.defaultView)==null?void 0:Ye.visualViewport)}),Ce.forEach(be=>{be.addEventListener("scroll",se,{passive:!0})}),()=>{_&&me.removeEventListener("keydown",re),Y&&me.removeEventListener(P,ue),Ce.forEach(be=>{be.removeEventListener("scroll",se)})}},[d,u,s,a,_,Y,P,i,F,o,n,r,V,g,ie,ce,k]),we.useEffect(()=>{J.current=!1},[Y,P]),we.useMemo(()=>g?{reference:{[yet[B]]:()=>{R&&(i.emit("dismiss",{type:"referencePress",data:{returnFocus:!1}}),r(!1))}},floating:{[vet[P]]:()=>{J.current=!0}}}:{},[g,i,R,P,B,r])},wet=function(t,e){let{open:n,onOpenChange:r,dataRef:i,events:o,refs:a,elements:{floating:s,domReference:u}}=t,{enabled:d=!0,keyboardOnly:g=!0}=e===void 0?{}:e;const _=we.useRef(""),E=we.useRef(!1),P=we.useRef();return we.useEffect(()=>{if(!d)return;const B=Om(s).defaultView||window;function V(){!n&&Qle(u)&&u===get(Om(u))&&(E.current=!0)}return B.addEventListener("blur",V),()=>{B.removeEventListener("blur",V)}},[s,u,n,d]),we.useEffect(()=>{if(!d)return;function R(B){(B.type==="referencePress"||B.type==="escapeKey")&&(E.current=!0)}return o.on("dismiss",R),()=>{o.off("dismiss",R)}},[o,d]),we.useEffect(()=>()=>{clearTimeout(P.current)},[]),we.useMemo(()=>d?{reference:{onPointerDown(R){let{pointerType:B}=R;_.current=B,E.current=!!(B&&g)},onMouseLeave(){E.current=!1},onFocus(R){var B;E.current||R.type==="focus"&&((B=i.current.openEvent)==null?void 0:B.type)==="mousedown"&&i.current.openEvent&&_P(i.current.openEvent,u)||(i.current.openEvent=R.nativeEvent,r(!0))},onBlur(R){E.current=!1;const B=R.relatedTarget,V=Bd(B)&&B.hasAttribute("data-floating-ui-focus-guard")&&B.getAttribute("data-type")==="outside";P.current=setTimeout(()=>{wY(a.floating.current,B)||wY(u,B)||V||r(!1)})}}}:{},[d,g,u,a,i,r])},Eet=function(t,e){let{open:n}=t,{enabled:r=!0,role:i="dialog"}=e===void 0?{}:e;const o=vY(),a=vY();return we.useMemo(()=>{const s={id:o,role:i};return r?i==="tooltip"?{reference:{"aria-describedby":n?o:void 0},floating:s}:{reference:{"aria-expanded":n?"true":"false","aria-haspopup":i==="alertdialog"?"dialog":i,"aria-controls":n?o:void 0,...i==="listbox"&&{role:"combobox"},...i==="menu"&&{id:a}},floating:{...s,...i==="menu"&&{"aria-labelledby":a}}}:{}},[r,i,n,o,a])};function n8(t){t===void 0&&(t={});const{open:e=!1,onOpenChange:n,nodeId:r}=t,i=JJe(t),o=e8(),a=we.useRef(null),s=we.useRef({}),u=we.useState(()=>ret())[0],[d,g]=we.useState(null),_=we.useCallback(z=>{const F=Bd(z)?{getBoundingClientRect:()=>z.getBoundingClientRect(),contextElement:z}:z;i.refs.setReference(F)},[i.refs]),E=we.useCallback(z=>{(Bd(z)||z===null)&&(a.current=z,g(z)),(Bd(i.refs.reference.current)||i.refs.reference.current===null||z!==null&&!Bd(z))&&i.refs.setReference(z)},[i.refs]),P=we.useMemo(()=>({...i.refs,setReference:E,setPositionReference:_,domReference:a}),[i.refs,E,_]),R=we.useMemo(()=>({...i.elements,domReference:d}),[i.elements,d]),B=tue(n),V=we.useMemo(()=>({...i,refs:P,elements:R,dataRef:s,nodeId:r,events:u,open:e,onOpenChange:B}),[i,r,u,e,B,P,R]);return T1(()=>{const z=o==null?void 0:o.nodesRef.current.find(F=>F.id===r);z&&(z.context=V)}),we.useMemo(()=>({...i,context:V,refs:P,reference:E,positionReference:_}),[i,P,V,E,_])}function dN(t,e,n){const r=new Map;return{...n==="floating"&&{tabIndex:-1},...t,...e.map(i=>i?i[n]:null).concat(t).reduce((i,o)=>(o&&Object.entries(o).forEach(a=>{let[s,u]=a;if(s.indexOf("on")===0){if(r.has(s)||r.set(s,[]),typeof u=="function"){var d;(d=r.get(s))==null||d.push(u),i[s]=function(){for(var g,_=arguments.length,E=new Array(_),P=0;P<_;P++)E[P]=arguments[P];(g=r.get(s))==null||g.forEach(R=>R(...E))}}}else i[s]=u}),i),{})}}const Tet=function(t){t===void 0&&(t=[]);const e=t,n=we.useCallback(o=>dN(o,t,"reference"),e),r=we.useCallback(o=>dN(o,t,"floating"),e),i=we.useCallback(o=>dN(o,t,"item"),t.map(o=>o==null?void 0:o.item));return we.useMemo(()=>({getReferenceProps:n,getFloatingProps:r,getItemProps:i}),[n,r,i])};function nue({opened:t,floating:e,position:n,positionDependencies:r}){const[i,o]=we.useState(0);we.useEffect(()=>{if(e.refs.reference.current&&e.refs.floating.current)return QJe(e.refs.reference.current,e.refs.floating.current,e.update)},[e.refs.reference.current,e.refs.floating.current,t,i,n]),fA(()=>{e.update()},r),fA(()=>{o(a=>a+1)},[t])}function Cet(t){const e=[Gle(t.offset)];return t.middlewares.shift&&e.push(YU({limiter:RJe()})),t.middlewares.flip&&e.push(kle()),t.middlewares.inline&&e.push(Ule()),e.push(Zle({element:t.arrowRef,padding:t.arrowOffset})),e}function Pet(t){const[e,n]=jU({value:t.opened,defaultValue:t.defaultOpened,finalValue:!1,onChange:t.onChange}),r=()=>{var a;(a=t.onClose)==null||a.call(t),n(!1)},i=()=>{var a,s;e?((a=t.onClose)==null||a.call(t),n(!1)):((s=t.onOpen)==null||s.call(t),n(!0))},o=n8({placement:t.position,middleware:[...Cet(t),...t.width==="target"?[LJe({apply({rects:a}){var s,u;Object.assign((u=(s=o.refs.floating.current)==null?void 0:s.style)!=null?u:{},{width:`${a.reference.width}px`})}})]:[]]});return nue({opened:t.opened,position:t.position,positionDependencies:t.positionDependencies,floating:o}),fA(()=>{var a;(a=t.onPositionChange)==null||a.call(t,o.placement)},[o.placement]),fA(()=>{var a,s;t.opened?(s=t.onOpen)==null||s.call(t):(a=t.onClose)==null||a.call(t)},[t.opened]),{floating:o,controlled:typeof t.opened=="boolean",opened:e,onClose:r,onToggle:i}}const rue={context:"Popover component was not found in the tree",children:"Popover.Target component children should be an element or a component that accepts ref. Fragments, strings, numbers and other primitive values are not supported"},[Iet,iue]=AL(rue.context);var Met=Object.defineProperty,Oet=Object.defineProperties,Ret=Object.getOwnPropertyDescriptors,CM=Object.getOwnPropertySymbols,oue=Object.prototype.hasOwnProperty,sue=Object.prototype.propertyIsEnumerable,EY=(t,e,n)=>e in t?Met(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,PT=(t,e)=>{for(var n in e||(e={}))oue.call(e,n)&&EY(t,n,e[n]);if(CM)for(var n of CM(e))sue.call(e,n)&&EY(t,n,e[n]);return t},Let=(t,e)=>Oet(t,Ret(e)),Det=(t,e)=>{var n={};for(var r in t)oue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&CM)for(var r of CM(t))e.indexOf(r)<0&&sue.call(t,r)&&(n[r]=t[r]);return n};const Bet={refProp:"ref",popupType:"dialog",shouldOverrideDefaultTargetId:!0},aue=we.forwardRef((t,e)=>{const n=Gr("PopoverTarget",Bet,t),{children:r,refProp:i,popupType:o,shouldOverrideDefaultTargetId:a}=n,s=Det(n,["children","refProp","popupType","shouldOverrideDefaultTargetId"]);if(!c2(r))throw new Error(rue.children);const u=s,d=iue(),g=Y1(d.reference,r.ref,e),_=d.withRoles?{"aria-haspopup":o,"aria-expanded":d.opened,"aria-controls":d.getDropdownId(),id:a?d.getTargetId():r.props.id}:{};return we.cloneElement(r,PT(Let(PT(PT(PT({},u),_),d.targetProps),{className:Cae(d.targetProps.className,u.className,r.props.className),[i]:g}),d.controlled?null:{onClick:d.onToggle}))});aue.displayName="@mantine/core/PopoverTarget";var Net=no((t,{radius:e,shadow:n})=>({dropdown:{position:"absolute",backgroundColor:t.white,background:t.colorScheme==="dark"?t.colors.dark[6]:t.white,border:`${pn(1)} solid ${t.colorScheme==="dark"?t.colors.dark[4]:t.colors.gray[2]}`,padding:`${t.spacing.sm} ${t.spacing.md}`,boxShadow:t.shadows[n]||n||"none",borderRadius:t.fn.radius(e),"&:focus":{outline:0}},arrow:{backgroundColor:"inherit",border:`${pn(1)} solid ${t.colorScheme==="dark"?t.colors.dark[4]:t.colors.gray[2]}`,zIndex:1}}));const Fet=Net;var ket=Object.defineProperty,SY=Object.getOwnPropertySymbols,zet=Object.prototype.hasOwnProperty,Uet=Object.prototype.propertyIsEnumerable,TY=(t,e,n)=>e in t?ket(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ly=(t,e)=>{for(var n in e||(e={}))zet.call(e,n)&&TY(t,n,e[n]);if(SY)for(var n of SY(e))Uet.call(e,n)&&TY(t,n,e[n]);return t};const CY={entering:"in",entered:"in",exiting:"out",exited:"out","pre-exiting":"out","pre-entering":"out"};function Get({transition:t,state:e,duration:n,timingFunction:r}){const i={transitionDuration:`${n}ms`,transitionTimingFunction:r};return typeof t=="string"?t in bT?Ly(Ly(Ly({transitionProperty:bT[t].transitionProperty},i),bT[t].common),bT[t][CY[e]]):null:Ly(Ly(Ly({transitionProperty:t.transitionProperty},i),t.common),t[CY[e]])}function jet({duration:t,exitDuration:e,timingFunction:n,mounted:r,onEnter:i,onExit:o,onEntered:a,onExited:s}){const u=ip(),d=VU(),g=u.respectReducedMotion?d:!1,[_,E]=we.useState(g?0:t),[P,R]=we.useState(r?"entered":"exited"),B=we.useRef(-1),V=z=>{const F=z?i:o,k=z?a:s;R(z?"pre-entering":"pre-exiting"),window.clearTimeout(B.current);const X=g?0:z?t:e;if(E(X),X===0)typeof F=="function"&&F(),typeof k=="function"&&k(),R(z?"entered":"exited");else{const Y=window.setTimeout(()=>{typeof F=="function"&&F(),R(z?"entering":"exiting")},10);B.current=window.setTimeout(()=>{window.clearTimeout(Y),typeof k=="function"&&k(),R(z?"entered":"exited")},X)}};return fA(()=>{V(r)},[r]),we.useEffect(()=>()=>window.clearTimeout(B.current),[]),{transitionDuration:_,transitionStatus:P,transitionTimingFunction:n||u.transitionTimingFunction}}function A2({keepMounted:t,transition:e,duration:n=250,exitDuration:r=n,mounted:i,children:o,timingFunction:a,onExit:s,onEntered:u,onEnter:d,onExited:g}){const{transitionDuration:_,transitionStatus:E,transitionTimingFunction:P}=jet({mounted:i,exitDuration:r,duration:n,timingFunction:a,onExit:s,onEntered:u,onEnter:d,onExited:g});return _===0?i?ut.createElement(ut.Fragment,null,o({})):t?o({display:"none"}):null:E==="exited"?t?o({display:"none"}):null:ut.createElement(ut.Fragment,null,o(Get({transition:e,duration:_,state:E,timingFunction:P})))}A2.displayName="@mantine/core/Transition";function r8({children:t,active:e=!0,refProp:n="ref"}){const r=CQe(e),i=Y1(r,t==null?void 0:t.ref);return c2(t)?we.cloneElement(t,{[n]:i}):t}r8.displayName="@mantine/core/FocusTrap";var Vet=Object.defineProperty,$et=Object.defineProperties,Het=Object.getOwnPropertyDescriptors,PY=Object.getOwnPropertySymbols,Wet=Object.prototype.hasOwnProperty,qet=Object.prototype.propertyIsEnumerable,IY=(t,e,n)=>e in t?Vet(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Am=(t,e)=>{for(var n in e||(e={}))Wet.call(e,n)&&IY(t,n,e[n]);if(PY)for(var n of PY(e))qet.call(e,n)&&IY(t,n,e[n]);return t},IT=(t,e)=>$et(t,Het(e));function MY(t,e,n,r){return t==="center"||r==="center"?{top:e}:t==="end"?{bottom:n}:t==="start"?{top:n}:{}}function OY(t,e,n,r,i){return t==="center"||r==="center"?{left:e}:t==="end"?{[i==="ltr"?"right":"left"]:n}:t==="start"?{[i==="ltr"?"left":"right"]:n}:{}}const Xet={bottom:"borderTopLeftRadius",left:"borderTopRightRadius",right:"borderBottomLeftRadius",top:"borderBottomRightRadius"};function Zet({position:t,arrowSize:e,arrowOffset:n,arrowRadius:r,arrowPosition:i,arrowX:o,arrowY:a,dir:s}){const[u,d="center"]=t.split("-"),g={width:pn(e),height:pn(e),transform:"rotate(45deg)",position:"absolute",[Xet[u]]:pn(r)},_=pn(-e/2);return u==="left"?IT(Am(Am({},g),MY(d,a,n,i)),{right:_,borderLeftColor:"transparent",borderBottomColor:"transparent"}):u==="right"?IT(Am(Am({},g),MY(d,a,n,i)),{left:_,borderRightColor:"transparent",borderTopColor:"transparent"}):u==="top"?IT(Am(Am({},g),OY(d,o,n,i,s)),{bottom:_,borderTopColor:"transparent",borderLeftColor:"transparent"}):u==="bottom"?IT(Am(Am({},g),OY(d,o,n,i,s)),{top:_,borderBottomColor:"transparent",borderRightColor:"transparent"}):{}}var Yet=Object.defineProperty,Qet=Object.defineProperties,Ket=Object.getOwnPropertyDescriptors,PM=Object.getOwnPropertySymbols,lue=Object.prototype.hasOwnProperty,uue=Object.prototype.propertyIsEnumerable,RY=(t,e,n)=>e in t?Yet(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Jet=(t,e)=>{for(var n in e||(e={}))lue.call(e,n)&&RY(t,n,e[n]);if(PM)for(var n of PM(e))uue.call(e,n)&&RY(t,n,e[n]);return t},ett=(t,e)=>Qet(t,Ket(e)),ttt=(t,e)=>{var n={};for(var r in t)lue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&PM)for(var r of PM(t))e.indexOf(r)<0&&uue.call(t,r)&&(n[r]=t[r]);return n};const i8=we.forwardRef((t,e)=>{var n=t,{position:r,arrowSize:i,arrowOffset:o,arrowRadius:a,arrowPosition:s,visible:u,arrowX:d,arrowY:g}=n,_=ttt(n,["position","arrowSize","arrowOffset","arrowRadius","arrowPosition","visible","arrowX","arrowY"]);const E=ip();return u?ut.createElement("div",ett(Jet({},_),{ref:e,style:Zet({position:r,arrowSize:i,arrowOffset:o,arrowRadius:a,arrowPosition:s,dir:E.dir,arrowX:d,arrowY:g})})):null});i8.displayName="@mantine/core/FloatingArrow";var ntt=Object.defineProperty,rtt=Object.defineProperties,itt=Object.getOwnPropertyDescriptors,IM=Object.getOwnPropertySymbols,cue=Object.prototype.hasOwnProperty,fue=Object.prototype.propertyIsEnumerable,LY=(t,e,n)=>e in t?ntt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Dy=(t,e)=>{for(var n in e||(e={}))cue.call(e,n)&&LY(t,n,e[n]);if(IM)for(var n of IM(e))fue.call(e,n)&&LY(t,n,e[n]);return t},MT=(t,e)=>rtt(t,itt(e)),ott=(t,e)=>{var n={};for(var r in t)cue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&IM)for(var r of IM(t))e.indexOf(r)<0&&fue.call(t,r)&&(n[r]=t[r]);return n};const stt={};function hue(t){var e;const n=Gr("PopoverDropdown",stt,t),{style:r,className:i,children:o,onKeyDownCapture:a}=n,s=ott(n,["style","className","children","onKeyDownCapture"]),u=iue(),{classes:d,cx:g}=Fet({radius:u.radius,shadow:u.shadow},{name:u.__staticSelector,classNames:u.classNames,styles:u.styles,unstyled:u.unstyled,variant:u.variant}),_=Yae({opened:u.opened,shouldReturnFocus:u.returnFocus}),E=u.withRoles?{"aria-labelledby":u.getTargetId(),id:u.getDropdownId(),role:"dialog"}:{};return u.disabled?null:ut.createElement(g2,MT(Dy({},u.portalProps),{withinPortal:u.withinPortal}),ut.createElement(A2,MT(Dy({mounted:u.opened},u.transitionProps),{transition:u.transitionProps.transition||"fade",duration:(e=u.transitionProps.duration)!=null?e:150,keepMounted:u.keepMounted,exitDuration:typeof u.transitionProps.exitDuration=="number"?u.transitionProps.exitDuration:u.transitionProps.duration}),P=>{var R,B;return ut.createElement(r8,{active:u.trapFocus},ut.createElement(go,Dy(MT(Dy({},E),{tabIndex:-1,ref:u.floating,style:MT(Dy(Dy({},r),P),{zIndex:u.zIndex,top:(R=u.y)!=null?R:0,left:(B=u.x)!=null?B:0,width:u.width==="target"?void 0:pn(u.width)}),className:g(d.dropdown,i),onKeyDownCapture:JXe(u.onClose,{active:u.closeOnEscape,onTrigger:_,onKeyDown:a}),"data-position":u.placement}),s),o,ut.createElement(i8,{ref:u.arrowRef,arrowX:u.arrowX,arrowY:u.arrowY,visible:u.withArrow,position:u.placement,arrowSize:u.arrowSize,arrowRadius:u.arrowRadius,arrowOffset:u.arrowOffset,arrowPosition:u.arrowPosition,className:d.arrow})))}))}hue.displayName="@mantine/core/PopoverDropdown";function due(t,e){if(t==="rtl"&&(e.includes("right")||e.includes("left"))){const[n,r]=e.split("-"),i=n==="right"?"left":"right";return r===void 0?i:`${i}-${r}`}return e}var DY=Object.getOwnPropertySymbols,att=Object.prototype.hasOwnProperty,ltt=Object.prototype.propertyIsEnumerable,utt=(t,e)=>{var n={};for(var r in t)att.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&DY)for(var r of DY(t))e.indexOf(r)<0&&ltt.call(t,r)&&(n[r]=t[r]);return n};const ctt={position:"bottom",offset:8,positionDependencies:[],transitionProps:{transition:"fade",duration:150},middlewares:{flip:!0,shift:!0,inline:!1},arrowSize:7,arrowOffset:5,arrowRadius:0,arrowPosition:"side",closeOnClickOutside:!0,withinPortal:!1,closeOnEscape:!0,trapFocus:!1,withRoles:!0,returnFocus:!1,clickOutsideEvents:["mousedown","touchstart"],zIndex:d2("popover"),__staticSelector:"Popover",width:"max-content"};function K1(t){var e,n,r,i,o,a;const s=we.useRef(null),u=Gr("Popover",ctt,t),{children:d,position:g,offset:_,onPositionChange:E,positionDependencies:P,opened:R,transitionProps:B,width:V,middlewares:z,withArrow:F,arrowSize:k,arrowOffset:X,arrowRadius:Y,arrowPosition:J,unstyled:ie,classNames:ce,styles:re,closeOnClickOutside:ue,withinPortal:se,portalProps:me,closeOnEscape:Ce,clickOutsideEvents:be,trapFocus:Ye,onClose:tt,onOpen:pt,onChange:Ee,zIndex:Ne,radius:Be,shadow:qe,id:ct,defaultOpened:Ct,__staticSelector:Dt,withRoles:In,disabled:Mn,returnFocus:Tn,variant:Nt,keepMounted:Zt}=u,Wt=utt(u,["children","position","offset","onPositionChange","positionDependencies","opened","transitionProps","width","middlewares","withArrow","arrowSize","arrowOffset","arrowRadius","arrowPosition","unstyled","classNames","styles","closeOnClickOutside","withinPortal","portalProps","closeOnEscape","clickOutsideEvents","trapFocus","onClose","onOpen","onChange","zIndex","radius","shadow","id","defaultOpened","__staticSelector","withRoles","disabled","returnFocus","variant","keepMounted"]),[hn,lr]=we.useState(null),[It,Xt]=we.useState(null),$t=p2(ct),cn=ip(),Jt=Pet({middlewares:z,width:V,position:due(cn.dir,g),offset:typeof _=="number"?_+(F?k/2:0):_,arrowRef:s,arrowOffset:X,onPositionChange:E,positionDependencies:P,opened:R,defaultOpened:Ct,onChange:Ee,onOpen:pt,onClose:tt});AQe(()=>Jt.opened&&ue&&Jt.onClose(),be,[hn,It]);const Ln=we.useCallback(or=>{lr(or),Jt.floating.reference(or)},[Jt.floating.reference]),qn=we.useCallback(or=>{Xt(or),Jt.floating.floating(or)},[Jt.floating.floating]);return ut.createElement(Iet,{value:{returnFocus:Tn,disabled:Mn,controlled:Jt.controlled,reference:Ln,floating:qn,x:Jt.floating.x,y:Jt.floating.y,arrowX:(r=(n=(e=Jt.floating)==null?void 0:e.middlewareData)==null?void 0:n.arrow)==null?void 0:r.x,arrowY:(a=(o=(i=Jt.floating)==null?void 0:i.middlewareData)==null?void 0:o.arrow)==null?void 0:a.y,opened:Jt.opened,arrowRef:s,transitionProps:B,width:V,withArrow:F,arrowSize:k,arrowOffset:X,arrowRadius:Y,arrowPosition:J,placement:Jt.floating.placement,trapFocus:Ye,withinPortal:se,portalProps:me,zIndex:Ne,radius:Be,shadow:qe,closeOnEscape:Ce,onClose:Jt.onClose,onToggle:Jt.onToggle,getTargetId:()=>`${$t}-target`,getDropdownId:()=>`${$t}-dropdown`,withRoles:In,targetProps:Wt,__staticSelector:Dt,classNames:ce,styles:re,unstyled:ie,variant:Nt,keepMounted:Zt}},d)}K1.Target=aue;K1.Dropdown=hue;K1.displayName="@mantine/core/Popover";var ftt=Object.defineProperty,htt=Object.defineProperties,dtt=Object.getOwnPropertyDescriptors,MM=Object.getOwnPropertySymbols,pue=Object.prototype.hasOwnProperty,gue=Object.prototype.propertyIsEnumerable,BY=(t,e,n)=>e in t?ftt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,OT=(t,e)=>{for(var n in e||(e={}))pue.call(e,n)&&BY(t,n,e[n]);if(MM)for(var n of MM(e))gue.call(e,n)&&BY(t,n,e[n]);return t},ptt=(t,e)=>htt(t,dtt(e)),gtt=(t,e)=>{var n={};for(var r in t)pue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&MM)for(var r of MM(t))e.indexOf(r)<0&&gue.call(t,r)&&(n[r]=t[r]);return n};function mtt(t,e,n){const r=Gr(t,e,n),{label:i,description:o,error:a,required:s,classNames:u,styles:d,className:g,unstyled:_,__staticSelector:E,sx:P,errorProps:R,labelProps:B,descriptionProps:V,wrapperProps:z,id:F,size:k,style:X,inputContainer:Y,inputWrapperOrder:J,withAsterisk:ie,variant:ce}=r,re=gtt(r,["label","description","error","required","classNames","styles","className","unstyled","__staticSelector","sx","errorProps","labelProps","descriptionProps","wrapperProps","id","size","style","inputContainer","inputWrapperOrder","withAsterisk","variant"]),ue=p2(F),{systemStyles:se,rest:me}=$U(re),Ce=OT({label:i,description:o,error:a,required:s,classNames:u,className:g,__staticSelector:E,sx:P,errorProps:R,labelProps:B,descriptionProps:V,unstyled:_,styles:d,id:ue,size:k,style:X,inputContainer:Y,inputWrapperOrder:J,withAsterisk:ie,variant:ce},z);return ptt(OT({},me),{classNames:u,styles:d,unstyled:_,wrapperProps:OT(OT({},Ce),se),inputProps:{required:s,classNames:u,styles:d,unstyled:_,id:ue,size:k,__staticSelector:E,error:a,variant:ce}})}var Att=no((t,e,{size:n})=>({label:{display:"inline-block",fontSize:Zr({size:n,sizes:t.fontSizes}),fontWeight:500,color:t.colorScheme==="dark"?t.colors.dark[0]:t.colors.gray[9],wordBreak:"break-word",cursor:"default",WebkitTapHighlightColor:"transparent"},required:{color:t.fn.variant({variant:"filled",color:"red"}).background}}));const _tt=Att;var ytt=Object.defineProperty,OM=Object.getOwnPropertySymbols,mue=Object.prototype.hasOwnProperty,Aue=Object.prototype.propertyIsEnumerable,NY=(t,e,n)=>e in t?ytt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,vtt=(t,e)=>{for(var n in e||(e={}))mue.call(e,n)&&NY(t,n,e[n]);if(OM)for(var n of OM(e))Aue.call(e,n)&&NY(t,n,e[n]);return t},xtt=(t,e)=>{var n={};for(var r in t)mue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&OM)for(var r of OM(t))e.indexOf(r)<0&&Aue.call(t,r)&&(n[r]=t[r]);return n};const btt={labelElement:"label",size:"sm"},o8=we.forwardRef((t,e)=>{const n=Gr("InputLabel",btt,t),{labelElement:r,children:i,required:o,size:a,classNames:s,styles:u,unstyled:d,className:g,htmlFor:_,__staticSelector:E,variant:P,onMouseDown:R}=n,B=xtt(n,["labelElement","children","required","size","classNames","styles","unstyled","className","htmlFor","__staticSelector","variant","onMouseDown"]),{classes:V,cx:z}=_tt(null,{name:["InputWrapper",E],classNames:s,styles:u,unstyled:d,variant:P,size:a});return ut.createElement(go,vtt({component:r,ref:e,className:z(V.label,g),htmlFor:r==="label"?_:void 0,onMouseDown:F=>{R==null||R(F),!F.defaultPrevented&&F.detail>1&&F.preventDefault()}},B),i,o&&ut.createElement("span",{className:V.required,"aria-hidden":!0}," *"))});o8.displayName="@mantine/core/InputLabel";var wtt=no((t,e,{size:n})=>({error:{wordBreak:"break-word",color:t.fn.variant({variant:"filled",color:"red"}).background,fontSize:`calc(${Zr({size:n,sizes:t.fontSizes})} - ${pn(2)})`,lineHeight:1.2,display:"block"}}));const Ett=wtt;var Stt=Object.defineProperty,RM=Object.getOwnPropertySymbols,_ue=Object.prototype.hasOwnProperty,yue=Object.prototype.propertyIsEnumerable,FY=(t,e,n)=>e in t?Stt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ttt=(t,e)=>{for(var n in e||(e={}))_ue.call(e,n)&&FY(t,n,e[n]);if(RM)for(var n of RM(e))yue.call(e,n)&&FY(t,n,e[n]);return t},Ctt=(t,e)=>{var n={};for(var r in t)_ue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&RM)for(var r of RM(t))e.indexOf(r)<0&&yue.call(t,r)&&(n[r]=t[r]);return n};const Ptt={size:"sm"},s8=we.forwardRef((t,e)=>{const n=Gr("InputError",Ptt,t),{children:r,className:i,classNames:o,styles:a,unstyled:s,size:u,__staticSelector:d,variant:g}=n,_=Ctt(n,["children","className","classNames","styles","unstyled","size","__staticSelector","variant"]),{classes:E,cx:P}=Ett(null,{name:["InputWrapper",d],classNames:o,styles:a,unstyled:s,variant:g,size:u});return ut.createElement(Nh,Ttt({className:P(E.error,i),ref:e},_),r)});s8.displayName="@mantine/core/InputError";var Itt=no((t,e,{size:n})=>({description:{wordBreak:"break-word",color:t.colorScheme==="dark"?t.colors.dark[2]:t.colors.gray[6],fontSize:`calc(${Zr({size:n,sizes:t.fontSizes})} - ${pn(2)})`,lineHeight:1.2,display:"block"}}));const Mtt=Itt;var Ott=Object.defineProperty,LM=Object.getOwnPropertySymbols,vue=Object.prototype.hasOwnProperty,xue=Object.prototype.propertyIsEnumerable,kY=(t,e,n)=>e in t?Ott(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Rtt=(t,e)=>{for(var n in e||(e={}))vue.call(e,n)&&kY(t,n,e[n]);if(LM)for(var n of LM(e))xue.call(e,n)&&kY(t,n,e[n]);return t},Ltt=(t,e)=>{var n={};for(var r in t)vue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&LM)for(var r of LM(t))e.indexOf(r)<0&&xue.call(t,r)&&(n[r]=t[r]);return n};const Dtt={size:"sm"},a8=we.forwardRef((t,e)=>{const n=Gr("InputDescription",Dtt,t),{children:r,className:i,classNames:o,styles:a,unstyled:s,size:u,__staticSelector:d,variant:g}=n,_=Ltt(n,["children","className","classNames","styles","unstyled","size","__staticSelector","variant"]),{classes:E,cx:P}=Mtt(null,{name:["InputWrapper",d],classNames:o,styles:a,unstyled:s,variant:g,size:u});return ut.createElement(Nh,Rtt({color:"dimmed",className:P(E.description,i),ref:e,unstyled:s},_),r)});a8.displayName="@mantine/core/InputDescription";const bue=we.createContext({offsetBottom:!1,offsetTop:!1,describedBy:void 0}),Btt=bue.Provider,Ntt=()=>we.useContext(bue);function Ftt(t,{hasDescription:e,hasError:n}){const r=t.findIndex(u=>u==="input"),i=t[r-1],o=t[r+1];return{offsetBottom:e&&o==="description"||n&&o==="error",offsetTop:e&&i==="description"||n&&i==="error"}}var ktt=Object.defineProperty,ztt=Object.defineProperties,Utt=Object.getOwnPropertyDescriptors,zY=Object.getOwnPropertySymbols,Gtt=Object.prototype.hasOwnProperty,jtt=Object.prototype.propertyIsEnumerable,UY=(t,e,n)=>e in t?ktt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Vtt=(t,e)=>{for(var n in e||(e={}))Gtt.call(e,n)&&UY(t,n,e[n]);if(zY)for(var n of zY(e))jtt.call(e,n)&&UY(t,n,e[n]);return t},$tt=(t,e)=>ztt(t,Utt(e)),Htt=no(t=>({root:$tt(Vtt({},t.fn.fontStyles()),{lineHeight:t.lineHeight})}));const Wtt=Htt;var qtt=Object.defineProperty,Xtt=Object.defineProperties,Ztt=Object.getOwnPropertyDescriptors,DM=Object.getOwnPropertySymbols,wue=Object.prototype.hasOwnProperty,Eue=Object.prototype.propertyIsEnumerable,GY=(t,e,n)=>e in t?qtt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_m=(t,e)=>{for(var n in e||(e={}))wue.call(e,n)&&GY(t,n,e[n]);if(DM)for(var n of DM(e))Eue.call(e,n)&&GY(t,n,e[n]);return t},jY=(t,e)=>Xtt(t,Ztt(e)),Ytt=(t,e)=>{var n={};for(var r in t)wue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&DM)for(var r of DM(t))e.indexOf(r)<0&&Eue.call(t,r)&&(n[r]=t[r]);return n};const Qtt={labelElement:"label",size:"sm",inputContainer:t=>t,inputWrapperOrder:["label","description","input","error"]},Sue=we.forwardRef((t,e)=>{const n=Gr("InputWrapper",Qtt,t),{className:r,label:i,children:o,required:a,id:s,error:u,description:d,labelElement:g,labelProps:_,descriptionProps:E,errorProps:P,classNames:R,styles:B,size:V,inputContainer:z,__staticSelector:F,unstyled:k,inputWrapperOrder:X,withAsterisk:Y,variant:J}=n,ie=Ytt(n,["className","label","children","required","id","error","description","labelElement","labelProps","descriptionProps","errorProps","classNames","styles","size","inputContainer","__staticSelector","unstyled","inputWrapperOrder","withAsterisk","variant"]),{classes:ce,cx:re}=Wtt(null,{classNames:R,styles:B,name:["InputWrapper",F],unstyled:k,variant:J,size:V}),ue={classNames:R,styles:B,unstyled:k,size:V,variant:J,__staticSelector:F},se=typeof Y=="boolean"?Y:a,me=s?`${s}-error`:P==null?void 0:P.id,Ce=s?`${s}-description`:E==null?void 0:E.id,Ye=`${!!u&&typeof u!="boolean"?me:""} ${d?Ce:""}`,tt=Ye.trim().length>0?Ye.trim():void 0,pt=i&&ut.createElement(o8,_m(_m({key:"label",labelElement:g,id:s?`${s}-label`:void 0,htmlFor:s,required:se},ue),_),i),Ee=d&&ut.createElement(a8,jY(_m(_m({key:"description"},E),ue),{size:(E==null?void 0:E.size)||ue.size,id:(E==null?void 0:E.id)||Ce}),d),Ne=ut.createElement(we.Fragment,{key:"input"},z(o)),Be=typeof u!="boolean"&&u&&ut.createElement(s8,jY(_m(_m({},P),ue),{size:(P==null?void 0:P.size)||ue.size,key:"error",id:(P==null?void 0:P.id)||me}),u),qe=X.map(ct=>{switch(ct){case"label":return pt;case"input":return Ne;case"description":return Ee;case"error":return Be;default:return null}});return ut.createElement(Btt,{value:_m({describedBy:tt},Ftt(X,{hasDescription:!!Ee,hasError:!!Be}))},ut.createElement(go,_m({className:re(ce.root,r),ref:e},ie),qe))});Sue.displayName="@mantine/core/InputWrapper";var Ktt=Object.defineProperty,BM=Object.getOwnPropertySymbols,Tue=Object.prototype.hasOwnProperty,Cue=Object.prototype.propertyIsEnumerable,VY=(t,e,n)=>e in t?Ktt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Jtt=(t,e)=>{for(var n in e||(e={}))Tue.call(e,n)&&VY(t,n,e[n]);if(BM)for(var n of BM(e))Cue.call(e,n)&&VY(t,n,e[n]);return t},ent=(t,e)=>{var n={};for(var r in t)Tue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&BM)for(var r of BM(t))e.indexOf(r)<0&&Cue.call(t,r)&&(n[r]=t[r]);return n};const tnt={},Pue=we.forwardRef((t,e)=>{const n=Gr("InputPlaceholder",tnt,t),{sx:r}=n,i=ent(n,["sx"]);return ut.createElement(go,Jtt({component:"span",sx:[o=>o.fn.placeholderStyles(),...QXe(r)],ref:e},i))});Pue.displayName="@mantine/core/InputPlaceholder";var nnt=Object.defineProperty,rnt=Object.defineProperties,int=Object.getOwnPropertyDescriptors,$Y=Object.getOwnPropertySymbols,ont=Object.prototype.hasOwnProperty,snt=Object.prototype.propertyIsEnumerable,HY=(t,e,n)=>e in t?nnt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,RT=(t,e)=>{for(var n in e||(e={}))ont.call(e,n)&&HY(t,n,e[n]);if($Y)for(var n of $Y(e))snt.call(e,n)&&HY(t,n,e[n]);return t},pN=(t,e)=>rnt(t,int(e));const yd={xs:pn(30),sm:pn(36),md:pn(42),lg:pn(50),xl:pn(60)},ant=["default","filled","unstyled"];function lnt({theme:t,variant:e}){return ant.includes(e)?e==="default"?{border:`${pn(1)} solid ${t.colorScheme==="dark"?t.colors.dark[4]:t.colors.gray[4]}`,backgroundColor:t.colorScheme==="dark"?t.colors.dark[6]:t.white,transition:"border-color 100ms ease","&:focus, &:focus-within":t.focusRingStyles.inputStyles(t)}:e==="filled"?{border:`${pn(1)} solid transparent`,backgroundColor:t.colorScheme==="dark"?t.colors.dark[5]:t.colors.gray[1],"&:focus, &:focus-within":t.focusRingStyles.inputStyles(t)}:{borderWidth:0,color:t.colorScheme==="dark"?t.colors.dark[0]:t.black,backgroundColor:"transparent",minHeight:pn(28),outline:0,"&:focus, &:focus-within":{outline:"none",borderColor:"transparent"},"&:disabled":{backgroundColor:"transparent","&:focus, &:focus-within":{outline:"none",borderColor:"transparent"}}}:null}var unt=no((t,{multiline:e,radius:n,invalid:r,rightSectionWidth:i,withRightSection:o,iconWidth:a,offsetBottom:s,offsetTop:u,pointer:d},{variant:g,size:_})=>{const E=t.fn.variant({variant:"filled",color:"red"}).background,P=g==="default"||g==="filled"?{minHeight:Zr({size:_,sizes:yd}),paddingLeft:`calc(${Zr({size:_,sizes:yd})}  / 3)`,paddingRight:o?i||Zr({size:_,sizes:yd}):`calc(${Zr({size:_,sizes:yd})}  / 3)`,borderRadius:t.fn.radius(n)}:g==="unstyled"&&o?{paddingRight:i||Zr({size:_,sizes:yd})}:null;return{wrapper:{position:"relative",marginTop:u?`calc(${t.spacing.xs} / 2)`:void 0,marginBottom:s?`calc(${t.spacing.xs} / 2)`:void 0,"&:has(input:disabled)":{"& .mantine-Input-rightSection":{display:"none"}}},input:pN(RT(RT(pN(RT({},t.fn.fontStyles()),{height:e?g==="unstyled"?void 0:"auto":Zr({size:_,sizes:yd}),WebkitTapHighlightColor:"transparent",lineHeight:e?t.lineHeight:`calc(${Zr({size:_,sizes:yd})} - ${pn(2)})`,appearance:"none",resize:"none",boxSizing:"border-box",fontSize:Zr({size:_,sizes:t.fontSizes}),width:"100%",color:t.colorScheme==="dark"?t.colors.dark[0]:t.black,display:"block",textAlign:"left",cursor:d?"pointer":void 0}),lnt({theme:t,variant:g})),P),{"&:disabled, &[data-disabled]":{backgroundColor:t.colorScheme==="dark"?t.colors.dark[6]:t.colors.gray[1],color:t.colors.dark[2],opacity:.6,cursor:"not-allowed",pointerEvents:"none","&::placeholder":{color:t.colors.dark[2]}},"&[data-invalid]":{color:E,borderColor:E,"&::placeholder":{opacity:1,color:E}},"&[data-with-icon]":{paddingLeft:typeof a=="number"?pn(a):Zr({size:_,sizes:yd})},"&::placeholder":pN(RT({},t.fn.placeholderStyles()),{opacity:1}),"&::-webkit-inner-spin-button, &::-webkit-outer-spin-button, &::-webkit-search-decoration, &::-webkit-search-cancel-button, &::-webkit-search-results-button, &::-webkit-search-results-decoration":{appearance:"none"},"&[type=number]":{MozAppearance:"textfield"}}),icon:{pointerEvents:"none",position:"absolute",zIndex:1,left:0,top:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",width:a?pn(a):Zr({size:_,sizes:yd}),color:r?t.colors.red[t.colorScheme==="dark"?6:7]:t.colorScheme==="dark"?t.colors.dark[2]:t.colors.gray[5]},rightSection:{position:"absolute",top:0,bottom:0,right:0,display:"flex",alignItems:"center",justifyContent:"center",width:i||Zr({size:_,sizes:yd})}}});const cnt=unt;var fnt=Object.defineProperty,hnt=Object.defineProperties,dnt=Object.getOwnPropertyDescriptors,NM=Object.getOwnPropertySymbols,Iue=Object.prototype.hasOwnProperty,Mue=Object.prototype.propertyIsEnumerable,WY=(t,e,n)=>e in t?fnt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,LT=(t,e)=>{for(var n in e||(e={}))Iue.call(e,n)&&WY(t,n,e[n]);if(NM)for(var n of NM(e))Mue.call(e,n)&&WY(t,n,e[n]);return t},qY=(t,e)=>hnt(t,dnt(e)),pnt=(t,e)=>{var n={};for(var r in t)Iue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&NM)for(var r of NM(t))e.indexOf(r)<0&&Mue.call(t,r)&&(n[r]=t[r]);return n};const gnt={size:"sm",variant:"default"},S_=we.forwardRef((t,e)=>{const n=Gr("Input",gnt,t),{className:r,error:i,required:o,disabled:a,variant:s,icon:u,style:d,rightSectionWidth:g,iconWidth:_,rightSection:E,rightSectionProps:P,radius:R,size:B,wrapperProps:V,classNames:z,styles:F,__staticSelector:k,multiline:X,sx:Y,unstyled:J,pointer:ie}=n,ce=pnt(n,["className","error","required","disabled","variant","icon","style","rightSectionWidth","iconWidth","rightSection","rightSectionProps","radius","size","wrapperProps","classNames","styles","__staticSelector","multiline","sx","unstyled","pointer"]),{offsetBottom:re,offsetTop:ue,describedBy:se}=Ntt(),{classes:me,cx:Ce}=cnt({radius:R,multiline:X,invalid:!!i,rightSectionWidth:g?pn(g):void 0,iconWidth:_,withRightSection:!!E,offsetBottom:re,offsetTop:ue,pointer:ie},{classNames:z,styles:F,name:["Input",k],unstyled:J,variant:s,size:B}),{systemStyles:be,rest:Ye}=$U(ce);return ut.createElement(go,LT(LT({className:Ce(me.wrapper,r),sx:Y,style:d},be),V),u&&ut.createElement("div",{className:me.icon},u),ut.createElement(go,qY(LT({component:"input"},Ye),{ref:e,required:o,"aria-invalid":!!i,"aria-describedby":se,disabled:a,"data-disabled":a||void 0,"data-with-icon":!!u||void 0,"data-invalid":!!i||void 0,className:me.input})),E&&ut.createElement("div",qY(LT({},P),{className:me.rightSection}),E))});S_.displayName="@mantine/core/Input";S_.Wrapper=Sue;S_.Label=o8;S_.Description=a8;S_.Error=s8;S_.Placeholder=Pue;const gN=S_;var mnt=no((t,{radius:e,shadow:n})=>({root:{outline:0,WebkitTapHighlightColor:"transparent",display:"block",textDecoration:"none",color:t.colorScheme==="dark"?t.colors.dark[0]:t.black,backgroundColor:t.colorScheme==="dark"?t.colors.dark[7]:t.white,boxSizing:"border-box",borderRadius:t.fn.radius(e),boxShadow:t.shadows[n]||n||"none","&[data-with-border]":{border:`${pn(1)} solid ${t.colorScheme==="dark"?t.colors.dark[4]:t.colors.gray[3]}`}}}));const Ant=mnt;var _nt=Object.defineProperty,FM=Object.getOwnPropertySymbols,Oue=Object.prototype.hasOwnProperty,Rue=Object.prototype.propertyIsEnumerable,XY=(t,e,n)=>e in t?_nt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ynt=(t,e)=>{for(var n in e||(e={}))Oue.call(e,n)&&XY(t,n,e[n]);if(FM)for(var n of FM(e))Rue.call(e,n)&&XY(t,n,e[n]);return t},vnt=(t,e)=>{var n={};for(var r in t)Oue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&FM)for(var r of FM(t))e.indexOf(r)<0&&Rue.call(t,r)&&(n[r]=t[r]);return n};const xnt={},Lue=we.forwardRef((t,e)=>{const n=Gr("Paper",xnt,t),{className:r,children:i,radius:o,withBorder:a,shadow:s,unstyled:u,variant:d}=n,g=vnt(n,["className","children","radius","withBorder","shadow","unstyled","variant"]),{classes:_,cx:E}=Ant({radius:o,shadow:s},{name:"Paper",unstyled:u,variant:d});return ut.createElement(go,ynt({className:E(_.root,r),"data-with-border":a||void 0,ref:e},g),i)});Lue.displayName="@mantine/core/Paper";const bnt=Lue;var wnt=no((t,{inline:e})=>({root:{display:e?"inline-flex":"flex",alignItems:"center",justifyContent:"center"}}));const Ent=wnt;var Snt=Object.defineProperty,kM=Object.getOwnPropertySymbols,Due=Object.prototype.hasOwnProperty,Bue=Object.prototype.propertyIsEnumerable,ZY=(t,e,n)=>e in t?Snt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Tnt=(t,e)=>{for(var n in e||(e={}))Due.call(e,n)&&ZY(t,n,e[n]);if(kM)for(var n of kM(e))Bue.call(e,n)&&ZY(t,n,e[n]);return t},Cnt=(t,e)=>{var n={};for(var r in t)Due.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&kM)for(var r of kM(t))e.indexOf(r)<0&&Bue.call(t,r)&&(n[r]=t[r]);return n};const Nue=we.forwardRef((t,e)=>{const n=Gr("Center",{},t),{inline:r,className:i,unstyled:o,variant:a}=n,s=Cnt(n,["inline","className","unstyled","variant"]),{classes:u,cx:d}=Ent({inline:r},{name:"Center",unstyled:o,variant:a});return ut.createElement(go,Tnt({ref:e,className:d(u.root,i)},s))});Nue.displayName="@mantine/core/Center";const l8=Nue,[Pnt,J1]=AL("ModalBase component was not found in tree");var Int=no(()=>({close:{marginLeft:"auto",marginRight:0}}));const Mnt=Int;var Ont=Object.defineProperty,zM=Object.getOwnPropertySymbols,Fue=Object.prototype.hasOwnProperty,kue=Object.prototype.propertyIsEnumerable,YY=(t,e,n)=>e in t?Ont(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Rnt=(t,e)=>{for(var n in e||(e={}))Fue.call(e,n)&&YY(t,n,e[n]);if(zM)for(var n of zM(e))kue.call(e,n)&&YY(t,n,e[n]);return t},Lnt=(t,e)=>{var n={};for(var r in t)Fue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&zM)for(var r of zM(t))e.indexOf(r)<0&&kue.call(t,r)&&(n[r]=t[r]);return n};const Dnt={size:"sm"},Bnt=we.forwardRef((t,e)=>{const n=J1(),r=Gr(`${n.__staticSelector}CloseButton`,Dnt,t),{className:i}=r,o=Lnt(r,["className"]),{classes:a,cx:s}=Mnt(null,n.stylesApi);return ut.createElement(Ole,Rnt({className:s(a.close,i),ref:e,onClick:n.onClose},o))});var Nnt=no(()=>({overlay:{}}));const Fnt=Nnt;var knt=Object.defineProperty,znt=Object.defineProperties,Unt=Object.getOwnPropertyDescriptors,QY=Object.getOwnPropertySymbols,Gnt=Object.prototype.hasOwnProperty,jnt=Object.prototype.propertyIsEnumerable,KY=(t,e,n)=>e in t?knt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Vnt=(t,e)=>{for(var n in e||(e={}))Gnt.call(e,n)&&KY(t,n,e[n]);if(QY)for(var n of QY(e))jnt.call(e,n)&&KY(t,n,e[n]);return t},$nt=(t,e)=>znt(t,Unt(e)),Hnt=no((t,{color:e,opacity:n,blur:r,radius:i,gradient:o,fixed:a,zIndex:s})=>({root:$nt(Vnt({},t.fn.cover(0)),{position:a?"fixed":"absolute",backgroundColor:o?void 0:t.fn.rgba(e,n),backgroundImage:o,backdropFilter:r?`blur(${pn(r)})`:void 0,borderRadius:t.fn.radius(i),zIndex:s,"&[data-center]":{display:"flex",alignItems:"center",justifyContent:"center"}})}));const Wnt=Hnt;var qnt=Object.defineProperty,UM=Object.getOwnPropertySymbols,zue=Object.prototype.hasOwnProperty,Uue=Object.prototype.propertyIsEnumerable,JY=(t,e,n)=>e in t?qnt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Xnt=(t,e)=>{for(var n in e||(e={}))zue.call(e,n)&&JY(t,n,e[n]);if(UM)for(var n of UM(e))Uue.call(e,n)&&JY(t,n,e[n]);return t},Znt=(t,e)=>{var n={};for(var r in t)zue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&UM)for(var r of UM(t))e.indexOf(r)<0&&Uue.call(t,r)&&(n[r]=t[r]);return n};const Ynt={opacity:.6,color:"#000",zIndex:d2("modal"),radius:0},Gue=we.forwardRef((t,e)=>{const n=Gr("Overlay",Ynt,t),{variant:r,opacity:i,color:o,blur:a,gradient:s,zIndex:u,radius:d,children:g,className:_,classNames:E,styles:P,unstyled:R,center:B,fixed:V}=n,z=Znt(n,["variant","opacity","color","blur","gradient","zIndex","radius","children","className","classNames","styles","unstyled","center","fixed"]),{classes:F,cx:k}=Wnt({color:o,opacity:i,blur:a,radius:d,gradient:s,fixed:V,zIndex:u},{name:"Overlay",classNames:E,styles:P,unstyled:R,variant:r});return ut.createElement(go,Xnt({ref:e,className:k(F.root,_),"data-center":B||void 0},z),g)});Gue.displayName="@mantine/core/Overlay";const Qnt=Gue;var Knt=Object.defineProperty,Jnt=Object.defineProperties,ert=Object.getOwnPropertyDescriptors,GM=Object.getOwnPropertySymbols,jue=Object.prototype.hasOwnProperty,Vue=Object.prototype.propertyIsEnumerable,eQ=(t,e,n)=>e in t?Knt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Fb=(t,e)=>{for(var n in e||(e={}))jue.call(e,n)&&eQ(t,n,e[n]);if(GM)for(var n of GM(e))Vue.call(e,n)&&eQ(t,n,e[n]);return t},trt=(t,e)=>Jnt(t,ert(e)),nrt=(t,e)=>{var n={};for(var r in t)jue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&GM)for(var r of GM(t))e.indexOf(r)<0&&Vue.call(t,r)&&(n[r]=t[r]);return n};const rrt={},irt=we.forwardRef((t,e)=>{const n=J1(),r=Gr(`${n.__staticSelector}Overlay`,rrt,t),{onClick:i,transitionProps:o,style:a,className:s}=r,u=nrt(r,["onClick","transitionProps","style","className"]),{classes:d,cx:g}=Fnt(null,n.stylesApi),_=E=>{i==null||i(E),n.closeOnClickOutside&&n.onClose()};return ut.createElement(A2,trt(Fb(Fb({mounted:n.opened},n.transitionProps),o),{transition:"fade"}),E=>ut.createElement(Qnt,Fb({ref:e,onClick:_,fixed:!0,style:Fb(Fb({},a),E),className:g(d.overlay,s),zIndex:n.zIndex},u)))});var ort=no((t,{zIndex:e})=>({inner:{position:"fixed",width:"100%",top:0,bottom:0,maxHeight:"100%",zIndex:e,pointerEvents:"none"},content:{pointerEvents:"all"}}));const srt=ort;var art=Object.defineProperty,jM=Object.getOwnPropertySymbols,$ue=Object.prototype.hasOwnProperty,Hue=Object.prototype.propertyIsEnumerable,tQ=(t,e,n)=>e in t?art(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,kb=(t,e)=>{for(var n in e||(e={}))$ue.call(e,n)&&tQ(t,n,e[n]);if(jM)for(var n of jM(e))Hue.call(e,n)&&tQ(t,n,e[n]);return t},lrt=(t,e)=>{var n={};for(var r in t)$ue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&jM)for(var r of jM(t))e.indexOf(r)<0&&Hue.call(t,r)&&(n[r]=t[r]);return n};const urt={},crt=we.forwardRef((t,e)=>{const n=J1(),r=Gr(`${n.__staticSelector}Content`,urt,t),{className:i,transitionProps:o,style:a,onKeyDown:s}=r,u=lrt(r,["className","transitionProps","style","onKeyDown"]),{classes:d,cx:g}=srt({zIndex:n.zIndex},n.stylesApi),_=E=>{var P;((P=E.target)==null?void 0:P.getAttribute("data-mantine-stop-propagation"))!=="true"&&E.key==="Escape"&&n.closeOnEscape&&n.onClose(),s==null||s(E)};return ut.createElement(A2,kb(kb({mounted:n.opened,transition:"pop"},n.transitionProps),o),E=>ut.createElement("div",{className:g(d.inner)},ut.createElement(r8,{active:n.opened&&n.trapFocus},ut.createElement(bnt,kb({component:"section",role:"dialog",tabIndex:-1,"aria-modal":!0,"aria-describedby":n.bodyMounted?n.getBodyId():void 0,"aria-labelledby":n.titleMounted?n.getTitleId():void 0,onKeyDown:_,ref:e,className:g(d.content,i),style:kb(kb({},a),E),shadow:n.shadow},u),u.children))))});var frt=no((t,{padding:e})=>{const n=Zr({size:e,sizes:t.spacing});return{header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:n,paddingRight:`calc(${n} - ${pn(5)})`,position:"sticky",top:0,backgroundColor:t.colorScheme==="dark"?t.colors.dark[7]:t.white,zIndex:1e3}}});const hrt=frt;var drt=Object.defineProperty,VM=Object.getOwnPropertySymbols,Wue=Object.prototype.hasOwnProperty,que=Object.prototype.propertyIsEnumerable,nQ=(t,e,n)=>e in t?drt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,prt=(t,e)=>{for(var n in e||(e={}))Wue.call(e,n)&&nQ(t,n,e[n]);if(VM)for(var n of VM(e))que.call(e,n)&&nQ(t,n,e[n]);return t},grt=(t,e)=>{var n={};for(var r in t)Wue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&VM)for(var r of VM(t))e.indexOf(r)<0&&que.call(t,r)&&(n[r]=t[r]);return n};const mrt={},Art=we.forwardRef((t,e)=>{const n=J1(),r=Gr(`${n.__staticSelector}Header`,mrt,t),{className:i}=r,o=grt(r,["className"]),{classes:a,cx:s}=hrt({padding:n.padding},n.stylesApi);return ut.createElement(go,prt({ref:e,className:s(a.header,i)},o))});var _rt=no(t=>({title:{lineHeight:1,padding:0,margin:0,fontWeight:400,fontSize:t.fontSizes.md}}));const yrt=_rt;var vrt=Object.defineProperty,$M=Object.getOwnPropertySymbols,Xue=Object.prototype.hasOwnProperty,Zue=Object.prototype.propertyIsEnumerable,rQ=(t,e,n)=>e in t?vrt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,xrt=(t,e)=>{for(var n in e||(e={}))Xue.call(e,n)&&rQ(t,n,e[n]);if($M)for(var n of $M(e))Zue.call(e,n)&&rQ(t,n,e[n]);return t},brt=(t,e)=>{var n={};for(var r in t)Xue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&$M)for(var r of $M(t))e.indexOf(r)<0&&Zue.call(t,r)&&(n[r]=t[r]);return n};const wrt={},Ert=we.forwardRef((t,e)=>{const n=J1(),r=Gr(`${n.__staticSelector}Title`,wrt,t),{className:i}=r,o=brt(r,["className"]),{classes:a,cx:s}=yrt(null,n.stylesApi);return we.useEffect(()=>(n.setTitleMounted(!0),()=>n.setTitleMounted(!1)),[]),ut.createElement(go,xrt({component:"h2",id:n.getTitleId(),className:s(a.title,i),ref:e},o))});var Srt=no((t,{padding:e})=>({body:{padding:Zr({size:e,sizes:t.spacing}),"&:not(:only-child)":{paddingTop:0}}}));const Trt=Srt;var Crt=Object.defineProperty,HM=Object.getOwnPropertySymbols,Yue=Object.prototype.hasOwnProperty,Que=Object.prototype.propertyIsEnumerable,iQ=(t,e,n)=>e in t?Crt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Prt=(t,e)=>{for(var n in e||(e={}))Yue.call(e,n)&&iQ(t,n,e[n]);if(HM)for(var n of HM(e))Que.call(e,n)&&iQ(t,n,e[n]);return t},Irt=(t,e)=>{var n={};for(var r in t)Yue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&HM)for(var r of HM(t))e.indexOf(r)<0&&Que.call(t,r)&&(n[r]=t[r]);return n};const Mrt={},Ort=we.forwardRef((t,e)=>{const n=J1(),r=Gr(`${n.__staticSelector}Body`,Mrt,t),{className:i}=r,o=Irt(r,["className"]),{classes:a,cx:s}=Trt({padding:n.padding},n.stylesApi);return we.useEffect(()=>(n.setBodyMounted(!0),()=>n.setBodyMounted(!1)),[]),ut.createElement(go,Prt({id:n.getBodyId(),className:s(a.body,i),ref:e},o))});function Rrt({children:t}){return ut.createElement(ut.Fragment,null,t)}function Lrt({opened:t,transitionDuration:e}){const[n,r]=we.useState(t),i=we.useRef(),a=VU()?0:e;return we.useEffect(()=>(t?(r(!0),window.clearTimeout(i.current)):a===0?r(!1):i.current=window.setTimeout(()=>r(!1),a),()=>window.clearTimeout(i.current)),[t,a]),n}var Drt=no(()=>({root:{}}));const Brt=Drt;var Nrt=Object.defineProperty,Frt=Object.defineProperties,krt=Object.getOwnPropertyDescriptors,WM=Object.getOwnPropertySymbols,Kue=Object.prototype.hasOwnProperty,Jue=Object.prototype.propertyIsEnumerable,oQ=(t,e,n)=>e in t?Nrt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,mN=(t,e)=>{for(var n in e||(e={}))Kue.call(e,n)&&oQ(t,n,e[n]);if(WM)for(var n of WM(e))Jue.call(e,n)&&oQ(t,n,e[n]);return t},sQ=(t,e)=>Frt(t,krt(e)),zrt=(t,e)=>{var n={};for(var r in t)Kue.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&WM)for(var r of WM(t))e.indexOf(r)<0&&Jue.call(t,r)&&(n[r]=t[r]);return n};const u8={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:d2("modal"),padding:"md",size:"md",shadow:"xl"};function Ts(t){const e=Gr("ModalBase",u8,t),{opened:n,onClose:r,children:i,closeOnClickOutside:o,__staticSelector:a,transitionProps:s,withinPortal:u,portalProps:d,keepMounted:g,target:_,zIndex:E,lockScroll:P,trapFocus:R,closeOnEscape:B,returnFocus:V,padding:z,shadow:F,id:k,size:X,variant:Y,classNames:J,unstyled:ie,styles:ce,className:re}=e,ue=zrt(e,["opened","onClose","children","closeOnClickOutside","__staticSelector","transitionProps","withinPortal","portalProps","keepMounted","target","zIndex","lockScroll","trapFocus","closeOnEscape","returnFocus","padding","shadow","id","size","variant","classNames","unstyled","styles","className"]),{classes:se,cx:me}=Brt(null,{name:a,classNames:J,styles:ce,unstyled:ie,variant:Y,size:X}),Ce=p2(k),[be,Ye]=we.useState(!1),[tt,pt]=we.useState(!1),Ee=typeof(s==null?void 0:s.duration)=="number"?s==null?void 0:s.duration:200,Ne=Lrt({opened:n,transitionDuration:Ee});return MQe("keydown",Be=>{!R&&Be.key==="Escape"&&B&&r()}),Yae({opened:n,shouldReturnFocus:R&&V}),ut.createElement(g2,sQ(mN({},d),{withinPortal:u,target:_}),ut.createElement(Pnt,{value:{__staticSelector:a,opened:n,onClose:r,closeOnClickOutside:o,transitionProps:sQ(mN({},s),{duration:Ee,keepMounted:g}),zIndex:E,padding:z,id:Ce,getTitleId:()=>`${Ce}-title`,getBodyId:()=>`${Ce}-body`,titleMounted:be,bodyMounted:tt,setTitleMounted:Ye,setBodyMounted:pt,trapFocus:R,closeOnEscape:B,shadow:F,stylesApi:{name:a,size:X,variant:Y,classNames:J,styles:ce,unstyled:ie}}},ut.createElement(YXe,{enabled:Ne&&P},ut.createElement(go,mN({className:me(se.root,re)},ue),i))))}Ts.CloseButton=Bnt;Ts.Overlay=irt;Ts.Content=crt;Ts.Header=Art;Ts.Title=Ert;Ts.Body=Ort;Ts.NativeScrollArea=Rrt;var Urt=Object.defineProperty,qM=Object.getOwnPropertySymbols,ece=Object.prototype.hasOwnProperty,tce=Object.prototype.propertyIsEnumerable,aQ=(t,e,n)=>e in t?Urt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,lQ=(t,e)=>{for(var n in e||(e={}))ece.call(e,n)&&aQ(t,n,e[n]);if(qM)for(var n of qM(e))tce.call(e,n)&&aQ(t,n,e[n]);return t},Grt=(t,e)=>{var n={};for(var r in t)ece.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&qM)for(var r of qM(t))e.indexOf(r)<0&&tce.call(t,r)&&(n[r]=t[r]);return n};const jrt={multiple:!1},nce=we.forwardRef((t,e)=>{const n=Gr("FileButton",jrt,t),{onChange:r,children:i,multiple:o,accept:a,name:s,form:u,resetRef:d,disabled:g,capture:_,inputProps:E}=n,P=Grt(n,["onChange","children","multiple","accept","name","form","resetRef","disabled","capture","inputProps"]),R=we.useRef(),B=()=>{!g&&R.current.click()},V=F=>{r(o?Array.from(F.currentTarget.files):F.currentTarget.files[0]||null)};return tle(d,()=>{R.current.value=""}),ut.createElement(ut.Fragment,null,i(lQ({onClick:B},P)),ut.createElement("input",lQ({style:{display:"none"},type:"file",accept:a,multiple:o,onChange:V,ref:Y1(e,R),name:s,form:u,capture:_},E)))});nce.displayName="@mantine/core/FileButton";var Vrt=no(()=>({placeholder:{},input:{cursor:"pointer"}}));const $rt=Vrt;var Hrt=Object.defineProperty,Wrt=Object.defineProperties,qrt=Object.getOwnPropertyDescriptors,XM=Object.getOwnPropertySymbols,rce=Object.prototype.hasOwnProperty,ice=Object.prototype.propertyIsEnumerable,uQ=(t,e,n)=>e in t?Hrt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,By=(t,e)=>{for(var n in e||(e={}))rce.call(e,n)&&uQ(t,n,e[n]);if(XM)for(var n of XM(e))ice.call(e,n)&&uQ(t,n,e[n]);return t},DT=(t,e)=>Wrt(t,qrt(e)),Xrt=(t,e)=>{var n={};for(var r in t)rce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&XM)for(var r of XM(t))e.indexOf(r)<0&&ice.call(t,r)&&(n[r]=t[r]);return n};const Zrt=({value:t})=>ut.createElement(Nh,{sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},Array.isArray(t)?t.map(e=>e.name).join(", "):t==null?void 0:t.name),Yrt={size:"sm",valueComponent:Zrt},oce=we.forwardRef((t,e)=>{const n=mtt("FileInput",Yrt,t),{inputProps:r,wrapperProps:i,placeholder:o,value:a,defaultValue:s,onChange:u,multiple:d,accept:g,name:_,form:E,classNames:P,styles:R,unstyled:B,valueComponent:V,rightSection:z,clearable:F,clearButtonProps:k,readOnly:X,capture:Y,fileInputProps:J}=n,ie=Xrt(n,["inputProps","wrapperProps","placeholder","value","defaultValue","onChange","multiple","accept","name","form","classNames","styles","unstyled","valueComponent","rightSection","clearable","clearButtonProps","readOnly","capture","fileInputProps"]),ce=we.useRef(),{classes:re,cx:ue}=$rt(null,{name:"FileInput",classNames:P,styles:R,unstyled:B}),[se,me]=jU({value:a,defaultValue:s,onChange:u,finalValue:d?[]:null}),Ce=Array.isArray(se)?se.length!==0:se!==null,be=z||(F&&Ce&&!X?ut.createElement(Ole,DT(By({},k),{variant:"transparent",onClick:()=>me(d?[]:null),size:r.size,unstyled:B})):null);return we.useEffect(()=>{(Array.isArray(se)&&se.length===0||se===null)&&ce.current()},[se]),ut.createElement(gN.Wrapper,DT(By({},i),{__staticSelector:"FileInput"}),ut.createElement(nce,{onChange:me,multiple:d,accept:g,name:_,form:E,resetRef:ce,disabled:X,capture:Y,inputProps:J},Ye=>ut.createElement(gN,DT(By(By(By({multiline:!0},Ye),r),ie),{component:"button",type:"button",ref:e,__staticSelector:"FileInput",rightSection:be,classNames:DT(By({},P),{input:ue(re.input,P==null?void 0:P.input)})}),Ce?ut.createElement(V,{value:se}):ut.createElement(gN.Placeholder,{className:re.placeholder},o))))});oce.displayName="@mantine/core/FileInput";const Qrt=oce;function Krt(t){return we.Children.toArray(t).filter(Boolean)}const Jrt={left:"flex-start",center:"center",right:"flex-end",apart:"space-between"};var eit=no((t,{spacing:e,position:n,noWrap:r,grow:i,align:o,count:a})=>({root:{boxSizing:"border-box",display:"flex",flexDirection:"row",alignItems:o||"center",flexWrap:r?"nowrap":"wrap",justifyContent:Jrt[n],gap:Zr({size:e,sizes:t.spacing}),"& > *":{boxSizing:"border-box",maxWidth:i?`calc(${100/a}% - (${pn(Zr({size:e,sizes:t.spacing}))} - ${Zr({size:e,sizes:t.spacing})} / ${a}))`:void 0,flexGrow:i?1:0}}}));const tit=eit;var nit=Object.defineProperty,ZM=Object.getOwnPropertySymbols,sce=Object.prototype.hasOwnProperty,ace=Object.prototype.propertyIsEnumerable,cQ=(t,e,n)=>e in t?nit(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,rit=(t,e)=>{for(var n in e||(e={}))sce.call(e,n)&&cQ(t,n,e[n]);if(ZM)for(var n of ZM(e))ace.call(e,n)&&cQ(t,n,e[n]);return t},iit=(t,e)=>{var n={};for(var r in t)sce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&ZM)for(var r of ZM(t))e.indexOf(r)<0&&ace.call(t,r)&&(n[r]=t[r]);return n};const oit={position:"left",spacing:"md"},Uy=we.forwardRef((t,e)=>{const n=Gr("Group",oit,t),{className:r,position:i,align:o,children:a,noWrap:s,grow:u,spacing:d,unstyled:g,variant:_}=n,E=iit(n,["className","position","align","children","noWrap","grow","spacing","unstyled","variant"]),P=Krt(a),{classes:R,cx:B}=tit({align:o,grow:u,noWrap:s,spacing:d,position:i,count:P.length},{unstyled:g,name:"Group",variant:_});return ut.createElement(go,rit({className:B(R.root,r),ref:e},E),P)});Uy.displayName="@mantine/core/Group";const lce={context:"HoverCard component was not found in the tree",children:"HoverCard.Target component children should be an element or a component that accepts ref. Fragments, strings, numbers and other primitive values are not supported"},[sit,uce]=AL(lce.context);var ait=Object.defineProperty,YM=Object.getOwnPropertySymbols,cce=Object.prototype.hasOwnProperty,fce=Object.prototype.propertyIsEnumerable,fQ=(t,e,n)=>e in t?ait(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,lit=(t,e)=>{for(var n in e||(e={}))cce.call(e,n)&&fQ(t,n,e[n]);if(YM)for(var n of YM(e))fce.call(e,n)&&fQ(t,n,e[n]);return t},uit=(t,e)=>{var n={};for(var r in t)cce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&YM)for(var r of YM(t))e.indexOf(r)<0&&fce.call(t,r)&&(n[r]=t[r]);return n};const cit={};function hce(t){const e=Gr("HoverCardDropdown",cit,t),{children:n,onMouseEnter:r,onMouseLeave:i}=e,o=uit(e,["children","onMouseEnter","onMouseLeave"]),a=uce(),s=lM(r,a.openDropdown),u=lM(i,a.closeDropdown);return ut.createElement(K1.Dropdown,lit({onMouseEnter:s,onMouseLeave:u},o),n)}hce.displayName="@mantine/core/HoverCardDropdown";var fit=Object.defineProperty,QM=Object.getOwnPropertySymbols,dce=Object.prototype.hasOwnProperty,pce=Object.prototype.propertyIsEnumerable,hQ=(t,e,n)=>e in t?fit(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,hit=(t,e)=>{for(var n in e||(e={}))dce.call(e,n)&&hQ(t,n,e[n]);if(QM)for(var n of QM(e))pce.call(e,n)&&hQ(t,n,e[n]);return t},dit=(t,e)=>{var n={};for(var r in t)dce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&QM)for(var r of QM(t))e.indexOf(r)<0&&pce.call(t,r)&&(n[r]=t[r]);return n};const pit={refProp:"ref"},gce=we.forwardRef((t,e)=>{const n=Gr("HoverCardTarget",pit,t),{children:r,refProp:i}=n,o=dit(n,["children","refProp"]);if(!c2(r))throw new Error(lce.children);const a=uce(),s=lM(r.props.onMouseEnter,a.openDropdown),u=lM(r.props.onMouseLeave,a.closeDropdown);return ut.createElement(K1.Target,hit({refProp:i,ref:e},o),we.cloneElement(r,{onMouseEnter:s,onMouseLeave:u}))});gce.displayName="@mantine/core/HoverCardTarget";function git({open:t,close:e,openDelay:n,closeDelay:r}){const i=we.useRef(-1),o=we.useRef(-1),a=()=>{window.clearTimeout(i.current),window.clearTimeout(o.current)},s=()=>{a(),n===0?t():i.current=window.setTimeout(t,n)},u=()=>{a(),r===0?e():o.current=window.setTimeout(e,r)};return we.useEffect(()=>a,[]),{openDropdown:s,closeDropdown:u}}var mit=Object.defineProperty,KM=Object.getOwnPropertySymbols,mce=Object.prototype.hasOwnProperty,Ace=Object.prototype.propertyIsEnumerable,dQ=(t,e,n)=>e in t?mit(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ait=(t,e)=>{for(var n in e||(e={}))mce.call(e,n)&&dQ(t,n,e[n]);if(KM)for(var n of KM(e))Ace.call(e,n)&&dQ(t,n,e[n]);return t},_it=(t,e)=>{var n={};for(var r in t)mce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&KM)for(var r of KM(t))e.indexOf(r)<0&&Ace.call(t,r)&&(n[r]=t[r]);return n};const yit={openDelay:0,closeDelay:150,initiallyOpened:!1};function Vp(t){const e=Gr("HoverCard",yit,t),{children:n,onOpen:r,onClose:i,openDelay:o,closeDelay:a,initiallyOpened:s}=e,u=_it(e,["children","onOpen","onClose","openDelay","closeDelay","initiallyOpened"]),[d,{open:g,close:_}]=V4(s,{onClose:i,onOpen:r}),{openDropdown:E,closeDropdown:P}=git({open:g,close:_,openDelay:o,closeDelay:a});return ut.createElement(sit,{value:{openDropdown:E,closeDropdown:P}},ut.createElement(K1,Ait({opened:d,__staticSelector:"HoverCard"},u),n))}Vp.displayName="@mantine/core/HoverCard";Vp.Target=gce;Vp.Dropdown=hce;var vit=Object.defineProperty,JM=Object.getOwnPropertySymbols,_ce=Object.prototype.hasOwnProperty,yce=Object.prototype.propertyIsEnumerable,pQ=(t,e,n)=>e in t?vit(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,gQ=(t,e)=>{for(var n in e||(e={}))_ce.call(e,n)&&pQ(t,n,e[n]);if(JM)for(var n of JM(e))yce.call(e,n)&&pQ(t,n,e[n]);return t},xit=(t,e)=>{var n={};for(var r in t)_ce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&JM)for(var r of JM(t))e.indexOf(r)<0&&yce.call(t,r)&&(n[r]=t[r]);return n};function bit(t){const e=t,{width:n,height:r,style:i}=e,o=xit(e,["width","height","style"]);return ut.createElement("svg",gQ({viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:gQ({width:n,height:r},i)},o),ut.createElement("path",{d:"M2.5 1H12.5C13.3284 1 14 1.67157 14 2.5V12.5C14 13.3284 13.3284 14 12.5 14H2.5C1.67157 14 1 13.3284 1 12.5V2.5C1 1.67157 1.67157 1 2.5 1ZM2.5 2C2.22386 2 2 2.22386 2 2.5V8.3636L3.6818 6.6818C3.76809 6.59551 3.88572 6.54797 4.00774 6.55007C4.12975 6.55216 4.24568 6.60372 4.32895 6.69293L7.87355 10.4901L10.6818 7.6818C10.8575 7.50607 11.1425 7.50607 11.3182 7.6818L13 9.3636V2.5C13 2.22386 12.7761 2 12.5 2H2.5ZM2 12.5V9.6364L3.98887 7.64753L7.5311 11.4421L8.94113 13H2.5C2.22386 13 2 12.7761 2 12.5ZM12.5 13H10.155L8.48336 11.153L11 8.6364L13 10.6364V12.5C13 12.7761 12.7761 13 12.5 13ZM6.64922 5.5C6.64922 5.03013 7.03013 4.64922 7.5 4.64922C7.96987 4.64922 8.35078 5.03013 8.35078 5.5C8.35078 5.96987 7.96987 6.35078 7.5 6.35078C7.03013 6.35078 6.64922 5.96987 6.64922 5.5ZM7.5 3.74922C6.53307 3.74922 5.74922 4.53307 5.74922 5.5C5.74922 6.46693 6.53307 7.25078 7.5 7.25078C8.46693 7.25078 9.25078 6.46693 9.25078 5.5C9.25078 4.53307 8.46693 3.74922 7.5 3.74922Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}var wit=Object.defineProperty,Eit=Object.defineProperties,Sit=Object.getOwnPropertyDescriptors,mQ=Object.getOwnPropertySymbols,Tit=Object.prototype.hasOwnProperty,Cit=Object.prototype.propertyIsEnumerable,AQ=(t,e,n)=>e in t?wit(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_Q=(t,e)=>{for(var n in e||(e={}))Tit.call(e,n)&&AQ(t,n,e[n]);if(mQ)for(var n of mQ(e))Cit.call(e,n)&&AQ(t,n,e[n]);return t},yQ=(t,e)=>Eit(t,Sit(e)),Pit=no((t,{radius:e})=>({root:{},imageWrapper:{position:"relative"},figure:{margin:0},image:yQ(_Q({},t.fn.fontStyles()),{display:"block",width:"100%",height:"100%",border:0,borderRadius:t.fn.radius(e)}),caption:{color:t.colorScheme==="dark"?t.colors.dark[2]:t.colors.gray[7],marginTop:t.spacing.xs},placeholder:yQ(_Q({},t.fn.cover()),{display:"flex",alignItems:"center",justifyContent:"center",color:t.colorScheme==="dark"?t.colors.dark[2]:t.colors.gray[6],backgroundColor:t.colorScheme==="dark"?t.colors.dark[8]:t.colors.gray[0],borderRadius:t.fn.radius(e)})}));const Iit=Pit;var Mit=Object.defineProperty,Oit=Object.defineProperties,Rit=Object.getOwnPropertyDescriptors,eO=Object.getOwnPropertySymbols,vce=Object.prototype.hasOwnProperty,xce=Object.prototype.propertyIsEnumerable,vQ=(t,e,n)=>e in t?Mit(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,zb=(t,e)=>{for(var n in e||(e={}))vce.call(e,n)&&vQ(t,n,e[n]);if(eO)for(var n of eO(e))xce.call(e,n)&&vQ(t,n,e[n]);return t},Lit=(t,e)=>Oit(t,Rit(e)),Dit=(t,e)=>{var n={};for(var r in t)vce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&eO)for(var r of eO(t))e.indexOf(r)<0&&xce.call(t,r)&&(n[r]=t[r]);return n};const Bit={fit:"cover",width:"100%",height:"auto",radius:0},bce=we.forwardRef((t,e)=>{const n=Gr("Image",Bit,t),{className:r,alt:i,src:o,fit:a,width:s,height:u,radius:d,imageProps:g,withPlaceholder:_,placeholder:E,imageRef:P,classNames:R,styles:B,caption:V,unstyled:z,style:F,variant:k}=n,X=Dit(n,["className","alt","src","fit","width","height","radius","imageProps","withPlaceholder","placeholder","imageRef","classNames","styles","caption","unstyled","style","variant"]),{classes:Y,cx:J}=Iit({radius:d},{classNames:R,styles:B,unstyled:z,name:"Image",variant:k}),[ie,ce]=we.useState(!o),re=_&&ie;return fA(()=>{ce(!o)},[o]),ut.createElement(go,zb({className:J(Y.root,r),style:zb({width:pn(s)},F),ref:e},X),ut.createElement("figure",{className:Y.figure},ut.createElement("div",{className:Y.imageWrapper},ut.createElement("img",Lit(zb({src:o,alt:i,ref:P},g),{className:J(Y.image,g==null?void 0:g.className),onError:ue=>{ce(!0),typeof(g==null?void 0:g.onError)=="function"&&g.onError(ue)},style:zb(zb({objectFit:a,width:pn(s),height:pn(u)},re&&{overflow:"hidden"}),g==null?void 0:g.style)})),re&&ut.createElement("div",{className:Y.placeholder,title:i},E||ut.createElement("div",null,ut.createElement(bit,{width:pn(40),height:pn(40)})))),!!V&&ut.createElement(Nh,{component:"figcaption",size:"sm",align:"center",className:Y.caption},V)))});bce.displayName="@mantine/core/Image";const[Nit,Fit]=AL("Modal component was not found in tree"),kit={xs:pn(320),sm:pn(380),md:pn(440),lg:pn(620),xl:pn(780)};var zit=no((t,{yOffset:e,xOffset:n,centered:r,fullScreen:i},{size:o})=>({content:{flex:i?"0 0 100%":`0 0 ${Zr({size:o,sizes:kit})}`,maxWidth:"100%",maxHeight:i?void 0:`calc(100dvh - (${pn(e)} * 2))`,height:i?"100vh":void 0,borderRadius:i?0:void 0,overflowY:"auto"},inner:{paddingTop:i?0:e,paddingBottom:i?0:e,paddingLeft:i?0:n,paddingRight:i?0:n,display:"flex",justifyContent:"center",alignItems:r?"center":"flex-start"}}));const Uit=zit;var Git=Object.defineProperty,jit=Object.defineProperties,Vit=Object.getOwnPropertyDescriptors,tO=Object.getOwnPropertySymbols,wce=Object.prototype.hasOwnProperty,Ece=Object.prototype.propertyIsEnumerable,xQ=(t,e,n)=>e in t?Git(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,q4=(t,e)=>{for(var n in e||(e={}))wce.call(e,n)&&xQ(t,n,e[n]);if(tO)for(var n of tO(e))Ece.call(e,n)&&xQ(t,n,e[n]);return t},Sce=(t,e)=>jit(t,Vit(e)),$it=(t,e)=>{var n={};for(var r in t)wce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&tO)for(var r of tO(t))e.indexOf(r)<0&&Ece.call(t,r)&&(n[r]=t[r]);return n};const Hit=Sce(q4({},u8),{yOffset:"5dvh",xOffset:"5vw"});function Tce(t){const e=Gr("ModalRoot",Hit,t),{classNames:n,variant:r,size:i,yOffset:o,xOffset:a,scrollAreaComponent:s,radius:u,centered:d,fullScreen:g}=e,_=$it(e,["classNames","variant","size","yOffset","xOffset","scrollAreaComponent","radius","centered","fullScreen"]),{classes:E,cx:P}=Uit({yOffset:o,xOffset:a,centered:d,fullScreen:g},{name:"Modal",variant:r,size:i});return ut.createElement(Nit,{value:{yOffset:o,scrollAreaComponent:s,radius:u}},ut.createElement(Ts,q4({__staticSelector:"Modal",size:i,variant:r,classNames:Sce(q4({},n),{content:P(E.content,n==null?void 0:n.content),inner:P(E.inner,n==null?void 0:n.inner)})},_)))}var Wit=Object.defineProperty,nO=Object.getOwnPropertySymbols,Cce=Object.prototype.hasOwnProperty,Pce=Object.prototype.propertyIsEnumerable,bQ=(t,e,n)=>e in t?Wit(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,qit=(t,e)=>{for(var n in e||(e={}))Cce.call(e,n)&&bQ(t,n,e[n]);if(nO)for(var n of nO(e))Pce.call(e,n)&&bQ(t,n,e[n]);return t},Xit=(t,e)=>{var n={};for(var r in t)Cce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&nO)for(var r of nO(t))e.indexOf(r)<0&&Pce.call(t,r)&&(n[r]=t[r]);return n};const Zit={shadow:"xl"},Ice=we.forwardRef((t,e)=>{const n=Gr("ModalContent",Zit,t),{children:r,scrollAreaComponent:i}=n,o=Xit(n,["children","scrollAreaComponent"]),a=Fit(),s=i||a.scrollAreaComponent||Ts.NativeScrollArea;return ut.createElement(Ts.Content,qit({ref:e,radius:a.radius},o),ut.createElement(s,{style:{maxHeight:`calc(100dvh - (${pn(a.yOffset)} * 2))`}},r))});var Yit=Object.defineProperty,Qit=Object.defineProperties,Kit=Object.getOwnPropertyDescriptors,rO=Object.getOwnPropertySymbols,Mce=Object.prototype.hasOwnProperty,Oce=Object.prototype.propertyIsEnumerable,wQ=(t,e,n)=>e in t?Yit(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,yP=(t,e)=>{for(var n in e||(e={}))Mce.call(e,n)&&wQ(t,n,e[n]);if(rO)for(var n of rO(e))Oce.call(e,n)&&wQ(t,n,e[n]);return t},Jit=(t,e)=>Qit(t,Kit(e)),eot=(t,e)=>{var n={};for(var r in t)Mce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&rO)for(var r of rO(t))e.indexOf(r)<0&&Oce.call(t,r)&&(n[r]=t[r]);return n};const tot=Jit(yP({},u8),{transitionProps:{duration:200,transition:"pop"},withOverlay:!0,withCloseButton:!0});function Qd(t){const e=Gr("Modal",tot,t),{title:n,withOverlay:r,overlayProps:i,withCloseButton:o,closeButtonProps:a,children:s}=e,u=eot(e,["title","withOverlay","overlayProps","withCloseButton","closeButtonProps","children"]),d=!!n||o;return ut.createElement(Tce,yP({},u),r&&ut.createElement(Ts.Overlay,yP({},i)),ut.createElement(Ice,null,d&&ut.createElement(Ts.Header,null,n&&ut.createElement(Ts.Title,null,n),o&&ut.createElement(Ts.CloseButton,yP({},a))),ut.createElement(Ts.Body,null,s)))}Qd.Root=Tce;Qd.CloseButton=Ts.CloseButton;Qd.Overlay=Ts.Overlay;Qd.Content=Ice;Qd.Header=Ts.Header;Qd.Title=Ts.Title;Qd.Body=Ts.Body;Qd.NativeScrollArea=Ts.NativeScrollArea;const EQ={xs:pn(3),sm:pn(5),md:pn(8),lg:pn(12),xl:pn(16)},not=PYe({from:{backgroundPosition:"0 0"},to:{backgroundPosition:`${pn(40)} 0`}});var rot=no((t,{color:e,radius:n},{size:r})=>({root:{position:"relative",height:Zr({size:r,sizes:EQ}),backgroundColor:t.colorScheme==="dark"?t.colors.dark[4]:t.colors.gray[2],borderRadius:t.fn.radius(n),overflow:"hidden"},bar:{position:"absolute",top:0,bottom:0,left:0,height:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:t.fn.variant({variant:"filled",primaryFallback:!1,color:e||t.primaryColor}).background,transition:"width 100ms linear","&[data-animate]":{animation:`${not} 1000ms linear infinite`},"&[data-striped]":{backgroundSize:`${pn(20)} ${pn(20)}`,backgroundImage:"linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent)"},"&:last-of-type":{borderTopRightRadius:t.fn.radius(n),borderBottomRightRadius:t.fn.radius(n)},"&:first-of-type":{borderTopLeftRadius:t.fn.radius(n),borderBottomLeftRadius:t.fn.radius(n)},"@media (prefers-reduced-motion)":{transitionDuration:t.respectReducedMotion?"0ms":void 0}},label:{color:t.white,fontSize:`calc(${Zr({size:r,sizes:EQ})} * 0.65)`,fontWeight:700,userSelect:"none",overflow:"hidden",whiteSpace:"nowrap"}}));const iot=rot,Rce=we.createContext(!1),oot=Rce.Provider,sot=()=>we.useContext(Rce);function Lce({children:t,openDelay:e=0,closeDelay:n=0}){return ut.createElement(oot,{value:!0},ut.createElement(det,{delay:{open:e,close:n}},t))}Lce.displayName="@mantine/core/TooltipGroup";var aot=Object.defineProperty,lot=Object.defineProperties,uot=Object.getOwnPropertyDescriptors,SQ=Object.getOwnPropertySymbols,cot=Object.prototype.hasOwnProperty,fot=Object.prototype.propertyIsEnumerable,TQ=(t,e,n)=>e in t?aot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,CQ=(t,e)=>{for(var n in e||(e={}))cot.call(e,n)&&TQ(t,n,e[n]);if(SQ)for(var n of SQ(e))fot.call(e,n)&&TQ(t,n,e[n]);return t},hot=(t,e)=>lot(t,uot(e));function dot(t,e){if(!e)return{backgroundColor:t.colorScheme==="dark"?t.colors.gray[2]:t.colors.gray[9],color:t.colorScheme==="dark"?t.black:t.white};const n=t.fn.variant({variant:"filled",color:e,primaryFallback:!1});return{backgroundColor:n.background,color:n.color}}var pot=no((t,{color:e,radius:n,width:r,multiline:i})=>({tooltip:hot(CQ(CQ({},t.fn.fontStyles()),dot(t,e)),{lineHeight:t.lineHeight,fontSize:t.fontSizes.sm,borderRadius:t.fn.radius(n),padding:`calc(${t.spacing.xs} / 2) ${t.spacing.xs}`,position:"absolute",whiteSpace:i?"unset":"nowrap",pointerEvents:"none",width:r}),arrow:{backgroundColor:"inherit",border:0,zIndex:1}}));const Dce=pot,Bce={children:"Tooltip component children should be an element or a component that accepts ref, fragments, strings, numbers and other primitive values are not supported"};function got({offset:t,position:e}){const[n,r]=we.useState(!1),i=we.useRef(),{x:o,y:a,reference:s,floating:u,refs:d,update:g,placement:_}=n8({placement:e,middleware:[YU({crossAxis:!0,padding:5,rootBoundary:"document"})]}),E=_.includes("right")?t:e.includes("left")?t*-1:0,P=_.includes("bottom")?t:e.includes("top")?t*-1:0,R=we.useCallback(({clientX:B,clientY:V})=>{s({getBoundingClientRect(){return{width:0,height:0,x:B,y:V,left:B+E,top:V+P,right:B,bottom:V}}})},[s]);return we.useEffect(()=>{if(d.floating.current){const B=i.current;B.addEventListener("mousemove",R);const V=ng(d.floating.current);return V.forEach(z=>{z.addEventListener("scroll",g)}),()=>{B.removeEventListener("mousemove",R),V.forEach(z=>{z.removeEventListener("scroll",g)})}}},[s,d.floating.current,g,R,n]),{handleMouseMove:R,x:o,y:a,opened:n,setOpened:r,boundaryRef:i,floating:u}}var mot=Object.defineProperty,Aot=Object.defineProperties,_ot=Object.getOwnPropertyDescriptors,iO=Object.getOwnPropertySymbols,Nce=Object.prototype.hasOwnProperty,Fce=Object.prototype.propertyIsEnumerable,PQ=(t,e,n)=>e in t?mot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,BT=(t,e)=>{for(var n in e||(e={}))Nce.call(e,n)&&PQ(t,n,e[n]);if(iO)for(var n of iO(e))Fce.call(e,n)&&PQ(t,n,e[n]);return t},NT=(t,e)=>Aot(t,_ot(e)),yot=(t,e)=>{var n={};for(var r in t)Nce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&iO)for(var r of iO(t))e.indexOf(r)<0&&Fce.call(t,r)&&(n[r]=t[r]);return n};const vot={refProp:"ref",withinPortal:!0,offset:10,position:"right",zIndex:d2("popover")};function kce(t){var e;const n=Gr("TooltipFloating",vot,t),{children:r,refProp:i,withinPortal:o,portalProps:a,style:s,className:u,classNames:d,styles:g,unstyled:_,radius:E,color:P,label:R,offset:B,position:V,multiline:z,width:F,zIndex:k,disabled:X,variant:Y}=n,J=yot(n,["children","refProp","withinPortal","portalProps","style","className","classNames","styles","unstyled","radius","color","label","offset","position","multiline","width","zIndex","disabled","variant"]),{handleMouseMove:ie,x:ce,y:re,opened:ue,boundaryRef:se,floating:me,setOpened:Ce}=got({offset:B,position:V}),{classes:be,cx:Ye}=Dce({radius:E,color:P,multiline:z,width:F},{name:"TooltipFloating",classNames:d,styles:g,unstyled:_,variant:Y});if(!c2(r))throw new Error(Bce.children);const tt=Y1(se,r.ref),pt=Ne=>{var Be,qe;(qe=(Be=r.props).onMouseEnter)==null||qe.call(Be,Ne),ie(Ne),Ce(!0)},Ee=Ne=>{var Be,qe;(qe=(Be=r.props).onMouseLeave)==null||qe.call(Be,Ne),Ce(!1)};return ut.createElement(ut.Fragment,null,ut.createElement(g2,NT(BT({},a),{withinPortal:o}),ut.createElement(go,NT(BT({},J),{ref:me,className:Ye(be.tooltip,u),style:NT(BT({},s),{zIndex:k,display:!X&&ue?"block":"none",top:re??"",left:(e=Math.round(ce))!=null?e:""})}),R)),we.cloneElement(r,NT(BT({},r.props),{[i]:tt,onMouseEnter:pt,onMouseLeave:Ee})))}kce.displayName="@mantine/core/TooltipFloating";function xot(t){const[e,n]=we.useState(!1),i=typeof t.opened=="boolean"?t.opened:e,o=sot(),a=p2(),{delay:s,currentId:u,setCurrentId:d}=eue(),g=we.useCallback(ce=>{n(ce),ce&&d(a)},[d,a]),{x:_,y:E,reference:P,floating:R,context:B,refs:V,update:z,placement:F,middlewareData:{arrow:{x:k,y:X}={}}}=n8({placement:t.position,open:i,onOpenChange:g,middleware:[Gle(t.offset),YU({padding:8}),kle(),Zle({element:t.arrowRef,padding:t.arrowOffset}),...t.inline?[Ule()]:[]]}),{getReferenceProps:Y,getFloatingProps:J}=Tet([het(B,{enabled:t.events.hover,delay:o?s:{open:t.openDelay,close:t.closeDelay},mouseOnly:!t.events.touch}),wet(B,{enabled:t.events.focus,keyboardOnly:!0}),Eet(B,{role:"tooltip"}),bet(B,{enabled:typeof t.opened===void 0}),pet(B,{id:a})]);return nue({opened:i,position:t.position,positionDependencies:t.positionDependencies,floating:{refs:V,update:z}}),fA(()=>{var ce;(ce=t.onPositionChange)==null||ce.call(t,F)},[F]),{x:_,y:E,arrowX:k,arrowY:X,reference:P,floating:R,getFloatingProps:J,getReferenceProps:Y,isGroupPhase:i&&u&&u!==a,opened:i,placement:F}}var bot=Object.defineProperty,wot=Object.defineProperties,Eot=Object.getOwnPropertyDescriptors,oO=Object.getOwnPropertySymbols,zce=Object.prototype.hasOwnProperty,Uce=Object.prototype.propertyIsEnumerable,IQ=(t,e,n)=>e in t?bot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,h0=(t,e)=>{for(var n in e||(e={}))zce.call(e,n)&&IQ(t,n,e[n]);if(oO)for(var n of oO(e))Uce.call(e,n)&&IQ(t,n,e[n]);return t},AN=(t,e)=>wot(t,Eot(e)),Sot=(t,e)=>{var n={};for(var r in t)zce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&oO)for(var r of oO(t))e.indexOf(r)<0&&Uce.call(t,r)&&(n[r]=t[r]);return n};const Tot={position:"top",refProp:"ref",withinPortal:!1,inline:!1,arrowSize:4,arrowOffset:5,arrowRadius:0,arrowPosition:"side",offset:5,transitionProps:{duration:100,transition:"fade"},width:"auto",events:{hover:!0,focus:!1,touch:!1},zIndex:d2("popover"),positionDependencies:[]},NL=we.forwardRef((t,e)=>{var n;const r=we.useRef(null),i=Gr("Tooltip",Tot,t),{children:o,position:a,refProp:s,label:u,openDelay:d,closeDelay:g,onPositionChange:_,opened:E,withinPortal:P,portalProps:R,radius:B,color:V,classNames:z,styles:F,unstyled:k,style:X,className:Y,withArrow:J,arrowSize:ie,arrowOffset:ce,arrowRadius:re,arrowPosition:ue,offset:se,transitionProps:me,multiline:Ce,width:be,events:Ye,zIndex:tt,disabled:pt,positionDependencies:Ee,onClick:Ne,onMouseEnter:Be,onMouseLeave:qe,inline:ct,variant:Ct,keepMounted:Dt}=i,In=Sot(i,["children","position","refProp","label","openDelay","closeDelay","onPositionChange","opened","withinPortal","portalProps","radius","color","classNames","styles","unstyled","style","className","withArrow","arrowSize","arrowOffset","arrowRadius","arrowPosition","offset","transitionProps","multiline","width","events","zIndex","disabled","positionDependencies","onClick","onMouseEnter","onMouseLeave","inline","variant","keepMounted"]),{classes:Mn,cx:Tn,theme:Nt}=Dce({radius:B,color:V,width:be,multiline:Ce},{name:"Tooltip",classNames:z,styles:F,unstyled:k,variant:Ct}),Zt=xot({position:due(Nt.dir,a),closeDelay:g,openDelay:d,onPositionChange:_,opened:E,events:Ye,arrowRef:r,arrowOffset:ce,offset:se+(J?ie/2:0),positionDependencies:[...Ee,o],inline:ct});if(!c2(o))throw new Error(Bce.children);const Wt=Y1(Zt.reference,o.ref,e);return ut.createElement(ut.Fragment,null,ut.createElement(g2,AN(h0({},R),{withinPortal:P}),ut.createElement(A2,AN(h0({keepMounted:Dt,mounted:!pt&&Zt.opened},me),{transition:me.transition||"fade",duration:Zt.isGroupPhase?10:(n=me.duration)!=null?n:100}),hn=>{var lr,It;return ut.createElement(go,h0(h0({},In),Zt.getFloatingProps({ref:Zt.floating,className:Mn.tooltip,style:AN(h0(h0({},X),hn),{zIndex:tt,top:(lr=Zt.y)!=null?lr:0,left:(It=Zt.x)!=null?It:0})})),u,ut.createElement(i8,{ref:r,arrowX:Zt.arrowX,arrowY:Zt.arrowY,visible:J,position:Zt.placement,arrowSize:ie,arrowOffset:ce,arrowRadius:re,arrowPosition:ue,className:Mn.arrow}))})),we.cloneElement(o,Zt.getReferenceProps(h0({onClick:Ne,onMouseEnter:Be,onMouseLeave:qe,onMouseMove:t.onMouseMove,onPointerDown:t.onPointerDown,onPointerEnter:t.onPointerEnter,[s]:Wt,className:Tn(Y,o.props.className)},o.props))))});NL.Group=Lce;NL.Floating=kce;NL.displayName="@mantine/core/Tooltip";const Cot=NL;var Pot=Object.defineProperty,Iot=Object.defineProperties,Mot=Object.getOwnPropertyDescriptors,sO=Object.getOwnPropertySymbols,Gce=Object.prototype.hasOwnProperty,jce=Object.prototype.propertyIsEnumerable,MQ=(t,e,n)=>e in t?Pot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,X4=(t,e)=>{for(var n in e||(e={}))Gce.call(e,n)&&MQ(t,n,e[n]);if(sO)for(var n of sO(e))jce.call(e,n)&&MQ(t,n,e[n]);return t},Vce=(t,e)=>Iot(t,Mot(e)),OQ=(t,e)=>{var n={};for(var r in t)Gce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&sO)for(var r of sO(t))e.indexOf(r)<0&&jce.call(t,r)&&(n[r]=t[r]);return n};function Oot(t){return t.reduce((e,n)=>(e.sections.push(Vce(X4({},n),{accumulated:e.accumulated})),e.accumulated+=n.value,e),{accumulated:0,sections:[]}).sections}const Rot={size:"md",radius:"sm",striped:!1,animate:!1,label:""},$ce=we.forwardRef((t,e)=>{const n=Gr("Progress",Rot,t),{className:r,value:i,color:o,size:a,radius:s,striped:u,animate:d,label:g,"aria-label":_,classNames:E,styles:P,sections:R,unstyled:B,variant:V}=n,z=OQ(n,["className","value","color","size","radius","striped","animate","label","aria-label","classNames","styles","sections","unstyled","variant"]),{classes:F,cx:k,theme:X}=iot({color:o,radius:s},{name:"Progress",classNames:E,styles:P,unstyled:B,variant:V,size:a}),Y=Array.isArray(R)?Oot(R).map((J,ie)=>{var ce=J,{tooltip:re,accumulated:ue,value:se,label:me,color:Ce}=ce,be=OQ(ce,["tooltip","accumulated","value","label","color"]);return ut.createElement(Cot.Floating,{label:re,disabled:!re,key:ie},ut.createElement(go,Vce(X4({},be),{className:k(F.bar,be.className),"data-striped":u||d||void 0,"data-animate":d||void 0,sx:{width:`${se}%`,left:`${ue}%`,backgroundColor:X.fn.variant({variant:"filled",primaryFallback:!1,color:Ce||X.primaryColor}).background}}),me&&ut.createElement(Nh,{className:F.label},me)))}):null;return ut.createElement(go,X4({className:k(F.root,r),ref:e},z),Y||ut.createElement("div",{role:"progressbar","aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":i,"aria-label":_,className:F.bar,style:{width:`${i}%`},"data-striped":u||d||void 0,"data-animate":d||void 0},g?ut.createElement(Nh,{className:F.label},g):""))});$ce.displayName="@mantine/core/Progress";var Lot=Object.defineProperty,Dot=Object.defineProperties,Bot=Object.getOwnPropertyDescriptors,RQ=Object.getOwnPropertySymbols,Not=Object.prototype.hasOwnProperty,Fot=Object.prototype.propertyIsEnumerable,LQ=(t,e,n)=>e in t?Lot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,FT=(t,e)=>{for(var n in e||(e={}))Not.call(e,n)&&LQ(t,n,e[n]);if(RQ)for(var n of RQ(e))Fot.call(e,n)&&LQ(t,n,e[n]);return t},kot=(t,e)=>Dot(t,Bot(e));const vP=4,DQ={xs:`${pn(3)} ${pn(6)}`,sm:`${pn(5)} ${pn(10)}`,md:`${pn(7)} ${pn(14)}`,lg:`${pn(9)} ${pn(16)}`,xl:`${pn(12)} ${pn(20)}`};var zot=no((t,{fullWidth:e,color:n,radius:r,shouldAnimate:i,transitionDuration:o,transitionTimingFunction:a,orientation:s},{size:u})=>{const d=s==="vertical",g=t.fn.variant({variant:"filled",color:n});return{label:kot(FT(FT({ref:Lb("label")},t.fn.focusStyles()),t.fn.fontStyles()),{WebkitTapHighlightColor:"transparent",borderRadius:t.fn.radius(r),fontWeight:500,fontSize:u in t.fontSizes?t.fontSizes[u]:t.fontSizes.sm,cursor:"pointer",display:"block",textAlign:"center",padding:DQ[u in DQ?u:"sm"],whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",userSelect:"none",color:t.colorScheme==="dark"?t.colors.dark[1]:t.colors.gray[7],transition:`color ${i?0:o}ms ${a||t.transitionTimingFunction}`,"&:hover":{color:t.colorScheme==="dark"?t.colors.dark[0]:t.black},"&[data-disabled]":{"&, &:hover":{color:t.colorScheme==="dark"?t.colors.dark[3]:t.colors.gray[5],cursor:"not-allowed",pointerEvents:"none"}},"&[data-active]":{"&, &:hover":{color:n||t.colorScheme==="dark"?t.white:t.black}}}),control:{ref:Lb("control"),position:"relative",boxSizing:"border-box",flex:1,zIndex:2,transition:`border-left-color ${i?0:o}ms ${a||t.transitionTimingFunction}`,"&:not(:first-of-type)":{borderStyle:"solid",borderWidth:d?`${pn(1)} 0 0 0`:`0 0 0 ${pn(1)}`,borderColor:t.colorScheme==="dark"?t.colors.dark[4]:t.colors.gray[3]}},input:{height:0,width:0,position:"absolute",overflow:"hidden",whiteSpace:"nowrap",opacity:0,"&:focus":{outline:"none",[`& + .${Lb("label")}`]:FT({},t.focusRing==="always"||t.focusRing==="auto"?t.focusRingStyles.styles(t):t.focusRingStyles.resetStyles(t)),"&:focus:not(:focus-visible)":{[`& + .${Lb("label")}`]:FT({},t.focusRing==="auto"||t.focusRing==="never"?t.focusRingStyles.resetStyles(t):null)}},"&:disabled + label":{"&, &:hover":{color:t.colorScheme==="dark"?t.colors.dark[3]:t.colors.gray[5],cursor:"not-allowed",pointerEvents:"none"}}},root:{position:"relative",display:e||d?"flex":"inline-flex",width:d&&!e?"max-content":"auto",flexDirection:d?"column":"row",backgroundColor:t.colorScheme==="dark"?t.colors.dark[8]:t.colors.gray[1],borderRadius:t.fn.radius(r),overflow:"hidden",padding:vP},controlActive:{borderLeftColor:"transparent !important",borderTopColor:"transparent !important",[`& + .${Lb("control")}`]:{[d?"borderTopColor":"borderLeftColor"]:"transparent !important"},borderRadius:t.fn.radius(r),boxShadow:i?n||t.colorScheme==="dark"?"none":t.shadows.xs:void 0,backgroundColor:i?n?g.background:t.colorScheme==="dark"?t.colors.dark[5]:t.white:void 0},indicator:{boxSizing:"border-box",borderRadius:t.fn.radius(r),position:"absolute",zIndex:1,boxShadow:n||t.colorScheme==="dark"?"none":t.shadows.xs,transition:`transform ${i?0:o}ms ${t.transitionTimingFunction}, width ${i?0:o/2}ms ${a||t.transitionTimingFunction}`,backgroundColor:n?g.background:t.colorScheme==="dark"?t.colors.dark[5]:t.white}}});const Uot=zot;var Got=Object.defineProperty,aO=Object.getOwnPropertySymbols,Hce=Object.prototype.hasOwnProperty,Wce=Object.prototype.propertyIsEnumerable,BQ=(t,e,n)=>e in t?Got(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,jot=(t,e)=>{for(var n in e||(e={}))Hce.call(e,n)&&BQ(t,n,e[n]);if(aO)for(var n of aO(e))Wce.call(e,n)&&BQ(t,n,e[n]);return t},Vot=(t,e)=>{var n={};for(var r in t)Hce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&aO)for(var r of aO(t))e.indexOf(r)<0&&Wce.call(t,r)&&(n[r]=t[r]);return n};const $ot={disabled:!1,size:"sm",transitionDuration:200},qce=we.forwardRef((t,e)=>{var n,r,i,o;const a=Gr("SegmentedControl",$ot,t),{className:s,disabled:u,data:d,name:g,value:_,onChange:E,color:P,fullWidth:R,radius:B,size:V,transitionDuration:z,transitionTimingFunction:F,classNames:k,styles:X,defaultValue:Y,orientation:J,unstyled:ie,variant:ce,readOnly:re}=a,ue=Vot(a,["className","disabled","data","name","value","onChange","color","fullWidth","radius","size","transitionDuration","transitionTimingFunction","classNames","styles","defaultValue","orientation","unstyled","variant","readOnly"]),se=ip(),me=VU(),Ce=se.respectReducedMotion?me:!1,be=d.map(Wt=>typeof Wt=="string"?{label:Wt,value:Wt}:Wt),Ye=we.useRef(),[tt,pt]=we.useState(!1),[Ee,Ne]=jU({value:_,defaultValue:Y,finalValue:Array.isArray(be)&&(o=(i=(n=be.find(Wt=>!Wt.disabled))==null?void 0:n.value)!=null?i:(r=be[0])==null?void 0:r.value)!=null?o:null,onChange:E}),{classes:Be,cx:qe}=Uot({fullWidth:R,color:P,radius:B,shouldAnimate:Ce||!tt,transitionDuration:z,transitionTimingFunction:F,orientation:J},{name:"SegmentedControl",classNames:k,styles:X,unstyled:ie,variant:ce,size:V}),[ct,Ct]=we.useState({width:0,height:0,translate:[0,0]}),Dt=p2(g),In=we.useRef({}),[Mn,Tn]=LQe();LL(()=>{Ye.current?pt(!0):(Ye.current=!0,pt(!1))}),we.useEffect(()=>{if(Ee in In.current&&Mn.current){const Wt=In.current[Ee],hn=Wt.getBoundingClientRect(),lr=Wt.offsetWidth/hn.width,It=hn.width*lr||0,Xt=hn.height*lr||0,$t=Tn.width-Wt.parentElement.offsetLeft+vP-It,cn=Wt.parentElement.offsetLeft-vP;Ct({width:It,height:Xt,translate:[se.dir==="rtl"?$t:cn,Wt.parentElement.offsetTop-vP]})}},[Ee,Tn]);const Nt=be.map(Wt=>ut.createElement("div",{className:qe(Be.control,{[Be.controlActive]:Ee===Wt.value}),key:Wt.value},ut.createElement("input",{className:Be.input,disabled:u||Wt.disabled,type:"radio",name:Dt,value:Wt.value,id:`${Dt}-${Wt.value}`,checked:Ee===Wt.value,onChange:()=>!re&&Ne(Wt.value)}),ut.createElement("label",{className:Be.label,"data-active":Ee===Wt.value&&!(u||Wt.disabled)||void 0,"data-disabled":u||Wt.disabled||void 0,htmlFor:`${Dt}-${Wt.value}`,ref:hn=>{In.current[Wt.value]=hn}},Wt.label))),Zt=Y1(Mn,e);return be.length===0?null:ut.createElement(go,jot({className:qe(Be.root,s),ref:Zt},ue),typeof Ee=="string"&&tt&&ut.createElement(go,{component:"span",className:Be.indicator,sx:{width:ct.width,height:ct.height,transform:`translate(${ct.translate[0]}px, ${ct.translate[1]}px)`}}),Nt)});qce.displayName="@mantine/core/SegmentedControl";var Hot=no((t,{spacing:e,align:n,justify:r})=>({root:{display:"flex",flexDirection:"column",alignItems:n,justifyContent:r,gap:Zr({size:e,sizes:t.spacing})}}));const Wot=Hot;var qot=Object.defineProperty,lO=Object.getOwnPropertySymbols,Xce=Object.prototype.hasOwnProperty,Zce=Object.prototype.propertyIsEnumerable,NQ=(t,e,n)=>e in t?qot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Xot=(t,e)=>{for(var n in e||(e={}))Xce.call(e,n)&&NQ(t,n,e[n]);if(lO)for(var n of lO(e))Zce.call(e,n)&&NQ(t,n,e[n]);return t},Zot=(t,e)=>{var n={};for(var r in t)Xce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&lO)for(var r of lO(t))e.indexOf(r)<0&&Zce.call(t,r)&&(n[r]=t[r]);return n};const Yot={spacing:"md",align:"stretch",justify:"flex-start"},c8=we.forwardRef((t,e)=>{const n=Gr("Stack",Yot,t),{spacing:r,className:i,align:o,justify:a,unstyled:s,variant:u}=n,d=Zot(n,["spacing","className","align","justify","unstyled","variant"]),{classes:g,cx:_}=Wot({spacing:r,align:o,justify:a},{name:"Stack",unstyled:s,variant:u});return ut.createElement(go,Xot({className:_(g.root,i),ref:e},d))});c8.displayName="@mantine/core/Stack";var Qot=Object.defineProperty,Kot=Object.defineProperties,Jot=Object.getOwnPropertyDescriptors,FQ=Object.getOwnPropertySymbols,est=Object.prototype.hasOwnProperty,tst=Object.prototype.propertyIsEnumerable,kQ=(t,e,n)=>e in t?Qot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,nst=(t,e)=>{for(var n in e||(e={}))est.call(e,n)&&kQ(t,n,e[n]);if(FQ)for(var n of FQ(e))tst.call(e,n)&&kQ(t,n,e[n]);return t},rst=(t,e)=>Kot(t,Jot(e));function ist(t,e,n){return typeof t<"u"?t in n.headings.sizes?n.headings.sizes[t].fontSize:pn(t):n.headings.sizes[e].fontSize}function ost(t,e,n){return typeof t<"u"&&t in n.headings.sizes?n.headings.sizes[t].lineHeight:n.headings.sizes[e].lineHeight}var sst=no((t,{element:e,weight:n,inline:r},{size:i})=>({root:rst(nst({},t.fn.fontStyles()),{fontFamily:t.headings.fontFamily,fontWeight:n||t.headings.sizes[e].fontWeight||t.headings.fontWeight,fontSize:ist(i,e,t),lineHeight:r?1:ost(i,e,t),margin:0})}));const ast=sst;var lst=Object.defineProperty,uO=Object.getOwnPropertySymbols,Yce=Object.prototype.hasOwnProperty,Qce=Object.prototype.propertyIsEnumerable,zQ=(t,e,n)=>e in t?lst(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ust=(t,e)=>{for(var n in e||(e={}))Yce.call(e,n)&&zQ(t,n,e[n]);if(uO)for(var n of uO(e))Qce.call(e,n)&&zQ(t,n,e[n]);return t},cst=(t,e)=>{var n={};for(var r in t)Yce.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&uO)for(var r of uO(t))e.indexOf(r)<0&&Qce.call(t,r)&&(n[r]=t[r]);return n};const fst={order:1},xP=we.forwardRef((t,e)=>{const n=Gr("Title",fst,t),{className:r,order:i,children:o,unstyled:a,size:s,weight:u,inline:d,variant:g}=n,_=cst(n,["className","order","children","unstyled","size","weight","inline","variant"]),{classes:E,cx:P}=ast({element:`h${i}`,weight:u,inline:d},{name:"Title",unstyled:a,variant:g,size:s});return[1,2,3,4,5,6].includes(i)?ut.createElement(Nh,ust({variant:g,component:`h${i}`,ref:e,className:P(E.root,r)},_),o):null});xP.displayName="@mantine/core/Title";function hst(t,e){var n=!0;return Vd(t,function(r){Vd(e,function(i){if(n===!1)return!1;n=dst(r.geometry,i.geometry)})}),n}function dst(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return!Ast(t.coordinates,e.coordinates);case"LineString":return!UQ(e,t);case"Polygon":return!Vv(t,e)}break;case"LineString":switch(e.type){case"Point":return!UQ(t,e);case"LineString":return!pst(t,e);case"Polygon":return!GQ(e,t)}break;case"Polygon":switch(e.type){case"Point":return!Vv(e,t);case"LineString":return!GQ(t,e);case"Polygon":return!gst(e,t)}}return!1}function UQ(t,e){for(var n=0;n<t.coordinates.length-1;n++)if(mst(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function pst(t,e){var n=HE(t,e);return n.features.length>0}function GQ(t,e){for(var n=0,r=e.coordinates;n<r.length;n++){var i=r[n];if(Vv(i,t))return!0}var o=HE(e,AI(t));return o.features.length>0}function gst(t,e){for(var n=0,r=t.coordinates[0];n<r.length;n++){var i=r[n];if(Vv(i,e))return!0}for(var o=0,a=e.coordinates[0];o<a.length;o++){var s=a[o];if(Vv(s,t))return!0}var u=HE(AI(t),AI(e));return u.features.length>0}function mst(t,e,n){var r=n[0]-t[0],i=n[1]-t[1],o=e[0]-t[0],a=e[1]-t[1],s=r*a-i*o;return s!==0?!1:Math.abs(o)>=Math.abs(a)?o>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:a>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1]}function Ast(t,e){return t[0]===e[0]&&t[1]===e[1]}function _st(t,e){var n=!1;return Vd(t,function(r){Vd(e,function(i){if(n===!0)return!0;n=!hst(r.geometry,i.geometry)})}),n}function yst(t,e,n,r){r===void 0&&(r={});for(var i=[],o=t[0],a=t[1],s=t[2],u=t[3],d=e/ch([o,a],[s,a],r),g=d*(s-o),_=n/ch([o,a],[o,u],r),E=_*(u-a),P=s-o,R=u-a,B=Math.floor(P/g),V=Math.floor(R/E),z=(P-B*g)/2,F=(R-V*E)/2,k=o+z,X=0;X<B;X++){for(var Y=a+F,J=0;J<V;J++){var ie=Th([[[k,Y],[k,Y+E],[k+g,Y+E],[k+g,Y],[k,Y]]],r.properties);r.mask?_st(r.mask,ie)&&i.push(ie):i.push(ie),Y+=E}k+=g}return vf(i)}function Kce(t,e,n){return n===void 0&&(n={}),yst(t,e,e,n)}const ex=we.createContext(),vst=({children:t})=>{const[e,n]=we.useState({id:"place.77809900",type:"Feature",relevance:1,place_name:"Cupertino, California, United States",bbox:[-122.15257,37.26471,-121.995462,37.340627],center:[-122.03229,37.322893],geometry:{type:"Point",coordinates:[-122.03229,37.322893]}});return Un.jsx(ex.Provider,{value:[e,n],children:t})},FL=we.createContext(),xst=({children:t})=>{const[e,n]=we.useState({type:"FeatureCollection",features:[]});return Un.jsx(FL.Provider,{value:[e,n],children:t})};function AE(){return AE=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},AE.apply(this,arguments)}function bst(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function f8(t,e){if(t==null)return{};var n=bst(t,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}var wst=["size","color"];function Est(t){var e=t.size,n=e===void 0?24:e,r=t.color,i=r===void 0?"currentColor":r,o=f8(t,wst);return ut.createElement("svg",AE({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-trash",width:n,height:n,viewBox:"0 0 24 24",stroke:i,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},o),ut.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),ut.createElement("line",{x1:"4",y1:"7",x2:"20",y2:"7"}),ut.createElement("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),ut.createElement("line",{x1:"14",y1:"11",x2:"14",y2:"17"}),ut.createElement("path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"}),ut.createElement("path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"}))}var Sst=["size","color"];function Tst(t){var e=t.size,n=e===void 0?24:e,r=t.color,i=r===void 0?"currentColor":r,o=f8(t,Sst);return ut.createElement("svg",AE({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-world-download",width:n,height:n,viewBox:"0 0 24 24",stroke:i,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},o),ut.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),ut.createElement("path",{d:"M21 12a9 9 0 1 0 -9 9"}),ut.createElement("path",{d:"M3.6 9h16.8"}),ut.createElement("path",{d:"M3.6 15h8.4"}),ut.createElement("path",{d:"M11.578 3a17 17 0 0 0 0 18"}),ut.createElement("path",{d:"M12.5 3c1.719 2.755 2.5 5.876 2.5 9"}),ut.createElement("path",{d:"M18 14v7m-3 -3l3 3l3 -3"}))}var Cst=["size","color"];function Pst(t){var e=t.size,n=e===void 0?24:e,r=t.color,i=r===void 0?"currentColor":r,o=f8(t,Cst);return ut.createElement("svg",AE({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-world-upload",width:n,height:n,viewBox:"0 0 24 24",stroke:i,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},o),ut.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),ut.createElement("path",{d:"M21 12a9 9 0 1 0 -9 9"}),ut.createElement("path",{d:"M3.6 9h16.8"}),ut.createElement("path",{d:"M3.6 15h8.4"}),ut.createElement("path",{d:"M11.578 3a17 17 0 0 0 0 18"}),ut.createElement("path",{d:"M12.5 3c1.719 2.755 2.5 5.876 2.5 9"}),ut.createElement("path",{d:"M18 21v-7m3 3l-3 -3l-3 3"}))}const Ist="pk.eyJ1IjoicHY1NjY3IiwiYSI6ImNsZGFtOHVoejBiZ2Mzb3A2djgyaDl1OGEifQ.FSssERk7wLiG1fDpen0iXA";function Mst(){const[t,e]=we.useContext(FL),[n,r]=we.useState("analysis"),[i,o]=we.useState(()=>Hp.DrawPolygonMode),[a,s]=we.useState([]),[u,d]=V4(!1),[g,_]=V4(!1),[E,P]=we.useState(!1),[R,B]=we.useState([]),[V,z]=we.useState(0),[F,k]=we.useState(0),X=we.useContext(ex)[0];console.log(X);const Y={latitude:X.center[1],longitude:X.center[0],zoom:14,pitch:0,bearing:0,transitionDuration:5e3,transitionInterpolator:new Kne},J=we.useRef(null),ie=()=>{var tt;(tt=J.current)==null||tt.scrollIntoView({behavior:"smooth"})};we.useEffect(()=>{ie()},[E]),console.log("Map.jsx location: ",X);function ce(){console.log("Inputted Selection:"+JSON.stringify(t)),P(!0),fetch("https://api.lec-hacks.org/detect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(tt){if(tt.ok)P(!1),tt.json().then(function(pt){console.log(typeof JSON.parse(pt));const Ee=JSON.parse(pt).features;B(Ee),z(Ee.length),e({type:"FeatureCollection",features:[]}),console.log(Ee),o(()=>Hp.ViewMode),r("view")});else throw P(!1),console.log(tt),d.open(),Error("Something went wrong")}).catch(tt=>{throw P(!1),console.log(tt),d.open(),Error("Something went wrong")})}function re(tt){const pt={type:"FeatureCollection",features:tt};return console.log(pt),pt}function ue(){console.log("Downloading Panels GeoJSON");const tt=re(R),pt="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(tt)),Ee=document.createElement("a");Ee.href=pt,Ee.download="panels.json",document.body.appendChild(Ee),Ee.click()}function se(tt){return(n4(tt)/Math.pow(1e3,2)).toFixed(2)}function me(){n=="view"?(o(()=>Hp.DrawPolygonMode),r("analysis")):(r("view"),o(()=>Hp.ViewMode))}const Ce=new bA({id:"poly-layers",data:R,pickable:!0,filled:!0,extruded:!0,wireframe:!0,getPolygon:tt=>tt.geometry.coordinates,getFillColor:[192,132,252],getLineColor:[168,85,247],getLineWidth:.3,getElevation:1,_normalize:!0}),be=new qie.EditableGeoJsonLayer({id:"geojson-layer",data:t,mode:i,selectedFeatureIndexes:a,onEdit:({updatedData:tt})=>{console.log(tt);const pt={units:"kilometers",mask:tt},Ee=Kce(z0(M6(tt,.06)),.12,pt);console.log("New Data:"),console.log(Ee),Ee.features.length>900&&(console.log(Ee.features.length),_.open()),console.log(Ee.features.length),e(Ee)}});let Ye;return we.useEffect(()=>(E?Ye=setInterval(()=>{k(tt=>{if(tt==="Almost Done...")return"Almost Done...";const pt=tt+Math.round(100/t.features.length);return pt>=100?"Almost Done...":pt})},2005):(console.log("Clearing Interval"),k(0),clearInterval(Ye)),()=>{clearInterval(Ye)}),[E,t.features.length]),we.useEffect(()=>{F===100&&E&&(k("Almost Done..."),P(!1),clearInterval(Ye))},[F,E]),Un.jsxs(Un.Fragment,{children:[Un.jsx(Qd,{size:"xl",opened:u,onClose:d.close,withCloseButton:!1,centered:!0,children:Un.jsx(Uy,{position:"center",direction:"row",spacing:"xs",children:"Oops! Something went wrong. A quick refresh should fix it."})}),Un.jsx(Qd,{size:"xl",opened:g,onClose:_.close,withCloseButton:!1,centered:!0,children:Un.jsx(Uy,{position:"center",direction:"row",spacing:"xs",children:"Oops! Please reduce the size of your selection."})}),Un.jsx("div",{children:Un.jsx(l8,{children:Un.jsxs(c8,{spacing:"lg",children:[Un.jsx(go,{sx:{width:"50em",height:"50em",m:4,borderRadius:4,position:"relative"},className:"ml-auto mr-auto",children:Un.jsx(TCe,{initialViewState:Y,controller:{doubleClickZoom:!1},id:"deck-gl",layers:[Ce,be],getCursor:be.getCursor.bind(be),getTooltip:i===Hp.ViewMode?({object:tt})=>tt&&`Area: ${n4(tt).toFixed(3)} m²
Lon: ${tt.geometry.coordinates[0][0][0].toFixed(4)}
Lat: ${tt.geometry.coordinates[0][0][1].toFixed(4)}`:null,children:Un.jsx($O,{id:"map",controller:!1,width:"100%",height:"100%",children:Un.jsx(pXe,{mapStyle:"mapbox://styles/mapbox/satellite-v9",mapboxAccessToken:Ist})})})}),t.features.length>0&&Un.jsxs(Uy,{position:"center",direction:"row",spacing:"xs",children:[Un.jsxs(xP,{order:4,c:"white",children:["Area: ",se(t)," km²"]}),Un.jsxs("button",{type:"button",class:`inline-flex items-center py-2 text-white 
        text-md font-medium rounded-md gap-1 hover:text-red-500 p-1 outline focus:outline-none focus:ring focus:ring-red`,onClick:()=>e({type:"FeatureCollection",features:[]}),children:["Clear Selection",Un.jsx(Est,{size:20})]})]}),Un.jsx(Uy,{position:"center",direction:"row",spacing:"xs",children:Un.jsx(qce,{value:n,onChange:me,data:[{label:"Select Mode",value:"analysis"},{label:"View Mode",value:"view"}]})}),n==="analysis"&&Un.jsx(Un.Fragment,{children:Un.jsx("button",{class:"bg-purple-400 hover:bg-purple-500 text-white font-bold py-2 px-4 rounded disabled:opacity-75 disabled:hover:bg-blue-500",disabled:t.features.length>900,onClick:ce,children:"Submit Selection"})}),E&&Un.jsxs("div",{class:"p-6 space-y-4",ref:J,children:[Un.jsx($ce,{value:F,label:F+"%",size:"xl",radius:"xl"}),Un.jsx(Uy,{position:"center",direction:"row",spacing:"xs",children:Un.jsx(xP,{order:4,c:"white",children:"Detecting Solar Panels..."})})]}),V>0&&Un.jsxs(Un.Fragment,{children:[Un.jsxs(xP,{style:{color:"#e8caf1"},children:[V," Panels Found"]}),Un.jsx("div",{class:"max-w-6xl mx-auto pb-16",children:Un.jsxs("button",{type:"button",class:"inline-flex items-center px-4 py-2 text-white text-md font-medium rounded-md gap-2.5 outline outline-1 hover:outline-blue-400 focus:outline-none focus:ring focus:ring-violet-300",onClick:ue,children:[Un.jsx(Tst,{size:20}),"Download Panel GeoJSON"]})})]})]})})})]})}var Jce={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Ya,function(){var n,r,i;function o(s,u){if(!n)n=u;else if(!r)r=u;else{var d="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",g={};n(g),i=u(g),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([d],{type:"text/javascript"})))}}o(["exports"],function(s){var u=typeof self<"u"?self:{},d="2.15.0";let g;const _={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(g==null){const c=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{g={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):c}catch{g=c}}return g},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!_.API_URL)return null;try{const c=new URL(_.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},E={supported:!1,testSupport:function(c){!B&&R&&(V?z(c):P=c)}};let P,R,B=!1,V=!1;function z(c){const l=c.createTexture();c.bindTexture(c.TEXTURE_2D,l);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,R),c.isContextLost())return;E.supported=!0}catch{}c.deleteTexture(l),B=!0}u.document&&(R=u.document.createElement("img"),R.onload=function(){P&&z(P),P=null,V=!0},R.onerror=function(){B=!0,P=null},R.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const F="01";function k(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var X=Y;function Y(c,l,f,p){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(p-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=l,this.p2x=f,this.p2y=p}Y.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,l){if(l===void 0&&(l=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,p=0;p<8;p++){var A=this.sampleCurveX(f)-c;if(Math.abs(A)<l)return f;var b=this.sampleCurveDerivativeX(f);if(Math.abs(b)<1e-6)break;f-=A/b}var C=0,M=1;for(f=c,p=0;p<20&&(A=this.sampleCurveX(f),!(Math.abs(A-c)<l));p++)c>A?C=f:M=f,f=.5*(M-C)+C;return f},solve:function(c,l){return this.sampleCurveY(this.solveCurveX(c,l))}};var J=k(X),ie=ce;function ce(c,l){this.x=c,this.y=l}ce.prototype={clone:function(){return new ce(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,l){return this.clone()._rotateAround(c,l)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var l=c.x-this.x,f=c.y-this.y;return l*l+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,l){return Math.atan2(this.x*l-this.y*c,this.x*c+this.y*l)},_matMult:function(c){var l=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=l,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var l=Math.cos(c),f=Math.sin(c),p=f*this.x+l*this.y;return this.x=l*this.x-f*this.y,this.y=p,this},_rotateAround:function(c,l){var f=Math.cos(c),p=Math.sin(c),A=l.y+p*(this.x-l.x)+f*(this.y-l.y);return this.x=l.x+f*(this.x-l.x)-p*(this.y-l.y),this.y=A,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ce.convert=function(c){return c instanceof ce?c:Array.isArray(c)?new ce(c[0],c[1]):c};var re=k(ie);const ue=Math.PI/180,se=180/Math.PI;function me(c){return c*ue}function Ce(c){return c*se}const be=[[0,0],[1,0],[1,1],[0,1]];function Ye(c){if(c<=0)return 0;if(c>=1)return 1;const l=c*c,f=l*c;return 4*(c<.5?f:3*(c-l)+f-.75)}function tt(c,l,f,p){const A=new J(c,l,f,p);return function(b){return A.solve(b)}}const pt=tt(.25,.1,.25,1);function Ee(c,l,f){return Math.min(f,Math.max(l,c))}function Ne(c,l,f){return(f=Ee((f-c)/(l-c),0,1))*f*(3-2*f)}function Be(c,l,f){const p=f-l,A=((c-l)%p+p)%p+l;return A===l?f:A}function qe(c,l,f){if(!c.length)return f(null,[]);let p=c.length;const A=new Array(c.length);let b=null;c.forEach((C,M)=>{l(C,(N,U)=>{N&&(b=N),A[M]=U,--p==0&&f(b,A)})})}function ct(c){const l=[];for(const f in c)l.push(c[f]);return l}function Ct(c,...l){for(const f of l)for(const p in f)c[p]=f[p];return c}let Dt=1;function In(){return Dt++}function Mn(){return function c(l){return l?(l^Math.random()*(16>>l/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()}function Tn(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function Nt(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)}function Zt(c,l){c.forEach(f=>{l[f]&&(l[f]=l[f].bind(l))})}function Wt(c,l){return c.indexOf(l,c.length-l.length)!==-1}function hn(c,l,f){const p={};for(const A in c)p[A]=l.call(f||this,c[A],A,c);return p}function lr(c,l,f){const p={};for(const A in c)l.call(f||this,c[A],A,c)&&(p[A]=c[A]);return p}function It(c){return Array.isArray(c)?c.map(It):typeof c=="object"&&c?hn(c,It):c}const Xt={};function $t(c){Xt[c]||(typeof console<"u"&&console.warn(c),Xt[c]=!0)}function cn(c,l,f){return(f.y-c.y)*(l.x-c.x)>(l.y-c.y)*(f.x-c.x)}function Jt(c){let l=0;for(let f,p,A=0,b=c.length,C=b-1;A<b;C=A++)f=c[A],p=c[C],l+=(p.x-f.x)*(f.y+p.y);return l}function Ln(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function qn(c){const l={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,p,A,b)=>{const C=A||b;return l[p]=!C||C.toLowerCase(),""}),l["max-age"]){const f=parseInt(l["max-age"],10);isNaN(f)?delete l["max-age"]:l["max-age"]=f}return l}let or=null;function cr(c){if(or==null){const l=c.navigator?c.navigator.userAgent:null;or=!!c.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return or}function cs(c){try{const l=u[c];return l.setItem("_mapbox_test_",1),l.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ri(c,l){return[c[4*l],c[4*l+1],c[4*l+2],c[4*l+3]]}const Do="mapbox-tiles";let Fa=500,Nl=50,_s,mo;function Fl(){try{return u.caches}catch{}}function su(){Fl()&&!_s&&(_s=u.caches.open(Do))}function kl(c){const l=c.indexOf("?");if(l<0)return c;const f=function(A){const b=A.indexOf("?");return b>0?A.slice(b+1).split("&"):[]}(c),p=f.filter(A=>{const b=A.split("=");return b[0]==="language"||b[0]==="worldview"});return p.length?`${c.slice(0,l)}?${p.join("&")}`:c.slice(0,l)}let au=1/0;const $u={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze($u);class lu extends Error{constructor(l,f,p){f===401&&ht(p)&&(l+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(l),this.status=f,this.url=p}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Hu=Ln()?()=>self.worker&&self.worker.referrer:()=>(u.location.protocol==="blob:"?u.parent:u).location.href,uu=function(c,l){if(!(/^file:/.test(f=c.url)||/^file:/.test(Hu())&&!/^\w+:/.test(f))){if(u.fetch&&u.Request&&u.AbortController&&u.Request.prototype.hasOwnProperty("signal"))return function(p,A){const b=new u.AbortController,C=new u.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:Hu(),referrerPolicy:p.referrerPolicy,signal:b.signal});let M=!1,N=!1;const U=(W=C.url).indexOf("sku=")>0&&ht(W);var W;p.type==="json"&&C.headers.set("Accept","application/json");const K=(oe,le,de)=>{if(N)return;if(oe&&oe.message!=="SecurityError"&&$t(oe.toString()),le&&de)return ee(le);const xe=Date.now();u.fetch(C).then(Le=>{if(Le.ok){const $e=U?Le.clone():null;return ee(Le,$e,xe)}return A(new lu(Le.statusText,Le.status,p.url))}).catch(Le=>{Le.name!=="AbortError"&&A(new Error(`${Le.message} ${p.url}`))})},ee=(oe,le,de)=>{(p.type==="arrayBuffer"?oe.arrayBuffer():p.type==="json"?oe.json():oe.text()).then(xe=>{N||(le&&de&&function(Le,$e,De){if(su(),!_s)return;const je={status:$e.status,statusText:$e.statusText,headers:new u.Headers};$e.headers.forEach((bt,_t)=>je.headers.set(_t,bt));const Ze=qn($e.headers.get("Cache-Control")||"");if(Ze["no-store"])return;Ze["max-age"]&&je.headers.set("Expires",new Date(De+1e3*Ze["max-age"]).toUTCString());const We=je.headers.get("Expires");We&&(new Date(We).getTime()-De<42e4||function(bt,_t){if(mo===void 0)try{new Response(new ReadableStream),mo=!0}catch{mo=!1}mo?_t(bt.body):bt.blob().then(_t)}($e,bt=>{const _t=new u.Response(bt,je);su(),_s&&_s.then(Ft=>Ft.put(kl(Le.url),_t)).catch(Ft=>$t(Ft.message))}))}(C,le,de),M=!0,A(null,xe,oe.headers.get("Cache-Control"),oe.headers.get("Expires")))}).catch(xe=>{N||A(new Error(xe.message))})};return U?function(oe,le){if(su(),!_s)return le(null);const de=kl(oe.url);_s.then(xe=>{xe.match(de).then(Le=>{const $e=function(De){if(!De)return!1;const je=new Date(De.headers.get("Expires")||0),Ze=qn(De.headers.get("Cache-Control")||"");return je>Date.now()&&!Ze["no-cache"]}(Le);xe.delete(de),$e&&xe.put(de,Le.clone()),le(null,Le,$e)}).catch(le)}).catch(le)}(C,K):K(null,null),{cancel:()=>{N=!0,M||b.abort()}}}(c,l);if(Ln()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,l,void 0,!0)}var f;return function(p,A){const b=new u.XMLHttpRequest;b.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(b.responseType="arraybuffer");for(const C in p.headers)b.setRequestHeader(C,p.headers[C]);return p.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=p.credentials==="include",b.onerror=()=>{A(new Error(b.statusText))},b.onload=()=>{if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let C=b.response;if(p.type==="json")try{C=JSON.parse(b.response)}catch(M){return A(M)}A(null,C,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else A(new lu(b.statusText,b.status,p.url))},b.send(p.body),{cancel:()=>b.abort()}}(c,l)},Fc=function(c,l){return uu(Ct(c,{type:"arrayBuffer"}),l)};function Wu(c){const l=u.document.createElement("a");return l.href=c,l.protocol===u.document.location.protocol&&l.host===u.document.location.host}const Ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ge,Ae;ge=[],Ae=0;const ze=function(c,l){if(E.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Ae>=_.MAX_PARALLEL_IMAGE_REQUESTS){const b={requestParameters:c,callback:l,cancelled:!1,cancel(){this.cancelled=!0}};return ge.push(b),b}Ae++;let f=!1;const p=()=>{if(!f)for(f=!0,Ae--;ge.length&&Ae<_.MAX_PARALLEL_IMAGE_REQUESTS;){const b=ge.shift(),{requestParameters:C,callback:M,cancelled:N}=b;N||(b.cancel=ze(C,M).cancel)}},A=Fc(c,(b,C,M,N)=>{p(),b?l(b):C&&(u.createImageBitmap?function(U,W){const K=new u.Blob([new Uint8Array(U)],{type:"image/png"});u.createImageBitmap(K).then(ee=>{W(null,ee)}).catch(ee=>{W(new Error(`Could not load image because of ${ee.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(C,(U,W)=>l(U,W,M,N)):function(U,W){const K=new u.Image,ee=u.URL;K.onload=()=>{W(null,K),ee.revokeObjectURL(K.src),K.onload=null,u.requestAnimationFrame(()=>{K.src=Ge})},K.onerror=()=>W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const oe=new u.Blob([new Uint8Array(U)],{type:"image/png"});K.src=U.byteLength?ee.createObjectURL(oe):Ge}(C,(U,W)=>l(U,W,M,N)))});return{cancel:()=>{A.cancel(),p()}}},Me="NO_ACCESS_TOKEN";function it(c){return c.indexOf("mapbox:")===0}function ht(c){return _.API_URL_REGEX.test(c)}function ft(c){return _.API_CDN_URL_REGEX.test(c)}function rt(c){return _.API_STYLE_REGEX.test(c)&&!wt(c)}function wt(c){return _.API_SPRITE_REGEX.test(c)}const sn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function dn(c){const l=c.match(sn);if(!l)throw new Error("Unable to parse URL object");return{protocol:l[1],authority:l[2],path:l[3]||"/",params:l[4]?l[4].split("&"):[]}}function Qt(c){const l=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${l}`}const sr="mapbox.eventData";function pr(c){if(!c)return null;const l=c.split(".");if(!l||l.length!==3)return null;try{return JSON.parse(decodeURIComponent(u.atob(l[1]).split("").map(f=>"%"+("00"+f.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class tr{constructor(l){this.type=l,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(l){const f=pr(_.ACCESS_TOKEN);let p="";return p=f&&f.u?u.btoa(encodeURIComponent(f.u).replace(/%([0-9A-F]{2})/g,(A,b)=>String.fromCharCode(+("0x"+b)))):_.ACCESS_TOKEN||"",l?`${sr}.${l}:${p}`:`${sr}:${p}`}fetchEventData(){const l=cs("localStorage"),f=this.getStorageKey(),p=this.getStorageKey("uuid");if(l)try{const A=u.localStorage.getItem(f);A&&(this.eventData=JSON.parse(A));const b=u.localStorage.getItem(p);b&&(this.anonId=b)}catch{$t("Unable to read from LocalStorage")}}saveEventData(){const l=cs("localStorage"),f=this.getStorageKey(),p=this.getStorageKey("uuid");if(l)try{u.localStorage.setItem(p,this.anonId),Object.keys(this.eventData).length>=1&&u.localStorage.setItem(f,JSON.stringify(this.eventData))}catch{$t("Unable to write to LocalStorage")}}processRequests(l){}postEvent(l,f,p,A){if(!_.EVENTS_URL)return;const b=dn(_.EVENTS_URL);b.params.push(`access_token=${A||_.ACCESS_TOKEN||""}`);const C={event:this.type,created:new Date(l).toISOString()},M=f?Ct(C,f):C,N={url:Qt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=function(U,W){return uu(Ct(U,{method:"POST"}),W)}(N,U=>{this.pendingRequest=null,p(U),this.saveEventData(),this.processRequests(A)})}queueRequest(l,f){this.queue.push(l),this.processRequests(f)}}const st=new class extends tr{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,l){_.EVENTS_URL&&_.ACCESS_TOKEN&&Array.isArray(c)&&c.some(f=>it(f)||ht(f))&&this.queueRequest(Date.now(),l)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const l=pr(_.ACCESS_TOKEN),f=l?l.u:_.ACCESS_TOKEN;let p=f!==this.eventData.tokenU;Nt(this.anonId)||(this.anonId=Mn(),p=!0);const A=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),C=new Date(A),M=(A-this.eventData.lastSuccess)/864e5;p=p||M>=1||M<-1||b.getDate()!==C.getDate()}else p=!0;p?this.postEvent(A,{sdkIdentifier:"mapbox-gl-js",sdkVersion:d,skuId:F,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=A,this.eventData.tokenU=f)},c):this.processRequests()}},Pt=st.postTurnstileEvent.bind(st),rn=new class extends tr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,l,f,p){this.skuToken=l,this.errorCb=p,_.EVENTS_URL&&(f||_.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},f):this.errorCb(new Error(Me)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:f}=this.queue.shift();l&&this.success[l]||(this.anonId||this.fetchEventData(),Nt(this.anonId)||(this.anonId=Mn()),this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:d,skuId:F,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):l&&(this.success[l]=!0)},c))}},Gn=rn.postMapLoadEvent.bind(rn),w=new class extends tr{constructor(){super("gljs.performance")}postPerformanceEvent(c,l){_.EVENTS_URL&&(c||_.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:l},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:l,performanceData:f}=this.queue.shift(),p=function(A){const b=u.performance.getEntriesByType("resource"),C=u.performance.getEntriesByType("mark"),M=function(ee){const oe={};if(ee){for(const le in ee)if(le!=="other")for(const de of ee[le]){const xe=`${le}ResolveRangeMin`,Le=`${le}ResolveRangeMax`,$e=`${le}RequestCount`,De=`${le}RequestCachedCount`;oe[xe]=Math.min(oe[xe]||1/0,de.startTime),oe[Le]=Math.max(oe[Le]||-1/0,de.responseEnd);const je=Ze=>{oe[Ze]===void 0&&(oe[Ze]=0),++oe[Ze]};de.transferSize!==void 0&&de.transferSize===0&&je(De),je($e)}}return oe}(function(ee,oe){const le={};if(ee)for(const de of ee){const xe=oe(de);le[xe]===void 0&&(le[xe]=[]),le[xe].push(de)}return le}(b,qr)),N=u.devicePixelRatio,U=u.navigator.connection||u.navigator.mozConnection||u.navigator.webkitConnection,W={counters:[],metadata:[],attributes:[]},K=(ee,oe,le)=>{le!=null&&ee.push({name:oe,value:le.toString()})};for(const ee in M)K(W.counters,ee,M[ee]);if(A.interactionRange[0]!==1/0&&A.interactionRange[1]!==-1/0&&(K(W.counters,"interactionRangeMin",A.interactionRange[0]),K(W.counters,"interactionRangeMax",A.interactionRange[1])),C)for(const ee of Object.keys(Tr)){const oe=Tr[ee],le=C.find(de=>de.name===oe);le&&K(W.counters,oe,le.startTime)}return K(W.counters,"visibilityHidden",A.visibilityHidden),K(W.attributes,"style",function(ee){if(ee)for(const oe of ee){const le=oe.name.split("?")[0];if(rt(le)){const de=le.split("/").slice(-2);if(de.length===2)return`mapbox://styles/${de[0]}/${de[1]}`}}}(b)),K(W.attributes,"terrainEnabled",A.terrainEnabled?"true":"false"),K(W.attributes,"fogEnabled",A.fogEnabled?"true":"false"),K(W.attributes,"projection",A.projection),K(W.attributes,"zoom",A.zoom),K(W.metadata,"devicePixelRatio",N),K(W.metadata,"connectionEffectiveType",U?U.effectiveType:void 0),K(W.metadata,"navigatorUserAgent",u.navigator.userAgent),K(W.metadata,"screenWidth",u.screen.width),K(W.metadata,"screenHeight",u.screen.height),K(W.metadata,"windowWidth",u.innerWidth),K(W.metadata,"windowHeight",u.innerHeight),K(W.metadata,"mapWidth",A.width/N),K(W.metadata,"mapHeight",A.height/N),K(W.metadata,"webglRenderer",A.renderer),K(W.metadata,"webglVendor",A.vendor),K(W.metadata,"sdkVersion",d),K(W.metadata,"sdkIdentifier","mapbox-gl-js"),W}(f);for(const A of p.metadata);for(const A of p.counters);for(const A of p.attributes);this.postEvent(l,p,()=>{},c)}},Ue=w.postPerformanceEvent.bind(w),Ir=new class extends tr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,l,f,p){if(!_.API_URL||!_.SESSION_PATH)return;const A=dn(_.API_URL+_.SESSION_PATH);A.params.push(`sku=${l||""}`),A.params.push(`access_token=${p||_.ACCESS_TOKEN||""}`);const b={url:Qt(A),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(C,M){return uu(Ct(C,{method:"GET"}),M)}(b,C=>{this.pendingRequest=null,f(C),this.saveEventData(),this.processRequests(p)})}getSessionAPI(c,l,f,p){this.skuToken=l,this.errorCb=p,_.SESSION_PATH&&_.API_URL&&(f||_.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},f):this.errorCb(new Error(Me)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:f}=this.queue.shift();l&&this.success[l]||this.getSession(f,this.skuToken,p=>{p?this.errorCb(p):l&&(this.success[l]=!0)},c)}},fr=Ir.getSessionAPI.bind(Ir),rr=new Set,Tr={create:"create",load:"load",fullLoad:"fullLoad"},qi={mark(c){u.performance.mark(c)},measure(c,l,f){u.performance.measure(c,l,f)}};function qr(c){const l=c.name.split("?")[0];return ft(l)&&l.includes("mapbox-gl.js")?"javascript":ft(l)&&l.includes("mapbox-gl.css")?"css":function(f){return _.API_FONTS_REGEX.test(f)}(l)?"fontRange":wt(l)?"sprite":rt(l)?"style":function(f){return _.API_TILEJSON_REGEX.test(f)}(l)?"tilejson":"other"}const jn=u.performance;function ro(c){const l=c?c.url.toString():void 0;return jn.getEntriesByName(l)}let ca,kc,zl,Qr;const Vo={now:()=>zl!==void 0?zl:u.performance.now(),setNow(c){zl=c},restoreNow(){zl=void 0},frame(c){const l=u.requestAnimationFrame(c);return{cancel:()=>u.cancelAnimationFrame(l)}},getImageData(c,l=0){const{width:f,height:p}=c;Qr||(Qr=u.document.createElement("canvas"));const A=Qr.getContext("2d",{willReadFrequently:!0});if(!A)throw new Error("failed to create canvas 2d context");return(f>Qr.width||p>Qr.height)&&(Qr.width=f,Qr.height=p),A.clearRect(-l,-l,f+2*l,p+2*l),A.drawImage(c,0,0,f,p),A.getImageData(-l,-l,f+2*l,p+2*l)},resolveURL:c=>(ca||(ca=u.document.createElement("a")),ca.href=c,ca.href),get devicePixelRatio(){return u.devicePixelRatio},get prefersReducedMotion(){return!!u.matchMedia&&(kc==null&&(kc=u.matchMedia("(prefers-reduced-motion: reduce)")),kc.matches)}};function Bo(c,l,f){f[c]&&f[c].indexOf(l)!==-1||(f[c]=f[c]||[],f[c].push(l))}function ka(c,l,f){if(f&&f[c]){const p=f[c].indexOf(l);p!==-1&&f[c].splice(p,1)}}class $o{constructor(l,f={}){Ct(this,f),this.type=l}}class Hn extends $o{constructor(l,f={}){super("error",Ct({error:l},f))}}class Ke{on(l,f){return this._listeners=this._listeners||{},Bo(l,f,this._listeners),this}off(l,f){return ka(l,f,this._listeners),ka(l,f,this._oneTimeListeners),this}once(l,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},Bo(l,f,this._oneTimeListeners),this):new Promise(p=>this.once(l,p))}fire(l,f){typeof l=="string"&&(l=new $o(l,f||{}));const p=l.type;if(this.listens(p)){l.target=this;const A=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const M of A)M.call(this,l);const b=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const M of b)ka(p,M,this._oneTimeListeners),M.call(this,l);const C=this._eventedParent;C&&(Ct(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),C.fire(l))}else l instanceof Hn&&console.error(l.error);return this}listens(l){return!!(this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l))}setEventedParent(l,f){return this._eventedParent=l,this._eventedParentData=f,this}}var gt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function za(c,...l){for(const f of l)for(const p in f)c[p]=f[p];return c}function Vi(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function gi(c){if(Array.isArray(c))return c.map(gi);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const l={};for(const f in c)l[f]=gi(c[f]);return l}return Vi(c)}class Nf extends Error{constructor(l,f){super(f),this.message=f,this.key=l}}var fa=Nf;class Ve{constructor(l,f=[]){this.parent=l,this.bindings={};for(const[p,A]of f)this.bindings[p]=A}concat(l){return new Ve(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}var $h=Ve;const cu={kind:"null"},_n={kind:"number"},ur={kind:"string"},Cr={kind:"boolean"},Os={kind:"color"},Rs={kind:"object"},xr={kind:"value"},ys={kind:"collator"},Ls={kind:"formatted"},ye={kind:"resolvedImage"};function Oe(c,l){return{kind:"array",itemType:c,N:l}}function He(c){if(c.kind==="array"){const l=He(c.itemType);return typeof c.N=="number"?`array<${l}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${l}>`}return c.kind}const Ot=[cu,_n,ur,Cr,Os,Ls,Rs,Oe(xr),ye];function on(c,l){if(l.kind==="error")return null;if(c.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!on(c.itemType,l.itemType))&&(typeof c.N!="number"||c.N===l.N))return null}else{if(c.kind===l.kind)return null;if(c.kind==="value"){for(const f of Ot)if(!on(f,l))return null}}return`Expected ${He(c)} but found ${He(l)} instead.`}function Fn(c,l){return l.some(f=>f.kind===c.kind)}function Rr(c,l){return l.some(f=>f==="null"?c===null:f==="array"?Array.isArray(c):f==="object"?c&&!Array.isArray(c)&&typeof c=="object":f===typeof c)}var Ao,Lr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ao(c){return(c=Math.round(c))<0?0:c>255?255:c}function vs(c){return ao(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function Ig(c){return(l=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:l>1?1:l;var l}function Hh(c,l,f){return f<0?f+=1:f>1&&(f-=1),6*f<1?c+(l-c)*f*6:2*f<1?l:3*f<2?c+(l-c)*(2/3-f)*6:c}try{Ao={}.parseCSSColor=function(c){var l,f=c.replace(/ /g,"").toLowerCase();if(f in Lr)return Lr[f].slice();if(f[0]==="#")return f.length===4?(l=parseInt(f.substr(1),16))>=0&&l<=4095?[(3840&l)>>4|(3840&l)>>8,240&l|(240&l)>>4,15&l|(15&l)<<4,1]:null:f.length===7&&(l=parseInt(f.substr(1),16))>=0&&l<=16777215?[(16711680&l)>>16,(65280&l)>>8,255&l,1]:null;var p=f.indexOf("("),A=f.indexOf(")");if(p!==-1&&A+1===f.length){var b=f.substr(0,p),C=f.substr(p+1,A-(p+1)).split(","),M=1;switch(b){case"rgba":if(C.length!==4)return null;M=Ig(C.pop());case"rgb":return C.length!==3?null:[vs(C[0]),vs(C[1]),vs(C[2]),M];case"hsla":if(C.length!==4)return null;M=Ig(C.pop());case"hsl":if(C.length!==3)return null;var N=(parseFloat(C[0])%360+360)%360/360,U=Ig(C[1]),W=Ig(C[2]),K=W<=.5?W*(U+1):W+U-W*U,ee=2*W-K;return[ao(255*Hh(ee,K,N+1/3)),ao(255*Hh(ee,K,N)),ao(255*Hh(ee,K,N-1/3)),M];default:return null}}return null}}catch{}class ha{constructor(l,f,p,A=1){this.r=l,this.g=f,this.b=p,this.a=A}static parse(l){if(!l)return;if(l instanceof ha)return l;if(typeof l!="string")return;const f=Ao(l);return f?new ha(f[0]/255*f[3],f[1]/255*f[3],f[2]/255*f[3],f[3]):void 0}toString(){const[l,f,p,A]=this.toArray();return`rgba(${Math.round(l)},${Math.round(f)},${Math.round(p)},${A})`}toArray(){const{r:l,g:f,b:p,a:A}=this;return A===0?[0,0,0,0]:[255*l/A,255*f/A,255*p/A,A]}toArray01(){const{r:l,g:f,b:p,a:A}=this;return A===0?[0,0,0,0]:[l/A,f/A,p/A,A]}toArray01PremultipliedAlpha(){const{r:l,g:f,b:p,a:A}=this;return[l,f,p,A]}}ha.black=new ha(0,0,0,1),ha.white=new ha(1,1,1,1),ha.transparent=new ha(0,0,0,0),ha.red=new ha(1,0,0,1),ha.blue=new ha(0,0,1,1);var lo=ha;class op{constructor(l,f,p){this.sensitivity=l?f?"variant":"case":f?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,f){return this.collator.compare(l,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class sp{constructor(l,f,p,A,b){this.text=l.normalize?l.normalize():l,this.image=f,this.scale=p,this.fontStack=A,this.textColor=b}}class da{constructor(l){this.sections=l}static fromString(l){return new da([new sp(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof da?l:da.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}serialize(){const l=["format"];for(const f of this.sections){if(f.image){l.push(["image",f.image.name]);continue}l.push(f.text);const p={};f.fontStack&&(p["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(p["font-scale"]=f.scale),f.textColor&&(p["text-color"]=["rgba"].concat(f.textColor.toArray())),l.push(p)}return l}}class il{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new il({name:l,available:!1}):null}serialize(){return["image",this.name]}}function EA(c,l,f,p){return typeof c=="number"&&c>=0&&c<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof f=="number"&&f>=0&&f<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[c,l,f,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[c,l,f,p]:[c,l,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Wh(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof lo||c instanceof op||c instanceof da||c instanceof il)return!0;if(Array.isArray(c)){for(const l of c)if(!Wh(l))return!1;return!0}if(typeof c=="object"){for(const l in c)if(!Wh(c[l]))return!1;return!0}return!1}function Xi(c){if(c===null)return cu;if(typeof c=="string")return ur;if(typeof c=="boolean")return Cr;if(typeof c=="number")return _n;if(c instanceof lo)return Os;if(c instanceof op)return ys;if(c instanceof da)return Ls;if(c instanceof il)return ye;if(Array.isArray(c)){const l=c.length;let f;for(const p of c){const A=Xi(p);if(f){if(f===A)continue;f=xr;break}f=A}return Oe(f||xr,l)}return Rs}function ap(c){const l=typeof c;return c===null?"":l==="string"||l==="number"||l==="boolean"?String(c):c instanceof lo||c instanceof da||c instanceof il?c.toString():JSON.stringify(c)}class SA{constructor(l,f){this.type=l,this.value=f}static parse(l,f){if(l.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!Wh(l[1]))return f.error("invalid value");const p=l[1];let A=Xi(p);const b=f.expectedType;return A.kind!=="array"||A.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(A=b),new SA(A,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof lo?["rgba"].concat(this.value.toArray()):this.value instanceof da?this.value.serialize():this.value}}var Ff=SA,li=class{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}};const qu={string:ur,number:_n,boolean:Cr,object:Rs};class xs{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");let p,A=1;const b=l[0];if(b==="array"){let M,N;if(l.length>2){const U=l[1];if(typeof U!="string"||!(U in qu)||U==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);M=qu[U],A++}else M=xr;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return f.error('The length argument to "array" must be a positive integer literal',2);N=l[2],A++}p=Oe(M,N)}else p=qu[b];const C=[];for(;A<l.length;A++){const M=f.parse(l[A],A,xr);if(!M)return null;C.push(M)}return new xs(p,C)}evaluate(l){for(let f=0;f<this.args.length;f++){const p=this.args[f].evaluate(l);if(!on(this.type,Xi(p)))return p;if(f===this.args.length-1)throw new li(`Expected value to be of type ${He(this.type)}, but found ${He(Xi(p))} instead.`)}return null}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){const l=this.type,f=[l.kind];if(l.kind==="array"){const p=l.itemType;if(p.kind==="string"||p.kind==="number"||p.kind==="boolean"){f.push(p.kind);const A=l.N;(typeof A=="number"||this.args.length>1)&&f.push(A)}}return f.concat(this.args.map(p=>p.serialize()))}}var Ul=xs;class Xu{constructor(l){this.type=Ls,this.sections=l}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");const p=l[1];if(!Array.isArray(p)&&typeof p=="object")return f.error("First argument must be an image or text section.");const A=[];let b=!1;for(let C=1;C<=l.length-1;++C){const M=l[C];if(b&&typeof M=="object"&&!Array.isArray(M)){b=!1;let N=null;if(M["font-scale"]&&(N=f.parse(M["font-scale"],1,_n),!N))return null;let U=null;if(M["text-font"]&&(U=f.parse(M["text-font"],1,Oe(ur)),!U))return null;let W=null;if(M["text-color"]&&(W=f.parse(M["text-color"],1,Os),!W))return null;const K=A[A.length-1];K.scale=N,K.font=U,K.textColor=W}else{const N=f.parse(l[C],1,xr);if(!N)return null;const U=N.type.kind;if(U!=="string"&&U!=="value"&&U!=="null"&&U!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,A.push({content:N,scale:null,font:null,textColor:null})}}return new Xu(A)}evaluate(l){return new da(this.sections.map(f=>{const p=f.content.evaluate(l);return Xi(p)===ye?new sp("",p,null,null,null):new sp(ap(p),null,f.scale?f.scale.evaluate(l):null,f.font?f.font.evaluate(l).join(","):null,f.textColor?f.textColor.evaluate(l):null)}))}eachChild(l){for(const f of this.sections)l(f.content),f.scale&&l(f.scale),f.font&&l(f.font),f.textColor&&l(f.textColor)}outputDefined(){return!1}serialize(){const l=["format"];for(const f of this.sections){l.push(f.content.serialize());const p={};f.scale&&(p["font-scale"]=f.scale.serialize()),f.font&&(p["text-font"]=f.font.serialize()),f.textColor&&(p["text-color"]=f.textColor.serialize()),l.push(p)}return l}}class kf{constructor(l){this.type=ye,this.input=l}static parse(l,f){if(l.length!==2)return f.error("Expected two arguments.");const p=f.parse(l[1],1,ur);return p?new kf(p):f.error("No image name provided.")}evaluate(l){const f=this.input.evaluate(l),p=il.fromString(f);return p&&l.availableImages&&(p.available=l.availableImages.indexOf(f)>-1),p}eachChild(l){l(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const T_={"to-boolean":Cr,"to-color":Os,"to-number":_n,"to-string":ur};class lp{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");const p=l[0];if((p==="to-boolean"||p==="to-string")&&l.length!==2)return f.error("Expected one argument.");const A=T_[p],b=[];for(let C=1;C<l.length;C++){const M=f.parse(l[C],C,xr);if(!M)return null;b.push(M)}return new lp(A,b)}evaluate(l){if(this.type.kind==="boolean")return!!this.args[0].evaluate(l);if(this.type.kind==="color"){let f,p;for(const A of this.args){if(f=A.evaluate(l),p=null,f instanceof lo)return f;if(typeof f=="string"){const b=l.parseColor(f);if(b)return b}else if(Array.isArray(f)&&(p=f.length<3||f.length>4?`Invalid rbga value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:EA(f[0],f[1],f[2],f[3]),!p))return new lo(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new li(p||`Could not parse color from value '${typeof f=="string"?f:String(JSON.stringify(f))}'`)}if(this.type.kind==="number"){let f=null;for(const p of this.args){if(f=p.evaluate(l),f===null)return 0;const A=Number(f);if(!isNaN(A))return A}throw new li(`Could not convert ${JSON.stringify(f)} to number.`)}return this.type.kind==="formatted"?da.fromString(ap(this.args[0].evaluate(l))):this.type.kind==="resolvedImage"?il.fromString(ap(this.args[0].evaluate(l))):ap(this.args[0].evaluate(l))}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Xu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new kf(this.args[0]).serialize();const l=[`to-${this.type.kind}`];return this.eachChild(f=>{l.push(f.serialize())}),l}}var Zu=lp;const Ds=["Unknown","Point","LineString","Polygon"];var Mg=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ds[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const c=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:f,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(f*l-c[0])+this.featureDistanceData.bearing[1]*(p*l-c[1])}return 0}parseColor(c){let l=this._parseColorCache[c];return l||(l=this._parseColorCache[c]=lo.parse(c)),l}};class zc{constructor(l,f,p,A){this.name=l,this.type=f,this._evaluate=p,this.args=A}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(l=>l.serialize()))}static parse(l,f){const p=l[0],A=zc.definitions[p];if(!A)return f.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(A)?A[0]:A.type,C=Array.isArray(A)?[[A[1],A[2]]]:A.overloads,M=C.filter(([U])=>!Array.isArray(U)||U.length===l.length-1);let N=null;for(const[U,W]of M){N=new MA(f.registry,f.path,null,f.scope);const K=[];let ee=!1;for(let oe=1;oe<l.length;oe++){const le=l[oe],de=Array.isArray(U)?U[oe-1]:U.type,xe=N.parse(le,1+K.length,de);if(!xe){ee=!0;break}K.push(xe)}if(!ee)if(Array.isArray(U)&&U.length!==K.length)N.error(`Expected ${U.length} arguments, but found ${K.length} instead.`);else{for(let oe=0;oe<K.length;oe++){const le=Array.isArray(U)?U[oe]:U.type,de=K[oe];N.concat(oe+1).checkSubtype(le,de.type)}if(N.errors.length===0)return new zc(p,b,W,K)}}if(M.length===1)f.errors.push(...N.errors);else{const U=(M.length?M:C).map(([K])=>{return ee=K,Array.isArray(ee)?`(${ee.map(He).join(", ")})`:`(${He(ee.type)}...)`;var ee}).join(" | "),W=[];for(let K=1;K<l.length;K++){const ee=f.parse(l[K],1+W.length);if(!ee)return null;W.push(He(ee.type))}f.error(`Expected arguments of type ${U}, but found (${W.join(", ")}) instead.`)}return null}static register(l,f){zc.definitions=f;for(const p in f)l[p]=zc}}var ol=zc;class Gl{constructor(l,f,p){this.type=ys,this.locale=p,this.caseSensitive=l,this.diacriticSensitive=f}static parse(l,f){if(l.length!==2)return f.error("Expected one argument.");const p=l[1];if(typeof p!="object"||Array.isArray(p))return f.error("Collator options argument must be an object.");const A=f.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Cr);if(!A)return null;const b=f.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Cr);if(!b)return null;let C=null;return p.locale&&(C=f.parse(p.locale,1,ur),!C)?null:new Gl(A,b,C)}evaluate(l){return new op(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}serialize(){const l={};return l["case-sensitive"]=this.caseSensitive.serialize(),l["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(l.locale=this.locale.serialize()),["collator",l]}}const Bs=8192;function up(c,l){c[0]=Math.min(c[0],l[0]),c[1]=Math.min(c[1],l[1]),c[2]=Math.max(c[2],l[0]),c[3]=Math.max(c[3],l[1])}function zf(c,l){return!(c[0]<=l[0]||c[2]>=l[2]||c[1]<=l[1]||c[3]>=l[3])}function Uf(c,l){const f=(180+c[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,A=Math.pow(2,l.z);return[Math.round(f*A*Bs),Math.round(p*A*Bs)]}function C_(c,l,f){const p=c[0]-l[0],A=c[1]-l[1],b=c[0]-f[0],C=c[1]-f[1];return p*C-b*A==0&&p*b<=0&&A*C<=0}function Og(c,l){let f=!1;for(let C=0,M=l.length;C<M;C++){const N=l[C];for(let U=0,W=N.length;U<W-1;U++){if(C_(c,N[U],N[U+1]))return!1;(A=N[U])[1]>(p=c)[1]!=(b=N[U+1])[1]>p[1]&&p[0]<(b[0]-A[0])*(p[1]-A[1])/(b[1]-A[1])+A[0]&&(f=!f)}}var p,A,b;return f}function Rg(c,l){for(let f=0;f<l.length;f++)if(Og(c,l[f]))return!0;return!1}function TA(c,l,f,p){const A=p[0]-f[0],b=p[1]-f[1],C=(c[0]-f[0])*b-A*(c[1]-f[1]),M=(l[0]-f[0])*b-A*(l[1]-f[1]);return C>0&&M<0||C<0&&M>0}function qh(c,l,f){for(const U of f)for(let W=0;W<U.length-1;++W)if((M=[(C=U[W+1])[0]-(b=U[W])[0],C[1]-b[1]])[0]*(N=[(A=l)[0]-(p=c)[0],A[1]-p[1]])[1]-M[1]*N[0]!=0&&TA(p,A,b,C)&&TA(b,C,p,A))return!0;var p,A,b,C,M,N;return!1}function Kr(c,l){for(let f=0;f<c.length;++f)if(!Og(c[f],l))return!1;for(let f=0;f<c.length-1;++f)if(qh(c[f],c[f+1],l))return!1;return!0}function cp(c,l){for(let f=0;f<l.length;f++)if(Kr(c,l[f]))return!0;return!1}function CA(c,l,f){const p=[];for(let A=0;A<c.length;A++){const b=[];for(let C=0;C<c[A].length;C++){const M=Uf(c[A][C],f);up(l,M),b.push(M)}p.push(b)}return p}function PA(c,l,f){const p=[];for(let A=0;A<c.length;A++){const b=CA(c[A],l,f);p.push(b)}return p}function Lg(c,l,f,p){if(c[0]<f[0]||c[0]>f[2]){const A=.5*p;let b=c[0]-f[0]>A?-p:f[0]-c[0]>A?p:0;b===0&&(b=c[0]-f[2]>A?-p:f[2]-c[0]>A?p:0),c[0]+=b}up(l,c)}function Gf(c,l,f,p){const A=Math.pow(2,p.z)*Bs,b=[p.x*Bs,p.y*Bs],C=[];if(!c)return C;for(const M of c)for(const N of M){const U=[N.x+b[0],N.y+b[1]];Lg(U,l,f,A),C.push(U)}return C}function IA(c,l,f,p){const A=Math.pow(2,p.z)*Bs,b=[p.x*Bs,p.y*Bs],C=[];if(!c)return C;for(const N of c){const U=[];for(const W of N){const K=[W.x+b[0],W.y+b[1]];up(l,K),U.push(K)}C.push(U)}if(l[2]-l[0]<=A/2){(M=l)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const N of C)for(const U of N)Lg(U,l,f,A)}var M;return C}class jf{constructor(l,f){this.type=Cr,this.geojson=l,this.geometries=f}static parse(l,f){if(l.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Wh(l[1])){const p=l[1];if(p.type==="FeatureCollection")for(let A=0;A<p.features.length;++A){const b=p.features[A].geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new jf(p,p.features[A].geometry)}else if(p.type==="Feature"){const A=p.geometry.type;if(A==="Polygon"||A==="MultiPolygon")return new jf(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new jf(p,p)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(f,p){const A=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],C=f.canonicalID();if(!C)return!1;if(p.type==="Polygon"){const M=CA(p.coordinates,b,C),N=Gf(f.geometry(),A,b,C);if(!zf(A,b))return!1;for(const U of N)if(!Og(U,M))return!1}if(p.type==="MultiPolygon"){const M=PA(p.coordinates,b,C),N=Gf(f.geometry(),A,b,C);if(!zf(A,b))return!1;for(const U of N)if(!Rg(U,M))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(f,p){const A=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],C=f.canonicalID();if(!C)return!1;if(p.type==="Polygon"){const M=CA(p.coordinates,b,C),N=IA(f.geometry(),A,b,C);if(!zf(A,b))return!1;for(const U of N)if(!Kr(U,M))return!1}if(p.type==="MultiPolygon"){const M=PA(p.coordinates,b,C),N=IA(f.geometry(),A,b,C);if(!zf(A,b))return!1;for(const U of N)if(!cp(U,M))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var fp=jf;function fu(c){if(c instanceof ol&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof fp)return!1;let l=!0;return c.eachChild(f=>{l&&!fu(f)&&(l=!1)}),l}function pa(c){if(c instanceof ol&&c.name==="feature-state")return!1;let l=!0;return c.eachChild(f=>{l&&!pa(f)&&(l=!1)}),l}function Vf(c,l){if(c instanceof ol&&l.indexOf(c.name)>=0)return!1;let f=!0;return c.eachChild(p=>{f&&!Vf(p,l)&&(f=!1)}),f}class Uc{constructor(l,f){this.type=f.type,this.name=l,this.boundExpression=f}static parse(l,f){if(l.length!==2||typeof l[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const p=l[1];return f.scope.has(p)?new Uc(p,f.scope.get(p)):f.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var P_=Uc;class hp{constructor(l,f=[],p,A=new $h,b=[]){this.registry=l,this.path=f,this.key=f.map(C=>`[${C}]`).join(""),this.scope=A,this.errors=b,this.expectedType=p}parse(l,f,p,A,b={}){return f?this.concat(f,p,A)._parse(l,b):this._parse(l,b)}_parse(l,f){function p(A,b,C){return C==="assert"?new Ul(b,[A]):C==="coerce"?new Zu(b,[A]):A}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const A=l[0];if(typeof A!="string")return this.error(`Expression name must be a string, but found ${typeof A} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[A];if(b){let C=b.parse(l,this);if(!C)return null;if(this.expectedType){const M=this.expectedType,N=C.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||N.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||N.kind!=="value"&&N.kind!=="string"){if(this.checkSubtype(M,N))return null}else C=p(C,M,f.typeAnnotation||"coerce");else C=p(C,M,f.typeAnnotation||"assert")}if(!(C instanceof Ff)&&C.type.kind!=="resolvedImage"&&OA(C)){const M=new Mg;try{C=new Ff(C.type,C.evaluate(M))}catch(N){return this.error(N.message),null}}return C}return this.error(`Unknown expression "${A}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,f,p){const A=typeof l=="number"?this.path.concat(l):this.path,b=p?this.scope.concat(p):this.scope;return new hp(this.registry,A,f||null,b,this.errors)}error(l,...f){const p=`${this.key}${f.map(A=>`[${A}]`).join("")}`;this.errors.push(new fa(p,l))}checkSubtype(l,f){const p=on(l,f);return p&&this.error(p),p}}var MA=hp;function OA(c){if(c instanceof P_)return OA(c.boundExpression);if(c instanceof ol&&c.name==="error"||c instanceof Gl||c instanceof fp)return!1;const l=c instanceof Zu||c instanceof Ul;let f=!0;return c.eachChild(p=>{f=l?f&&OA(p):f&&p instanceof Ff}),!!f&&fu(c)&&Vf(c,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Dg(c,l){const f=c.length-1;let p,A,b=0,C=f,M=0;for(;b<=C;)if(M=Math.floor((b+C)/2),p=c[M],A=c[M+1],p<=l){if(M===f||l<A)return M;b=M+1}else{if(!(p>l))throw new li("Input is not a number.");C=M-1}return 0}class Bg{constructor(l,f,p){this.type=l,this.input=f,this.labels=[],this.outputs=[];for(const[A,b]of p)this.labels.push(A),this.outputs.push(b)}static parse(l,f){if(l.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return f.error("Expected an even number of arguments.");const p=f.parse(l[1],1,_n);if(!p)return null;const A=[];let b=null;f.expectedType&&f.expectedType.kind!=="value"&&(b=f.expectedType);for(let C=1;C<l.length;C+=2){const M=C===1?-1/0:l[C],N=l[C+1],U=C,W=C+1;if(typeof M!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(A.length&&A[A.length-1][0]>=M)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',U);const K=f.parse(N,W,b);if(!K)return null;b=b||K.type,A.push([M,K])}return new Bg(b,p,A)}evaluate(l){const f=this.labels,p=this.outputs;if(f.length===1)return p[0].evaluate(l);const A=this.input.evaluate(l);if(A<=f[0])return p[0].evaluate(l);const b=f.length;return A>=f[b-1]?p[b-1].evaluate(l):p[Dg(f,A)].evaluate(l)}eachChild(l){l(this.input);for(const f of this.outputs)l(f)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}serialize(){const l=["step",this.input.serialize()];for(let f=0;f<this.labels.length;f++)f>0&&l.push(this.labels[f]),l.push(this.outputs[f].serialize());return l}}var RA=Bg;function jr(c,l,f){return c*(1-f)+l*f}var hu=Object.freeze({__proto__:null,array:function(c,l,f){return c.map((p,A)=>jr(p,l[A],f))},color:function(c,l,f){return new lo(jr(c.r,l.r,f),jr(c.g,l.g,f),jr(c.b,l.b,f),jr(c.a,l.a,f))},number:jr});const I_=.95047,LA=1.08883,M_=4/29,$f=6/29,DA=3*$f*$f,nx=$f*$f*$f,rx=Math.PI/180,O_=180/Math.PI;function Ng(c){return c>nx?Math.pow(c,1/3):c/DA+M_}function dp(c){return c>$f?c*c*c:DA*(c-M_)}function BA(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function bs(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function No(c){const l=bs(c.r),f=bs(c.g),p=bs(c.b),A=Ng((.4124564*l+.3575761*f+.1804375*p)/I_),b=Ng((.2126729*l+.7151522*f+.072175*p)/1);return{l:116*b-16,a:500*(A-b),b:200*(b-Ng((.0193339*l+.119192*f+.9503041*p)/LA)),alpha:c.a}}function R_(c){let l=(c.l+16)/116,f=isNaN(c.a)?l:l+c.a/500,p=isNaN(c.b)?l:l-c.b/200;return l=1*dp(l),f=I_*dp(f),p=LA*dp(p),new lo(BA(3.2404542*f-1.5371385*l-.4985314*p),BA(-.969266*f+1.8760108*l+.041556*p),BA(.0556434*f-.2040259*l+1.0572252*p),c.alpha)}function ix(c,l,f){const p=l-c;return c+f*(p>180||p<-180?p-360*Math.round(p/360):p)}const pp={forward:No,reverse:R_,interpolate:function(c,l,f){return{l:jr(c.l,l.l,f),a:jr(c.a,l.a,f),b:jr(c.b,l.b,f),alpha:jr(c.alpha,l.alpha,f)}}},Xh={forward:function(c){const{l,a:f,b:p}=No(c),A=Math.atan2(p,f)*O_;return{h:A<0?A+360:A,c:Math.sqrt(f*f+p*p),l,alpha:c.a}},reverse:function(c){const l=c.h*rx,f=c.c;return R_({l:c.l,a:Math.cos(l)*f,b:Math.sin(l)*f,alpha:c.alpha})},interpolate:function(c,l,f){return{h:ix(c.h,l.h,f),c:jr(c.c,l.c,f),l:jr(c.l,l.l,f),alpha:jr(c.alpha,l.alpha,f)}}};var NA=Object.freeze({__proto__:null,hcl:Xh,lab:pp});class fs{constructor(l,f,p,A,b){this.type=l,this.operator=f,this.interpolation=p,this.input=A,this.labels=[],this.outputs=[];for(const[C,M]of b)this.labels.push(C),this.outputs.push(M)}static interpolationFactor(l,f,p,A){let b=0;if(l.name==="exponential")b=gp(f,l.base,p,A);else if(l.name==="linear")b=gp(f,1,p,A);else if(l.name==="cubic-bezier"){const C=l.controlPoints;b=new J(C[0],C[1],C[2],C[3]).solve(gp(f,1,p,A))}return b}static parse(l,f){let[p,A,b,...C]=l;if(!Array.isArray(A)||A.length===0)return f.error("Expected an interpolation type expression.",1);if(A[0]==="linear")A={name:"linear"};else if(A[0]==="exponential"){const U=A[1];if(typeof U!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);A={name:"exponential",base:U}}else{if(A[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(A[0])}`,1,0);{const U=A.slice(1);if(U.length!==4||U.some(W=>typeof W!="number"||W<0||W>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);A={name:"cubic-bezier",controlPoints:U}}}if(l.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(b=f.parse(b,2,_n),!b)return null;const M=[];let N=null;p==="interpolate-hcl"||p==="interpolate-lab"?N=Os:f.expectedType&&f.expectedType.kind!=="value"&&(N=f.expectedType);for(let U=0;U<C.length;U+=2){const W=C[U],K=C[U+1],ee=U+3,oe=U+4;if(typeof W!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ee);if(M.length&&M[M.length-1][0]>=W)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ee);const le=f.parse(K,oe,N);if(!le)return null;N=N||le.type,M.push([W,le])}return N.kind==="number"||N.kind==="color"||N.kind==="array"&&N.itemType.kind==="number"&&typeof N.N=="number"?new fs(N,p,A,b,M):f.error(`Type ${He(N)} is not interpolatable.`)}evaluate(l){const f=this.labels,p=this.outputs;if(f.length===1)return p[0].evaluate(l);const A=this.input.evaluate(l);if(A<=f[0])return p[0].evaluate(l);const b=f.length;if(A>=f[b-1])return p[b-1].evaluate(l);const C=Dg(f,A),M=fs.interpolationFactor(this.interpolation,A,f[C],f[C+1]),N=p[C].evaluate(l),U=p[C+1].evaluate(l);return this.operator==="interpolate"?hu[this.type.kind.toLowerCase()](N,U,M):this.operator==="interpolate-hcl"?Xh.reverse(Xh.interpolate(Xh.forward(N),Xh.forward(U),M)):pp.reverse(pp.interpolate(pp.forward(N),pp.forward(U),M))}eachChild(l){l(this.input);for(const f of this.outputs)l(f)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}serialize(){let l;l=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const f=[this.operator,l,this.input.serialize()];for(let p=0;p<this.labels.length;p++)f.push(this.labels[p],this.outputs[p].serialize());return f}}function gp(c,l,f,p){const A=p-f,b=c-f;return A===0?0:l===1?b/A:(Math.pow(l,b)-1)/(Math.pow(l,A)-1)}var ws=fs;class Fg{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expectected at least one argument.");let p=null;const A=f.expectedType;A&&A.kind!=="value"&&(p=A);const b=[];for(const M of l.slice(1)){const N=f.parse(M,1+b.length,p,void 0,{typeAnnotation:"omit"});if(!N)return null;p=p||N.type,b.push(N)}const C=A&&b.some(M=>on(A,M.type));return new Fg(C?xr:p,b)}evaluate(l){let f,p=null,A=0;for(const b of this.args){if(A++,p=b.evaluate(l),p&&p instanceof il&&!p.available&&(f||(f=p),p=null,A===this.args.length))return f;if(p!==null)break}return p}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){const l=["coalesce"];return this.eachChild(f=>{l.push(f.serialize())}),l}}var mp=Fg;class kg{constructor(l,f){this.type=f.type,this.bindings=[].concat(l),this.result=f}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const f of this.bindings)l(f[1]);l(this.result)}static parse(l,f){if(l.length<4)return f.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const p=[];for(let b=1;b<l.length-1;b+=2){const C=l[b];if(typeof C!="string")return f.error(`Expected string, but found ${typeof C} instead.`,b);if(/[^a-zA-Z0-9_]/.test(C))return f.error("Variable names must contain only alphanumeric characters or '_'.",b);const M=f.parse(l[b+1],b+1);if(!M)return null;p.push([C,M])}const A=f.parse(l[l.length-1],l.length-1,f.expectedType,p);return A?new kg(p,A):null}outputDefined(){return this.result.outputDefined()}serialize(){const l=["let"];for(const[f,p]of this.bindings)l.push(f,p.serialize());return l.push(this.result.serialize()),l}}var Ua=kg;class zg{constructor(l,f,p){this.type=l,this.index=f,this.input=p}static parse(l,f){if(l.length!==3)return f.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const p=f.parse(l[1],1,_n),A=f.parse(l[2],2,Oe(f.expectedType||xr));return p&&A?new zg(A.type.itemType,p,A):null}evaluate(l){const f=this.index.evaluate(l),p=this.input.evaluate(l);if(f<0)throw new li(`Array index out of bounds: ${f} < 0.`);if(f>=p.length)throw new li(`Array index out of bounds: ${f} > ${p.length-1}.`);if(f!==Math.floor(f))throw new li(`Array index must be an integer, but found ${f} instead.`);return p[f]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var FA=zg;class Hf{constructor(l,f){this.type=Cr,this.needle=l,this.haystack=f}static parse(l,f){if(l.length!==3)return f.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const p=f.parse(l[1],1,xr),A=f.parse(l[2],2,xr);return p&&A?Fn(p.type,[Cr,ur,_n,cu,xr])?new Hf(p,A):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${He(p.type)} instead`):null}evaluate(l){const f=this.needle.evaluate(l),p=this.haystack.evaluate(l);if(p==null)return!1;if(!Rr(f,["boolean","string","number","null"]))throw new li(`Expected first argument to be of type boolean, string, number or null, but found ${He(Xi(f))} instead.`);if(!Rr(p,["string","array"]))throw new li(`Expected second argument to be of type array or string, but found ${He(Xi(p))} instead.`);return p.indexOf(f)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var du=Hf;class jl{constructor(l,f,p){this.type=_n,this.needle=l,this.haystack=f,this.fromIndex=p}static parse(l,f){if(l.length<=2||l.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const p=f.parse(l[1],1,xr),A=f.parse(l[2],2,xr);if(!p||!A)return null;if(!Fn(p.type,[Cr,ur,_n,cu,xr]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${He(p.type)} instead`);if(l.length===4){const b=f.parse(l[3],3,_n);return b?new jl(p,A,b):null}return new jl(p,A)}evaluate(l){const f=this.needle.evaluate(l),p=this.haystack.evaluate(l);if(!Rr(f,["boolean","string","number","null"]))throw new li(`Expected first argument to be of type boolean, string, number or null, but found ${He(Xi(f))} instead.`);if(!Rr(p,["string","array"]))throw new li(`Expected second argument to be of type array or string, but found ${He(Xi(p))} instead.`);if(this.fromIndex){const A=this.fromIndex.evaluate(l);return p.indexOf(f,A)}return p.indexOf(f)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const l=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),l]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var L_=jl;class Ug{constructor(l,f,p,A,b,C){this.inputType=l,this.type=f,this.input=p,this.cases=A,this.outputs=b,this.otherwise=C}static parse(l,f){if(l.length<5)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return f.error("Expected an even number of arguments.");let p,A;f.expectedType&&f.expectedType.kind!=="value"&&(A=f.expectedType);const b={},C=[];for(let U=2;U<l.length-1;U+=2){let W=l[U];const K=l[U+1];Array.isArray(W)||(W=[W]);const ee=f.concat(U);if(W.length===0)return ee.error("Expected at least one branch label.");for(const le of W){if(typeof le!="number"&&typeof le!="string")return ee.error("Branch labels must be numbers or strings.");if(typeof le=="number"&&Math.abs(le)>Number.MAX_SAFE_INTEGER)return ee.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof le=="number"&&Math.floor(le)!==le)return ee.error("Numeric branch labels must be integer values.");if(p){if(ee.checkSubtype(p,Xi(le)))return null}else p=Xi(le);if(b[String(le)]!==void 0)return ee.error("Branch labels must be unique.");b[String(le)]=C.length}const oe=f.parse(K,U,A);if(!oe)return null;A=A||oe.type,C.push(oe)}const M=f.parse(l[1],1,xr);if(!M)return null;const N=f.parse(l[l.length-1],l.length-1,A);return N?M.type.kind!=="value"&&f.concat(1).checkSubtype(p,M.type)?null:new Ug(p,A,M,b,C,N):null}evaluate(l){const f=this.input.evaluate(l);return(Xi(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const l=["match",this.input.serialize()],f=Object.keys(this.cases).sort(),p=[],A={};for(const C of f){const M=A[this.cases[C]];M===void 0?(A[this.cases[C]]=p.length,p.push([this.cases[C],[C]])):p[M][1].push(C)}const b=C=>this.inputType.kind==="number"?Number(C):C;for(const[C,M]of p)l.push(M.length===1?b(M[0]):M.map(b)),l.push(this.outputs[C].serialize());return l.push(this.otherwise.serialize()),l}}var ox=Ug;class Ap{constructor(l,f,p){this.type=l,this.branches=f,this.otherwise=p}static parse(l,f){if(l.length<4)return f.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return f.error("Expected an odd number of arguments.");let p;f.expectedType&&f.expectedType.kind!=="value"&&(p=f.expectedType);const A=[];for(let C=1;C<l.length-1;C+=2){const M=f.parse(l[C],C,Cr);if(!M)return null;const N=f.parse(l[C+1],C+1,p);if(!N)return null;A.push([M,N]),p=p||N.type}const b=f.parse(l[l.length-1],l.length-1,p);return b?new Ap(p,A,b):null}evaluate(l){for(const[f,p]of this.branches)if(f.evaluate(l))return p.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[f,p]of this.branches)l(f),l(p);l(this.otherwise)}outputDefined(){return this.branches.every(([l,f])=>f.outputDefined())&&this.otherwise.outputDefined()}serialize(){const l=["case"];return this.eachChild(f=>{l.push(f.serialize())}),l}}var kA=Ap;class _p{constructor(l,f,p,A){this.type=l,this.input=f,this.beginIndex=p,this.endIndex=A}static parse(l,f){if(l.length<=2||l.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const p=f.parse(l[1],1,xr),A=f.parse(l[2],2,_n);if(!p||!A)return null;if(!Fn(p.type,[Oe(xr),ur,xr]))return f.error(`Expected first argument to be of type array or string, but found ${He(p.type)} instead`);if(l.length===4){const b=f.parse(l[3],3,_n);return b?new _p(p.type,p,A,b):null}return new _p(p.type,p,A)}evaluate(l){const f=this.input.evaluate(l),p=this.beginIndex.evaluate(l);if(!Rr(f,["string","array"]))throw new li(`Expected first argument to be of type array or string, but found ${He(Xi(f))} instead.`);if(this.endIndex){const A=this.endIndex.evaluate(l);return f.slice(p,A)}return f.slice(p)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const l=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),l]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var D_=_p;function Gg(c,l){return c==="=="||c==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function B_(c,l,f,p){return p.compare(l,f)===0}function Zh(c,l,f){const p=c!=="=="&&c!=="!=";return class efe{constructor(b,C,M){this.type=Cr,this.lhs=b,this.rhs=C,this.collator=M,this.hasUntypedArgument=b.type.kind==="value"||C.type.kind==="value"}static parse(b,C){if(b.length!==3&&b.length!==4)return C.error("Expected two or three arguments.");const M=b[0];let N=C.parse(b[1],1,xr);if(!N)return null;if(!Gg(M,N.type))return C.concat(1).error(`"${M}" comparisons are not supported for type '${He(N.type)}'.`);let U=C.parse(b[2],2,xr);if(!U)return null;if(!Gg(M,U.type))return C.concat(2).error(`"${M}" comparisons are not supported for type '${He(U.type)}'.`);if(N.type.kind!==U.type.kind&&N.type.kind!=="value"&&U.type.kind!=="value")return C.error(`Cannot compare types '${He(N.type)}' and '${He(U.type)}'.`);p&&(N.type.kind==="value"&&U.type.kind!=="value"?N=new Ul(U.type,[N]):N.type.kind!=="value"&&U.type.kind==="value"&&(U=new Ul(N.type,[U])));let W=null;if(b.length===4){if(N.type.kind!=="string"&&U.type.kind!=="string"&&N.type.kind!=="value"&&U.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(W=C.parse(b[3],3,ys),!W)return null}return new efe(N,U,W)}evaluate(b){const C=this.lhs.evaluate(b),M=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){const N=Xi(C),U=Xi(M);if(N.kind!==U.kind||N.kind!=="string"&&N.kind!=="number")throw new li(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${N.kind}, ${U.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const N=Xi(C),U=Xi(M);if(N.kind!=="string"||U.kind!=="string")return l(b,C,M)}return this.collator?f(b,C,M,this.collator.evaluate(b)):l(b,C,M)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}serialize(){const b=[c];return this.eachChild(C=>{b.push(C.serialize())}),b}}}const sx=Zh("==",function(c,l,f){return l===f},B_),jg=Zh("!=",function(c,l,f){return l!==f},function(c,l,f,p){return!B_(0,l,f,p)}),ax=Zh("<",function(c,l,f){return l<f},function(c,l,f,p){return p.compare(l,f)<0}),lx=Zh(">",function(c,l,f){return l>f},function(c,l,f,p){return p.compare(l,f)>0}),ux=Zh("<=",function(c,l,f){return l<=f},function(c,l,f,p){return p.compare(l,f)<=0}),zA=Zh(">=",function(c,l,f){return l>=f},function(c,l,f,p){return p.compare(l,f)>=0});class yp{constructor(l,f,p,A,b,C){this.type=ur,this.number=l,this.locale=f,this.currency=p,this.unit=A,this.minFractionDigits=b,this.maxFractionDigits=C}static parse(l,f){if(l.length!==3)return f.error("Expected two arguments.");const p=f.parse(l[1],1,_n);if(!p)return null;const A=l[2];if(typeof A!="object"||Array.isArray(A))return f.error("NumberFormat options argument must be an object.");let b=null;if(A.locale&&(b=f.parse(A.locale,1,ur),!b))return null;let C=null;if(A.currency&&(C=f.parse(A.currency,1,ur),!C))return null;let M=null;if(A.unit&&(M=f.parse(A.unit,1,ur),!M))return null;let N=null;if(A["min-fraction-digits"]&&(N=f.parse(A["min-fraction-digits"],1,_n),!N))return null;let U=null;return A["max-fraction-digits"]&&(U=f.parse(A["max-fraction-digits"],1,_n),!U)?null:new yp(p,b,C,M,N,U)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(l):void 0,unit:this.unit?this.unit.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.unit&&l(this.unit),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const l={};return this.locale&&(l.locale=this.locale.serialize()),this.currency&&(l.currency=this.currency.serialize()),this.unit&&(l.unit=this.unit.serialize()),this.minFractionDigits&&(l["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(l["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),l]}}class ga{constructor(l){this.type=_n,this.input=l}static parse(l,f){if(l.length!==2)return f.error(`Expected 1 argument, but found ${l.length-1} instead.`);const p=f.parse(l[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${He(p.type)} instead.`):new ga(p):null}evaluate(l){const f=this.input.evaluate(l);if(typeof f=="string"||Array.isArray(f))return f.length;throw new li(`Expected value to be of type string or array, but found ${He(Xi(f))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}serialize(){const l=["length"];return this.eachChild(f=>{l.push(f.serialize())}),l}}const UA={"==":sx,"!=":jg,">":lx,"<":ax,">=":zA,"<=":ux,array:Ul,at:FA,boolean:Ul,case:kA,coalesce:mp,collator:Gl,format:Xu,image:kf,in:du,"index-of":L_,interpolate:ws,"interpolate-hcl":ws,"interpolate-lab":ws,length:ga,let:Ua,literal:Ff,match:ox,number:Ul,"number-format":yp,object:Ul,slice:D_,step:RA,string:Ul,"to-boolean":Zu,"to-color":Zu,"to-number":Zu,"to-string":Zu,var:P_,within:fp};function N_(c,[l,f,p,A]){l=l.evaluate(c),f=f.evaluate(c),p=p.evaluate(c);const b=A?A.evaluate(c):1,C=EA(l,f,p,b);if(C)throw new li(C);return new lo(l/255*b,f/255*b,p/255*b,b)}function Yu(c,l){return c in l}function Vg(c,l){const f=l[c];return f===void 0?null:f}function sl(c){return{type:c}}ol.register(UA,{error:[{kind:"error"},[ur],(c,[l])=>{throw new li(l.evaluate(c))}],typeof:[ur,[xr],(c,[l])=>He(Xi(l.evaluate(c)))],"to-rgba":[Oe(_n,4),[Os],(c,[l])=>l.evaluate(c).toArray()],rgb:[Os,[_n,_n,_n],N_],rgba:[Os,[_n,_n,_n,_n],N_],has:{type:Cr,overloads:[[[ur],(c,[l])=>Yu(l.evaluate(c),c.properties())],[[ur,Rs],(c,[l,f])=>Yu(l.evaluate(c),f.evaluate(c))]]},get:{type:xr,overloads:[[[ur],(c,[l])=>Vg(l.evaluate(c),c.properties())],[[ur,Rs],(c,[l,f])=>Vg(l.evaluate(c),f.evaluate(c))]]},"feature-state":[xr,[ur],(c,[l])=>Vg(l.evaluate(c),c.featureState||{})],properties:[Rs,[],c=>c.properties()],"geometry-type":[ur,[],c=>c.geometryType()],id:[xr,[],c=>c.id()],zoom:[_n,[],c=>c.globals.zoom],pitch:[_n,[],c=>c.globals.pitch||0],"distance-from-center":[_n,[],c=>c.distanceFromCenter()],"heatmap-density":[_n,[],c=>c.globals.heatmapDensity||0],"line-progress":[_n,[],c=>c.globals.lineProgress||0],"sky-radial-progress":[_n,[],c=>c.globals.skyRadialProgress||0],accumulated:[xr,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[_n,sl(_n),(c,l)=>{let f=0;for(const p of l)f+=p.evaluate(c);return f}],"*":[_n,sl(_n),(c,l)=>{let f=1;for(const p of l)f*=p.evaluate(c);return f}],"-":{type:_n,overloads:[[[_n,_n],(c,[l,f])=>l.evaluate(c)-f.evaluate(c)],[[_n],(c,[l])=>-l.evaluate(c)]]},"/":[_n,[_n,_n],(c,[l,f])=>l.evaluate(c)/f.evaluate(c)],"%":[_n,[_n,_n],(c,[l,f])=>l.evaluate(c)%f.evaluate(c)],ln2:[_n,[],()=>Math.LN2],pi:[_n,[],()=>Math.PI],e:[_n,[],()=>Math.E],"^":[_n,[_n,_n],(c,[l,f])=>Math.pow(l.evaluate(c),f.evaluate(c))],sqrt:[_n,[_n],(c,[l])=>Math.sqrt(l.evaluate(c))],log10:[_n,[_n],(c,[l])=>Math.log(l.evaluate(c))/Math.LN10],ln:[_n,[_n],(c,[l])=>Math.log(l.evaluate(c))],log2:[_n,[_n],(c,[l])=>Math.log(l.evaluate(c))/Math.LN2],sin:[_n,[_n],(c,[l])=>Math.sin(l.evaluate(c))],cos:[_n,[_n],(c,[l])=>Math.cos(l.evaluate(c))],tan:[_n,[_n],(c,[l])=>Math.tan(l.evaluate(c))],asin:[_n,[_n],(c,[l])=>Math.asin(l.evaluate(c))],acos:[_n,[_n],(c,[l])=>Math.acos(l.evaluate(c))],atan:[_n,[_n],(c,[l])=>Math.atan(l.evaluate(c))],min:[_n,sl(_n),(c,l)=>Math.min(...l.map(f=>f.evaluate(c)))],max:[_n,sl(_n),(c,l)=>Math.max(...l.map(f=>f.evaluate(c)))],abs:[_n,[_n],(c,[l])=>Math.abs(l.evaluate(c))],round:[_n,[_n],(c,[l])=>{const f=l.evaluate(c);return f<0?-Math.round(-f):Math.round(f)}],floor:[_n,[_n],(c,[l])=>Math.floor(l.evaluate(c))],ceil:[_n,[_n],(c,[l])=>Math.ceil(l.evaluate(c))],"filter-==":[Cr,[ur,xr],(c,[l,f])=>c.properties()[l.value]===f.value],"filter-id-==":[Cr,[xr],(c,[l])=>c.id()===l.value],"filter-type-==":[Cr,[ur],(c,[l])=>c.geometryType()===l.value],"filter-<":[Cr,[ur,xr],(c,[l,f])=>{const p=c.properties()[l.value],A=f.value;return typeof p==typeof A&&p<A}],"filter-id-<":[Cr,[xr],(c,[l])=>{const f=c.id(),p=l.value;return typeof f==typeof p&&f<p}],"filter->":[Cr,[ur,xr],(c,[l,f])=>{const p=c.properties()[l.value],A=f.value;return typeof p==typeof A&&p>A}],"filter-id->":[Cr,[xr],(c,[l])=>{const f=c.id(),p=l.value;return typeof f==typeof p&&f>p}],"filter-<=":[Cr,[ur,xr],(c,[l,f])=>{const p=c.properties()[l.value],A=f.value;return typeof p==typeof A&&p<=A}],"filter-id-<=":[Cr,[xr],(c,[l])=>{const f=c.id(),p=l.value;return typeof f==typeof p&&f<=p}],"filter->=":[Cr,[ur,xr],(c,[l,f])=>{const p=c.properties()[l.value],A=f.value;return typeof p==typeof A&&p>=A}],"filter-id->=":[Cr,[xr],(c,[l])=>{const f=c.id(),p=l.value;return typeof f==typeof p&&f>=p}],"filter-has":[Cr,[xr],(c,[l])=>l.value in c.properties()],"filter-has-id":[Cr,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Cr,[Oe(ur)],(c,[l])=>l.value.indexOf(c.geometryType())>=0],"filter-id-in":[Cr,[Oe(xr)],(c,[l])=>l.value.indexOf(c.id())>=0],"filter-in-small":[Cr,[ur,Oe(xr)],(c,[l,f])=>f.value.indexOf(c.properties()[l.value])>=0],"filter-in-large":[Cr,[ur,Oe(xr)],(c,[l,f])=>function(p,A,b,C){for(;b<=C;){const M=b+C>>1;if(A[M]===p)return!0;A[M]>p?C=M-1:b=M+1}return!1}(c.properties()[l.value],f.value,0,f.value.length-1)],all:{type:Cr,overloads:[[[Cr,Cr],(c,[l,f])=>l.evaluate(c)&&f.evaluate(c)],[sl(Cr),(c,l)=>{for(const f of l)if(!f.evaluate(c))return!1;return!0}]]},any:{type:Cr,overloads:[[[Cr,Cr],(c,[l,f])=>l.evaluate(c)||f.evaluate(c)],[sl(Cr),(c,l)=>{for(const f of l)if(f.evaluate(c))return!0;return!1}]]},"!":[Cr,[Cr],(c,[l])=>!l.evaluate(c)],"is-supported-script":[Cr,[ur],(c,[l])=>{const f=c.globals&&c.globals.isSupportedScript;return!f||f(l.evaluate(c))}],upcase:[ur,[ur],(c,[l])=>l.evaluate(c).toUpperCase()],downcase:[ur,[ur],(c,[l])=>l.evaluate(c).toLowerCase()],concat:[ur,sl(xr),(c,l)=>l.map(f=>ap(f.evaluate(c))).join("")],"resolved-locale":[ur,[ys],(c,[l])=>l.evaluate(c).resolvedLocale()]});var vp=UA;function xp(c){return{result:"success",value:c}}function Gc(c){return{result:"error",value:c}}function jc(c){return c["property-type"]==="data-driven"}function $g(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Hg(c){return!!c.expression&&c.expression.interpolated}function Xr(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function bp(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function F_(c){return c}function Wg(c,l){const f=l.type==="color",p=c.stops&&typeof c.stops[0][0]=="object",A=p||!(p||c.property!==void 0),b=c.type||(Hg(l)?"exponential":"interval");if(f&&((c=za({},c)).stops&&(c.stops=c.stops.map(U=>[U[0],lo.parse(U[1])])),c.default=lo.parse(c.default?c.default:l.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!NA[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let C,M,N;if(b==="exponential")C=Qu;else if(b==="interval")C=qg;else if(b==="categorical"){C=k_,M=Object.create(null);for(const U of c.stops)M[U[0]]=U[1];N=typeof c.stops[0][0]}else{if(b!=="identity")throw new Error(`Unknown function type "${b}"`);C=GA}if(p){const U={},W=[];for(let oe=0;oe<c.stops.length;oe++){const le=c.stops[oe],de=le[0].zoom;U[de]===void 0&&(U[de]={zoom:de,type:c.type,property:c.property,default:c.default,stops:[]},W.push(de)),U[de].stops.push([le[0].value,le[1]])}const K=[];for(const oe of W)K.push([U[oe].zoom,Wg(U[oe],l)]);const ee={name:"linear"};return{kind:"composite",interpolationType:ee,interpolationFactor:ws.interpolationFactor.bind(void 0,ee),zoomStops:K.map(oe=>oe[0]),evaluate:({zoom:oe},le)=>Qu({stops:K,base:c.base},l,oe).evaluate(oe,le)}}if(A){const U=b==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:U,interpolationFactor:ws.interpolationFactor.bind(void 0,U),zoomStops:c.stops.map(W=>W[0]),evaluate:({zoom:W})=>C(c,l,W,M,N)}}return{kind:"source",evaluate(U,W){const K=W&&W.properties?W.properties[c.property]:void 0;return K===void 0?Yh(c.default,l.default):C(c,l,K,M,N)}}}function Yh(c,l,f){return c!==void 0?c:l!==void 0?l:f!==void 0?f:void 0}function k_(c,l,f,p,A){return Yh(typeof f===A?p[f]:void 0,c.default,l.default)}function qg(c,l,f){if(Xr(f)!=="number")return Yh(c.default,l.default);const p=c.stops.length;if(p===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[p-1][0])return c.stops[p-1][1];const A=Dg(c.stops.map(b=>b[0]),f);return c.stops[A][1]}function Qu(c,l,f){const p=c.base!==void 0?c.base:1;if(Xr(f)!=="number")return Yh(c.default,l.default);const A=c.stops.length;if(A===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[A-1][0])return c.stops[A-1][1];const b=Dg(c.stops.map(W=>W[0]),f),C=function(W,K,ee,oe){const le=oe-ee,de=W-ee;return le===0?0:K===1?de/le:(Math.pow(K,de)-1)/(Math.pow(K,le)-1)}(f,p,c.stops[b][0],c.stops[b+1][0]),M=c.stops[b][1],N=c.stops[b+1][1];let U=hu[l.type]||F_;if(c.colorSpace&&c.colorSpace!=="rgb"){const W=NA[c.colorSpace];U=(K,ee)=>W.reverse(W.interpolate(W.forward(K),W.forward(ee),C))}return typeof M.evaluate=="function"?{evaluate(...W){const K=M.evaluate.apply(void 0,W),ee=N.evaluate.apply(void 0,W);if(K!==void 0&&ee!==void 0)return U(K,ee,C)}}:U(M,N,C)}function GA(c,l,f){return l.type==="color"?f=lo.parse(f):l.type==="formatted"?f=da.fromString(f.toString()):l.type==="resolvedImage"?f=il.fromString(f.toString()):Xr(f)===l.type||l.type==="enum"&&l.values[f]||(f=void 0),Yh(f,c.default,l.default)}class wp{constructor(l,f){this.expression=l,this._warningHistory={},this._evaluator=new Mg,this._defaultValue=f?function(p){return p.type==="color"&&(bp(p.default)||Array.isArray(p.default))?new lo(0,0,0,0):p.type==="color"?lo.parse(p.default)||null:p.default===void 0?null:p.default}(f):null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(l,f,p,A,b,C,M,N){return this._evaluator.globals=l,this._evaluator.feature=f,this._evaluator.featureState=p,this._evaluator.canonical=A||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=C,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=N||null,this.expression.evaluate(this._evaluator)}evaluate(l,f,p,A,b,C,M,N){this._evaluator.globals=l,this._evaluator.feature=f||null,this._evaluator.featureState=p||null,this._evaluator.canonical=A||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=C||null,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=N||null;try{const U=this.expression.evaluate(this._evaluator);if(U==null||typeof U=="number"&&U!=U)return this._defaultValue;if(this._enumValues&&!(U in this._enumValues))throw new li(`Expected value to be one of ${Object.keys(this._enumValues).map(W=>JSON.stringify(W)).join(", ")}, but found ${JSON.stringify(U)} instead.`);return U}catch(U){return this._warningHistory[U.message]||(this._warningHistory[U.message]=!0,typeof console<"u"&&console.warn(U.message)),this._defaultValue}}}function Zi(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in vp}function Qh(c,l){const f=new MA(vp,[],l?function(A){const b={color:Os,string:ur,number:_n,enum:ur,boolean:Cr,formatted:Ls,resolvedImage:ye};return A.type==="array"?Oe(b[A.value]||xr,A.length):b[A.type]}(l):void 0),p=f.parse(c,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?xp(new wp(p,l)):Gc(f.errors)}class jA{constructor(l,f){this.kind=l,this._styleExpression=f,this.isStateDependent=l!=="constant"&&!pa(f.expression)}evaluateWithoutErrorHandling(l,f,p,A,b,C){return this._styleExpression.evaluateWithoutErrorHandling(l,f,p,A,b,C)}evaluate(l,f,p,A,b,C){return this._styleExpression.evaluate(l,f,p,A,b,C)}}class Ep{constructor(l,f,p,A){this.kind=l,this.zoomStops=p,this._styleExpression=f,this.isStateDependent=l!=="camera"&&!pa(f.expression),this.interpolationType=A}evaluateWithoutErrorHandling(l,f,p,A,b,C){return this._styleExpression.evaluateWithoutErrorHandling(l,f,p,A,b,C)}evaluate(l,f,p,A,b,C){return this._styleExpression.evaluate(l,f,p,A,b,C)}interpolationFactor(l,f,p){return this.interpolationType?ws.interpolationFactor(this.interpolationType,l,f,p):0}}function Kh(c,l){if((c=Qh(c,l)).result==="error")return c;const f=c.value.expression,p=fu(f);if(!p&&!jc(l))return Gc([new fa("","data expressions not supported")]);const A=Vf(f,["zoom","pitch","distance-from-center"]);if(!A&&!$g(l))return Gc([new fa("","zoom expressions not supported")]);const b=Tp(f);return b||A?b instanceof fa?Gc([b]):b instanceof ws&&!Hg(l)?Gc([new fa("",'"interpolate" expressions cannot be used with this property')]):xp(b?new Ep(p?"camera":"composite",c.value,b.labels,b instanceof ws?b.interpolation:void 0):new jA(p?"constant":"source",c.value)):Gc([new fa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Sp{constructor(l,f){this._parameters=l,this._specification=f,za(this,Wg(this._parameters,this._specification))}static deserialize(l){return new Sp(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function Tp(c){let l=null;if(c instanceof Ua)l=Tp(c.result);else if(c instanceof mp){for(const f of c.args)if(l=Tp(f),l)break}else(c instanceof RA||c instanceof ws)&&c.input instanceof ol&&c.input.name==="zoom"&&(l=c);return l instanceof fa||c.eachChild(f=>{const p=Tp(f);p instanceof fa?l=p:!l&&p?l=new fa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&p&&l!==p&&(l=new fa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}class Sn{constructor(l,f,p,A){this.message=(l?`${l}: `:"")+p,A&&(this.identifier=A),f!=null&&f.__line__&&(this.line=f.__line__)}}function Vl(c){const l=c.key,f=c.value,p=c.valueSpec||{},A=c.objectElementValidators||{},b=c.style,C=c.styleSpec;let M=[];const N=Xr(f);if(N!=="object")return[new Sn(l,f,`object expected, ${N} found`)];for(const U in f){const W=U.split(".")[0];let K;A[W]?K=A[W]:p[W]?K=nt:A["*"]?K=A["*"]:p["*"]&&(K=nt),K?M=M.concat(K({key:(l&&`${l}.`)+U,value:f[U],valueSpec:p[W]||p["*"],style:b,styleSpec:C,object:f,objectKey:U},f)):M.push(new Sn(l,f[U],`unknown property "${U}"`))}for(const U in p)A[U]||p[U].required&&p[U].default===void 0&&f[U]===void 0&&M.push(new Sn(l,f,`missing required property "${U}"`));return M}function z_(c){const l=c.value,f=c.valueSpec,p=c.style,A=c.styleSpec,b=c.key,C=c.arrayElementValidator||nt;if(Xr(l)!=="array")return[new Sn(b,l,`array expected, ${Xr(l)} found`)];if(f.length&&l.length!==f.length)return[new Sn(b,l,`array length ${f.length} expected, length ${l.length} found`)];if(f["min-length"]&&l.length<f["min-length"])return[new Sn(b,l,`array length at least ${f["min-length"]} expected, length ${l.length} found`)];let M={type:f.value,values:f.values,minimum:f.minimum,maximum:f.maximum,function:void 0};A.$version<7&&(M.function=f.function),Xr(f.value)==="object"&&(M=f.value);let N=[];for(let U=0;U<l.length;U++)N=N.concat(C({array:l,arrayIndex:U,value:l[U],valueSpec:M,style:p,styleSpec:A,key:`${b}[${U}]`}));return N}function Cp(c){const l=c.key,f=c.value,p=c.valueSpec;let A=Xr(f);if(A==="number"&&f!=f&&(A="NaN"),A!=="number")return[new Sn(l,f,`number expected, ${A} found`)];if("minimum"in p){let b=p.minimum;if(Xr(p.minimum)==="array"&&(b=p.minimum[c.arrayIndex]),f<b)return[new Sn(l,f,`${f} is less than the minimum value ${b}`)]}if("maximum"in p){let b=p.maximum;if(Xr(p.maximum)==="array"&&(b=p.maximum[c.arrayIndex]),f>b)return[new Sn(l,f,`${f} is greater than the maximum value ${b}`)]}return[]}function Pp(c){const l=c.valueSpec,f=Vi(c.value.type);let p,A,b,C={};const M=f!=="categorical"&&c.value.property===void 0,N=!M,U=Xr(c.value.stops)==="array"&&Xr(c.value.stops[0])==="array"&&Xr(c.value.stops[0][0])==="object",W=Vl({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(oe){if(f==="identity")return[new Sn(oe.key,oe.value,'identity function may not have a "stops" property')];let le=[];const de=oe.value;return le=le.concat(z_({key:oe.key,value:de,valueSpec:oe.valueSpec,style:oe.style,styleSpec:oe.styleSpec,arrayElementValidator:K})),Xr(de)==="array"&&de.length===0&&le.push(new Sn(oe.key,de,"array must have at least one stop")),le},default:function(oe){return nt({key:oe.key,value:oe.value,valueSpec:l,style:oe.style,styleSpec:oe.styleSpec})}}});return f==="identity"&&M&&W.push(new Sn(c.key,c.value,'missing required property "property"')),f==="identity"||c.value.stops||W.push(new Sn(c.key,c.value,'missing required property "stops"')),f==="exponential"&&c.valueSpec.expression&&!Hg(c.valueSpec)&&W.push(new Sn(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(N&&!jc(c.valueSpec)?W.push(new Sn(c.key,c.value,"property functions not supported")):M&&!$g(c.valueSpec)&&W.push(new Sn(c.key,c.value,"zoom functions not supported"))),f!=="categorical"&&!U||c.value.property!==void 0||W.push(new Sn(c.key,c.value,'"property" property is required')),W;function K(oe){let le=[];const de=oe.value,xe=oe.key;if(Xr(de)!=="array")return[new Sn(xe,de,`array expected, ${Xr(de)} found`)];if(de.length!==2)return[new Sn(xe,de,`array length 2 expected, length ${de.length} found`)];if(U){if(Xr(de[0])!=="object")return[new Sn(xe,de,`object expected, ${Xr(de[0])} found`)];if(de[0].zoom===void 0)return[new Sn(xe,de,"object stop key must have zoom")];if(de[0].value===void 0)return[new Sn(xe,de,"object stop key must have value")];const Le=Vi(de[0].zoom);if(typeof Le!="number")return[new Sn(xe,de[0].zoom,"stop zoom values must be numbers")];if(b&&b>Le)return[new Sn(xe,de[0].zoom,"stop zoom values must appear in ascending order")];Le!==b&&(b=Le,A=void 0,C={}),le=le.concat(Vl({key:`${xe}[0]`,value:de[0],valueSpec:{zoom:{}},style:oe.style,styleSpec:oe.styleSpec,objectElementValidators:{zoom:Cp,value:ee}}))}else le=le.concat(ee({key:`${xe}[0]`,value:de[0],valueSpec:{},style:oe.style,styleSpec:oe.styleSpec},de));return Zi(gi(de[1]))?le.concat([new Sn(`${xe}[1]`,de[1],"expressions are not allowed in function stops.")]):le.concat(nt({key:`${xe}[1]`,value:de[1],valueSpec:l,style:oe.style,styleSpec:oe.styleSpec}))}function ee(oe,le){const de=Xr(oe.value),xe=Vi(oe.value),Le=oe.value!==null?oe.value:le;if(p){if(de!==p)return[new Sn(oe.key,Le,`${de} stop domain type must match previous stop domain type ${p}`)]}else p=de;if(de!=="number"&&de!=="string"&&de!=="boolean"&&typeof xe!="number"&&typeof xe!="string"&&typeof xe!="boolean")return[new Sn(oe.key,Le,"stop domain value must be a number, string, or boolean")];if(de!=="number"&&f!=="categorical"){let $e=`number expected, ${de} found`;return jc(l)&&f===void 0&&($e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Sn(oe.key,Le,$e)]}return f!=="categorical"||de!=="number"||typeof xe=="number"&&isFinite(xe)&&Math.floor(xe)===xe?f!=="categorical"&&de==="number"&&typeof xe=="number"&&typeof A=="number"&&A!==void 0&&xe<A?[new Sn(oe.key,Le,"stop domain values must appear in ascending order")]:(A=xe,f==="categorical"&&xe in C?[new Sn(oe.key,Le,"stop domain values must be unique")]:(C[xe]=!0,[])):[new Sn(oe.key,Le,`integer expected, found ${String(xe)}`)]}}function hs(c){const l=(c.expressionContext==="property"?Kh:Qh)(gi(c.value),c.valueSpec);if(l.result==="error")return l.value.map(p=>new Sn(`${c.key}${p.key}`,c.value,p.message));const f=l.value.expression||l.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!f.outputDefined())return[new Sn(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!pa(f))return[new Sn(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return Vc(f,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Vf(f,["zoom","feature-state"]))return[new Sn(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!fu(f))return[new Sn(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vc(c,l){const f=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(l.valueSpec&&l.valueSpec.expression)for(const A of l.valueSpec.expression.parameters)f.delete(A);if(f.size===0)return[];const p=[];return c instanceof ol&&f.has(c.name)?[new Sn(l.key,l.value,`["${c.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(c.eachChild(A=>{p.push(...Vc(A,l))}),p)}function Ga(c){const l=c.key,f=c.value,p=c.valueSpec,A=[];return Array.isArray(p.values)?p.values.indexOf(Vi(f))===-1&&A.push(new Sn(l,f,`expected one of [${p.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(p.values).indexOf(Vi(f))===-1&&A.push(new Sn(l,f,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(f)} found`)),A}function Mr(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const l of c.slice(1))if(!Mr(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}function ma(c,l="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Mr(c)||(c=Dn(c));const f=c;let p=!0;try{p=function(U){if(!Wf(U))return U;let W=gi(U);return $c(W),W=U_(W),W}(f)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(f,null,2)}
        `)}const A=gt[`filter_${l}`],b=Qh(p,A);let C=null;if(b.result==="error")throw new Error(b.value.map(U=>`${U.key}: ${U.message}`).join(", "));C=(U,W,K)=>b.value.evaluate(U,W,{},K);let M=null,N=null;if(p!==f){const U=Qh(f,A);if(U.result==="error")throw new Error(U.value.map(W=>`${W.key}: ${W.message}`).join(", "));M=(W,K,ee,oe,le)=>U.value.evaluate(W,K,{},ee,void 0,void 0,oe,le),N=!fu(U.value.expression)}return{filter:C,dynamicFilter:M||void 0,needGeometry:An(p),needFeature:!!N}}function U_(c){if(!Array.isArray(c))return c;const l=function(f){if(VA.has(f[0])){for(let p=1;p<f.length;p++)if(Wf(f[p]))return!0}return f}(c);return l===!0?l:l.map(f=>U_(f))}function $c(c){let l=!1;const f=[];if(c[0]==="case"){for(let p=1;p<c.length-1;p+=2)l=l||Wf(c[p]),f.push(c[p+1]);f.push(c[c.length-1])}else if(c[0]==="match"){l=l||Wf(c[1]);for(let p=2;p<c.length-1;p+=2)f.push(c[p+1]);f.push(c[c.length-1])}else if(c[0]==="step"){l=l||Wf(c[1]);for(let p=1;p<c.length-1;p+=2)f.push(c[p+1])}l&&(c.length=0,c.push("any",...f));for(let p=1;p<c.length;p++)$c(c[p])}function Wf(c){if(!Array.isArray(c))return!1;if((l=c[0])==="pitch"||l==="distance-from-center")return!0;var l;for(let f=1;f<c.length;f++)if(Wf(c[f]))return!0;return!1}const VA=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Hc(c,l){return c<l?-1:c>l?1:0}function An(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let l=1;l<c.length;l++)if(An(c[l]))return!0;return!1}function Dn(c){if(!c)return!0;const l=c[0];return c.length<=1?l!=="any":l==="=="?Xg(c[1],c[2],"=="):l==="!="?Aa(Xg(c[1],c[2],"==")):l==="<"||l===">"||l==="<="||l===">="?Xg(c[1],c[2],l):l==="any"?(f=c.slice(1),["any"].concat(f.map(Dn))):l==="all"?["all"].concat(c.slice(1).map(Dn)):l==="none"?["all"].concat(c.slice(1).map(Dn).map(Aa)):l==="in"?Jh(c[1],c.slice(2)):l==="!in"?Aa(Jh(c[1],c.slice(2))):l==="has"?ed(c[1]):l==="!has"?Aa(ed(c[1])):l!=="within"||c;var f}function Xg(c,l,f){switch(c){case"$type":return[`filter-type-${f}`,l];case"$id":return[`filter-id-${f}`,l];default:return[`filter-${f}`,c,l]}}function Jh(c,l){if(l.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(f=>typeof f!=typeof l[0])?["filter-in-large",c,["literal",l.sort(Hc)]]:["filter-in-small",c,["literal",l]]}}function ed(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Aa(c){return["!",c]}function td(c){return Mr(gi(c.value))?hs(za({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):al(c)}function al(c){const l=c.value,f=c.key;if(Xr(l)!=="array")return[new Sn(f,l,`array expected, ${Xr(l)} found`)];const p=c.styleSpec;let A,b=[];if(l.length<1)return[new Sn(f,l,"filter array must have at least 1 element")];switch(b=b.concat(Ga({key:`${f}[0]`,value:l[0],valueSpec:p.filter_operator,style:c.style,styleSpec:c.styleSpec})),Vi(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&Vi(l[1])==="$type"&&b.push(new Sn(f,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&b.push(new Sn(f,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(A=Xr(l[1]),A!=="string"&&b.push(new Sn(`${f}[1]`,l[1],`string expected, ${A} found`)));for(let C=2;C<l.length;C++)A=Xr(l[C]),Vi(l[1])==="$type"?b=b.concat(Ga({key:`${f}[${C}]`,value:l[C],valueSpec:p.geometry_type,style:c.style,styleSpec:c.styleSpec})):A!=="string"&&A!=="number"&&A!=="boolean"&&b.push(new Sn(`${f}[${C}]`,l[C],`string, number, or boolean expected, ${A} found`));break;case"any":case"all":case"none":for(let C=1;C<l.length;C++)b=b.concat(al({key:`${f}[${C}]`,value:l[C],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":A=Xr(l[1]),l.length!==2?b.push(new Sn(f,l,`filter array for "${l[0]}" operator must have 2 elements`)):A!=="string"&&b.push(new Sn(`${f}[1]`,l[1],`string expected, ${A} found`));break;case"within":A=Xr(l[1]),l.length!==2?b.push(new Sn(f,l,`filter array for "${l[0]}" operator must have 2 elements`)):A!=="object"&&b.push(new Sn(`${f}[1]`,l[1],`object expected, ${A} found`))}return b}function y(c,l){const f=c.key,p=c.style,A=c.styleSpec,b=c.value,C=c.objectKey,M=A[`${l}_${c.layerType}`];if(!M)return[];const N=C.match(/^(.*)-transition$/);if(l==="paint"&&N&&M[N[1]]&&M[N[1]].transition)return nt({key:f,value:b,valueSpec:A.transition,style:p,styleSpec:A});const U=c.valueSpec||M[C];if(!U)return[new Sn(f,b,`unknown property "${C}"`)];let W;if(Xr(b)==="string"&&jc(U)&&!U.tokens&&(W=/^{([^}]+)}$/.exec(b))){const ee=`\`{ "type": "identity", "property": ${W?JSON.stringify(W[1]):'"_"'} }\``;return[new Sn(f,b,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${ee}.`)]}const K=[];return c.layerType==="symbol"&&(C==="text-field"&&p&&!p.glyphs&&K.push(new Sn(f,b,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&bp(gi(b))&&Vi(b.type)==="identity"&&K.push(new Sn(f,b,'"text-font" does not support identity functions'))),K.concat(nt({key:c.key,value:b,valueSpec:U,style:p,styleSpec:A,expressionContext:"property",propertyType:l,propertyKey:C}))}function x(c){return y(c,"paint")}function T(c){return y(c,"layout")}function O(c){let l=[];const f=c.value,p=c.key,A=c.style,b=c.styleSpec;f.type||f.ref||l.push(new Sn(p,f,'either "type" or "ref" is required'));let C=Vi(f.type);const M=Vi(f.ref);if(f.id){const N=Vi(f.id);for(let U=0;U<c.arrayIndex;U++){const W=A.layers[U];Vi(W.id)===N&&l.push(new Sn(p,f.id,`duplicate layer id "${f.id}", previously used at line ${W.id.__line__}`))}}if("ref"in f){let N;["type","source","source-layer","filter","layout"].forEach(U=>{U in f&&l.push(new Sn(p,f[U],`"${U}" is prohibited for ref layers`))}),A.layers.forEach(U=>{Vi(U.id)===M&&(N=U)}),N?N.ref?l.push(new Sn(p,f.ref,"ref cannot reference another ref layer")):C=Vi(N.type):typeof M=="string"&&l.push(new Sn(p,f.ref,`ref layer "${M}" not found`))}else if(C!=="background"&&C!=="sky")if(f.source){const N=A.sources&&A.sources[f.source],U=N&&Vi(N.type);N?U==="vector"&&C==="raster"?l.push(new Sn(p,f.source,`layer "${f.id}" requires a raster source`)):U==="raster"&&C!=="raster"?l.push(new Sn(p,f.source,`layer "${f.id}" requires a vector source`)):U!=="vector"||f["source-layer"]?U==="raster-dem"&&C!=="hillshade"?l.push(new Sn(p,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!f.paint||!f.paint["line-gradient"]&&!f.paint["line-trim-offset"]||U==="geojson"&&N.lineMetrics||l.push(new Sn(p,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new Sn(p,f,`layer "${f.id}" must specify a "source-layer"`)):l.push(new Sn(p,f.source,`source "${f.source}" not found`))}else l.push(new Sn(p,f,'missing required property "source"'));return l=l.concat(Vl({key:p,value:f,valueSpec:b.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>nt({key:`${p}.type`,value:f.type,valueSpec:b.layer.type,style:c.style,styleSpec:c.styleSpec,object:f,objectKey:"type"}),filter:N=>td(za({layerType:C},N)),layout:N=>Vl({layer:f,key:N.key,value:N.value,valueSpec:{},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{"*":U=>T(za({layerType:C},U))}}),paint:N=>Vl({layer:f,key:N.key,value:N.value,valueSpec:{},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{"*":U=>x(za({layerType:C},U))}})}})),l}function D(c){const l=c.value,f=c.key,p=Xr(l);return p!=="string"?[new Sn(f,l,`string expected, ${p} found`)]:[]}const j={promoteId:function({key:c,value:l}){if(Xr(l)==="string")return D({key:c,value:l});{const f=[];for(const p in l)f.push(...D({key:`${c}.${p}`,value:l[p]}));return f}}};function G(c){const l=c.value,f=c.key,p=c.styleSpec,A=c.style;if(!l.type)return[new Sn(f,l,'"type" is required')];const b=Vi(l.type);let C;switch(b){case"vector":case"raster":case"raster-dem":return C=Vl({key:f,value:l,valueSpec:p[`source_${b.replace("-","_")}`],style:c.style,styleSpec:p,objectElementValidators:j}),C;case"geojson":if(C=Vl({key:f,value:l,valueSpec:p.source_geojson,style:A,styleSpec:p,objectElementValidators:j}),l.cluster)for(const M in l.clusterProperties){const[N,U]=l.clusterProperties[M],W=typeof N=="string"?[N,["accumulated"],["get",M]]:N;C.push(...hs({key:`${f}.${M}.map`,value:U,expressionContext:"cluster-map"})),C.push(...hs({key:`${f}.${M}.reduce`,value:W,expressionContext:"cluster-reduce"}))}return C;case"video":return Vl({key:f,value:l,valueSpec:p.source_video,style:A,styleSpec:p});case"image":return Vl({key:f,value:l,valueSpec:p.source_image,style:A,styleSpec:p});case"canvas":return[new Sn(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ga({key:`${f}.type`,value:l.type,valueSpec:{values:Z(p)},style:A,styleSpec:p})}}function Z(c){return c.source.reduce((l,f)=>{const p=c[f];return p.type.type==="enum"&&(l=l.concat(Object.keys(p.type.values))),l},[])}function ae(c){const l=c.value,f=c.styleSpec,p=f.light,A=c.style;let b=[];const C=Xr(l);if(l===void 0)return b;if(C!=="object")return b=b.concat([new Sn("light",l,`object expected, ${C} found`)]),b;for(const M in l){const N=M.match(/^(.*)-transition$/);b=b.concat(N&&p[N[1]]&&p[N[1]].transition?nt({key:M,value:l[M],valueSpec:f.transition,style:A,styleSpec:f}):p[M]?nt({key:M,value:l[M],valueSpec:p[M],style:A,styleSpec:f}):[new Sn(M,l[M],`unknown property "${M}"`)])}return b}function pe(c){const l=c.value,f=c.key,p=c.style,A=c.styleSpec,b=A.terrain;let C=[];const M=Xr(l);if(l===void 0)return C;if(M!=="object")return C=C.concat([new Sn("terrain",l,`object expected, ${M} found`)]),C;for(const N in l){const U=N.match(/^(.*)-transition$/);C=C.concat(U&&b[U[1]]&&b[U[1]].transition?nt({key:N,value:l[N],valueSpec:A.transition,style:p,styleSpec:A}):b[N]?nt({key:N,value:l[N],valueSpec:b[N],style:p,styleSpec:A}):[new Sn(N,l[N],`unknown property "${N}"`)])}if(l.source){const N=p.sources&&p.sources[l.source],U=N&&Vi(N.type);N?U!=="raster-dem"&&C.push(new Sn(f,l.source,`terrain cannot be used with a source of type ${String(U)}, it only be used with a "raster-dem" source type`)):C.push(new Sn(f,l.source,`source "${l.source}" not found`))}else C.push(new Sn(f,l,'terrain is missing required property "source"'));return C}function _e(c){const l=c.value,f=c.style,p=c.styleSpec,A=p.fog;let b=[];const C=Xr(l);if(l===void 0)return b;if(C!=="object")return b=b.concat([new Sn("fog",l,`object expected, ${C} found`)]),b;for(const M in l){const N=M.match(/^(.*)-transition$/);b=b.concat(N&&A[N[1]]&&A[N[1]].transition?nt({key:M,value:l[M],valueSpec:p.transition,style:f,styleSpec:p}):A[M]?nt({key:M,value:l[M],valueSpec:A[M],style:f,styleSpec:p}):[new Sn(M,l[M],`unknown property "${M}"`)])}return b}const Xe={"*":()=>[],array:z_,boolean:function(c){const l=c.value,f=c.key,p=Xr(l);return p!=="boolean"?[new Sn(f,l,`boolean expected, ${p} found`)]:[]},number:Cp,color:function(c){const l=c.key,f=c.value,p=Xr(f);return p!=="string"?[new Sn(l,f,`color expected, ${p} found`)]:Ao(f)===null?[new Sn(l,f,`color expected, "${f}" found`)]:[]},enum:Ga,filter:td,function:Pp,layer:O,object:Vl,source:G,light:ae,terrain:pe,fog:_e,string:D,formatted:function(c){return D(c).length===0?[]:hs(c)},resolvedImage:function(c){return D(c).length===0?[]:hs(c)},projection:function(c){const l=c.value,f=c.styleSpec,p=f.projection,A=c.style;let b=[];const C=Xr(l);if(C==="object")for(const M in l)b=b.concat(nt({key:M,value:l[M],valueSpec:p[M],style:A,styleSpec:f}));else C!=="string"&&(b=b.concat([new Sn("projection",l,`object or string expected, ${C} found`)]));return b}};function nt(c){const l=c.value,f=c.valueSpec,p=c.styleSpec;return f.expression&&bp(Vi(l))?Pp(c):f.expression&&Zi(gi(l))?hs(c):f.type&&Xe[f.type]?Xe[f.type](c):Vl(za({},c,{valueSpec:f.type?p[f.type]:f}))}function mt(c){const l=c.value,f=c.key,p=D(c);return p.length||(l.indexOf("{fontstack}")===-1&&p.push(new Sn(f,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&p.push(new Sn(f,l,'"glyphs" url must include a "{range}" token'))),p}function kt(c,l=gt){return Cn(nt({key:"",value:c,valueSpec:l.$root,styleSpec:l,style:c,objectElementValidators:{glyphs:mt,"*":()=>[]}}))}const Vt=c=>Cn(x(c)),yn=c=>Cn(T(c));function Cn(c){return c.slice().sort((l,f)=>l.line&&f.line?l.line-f.line:0)}function Rt(c,l){let f=!1;if(l&&l.length)for(const p of l)c.fire(new Hn(new Error(p.message))),f=!0;return f}var fn=On,ot=3;function On(c,l,f){var p=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var A=new Int32Array(this.arrayBuffer);c=A[0],this.d=(l=A[1])+2*(f=A[2]);for(var b=0;b<this.d*this.d;b++){var C=A[ot+b],M=A[ot+b+1];p.push(C===M?null:A.subarray(C,M))}var N=A[ot+p.length+1];this.keys=A.subarray(A[ot+p.length],N),this.bboxes=A.subarray(N),this.insert=this._insertReadonly}else{this.d=l+2*f;for(var U=0;U<this.d*this.d;U++)p.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=c,this.padding=f,this.scale=l/c,this.uid=0;var W=f/l*c;this.min=-W,this.max=c+W}On.prototype.insert=function(c,l,f,p,A){this._forEachCell(l,f,p,A,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(p),this.bboxes.push(A)},On.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},On.prototype._insertCell=function(c,l,f,p,A,b){this.cells[A].push(b)},On.prototype.query=function(c,l,f,p,A){var b=this.min,C=this.max;if(c<=b&&l<=b&&C<=f&&C<=p&&!A)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(c,l,f,p,this._queryCell,M,{},A),M},On.prototype._queryCell=function(c,l,f,p,A,b,C,M){var N=this.cells[A];if(N!==null)for(var U=this.keys,W=this.bboxes,K=0;K<N.length;K++){var ee=N[K];if(C[ee]===void 0){var oe=4*ee;(M?M(W[oe+0],W[oe+1],W[oe+2],W[oe+3]):c<=W[oe+2]&&l<=W[oe+3]&&f>=W[oe+0]&&p>=W[oe+1])?(C[ee]=!0,b.push(U[ee])):C[ee]=!1}}},On.prototype._forEachCell=function(c,l,f,p,A,b,C,M){for(var N=this._convertToCellCoord(c),U=this._convertToCellCoord(l),W=this._convertToCellCoord(f),K=this._convertToCellCoord(p),ee=N;ee<=W;ee++)for(var oe=U;oe<=K;oe++){var le=this.d*oe+ee;if((!M||M(this._convertFromCellCoord(ee),this._convertFromCellCoord(oe),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(oe+1)))&&A.call(this,c,l,f,p,le,b,C,M))return}},On.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},On.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},On.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,l=ot+this.cells.length+1+1,f=0,p=0;p<this.cells.length;p++)f+=this.cells[p].length;var A=new Int32Array(l+f+this.keys.length+this.bboxes.length);A[0]=this.extent,A[1]=this.n,A[2]=this.padding;for(var b=l,C=0;C<c.length;C++){var M=c[C];A[ot+C]=b,A.set(M,b),b+=M.length}return A[ot+c.length]=b,A.set(this.keys,b),A[ot+c.length+1]=b+=this.keys.length,A.set(this.bboxes,b),b+=this.bboxes.length,A.buffer};var Bn=k(fn);const Pn={};function Mt(c,l,f={}){Object.defineProperty(c,"_classRegistryKey",{value:l,writeable:!1}),Pn[l]={klass:c,omit:f.omit||[]}}Mt(Object,"Object"),Bn.serialize=function(c,l){const f=c.toArrayBuffer();return l&&l.push(f),{buffer:f}},Bn.deserialize=function(c){return new Bn(c.buffer)},Object.defineProperty(Bn,"name",{value:"Grid"}),Mt(Bn,"Grid"),Mt(lo,"Color"),Mt(Error,"Error"),Mt(lu,"AJAXError"),Mt(il,"ResolvedImage"),Mt(Sp,"StylePropertyFunction"),Mt(wp,"StyleExpression",{omit:["_evaluator"]}),Mt(Ep,"ZoomDependentExpression"),Mt(jA,"ZoomConstantExpression"),Mt(ol,"CompoundExpression",{omit:["_evaluate"]});for(const c in vp)Pn[vp[c]._classRegistryKey]||Mt(vp[c],`Expression${c}`);function br(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function ui(c){return u.ImageBitmap&&c instanceof u.ImageBitmap}function Vr(c,l){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(br(c)||ui(c))return l&&l.push(c),c;if(ArrayBuffer.isView(c)){const f=c;return l&&l.push(f.buffer),f}if(c instanceof u.ImageData)return l&&l.push(c.data.buffer),c;if(Array.isArray(c)){const f=[];for(const p of c)f.push(Vr(p,l));return f}if(typeof c=="object"){const f=c.constructor,p=f._classRegistryKey;if(!p)throw new Error(`can't serialize object of unregistered class ${p}`);const A=f.serialize?f.serialize(c,l):{};if(!f.serialize){for(const b in c)c.hasOwnProperty(b)&&(Pn[p].omit.indexOf(b)>=0||(A[b]=Vr(c[b],l)));c instanceof Error&&(A.message=c.message)}if(A.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(A.$name=p),A}throw new Error("can't serialize object of type "+typeof c)}function Jr(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||br(c)||ui(c)||ArrayBuffer.isView(c)||c instanceof u.ImageData)return c;if(Array.isArray(c))return c.map(Jr);if(typeof c=="object"){const l=c.$name||"Object",{klass:f}=Pn[l];if(!f)throw new Error(`can't deserialize unregistered class ${l}`);if(f.deserialize)return f.deserialize(c);const p=Object.create(f.prototype);for(const A of Object.keys(c))A!=="$name"&&(p[A]=Jr(c[A]));return p}throw new Error("can't deserialize object of type "+typeof c)}const qt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function xi(c){for(const l of c)if(cx(l.charCodeAt(0)))return!0;return!1}function $i(c){for(const l of c)if(!gr(l.charCodeAt(0)))return!1;return!0}function gr(c){return!(qt.Arabic(c)||qt["Arabic Supplement"](c)||qt["Arabic Extended-A"](c)||qt["Arabic Presentation Forms-A"](c)||qt["Arabic Presentation Forms-B"](c))}function cx(c){return!(c!==746&&c!==747&&(c<4352||!(qt["Bopomofo Extended"](c)||qt.Bopomofo(c)||qt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||qt["CJK Compatibility Ideographs"](c)||qt["CJK Compatibility"](c)||qt["CJK Radicals Supplement"](c)||qt["CJK Strokes"](c)||!(!qt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||qt["CJK Unified Ideographs Extension A"](c)||qt["CJK Unified Ideographs"](c)||qt["Enclosed CJK Letters and Months"](c)||qt["Hangul Compatibility Jamo"](c)||qt["Hangul Jamo Extended-A"](c)||qt["Hangul Jamo Extended-B"](c)||qt["Hangul Jamo"](c)||qt["Hangul Syllables"](c)||qt.Hiragana(c)||qt["Ideographic Description Characters"](c)||qt.Kanbun(c)||qt["Kangxi Radicals"](c)||qt["Katakana Phonetic Extensions"](c)||qt.Katakana(c)&&c!==12540||!(!qt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!qt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||qt["Unified Canadian Aboriginal Syllabics"](c)||qt["Unified Canadian Aboriginal Syllabics Extended"](c)||qt["Vertical Forms"](c)||qt["Yijing Hexagram Symbols"](c)||qt["Yi Syllables"](c)||qt["Yi Radicals"](c))))}function _2(c){return!(cx(c)||function(l){return!!(qt["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||qt["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||qt["Letterlike Symbols"](l)||qt["Number Forms"](l)||qt["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||qt["Control Pictures"](l)&&l!==9251||qt["Optical Character Recognition"](l)||qt["Enclosed Alphanumerics"](l)||qt["Geometric Shapes"](l)||qt["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||qt["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||qt["CJK Symbols and Punctuation"](l)||qt.Katakana(l)||qt["Private Use Area"](l)||qt["CJK Compatibility Forms"](l)||qt["Small Form Variants"](l)||qt["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(c))}function y2(c){return c>=1424&&c<=2303||qt["Arabic Presentation Forms-A"](c)||qt["Arabic Presentation Forms-B"](c)}function jL(c,l){return!(!l&&y2(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||qt.Khmer(c))}function VL(c){for(const l of c)if(y2(l.charCodeAt(0)))return!0;return!1}const fx="deferred",hx="loading",dx="loaded";let Zg=null,v="unavailable",h=null;const m=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(v="error"),Zg&&Zg(c)};function S(){I.fire(new $o("pluginStateChange",{pluginStatus:v,pluginURL:h}))}const I=new Ke,L=function(){return v},$=function(){if(v!==fx||!h)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");v=hx,S(),h&&Fc({url:h},c=>{c?m(c):(v=dx,S())})},H={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>v===dx||H.applyArabicShaping!=null,isLoading:()=>v===hx,setState(c){v=c.pluginStatus,h=c.pluginURL},isParsed:()=>H.applyArabicShaping!=null&&H.processBidirectionalText!=null&&H.processStyledBidirectionalText!=null,getPluginURL:()=>h};class Q{constructor(l,f){this.zoom=l,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.transition=f.transition,this.pitch=f.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(l){return function(f,p){for(const A of f)if(!jL(A.charCodeAt(0),p))return!1;return!0}(l,H.isLoaded())}}class ne{constructor(l,f){this.property=l,this.value=f,this.expression=function(p,A){if(bp(p))return new Sp(p,A);if(Zi(p)){const b=Kh(p,A);if(b.result==="error")throw new Error(b.value.map(C=>`${C.key}: ${C.message}`).join(", "));return b.value}{let b=p;return typeof p=="string"&&A.type==="color"&&(b=lo.parse(p)),{kind:"constant",evaluate:()=>b}}}(f===void 0?l.specification.default:f,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,f,p){return this.property.possiblyEvaluate(this,l,f,p)}}class te{constructor(l){this.property=l,this.value=new ne(l,void 0)}transitioned(l,f){return new ve(this.property,this.value,f,Ct({},l.transition,this.transition),l.now)}untransitioned(){return new ve(this.property,this.value,null,{},0)}}class fe{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return It(this._values[l].value.value)}setValue(l,f){this._values.hasOwnProperty(l)||(this._values[l]=new te(this._values[l].property)),this._values[l].value=new ne(this._values[l].property,f===null?void 0:It(f))}getTransition(l){return It(this._values[l].transition)}setTransition(l,f){this._values.hasOwnProperty(l)||(this._values[l]=new te(this._values[l].property)),this._values[l].transition=It(f)||void 0}serialize(){const l={};for(const f of Object.keys(this._values)){const p=this.getValue(f);p!==void 0&&(l[f]=p);const A=this.getTransition(f);A!==void 0&&(l[`${f}-transition`]=A)}return l}transitioned(l,f){const p=new Te(this._properties);for(const A of Object.keys(this._values))p._values[A]=this._values[A].transitioned(l,f._values[A]);return p}untransitioned(){const l=new Te(this._properties);for(const f of Object.keys(this._values))l._values[f]=this._values[f].untransitioned();return l}}class ve{constructor(l,f,p,A,b){const C=A.delay||0,M=A.duration||0;b=b||0,this.property=l,this.value=f,this.begin=b+C,this.end=this.begin+M,l.specification.transition&&(A.delay||A.duration)&&(this.prior=p)}possiblyEvaluate(l,f,p){const A=l.now||0,b=this.value.possiblyEvaluate(l,f,p),C=this.prior;if(C){if(A>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(A<this.begin)return C.possiblyEvaluate(l,f,p);{const M=(A-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(l,f,p),b,Ye(M))}}return b}}class Te{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,f,p){const A=new Re(this._properties);for(const b of Object.keys(this._values))A._values[b]=this._values[b].possiblyEvaluate(l,f,p);return A}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class Ie{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}getValue(l){return It(this._values[l].value)}setValue(l,f){this._values[l]=new ne(this._values[l].property,f===null?void 0:It(f))}serialize(){const l={};for(const f of Object.keys(this._values)){const p=this.getValue(f);p!==void 0&&(l[f]=p)}return l}possiblyEvaluate(l,f,p){const A=new Re(this._properties);for(const b of Object.keys(this._values))A._values[b]=this._values[b].possiblyEvaluate(l,f,p);return A}}class Pe{constructor(l,f,p){this.property=l,this.value=f,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,f,p,A){return this.property.evaluate(this.value,this.parameters,l,f,p,A)}}class Re{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class he{constructor(l){this.specification=l}possiblyEvaluate(l,f){return l.expression.evaluate(f)}interpolate(l,f,p){const A=hu[this.specification.type];return A?A(l,f,p):l}}class Se{constructor(l,f){this.specification=l,this.overrides=f}possiblyEvaluate(l,f,p,A){return new Pe(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(f,null,{},p,A)}:l.expression,f)}interpolate(l,f,p){if(l.value.kind!=="constant"||f.value.kind!=="constant")return l;if(l.value.value===void 0||f.value.value===void 0)return new Pe(this,{kind:"constant",value:void 0},l.parameters);const A=hu[this.specification.type];return A?new Pe(this,{kind:"constant",value:A(l.value.value,f.value.value,p)},l.parameters):l}evaluate(l,f,p,A,b,C){return l.kind==="constant"?l.value:l.evaluate(f,p,A,b,C)}}class Fe{constructor(l){this.specification=l}possiblyEvaluate(l,f,p,A){return!!l.expression.evaluate(f,null,{},p,A)}interpolate(){return!1}}class ke{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const f=new Q(0,{});for(const p in l){const A=l[p];A.specification.overridable&&this.overridableProperties.push(p);const b=this.defaultPropertyValues[p]=new ne(A,void 0),C=this.defaultTransitionablePropertyValues[p]=new te(A);this.defaultTransitioningPropertyValues[p]=C.untransitioned(),this.defaultPossiblyEvaluatedValues[p]=b.possiblyEvaluate(f)}}}function Qe(c,l){return 256*(c=Ee(Math.floor(c),0,255))+Ee(Math.floor(l),0,255)}Mt(Se,"DataDrivenProperty"),Mt(he,"DataConstantProperty"),Mt(Fe,"ColorRampProperty");const et={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Je{constructor(l,f){this._structArray=l,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class lt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,f){return l._trim(),f&&(l.isTransferred=!0,f.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const f=Object.create(this.prototype);return f.arrayBuffer=l.arrayBuffer,f.length=l.length,f.capacity=l.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function at(c,l=1){let f=0,p=0;return{members:c.map(A=>{const b=et[A.type].BYTES_PER_ELEMENT,C=f=xt(f,Math.max(l,b)),M=A.components||1;return p=Math.max(p,b),f+=b*M,{name:A.name,type:A.type,components:M,offset:C}}),size:xt(f,Math.max(p,l)),alignment:l}}function xt(c,l){return Math.ceil(c/l)*l}class en extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f){const p=this.length;return this.resize(p+1),this.emplace(p,l,f)}emplace(l,f,p){const A=2*l;return this.int16[A+0]=f,this.int16[A+1]=p,l}}en.prototype.bytesPerElement=4,Mt(en,"StructArrayLayout2i4");class At extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,p){const A=this.length;return this.resize(A+1),this.emplace(A,l,f,p)}emplace(l,f,p,A){const b=3*l;return this.int16[b+0]=f,this.int16[b+1]=p,this.int16[b+2]=A,l}}At.prototype.bytesPerElement=6,Mt(At,"StructArrayLayout3i6");class Ut extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,p,A){const b=this.length;return this.resize(b+1),this.emplace(b,l,f,p,A)}emplace(l,f,p,A,b){const C=4*l;return this.int16[C+0]=f,this.int16[C+1]=p,this.int16[C+2]=A,this.int16[C+3]=b,l}}Ut.prototype.bytesPerElement=8,Mt(Ut,"StructArrayLayout4i8");class St extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,p,A,b,C,M){const N=this.length;return this.resize(N+1),this.emplace(N,l,f,p,A,b,C,M)}emplace(l,f,p,A,b,C,M,N){const U=6*l,W=12*l,K=3*l;return this.int16[U+0]=f,this.int16[U+1]=p,this.uint8[W+4]=A,this.uint8[W+5]=b,this.uint8[W+6]=C,this.uint8[W+7]=M,this.float32[K+2]=N,l}}St.prototype.bytesPerElement=12,Mt(St,"StructArrayLayout2i4ub1f12");class Kt extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,p,A){const b=this.length;return this.resize(b+1),this.emplace(b,l,f,p,A)}emplace(l,f,p,A,b){const C=4*l;return this.float32[C+0]=f,this.float32[C+1]=p,this.float32[C+2]=A,this.float32[C+3]=b,l}}Kt.prototype.bytesPerElement=16,Mt(Kt,"StructArrayLayout4f16");class vt extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,p,A,b){const C=this.length;return this.resize(C+1),this.emplace(C,l,f,p,A,b)}emplace(l,f,p,A,b,C){const M=6*l,N=3*l;return this.uint16[M+0]=f,this.uint16[M+1]=p,this.uint16[M+2]=A,this.uint16[M+3]=b,this.float32[N+2]=C,l}}vt.prototype.bytesPerElement=12,Mt(vt,"StructArrayLayout4ui1f12");class zt extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,p,A){const b=this.length;return this.resize(b+1),this.emplace(b,l,f,p,A)}emplace(l,f,p,A,b){const C=4*l;return this.uint16[C+0]=f,this.uint16[C+1]=p,this.uint16[C+2]=A,this.uint16[C+3]=b,l}}zt.prototype.bytesPerElement=8,Mt(zt,"StructArrayLayout4ui8");class nn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,p,A,b,C){const M=this.length;return this.resize(M+1),this.emplace(M,l,f,p,A,b,C)}emplace(l,f,p,A,b,C,M){const N=6*l;return this.int16[N+0]=f,this.int16[N+1]=p,this.int16[N+2]=A,this.int16[N+3]=b,this.int16[N+4]=C,this.int16[N+5]=M,l}}nn.prototype.bytesPerElement=12,Mt(nn,"StructArrayLayout6i12");class Ht extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,p,A,b,C,M,N,U,W,K,ee){const oe=this.length;return this.resize(oe+1),this.emplace(oe,l,f,p,A,b,C,M,N,U,W,K,ee)}emplace(l,f,p,A,b,C,M,N,U,W,K,ee,oe){const le=12*l;return this.int16[le+0]=f,this.int16[le+1]=p,this.int16[le+2]=A,this.int16[le+3]=b,this.uint16[le+4]=C,this.uint16[le+5]=M,this.uint16[le+6]=N,this.uint16[le+7]=U,this.int16[le+8]=W,this.int16[le+9]=K,this.int16[le+10]=ee,this.int16[le+11]=oe,l}}Ht.prototype.bytesPerElement=24,Mt(Ht,"StructArrayLayout4i4ui4i24");class an extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,p,A,b,C){const M=this.length;return this.resize(M+1),this.emplace(M,l,f,p,A,b,C)}emplace(l,f,p,A,b,C,M){const N=10*l,U=5*l;return this.int16[N+0]=f,this.int16[N+1]=p,this.int16[N+2]=A,this.float32[U+2]=b,this.float32[U+3]=C,this.float32[U+4]=M,l}}an.prototype.bytesPerElement=20,Mt(an,"StructArrayLayout3i3f20");class Wn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const f=this.length;return this.resize(f+1),this.emplace(f,l)}emplace(l,f){return this.uint32[1*l+0]=f,l}}Wn.prototype.bytesPerElement=4,Mt(Wn,"StructArrayLayout1ul4");class hr extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,p,A,b,C,M,N,U,W,K,ee,oe){const le=this.length;return this.resize(le+1),this.emplace(le,l,f,p,A,b,C,M,N,U,W,K,ee,oe)}emplace(l,f,p,A,b,C,M,N,U,W,K,ee,oe,le){const de=20*l,xe=10*l;return this.int16[de+0]=f,this.int16[de+1]=p,this.int16[de+2]=A,this.int16[de+3]=b,this.int16[de+4]=C,this.float32[xe+3]=M,this.float32[xe+4]=N,this.float32[xe+5]=U,this.float32[xe+6]=W,this.int16[de+14]=K,this.uint32[xe+8]=ee,this.uint16[de+18]=oe,this.uint16[de+19]=le,l}}hr.prototype.bytesPerElement=40,Mt(hr,"StructArrayLayout5i4f1i1ul2ui40");class kn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,p,A,b,C,M){const N=this.length;return this.resize(N+1),this.emplace(N,l,f,p,A,b,C,M)}emplace(l,f,p,A,b,C,M,N){const U=8*l;return this.int16[U+0]=f,this.int16[U+1]=p,this.int16[U+2]=A,this.int16[U+4]=b,this.int16[U+5]=C,this.int16[U+6]=M,this.int16[U+7]=N,l}}kn.prototype.bytesPerElement=16,Mt(kn,"StructArrayLayout3i2i2i16");class er extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,p,A,b){const C=this.length;return this.resize(C+1),this.emplace(C,l,f,p,A,b)}emplace(l,f,p,A,b,C){const M=4*l,N=8*l;return this.float32[M+0]=f,this.float32[M+1]=p,this.float32[M+2]=A,this.int16[N+6]=b,this.int16[N+7]=C,l}}er.prototype.bytesPerElement=16,Mt(er,"StructArrayLayout2f1f2i16");class Fr extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,p,A){const b=this.length;return this.resize(b+1),this.emplace(b,l,f,p,A)}emplace(l,f,p,A,b){const C=12*l,M=3*l;return this.uint8[C+0]=f,this.uint8[C+1]=p,this.float32[M+1]=A,this.float32[M+2]=b,l}}Fr.prototype.bytesPerElement=12,Mt(Fr,"StructArrayLayout2ub2f12");class Nr extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,p){const A=this.length;return this.resize(A+1),this.emplace(A,l,f,p)}emplace(l,f,p,A){const b=3*l;return this.float32[b+0]=f,this.float32[b+1]=p,this.float32[b+2]=A,l}}Nr.prototype.bytesPerElement=12,Mt(Nr,"StructArrayLayout3f12");class Vn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,p){const A=this.length;return this.resize(A+1),this.emplace(A,l,f,p)}emplace(l,f,p,A){const b=3*l;return this.uint16[b+0]=f,this.uint16[b+1]=p,this.uint16[b+2]=A,l}}Vn.prototype.bytesPerElement=6,Mt(Vn,"StructArrayLayout3ui6");class fi extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l,f,p,A,b,C,M,N,U,W,K,ee,oe,le,de,xe,Le,$e,De,je,Ze){const We=this.length;return this.resize(We+1),this.emplace(We,l,f,p,A,b,C,M,N,U,W,K,ee,oe,le,de,xe,Le,$e,De,je,Ze)}emplace(l,f,p,A,b,C,M,N,U,W,K,ee,oe,le,de,xe,Le,$e,De,je,Ze,We){const bt=30*l,_t=15*l,Ft=60*l;return this.int16[bt+0]=f,this.int16[bt+1]=p,this.int16[bt+2]=A,this.float32[_t+2]=b,this.float32[_t+3]=C,this.uint16[bt+8]=M,this.uint16[bt+9]=N,this.uint32[_t+5]=U,this.uint32[_t+6]=W,this.uint32[_t+7]=K,this.uint16[bt+16]=ee,this.uint16[bt+17]=oe,this.uint16[bt+18]=le,this.float32[_t+10]=de,this.float32[_t+11]=xe,this.uint8[Ft+48]=Le,this.uint8[Ft+49]=$e,this.uint8[Ft+50]=De,this.uint32[_t+13]=je,this.int16[bt+28]=Ze,this.uint8[Ft+58]=We,l}}fi.prototype.bytesPerElement=60,Mt(fi,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class bi extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l,f,p,A,b,C,M,N,U,W,K,ee,oe,le,de,xe,Le,$e,De,je,Ze,We,bt,_t,Ft,tn,Tt,Gt,jt,Yt){const ln=this.length;return this.resize(ln+1),this.emplace(ln,l,f,p,A,b,C,M,N,U,W,K,ee,oe,le,de,xe,Le,$e,De,je,Ze,We,bt,_t,Ft,tn,Tt,Gt,jt,Yt)}emplace(l,f,p,A,b,C,M,N,U,W,K,ee,oe,le,de,xe,Le,$e,De,je,Ze,We,bt,_t,Ft,tn,Tt,Gt,jt,Yt,ln){const Bt=38*l,xn=19*l;return this.int16[Bt+0]=f,this.int16[Bt+1]=p,this.int16[Bt+2]=A,this.float32[xn+2]=b,this.float32[xn+3]=C,this.int16[Bt+8]=M,this.int16[Bt+9]=N,this.int16[Bt+10]=U,this.int16[Bt+11]=W,this.int16[Bt+12]=K,this.int16[Bt+13]=ee,this.uint16[Bt+14]=oe,this.uint16[Bt+15]=le,this.uint16[Bt+16]=de,this.uint16[Bt+17]=xe,this.uint16[Bt+18]=Le,this.uint16[Bt+19]=$e,this.uint16[Bt+20]=De,this.uint16[Bt+21]=je,this.uint16[Bt+22]=Ze,this.uint16[Bt+23]=We,this.uint16[Bt+24]=bt,this.uint16[Bt+25]=_t,this.uint16[Bt+26]=Ft,this.uint16[Bt+27]=tn,this.uint16[Bt+28]=Tt,this.uint32[xn+15]=Gt,this.float32[xn+16]=jt,this.float32[xn+17]=Yt,this.float32[xn+18]=ln,l}}bi.prototype.bytesPerElement=76,Mt(bi,"StructArrayLayout3i2f6i15ui1ul3f76");class wi extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const f=this.length;return this.resize(f+1),this.emplace(f,l)}emplace(l,f){return this.float32[1*l+0]=f,l}}wi.prototype.bytesPerElement=4,Mt(wi,"StructArrayLayout1f4");class Ei extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,p,A,b){const C=this.length;return this.resize(C+1),this.emplace(C,l,f,p,A,b)}emplace(l,f,p,A,b,C){const M=5*l;return this.float32[M+0]=f,this.float32[M+1]=p,this.float32[M+2]=A,this.float32[M+3]=b,this.float32[M+4]=C,l}}Ei.prototype.bytesPerElement=20,Mt(Ei,"StructArrayLayout5f20");class _a extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,p,A){const b=this.length;return this.resize(b+1),this.emplace(b,l,f,p,A)}emplace(l,f,p,A,b){const C=6*l;return this.uint32[3*l+0]=f,this.uint16[C+2]=p,this.uint16[C+3]=A,this.uint16[C+4]=b,l}}_a.prototype.bytesPerElement=12,Mt(_a,"StructArrayLayout1ul3ui12");class Ns extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f){const p=this.length;return this.resize(p+1),this.emplace(p,l,f)}emplace(l,f,p){const A=2*l;return this.uint16[A+0]=f,this.uint16[A+1]=p,l}}Ns.prototype.bytesPerElement=4,Mt(Ns,"StructArrayLayout2ui4");class pu extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const f=this.length;return this.resize(f+1),this.emplace(f,l)}emplace(l,f){return this.uint16[1*l+0]=f,l}}pu.prototype.bytesPerElement=2,Mt(pu,"StructArrayLayout1ui2");class Wc extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f){const p=this.length;return this.resize(p+1),this.emplace(p,l,f)}emplace(l,f,p){const A=2*l;return this.float32[A+0]=f,this.float32[A+1]=p,l}}Wc.prototype.bytesPerElement=8,Mt(Wc,"StructArrayLayout2f8");class io extends Je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}io.prototype.size=40;class Si extends hr{get(l){return new io(this,l)}}Mt(Si,"CollisionBoxArray");class ni extends Je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(l){this._structArray.uint8[this._pos1+49]=l}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(l){this._structArray.uint8[this._pos1+50]=l}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(l){this._structArray.uint32[this._pos4+13]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(l){this._structArray.uint8[this._pos1+58]=l}}ni.prototype.size=60;class Ho extends fi{get(l){return new ni(this,l)}}Mt(Ho,"PlacedSymbolArray");class ja extends Je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(l){this._structArray.uint32[this._pos4+15]=l}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ja.prototype.size=76;class Yi extends bi{get(l){return new ja(this,l)}}Mt(Yi,"SymbolInstanceArray");class ll extends wi{getoffsetX(l){return this.float32[1*l+0]}}Mt(ll,"GlyphOffsetArray");class G_ extends en{getx(l){return this.int16[2*l+0]}gety(l){return this.int16[2*l+1]}}Mt(G_,"SymbolLineVertexArray");class Ip extends Je{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ip.prototype.size=12;class $A extends _a{get(l){return new Ip(this,l)}}Mt($A,"FeatureIndexArray");class qf extends Ns{geta_centroid_pos0(l){return this.uint16[2*l+0]}geta_centroid_pos1(l){return this.uint16[2*l+1]}}Mt(qf,"FillExtrusionCentroidArray");const nd=at([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Mp=at([{name:"a_dash",components:4,type:"Uint16"}]);var j_={exports:{}},HA={exports:{}};HA.exports=function(c,l){var f,p,A,b,C,M,N,U;for(p=c.length-(f=3&c.length),A=l,C=3432918353,M=461845907,U=0;U<p;)N=255&c.charCodeAt(U)|(255&c.charCodeAt(++U))<<8|(255&c.charCodeAt(++U))<<16|(255&c.charCodeAt(++U))<<24,++U,A=27492+(65535&(b=5*(65535&(A=(A^=N=(65535&(N=(N=(65535&N)*C+(((N>>>16)*C&65535)<<16)&4294967295)<<15|N>>>17))*M+(((N>>>16)*M&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(N=0,f){case 3:N^=(255&c.charCodeAt(U+2))<<16;case 2:N^=(255&c.charCodeAt(U+1))<<8;case 1:A^=N=(65535&(N=(N=(65535&(N^=255&c.charCodeAt(U)))*C+(((N>>>16)*C&65535)<<16)&4294967295)<<15|N>>>17))*M+(((N>>>16)*M&65535)<<16)&4294967295}return A^=c.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0};var px=HA.exports,_8={exports:{}};_8.exports=function(c,l){for(var f,p=c.length,A=l^p,b=0;p>=4;)f=1540483477*(65535&(f=255&c.charCodeAt(b)|(255&c.charCodeAt(++b))<<8|(255&c.charCodeAt(++b))<<16|(255&c.charCodeAt(++b))<<24))+((1540483477*(f>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),p-=4,++b;switch(p){case 3:A^=(255&c.charCodeAt(b+2))<<16;case 2:A^=(255&c.charCodeAt(b+1))<<8;case 1:A=1540483477*(65535&(A^=255&c.charCodeAt(b)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0};var y8=px,Ufe=_8.exports;j_.exports=y8,j_.exports.murmur3=y8,j_.exports.murmur2=Ufe;var $L=k(j_.exports);class v2{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,f,p,A){this.ids.push(v8(l)),this.positions.push(f,p,A)}getPositions(l){const f=v8(l);let p=0,A=this.ids.length-1;for(;p<A;){const C=p+A>>1;this.ids[C]>=f?A=C:p=C+1}const b=[];for(;this.ids[p]===f;)b.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return b}static serialize(l,f){const p=new Float64Array(l.ids),A=new Uint32Array(l.positions);return HL(p,A,0,p.length-1),f&&f.push(p.buffer,A.buffer),{ids:p,positions:A}}static deserialize(l){const f=new v2;return f.ids=l.ids,f.positions=l.positions,f.indexed=!0,f}}function v8(c){const l=+c;return!isNaN(l)&&Number.MIN_SAFE_INTEGER<=l&&l<=Number.MAX_SAFE_INTEGER?l:$L(String(c))}function HL(c,l,f,p){for(;f<p;){const A=c[f+p>>1];let b=f-1,C=p+1;for(;;){do b++;while(c[b]<A);do C--;while(c[C]>A);if(b>=C)break;x2(c,b,C),x2(l,3*b,3*C),x2(l,3*b+1,3*C+1),x2(l,3*b+2,3*C+2)}C-f<p-C?(HL(c,l,f,C),f=C+1):(HL(c,l,C+1,p),p=C)}}function x2(c,l,f){const p=c[l];c[l]=c[f],c[f]=p}Mt(v2,"FeaturePositionMap");class Op{constructor(l){this.gl=l.gl,this.initialized=!1}fetchUniformLocation(l,f){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(l,f),this.initialized=!0),!!this.location}}class b2 extends Op{constructor(l){super(l),this.current=0}set(l,f,p){this.fetchUniformLocation(l,f)&&this.current!==p&&(this.current=p,this.gl.uniform1f(this.location,p))}}class x8 extends Op{constructor(l){super(l),this.current=[0,0,0,0]}set(l,f,p){this.fetchUniformLocation(l,f)&&(p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]&&p[3]===this.current[3]||(this.current=p,this.gl.uniform4f(this.location,p[0],p[1],p[2],p[3])))}}class b8 extends Op{constructor(l){super(l),this.current=lo.transparent}set(l,f,p){this.fetchUniformLocation(l,f)&&(p.r===this.current.r&&p.g===this.current.g&&p.b===this.current.b&&p.a===this.current.a||(this.current=p,this.gl.uniform4f(this.location,p.r,p.g,p.b,p.a)))}}const Gfe=new Float32Array(16),jfe=new Float32Array(9),Vfe=new Float32Array(4);function WL(c){return[Qe(255*c.r,255*c.g),Qe(255*c.b,255*c.a)]}class gx{constructor(l,f,p){this.value=l,this.uniformNames=f.map(A=>`u_${A}`),this.type=p}setUniform(l,f,p,A,b){f.set(l,b,A.constantOr(this.value))}getBinding(l,f){return this.type==="color"?new b8(l):new b2(l)}}class V_{constructor(l,f){this.uniformNames=f.map(p=>`u_${p}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(l){this.pixelRatio=l.pixelRatio||1,this.pattern=l.tl.concat(l.br)}setUniform(l,f,p,A,b){const C=b==="u_pattern"||b==="u_dash"?this.pattern:b==="u_pixel_ratio"?this.pixelRatio:null;C&&f.set(l,b,C)}getBinding(l,f){return f==="u_pattern"||f==="u_dash"?new x8(l):new b2(l)}}class Rp{constructor(l,f,p,A){this.expression=l,this.type=p,this.maxValue=0,this.paintVertexAttributes=f.map(b=>({name:`a_${b}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new A}populatePaintArray(l,f,p,A,b,C){const M=this.paintVertexArray.length,N=this.expression.evaluate(new Q(0),f,{},b,A,C);this.paintVertexArray.resize(l),this._setPaintValue(M,l,N)}updatePaintArray(l,f,p,A,b){const C=this.expression.evaluate({zoom:0},p,A,void 0,b);this._setPaintValue(l,f,C)}_setPaintValue(l,f,p){if(this.type==="color"){const A=WL(p);for(let b=l;b<f;b++)this.paintVertexArray.emplace(b,A[0],A[1])}else{for(let A=l;A<f;A++)this.paintVertexArray.emplace(A,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xf{constructor(l,f,p,A,b,C){this.expression=l,this.uniformNames=f.map(M=>`u_${M}_t`),this.type=p,this.useIntegerZoom=A,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=f.map(M=>({name:`a_${M}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new C}populatePaintArray(l,f,p,A,b,C){const M=this.expression.evaluate(new Q(this.zoom),f,{},b,A,C),N=this.expression.evaluate(new Q(this.zoom+1),f,{},b,A,C),U=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(U,l,M,N)}updatePaintArray(l,f,p,A,b){const C=this.expression.evaluate({zoom:this.zoom},p,A,void 0,b),M=this.expression.evaluate({zoom:this.zoom+1},p,A,void 0,b);this._setPaintValue(l,f,C,M)}_setPaintValue(l,f,p,A){if(this.type==="color"){const b=WL(p),C=WL(A);for(let M=l;M<f;M++)this.paintVertexArray.emplace(M,b[0],b[1],C[0],C[1])}else{for(let b=l;b<f;b++)this.paintVertexArray.emplace(b,p,A);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(A))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,f,p,A,b){const C=this.useIntegerZoom?Math.floor(p.zoom):p.zoom,M=Ee(this.expression.interpolationFactor(C,this.zoom,this.zoom+1),0,1);f.set(l,b,M)}getBinding(l,f){return new b2(l)}}class Yg{constructor(l,f,p,A,b){this.expression=l,this.layerId=b,this.paintVertexAttributes=(p==="array"?Mp:nd).members;for(let C=0;C<f.length;++C);this.paintVertexArray=new A}populatePaintArray(l,f,p){const A=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValues(A,l,f.patterns&&f.patterns[this.layerId],p)}updatePaintArray(l,f,p,A,b,C){this._setPaintValues(l,f,p.patterns&&p.patterns[this.layerId],C)}_setPaintValues(l,f,p,A){if(!A||!p)return;const b=A[p];if(!b)return;const{tl:C,br:M,pixelRatio:N}=b;for(let U=l;U<f;U++)this.paintVertexArray.emplace(U,C[0],C[1],M[0],M[1],N)}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qg{constructor(l,f,p=()=>!0){this.binders={},this._buffers=[];const A=[];for(const b in l.paint._values){if(!p(b))continue;const C=l.paint.get(b);if(!(C instanceof Pe&&jc(C.property.specification)))continue;const M=Hfe(b,l.type),N=C.value,U=C.property.specification.type,W=!!C.property.useIntegerZoom,K=b==="line-dasharray"||b.endsWith("pattern"),ee=b==="line-dasharray"&&l.layout.get("line-cap").value.kind!=="constant";if(N.kind!=="constant"||ee)if(N.kind==="source"||ee||K){const oe=w8(b,U,"source");this.binders[b]=K?new Yg(N,M,U,oe,l.id):new Rp(N,M,U,oe),A.push(`/a_${b}`)}else{const oe=w8(b,U,"composite");this.binders[b]=new Xf(N,M,U,W,f,oe),A.push(`/z_${b}`)}else this.binders[b]=K?new V_(N.value,M):new gx(N.value,M,U),A.push(`/u_${b}`)}this.cacheKey=A.sort().join("")}getMaxValue(l){const f=this.binders[l];return f instanceof Rp||f instanceof Xf?f.maxValue:0}populatePaintArrays(l,f,p,A,b,C){for(const M in this.binders){const N=this.binders[M];(N instanceof Rp||N instanceof Xf||N instanceof Yg)&&N.populatePaintArray(l,f,p,A,b,C)}}setConstantPatternPositions(l){for(const f in this.binders){const p=this.binders[f];p instanceof V_&&p.setConstantPatternPositions(l)}}updatePaintArrays(l,f,p,A,b,C){let M=!1;for(const N in l){const U=f.getPositions(N);for(const W of U){const K=p.feature(W.index);for(const ee in this.binders){const oe=this.binders[ee];if((oe instanceof Rp||oe instanceof Xf||oe instanceof Yg)&&oe.expression.isStateDependent===!0){const le=A.paint.get(ee);oe.expression=le.value,oe.updatePaintArray(W.start,W.end,K,l[N],b,C),M=!0}}}}return M}defines(){const l=[];for(const f in this.binders){const p=this.binders[f];(p instanceof gx||p instanceof V_)&&l.push(...p.uniformNames.map(A=>`#define HAS_UNIFORM_${A}`))}return l}getBinderAttributes(){const l=[];for(const f in this.binders){const p=this.binders[f];if(p instanceof Rp||p instanceof Xf||p instanceof Yg)for(let A=0;A<p.paintVertexAttributes.length;A++)l.push(p.paintVertexAttributes[A].name)}return l}getBinderUniforms(){const l=[];for(const f in this.binders){const p=this.binders[f];if(p instanceof gx||p instanceof V_||p instanceof Xf)for(const A of p.uniformNames)l.push(A)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l){const f=[];for(const p in this.binders){const A=this.binders[p];if(A instanceof gx||A instanceof V_||A instanceof Xf)for(const b of A.uniformNames)f.push({name:b,property:p,binding:A.getBinding(l,b)})}return f}setUniforms(l,f,p,A,b){for(const{name:C,property:M,binding:N}of p)this.binders[M].setUniform(l,N,b,A.get(M),C)}updatePaintBuffers(){this._buffers=[];for(const l in this.binders){const f=this.binders[l];(f instanceof Rp||f instanceof Xf||f instanceof Yg)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(l){for(const f in this.binders){const p=this.binders[f];(p instanceof Rp||p instanceof Xf||p instanceof Yg)&&p.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const f=this.binders[l];(f instanceof Rp||f instanceof Xf||f instanceof Yg)&&f.destroy()}}}class WA{constructor(l,f,p=()=>!0){this.programConfigurations={};for(const A of l)this.programConfigurations[A.id]=new Qg(A,f,p);this.needsUpload=!1,this._featureMap=new v2,this._bufferOffset=0}populatePaintArrays(l,f,p,A,b,C,M){for(const N in this.programConfigurations)this.programConfigurations[N].populatePaintArrays(l,f,A,b,C,M);f.id!==void 0&&this._featureMap.add(f.id,p,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,f,p,A,b){for(const C of p)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(l,this._featureMap,f,C,A,b)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const f in this.programConfigurations)this.programConfigurations[f].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}const $fe={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Hfe(c,l){return $fe[c]||[c.replace(`${l}-`,"").replace(/-/g,"_")]}const Wfe={"line-pattern":{source:vt,composite:vt},"fill-pattern":{source:vt,composite:vt},"fill-extrusion-pattern":{source:vt,composite:vt},"line-dasharray":{source:zt,composite:zt}},qfe={color:{source:Wc,composite:Kt},number:{source:wi,composite:Wc}};function w8(c,l,f){const p=Wfe[c];return p&&p[f]||qfe[l][f]}Mt(gx,"ConstantBinder"),Mt(V_,"PatternConstantBinder"),Mt(Rp,"SourceExpressionBinder"),Mt(Yg,"PatternCompositeBinder"),Mt(Xf,"CompositeExpressionBinder"),Mt(Qg,"ProgramConfiguration",{omit:["_buffers"]}),Mt(WA,"ProgramConfigurationSet");const E8="-transition";class Zf extends Ke{constructor(l,f){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&l.type!=="sky"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),f.layout&&(this._unevaluatedLayout=new Ie(f.layout)),f.paint)){this._transitionablePaint=new fe(f.paint);for(const p in l.paint)this.setPaintProperty(p,l.paint[p],{validate:!1});for(const p in l.layout)this.setLayoutProperty(p,l.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Re(f.paint)}}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,f,p={}){f!=null&&this._validate(yn,`layers.${this.id}.layout.${l}`,l,f,p)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,f):this.visibility=f)}getPaintProperty(l){return Wt(l,E8)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,f,p={}){if(f!=null&&this._validate(Vt,`layers.${this.id}.paint.${l}`,l,f,p))return!1;if(Wt(l,E8))return this._transitionablePaint.setTransition(l.slice(0,-11),f||void 0),!1;{const A=this._transitionablePaint._values[l],b=A.value.isDataDriven(),C=A.value;this._transitionablePaint.setValue(l,f),this._handleSpecialPaintPropertyUpdate(l);const M=this._transitionablePaint._values[l].value,N=M.isDataDriven(),U=Wt(l,"pattern")||l==="line-dasharray";return N||b||U||this._handleOverridablePaintPropertyUpdate(l,C,M)}}_handleSpecialPaintPropertyUpdate(l){}getProgramIds(){return null}getProgramConfiguration(l){return null}_handleOverridablePaintPropertyUpdate(l,f,p){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,f){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,f)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),lr(l,(f,p)=>!(f===void 0||p==="layout"&&!Object.keys(f).length||p==="paint"&&!Object.keys(f).length))}_validate(l,f,p,A,b={}){return(!b||b.validate!==!1)&&Rt(this,l.call(kt,{key:f,layerType:this.type,objectKey:p,value:A,styleSpec:gt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const f=this.paint.get(l);if(f instanceof Pe&&jc(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ma(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Xfe=at([{name:"a_pos",components:2,type:"Int16"}],4),Zfe=at([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Wo{constructor(l=[]){this.segments=l}prepareSegment(l,f,p,A){let b=this.segments[this.segments.length-1];return l>Wo.MAX_VERTEX_ARRAY_LENGTH&&$t(`Max vertices per segment is ${Wo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!b||b.vertexLength+l>Wo.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==A)&&(b={vertexOffset:f.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},A!==void 0&&(b.sortKey=A),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const l of this.segments)for(const f in l.vaos)l.vaos[f].destroy()}static simpleSegment(l,f,p,A){return new Wo([{vertexOffset:l,primitiveOffset:f,vertexLength:p,primitiveLength:A,vaos:{},sortKey:0}])}}Wo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Mt(Wo,"SegmentVector");var Kn=8192;class Kg{constructor(l,f){l&&(f?this.setSouthWest(l).setNorthEast(f):l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1]))}setNorthEast(l){return this._ne=l instanceof Ti?new Ti(l.lng,l.lat):Ti.convert(l),this}setSouthWest(l){return this._sw=l instanceof Ti?new Ti(l.lng,l.lat):Ti.convert(l),this}extend(l){const f=this._sw,p=this._ne;let A,b;if(l instanceof Ti)A=l,b=l;else{if(!(l instanceof Kg))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Kg.convert(l)):this.extend(Ti.convert(l)):typeof l=="object"&&l!==null&&l.hasOwnProperty("lat")&&(l.hasOwnProperty("lon")||l.hasOwnProperty("lng"))?this.extend(Ti.convert(l)):this;if(A=l._sw,b=l._ne,!A||!b)return this}return f||p?(f.lng=Math.min(A.lng,f.lng),f.lat=Math.min(A.lat,f.lat),p.lng=Math.max(b.lng,p.lng),p.lat=Math.max(b.lat,p.lat)):(this._sw=new Ti(A.lng,A.lat),this._ne=new Ti(b.lng,b.lat)),this}getCenter(){return new Ti((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ti(this.getWest(),this.getNorth())}getSouthEast(){return new Ti(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:f,lat:p}=Ti.convert(l);let A=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(A=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&A}static convert(l){return!l||l instanceof Kg?l:new Kg(l)}}var w2=1e-6,gu=typeof Float32Array<"u"?Float32Array:Array;function S8(){var c=new gu(9);return gu!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function T8(c,l,f){var p=l[0],A=l[1],b=l[2],C=l[3],M=l[4],N=l[5],U=l[6],W=l[7],K=l[8],ee=f[0],oe=f[1],le=f[2],de=f[3],xe=f[4],Le=f[5],$e=f[6],De=f[7],je=f[8];return c[0]=ee*p+oe*C+le*U,c[1]=ee*A+oe*M+le*W,c[2]=ee*b+oe*N+le*K,c[3]=de*p+xe*C+Le*U,c[4]=de*A+xe*M+Le*W,c[5]=de*b+xe*N+Le*K,c[6]=$e*p+De*C+je*U,c[7]=$e*A+De*M+je*W,c[8]=$e*b+De*N+je*K,c}function Yf(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function qL(c,l){var f=l[0],p=l[1],A=l[2],b=l[3],C=l[4],M=l[5],N=l[6],U=l[7],W=l[8],K=l[9],ee=l[10],oe=l[11],le=l[12],de=l[13],xe=l[14],Le=l[15],$e=f*M-p*C,De=f*N-A*C,je=f*U-b*C,Ze=p*N-A*M,We=p*U-b*M,bt=A*U-b*N,_t=W*de-K*le,Ft=W*xe-ee*le,tn=W*Le-oe*le,Tt=K*xe-ee*de,Gt=K*Le-oe*de,jt=ee*Le-oe*xe,Yt=$e*jt-De*Gt+je*Tt+Ze*tn-We*Ft+bt*_t;return Yt?(c[0]=(M*jt-N*Gt+U*Tt)*(Yt=1/Yt),c[1]=(A*Gt-p*jt-b*Tt)*Yt,c[2]=(de*bt-xe*We+Le*Ze)*Yt,c[3]=(ee*We-K*bt-oe*Ze)*Yt,c[4]=(N*tn-C*jt-U*Ft)*Yt,c[5]=(f*jt-A*tn+b*Ft)*Yt,c[6]=(xe*je-le*bt-Le*De)*Yt,c[7]=(W*bt-ee*je+oe*De)*Yt,c[8]=(C*Gt-M*tn+U*_t)*Yt,c[9]=(p*tn-f*Gt-b*_t)*Yt,c[10]=(le*We-de*je+Le*$e)*Yt,c[11]=(K*je-W*We-oe*$e)*Yt,c[12]=(M*Ft-C*Tt-N*_t)*Yt,c[13]=(f*Tt-p*Ft+A*_t)*Yt,c[14]=(de*De-le*Ze-xe*$e)*Yt,c[15]=(W*Ze-K*De+ee*$e)*Yt,c):null}function qA(c,l,f){var p=l[0],A=l[1],b=l[2],C=l[3],M=l[4],N=l[5],U=l[6],W=l[7],K=l[8],ee=l[9],oe=l[10],le=l[11],de=l[12],xe=l[13],Le=l[14],$e=l[15],De=f[0],je=f[1],Ze=f[2],We=f[3];return c[0]=De*p+je*M+Ze*K+We*de,c[1]=De*A+je*N+Ze*ee+We*xe,c[2]=De*b+je*U+Ze*oe+We*Le,c[3]=De*C+je*W+Ze*le+We*$e,c[4]=(De=f[4])*p+(je=f[5])*M+(Ze=f[6])*K+(We=f[7])*de,c[5]=De*A+je*N+Ze*ee+We*xe,c[6]=De*b+je*U+Ze*oe+We*Le,c[7]=De*C+je*W+Ze*le+We*$e,c[8]=(De=f[8])*p+(je=f[9])*M+(Ze=f[10])*K+(We=f[11])*de,c[9]=De*A+je*N+Ze*ee+We*xe,c[10]=De*b+je*U+Ze*oe+We*Le,c[11]=De*C+je*W+Ze*le+We*$e,c[12]=(De=f[12])*p+(je=f[13])*M+(Ze=f[14])*K+(We=f[15])*de,c[13]=De*A+je*N+Ze*ee+We*xe,c[14]=De*b+je*U+Ze*oe+We*Le,c[15]=De*C+je*W+Ze*le+We*$e,c}function mx(c,l,f){var p,A,b,C,M,N,U,W,K,ee,oe,le,de=f[0],xe=f[1],Le=f[2];return l===c?(c[12]=l[0]*de+l[4]*xe+l[8]*Le+l[12],c[13]=l[1]*de+l[5]*xe+l[9]*Le+l[13],c[14]=l[2]*de+l[6]*xe+l[10]*Le+l[14],c[15]=l[3]*de+l[7]*xe+l[11]*Le+l[15]):(A=l[1],b=l[2],C=l[3],M=l[4],N=l[5],U=l[6],W=l[7],K=l[8],ee=l[9],oe=l[10],le=l[11],c[0]=p=l[0],c[1]=A,c[2]=b,c[3]=C,c[4]=M,c[5]=N,c[6]=U,c[7]=W,c[8]=K,c[9]=ee,c[10]=oe,c[11]=le,c[12]=p*de+M*xe+K*Le+l[12],c[13]=A*de+N*xe+ee*Le+l[13],c[14]=b*de+U*xe+oe*Le+l[14],c[15]=C*de+W*xe+le*Le+l[15]),c}function XA(c,l,f){var p=f[0],A=f[1],b=f[2];return c[0]=l[0]*p,c[1]=l[1]*p,c[2]=l[2]*p,c[3]=l[3]*p,c[4]=l[4]*A,c[5]=l[5]*A,c[6]=l[6]*A,c[7]=l[7]*A,c[8]=l[8]*b,c[9]=l[9]*b,c[10]=l[10]*b,c[11]=l[11]*b,c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15],c}function XL(c,l,f){var p=Math.sin(f),A=Math.cos(f),b=l[4],C=l[5],M=l[6],N=l[7],U=l[8],W=l[9],K=l[10],ee=l[11];return l!==c&&(c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=l[3],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[4]=b*A+U*p,c[5]=C*A+W*p,c[6]=M*A+K*p,c[7]=N*A+ee*p,c[8]=U*A-b*p,c[9]=W*A-C*p,c[10]=K*A-M*p,c[11]=ee*A-N*p,c}function E2(c,l,f){var p=Math.sin(f),A=Math.cos(f),b=l[0],C=l[1],M=l[2],N=l[3],U=l[8],W=l[9],K=l[10],ee=l[11];return l!==c&&(c[4]=l[4],c[5]=l[5],c[6]=l[6],c[7]=l[7],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[0]=b*A-U*p,c[1]=C*A-W*p,c[2]=M*A-K*p,c[3]=N*A-ee*p,c[8]=b*p+U*A,c[9]=C*p+W*A,c[10]=M*p+K*A,c[11]=N*p+ee*A,c}function C8(c,l){return c[0]=l[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=l[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=l[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function P8(c,l,f){var p,A,b,C=f[0],M=f[1],N=f[2],U=Math.hypot(C,M,N);return U<w2?null:(C*=U=1/U,M*=U,N*=U,p=Math.sin(l),A=Math.cos(l),c[0]=C*C*(b=1-A)+A,c[1]=M*C*b+N*p,c[2]=N*C*b-M*p,c[3]=0,c[4]=C*M*b-N*p,c[5]=M*M*b+A,c[6]=N*M*b+C*p,c[7]=0,c[8]=C*N*b+M*p,c[9]=M*N*b-C*p,c[10]=N*N*b+A,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c)}Math.hypot||(Math.hypot=function(){for(var c=0,l=arguments.length;l--;)c+=arguments[l]*arguments[l];return Math.sqrt(c)});var Yfe=qA;function ZL(){var c=new gu(3);return gu!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function I8(c){var l=new gu(3);return l[0]=c[0],l[1]=c[1],l[2]=c[2],l}function Ax(c){return Math.hypot(c[0],c[1],c[2])}function $_(c,l,f){var p=new gu(3);return p[0]=c,p[1]=l,p[2]=f,p}function Lp(c,l,f){return c[0]=l[0]+f[0],c[1]=l[1]+f[1],c[2]=l[2]+f[2],c}function YL(c,l,f){return c[0]=l[0]-f[0],c[1]=l[1]-f[1],c[2]=l[2]-f[2],c}function M8(c,l,f){return c[0]=l[0]*f[0],c[1]=l[1]*f[1],c[2]=l[2]*f[2],c}function _x(c,l,f){return c[0]=Math.min(l[0],f[0]),c[1]=Math.min(l[1],f[1]),c[2]=Math.min(l[2],f[2]),c}function yx(c,l,f){return c[0]=Math.max(l[0],f[0]),c[1]=Math.max(l[1],f[1]),c[2]=Math.max(l[2],f[2]),c}function Ku(c,l,f){return c[0]=l[0]*f,c[1]=l[1]*f,c[2]=l[2]*f,c}function vx(c,l,f,p){return c[0]=l[0]+f[0]*p,c[1]=l[1]+f[1]*p,c[2]=l[2]+f[2]*p,c}function ul(c,l){var f=l[0],p=l[1],A=l[2],b=f*f+p*p+A*A;return b>0&&(b=1/Math.sqrt(b)),c[0]=l[0]*b,c[1]=l[1]*b,c[2]=l[2]*b,c}function qc(c,l){return c[0]*l[0]+c[1]*l[1]+c[2]*l[2]}function QL(c,l,f){var p=l[0],A=l[1],b=l[2],C=f[0],M=f[1],N=f[2];return c[0]=A*N-b*M,c[1]=b*C-p*N,c[2]=p*M-A*C,c}function Fo(c,l,f){var p=l[0],A=l[1],b=l[2],C=f[3]*p+f[7]*A+f[11]*b+f[15];return c[0]=(f[0]*p+f[4]*A+f[8]*b+f[12])/(C=C||1),c[1]=(f[1]*p+f[5]*A+f[9]*b+f[13])/C,c[2]=(f[2]*p+f[6]*A+f[10]*b+f[14])/C,c}function O8(c,l,f){var p=f[0],A=f[1],b=f[2],C=l[0],M=l[1],N=l[2],U=A*N-b*M,W=b*C-p*N,K=p*M-A*C,ee=A*K-b*W,oe=b*U-p*K,le=p*W-A*U,de=2*f[3];return W*=de,K*=de,oe*=2,le*=2,c[0]=C+(U*=de)+(ee*=2),c[1]=M+W+oe,c[2]=N+K+le,c}var xx,Qf=YL,Qfe=M8,Kfe=Ax;function R8(c,l,f){return c[0]=l[0]*f,c[1]=l[1]*f,c[2]=l[2]*f,c[3]=l[3]*f,c}function L8(c,l){var f=l[0],p=l[1],A=l[2],b=l[3],C=f*f+p*p+A*A+b*b;return C>0&&(C=1/Math.sqrt(C)),c[0]=f*C,c[1]=p*C,c[2]=A*C,c[3]=b*C,c}function ZA(c,l,f){var p=l[0],A=l[1],b=l[2],C=l[3];return c[0]=f[0]*p+f[4]*A+f[8]*b+f[12]*C,c[1]=f[1]*p+f[5]*A+f[9]*b+f[13]*C,c[2]=f[2]*p+f[6]*A+f[10]*b+f[14]*C,c[3]=f[3]*p+f[7]*A+f[11]*b+f[15]*C,c}function D8(){var c=new gu(4);return gu!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function B8(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function N8(c,l,f){f*=.5;var p=l[0],A=l[1],b=l[2],C=l[3],M=Math.sin(f),N=Math.cos(f);return c[0]=p*N+C*M,c[1]=A*N+b*M,c[2]=b*N-A*M,c[3]=C*N-p*M,c}function F8(c,l,f){f*=.5;var p=l[0],A=l[1],b=l[2],C=l[3],M=Math.sin(f),N=Math.cos(f);return c[0]=p*N-b*M,c[1]=A*N+C*M,c[2]=b*N+p*M,c[3]=C*N-A*M,c}ZL(),xx=new gu(4),gu!=Float32Array&&(xx[0]=0,xx[1]=0,xx[2]=0,xx[3]=0);var Jfe=L8;ZL(),$_(1,0,0),$_(0,1,0),D8(),D8(),S8();const ehe=at([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:k8}=ehe,z8=at([{name:"a_pos_3",components:3,type:"Int16"}]);var bx=at([{name:"a_pos",type:"Int16",components:2}]);class KL{constructor(l,f){this.pos=l,this.dir=f}intersectsPlane(l,f,p){const A=qc(f,this.dir);if(Math.abs(A)<1e-6)return!1;const b=((l[0]-this.pos[0])*f[0]+(l[1]-this.pos[1])*f[1]+(l[2]-this.pos[2])*f[2])/A;return p[0]=this.pos[0]+this.dir[0]*b,p[1]=this.pos[1]+this.dir[1]*b,p[2]=this.pos[2]+this.dir[2]*b,!0}closestPointOnSphere(l,f,p){if(function(oe,le){var de=oe[0],xe=oe[1],Le=oe[2],$e=le[0],De=le[1],je=le[2];return Math.abs(de-$e)<=w2*Math.max(1,Math.abs(de),Math.abs($e))&&Math.abs(xe-De)<=w2*Math.max(1,Math.abs(xe),Math.abs(De))&&Math.abs(Le-je)<=w2*Math.max(1,Math.abs(Le),Math.abs(je))}(this.pos,l)||f===0)return p[0]=p[1]=p[2]=0,!1;const[A,b,C]=this.dir,M=this.pos[0]-l[0],N=this.pos[1]-l[1],U=this.pos[2]-l[2],W=A*A+b*b+C*C,K=2*(M*A+N*b+U*C),ee=K*K-4*W*(M*M+N*N+U*U-f*f);if(ee<0){const oe=Math.max(-K/2,0),le=M+A*oe,de=N+b*oe,xe=U+C*oe,Le=Math.hypot(le,de,xe);return p[0]=le*f/Le,p[1]=de*f/Le,p[2]=xe*f/Le,!1}{const oe=(-K-Math.sqrt(ee))/(2*W);if(oe<0){const le=Math.hypot(M,N,U);return p[0]=M*f/le,p[1]=N*f/le,p[2]=U*f/le,!1}return p[0]=M+A*oe,p[1]=N+b*oe,p[2]=U+C*oe,!0}}}class JL{constructor(l,f,p,A,b){this.TL=l,this.TR=f,this.BR=p,this.BL=A,this.horizon=b}static fromInvProjectionMatrix(l,f,p){const A=[-1,1,1],b=[1,1,1],C=[1,-1,1],M=[-1,-1,1],N=Fo(A,A,l),U=Fo(b,b,l),W=Fo(C,C,l),K=Fo(M,M,l);return new JL(N,U,W,K,f/p)}}class e3{constructor(l,f){this.points=l,this.planes=f}static fromInvProjectionMatrix(l,f,p,A){const b=Math.pow(2,p),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(N=>{const U=ZA([],N,l),W=1/U[3]/f*b;return function(K,ee,oe){return K[0]=ee[0]*oe[0],K[1]=ee[1]*oe[1],K[2]=ee[2]*oe[2],K[3]=ee[3]*oe[3],K}(U,U,[W,W,A?1/U[3]:W,W])}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(N=>{const U=ul([],QL([],Qf([],C[N[0]],C[N[1]]),Qf([],C[N[2]],C[N[1]]))),W=-qc(U,C[N[1]]);return U.concat(W)});return new e3(C,M)}}class cl{static fromPoints(l){const f=[1/0,1/0,1/0],p=[-1/0,-1/0,-1/0];for(const A of l)_x(f,f,A),yx(p,p,A);return new cl(f,p)}static applyTransform(l,f){const p=l.getCorners();for(let A=0;A<p.length;++A)Fo(p[A],p[A],f);return cl.fromPoints(p)}constructor(l,f){this.min=l,this.max=f,this.center=Ku([],Lp([],this.min,this.max),.5)}quadrant(l){const f=[l%2==0,l<2],p=I8(this.min),A=I8(this.max);for(let b=0;b<f.length;b++)p[b]=f[b]?this.min[b]:this.center[b],A[b]=f[b]?this.center[b]:this.max[b];return A[2]=this.max[2],new cl(p,A)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}distanceZ(l){return Math.max(Math.min(this.max[2],l[2]),this.min[2])-l[2]}getCorners(){const l=this.min,f=this.max;return[[l[0],l[1],l[2]],[f[0],l[1],l[2]],[f[0],f[1],l[2]],[l[0],f[1],l[2]],[l[0],l[1],f[2]],[f[0],l[1],f[2]],[f[0],f[1],f[2]],[l[0],f[1],f[2]]]}intersects(l){const f=this.getCorners();let p=!0;for(let A=0;A<l.planes.length;A++){const b=l.planes[A];let C=0;for(let M=0;M<f.length;M++)C+=qc(b,f[M])+b[3]>=0;if(C===0)return 0;C!==f.length&&(p=!1)}if(p)return 2;for(let A=0;A<3;A++){let b=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let M=0;M<l.points.length;M++){const N=l.points[M][A]-this.min[A];b=Math.min(b,N),C=Math.max(C,N)}if(C<0||b>this.max[A]-this.min[A])return 0}return 1}}const t3=5,U8=6,rd=Kn/Math.PI/2,the=16383,YA=64,wx=[YA,32,16],Xc=-rd,Zc=rd,nhe=[new cl([Xc,Xc,Xc],[Zc,Zc,Zc]),new cl([Xc,Xc,Xc],[0,0,Zc]),new cl([0,Xc,Xc],[Zc,0,Zc]),new cl([Xc,0,Xc],[0,Zc,Zc]),new cl([0,0,Xc],[Zc,Zc,Zc])];function S2(c){return c*rd/Tx}function G8(c,l,f,p=!0){const A=Ku([],c._camera.position,c.worldSize),b=[l,f,1,1];ZA(b,b,c.pixelMatrixInverse),R8(b,b,1/b[3]);const C=ul([],Qf([],b,A)),M=c.globeMatrix,N=[M[12],M[13],M[14]],U=Qf([],N,A),W=Ax(U),K=ul([],U),ee=c.worldSize/(2*Math.PI),oe=qc(K,C),le=Math.asin(ee/W);if(le<Math.acos(oe)){if(!p)return null;const tn=[],Tt=[];Ku(tn,C,W/oe),ul(Tt,Qf(Tt,tn,U)),ul(C,Lp(C,U,Ku(C,Tt,Math.tan(le)*W)))}const de=[];new KL(A,C).closestPointOnSphere(N,ee,de);const xe=ul([],Ri(M,0)),Le=ul([],Ri(M,1)),$e=ul([],Ri(M,2)),De=qc(xe,de),je=qc(Le,de),Ze=qc($e,de),We=Ce(Math.asin(-je/ee));let bt=Ce(Math.atan2(De,Ze));bt=c.center.lng+function(tn,Tt){const Gt=(Tt-tn+180)%360-180;return Gt<-180?Gt+360:Gt}(c.center.lng,bt);const _t=od(bt),Ft=Ee(sd(We),0,1);return new X_(_t,Ft)}class rhe{constructor(l,f,p){this.a=Qf([],l,p),this.b=Qf([],f,p),this.center=p;const A=ul([],this.a),b=ul([],this.b);this.angle=Math.acos(qc(A,b))}}function n3(c,l){if(c.angle===0)return null;let f;return f=c.a[l]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[l]/c.a[l]/Math.sin(c.angle)-1/Math.tan(c.angle)),f<0||f>1?null:function(p,A,b,C){const M=Math.sin(b);return p*(Math.sin((1-C)*b)/M)+A*(Math.sin(C*b)/M)}(c.a[l],c.b[l],c.angle,Ee(f,0,1))+c.center[l]}function id(c){if(c.z<=1)return nhe[c.z+2*c.y+c.x];const l=r3(T2(c));return cl.fromPoints(l)}function QA(c,l,f){return Ku(c,c,1-f),vx(c,c,l,f)}function j8(c,l){const f=q_(l.zoom);if(f===0)return id(c);const p=T2(c),A=r3(p),b=od(p.getWest())*l.worldSize,C=od(p.getEast())*l.worldSize,M=sd(p.getNorth())*l.worldSize,N=sd(p.getSouth())*l.worldSize,U=[b,M,0],W=[C,M,0],K=[b,N,0],ee=[C,N,0],oe=qL([],l.globeMatrix);return Fo(U,U,oe),Fo(W,W,oe),Fo(K,K,oe),Fo(ee,ee,oe),A[0]=QA(A[0],K,f),A[1]=QA(A[1],ee,f),A[2]=QA(A[2],W,f),A[3]=QA(A[3],U,f),cl.fromPoints(A)}function V8(c,l,f){for(const p of c)Fo(p,p,l),Ku(p,p,f)}function ihe(c,l,f){const p=l/c.worldSize,A=c.globeMatrix;if(f.z<=1){const _t=id(f).getCorners();return V8(_t,A,p),cl.fromPoints(_t)}const b=T2(f),C=r3(b);V8(C,A,p);const M=Number.MAX_VALUE,N=[-M,-M,-M],U=[M,M,M];if(b.contains(c.center)){for(const tn of C)_x(U,U,tn),yx(N,N,tn);N[2]=0;const _t=c.point,Ft=[_t.x*p,_t.y*p,0];return _x(U,U,Ft),yx(N,N,Ft),new cl(U,N)}const W=[A[12]*p,A[13]*p,A[14]*p],K=b.getCenter(),ee=Ee(c.center.lat,-va,va),oe=Ee(K.lat,-va,va),le=od(c.center.lng),de=sd(ee);let xe=le-od(K.lng);const Le=de-sd(oe);xe>.5?xe-=1:xe<-.5&&(xe+=1);let $e=0;Math.abs(xe)>Math.abs(Le)?$e=xe>=0?1:3:($e=Le>=0?0:2,vx(W,W,[A[4]*p,A[5]*p,A[6]*p],-Math.sin(me(Le>=0?b.getSouth():b.getNorth()))*rd));const De=C[$e],je=C[($e+1)%4],Ze=new rhe(De,je,W),We=[n3(Ze,0)||De[0],n3(Ze,1)||De[1],n3(Ze,2)||De[2]],bt=q_(c.zoom);if(bt>0){const _t=function({x:tn,y:Tt,z:Gt},jt,Yt,ln,Bt){const xn=1/(1<<Gt);let zn=tn*xn,En=zn+xn,Ar=Tt*xn,un=Ar+xn,Xn=0;const _r=(zn+En)/2-ln;return _r>.5?Xn=-1:_r<-.5&&(Xn=1),zn=((zn+Xn)*jt-(ln*=jt))*Yt+ln,En=((En+Xn)*jt-ln)*Yt+ln,Ar=(Ar*jt-(Bt*=jt))*Yt+Bt,un=(un*jt-Bt)*Yt+Bt,[[zn,un,0],[En,un,0],[En,Ar,0],[zn,Ar,0]]}(f,l,c._pixelsPerMercatorPixel,le,de);for(let tn=0;tn<C.length;tn++)QA(C[tn],_t[tn],bt);const Ft=Lp([],_t[$e],_t[($e+1)%4]);Ku(Ft,Ft,.5),QA(We,Ft,bt)}for(const _t of C)_x(U,U,_t),yx(N,N,_t);return U[2]=Math.min(De[2],je[2]),_x(U,U,We),yx(N,N,We),new cl(U,N)}function T2({x:c,y:l,z:f}){const p=1/(1<<f),A=new Ti(Ju(c*p),ya((l+1)*p)),b=new Ti(Ju((c+1)*p),ya(l*p));return new Kg(A,b)}function r3(c){const l=me(c.getNorth()),f=me(c.getSouth()),p=Math.cos(l),A=Math.cos(f),b=Math.sin(l),C=Math.sin(f),M=c.getWest(),N=c.getEast();return[H_(A,C,M),H_(A,C,N),H_(p,b,N),H_(p,b,M)]}function H_(c,l,f,p=rd){return f=me(f),[c*Math.sin(f)*p,-l*p,c*Math.cos(f)*p]}function W_(c,l,f){return H_(Math.cos(me(c)),Math.sin(me(c)),l,f)}function Ex(c,l,f,p){const A=1<<f.z,b=(c/Kn+f.x)/A;return W_(ya((l/Kn+f.y)/A),Ju(b),p)}function C2({min:c,max:l}){return the/Math.max(l[0]-c[0],l[1]-c[1],l[2]-c[2])}const $8=new Float64Array(16);function Sx(c){const l=C2(c),f=C8($8,[l,l,l]);return mx(f,f,((p=[])[0]=-(A=c.min)[0],p[1]=-A[1],p[2]=-A[2],p));var p,A}function i3(c){const l=(p=c.min,(f=$8)[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=p[0],f[13]=p[1],f[14]=p[2],f[15]=1,f);var f,p;const A=1/C2(c);return XA(l,l,[A,A,A])}function H8(c,l,f,p,A){const b=function(N){const U=Kn/(2*Math.PI);return N/(2*Math.PI)/U}(f),C=[c,l,-f/(2*Math.PI)],M=Yf(new Float64Array(16));return mx(M,M,C),XA(M,M,[b,b,b]),XL(M,M,me(-A)),E2(M,M,me(-p)),M}function q_(c){return Ne(t3,U8,c)}function W8(c,l){const f=W_(l.lat,l.lng),p=function(le){const de=W_(le._center.lat,le._center.lng);let xe=QL([],$_(0,1,0),de);const Le=P8([],-le.angle,de);xe=Fo(xe,xe,Le),P8(Le,-le._pitch,xe);const $e=ul([],de);return Ku($e,$e,S2(le.cameraToCenterDistance/le.pixelsPerMeter)),Fo($e,$e,Le),Lp([],de,$e)}(c);return C=(A=YL([],p,f))[0],M=A[1],N=A[2],U=(b=f)[0],W=b[1],K=b[2],oe=(ee=Math.sqrt(C*C+M*M+N*N)*Math.sqrt(U*U+W*W+K*K))&&qc(A,b)/ee,Math.acos(Math.min(Math.max(oe,-1),1));var A,b,C,M,N,U,W,K,ee,oe}function o3(c,l){return W8(c,l)>Math.PI/2*1.01}const q8=me(85),ohe=Math.cos(q8),she=Math.sin(q8),Tx=63710088e-1,X8=2*Math.PI*Tx;class Jg{constructor(l,f){if(isNaN(l)||isNaN(f))throw new Error(`Invalid LngLat object: (${l}, ${f})`);if(this.lng=+l,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Jg(Be(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const f=Math.PI/180,p=this.lat*f,A=l.lat*f,b=Math.sin(p)*Math.sin(A)+Math.cos(p)*Math.cos(A)*Math.cos((l.lng-this.lng)*f);return Tx*Math.acos(Math.min(b,1))}toBounds(l=0){const f=360*l/40075017,p=f/Math.cos(Math.PI/180*this.lat);return new Kg(new Jg(this.lng-p,this.lat-f),new Jg(this.lng+p,this.lat+f))}toEcef(l){const f=S2(l);return W_(this.lat,this.lng,rd+f)}static convert(l){if(l instanceof Jg)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new Jg(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new Jg(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Ti=Jg;function s3(c){return X8*Math.cos(c*Math.PI/180)}function od(c){return(180+c)/360}function sd(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function Kf(c,l){return c/s3(l)}function Ju(c){return 360*c-180}function ya(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Z8(c,l){return c*s3(ya(l))}const va=85.051129;function Y8(c){return 1/Math.cos(c*Math.PI/180)}class X_{constructor(l,f,p=0){this.x=+l,this.y=+f,this.z=+p}static fromLngLat(l,f=0){const p=Ti.convert(l);return new X_(od(p.lng),sd(p.lat),Kf(f,p.lat))}toLngLat(){return new Ti(Ju(this.x),ya(this.y))}toAltitude(){return Z8(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/X8*Y8(ya(this.y))}}function a3(c,l,f,p,A,b,C,M,N){const U=(l+p)/2,W=(f+A)/2,K=new re(U,W);M(K),function(ee,oe,le,de,xe,Le){const $e=le-xe,De=de-Le;return Math.abs((de-oe)*$e-(le-ee)*De)/Math.hypot($e,De)}(K.x,K.y,b.x,b.y,C.x,C.y)>=N?(a3(c,l,f,U,W,b,K,M,N),a3(c,U,W,p,A,K,C,M,N)):c.push(C)}function Q8(c,l,f){let p=c[0],A=p.x,b=p.y;l(p);const C=[p];for(let M=1;M<c.length;M++){const N=c[M],{x:U,y:W}=N;l(N),a3(C,A,b,U,W,p,N,l,f),A=U,b=W,p=N}return C}function l3(c,l,f,p){if(p(l,f)){const A=l.add(f)._mult(.5);l3(c,l,A,p),l3(c,A,f,p)}else c.push(f)}function ahe(c,l){let f=c[0];const p=[f];for(let A=1;A<c.length;A++){const b=c[A];l3(p,f,b,l),f=b}return p}const u3=Math.pow(2,14)-1,K8=-u3-1;function lhe(c,l){const f=Math.round(c.x*l),p=Math.round(c.y*l);return c.x=Ee(f,K8,u3),c.y=Ee(p,K8,u3),(f<c.x||f>c.x+1||p<c.y||p>c.y+1)&&$t("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function Dp(c,l,f){const p=c.loadGeometry(),A=c.extent,b=Kn/A;if(l&&f&&f.projection.isReprojectedInTileSpace){const C=1<<l.z,{scale:M,x:N,y:U,projection:W}=f,K=ee=>{const oe=Ju((l.x+ee.x/A)/C),le=ya((l.y+ee.y/A)/C),de=W.project(oe,le);ee.x=(de.x*M-N)*A,ee.y=(de.y*M-U)*A};for(let ee=0;ee<p.length;ee++)if(c.type!==1)p[ee]=Q8(p[ee],K,1);else{const oe=[];for(const le of p[ee])le.x<0||le.x>=A||le.y<0||le.y>=A||(K(le),oe.push(le));p[ee]=oe}}for(const C of p)for(const M of C)lhe(M,b);return p}function KA(c,l){return{type:c.type,id:c.id,properties:c.properties,geometry:l?Dp(c):[]}}function P2(c,l,f,p,A){c.emplaceBack(2*l+(p+1)/2,2*f+(A+1)/2)}function I2(c,l,f){c.emplaceBack(l.x,l.y,l.z,f[0]*16384,f[1]*16384,f[2]*16384)}class c3{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.projection=l.projection,this.layoutVertexArray=new en,this.indexArray=new Vn,this.segments=new Wo,this.programConfigurations=new WA(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,p,A){const b=this.layers[0],C=[];let M=null;b.type==="circle"&&(M=b.layout.get("circle-sort-key"));for(const{feature:U,id:W,index:K,sourceLayerIndex:ee}of l){const oe=this.layers[0]._featureFilter.needGeometry,le=KA(U,oe);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),le,p))continue;const de=M?M.evaluate(le,{},p):void 0,xe={id:W,properties:U.properties,type:U.type,sourceLayerIndex:ee,index:K,geometry:oe?le.geometry:Dp(U,p,A),patterns:{},sortKey:de};C.push(xe)}M&&C.sort((U,W)=>U.sortKey-W.sortKey);let N=null;A.projection.name==="globe"&&(this.globeExtVertexArray=new nn,N=A.projection);for(const U of C){const{geometry:W,index:K,sourceLayerIndex:ee}=U,oe=l[K].feature;this.addFeature(U,W,K,f.availableImages,p,N),f.featureIndex.insert(oe,W,K,ee,this.index)}}update(l,f,p,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,p,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Xfe.members),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=l.createVertexBuffer(this.globeExtVertexArray,Zfe.members))),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(l,f,p,A,b,C){for(const M of f)for(const N of M){const U=N.x,W=N.y;if(U<0||U>=Kn||W<0||W>=Kn)continue;if(C){const oe=C.projectTilePoint(U,W,b),le=C.upVector(b,U,W),de=this.globeExtVertexArray;I2(de,oe,le),I2(de,oe,le),I2(de,oe,le),I2(de,oe,le)}const K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),ee=K.vertexLength;P2(this.layoutVertexArray,U,W,-1,-1),P2(this.layoutVertexArray,U,W,1,-1),P2(this.layoutVertexArray,U,W,1,1),P2(this.layoutVertexArray,U,W,-1,1),this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+2,ee+3),K.vertexLength+=4,K.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,{},A,b)}}function J8(c,l){for(let f=0;f<c.length;f++)if(JA(l,c[f]))return!0;for(let f=0;f<l.length;f++)if(JA(c,l[f]))return!0;return!!f3(c,l)}function uhe(c,l,f){return!!JA(c,l)||!!h3(l,c,f)}function eG(c,l){if(c.length===1)return nG(l,c[0]);for(let f=0;f<l.length;f++){const p=l[f];for(let A=0;A<p.length;A++)if(JA(c,p[A]))return!0}for(let f=0;f<c.length;f++)if(nG(l,c[f]))return!0;for(let f=0;f<l.length;f++)if(f3(c,l[f]))return!0;return!1}function che(c,l,f){if(c.length>1){if(f3(c,l))return!0;for(let p=0;p<l.length;p++)if(h3(l[p],c,f))return!0}for(let p=0;p<c.length;p++)if(h3(c[p],l,f))return!0;return!1}function f3(c,l){if(c.length===0||l.length===0)return!1;for(let f=0;f<c.length-1;f++){const p=c[f],A=c[f+1];for(let b=0;b<l.length-1;b++)if(fhe(p,A,l[b],l[b+1]))return!0}return!1}function fhe(c,l,f,p){return cn(c,f,p)!==cn(l,f,p)&&cn(c,l,f)!==cn(c,l,p)}function h3(c,l,f){const p=f*f;if(l.length===1)return c.distSqr(l[0])<p;for(let A=1;A<l.length;A++)if(tG(c,l[A-1],l[A])<p)return!0;return!1}function tG(c,l,f){const p=l.distSqr(f);if(p===0)return c.distSqr(l);const A=((c.x-l.x)*(f.x-l.x)+(c.y-l.y)*(f.y-l.y))/p;return c.distSqr(A<0?l:A>1?f:f.sub(l)._mult(A)._add(l))}function nG(c,l){let f,p,A,b=!1;for(let C=0;C<c.length;C++){f=c[C];for(let M=0,N=f.length-1;M<f.length;N=M++)p=f[M],A=f[N],p.y>l.y!=A.y>l.y&&l.x<(A.x-p.x)*(l.y-p.y)/(A.y-p.y)+p.x&&(b=!b)}return b}function JA(c,l){let f=!1;for(let p=0,A=c.length-1;p<c.length;A=p++){const b=c[p],C=c[A];b.y>l.y!=C.y>l.y&&l.x<(C.x-b.x)*(l.y-b.y)/(C.y-b.y)+b.x&&(f=!f)}return f}function rG(c,l,f,p,A){for(const C of c)if(l<=C.x&&f<=C.y&&p>=C.x&&A>=C.y)return!0;const b=[new re(l,f),new re(l,A),new re(p,A),new re(p,f)];if(c.length>2){for(const C of b)if(JA(c,C))return!0}for(let C=0;C<c.length-1;C++)if(hhe(c[C],c[C+1],b))return!0;return!1}function hhe(c,l,f){const p=f[0],A=f[2];if(c.x<p.x&&l.x<p.x||c.x>A.x&&l.x>A.x||c.y<p.y&&l.y<p.y||c.y>A.y&&l.y>A.y)return!1;const b=cn(c,l,f[0]);return b!==cn(c,l,f[1])||b!==cn(c,l,f[2])||b!==cn(c,l,f[3])}function Z_(c,l,f){const p=l.paint.get(c).value;return p.kind==="constant"?p.value:f.programConfigurations.get(l.id).getMaxValue(c)}function M2(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function iG(c,l,f,p,A){if(!l[0]&&!l[1])return c;const b=re.convert(l)._mult(A);f==="viewport"&&b._rotate(-p);const C=[];for(let M=0;M<c.length;M++)C.push(c[M].sub(b));return C}function oG(c,l,f,p){const A=re.convert(c)._mult(p);return l==="viewport"&&A._rotate(-f),A}Mt(c3,"CircleBucket",{omit:["layers"]});const dhe=new ke({"circle-sort-key":new Se(gt.layout_circle["circle-sort-key"])});var phe={paint:new ke({"circle-radius":new Se(gt.paint_circle["circle-radius"]),"circle-color":new Se(gt.paint_circle["circle-color"]),"circle-blur":new Se(gt.paint_circle["circle-blur"]),"circle-opacity":new Se(gt.paint_circle["circle-opacity"]),"circle-translate":new he(gt.paint_circle["circle-translate"]),"circle-translate-anchor":new he(gt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new he(gt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new he(gt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Se(gt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Se(gt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Se(gt.paint_circle["circle-stroke-opacity"])}),layout:dhe};function sG(c,l,f,p,A,b,C,M,N){if(b&&c.queryGeometry.isAboveHorizon)return!1;b&&(N*=c.pixelToTileUnitsFactor);const U=c.tileID.canonical,W=f.projection.upVectorScale(U,f.center.lat,f.worldSize).metersToTile;for(const K of l)for(const ee of K){const oe=ee.add(M),le=A&&f.elevation?f.elevation.exaggeration()*A.getElevationAt(oe.x,oe.y,!0):0,de=f.projection.projectTilePoint(oe.x,oe.y,U);if(le>0){const De=f.projection.upVector(U,oe.x,oe.y);de.x+=De[0]*W*le,de.y+=De[1]*W*le,de.z+=De[2]*W*le}const xe=b?oe:ghe(de.x,de.y,de.z,p),Le=b?c.tilespaceRays.map(De=>Ahe(De,le)):c.queryGeometry.screenGeometry,$e=ZA([],[de.x,de.y,de.z,1],p);if(!C&&b?N*=$e[3]/f.cameraToCenterDistance:C&&!b&&(N*=f.cameraToCenterDistance/$e[3]),b){const De=ya((ee.y/Kn+U.y)/(1<<U.z));N/=f.projection.pixelsPerMeter(De,1)/Kf(1,De)}if(uhe(Le,xe,N))return!0}return!1}function ghe(c,l,f,p){const A=ZA([],[c,l,f,1],p);return new re(A[0]/A[3],A[1]/A[3])}const aG=$_(0,0,0),mhe=$_(0,0,1);function Ahe(c,l){const f=ZL();return aG[2]=l,c.intersectsPlane(aG,mhe,f),new re(f[0],f[1])}class lG extends c3{}function uG(c,{width:l,height:f},p,A){if(A){if(A instanceof Uint8ClampedArray)A=new Uint8Array(A.buffer);else if(A.length!==l*f*p)throw new RangeError("mismatched image size")}else A=new Uint8Array(l*f*p);return c.width=l,c.height=f,c.data=A,c}function cG(c,l,f){const{width:p,height:A}=l;p===c.width&&A===c.height||(d3(c,l,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,p),height:Math.min(c.height,A)},f),c.width=p,c.height=A,c.data=l.data)}function d3(c,l,f,p,A,b){if(A.width===0||A.height===0)return l;if(A.width>c.width||A.height>c.height||f.x>c.width-A.width||f.y>c.height-A.height)throw new RangeError("out of range source coordinates for image copy");if(A.width>l.width||A.height>l.height||p.x>l.width-A.width||p.y>l.height-A.height)throw new RangeError("out of range destination coordinates for image copy");const C=c.data,M=l.data;for(let N=0;N<A.height;N++){const U=((f.y+N)*c.width+f.x)*b,W=((p.y+N)*l.width+p.x)*b;for(let K=0;K<A.width*b;K++)M[W+K]=C[U+K]}return l}Mt(lG,"HeatmapBucket",{omit:["layers"]});class Bp{constructor(l,f){uG(this,l,1,f)}resize(l){cG(this,new Bp(l),1)}clone(){return new Bp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,f,p,A,b){d3(l,f,p,A,b,1)}}class mu{constructor(l,f){uG(this,l,4,f)}resize(l){cG(this,new mu(l),4)}replace(l,f){f?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new mu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,f,p,A,b){d3(l,f,p,A,b,4)}}Mt(Bp,"AlphaImage"),Mt(mu,"RGBAImage");var _he={paint:new ke({"heatmap-radius":new Se(gt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Se(gt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new he(gt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Fe(gt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new he(gt.paint_heatmap["heatmap-opacity"])})};function p3(c){const l={},f=c.resolution||256,p=c.clips?c.clips.length:1,A=c.image||new mu({width:f,height:p}),b=(C,M,N)=>{l[c.evaluationKey]=N;const U=c.expression.evaluate(l);A.data[C+M+0]=Math.floor(255*U.r/U.a),A.data[C+M+1]=Math.floor(255*U.g/U.a),A.data[C+M+2]=Math.floor(255*U.b/U.a),A.data[C+M+3]=Math.floor(255*U.a)};if(c.clips)for(let C=0,M=0;C<p;++C,M+=4*f)for(let N=0,U=0;N<f;N++,U+=4){const W=N/(f-1),{start:K,end:ee}=c.clips[C];b(M,U,K*(1-W)+ee*W)}else for(let C=0,M=0;C<f;C++,M+=4)b(0,M,C/(f-1));return A}var yhe={paint:new ke({"hillshade-illumination-direction":new he(gt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new he(gt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new he(gt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new he(gt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new he(gt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new he(gt.paint_hillshade["hillshade-accent-color"])})};const vhe=at([{name:"a_pos",components:2,type:"Int16"}],4),{members:xhe}=vhe;var g3={exports:{}};function O2(c,l,f){f=f||2;var p,A,b,C,M,N,U,W=l&&l.length,K=W?l[0]*f:c.length,ee=fG(c,0,K,f,!0),oe=[];if(!ee||ee.next===ee.prev)return oe;if(W&&(ee=function(de,xe,Le,$e){var De,je,Ze,We=[];for(De=0,je=xe.length;De<je;De++)(Ze=fG(de,xe[De]*$e,De<je-1?xe[De+1]*$e:de.length,$e,!1))===Ze.next&&(Ze.steiner=!0),We.push(Ihe(Ze));for(We.sort(The),De=0;De<We.length;De++)Le=Che(We[De],Le);return Le}(c,l,ee,f)),c.length>80*f){p=b=c[0],A=C=c[1];for(var le=f;le<K;le+=f)(M=c[le])<p&&(p=M),(N=c[le+1])<A&&(A=N),M>b&&(b=M),N>C&&(C=N);U=(U=Math.max(b-p,C-A))!==0?32767/U:0}return Cx(ee,oe,f,p,A,U,0),oe}function fG(c,l,f,p,A){var b,C;if(A===_3(c,l,f,p)>0)for(b=l;b<f;b+=p)C=pG(b,c[b],c[b+1],C);else for(b=f-p;b>=l;b-=p)C=pG(b,c[b],c[b+1],C);return C&&R2(C,C.next)&&(Ix(C),C=C.next),C}function e0(c,l){if(!c)return c;l||(l=c);var f,p=c;do if(f=!1,p.steiner||!R2(p,p.next)&&qo(p.prev,p,p.next)!==0)p=p.next;else{if(Ix(p),(p=l=p.prev)===p.next)break;f=!0}while(f||p!==l);return l}function Cx(c,l,f,p,A,b,C){if(c){!C&&b&&function(W,K,ee,oe){var le=W;do le.z===0&&(le.z=m3(le.x,le.y,K,ee,oe)),le.prevZ=le.prev,le.nextZ=le.next,le=le.next;while(le!==W);le.prevZ.nextZ=null,le.prevZ=null,function(de){var xe,Le,$e,De,je,Ze,We,bt,_t=1;do{for(Le=de,de=null,je=null,Ze=0;Le;){for(Ze++,$e=Le,We=0,xe=0;xe<_t&&(We++,$e=$e.nextZ);xe++);for(bt=_t;We>0||bt>0&&$e;)We!==0&&(bt===0||!$e||Le.z<=$e.z)?(De=Le,Le=Le.nextZ,We--):(De=$e,$e=$e.nextZ,bt--),je?je.nextZ=De:de=De,De.prevZ=je,je=De;Le=$e}je.nextZ=null,_t*=2}while(Ze>1)}(le)}(c,p,A,b);for(var M,N,U=c;c.prev!==c.next;)if(M=c.prev,N=c.next,b?whe(c,p,A,b):bhe(c))l.push(M.i/f|0),l.push(c.i/f|0),l.push(N.i/f|0),Ix(c),c=N.next,U=N.next;else if((c=N)===U){C?C===1?Cx(c=Ehe(e0(c),l,f),l,f,p,A,b,2):C===2&&She(c,l,f,p,A,b):Cx(e0(c),l,f,p,A,b,1);break}}}function bhe(c){var l=c.prev,f=c,p=c.next;if(qo(l,f,p)>=0)return!1;for(var A=l.x,b=f.x,C=p.x,M=l.y,N=f.y,U=p.y,W=A<b?A<C?A:C:b<C?b:C,K=M<N?M<U?M:U:N<U?N:U,ee=A>b?A>C?A:C:b>C?b:C,oe=M>N?M>U?M:U:N>U?N:U,le=p.next;le!==l;){if(le.x>=W&&le.x<=ee&&le.y>=K&&le.y<=oe&&Y_(A,M,b,N,C,U,le.x,le.y)&&qo(le.prev,le,le.next)>=0)return!1;le=le.next}return!0}function whe(c,l,f,p){var A=c.prev,b=c,C=c.next;if(qo(A,b,C)>=0)return!1;for(var M=A.x,N=b.x,U=C.x,W=A.y,K=b.y,ee=C.y,oe=M<N?M<U?M:U:N<U?N:U,le=W<K?W<ee?W:ee:K<ee?K:ee,de=M>N?M>U?M:U:N>U?N:U,xe=W>K?W>ee?W:ee:K>ee?K:ee,Le=m3(oe,le,l,f,p),$e=m3(de,xe,l,f,p),De=c.prevZ,je=c.nextZ;De&&De.z>=Le&&je&&je.z<=$e;){if(De.x>=oe&&De.x<=de&&De.y>=le&&De.y<=xe&&De!==A&&De!==C&&Y_(M,W,N,K,U,ee,De.x,De.y)&&qo(De.prev,De,De.next)>=0||(De=De.prevZ,je.x>=oe&&je.x<=de&&je.y>=le&&je.y<=xe&&je!==A&&je!==C&&Y_(M,W,N,K,U,ee,je.x,je.y)&&qo(je.prev,je,je.next)>=0))return!1;je=je.nextZ}for(;De&&De.z>=Le;){if(De.x>=oe&&De.x<=de&&De.y>=le&&De.y<=xe&&De!==A&&De!==C&&Y_(M,W,N,K,U,ee,De.x,De.y)&&qo(De.prev,De,De.next)>=0)return!1;De=De.prevZ}for(;je&&je.z<=$e;){if(je.x>=oe&&je.x<=de&&je.y>=le&&je.y<=xe&&je!==A&&je!==C&&Y_(M,W,N,K,U,ee,je.x,je.y)&&qo(je.prev,je,je.next)>=0)return!1;je=je.nextZ}return!0}function Ehe(c,l,f){var p=c;do{var A=p.prev,b=p.next.next;!R2(A,b)&&hG(A,p,p.next,b)&&Px(A,b)&&Px(b,A)&&(l.push(A.i/f|0),l.push(p.i/f|0),l.push(b.i/f|0),Ix(p),Ix(p.next),p=c=b),p=p.next}while(p!==c);return e0(p)}function She(c,l,f,p,A,b){var C=c;do{for(var M=C.next.next;M!==C.prev;){if(C.i!==M.i&&Mhe(C,M)){var N=dG(C,M);return C=e0(C,C.next),N=e0(N,N.next),Cx(C,l,f,p,A,b,0),void Cx(N,l,f,p,A,b,0)}M=M.next}C=C.next}while(C!==c)}function The(c,l){return c.x-l.x}function Che(c,l){var f=function(A,b){var C,M=b,N=A.x,U=A.y,W=-1/0;do{if(U<=M.y&&U>=M.next.y&&M.next.y!==M.y){var K=M.x+(U-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(K<=N&&K>W&&(W=K,C=M.x<M.next.x?M:M.next,K===N))return C}M=M.next}while(M!==b);if(!C)return null;var ee,oe=C,le=C.x,de=C.y,xe=1/0;M=C;do N>=M.x&&M.x>=le&&N!==M.x&&Y_(U<de?N:W,U,le,de,U<de?W:N,U,M.x,M.y)&&(ee=Math.abs(U-M.y)/(N-M.x),Px(M,A)&&(ee<xe||ee===xe&&(M.x>C.x||M.x===C.x&&Phe(C,M)))&&(C=M,xe=ee)),M=M.next;while(M!==oe);return C}(c,l);if(!f)return l;var p=dG(f,c);return e0(p,p.next),e0(f,f.next)}function Phe(c,l){return qo(c.prev,c,l.prev)<0&&qo(l.next,c,c.next)<0}function m3(c,l,f,p,A){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-f)*A|0)|c<<8))|c<<4))|c<<2))|c<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-p)*A|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function Ihe(c){var l=c,f=c;do(l.x<f.x||l.x===f.x&&l.y<f.y)&&(f=l),l=l.next;while(l!==c);return f}function Y_(c,l,f,p,A,b,C,M){return(A-C)*(l-M)>=(c-C)*(b-M)&&(c-C)*(p-M)>=(f-C)*(l-M)&&(f-C)*(b-M)>=(A-C)*(p-M)}function Mhe(c,l){return c.next.i!==l.i&&c.prev.i!==l.i&&!function(f,p){var A=f;do{if(A.i!==f.i&&A.next.i!==f.i&&A.i!==p.i&&A.next.i!==p.i&&hG(A,A.next,f,p))return!0;A=A.next}while(A!==f);return!1}(c,l)&&(Px(c,l)&&Px(l,c)&&function(f,p){var A=f,b=!1,C=(f.x+p.x)/2,M=(f.y+p.y)/2;do A.y>M!=A.next.y>M&&A.next.y!==A.y&&C<(A.next.x-A.x)*(M-A.y)/(A.next.y-A.y)+A.x&&(b=!b),A=A.next;while(A!==f);return b}(c,l)&&(qo(c.prev,c,l.prev)||qo(c,l.prev,l))||R2(c,l)&&qo(c.prev,c,c.next)>0&&qo(l.prev,l,l.next)>0)}function qo(c,l,f){return(l.y-c.y)*(f.x-l.x)-(l.x-c.x)*(f.y-l.y)}function R2(c,l){return c.x===l.x&&c.y===l.y}function hG(c,l,f,p){var A=D2(qo(c,l,f)),b=D2(qo(c,l,p)),C=D2(qo(f,p,c)),M=D2(qo(f,p,l));return A!==b&&C!==M||!(A!==0||!L2(c,f,l))||!(b!==0||!L2(c,p,l))||!(C!==0||!L2(f,c,p))||!(M!==0||!L2(f,l,p))}function L2(c,l,f){return l.x<=Math.max(c.x,f.x)&&l.x>=Math.min(c.x,f.x)&&l.y<=Math.max(c.y,f.y)&&l.y>=Math.min(c.y,f.y)}function D2(c){return c>0?1:c<0?-1:0}function Px(c,l){return qo(c.prev,c,c.next)<0?qo(c,l,c.next)>=0&&qo(c,c.prev,l)>=0:qo(c,l,c.prev)<0||qo(c,c.next,l)<0}function dG(c,l){var f=new A3(c.i,c.x,c.y),p=new A3(l.i,l.x,l.y),A=c.next,b=l.prev;return c.next=l,l.prev=c,f.next=A,A.prev=f,p.next=f,f.prev=p,b.next=p,p.prev=b,p}function pG(c,l,f,p){var A=new A3(c,l,f);return p?(A.next=p.next,A.prev=p,p.next.prev=A,p.next=A):(A.prev=A,A.next=A),A}function Ix(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function A3(c,l,f){this.i=c,this.x=l,this.y=f,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _3(c,l,f,p){for(var A=0,b=l,C=f-p;b<f;b+=p)A+=(c[C]-c[b])*(c[b+1]+c[C+1]),C=b;return A}g3.exports=O2,g3.exports.default=O2,O2.deviation=function(c,l,f,p){var A=l&&l.length,b=Math.abs(_3(c,0,A?l[0]*f:c.length,f));if(A)for(var C=0,M=l.length;C<M;C++)b-=Math.abs(_3(c,l[C]*f,C<M-1?l[C+1]*f:c.length,f));var N=0;for(C=0;C<p.length;C+=3){var U=p[C]*f,W=p[C+1]*f,K=p[C+2]*f;N+=Math.abs((c[U]-c[K])*(c[W+1]-c[U+1])-(c[U]-c[W])*(c[K+1]-c[U+1]))}return b===0&&N===0?0:Math.abs((N-b)/b)},O2.flatten=function(c){for(var l=c[0][0].length,f={vertices:[],holes:[],dimensions:l},p=0,A=0;A<c.length;A++){for(var b=0;b<c[A].length;b++)for(var C=0;C<l;C++)f.vertices.push(c[A][b][C]);A>0&&f.holes.push(p+=c[A-1].length)}return f};var y3=k(g3.exports);function Ohe(c,l,f,p,A){gG(c,l,f||0,p||c.length-1,A||Rhe)}function gG(c,l,f,p,A){for(;p>f;){if(p-f>600){var b=p-f+1,C=l-f+1,M=Math.log(b),N=.5*Math.exp(2*M/3),U=.5*Math.sqrt(M*N*(b-N)/b)*(C-b/2<0?-1:1);gG(c,l,Math.max(f,Math.floor(l-C*N/b+U)),Math.min(p,Math.floor(l+(b-C)*N/b+U)),A)}var W=c[l],K=f,ee=p;for(Mx(c,f,l),A(c[p],W)>0&&Mx(c,f,p);K<ee;){for(Mx(c,K,ee),K++,ee--;A(c[K],W)<0;)K++;for(;A(c[ee],W)>0;)ee--}A(c[f],W)===0?Mx(c,f,ee):Mx(c,++ee,p),ee<=l&&(f=ee+1),l<=ee&&(p=ee-1)}}function Mx(c,l,f){var p=c[l];c[l]=c[f],c[f]=p}function Rhe(c,l){return c<l?-1:c>l?1:0}function v3(c,l){const f=c.length;if(f<=1)return[c];const p=[];let A,b;for(let C=0;C<f;C++){const M=Jt(c[C]);M!==0&&(c[C].area=Math.abs(M),b===void 0&&(b=M<0),b===M<0?(A&&p.push(A),A=[c[C]]):A.push(c[C]))}if(A&&p.push(A),l>1)for(let C=0;C<p.length;C++)p[C].length<=l||(Ohe(p[C],l,1,p[C].length-1,Lhe),p[C]=p[C].slice(0,l));return p}function Lhe(c,l){return l.area-c.area}function x3(c,l,f){const p=f.patternDependencies;let A=!1;for(const b of l){const C=b.paint.get(`${c}-pattern`);C.isConstant()||(A=!0);const M=C.constantOr(null);M&&(A=!0,p[M]=!0)}return A}function b3(c,l,f,p,A){const b=A.patternDependencies;for(const C of l){const M=C.paint.get(`${c}-pattern`).value;if(M.kind!=="constant"){let N=M.evaluate({zoom:p},f,{},A.availableImages);N=N&&N.name?N.name:N,b[N]=!0,f.patterns[C.id]=N}}return f}class B2{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new en,this.indexArray=new Vn,this.indexArray2=new Ns,this.programConfigurations=new WA(l.layers,l.zoom),this.segments=new Wo,this.segments2=new Wo,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.projection=l.projection}populate(l,f,p,A){this.hasPattern=x3("fill",this.layers,f);const b=this.layers[0].layout.get("fill-sort-key"),C=[];for(const{feature:M,id:N,index:U,sourceLayerIndex:W}of l){const K=this.layers[0]._featureFilter.needGeometry,ee=KA(M,K);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),ee,p))continue;const oe=b?b.evaluate(ee,{},p,f.availableImages):void 0,le={id:N,properties:M.properties,type:M.type,sourceLayerIndex:W,index:U,geometry:K?ee.geometry:Dp(M,p,A),patterns:{},sortKey:oe};C.push(le)}b&&C.sort((M,N)=>M.sortKey-N.sortKey);for(const M of C){const{geometry:N,index:U,sourceLayerIndex:W}=M;if(this.hasPattern){const K=b3("fill",this.layers,M,this.zoom,f);this.patternFeatures.push(K)}else this.addFeature(M,N,U,p,{},f.availableImages);f.featureIndex.insert(l[U].feature,N,U,W,this.index)}}update(l,f,p,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,p,A)}addFeatures(l,f,p,A,b){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,f,p,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,xhe),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,f,p,A,b,C=[]){for(const M of v3(f,500)){let N=0;for(const le of M)N+=le.length;const U=this.segments.prepareSegment(N,this.layoutVertexArray,this.indexArray),W=U.vertexLength,K=[],ee=[];for(const le of M){if(le.length===0)continue;le!==M[0]&&ee.push(K.length/2);const de=this.segments2.prepareSegment(le.length,this.layoutVertexArray,this.indexArray2),xe=de.vertexLength;this.layoutVertexArray.emplaceBack(le[0].x,le[0].y),this.indexArray2.emplaceBack(xe+le.length-1,xe),K.push(le[0].x),K.push(le[0].y);for(let Le=1;Le<le.length;Le++)this.layoutVertexArray.emplaceBack(le[Le].x,le[Le].y),this.indexArray2.emplaceBack(xe+Le-1,xe+Le),K.push(le[Le].x),K.push(le[Le].y);de.vertexLength+=le.length,de.primitiveLength+=le.length}const oe=y3(K,ee);for(let le=0;le<oe.length;le+=3)this.indexArray.emplaceBack(W+oe[le],W+oe[le+1],W+oe[le+2]);U.vertexLength+=N,U.primitiveLength+=oe.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,b,C,A)}}Mt(B2,"FillBucket",{omit:["layers","patternFeatures"]});const Dhe=new ke({"fill-sort-key":new Se(gt.layout_fill["fill-sort-key"])});var Bhe={paint:new ke({"fill-antialias":new he(gt.paint_fill["fill-antialias"]),"fill-opacity":new Se(gt.paint_fill["fill-opacity"]),"fill-color":new Se(gt.paint_fill["fill-color"]),"fill-outline-color":new Se(gt.paint_fill["fill-outline-color"]),"fill-translate":new he(gt.paint_fill["fill-translate"]),"fill-translate-anchor":new he(gt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Se(gt.paint_fill["fill-pattern"])}),layout:Dhe};const Nhe=at([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Fhe=at([{name:"a_centroid_pos",components:2,type:"Uint16"}]),khe=at([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:zhe}=Nhe;var N2={},Uhe=ie,mG=Q_;function Q_(c,l,f,p,A){this.properties={},this.extent=f,this.type=0,this._pbf=c,this._geometry=-1,this._keys=p,this._values=A,c.readFields(Ghe,this,l)}function Ghe(c,l,f){c==1?l.id=f.readVarint():c==2?function(p,A){for(var b=p.readVarint()+p.pos;p.pos<b;){var C=A._keys[p.readVarint()],M=A._values[p.readVarint()];A.properties[C]=M}}(f,l):c==3?l.type=f.readVarint():c==4&&(l._geometry=f.pos)}function jhe(c){for(var l,f,p=0,A=0,b=c.length,C=b-1;A<b;C=A++)p+=((f=c[C]).x-(l=c[A]).x)*(l.y+f.y);return p}Q_.types=["Unknown","Point","LineString","Polygon"],Q_.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var l,f=c.readVarint()+c.pos,p=1,A=0,b=0,C=0,M=[];c.pos<f;){if(A<=0){var N=c.readVarint();p=7&N,A=N>>3}if(A--,p===1||p===2)b+=c.readSVarint(),C+=c.readSVarint(),p===1&&(l&&M.push(l),l=[]),l.push(new Uhe(b,C));else{if(p!==7)throw new Error("unknown command "+p);l&&l.push(l[0].clone())}}return l&&M.push(l),M},Q_.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var l=c.readVarint()+c.pos,f=1,p=0,A=0,b=0,C=1/0,M=-1/0,N=1/0,U=-1/0;c.pos<l;){if(p<=0){var W=c.readVarint();f=7&W,p=W>>3}if(p--,f===1||f===2)(A+=c.readSVarint())<C&&(C=A),A>M&&(M=A),(b+=c.readSVarint())<N&&(N=b),b>U&&(U=b);else if(f!==7)throw new Error("unknown command "+f)}return[C,N,M,U]},Q_.prototype.toGeoJSON=function(c,l,f){var p,A,b=this.extent*Math.pow(2,f),C=this.extent*c,M=this.extent*l,N=this.loadGeometry(),U=Q_.types[this.type];function W(oe){for(var le=0;le<oe.length;le++){var de=oe[le];oe[le]=[360*(de.x+C)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(de.y+M)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(p=0;p<N.length;p++)K[p]=N[p][0];W(N=K);break;case 2:for(p=0;p<N.length;p++)W(N[p]);break;case 3:for(N=function(oe){var le=oe.length;if(le<=1)return[oe];for(var de,xe,Le=[],$e=0;$e<le;$e++){var De=jhe(oe[$e]);De!==0&&(xe===void 0&&(xe=De<0),xe===De<0?(de&&Le.push(de),de=[oe[$e]]):de.push(oe[$e]))}return de&&Le.push(de),Le}(N),p=0;p<N.length;p++)for(A=0;A<N[p].length;A++)W(N[p][A])}N.length===1?N=N[0]:U="Multi"+U;var ee={type:"Feature",geometry:{type:U,coordinates:N},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var Vhe=mG,AG=_G;function _G(c,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields($he,this,l),this.length=this._features.length}function $he(c,l,f){c===15?l.version=f.readVarint():c===1?l.name=f.readString():c===5?l.extent=f.readVarint():c===2?l._features.push(f.pos):c===3?l._keys.push(f.readString()):c===4&&l._values.push(function(p){for(var A=null,b=p.readVarint()+p.pos;p.pos<b;){var C=p.readVarint()>>3;A=C===1?p.readString():C===2?p.readFloat():C===3?p.readDouble():C===4?p.readVarint64():C===5?p.readVarint():C===6?p.readSVarint():C===7?p.readBoolean():null}return A}(f))}_G.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var l=this._pbf.readVarint()+this._pbf.pos;return new Vhe(this._pbf,l,this.extent,this._keys,this._values)};var Hhe=AG;function Whe(c,l,f){if(c===3){var p=new Hhe(f,f.readVarint()+f.pos);p.length&&(l[p.name]=p)}}var w3=N2.VectorTile=function(c,l){this.layers=c.readFields(Whe,{},l)},F2=N2.VectorTileFeature=mG;function k2(c,l,f,p){const A=[],b=p===0?(C,M,N,U,W,K)=>{C.push(new re(K,N+(K-M)/(U-M)*(W-N)))}:(C,M,N,U,W,K)=>{C.push(new re(M+(K-N)/(W-N)*(U-M),K))};for(const C of c){const M=[];for(const N of C){if(N.length<=2)continue;const U=[];for(let ee=0;ee<N.length-1;ee++){const oe=N[ee].x,le=N[ee].y,de=N[ee+1].x,xe=N[ee+1].y,Le=p===0?oe:le,$e=p===0?de:xe;Le<l?$e>l&&b(U,oe,le,de,xe,l):Le>f?$e<f&&b(U,oe,le,de,xe,f):U.push(N[ee]),$e<l&&Le>=l&&b(U,oe,le,de,xe,l),$e>f&&Le<=f&&b(U,oe,le,de,xe,f)}let W=N[N.length-1];const K=p===0?W.x:W.y;K>=l&&K<=f&&U.push(W),U.length&&(W=U[U.length-1],U[0].x===W.x&&U[0].y===W.y||U.push(U[0]),M.push(U))}M.length&&A.push(M)}return A}N2.VectorTileLayer=AG;const qhe=F2.types,Xhe=Math.pow(2,13);function Ox(c,l,f,p,A,b,C,M){c.emplaceBack((l<<1)+C,(f<<1)+b,(Math.floor(p*Xhe)<<1)+A,Math.round(M))}function Rx(c,l,f){c.emplaceBack(l.x,l.y,l.z,f[0]*16384,f[1]*16384,f[2]*16384)}class yG{constructor(){this.acc=new re(0,0),this.polyCount=[]}startRing(l){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new re(l.x,l.y),this.max=new re(l.x,l.y))}append(l,f){this.currentPolyCount.edges++,this.acc._add(l);const p=this.min,A=this.max;l.x<p.x?p.x=l.x:l.x>A.x&&(A.x=l.x),l.y<p.y?p.y=l.y:l.y>A.y&&(A.y=l.y),((l.x===0||l.x===Kn)&&l.x===f.x)!=((l.y===0||l.y===Kn)&&l.y===f.y)&&this.processBorderOverlap(l,f),f.x<0!=l.x<0&&this.addBorderIntersection(0,jr(f.y,l.y,(0-f.x)/(l.x-f.x))),f.x>Kn!=l.x>Kn&&this.addBorderIntersection(1,jr(f.y,l.y,(Kn-f.x)/(l.x-f.x))),f.y<0!=l.y<0&&this.addBorderIntersection(2,jr(f.x,l.x,(0-f.y)/(l.y-f.y))),f.y>Kn!=l.y>Kn&&this.addBorderIntersection(3,jr(f.x,l.x,(Kn-f.y)/(l.y-f.y)))}addBorderIntersection(l,f){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const p=this.borders[l];f<p[0]&&(p[0]=f),f>p[1]&&(p[1]=f)}processBorderOverlap(l,f){if(l.x===f.x){if(l.y===f.y)return;const p=l.x===0?0:1;this.addBorderIntersection(p,f.y),this.addBorderIntersection(p,l.y)}else{const p=l.y===0?2:3;this.addBorderIntersection(p,f.x),this.addBorderIntersection(p,l.x)}}centroid(){const l=this.polyCount.reduce((f,p)=>f+p.edges,0);return l!==0?this.acc.div(l)._round():new re(0,0)}span(){return new re(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((l,f)=>l+ +(f[0]!==Number.MAX_VALUE),0)}}class Lx{constructor(l){this.zoom=l.zoom,this.canonical=l.canonical,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=l.projection,this.layoutVertexArray=new Ut,this.centroidVertexArray=new qf,this.indexArray=new Vn,this.programConfigurations=new WA(l.layers,l.zoom),this.segments=new Wo,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.enableTerrain=l.enableTerrain}populate(l,f,p,A){this.features=[],this.hasPattern=x3("fill-extrusion",this.layers,f),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(b){const C=Math.exp(Math.PI*(1-b.y/(1<<b.z)*2));return 80150034*C/(C*C+1)/Kn/(1<<b.z)}(p),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:b,id:C,index:M,sourceLayerIndex:N}of l){const U=this.layers[0]._featureFilter.needGeometry,W=KA(b,U);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),W,p))continue;const K={id:C,sourceLayerIndex:N,index:M,geometry:U?W.geometry:Dp(b,p,A),properties:b.properties,type:b.type,patterns:{}},ee=this.layoutVertexArray.length;this.hasPattern?this.features.push(b3("fill-extrusion",this.layers,K,this.zoom,f)):this.addFeature(K,K.geometry,M,p,{},f.availableImages,A),f.featureIndex.insert(b,K.geometry,M,N,this.index,ee)}this.sortBorders()}addFeatures(l,f,p,A,b){for(const C of this.features){const{geometry:M}=C;this.addFeature(C,M,C.index,f,p,A,b)}this.sortBorders()}update(l,f,p,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,p,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,zhe),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=l.createVertexBuffer(this.layoutVertexExtArray,khe.members,!0))),this.programConfigurations.upload(l),this.uploaded=!0}uploadCentroid(l){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,Fhe.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,f,p,A,b,C,M){const N=[new re(0,0),new re(Kn,Kn)],U=M.projection,W=U.name==="globe",K=this.enableTerrain&&!W?new yG:null,ee=qhe[l.type]==="Polygon";W&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new nn);const oe=v3(f,500);for(let Le=oe.length-1;Le>=0;Le--){const $e=oe[Le];($e.length===0||(le=$e[0]).every(De=>De.x<=0)||le.every(De=>De.x>=Kn)||le.every(De=>De.y<=0)||le.every(De=>De.y>=Kn))&&oe.splice(Le,1)}var le;let de;if(W)de=TG(oe,N,A);else{de=[];for(const Le of oe)de.push({polygon:Le,bounds:N})}const xe=ee?this.edgeRadius:0;for(const{polygon:Le,bounds:$e}of de){let De=0,je=0;for(const We of Le)ee&&!We[0].equals(We[We.length-1])&&We.push(We[0]),je+=ee?We.length-1:We.length;const Ze=this.segments.prepareSegment((ee?5:4)*je,this.layoutVertexArray,this.indexArray);if(ee){const We=[],bt=[];De=Ze.vertexLength;for(const Ft of Le){let tn,Tt;Ft.length&&Ft!==Le[0]&&bt.push(We.length/2),tn=Ft[1].sub(Ft[0])._perp()._unit();for(let Gt=1;Gt<Ft.length;Gt++){const jt=Ft[Gt],Yt=Ft[Gt===Ft.length-1?1:Gt+1];let{x:ln,y:Bt}=jt;if(xe){Tt=Yt.sub(jt)._perp()._unit();const xn=tn.add(Tt)._unit(),zn=xe*Math.min(4,1/(tn.x*xn.x+tn.y*xn.y));ln+=zn*xn.x,Bt+=zn*xn.y,tn=Tt}Ox(this.layoutVertexArray,ln,Bt,0,0,1,1,0),Ze.vertexLength++,We.push(jt.x,jt.y),W&&Rx(this.layoutVertexExtArray,U.projectTilePoint(ln,Bt,A),U.upVector(A,ln,Bt))}}const _t=y3(We,bt);for(let Ft=0;Ft<_t.length;Ft+=3)this.indexArray.emplaceBack(De+_t[Ft],De+_t[Ft+2],De+_t[Ft+1]),Ze.primitiveLength++}for(const We of Le){K&&We.length&&K.startRing(We[0]);let bt,_t,Ft,tn=We.length>4&&wG(We[We.length-2],We[0],We[1]),Tt=xe?Zhe(We[We.length-2],We[0],We[1],xe):0;_t=We[1].sub(We[0])._perp()._unit();let Gt=!0;for(let jt=1,Yt=0;jt<We.length;jt++){let ln=We[jt-1],Bt=We[jt];const xn=We[jt===We.length-1?1:jt+1];if(K&&ee&&K.currentPolyCount.top++,bG(Bt,ln,$e)){xe&&(_t=xn.sub(Bt)._perp()._unit(),Gt=!Gt);continue}K&&K.append(Bt,ln);const zn=Bt.sub(ln)._perp(),En=zn.x/(Math.abs(zn.x)+Math.abs(zn.y)),Ar=zn.y>0?1:0,un=ln.dist(Bt);if(Yt+un>32768&&(Yt=0),xe){Ft=xn.sub(Bt)._perp()._unit();let yr=xG(ln,Bt,xn,vG(_t,Ft),xe);isNaN(yr)&&(yr=0);const nr=Bt.sub(ln)._unit();ln=ln.add(nr.mult(Tt))._round(),Bt=Bt.add(nr.mult(-yr))._round(),Tt=yr,_t=Ft}const Xn=Ze.vertexLength,_r=We.length>4&&wG(ln,Bt,xn);let ei=EG(Yt,tn,Gt);if(Ox(this.layoutVertexArray,ln.x,ln.y,En,Ar,0,0,ei),Ox(this.layoutVertexArray,ln.x,ln.y,En,Ar,0,1,ei),Yt+=un,ei=EG(Yt,_r,!Gt),tn=_r,Ox(this.layoutVertexArray,Bt.x,Bt.y,En,Ar,0,0,ei),Ox(this.layoutVertexArray,Bt.x,Bt.y,En,Ar,0,1,ei),Ze.vertexLength+=4,this.indexArray.emplaceBack(Xn+0,Xn+1,Xn+2),this.indexArray.emplaceBack(Xn+1,Xn+3,Xn+2),Ze.primitiveLength+=2,xe){const yr=De+(jt===1?We.length-2:jt-2),nr=jt===1?De:yr+1;if(this.indexArray.emplaceBack(Xn+1,yr,Xn+3),this.indexArray.emplaceBack(yr,nr,Xn+3),Ze.primitiveLength+=2,bt===void 0&&(bt=Xn),!bG(xn,We[jt],$e)){const Hi=jt===We.length-1?bt:Ze.vertexLength;this.indexArray.emplaceBack(Xn+2,Xn+3,Hi),this.indexArray.emplaceBack(Xn+3,Hi+1,Hi),this.indexArray.emplaceBack(Xn+3,nr,Hi+1),Ze.primitiveLength+=3}Gt=!Gt}if(W){const yr=this.layoutVertexExtArray,nr=U.projectTilePoint(ln.x,ln.y,A),Hi=U.projectTilePoint(Bt.x,Bt.y,A),wr=U.upVector(A,ln.x,ln.y),Er=U.upVector(A,Bt.x,Bt.y);Rx(yr,nr,wr),Rx(yr,nr,wr),Rx(yr,Hi,Er),Rx(yr,Hi,Er)}}ee&&(De+=We.length-1)}}if(K&&K.polyCount.length>0){if(K.borders){K.vertexArrayOffset=this.centroidVertexArray.length;const Le=K.borders,$e=this.featuresOnBorder.push(K)-1;for(let De=0;De<4;De++)Le[De][0]!==Number.MAX_VALUE&&this.borders[De].push($e)}this.encodeCentroid(K.borders?void 0:K.centroid(),K)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,b,C,A)}sortBorders(){for(let l=0;l<4;l++)this.borders[l].sort((f,p)=>this.featuresOnBorder[f].borders[l][0]-this.featuresOnBorder[p].borders[l][0])}encodeCentroid(l,f,p=!0){let A,b;if(l)if(l.y!==0){const M=f.span()._mult(this.tileToMeter);A=(Math.max(l.x,1)<<3)+Math.min(7,Math.round(M.x/10)),b=(Math.max(l.y,1)<<3)+Math.min(7,Math.round(M.y/10))}else A=Math.ceil(7*(l.x+450)),b=0;else A=0,b=+p;let C=p?this.centroidVertexArray.length:f.vertexArrayOffset;for(const M of f.polyCount){p&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*M.edges+M.top);for(let N=0;N<M.top;N++)this.centroidVertexArray.emplace(C++,A,b);for(let N=0;N<2*M.edges;N++)this.centroidVertexArray.emplace(C++,0,b),this.centroidVertexArray.emplace(C++,A,b)}}}function vG(c,l){const f=c.add(l)._unit();return c.x*f.x+c.y*f.y}function Zhe(c,l,f,p){const A=l.sub(c)._perp()._unit(),b=f.sub(l)._perp()._unit();return xG(c,l,f,vG(A,b),p)}function xG(c,l,f,p,A){const b=Math.sqrt(1-p*p);return Math.min(c.dist(l)/3,l.dist(f)/3,A*b/p)}function bG(c,l,f){return c.x<f[0].x&&l.x<f[0].x||c.x>f[1].x&&l.x>f[1].x||c.y<f[0].y&&l.y<f[0].y||c.y>f[1].y&&l.y>f[1].y}function wG(c,l,f){if(c.x<0||c.x>=Kn||l.x<0||l.x>=Kn||f.x<0||f.x>=Kn)return!1;const p=f.sub(l),A=p.perp(),b=c.sub(l);return(p.x*b.x+p.y*b.y)/Math.sqrt((p.x*p.x+p.y*p.y)*(b.x*b.x+b.y*b.y))>-.866&&A.x*b.x+A.y*b.y<0}function EG(c,l,f){const p=l?2|c:-3&c;return f?1|p:-2&p}function SG(){const c=Math.PI/32,l=Math.tan(c),f=Tx;return f*Math.sqrt(1+2*l*l)-f}function TG(c,l,f){const p=1<<f.z,A=Ju(f.x/p),b=Ju((f.x+1)/p),C=ya(f.y/p),M=ya((f.y+1)/p);return function(N,U,W,K,ee=0,oe){const le=[];if(!N.length||!W||!K)return le;const de=(We,bt)=>{for(const _t of We)le.push({polygon:_t,bounds:bt})},xe=Math.ceil(Math.log2(W)),Le=Math.ceil(Math.log2(K)),$e=xe-Le,De=[];for(let We=0;We<Math.abs($e);We++)De.push($e>0?0:1);for(let We=0;We<Math.min(xe,Le);We++)De.push(0),De.push(1);let je=N;if(je=k2(je,U[0].y-ee,U[1].y+ee,1),je=k2(je,U[0].x-ee,U[1].x+ee,0),!je.length)return le;const Ze=[];for(De.length?Ze.push({polygons:je,bounds:U,depth:0}):de(je,U);Ze.length;){const We=Ze.pop(),bt=We.depth,_t=De[bt],Ft=We.bounds[0],tn=We.bounds[1],Tt=_t===0?Ft.x:Ft.y,Gt=_t===0?tn.x:tn.y,jt=oe?oe(_t,Tt,Gt):.5*(Tt+Gt),Yt=k2(We.polygons,Tt-ee,jt+ee,_t),ln=k2(We.polygons,jt-ee,Gt+ee,_t);if(Yt.length){const Bt=[Ft,new re(_t===0?jt:tn.x,_t===1?jt:tn.y)];De.length>bt+1?Ze.push({polygons:Yt,bounds:Bt,depth:bt+1}):de(Yt,Bt)}if(ln.length){const Bt=[new re(_t===0?jt:Ft.x,_t===1?jt:Ft.y),tn];De.length>bt+1?Ze.push({polygons:ln,bounds:Bt,depth:bt+1}):de(ln,Bt)}}return le}(c,l,Math.ceil((b-A)/11.25),Math.ceil((C-M)/11.25),1,(N,U,W)=>{if(N===0)return .5*(U+W);{const K=ya((f.y+U/Kn)/p);return(sd(.5*(ya((f.y+W/Kn)/p)+K))*p-f.y)*Kn}})}Mt(Lx,"FillExtrusionBucket",{omit:["layers","features"]}),Mt(yG,"PartMetadata");const Yhe=new ke({"fill-extrusion-edge-radius":new he(gt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Qhe={paint:new ke({"fill-extrusion-opacity":new he(gt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Se(gt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new he(gt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new he(gt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Se(gt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Se(gt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Se(gt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new he(gt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new he(gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new he(gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new he(gt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Yhe};function CG(c,l,f){var p=2*Math.PI*6378137/256/Math.pow(2,f);return[c*p-2*Math.PI*6378137/2,l*p-2*Math.PI*6378137/2]}class z2{constructor(l,f,p){this.z=l,this.x=f,this.y=p,this.key=Dx(0,l,l,f,p)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,f){const p=function(b,C,M){var N=CG(256*b,256*(C=Math.pow(2,M)-C-1),M),U=CG(256*(b+1),256*(C+1),M);return N[0]+","+N[1]+","+U[0]+","+U[1]}(this.x,this.y,this.z),A=function(b,C,M){let N,U="";for(let W=b;W>0;W--)N=1<<W-1,U+=(C&N?1:0)+(M&N?2:0);return U}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",A).replace("{bbox-epsg-3857}",p)}toString(){return`${this.z}/${this.x}/${this.y}`}}class PG{constructor(l,f){this.wrap=l,this.canonical=f,this.key=Dx(l,f.z,f.z,f.x,f.y)}}class fl{constructor(l,f,p,A,b){this.overscaledZ=l,this.wrap=f,this.canonical=new z2(p,+A,+b),this.key=f===0&&l===p?this.canonical.key:Dx(f,l,p,A,b)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){const f=this.canonical.z-l;return l>this.canonical.z?new fl(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fl(l,this.wrap,l,this.canonical.x>>f,this.canonical.y>>f)}calculateScaledKey(l,f=!0){if(this.overscaledZ===l&&f)return this.key;if(l>this.canonical.z)return Dx(this.wrap*+f,l,this.canonical.z,this.canonical.x,this.canonical.y);{const p=this.canonical.z-l;return Dx(this.wrap*+f,l,l,this.canonical.x>>p,this.canonical.y>>p)}}isChildOf(l){if(l.wrap!==this.wrap)return!1;const f=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>f&&l.canonical.y===this.canonical.y>>f}children(l){if(this.overscaledZ>=l)return[new fl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const f=this.canonical.z+1,p=2*this.canonical.x,A=2*this.canonical.y;return[new fl(f,this.wrap,f,p,A),new fl(f,this.wrap,f,p+1,A),new fl(f,this.wrap,f,p,A+1),new fl(f,this.wrap,f,p+1,A+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new fl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new fl(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new PG(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Dx(c,l,f,p,A){const b=1<<Math.min(f,22);let C=b*(A%b)+p%b;return c&&f<22&&(C+=b*b*((c<0?-2*c-1:2*c)%(1<<2*(22-f)))),16*(32*C+f)+(l-f)}Mt(z2,"CanonicalTileID"),Mt(fl,"OverscaledTileID",{omit:["projMatrix"]});class K_ extends re{constructor(l,f,p){super(l,f),this.z=p}}function Bx(c,l){return c.x*l.x+c.y*l.y}function IG(c,l){if(c.length===1){let f=0;const p=l[f++];let A;for(;!A||p.equals(A);)if(A=l[f++],!A)return 1/0;for(;f<l.length;f++){const b=l[f],C=c[0],M=A.sub(p),N=b.sub(p),U=C.sub(p),W=Bx(M,M),K=Bx(M,N),ee=Bx(N,N),oe=Bx(U,M),le=Bx(U,N),de=W*ee-K*K,xe=(ee*oe-K*le)/de,Le=(W*le-K*oe)/de,$e=p.z*(1-xe-Le)+A.z*xe+b.z*Le;if(isFinite($e))return $e}return 1/0}{let f=1/0;for(const p of l)f=Math.min(f,p.z);return f}}function MG(c,l,f,p,A,b,C,M){const N=C*A.getElevationAt(c,l,!0,!0),U=b[0]!==0,W=U?b[1]===0?C*(b[0]/7-450):C*function(K,ee,oe){const le=Math.floor(ee[0]/8),de=Math.floor(ee[1]/8),xe=10*(ee[0]-8*le),Le=10*(ee[1]-8*de),$e=K.getElevationAt(le,de,!0,!0),De=K.getMeterToDEM(oe),je=Math.floor(.5*(xe*De-1)),Ze=Math.floor(.5*(Le*De-1)),We=K.tileCoordToPixel(le,de),bt=2*je+1,_t=2*Ze+1,Ft=function(ln,Bt,xn,zn,En){return[ln.getElevationAtPixel(Bt,xn,!0),ln.getElevationAtPixel(Bt+En,xn,!0),ln.getElevationAtPixel(Bt,xn+En,!0),ln.getElevationAtPixel(Bt+zn,xn+En,!0)]}(K,We.x-je,We.y-Ze,bt,_t),tn=Math.abs(Ft[0]-Ft[1]),Tt=Math.abs(Ft[2]-Ft[3]),Gt=Math.abs(Ft[0]-Ft[2])+Math.abs(Ft[1]-Ft[3]),jt=Math.min(.25,.5*De*(tn+Tt)/bt),Yt=Math.min(.25,.5*De*Gt/_t);return $e+Math.max(jt*xe,Yt*Le)}(A,b,M):N;return{base:N+(f===0)?-1:f,top:U?Math.max(W+p,N+f+2):N+p}}const Khe=at([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Jhe}=Khe,ede=at([{name:"a_packed",components:4,type:"Float32"}]),{members:tde}=ede,nde=F2.types,rde=Math.cos(Math.PI/180*37.5);class U2{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.projection=l.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(f=>{this.gradients[f.id]={}}),this.layoutVertexArray=new St,this.layoutVertexArray2=new Kt,this.indexArray=new Vn,this.programConfigurations=new WA(l.layers,l.zoom),this.segments=new Wo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,p,A){this.hasPattern=x3("line",this.layers,f);const b=this.layers[0].layout.get("line-sort-key"),C=[];for(const{feature:W,id:K,index:ee,sourceLayerIndex:oe}of l){const le=this.layers[0]._featureFilter.needGeometry,de=KA(W,le);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),de,p))continue;const xe=b?b.evaluate(de,{},p):void 0,Le={id:K,properties:W.properties,type:W.type,sourceLayerIndex:oe,index:ee,geometry:le?de.geometry:Dp(W,p,A),patterns:{},sortKey:xe};C.push(Le)}b&&C.sort((W,K)=>W.sortKey-K.sortKey);const{lineAtlas:M,featureIndex:N}=f,U=this.addConstantDashes(M);for(const W of C){const{geometry:K,index:ee,sourceLayerIndex:oe}=W;if(U&&this.addFeatureDashes(W,M),this.hasPattern){const le=b3("line",this.layers,W,this.zoom,f);this.patternFeatures.push(le)}else this.addFeature(W,K,ee,p,M.positions,f.availableImages);N.insert(l[ee].feature,K,ee,oe,this.index)}}addConstantDashes(l){let f=!1;for(const p of this.layers){const A=p.paint.get("line-dasharray").value,b=p.layout.get("line-cap").value;if(A.kind!=="constant"||b.kind!=="constant")f=!0;else{const C=b.value,M=A.value;if(!M)continue;l.addDash(M,C)}}return f}addFeatureDashes(l,f){const p=this.zoom;for(const A of this.layers){const b=A.paint.get("line-dasharray").value,C=A.layout.get("line-cap").value;if(b.kind==="constant"&&C.kind==="constant")continue;let M,N;if(b.kind==="constant"){if(M=b.value,!M)continue}else M=b.evaluate({zoom:p},l);N=C.kind==="constant"?C.value:C.evaluate({zoom:p},l),f.addDash(M,N),l.patterns[A.id]=f.getKey(M,N)}}update(l,f,p,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,p,A)}addFeatures(l,f,p,A,b){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,f,p,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,tde)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Jhe),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&l.properties.hasOwnProperty("mapbox_clip_start")&&l.properties.hasOwnProperty("mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,f,p,A,b,C){const M=this.layers[0].layout,N=M.get("line-join").evaluate(l,{}),U=M.get("line-cap").evaluate(l,{}),W=M.get("line-miter-limit"),K=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const ee of f)this.addLine(ee,l,N,U,W,K);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,b,C,A)}addLine(l,f,p,A,b,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Le=0;Le<l.length-1;Le++)this.totalDistance+=l[Le].dist(l[Le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=nde[f.type]==="Polygon";let N=l.length;for(;N>=2&&l[N-1].equals(l[N-2]);)N--;let U=0;for(;U<N-1&&l[U].equals(l[U+1]);)U++;if(N<(M?3:2))return;p==="bevel"&&(b=1.05);const W=this.overscaling<=16?15*Kn/(512*this.overscaling):0,K=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let ee,oe,le,de,xe;this.e1=this.e2=-1,M&&(ee=l[N-2],xe=l[U].sub(ee)._unit()._perp());for(let Le=U;Le<N;Le++){if(le=Le===N-1?M?l[U+1]:void 0:l[Le+1],le&&l[Le].equals(le))continue;xe&&(de=xe),ee&&(oe=ee),ee=l[Le],xe=le?le.sub(ee)._unit()._perp():de,de=de||xe;let $e=de.add(xe);$e.x===0&&$e.y===0||$e._unit();const De=de.x*xe.x+de.y*xe.y,je=$e.x*xe.x+$e.y*xe.y,Ze=je!==0?1/je:1/0,We=2*Math.sqrt(2-2*je),bt=je<rde&&oe&&le,_t=de.x*xe.y-de.y*xe.x>0;if(bt&&Le>U){const Tt=ee.dist(oe);if(Tt>2*W){const Gt=ee.sub(ee.sub(oe)._mult(W/Tt)._round());this.updateDistance(oe,Gt),this.addCurrentVertex(Gt,de,0,0,K),oe=Gt}}const Ft=oe&&le;let tn=Ft?p:M?"butt":A;if(Ft&&tn==="round"&&(Ze<C?tn="miter":Ze<=2&&(tn="fakeround")),tn==="miter"&&Ze>b&&(tn="bevel"),tn==="bevel"&&(Ze>2&&(tn="flipbevel"),Ze<b&&(tn="miter")),oe&&this.updateDistance(oe,ee),tn==="miter")$e._mult(Ze),this.addCurrentVertex(ee,$e,0,0,K);else if(tn==="flipbevel"){if(Ze>100)$e=xe.mult(-1);else{const Tt=Ze*de.add(xe).mag()/de.sub(xe).mag();$e._perp()._mult(Tt*(_t?-1:1))}this.addCurrentVertex(ee,$e,0,0,K),this.addCurrentVertex(ee,$e.mult(-1),0,0,K)}else if(tn==="bevel"||tn==="fakeround"){const Tt=-Math.sqrt(Ze*Ze-1),Gt=_t?Tt:0,jt=_t?0:Tt;if(oe&&this.addCurrentVertex(ee,de,Gt,jt,K),tn==="fakeround"){const Yt=Math.round(180*We/Math.PI/20);for(let ln=1;ln<Yt;ln++){let Bt=ln/Yt;if(Bt!==.5){const zn=Bt-.5;Bt+=Bt*zn*(Bt-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*zn*zn+(.848013+De*(.215638*De-1.06021)))}const xn=xe.sub(de)._mult(Bt)._add(de)._unit()._mult(_t?-1:1);this.addHalfVertex(ee,xn.x,xn.y,!1,_t,0,K)}}le&&this.addCurrentVertex(ee,xe,-Gt,-jt,K)}else if(tn==="butt")this.addCurrentVertex(ee,$e,0,0,K);else if(tn==="square"){const Tt=oe?1:-1;oe||this.addCurrentVertex(ee,$e,Tt,Tt,K),this.addCurrentVertex(ee,$e,0,0,K),oe&&this.addCurrentVertex(ee,$e,Tt,Tt,K)}else tn==="round"&&(oe&&(this.addCurrentVertex(ee,de,0,0,K),this.addCurrentVertex(ee,de,1,1,K,!0)),le&&(this.addCurrentVertex(ee,xe,-1,-1,K,!0),this.addCurrentVertex(ee,xe,0,0,K)));if(bt&&Le<N-1){const Tt=ee.dist(le);if(Tt>2*W){const Gt=ee.add(le.sub(ee)._mult(W/Tt)._round());this.updateDistance(ee,Gt),this.addCurrentVertex(Gt,xe,0,0,K),ee=Gt}}}}addCurrentVertex(l,f,p,A,b,C=!1){const M=f.y*A-f.x,N=-f.y-f.x*A;this.addHalfVertex(l,f.x+f.y*p,f.y-f.x*p,C,!1,p,b),this.addHalfVertex(l,M,N,C,!0,-A,b)}addHalfVertex({x:l,y:f},p,A,b,C,M,N){this.layoutVertexArray.emplaceBack((l<<1)+(b?1:0),(f<<1)+(C?1:0),Math.round(63*p)+128,Math.round(63*A)+128,1+(M===0?0:M<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const U=N.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,U),N.primitiveLength++),C?this.e2=U:this.e1=U}updateScaledDistance(){if(this.lineClips){const l=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=l*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(l,f){this.distance+=l.dist(f),this.updateScaledDistance()}}Mt(U2,"LineBucket",{omit:["layers","patternFeatures"]});const ide=new ke({"line-cap":new Se(gt.layout_line["line-cap"]),"line-join":new Se(gt.layout_line["line-join"]),"line-miter-limit":new he(gt.layout_line["line-miter-limit"]),"line-round-limit":new he(gt.layout_line["line-round-limit"]),"line-sort-key":new Se(gt.layout_line["line-sort-key"])});var OG={paint:new ke({"line-opacity":new Se(gt.paint_line["line-opacity"]),"line-color":new Se(gt.paint_line["line-color"]),"line-translate":new he(gt.paint_line["line-translate"]),"line-translate-anchor":new he(gt.paint_line["line-translate-anchor"]),"line-width":new Se(gt.paint_line["line-width"]),"line-gap-width":new Se(gt.paint_line["line-gap-width"]),"line-offset":new Se(gt.paint_line["line-offset"]),"line-blur":new Se(gt.paint_line["line-blur"]),"line-dasharray":new Se(gt.paint_line["line-dasharray"]),"line-pattern":new Se(gt.paint_line["line-pattern"]),"line-gradient":new Fe(gt.paint_line["line-gradient"]),"line-trim-offset":new he(gt.paint_line["line-trim-offset"])}),layout:ide};const RG=new class extends Se{possiblyEvaluate(c,l){return l=new Q(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition}),super.possiblyEvaluate(c,l)}evaluate(c,l,f,p){return l=Ct({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(c,l,f,p)}}(OG.paint.properties["line-width"].specification);function LG(c,l){return l>0?l+2*c:c}RG.useIntegerZoom=!0;const ode=at([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sde=at([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ade=at([{name:"a_projected_pos",components:4,type:"Float32"}],4);at([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lde=at([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ude=at([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);at([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const DG=at([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cde=at([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);at([{name:"triangle",components:3,type:"Uint16"}]),at([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),at([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),at([{type:"Float32",name:"offsetX"}]),at([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Qs=24;const Jf=128;function E3(c,l){const{expression:f}=l;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new Q(c+1))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:A}=f;let b=0;for(;b<p.length&&p[b]<=c;)b++;b=Math.max(0,b-1);let C=b;for(;C<p.length&&p[C]<c+1;)C++;C=Math.min(p.length-1,C);const M=p[b],N=p[C];return f.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:N,interpolationType:A}:{kind:"camera",minZoom:M,maxZoom:N,minSize:f.evaluate(new Q(M)),maxSize:f.evaluate(new Q(N)),interpolationType:A}}}function G2(c,{uSize:l,uSizeT:f},{lowerSize:p,upperSize:A}){return c.kind==="source"?p/Jf:c.kind==="composite"?jr(p/Jf,A/Jf,f):l}function J_(c,l){let f=0,p=0;if(c.kind==="constant")p=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:A,minZoom:b,maxZoom:C}=c,M=A?Ee(ws.interpolationFactor(A,l,b,C),0,1):0;c.kind==="camera"?p=jr(c.minSize,c.maxSize,M):f=M}return{uSizeT:f,uSize:p}}var fde=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Jf,evaluateSizeForFeature:G2,evaluateSizeForZoom:J_,getSizeData:E3});function hde(c,l,f){return c.sections.forEach(p=>{p.text=function(A,b,C){const M=b.layout.get("text-transform").evaluate(C,{});return M==="uppercase"?A=A.toLocaleUpperCase():M==="lowercase"&&(A=A.toLocaleLowerCase()),H.applyArabicShaping&&(A=H.applyArabicShaping(A)),A}(p.text,l,f)}),c}const Nx={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function dde(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function pde(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var BG=Li,NG=function(c,l,f,p,A){var b,C,M=8*A-p-1,N=(1<<M)-1,U=N>>1,W=-7,K=f?A-1:0,ee=f?-1:1,oe=c[l+K];for(K+=ee,b=oe&(1<<-W)-1,oe>>=-W,W+=M;W>0;b=256*b+c[l+K],K+=ee,W-=8);for(C=b&(1<<-W)-1,b>>=-W,W+=p;W>0;C=256*C+c[l+K],K+=ee,W-=8);if(b===0)b=1-U;else{if(b===N)return C?NaN:1/0*(oe?-1:1);C+=Math.pow(2,p),b-=U}return(oe?-1:1)*C*Math.pow(2,b-p)},FG=function(c,l,f,p,A,b){var C,M,N,U=8*b-A-1,W=(1<<U)-1,K=W>>1,ee=A===23?Math.pow(2,-24)-Math.pow(2,-77):0,oe=p?0:b-1,le=p?1:-1,de=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(M=isNaN(l)?1:0,C=W):(C=Math.floor(Math.log(l)/Math.LN2),l*(N=Math.pow(2,-C))<1&&(C--,N*=2),(l+=C+K>=1?ee/N:ee*Math.pow(2,1-K))*N>=2&&(C++,N/=2),C+K>=W?(M=0,C=W):C+K>=1?(M=(l*N-1)*Math.pow(2,A),C+=K):(M=l*Math.pow(2,K-1)*Math.pow(2,A),C=0));A>=8;c[f+oe]=255&M,oe+=le,M/=256,A-=8);for(C=C<<A|M,U+=A;U>0;c[f+oe]=255&C,oe+=le,C/=256,U-=8);c[f+oe-le]|=128*de};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Li(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}Li.Varint=0,Li.Fixed64=1,Li.Bytes=2,Li.Fixed32=5;var S3=4294967296,kG=1/S3,zG=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Np(c){return c.type===Li.Bytes?c.readVarint()+c.pos:c.pos+1}function ey(c,l,f){return f?4294967296*l+(c>>>0):4294967296*(l>>>0)+(c>>>0)}function UG(c,l,f){var p=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));f.realloc(p);for(var A=f.pos-1;A>=c;A--)f.buf[A+p]=f.buf[A]}function gde(c,l){for(var f=0;f<c.length;f++)l.writeVarint(c[f])}function mde(c,l){for(var f=0;f<c.length;f++)l.writeSVarint(c[f])}function Ade(c,l){for(var f=0;f<c.length;f++)l.writeFloat(c[f])}function _de(c,l){for(var f=0;f<c.length;f++)l.writeDouble(c[f])}function yde(c,l){for(var f=0;f<c.length;f++)l.writeBoolean(c[f])}function vde(c,l){for(var f=0;f<c.length;f++)l.writeFixed32(c[f])}function xde(c,l){for(var f=0;f<c.length;f++)l.writeSFixed32(c[f])}function bde(c,l){for(var f=0;f<c.length;f++)l.writeFixed64(c[f])}function wde(c,l){for(var f=0;f<c.length;f++)l.writeSFixed64(c[f])}function j2(c,l){return(c[l]|c[l+1]<<8|c[l+2]<<16)+16777216*c[l+3]}function ty(c,l,f){c[f]=l,c[f+1]=l>>>8,c[f+2]=l>>>16,c[f+3]=l>>>24}function GG(c,l){return(c[l]|c[l+1]<<8|c[l+2]<<16)+(c[l+3]<<24)}Li.prototype={destroy:function(){this.buf=null},readFields:function(c,l,f){for(f=f||this.length;this.pos<f;){var p=this.readVarint(),A=p>>3,b=this.pos;this.type=7&p,c(A,l,this),this.pos===b&&this.skip(p)}return l},readMessage:function(c,l){return this.readFields(c,l,this.readVarint()+this.pos)},readFixed32:function(){var c=j2(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=GG(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=j2(this.buf,this.pos)+j2(this.buf,this.pos+4)*S3;return this.pos+=8,c},readSFixed64:function(){var c=j2(this.buf,this.pos)+GG(this.buf,this.pos+4)*S3;return this.pos+=8,c},readFloat:function(){var c=NG(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=NG(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var l,f,p=this.buf;return l=127&(f=p[this.pos++]),f<128?l:(l|=(127&(f=p[this.pos++]))<<7,f<128?l:(l|=(127&(f=p[this.pos++]))<<14,f<128?l:(l|=(127&(f=p[this.pos++]))<<21,f<128?l:function(A,b,C){var M,N,U=C.buf;if(M=(112&(N=U[C.pos++]))>>4,N<128||(M|=(127&(N=U[C.pos++]))<<3,N<128)||(M|=(127&(N=U[C.pos++]))<<10,N<128)||(M|=(127&(N=U[C.pos++]))<<17,N<128)||(M|=(127&(N=U[C.pos++]))<<24,N<128)||(M|=(1&(N=U[C.pos++]))<<31,N<128))return ey(A,M,b);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(f=p[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,l=this.pos;return this.pos=c,c-l>=12&&zG?function(f,p,A){return zG.decode(f.subarray(p,A))}(this.buf,l,c):function(f,p,A){for(var b="",C=p;C<A;){var M,N,U,W=f[C],K=null,ee=W>239?4:W>223?3:W>191?2:1;if(C+ee>A)break;ee===1?W<128&&(K=W):ee===2?(192&(M=f[C+1]))==128&&(K=(31&W)<<6|63&M)<=127&&(K=null):ee===3?(N=f[C+2],(192&(M=f[C+1]))==128&&(192&N)==128&&((K=(15&W)<<12|(63&M)<<6|63&N)<=2047||K>=55296&&K<=57343)&&(K=null)):ee===4&&(N=f[C+2],U=f[C+3],(192&(M=f[C+1]))==128&&(192&N)==128&&(192&U)==128&&((K=(15&W)<<18|(63&M)<<12|(63&N)<<6|63&U)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,ee=1):K>65535&&(K-=65536,b+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),b+=String.fromCharCode(K),C+=ee}return b}(this.buf,l,c)},readBytes:function(){var c=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,c);return this.pos=c,l},readPackedVarint:function(c,l){if(this.type!==Li.Bytes)return c.push(this.readVarint(l));var f=Np(this);for(c=c||[];this.pos<f;)c.push(this.readVarint(l));return c},readPackedSVarint:function(c){if(this.type!==Li.Bytes)return c.push(this.readSVarint());var l=Np(this);for(c=c||[];this.pos<l;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==Li.Bytes)return c.push(this.readBoolean());var l=Np(this);for(c=c||[];this.pos<l;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==Li.Bytes)return c.push(this.readFloat());var l=Np(this);for(c=c||[];this.pos<l;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==Li.Bytes)return c.push(this.readDouble());var l=Np(this);for(c=c||[];this.pos<l;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==Li.Bytes)return c.push(this.readFixed32());var l=Np(this);for(c=c||[];this.pos<l;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==Li.Bytes)return c.push(this.readSFixed32());var l=Np(this);for(c=c||[];this.pos<l;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==Li.Bytes)return c.push(this.readFixed64());var l=Np(this);for(c=c||[];this.pos<l;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==Li.Bytes)return c.push(this.readSFixed64());var l=Np(this);for(c=c||[];this.pos<l;)c.push(this.readSFixed64());return c},skip:function(c){var l=7&c;if(l===Li.Varint)for(;this.buf[this.pos++]>127;);else if(l===Li.Bytes)this.pos=this.readVarint()+this.pos;else if(l===Li.Fixed32)this.pos+=4;else{if(l!==Li.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(c,l){this.writeVarint(c<<3|l)},realloc:function(c){for(var l=this.length||16;l<this.pos+c;)l*=2;if(l!==this.length){var f=new Uint8Array(l);f.set(this.buf),this.buf=f,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),ty(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),ty(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),ty(this.buf,-1&c,this.pos),ty(this.buf,Math.floor(c*kG),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),ty(this.buf,-1&c,this.pos),ty(this.buf,Math.floor(c*kG),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(l,f){var p,A;if(l>=0?(p=l%4294967296|0,A=l/4294967296|0):(A=~(-l/4294967296),4294967295^(p=~(-l%4294967296))?p=p+1|0:(p=0,A=A+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(b,C,M){M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,M.buf[M.pos]=127&(b>>>=7)}(p,0,f),function(b,C){var M=(7&b)<<4;C.buf[C.pos++]|=M|((b>>>=3)?128:0),b&&(C.buf[C.pos++]=127&b|((b>>>=7)?128:0),b&&(C.buf[C.pos++]=127&b|((b>>>=7)?128:0),b&&(C.buf[C.pos++]=127&b|((b>>>=7)?128:0),b&&(C.buf[C.pos++]=127&b|((b>>>=7)?128:0),b&&(C.buf[C.pos++]=127&b)))))}(A,f)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var l=this.pos;this.pos=function(p,A,b){for(var C,M,N=0;N<A.length;N++){if((C=A.charCodeAt(N))>55295&&C<57344){if(!M){C>56319||N+1===A.length?(p[b++]=239,p[b++]=191,p[b++]=189):M=C;continue}if(C<56320){p[b++]=239,p[b++]=191,p[b++]=189,M=C;continue}C=M-55296<<10|C-56320|65536,M=null}else M&&(p[b++]=239,p[b++]=191,p[b++]=189,M=null);C<128?p[b++]=C:(C<2048?p[b++]=C>>6|192:(C<65536?p[b++]=C>>12|224:(p[b++]=C>>18|240,p[b++]=C>>12&63|128),p[b++]=C>>6&63|128),p[b++]=63&C|128)}return b}(this.buf,c,this.pos);var f=this.pos-l;f>=128&&UG(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f},writeFloat:function(c){this.realloc(4),FG(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),FG(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var l=c.length;this.writeVarint(l),this.realloc(l);for(var f=0;f<l;f++)this.buf[this.pos++]=c[f]},writeRawMessage:function(c,l){this.pos++;var f=this.pos;c(l,this);var p=this.pos-f;p>=128&&UG(f,p,this),this.pos=f-1,this.writeVarint(p),this.pos+=p},writeMessage:function(c,l,f){this.writeTag(c,Li.Bytes),this.writeRawMessage(l,f)},writePackedVarint:function(c,l){l.length&&this.writeMessage(c,gde,l)},writePackedSVarint:function(c,l){l.length&&this.writeMessage(c,mde,l)},writePackedBoolean:function(c,l){l.length&&this.writeMessage(c,yde,l)},writePackedFloat:function(c,l){l.length&&this.writeMessage(c,Ade,l)},writePackedDouble:function(c,l){l.length&&this.writeMessage(c,_de,l)},writePackedFixed32:function(c,l){l.length&&this.writeMessage(c,vde,l)},writePackedSFixed32:function(c,l){l.length&&this.writeMessage(c,xde,l)},writePackedFixed64:function(c,l){l.length&&this.writeMessage(c,bde,l)},writePackedSFixed64:function(c,l){l.length&&this.writeMessage(c,wde,l)},writeBytesField:function(c,l){this.writeTag(c,Li.Bytes),this.writeBytes(l)},writeFixed32Field:function(c,l){this.writeTag(c,Li.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(c,l){this.writeTag(c,Li.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(c,l){this.writeTag(c,Li.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(c,l){this.writeTag(c,Li.Fixed64),this.writeSFixed64(l)},writeVarintField:function(c,l){this.writeTag(c,Li.Varint),this.writeVarint(l)},writeSVarintField:function(c,l){this.writeTag(c,Li.Varint),this.writeSVarint(l)},writeStringField:function(c,l){this.writeTag(c,Li.Bytes),this.writeString(l)},writeFloatField:function(c,l){this.writeTag(c,Li.Fixed32),this.writeFloat(l)},writeDoubleField:function(c,l){this.writeTag(c,Li.Fixed64),this.writeDouble(l)},writeBooleanField:function(c,l){this.writeVarintField(c,!!l)}};var V2=k(BG);const T3=3;function Ede(c,l,f){l.glyphs=[],c===1&&f.readMessage(Sde,l)}function Sde(c,l,f){if(c===3){const{id:p,bitmap:A,width:b,height:C,left:M,top:N,advance:U}=f.readMessage(Tde,{});l.glyphs.push({id:p,bitmap:new Bp({width:b+2*T3,height:C+2*T3},A),metrics:{width:b,height:C,left:M,top:N,advance:U}})}else c===4?l.ascender=f.readSVarint():c===5&&(l.descender=f.readSVarint())}function Tde(c,l,f){c===1?l.id=f.readVarint():c===2?l.bitmap=f.readBytes():c===3?l.width=f.readVarint():c===4?l.height=f.readVarint():c===5?l.left=f.readSVarint():c===6?l.top=f.readSVarint():c===7&&(l.advance=f.readVarint())}const jG=T3;function C3(c){let l=0,f=0;for(const C of c)l+=C.w*C.h,f=Math.max(f,C.w);c.sort((C,M)=>M.h-C.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),f),h:1/0}];let A=0,b=0;for(const C of c)for(let M=p.length-1;M>=0;M--){const N=p[M];if(!(C.w>N.w||C.h>N.h)){if(C.x=N.x,C.y=N.y,b=Math.max(b,C.y+C.h),A=Math.max(A,C.x+C.w),C.w===N.w&&C.h===N.h){const U=p.pop();M<p.length&&(p[M]=U)}else C.h===N.h?(N.x+=C.w,N.w-=C.w):C.w===N.w?(N.y+=C.h,N.h-=C.h):(p.push({x:N.x+C.w,y:N.y,w:N.w-C.w,h:C.h}),N.y+=C.h,N.h-=C.h);break}}return{w:A,h:b,fill:l/(A*b)||0}}const $l=1;class P3{constructor(l,{pixelRatio:f,version:p,stretchX:A,stretchY:b,content:C}){this.paddedRect=l,this.pixelRatio=f,this.stretchX=A,this.stretchY=b,this.content=C,this.version=p}get tl(){return[this.paddedRect.x+$l,this.paddedRect.y+$l]}get br(){return[this.paddedRect.x+this.paddedRect.w-$l,this.paddedRect.y+this.paddedRect.h-$l]}get displaySize(){return[(this.paddedRect.w-2*$l)/this.pixelRatio,(this.paddedRect.h-2*$l)/this.pixelRatio]}}class VG{constructor(l,f){const p={},A={};this.haveRenderCallbacks=[];const b=[];this.addImages(l,p,b),this.addImages(f,A,b);const{w:C,h:M}=C3(b),N=new mu({width:C||1,height:M||1});for(const U in l){const W=l[U],K=p[U].paddedRect;mu.copy(W.data,N,{x:0,y:0},{x:K.x+$l,y:K.y+$l},W.data)}for(const U in f){const W=f[U],K=A[U].paddedRect,ee=K.x+$l,oe=K.y+$l,le=W.data.width,de=W.data.height;mu.copy(W.data,N,{x:0,y:0},{x:ee,y:oe},W.data),mu.copy(W.data,N,{x:0,y:de-1},{x:ee,y:oe-1},{width:le,height:1}),mu.copy(W.data,N,{x:0,y:0},{x:ee,y:oe+de},{width:le,height:1}),mu.copy(W.data,N,{x:le-1,y:0},{x:ee-1,y:oe},{width:1,height:de}),mu.copy(W.data,N,{x:0,y:0},{x:ee+le,y:oe},{width:1,height:de})}this.image=N,this.iconPositions=p,this.patternPositions=A}addImages(l,f,p){for(const A in l){const b=l[A],C={x:0,y:0,w:b.data.width+2*$l,h:b.data.height+2*$l};p.push(C),f[A]=new P3(C,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(A)}}patchUpdatedImages(l,f){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>l.hasImage(p)),l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in l.updatedImages)this.patchUpdatedImage(this.iconPositions[p],l.getImage(p),f),this.patchUpdatedImage(this.patternPositions[p],l.getImage(p),f)}patchUpdatedImage(l,f,p){if(!l||!f||l.version===f.version)return;l.version=f.version;const[A,b]=l.tl;p.update(f.data,void 0,{x:A,y:b})}}Mt(P3,"ImagePosition"),Mt(VG,"ImageAtlas");const ec={horizontal:1,vertical:2,horizontalOnly:3},$G=-17;class Fx{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,f){const p=new Fx;return p.scale=l||1,p.fontStack=f,p}static forImage(l){const f=new Fx;return f.imageName=l,f}}class ny{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,f){const p=new ny;for(let A=0;A<l.sections.length;A++){const b=l.sections[A];b.image?p.addImageSection(b):p.addTextSection(b,f)}return p}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSections(){return this.sections}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(l){this.text=function(f,p){let A="";for(let b=0;b<f.length;b++){const C=f.charCodeAt(b+1)||null,M=f.charCodeAt(b-1)||null;A+=!p&&(C&&_2(C)&&!Nx[f[b+1]]||M&&_2(M)&&!Nx[f[b-1]])||!Nx[f[b]]?f[b]:Nx[f[b]]}return A}(this.text,l)}trim(){let l=0;for(let p=0;p<this.text.length&&$2[this.text.charCodeAt(p)];p++)l++;let f=this.text.length;for(let p=this.text.length-1;p>=0&&p>=l&&$2[this.text.charCodeAt(p)];p--)f--;this.text=this.text.substring(l,f),this.sectionIndex=this.sectionIndex.slice(l,f)}substring(l,f){const p=new ny;return p.text=this.text.substring(l,f),p.sectionIndex=this.sectionIndex.slice(l,f),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,f)=>Math.max(l,this.sections[f].scale),0)}addTextSection(l,f){this.text+=l.text,this.sections.push(Fx.forText(l.scale,l.fontStack||f));const p=this.sections.length-1;for(let A=0;A<l.text.length;++A)this.sectionIndex.push(p)}addImageSection(l){const f=l.image?l.image.name:"";if(f.length===0)return void $t("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(Fx.forImage(f)),this.sectionIndex.push(this.sections.length-1)):$t("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function I3(c,l,f,p,A,b,C,M,N,U,W,K,ee,oe,le){const de=ny.fromFeature(c,A);K===ec.vertical&&de.verticalizePunctuation(ee);let xe=[];const Le=function(We,bt,_t,Ft,tn,Tt){if(!We)return[];const Gt=[],jt=function(xn,zn,En,Ar,un,Xn){let _r=0;for(let ei=0;ei<xn.length();ei++){const yr=xn.getSection(ei);_r+=HG(xn.getCharCode(ei),yr,Ar,un,zn,Xn)}return _r/Math.max(1,Math.ceil(_r/En))}(We,bt,_t,Ft,tn,Tt),Yt=We.text.indexOf("​")>=0;let ln=0;for(let xn=0;xn<We.length();xn++){const zn=We.getSection(xn),En=We.getCharCode(xn);if($2[En]||(ln+=HG(En,zn,Ft,tn,bt,Tt)),xn<We.length()-1){const Ar=!((Bt=En)<11904||!(qt["Bopomofo Extended"](Bt)||qt.Bopomofo(Bt)||qt["CJK Compatibility Forms"](Bt)||qt["CJK Compatibility Ideographs"](Bt)||qt["CJK Compatibility"](Bt)||qt["CJK Radicals Supplement"](Bt)||qt["CJK Strokes"](Bt)||qt["CJK Symbols and Punctuation"](Bt)||qt["CJK Unified Ideographs Extension A"](Bt)||qt["CJK Unified Ideographs"](Bt)||qt["Enclosed CJK Letters and Months"](Bt)||qt["Halfwidth and Fullwidth Forms"](Bt)||qt.Hiragana(Bt)||qt["Ideographic Description Characters"](Bt)||qt["Kangxi Radicals"](Bt)||qt["Katakana Phonetic Extensions"](Bt)||qt.Katakana(Bt)||qt["Vertical Forms"](Bt)||qt["Yi Radicals"](Bt)||qt["Yi Syllables"](Bt)));(Cde[En]||Ar||zn.imageName)&&Gt.push(qG(xn+1,ln,jt,Gt,Pde(En,We.getCharCode(xn+1),Ar&&Yt),!1))}}var Bt;return XG(qG(We.length(),ln,jt,Gt,0,!0))}(de,U,b,l,p,oe),{processBidirectionalText:$e,processStyledBidirectionalText:De}=H;if($e&&de.sections.length===1){const We=$e(de.toString(),Le);for(const bt of We){const _t=new ny;_t.text=bt,_t.sections=de.sections;for(let Ft=0;Ft<bt.length;Ft++)_t.sectionIndex.push(0);xe.push(_t)}}else if(De){const We=De(de.text,de.sectionIndex,Le);for(const bt of We){const _t=new ny;_t.text=bt[0],_t.sectionIndex=bt[1],_t.sections=de.sections,xe.push(_t)}}else xe=function(We,bt){const _t=[],Ft=We.text;let tn=0;for(const Tt of bt)_t.push(We.substring(tn,Tt)),tn=Tt;return tn<Ft.length&&_t.push(We.substring(tn,Ft.length)),_t}(de,Le);const je=[],Ze={positionedLines:je,text:de.toString(),top:W[1],bottom:W[1],left:W[0],right:W[0],writingMode:K,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(We,bt,_t,Ft,tn,Tt,Gt,jt,Yt,ln,Bt,xn){let zn=0,En=0,Ar=0;const un=jt==="right"?1:jt==="left"?0:.5;let Xn=!1;for(const wr of tn){const Er=wr.getSections();for(const Ci of Er){if(Ci.imageName)continue;const Di=bt[Ci.fontStack];if(Di&&(Xn=Di.ascender!==void 0&&Di.descender!==void 0,!Xn))break}if(!Xn)break}let _r=0;for(const wr of tn){wr.trim();const Er=wr.getMaxScale(),Ci=(Er-1)*Qs,Di={positionedGlyphs:[],lineOffset:0};We.positionedLines[_r]=Di;const Bi=Di.positionedGlyphs;let Pi=0;if(!wr.length()){En+=Tt,++_r;continue}let uo=0,To=0;for(let Ii=0;Ii<wr.length();Ii++){const ds=wr.getSection(Ii),Zo=wr.getSectionIndex(Ii),_o=wr.getCharCode(Ii);let ri=ds.scale,Yo=null,Ni=null,hl=null,Qo=Qs,Ks=0;const Fs=!(Yt===ec.horizontal||!Bt&&!cx(_o)||Bt&&($2[_o]||(ei=_o,qt.Arabic(ei)||qt["Arabic Supplement"](ei)||qt["Arabic Extended-A"](ei)||qt["Arabic Presentation Forms-A"](ei)||qt["Arabic Presentation Forms-B"](ei))));if(ds.imageName){const dl=Ft[ds.imageName];if(!dl)continue;hl=ds.imageName,We.iconsInText=We.iconsInText||!0,Ni=dl.paddedRect;const ks=dl.displaySize;ri=ri*Qs/xn,Yo={width:ks[0],height:ks[1],left:$l,top:-jG,advance:Fs?ks[1]:ks[0],localGlyph:!1},Ks=Xn?-Yo.height*ri:$G+Er*Qs-ks[1]*ri,Qo=Yo.advance;const nh=(Fs?ks[0]:ks[1])*ri-Qs*Er;nh>0&&nh>Pi&&(Pi=nh)}else{const dl=_t[ds.fontStack];if(!dl)continue;dl[_o]&&(Ni=dl[_o]);const ks=bt[ds.fontStack];if(!ks)continue;const nh=ks.glyphs[_o];if(!nh)continue;if(Yo=nh.metrics,Qo=_o!==8203?Qs:0,Xn){const uy=ks.ascender!==void 0?Math.abs(ks.ascender):0,qx=ks.descender!==void 0?Math.abs(ks.descender):0,Xx=(uy+qx)*ri;uo<Xx&&(uo=Xx,To=(uy-qx)/2*ri),Ks=-uy*ri}else Ks=$G+(Er-ri)*Qs}Fs?(We.verticalizable=!0,Bi.push({glyph:_o,imageName:hl,x:zn,y:En+Ks,vertical:Fs,scale:ri,localGlyph:Yo.localGlyph,fontStack:ds.fontStack,sectionIndex:Zo,metrics:Yo,rect:Ni}),zn+=Qo*ri+ln):(Bi.push({glyph:_o,imageName:hl,x:zn,y:En+Ks,vertical:Fs,scale:ri,localGlyph:Yo.localGlyph,fontStack:ds.fontStack,sectionIndex:Zo,metrics:Yo,rect:Ni}),zn+=Yo.advance*ri+ln)}Bi.length!==0&&(Ar=Math.max(zn-ln,Ar),Xn?ZG(Bi,un,Pi,To,Tt*Er/2):ZG(Bi,un,Pi,0,Tt/2)),zn=0;const Xo=Tt*Er+Pi;Di.lineOffset=Math.max(Pi,Ci),En+=Xo,++_r}var ei;const yr=En,{horizontalAlign:nr,verticalAlign:Hi}=M3(Gt);(function(wr,Er,Ci,Di,Bi,Pi){const uo=(Er-Ci)*Bi,To=-Pi*Di;for(const Xo of wr)for(const Ii of Xo.positionedGlyphs)Ii.x+=uo,Ii.y+=To})(We.positionedLines,un,nr,Hi,Ar,yr),We.top+=-Hi*yr,We.bottom=We.top+yr,We.left+=-nr*Ar,We.right=We.left+Ar,We.hasBaseline=Xn}(Ze,l,f,p,xe,C,M,N,K,U,ee,le),!function(We){for(const bt of We)if(bt.positionedGlyphs.length!==0)return!1;return!0}(je)&&Ze}const $2={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Cde={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function HG(c,l,f,p,A,b){if(l.imageName){const C=p[l.imageName];return C?C.displaySize[0]*l.scale*Qs/b+A:0}{const C=f[l.fontStack],M=C&&C.glyphs[c];return M?M.metrics.advance*l.scale+A:0}}function WG(c,l,f,p){const A=Math.pow(c-l,2);return p?c<l?A/2:2*A:A+Math.abs(f)*f}function Pde(c,l,f){let p=0;return c===10&&(p-=1e4),f&&(p+=150),c!==40&&c!==65288||(p+=50),l!==41&&l!==65289||(p+=50),p}function qG(c,l,f,p,A,b){let C=null,M=WG(l,f,A,b);for(const N of p){const U=WG(l-N.x,f,A,b)+N.badness;U<=M&&(C=N,M=U)}return{index:c,x:l,priorBreak:C,badness:M}}function XG(c){return c?XG(c.priorBreak).concat(c.index):[]}function M3(c){let l=.5,f=.5;switch(c){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:l,verticalAlign:f}}function ZG(c,l,f,p,A){if(!(l||f||p||A))return;const b=c.length-1,C=c[b],M=(C.x+C.metrics.advance*C.scale)*l;for(let N=0;N<=b;N++)c[N].x-=M,c[N].y+=f+p+A}function Ide(c,l,f){const{horizontalAlign:p,verticalAlign:A}=M3(f),b=l[0]-c.displaySize[0]*p,C=l[1]-c.displaySize[1]*A;return{image:c,top:C,bottom:C+c.displaySize[1],left:b,right:b+c.displaySize[0]}}function YG(c,l,f,p,A,b){const C=c.image;let M;if(C.content){const xe=C.content,Le=C.pixelRatio||1;M=[xe[0]/Le,xe[1]/Le,C.displaySize[0]-xe[2]/Le,C.displaySize[1]-xe[3]/Le]}const N=l.left*b,U=l.right*b;let W,K,ee,oe;f==="width"||f==="both"?(oe=A[0]+N-p[3],K=A[0]+U+p[1]):(oe=A[0]+(N+U-C.displaySize[0])/2,K=oe+C.displaySize[0]);const le=l.top*b,de=l.bottom*b;return f==="height"||f==="both"?(W=A[1]+le-p[0],ee=A[1]+de+p[2]):(W=A[1]+(le+de-C.displaySize[1])/2,ee=W+C.displaySize[1]),{image:C,top:W,right:K,bottom:ee,left:oe,collisionPadding:M}}class Fp extends re{constructor(l,f,p,A,b){super(l,f),this.angle=A,this.z=p,b!==void 0&&(this.segment=b)}clone(){return new Fp(this.x,this.y,this.z,this.angle,this.segment)}}function QG(c,l,f,p,A){if(l.segment===void 0)return!0;let b=l,C=l.segment+1,M=0;for(;M>-f/2;){if(C--,C<0)return!1;M-=c[C].dist(b),b=c[C]}M+=c[C].dist(c[C+1]),C++;const N=[];let U=0;for(;M<f/2;){const W=c[C],K=c[C+1];if(!K)return!1;let ee=c[C-1].angleTo(W)-W.angleTo(K);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),N.push({distance:M,angleDelta:ee}),U+=ee;M-N[0].distance>p;)U-=N.shift().angleDelta;if(U>A)return!1;C++,M+=W.dist(K)}return!0}function KG(c){let l=0;for(let f=0;f<c.length-1;f++)l+=c[f].dist(c[f+1]);return l}function JG(c,l,f){return c?.6*l*f:0}function ej(c,l){return Math.max(c?c.right-c.left:0,l?l.right-l.left:0)}function Mde(c,l,f,p,A,b){const C=JG(f,A,b),M=ej(f,p)*b;let N=0;const U=KG(c)/2;for(let W=0;W<c.length-1;W++){const K=c[W],ee=c[W+1],oe=K.dist(ee);if(N+oe>U){const le=(U-N)/oe,de=jr(K.x,ee.x,le),xe=jr(K.y,ee.y,le),Le=new Fp(de,xe,0,ee.angleTo(K),W);return!C||QG(c,Le,M,C,l)?Le:void 0}N+=oe}}function Ode(c,l,f,p,A,b,C,M,N){const U=JG(p,b,C),W=ej(p,A),K=W*C,ee=c[0].x===0||c[0].x===N||c[0].y===0||c[0].y===N;return l-K<l/4&&(l=K+l/4),tj(c,ee?l/2*M%l:(W/2+2*b)*C*M%l,l,U,f,K,ee,!1,N)}function tj(c,l,f,p,A,b,C,M,N){const U=b/2,W=KG(c);let K=0,ee=l-f,oe=[];for(let le=0;le<c.length-1;le++){const de=c[le],xe=c[le+1],Le=de.dist(xe),$e=xe.angleTo(de);for(;ee+f<K+Le;){ee+=f;const De=(ee-K)/Le,je=jr(de.x,xe.x,De),Ze=jr(de.y,xe.y,De);if(je>=0&&je<N&&Ze>=0&&Ze<N&&ee-U>=0&&ee+U<=W){const We=new Fp(je,Ze,0,$e,le);We._round(),p&&!QG(c,We,b,p,A)||oe.push(We)}}K+=Le}return M||oe.length||C||(oe=tj(c,K/2,f,p,A,b,C,!0,N)),oe}function nj(c,l,f,p,A){const b=[];for(let C=0;C<c.length;C++){const M=c[C];let N;for(let U=0;U<M.length-1;U++){let W=M[U],K=M[U+1];W.x<l&&K.x<l||(W.x<l?W=new re(l,W.y+(l-W.x)/(K.x-W.x)*(K.y-W.y))._round():K.x<l&&(K=new re(l,W.y+(l-W.x)/(K.x-W.x)*(K.y-W.y))._round()),W.y<f&&K.y<f||(W.y<f?W=new re(W.x+(f-W.y)/(K.y-W.y)*(K.x-W.x),f)._round():K.y<f&&(K=new re(W.x+(f-W.y)/(K.y-W.y)*(K.x-W.x),f)._round()),W.x>=p&&K.x>=p||(W.x>=p?W=new re(p,W.y+(p-W.x)/(K.x-W.x)*(K.y-W.y))._round():K.x>=p&&(K=new re(p,W.y+(p-W.x)/(K.x-W.x)*(K.y-W.y))._round()),W.y>=A&&K.y>=A||(W.y>=A?W=new re(W.x+(A-W.y)/(K.y-W.y)*(K.x-W.x),A)._round():K.y>=A&&(K=new re(W.x+(A-W.y)/(K.y-W.y)*(K.x-W.x),A)._round()),N&&W.equals(N[N.length-1])||(N=[W],b.push(N)),N.push(K)))))}}return b}Mt(Fp,"Anchor");const kx=1e20;function rj(c,l,f,p,A,b,C,M,N){for(let U=l;U<l+p;U++)ij(c,f*b+U,b,A,C,M,N);for(let U=f;U<f+A;U++)ij(c,U*b+l,1,p,C,M,N)}function ij(c,l,f,p,A,b,C){b[0]=0,C[0]=-kx,C[1]=kx,A[0]=c[l];for(let M=1,N=0,U=0;M<p;M++){A[M]=c[l+M*f];const W=M*M;do{const K=b[N];U=(A[M]-A[K]+W-K*K)/(M-K)/2}while(U<=C[N]&&--N>-1);N++,b[N]=M,C[N]=U,C[N+1]=kx}for(let M=0,N=0;M<p;M++){for(;C[N+1]<M;)N++;const U=b[N],W=M-U;c[l+M*f]=A[U]+W*W}}const eh=2,O3={none:0,ideographs:1,all:2};class ry{constructor(l,f,p){this.requestManager=l,this.localGlyphMode=f,this.localFontFamily=p,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(l){this.url=l}getGlyphs(l,f){const p=[];for(const A in l)for(const b of l[A])p.push({stack:A,id:b});qe(p,({stack:A,id:b},C)=>{let M=this.entries[A];M||(M=this.entries[A]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let N=M.glyphs[b];if(N!==void 0)return void C(null,{stack:A,id:b,glyph:N});if(N=this._tinySDF(M,A,b),N)return M.glyphs[b]=N,void C(null,{stack:A,id:b,glyph:N});const U=Math.floor(b/256);if(256*U>65535)return void C(new Error("glyphs > 65535 not supported"));if(M.ranges[U])return void C(null,{stack:A,id:b,glyph:N});let W=M.requests[U];W||(W=M.requests[U]=[],ry.loadGlyphRange(A,U,this.url,this.requestManager,(K,ee)=>{if(ee){M.ascender=ee.ascender,M.descender=ee.descender;for(const oe in ee.glyphs)this._doesCharSupportLocalGlyph(+oe)||(M.glyphs[+oe]=ee.glyphs[+oe]);M.ranges[U]=!0}for(const oe of W)oe(K,ee);delete M.requests[U]})),W.push((K,ee)=>{K?C(K):ee&&C(null,{stack:A,id:b,glyph:ee.glyphs[b]||null})})},(A,b)=>{if(A)f(A);else if(b){const C={};for(const{stack:M,id:N,glyph:U}of b)C[M]===void 0&&(C[M]={}),C[M].glyphs===void 0&&(C[M].glyphs={}),C[M].glyphs[N]=U&&{id:U.id,bitmap:U.bitmap.clone(),metrics:U.metrics},C[M].ascender=this.entries[M].ascender,C[M].descender=this.entries[M].descender;f(null,C)}})}_doesCharSupportLocalGlyph(l){return this.localGlyphMode!==O3.none&&(this.localGlyphMode===O3.all?!!this.localFontFamily:!!this.localFontFamily&&(qt["CJK Unified Ideographs"](l)||qt["Hangul Syllables"](l)||qt.Hiragana(l)||qt.Katakana(l)||qt["CJK Symbols and Punctuation"](l)))}_tinySDF(l,f,p){const A=this.localFontFamily;if(!A||!this._doesCharSupportLocalGlyph(p))return;let b=l.tinySDF;if(!b){let de="400";/bold/i.test(f)?de="900":/medium/i.test(f)?de="500":/light/i.test(f)&&(de="200"),b=l.tinySDF=new ry.TinySDF({fontFamily:A,fontWeight:de,fontSize:24*eh,buffer:3*eh,radius:8*eh}),b.fontWeight=de}if(this.localGlyphs[b.fontWeight][p])return this.localGlyphs[b.fontWeight][p];const C=String.fromCharCode(p),{data:M,width:N,height:U,glyphWidth:W,glyphHeight:K,glyphLeft:ee,glyphTop:oe,glyphAdvance:le}=b.draw(C);return this.localGlyphs[b.fontWeight][p]={id:p,bitmap:new Bp({width:N,height:U},M),metrics:{width:W/eh,height:K/eh,left:ee/eh,top:oe/eh-27,advance:le/eh,localGlyph:!0}}}}ry.loadGlyphRange=function(c,l,f,p,A){const b=256*l,C=b+255,M=p.transformRequest(p.normalizeGlyphsURL(f).replace("{fontstack}",c).replace("{range}",`${b}-${C}`),$u.Glyphs);Fc(M,(N,U)=>{if(N)A(N);else if(U){const W={},K=function(ee){return new V2(ee).readFields(Ede,{})}(U);for(const ee of K.glyphs)W[ee.id]=ee;A(null,{glyphs:W,ascender:K.ascender,descender:K.descender})}})},ry.TinySDF=class{constructor({fontSize:c=24,buffer:l=3,radius:f=8,cutoff:p=.25,fontFamily:A="sans-serif",fontWeight:b="normal",fontStyle:C="normal"}={}){this.buffer=l,this.cutoff=p,this.radius=f;const M=this.size=c+4*l,N=this._createCanvas(M),U=this.ctx=N.getContext("2d",{willReadFrequently:!0});U.font=`${C} ${b} ${c}px ${A}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(c){const l=document.createElement("canvas");return l.width=l.height=c,l}draw(c){const{width:l,actualBoundingBoxAscent:f,actualBoundingBoxDescent:p,actualBoundingBoxLeft:A,actualBoundingBoxRight:b}=this.ctx.measureText(c),C=Math.ceil(f),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-A))),N=Math.min(this.size-this.buffer,C+Math.ceil(p)),U=M+2*this.buffer,W=N+2*this.buffer,K=Math.max(U*W,0),ee=new Uint8ClampedArray(K),oe={data:ee,width:U,height:W,glyphWidth:M,glyphHeight:N,glyphTop:C,glyphLeft:0,glyphAdvance:l};if(M===0||N===0)return oe;const{ctx:le,buffer:de,gridInner:xe,gridOuter:Le}=this;le.clearRect(de,de,M,N),le.fillText(c,de,de+C);const $e=le.getImageData(de,de,M,N);Le.fill(kx,0,K),xe.fill(0,0,K);for(let De=0;De<N;De++)for(let je=0;je<M;je++){const Ze=$e.data[4*(De*M+je)+3]/255;if(Ze===0)continue;const We=(De+de)*U+je+de;if(Ze===1)Le[We]=0,xe[We]=kx;else{const bt=.5-Ze;Le[We]=bt>0?bt*bt:0,xe[We]=bt<0?bt*bt:0}}rj(Le,0,0,U,W,U,this.f,this.v,this.z),rj(xe,de,de,M,N,U,this.f,this.v,this.z);for(let De=0;De<K;De++){const je=Math.sqrt(Le[De])-Math.sqrt(xe[De]);ee[De]=Math.round(255-255*(je/this.radius+this.cutoff))}return oe}};const iy=$l;function oj(c,l,f,p){const A=[],b=c.image,C=b.pixelRatio,M=b.paddedRect.w-2*iy,N=b.paddedRect.h-2*iy,U=c.right-c.left,W=c.bottom-c.top,K=b.stretchX||[[0,M]],ee=b.stretchY||[[0,N]],oe=(Tt,Gt)=>Tt+Gt[1]-Gt[0],le=K.reduce(oe,0),de=ee.reduce(oe,0),xe=M-le,Le=N-de;let $e=0,De=le,je=0,Ze=de,We=0,bt=xe,_t=0,Ft=Le;if(b.content&&p){const Tt=b.content;$e=H2(K,0,Tt[0]),je=H2(ee,0,Tt[1]),De=H2(K,Tt[0],Tt[2]),Ze=H2(ee,Tt[1],Tt[3]),We=Tt[0]-$e,_t=Tt[1]-je,bt=Tt[2]-Tt[0]-De,Ft=Tt[3]-Tt[1]-Ze}const tn=(Tt,Gt,jt,Yt)=>{const ln=W2(Tt.stretch-$e,De,U,c.left),Bt=q2(Tt.fixed-We,bt,Tt.stretch,le),xn=W2(Gt.stretch-je,Ze,W,c.top),zn=q2(Gt.fixed-_t,Ft,Gt.stretch,de),En=W2(jt.stretch-$e,De,U,c.left),Ar=q2(jt.fixed-We,bt,jt.stretch,le),un=W2(Yt.stretch-je,Ze,W,c.top),Xn=q2(Yt.fixed-_t,Ft,Yt.stretch,de),_r=new re(ln,xn),ei=new re(En,xn),yr=new re(En,un),nr=new re(ln,un),Hi=new re(Bt/C,zn/C),wr=new re(Ar/C,Xn/C),Er=l*Math.PI/180;if(Er){const Bi=Math.sin(Er),Pi=Math.cos(Er),uo=[Pi,-Bi,Bi,Pi];_r._matMult(uo),ei._matMult(uo),nr._matMult(uo),yr._matMult(uo)}const Ci=Tt.stretch+Tt.fixed,Di=Gt.stretch+Gt.fixed;return{tl:_r,tr:ei,bl:nr,br:yr,tex:{x:b.paddedRect.x+iy+Ci,y:b.paddedRect.y+iy+Di,w:jt.stretch+jt.fixed-Ci,h:Yt.stretch+Yt.fixed-Di},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Hi,pixelOffsetBR:wr,minFontScaleX:bt/C/U,minFontScaleY:Ft/C/W,isSDF:f}};if(p&&(b.stretchX||b.stretchY)){const Tt=sj(K,xe,le),Gt=sj(ee,Le,de);for(let jt=0;jt<Tt.length-1;jt++){const Yt=Tt[jt],ln=Tt[jt+1];for(let Bt=0;Bt<Gt.length-1;Bt++)A.push(tn(Yt,Gt[Bt],ln,Gt[Bt+1]))}}else A.push(tn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:N+1}));return A}function H2(c,l,f){let p=0;for(const A of c)p+=Math.max(l,Math.min(f,A[1]))-Math.max(l,Math.min(f,A[0]));return p}function sj(c,l,f){const p=[{fixed:-iy,stretch:0}];for(const[A,b]of c){const C=p[p.length-1];p.push({fixed:A-C.stretch,stretch:C.stretch}),p.push({fixed:A-C.stretch,stretch:C.stretch+(b-A)})}return p.push({fixed:l+iy,stretch:f}),p}function W2(c,l,f,p){return c/l*f+p}function q2(c,l,f,p){return c-l*f/p}function Rde(c,l,f,p){const A=l+c.positionedLines[p].lineOffset;return p===0?f+A/2:f+(A+(l+c.positionedLines[p-1].lineOffset))/2}class Lde{constructor(l=[],f=Dde){if(this.data=l,this.length=this.data.length,this.compare=f,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(l){this.data.push(l),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const l=this.data[0],f=this.data.pop();return this.length--,this.length>0&&(this.data[0]=f,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:f,compare:p}=this,A=f[l];for(;l>0;){const b=l-1>>1,C=f[b];if(p(A,C)>=0)break;f[l]=C,l=b}f[l]=A}_down(l){const{data:f,compare:p}=this,A=this.length>>1,b=f[l];for(;l<A;){let C=1+(l<<1),M=f[C];const N=C+1;if(N<this.length&&p(f[N],M)<0&&(C=N,M=f[N]),p(M,b)>=0)break;f[l]=M,l=C}f[l]=b}}function Dde(c,l){return c<l?-1:c>l?1:0}function Bde(c,l=1,f=!1){let p=1/0,A=1/0,b=-1/0,C=-1/0;const M=c[0];for(let oe=0;oe<M.length;oe++){const le=M[oe];(!oe||le.x<p)&&(p=le.x),(!oe||le.y<A)&&(A=le.y),(!oe||le.x>b)&&(b=le.x),(!oe||le.y>C)&&(C=le.y)}const N=Math.min(b-p,C-A);let U=N/2;const W=new Lde([],Nde);if(N===0)return new re(p,A);for(let oe=p;oe<b;oe+=N)for(let le=A;le<C;le+=N)W.push(new oy(oe+U,le+U,U,c));let K=function(oe){let le=0,de=0,xe=0;const Le=oe[0];for(let $e=0,De=Le.length,je=De-1;$e<De;je=$e++){const Ze=Le[$e],We=Le[je],bt=Ze.x*We.y-We.x*Ze.y;de+=(Ze.x+We.x)*bt,xe+=(Ze.y+We.y)*bt,le+=3*bt}return new oy(de/le,xe/le,0,oe)}(c),ee=W.length;for(;W.length;){const oe=W.pop();(oe.d>K.d||!K.d)&&(K=oe,f&&console.log("found best %d after %d probes",Math.round(1e4*oe.d)/1e4,ee)),oe.max-K.d<=l||(U=oe.h/2,W.push(new oy(oe.p.x-U,oe.p.y-U,U,c)),W.push(new oy(oe.p.x+U,oe.p.y-U,U,c)),W.push(new oy(oe.p.x-U,oe.p.y+U,U,c)),W.push(new oy(oe.p.x+U,oe.p.y+U,U,c)),ee+=4)}return f&&(console.log(`num probes: ${ee}`),console.log(`best distance: ${K.d}`)),K.p}function Nde(c,l){return l.max-c.max}class oy{constructor(l,f,p,A){this.p=new re(l,f),this.h=p,this.d=function(b,C){let M=!1,N=1/0;for(let U=0;U<C.length;U++){const W=C[U];for(let K=0,ee=W.length,oe=ee-1;K<ee;oe=K++){const le=W[K],de=W[oe];le.y>b.y!=de.y>b.y&&b.x<(de.x-le.x)*(b.y-le.y)/(de.y-le.y)+le.x&&(M=!M),N=Math.min(N,tG(b,le,de))}}return(M?1:-1)*Math.sqrt(N)}(this.p,A),this.max=this.d+this.h*Math.SQRT2}}const sy=7,R3=Number.POSITIVE_INFINITY,Fde=Math.sqrt(2);function aj(c,[l,f]){let p=0,A=0;if(f===R3){l<0&&(l=0);const b=l/Fde;switch(c){case"top-right":case"top-left":A=b-sy;break;case"bottom-right":case"bottom-left":A=-b+sy;break;case"bottom":A=-l+sy;break;case"top":A=l-sy}switch(c){case"top-right":case"bottom-right":p=-b;break;case"top-left":case"bottom-left":p=b;break;case"left":p=l;break;case"right":p=-l}}else{switch(l=Math.abs(l),f=Math.abs(f),c){case"top-right":case"top-left":case"top":A=f-sy;break;case"bottom-right":case"bottom-left":case"bottom":A=-f+sy}switch(c){case"top-right":case"bottom-right":case"right":p=-l;break;case"top-left":case"bottom-left":case"left":p=l}}return[p,A]}function kde(c,l,f,p,A,b,C,M,N,U){c.createArrays(),c.tilePixelRatio=Kn/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const W=c.layers[0].layout,K=c.layers[0]._unevaluatedLayout._values,ee={};if(c.textSizeData.kind==="composite"){const{minZoom:de,maxZoom:xe}=c.textSizeData;ee.compositeTextSizes=[K["text-size"].possiblyEvaluate(new Q(de),M),K["text-size"].possiblyEvaluate(new Q(xe),M)]}if(c.iconSizeData.kind==="composite"){const{minZoom:de,maxZoom:xe}=c.iconSizeData;ee.compositeIconSizes=[K["icon-size"].possiblyEvaluate(new Q(de),M),K["icon-size"].possiblyEvaluate(new Q(xe),M)]}ee.layoutTextSize=K["text-size"].possiblyEvaluate(new Q(N+1),M),ee.layoutIconSize=K["icon-size"].possiblyEvaluate(new Q(N+1),M),ee.textMaxSize=K["text-size"].possiblyEvaluate(new Q(18),M);const oe=W.get("text-rotation-alignment")==="map"&&W.get("symbol-placement")!=="point",le=W.get("text-size");for(const de of c.features){const xe=W.get("text-font").evaluate(de,{},M).join(","),Le=le.evaluate(de,{},M),$e=ee.layoutTextSize.evaluate(de,{},M),De=(ee.layoutIconSize.evaluate(de,{},M),{horizontal:{},vertical:void 0}),je=de.text;let Ze,We=[0,0];if(je){const Ft=je.toString(),tn=W.get("text-letter-spacing").evaluate(de,{},M)*Qs,Tt=W.get("text-line-height").evaluate(de,{},M)*Qs,Gt=$i(Ft)?tn:0,jt=W.get("text-anchor").evaluate(de,{},M),Yt=W.get("text-variable-anchor");if(!Yt){const En=W.get("text-radial-offset").evaluate(de,{},M);We=En?aj(jt,[En*Qs,R3]):W.get("text-offset").evaluate(de,{},M).map(Ar=>Ar*Qs)}let ln=oe?"center":W.get("text-justify").evaluate(de,{},M);const Bt=W.get("symbol-placement")==="point",xn=Bt?W.get("text-max-width").evaluate(de,{},M)*Qs:1/0,zn=En=>{c.allowVerticalPlacement&&xi(Ft)&&(De.vertical=I3(je,l,f,A,xe,xn,Tt,jt,En,Gt,We,ec.vertical,!0,$e,Le))};if(!oe&&Yt){const En=ln==="auto"?Yt.map(un=>L3(un)):[ln];let Ar=!1;for(let un=0;un<En.length;un++){const Xn=En[un];if(!De.horizontal[Xn])if(Ar)De.horizontal[Xn]=De.horizontal[0];else{const _r=I3(je,l,f,A,xe,xn,Tt,"center",Xn,Gt,We,ec.horizontal,!1,$e,Le);_r&&(De.horizontal[Xn]=_r,Ar=_r.positionedLines.length===1)}}zn("left")}else{if(ln==="auto"&&(ln=L3(jt)),Bt||W.get("text-writing-mode").indexOf("horizontal")>=0||!xi(Ft)){const En=I3(je,l,f,A,xe,xn,Tt,jt,ln,Gt,We,ec.horizontal,!1,$e,Le);En&&(De.horizontal[ln]=En)}zn(Bt?"left":ln)}}let bt=!1;if(de.icon&&de.icon.name){const Ft=p[de.icon.name];Ft&&(Ze=Ide(A[de.icon.name],W.get("icon-offset").evaluate(de,{},M),W.get("icon-anchor").evaluate(de,{},M)),bt=Ft.sdf,c.sdfIcons===void 0?c.sdfIcons=Ft.sdf:c.sdfIcons!==Ft.sdf&&$t("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ft.pixelRatio!==c.pixelRatio||W.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}const _t=uj(De.horizontal)||De.vertical;c.iconsInText||(c.iconsInText=!!_t&&_t.iconsInText),(_t||Ze)&&zde(c,de,De,Ze,p,ee,$e,0,We,bt,C,M,U)}b&&c.generateCollisionDebugBuffers(N,c.collisionBoxArray)}function L3(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function zde(c,l,f,p,A,b,C,M,N,U,W,K,ee){let oe=b.textMaxSize.evaluate(l,{},K);oe===void 0&&(oe=C);const le=c.layers[0].layout,de=le.get("icon-offset").evaluate(l,{},K),xe=uj(f.horizontal)||f.vertical,Le=ee.name==="globe",$e=Qs,De=C/$e,je=c.tilePixelRatio*oe/$e,Ze=(jt=c.overscaling,c.zoom>18&&jt>2&&(jt>>=1),Math.max(Kn/(512*jt),1)*le.get("symbol-spacing")),We=le.get("text-padding")*c.tilePixelRatio,bt=le.get("icon-padding")*c.tilePixelRatio,_t=me(le.get("text-max-angle")),Ft=le.get("text-rotation-alignment")==="map"&&le.get("symbol-placement")!=="point",tn=le.get("icon-rotation-alignment")==="map"&&le.get("symbol-placement")!=="point",Tt=le.get("symbol-placement"),Gt=Ze/2;var jt;const Yt=le.get("icon-text-fit");let ln;p&&Yt!=="none"&&(c.allowVerticalPlacement&&f.vertical&&(ln=YG(p,f.vertical,Yt,le.get("icon-text-fit-padding"),de,De)),xe&&(p=YG(p,xe,Yt,le.get("icon-text-fit-padding"),de,De)));const Bt=(xn,zn,En)=>{if(zn.x<0||zn.x>=Kn||zn.y<0||zn.y>=Kn)return;let Ar=null;if(Le){const{x:un,y:Xn,z:_r}=ee.projectTilePoint(zn.x,zn.y,En);Ar={anchor:new Fp(un,Xn,_r,0,void 0),up:ee.upVector(En,zn.x,zn.y)}}(function(un,Xn,_r,ei,yr,nr,Hi,wr,Er,Ci,Di,Bi,Pi,uo,To,Xo,Ii,ds,Zo,_o,ri,Yo,Ni,hl,Qo){const Ks=un.addToLineVertexArray(Xn,ei);let Fs,dl,ks,nh,uy,qx,Xx,jj=0,Vj=0,$j=0,Hj=0,X3=-1,Z3=-1;const cd={};let Wj=$L("");const r0=_r?_r.anchor:Xn;let Y3=0,Q3=0;if(Er._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Y3,Q3]=Er.layout.get("text-offset").evaluate(ri,{},Qo).map(Au=>Au*Qs):(Y3=Er.layout.get("text-radial-offset").evaluate(ri,{},Qo)*Qs,Q3=R3),un.allowVerticalPlacement&&yr.vertical){const Au=yr.vertical;if(To)qx=D3(Au),wr&&(Xx=D3(wr));else{const _u=Er.layout.get("text-rotate").evaluate(ri,{},Qo)+90;ks=X2(Ci,r0,Xn,Di,Bi,Pi,Au,uo,_u,Xo),wr&&(nh=X2(Ci,r0,Xn,Di,Bi,Pi,wr,ds,_u))}}if(nr){const Au=Er.layout.get("icon-rotate").evaluate(ri,{},Qo),_u=Er.layout.get("icon-text-fit")!=="none",Zx=oj(nr,Au,Ni,_u),J3=wr?oj(wr,Au,Ni,_u):void 0;dl=X2(Ci,r0,Xn,Di,Bi,Pi,nr,ds,Au),jj=4*Zx.length;const qj=un.iconSizeData;let i0=null;qj.kind==="source"?(i0=[Jf*Er.layout.get("icon-size").evaluate(ri,{},Qo)],i0[0]>em&&$t(`${un.layerIds[0]}: Value for "icon-size" is >= ${zx}. Reduce your "icon-size".`)):qj.kind==="composite"&&(i0=[Jf*Yo.compositeIconSizes[0].evaluate(ri,{},Qo),Jf*Yo.compositeIconSizes[1].evaluate(ri,{},Qo)],(i0[0]>em||i0[1]>em)&&$t(`${un.layerIds[0]}: Value for "icon-size" is >= ${zx}. Reduce your "icon-size".`)),un.addSymbols(un.icon,Zx,i0,_o,Zo,ri,!1,_r,Xn,Ks.lineStartIndex,Ks.lineLength,-1,hl,Qo),X3=un.icon.placedSymbolArray.length-1,J3&&(Vj=4*J3.length,un.addSymbols(un.icon,J3,i0,_o,Zo,ri,ec.vertical,_r,Xn,Ks.lineStartIndex,Ks.lineLength,-1,hl,Qo),Z3=un.icon.placedSymbolArray.length-1)}for(const Au in yr.horizontal){const _u=yr.horizontal[Au];Fs||(Wj=$L(_u.text),To?uy=D3(_u):Fs=X2(Ci,r0,Xn,Di,Bi,Pi,_u,uo,Er.layout.get("text-rotate").evaluate(ri,{},Qo),Xo));const Zx=_u.positionedLines.length===1;if($j+=lj(un,_r,Xn,_u,Hi,Er,To,ri,Xo,Ks,yr.vertical?ec.horizontal:ec.horizontalOnly,Zx?Object.keys(yr.horizontal):[Au],cd,X3,Yo,hl,Qo),Zx)break}yr.vertical&&(Hj+=lj(un,_r,Xn,yr.vertical,Hi,Er,To,ri,Xo,Ks,ec.vertical,["vertical"],cd,Z3,Yo,hl,Qo));let sm=-1;const K3=(Au,_u)=>Au?Math.max(Au,_u):_u;sm=K3(uy,sm),sm=K3(qx,sm),sm=K3(Xx,sm);const dpe=sm>-1?1:0;un.glyphOffsetArray.length>=nm.MAX_GLYPHS&&$t("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ri.sortKey!==void 0&&un.addToSortKeyRanges(un.symbolInstances.length,ri.sortKey),un.symbolInstances.emplaceBack(r0.x,r0.y,r0.z,Xn.x,Xn.y,cd.right>=0?cd.right:-1,cd.center>=0?cd.center:-1,cd.left>=0?cd.left:-1,cd.vertical>=0?cd.vertical:-1,X3,Z3,Wj,Fs!==void 0?Fs:un.collisionBoxArray.length,Fs!==void 0?Fs+1:un.collisionBoxArray.length,ks!==void 0?ks:un.collisionBoxArray.length,ks!==void 0?ks+1:un.collisionBoxArray.length,dl!==void 0?dl:un.collisionBoxArray.length,dl!==void 0?dl+1:un.collisionBoxArray.length,nh||un.collisionBoxArray.length,nh?nh+1:un.collisionBoxArray.length,Di,$j,Hj,jj,Vj,dpe,0,Y3,Q3,sm)})(c,zn,Ar,xn,f,p,A,ln,c.layers[0],c.collisionBoxArray,l.index,l.sourceLayerIndex,c.index,We,Ft,N,0,bt,tn,de,l,b,U,W,K)};if(Tt==="line")for(const xn of nj(l.geometry,0,0,Kn,Kn)){const zn=Ode(xn,Ze,_t,f.vertical||xe,p,$e,je,c.overscaling,Kn);for(const En of zn)xe&&Ude(c,xe.text,Gt,En)||Bt(xn,En,K)}else if(Tt==="line-center"){for(const xn of l.geometry)if(xn.length>1){const zn=Mde(xn,_t,f.vertical||xe,p,$e,je);zn&&Bt(xn,zn,K)}}else if(l.type==="Polygon")for(const xn of v3(l.geometry,0)){const zn=Bde(xn,16);Bt(xn[0],new Fp(zn.x,zn.y,0,0,void 0),K)}else if(l.type==="LineString")for(const xn of l.geometry)Bt(xn,new Fp(xn[0].x,xn[0].y,0,0,void 0),K);else if(l.type==="Point")for(const xn of l.geometry)for(const zn of xn)Bt([zn],new Fp(zn.x,zn.y,0,0,void 0),K)}const zx=255,em=zx*Jf;function lj(c,l,f,p,A,b,C,M,N,U,W,K,ee,oe,le,de,xe){const Le=function(je,Ze,We,bt,_t,Ft,tn,Tt){const Gt=[];if(Ze.positionedLines.length===0)return Gt;const jt=bt.layout.get("text-rotate").evaluate(Ft,{})*Math.PI/180,Yt=function(En){const Ar=En[0],un=En[1],Xn=Ar*un;return Xn>0?[Ar,-un]:Xn<0?[-Ar,un]:Ar===0?[un,Ar]:[un,-Ar]}(We);let ln=Math.abs(Ze.top-Ze.bottom);for(const En of Ze.positionedLines)ln-=En.lineOffset;const Bt=Ze.positionedLines.length,xn=ln/Bt;let zn=Ze.top-We[1];for(let En=0;En<Bt;++En){const Ar=Ze.positionedLines[En];zn=Rde(Ze,xn,zn,En);for(const un of Ar.positionedGlyphs){if(!un.rect)continue;const Xn=un.rect||{};let _r=jG+1,ei=!0,yr=1,nr=0;if(un.imageName){const Ni=tn[un.imageName];if(!Ni)continue;if(Ni.sdf){$t("SDF images are not supported in formatted text and will be ignored.");continue}ei=!1,yr=Ni.pixelRatio,_r=$l/yr}const Hi=(_t||Tt)&&un.vertical,wr=un.metrics.advance*un.scale/2,Er=un.metrics,Ci=un.rect;if(Ci===null)continue;Tt&&Ze.verticalizable&&(nr=un.imageName?wr-un.metrics.width*un.scale/2:0);const Di=_t?[un.x+wr,un.y]:[0,0];let Bi=[0,0],Pi=[0,0],uo=!1;_t||(Hi?(Pi=[un.x+wr+Yt[0],un.y+Yt[1]-nr],uo=!0):Bi=[un.x+wr+We[0],un.y+We[1]-nr]);const To=Ci.w*un.scale/(yr*(un.localGlyph?eh:1)),Xo=Ci.h*un.scale/(yr*(un.localGlyph?eh:1));let Ii,ds,Zo,_o;if(Hi){const Ni=un.y-zn,hl=new re(-wr,wr-Ni),Qo=-Math.PI/2,Ks=new re(...Pi);Ii=new re(-wr+Bi[0],Bi[1]),Ii._rotateAround(Qo,hl)._add(Ks),Ii.x+=-Ni+wr,Ii.y-=(Er.left-_r)*un.scale;const Fs=un.imageName?Er.advance*un.scale:Qs*un.scale,dl=String.fromCharCode(un.glyph);dde(dl)?Ii.x+=(1-_r)*un.scale:pde(dl)?Ii.x+=Fs-Er.height*un.scale+(-_r-1)*un.scale:Ii.x+=un.imageName||Er.width+2*_r===Ci.w&&Er.height+2*_r===Ci.h?(Fs-Xo)/2:(Fs-(Er.height+2*_r)*un.scale)/2,ds=new re(Ii.x,Ii.y-To),Zo=new re(Ii.x+Xo,Ii.y),_o=new re(Ii.x+Xo,Ii.y-To)}else{const Ni=(Er.left-_r)*un.scale-wr+Bi[0],hl=(-Er.top-_r)*un.scale+Bi[1],Qo=Ni+To,Ks=hl+Xo;Ii=new re(Ni,hl),ds=new re(Qo,hl),Zo=new re(Ni,Ks),_o=new re(Qo,Ks)}if(jt){let Ni;Ni=_t?new re(0,0):uo?new re(Yt[0],Yt[1]):new re(We[0],We[1]),Ii._rotateAround(jt,Ni),ds._rotateAround(jt,Ni),Zo._rotateAround(jt,Ni),_o._rotateAround(jt,Ni)}const ri=new re(0,0),Yo=new re(0,0);Gt.push({tl:Ii,tr:ds,bl:Zo,br:_o,tex:Xn,writingMode:Ze.writingMode,glyphOffset:Di,sectionIndex:un.sectionIndex,isSDF:ei,pixelOffsetTL:ri,pixelOffsetBR:Yo,minFontScaleX:0,minFontScaleY:0})}}return Gt}(0,p,N,b,C,M,A,c.allowVerticalPlacement),$e=c.textSizeData;let De=null;$e.kind==="source"?(De=[Jf*b.layout.get("text-size").evaluate(M,{},xe)],De[0]>em&&$t(`${c.layerIds[0]}: Value for "text-size" is >= ${zx}. Reduce your "text-size".`)):$e.kind==="composite"&&(De=[Jf*le.compositeTextSizes[0].evaluate(M,{},xe),Jf*le.compositeTextSizes[1].evaluate(M,{},xe)],(De[0]>em||De[1]>em)&&$t(`${c.layerIds[0]}: Value for "text-size" is >= ${zx}. Reduce your "text-size".`)),c.addSymbols(c.text,Le,De,N,C,M,W,l,f,U.lineStartIndex,U.lineLength,oe,de,xe);for(const je of K)ee[je]=c.text.placedSymbolArray.length-1;return 4*Le.length}function uj(c){for(const l in c)return c[l];return null}function X2(c,l,f,p,A,b,C,M,N,U){let W=C.top,K=C.bottom,ee=C.left,oe=C.right;const le=C.collisionPadding;if(le&&(ee-=le[0],W-=le[1],oe+=le[2],K+=le[3]),N){const de=new re(ee,W),xe=new re(oe,W),Le=new re(ee,K),$e=new re(oe,K),De=me(N);let je=new re(0,0);U&&(je=new re(U[0],U[1])),de._rotateAround(De,je),xe._rotateAround(De,je),Le._rotateAround(De,je),$e._rotateAround(De,je),ee=Math.min(de.x,xe.x,Le.x,$e.x),oe=Math.max(de.x,xe.x,Le.x,$e.x),W=Math.min(de.y,xe.y,Le.y,$e.y),K=Math.max(de.y,xe.y,Le.y,$e.y)}return c.emplaceBack(l.x,l.y,l.z,f.x,f.y,ee,W,oe,K,M,p,A,b),c.length-1}function D3(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const l=c.bottom-c.top;return l>0?Math.max(10,l):null}function Ude(c,l,f,p){const A=c.compareText;if(l in A){const b=A[l];for(let C=b.length-1;C>=0;C--)if(p.dist(b[C])<f)return!0}else A[l]=[];return A[l].push(p),!1}function cj(c,l){const f=c.fovAboveCenter,p=c.elevation?c.elevation.getMinElevationBelowMSL()*l:0,A=(c._camera.position[2]*c.worldSize-p)/Math.cos(c._pitch),b=Math.sin(f)*A/Math.sin(Math.max(Math.PI/2-c._pitch-f,.01)),C=Math.sin(c._pitch)*b+A;return Math.min(1.01*C,A*(1/c._horizonShift))}function t0(c,l){if(!l.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:l};const f=Math.pow(2,-c.z),p=c.x*f,A=(c.x+1)*f,b=c.y*f,C=(c.y+1)*f,M=Ju(p),N=Ju(A),U=ya(b),W=ya(C),K=l.project(M,U),ee=l.project(N,U),oe=l.project(N,W),le=l.project(M,W);let de=Math.min(K.x,ee.x,oe.x,le.x),xe=Math.min(K.y,ee.y,oe.y,le.y),Le=Math.max(K.x,ee.x,oe.x,le.x),$e=Math.max(K.y,ee.y,oe.y,le.y);const De=f/16;function je(We,bt,_t,Ft,tn,Tt){const Gt=(_t+tn)/2,jt=(Ft+Tt)/2,Yt=l.project(Ju(Gt),ya(jt)),ln=Math.max(0,de-Yt.x,xe-Yt.y,Yt.x-Le,Yt.y-$e);de=Math.min(de,Yt.x),Le=Math.max(Le,Yt.x),xe=Math.min(xe,Yt.y),$e=Math.max($e,Yt.y),ln>De&&(je(We,Yt,_t,Ft,Gt,jt),je(Yt,bt,Gt,jt,tn,Tt))}je(K,ee,p,b,A,b),je(ee,oe,A,b,A,C),je(oe,le,A,C,p,C),je(le,K,p,C,p,b),de-=De,xe-=De,Le+=De,$e+=De;const Ze=1/Math.max(Le-de,$e-xe);return{scale:Ze,x:de*Ze,y:xe*Ze,x2:Le*Ze,y2:$e*Ze,projection:l}}const Gde=Yf(new Float32Array(16));class tm{constructor(l){this.spec=l,this.name=l.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(l,f){return{x:0,y:0,z:0}}unproject(l,f){return new Ti(0,0)}projectTilePoint(l,f,p){return{x:l,y:f,z:0}}locationPoint(l,f,p=!0){return l._coordinatePoint(l.locationCoordinate(f),p)}pixelsPerMeter(l,f){return Kf(1,l)*f}pixelSpaceConversion(l,f,p){return 1}farthestPixelDistance(l){return cj(l,l.pixelsPerMeter)}pointCoordinate(l,f,p,A){const b=l.horizonLineFromTop(!1),C=new re(f,Math.max(b,p));return l.rayIntersectionCoordinate(l.pointRayIntersection(C,A))}pointCoordinate3D(l,f,p){const A=new re(f,p);if(l.elevation)return l.elevation.pointCoordinate(A);{const b=this.pointCoordinate(l,A.x,A.y,0);return[b.x,b.y,b.z]}}isPointAboveHorizon(l,f){if(l.elevation)return!this.pointCoordinate3D(l,f.x,f.y);const p=l.horizonLineFromTop();return f.y<p}createInversionMatrix(l,f){return Gde}createTileMatrix(l,f,p){let A,b,C;const M=p.canonical,N=Yf(new Float64Array(16));if(this.isReprojectedInTileSpace){const U=t0(M,this);A=1,b=U.x+p.wrap*U.scale,C=U.y,XA(N,N,[A/U.scale,A/U.scale,l.pixelsPerMeter/f])}else A=f/l.zoomScale(M.z),b=(M.x+Math.pow(2,M.z)*p.wrap)*A,C=M.y*A;return mx(N,N,[b,C,0]),XA(N,N,[A/Kn,A/Kn,1]),N}upVector(l,f,p){return[0,0,1]}upVectorScale(l,f,p){return{metersToTile:1}}}class jde extends tm{constructor(l){super(l),this.range=[4,7],this.center=l.center||[-96,37.5];const[f,p]=this.parallels=l.parallels||[29.5,45.5],A=Math.sin(me(f));this.n=(A+Math.sin(me(p)))/2,this.c=1+A*(2*this.n-A),this.r0=Math.sqrt(this.c)/this.n}project(l,f){const{n:p,c:A,r0:b}=this,C=me(l-this.center[0]),M=me(f),N=Math.sqrt(A-2*p*Math.sin(M))/p;return{x:N*Math.sin(C*p),y:N*Math.cos(C*p)-b,z:0}}unproject(l,f){const{n:p,c:A,r0:b}=this,C=b+f;let M=Math.atan2(l,Math.abs(C))*Math.sign(C);C*p<0&&(M-=Math.PI*Math.sign(l)*Math.sign(C));const N=me(this.center[0])*p;M=Be(M,-Math.PI-N,Math.PI-N);const U=Ee(Ce(M/p)+this.center[0],-180,180),W=Math.asin(Ee((A-(l*l+C*C)*p*p)/(2*p),-1,1)),K=Ee(Ce(W),-va,va);return new Ti(U,K)}}const Ux=1.340264,Gx=-.081106,jx=893e-6,Vx=.003796,Z2=Math.sqrt(3)/2;class Vde extends tm{project(l,f){f=f/180*Math.PI,l=l/180*Math.PI;const p=Math.asin(Z2*Math.sin(f)),A=p*p,b=A*A*A;return{x:.5*(l*Math.cos(p)/(Z2*(Ux+3*Gx*A+b*(7*jx+9*Vx*A)))/Math.PI+.5),y:1-.5*(p*(Ux+Gx*A+b*(jx+Vx*A))/Math.PI+1),z:0}}unproject(l,f){l=(2*l-.5)*Math.PI;let p=f=(2*(1-f)-1)*Math.PI,A=p*p,b=A*A*A;for(let W,K,ee,oe=0;oe<12&&(K=p*(Ux+Gx*A+b*(jx+Vx*A))-f,ee=Ux+3*Gx*A+b*(7*jx+9*Vx*A),W=K/ee,p=Ee(p-W,-Math.PI/3,Math.PI/3),A=p*p,b=A*A*A,!(Math.abs(W)<1e-12));++oe);const C=Z2*l*(Ux+3*Gx*A+b*(7*jx+9*Vx*A))/Math.cos(p),M=Math.asin(Math.sin(p)/Z2),N=Ee(180*C/Math.PI,-180,180),U=Ee(180*M/Math.PI,-va,va);return new Ti(N,U)}}class $de extends tm{constructor(l){super(l),this.wrap=!0,this.supportsWorldCopies=!0}project(l,f){return{x:.5+l/360,y:.5-f/360,z:0}}unproject(l,f){const p=360*(l-.5),A=Ee(360*(.5-f),-va,va);return new Ti(p,A)}}const ay=Math.PI/2;function Y2(c){return Math.tan((ay+c)/2)}class Hde extends tm{constructor(l){super(l),this.center=l.center||[0,30];const[f,p]=this.parallels=l.parallels||[30,30];let A=me(f),b=me(p);this.southernCenter=A+b<0,this.southernCenter&&(A=-A,b=-b);const C=Math.cos(A),M=Y2(A);this.n=A===b?Math.sin(A):Math.log(C/Math.cos(b))/Math.log(Y2(b)/M),this.f=C*Math.pow(Y2(A),this.n)/this.n}project(l,f){f=me(f),this.southernCenter&&(f=-f),l=me(l-this.center[0]);const p=1e-6,{n:A,f:b}=this;b>0?f<-ay+p&&(f=-ay+p):f>ay-p&&(f=ay-p);const C=b/Math.pow(Y2(f),A);let M=C*Math.sin(A*l),N=b-C*Math.cos(A*l);return M=.5*(M/Math.PI+.5),N=.5*(N/Math.PI+.5),{x:M,y:this.southernCenter?N:1-N,z:0}}unproject(l,f){l=(2*l-.5)*Math.PI,this.southernCenter&&(f=1-f),f=(2*(1-f)-.5)*Math.PI;const{n:p,f:A}=this,b=A-f,C=Math.sign(b),M=Math.sign(p)*Math.sqrt(l*l+b*b);let N=Math.atan2(l,Math.abs(b))*C;b*p<0&&(N-=Math.PI*Math.sign(l)*C);const U=Ee(Ce(N/p)+this.center[0],-180,180),W=Ee(Ce(2*Math.atan(Math.pow(A/M,1/p))-ay),-va,va);return new Ti(U,this.southernCenter?-W:W)}}class fj extends tm{constructor(l){super(l),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(l,f){return{x:od(l),y:sd(f),z:0}}unproject(l,f){const p=Ju(l),A=ya(f);return new Ti(p,A)}}const hj=me(va);class Wde extends tm{project(l,f){const p=(f=me(f))*f,A=p*p;return{x:.5*((l=me(l))*(.8707-.131979*p+A*(A*(.003971*p-.001529*A)-.013791))/Math.PI+.5),y:1-.5*(f*(1.007226+p*(.015085+A*(.028874*p-.044475-.005916*A)))/Math.PI+1),z:0}}unproject(l,f){l=(2*l-.5)*Math.PI;let p=f=(2*(1-f)-1)*Math.PI,A=25,b=0,C=p*p;do{C=p*p;const U=C*C;b=(p*(1.007226+C*(.015085+U*(.028874*C-.044475-.005916*U)))-f)/(1.007226+C*(.045255+U*(.259866*C-.311325-.005916*11*U))),p=Ee(p-b,-hj,hj)}while(Math.abs(b)>1e-6&&--A>0);C=p*p;const M=Ee(Ce(l/(.8707+C*(C*(C*C*C*(.003971-.001529*C)-.013791)-.131979))),-180,180),N=Ce(p);return new Ti(M,N)}}const dj=me(va);class qde extends tm{project(l,f){f=me(f),l=me(l);const p=Math.cos(f),A=2/Math.PI,b=Math.acos(p*Math.cos(l/2)),C=Math.sin(b)/b,M=.5*(l*A+2*p*Math.sin(l/2)/C)||0,N=.5*(f+Math.sin(f)/C)||0;return{x:.5*(M/Math.PI+.5),y:1-.5*(N/Math.PI+1),z:0}}unproject(l,f){let p=l=(2*l-.5)*Math.PI,A=f=(2*(1-f)-1)*Math.PI,b=25;const C=1e-6;let M=0,N=0;do{const U=Math.cos(A),W=Math.sin(A),K=2*W*U,ee=W*W,oe=U*U,le=Math.cos(p/2),de=Math.sin(p/2),xe=2*le*de,Le=de*de,$e=1-oe*le*le,De=$e?1/$e:0,je=$e?Math.acos(U*le)*Math.sqrt(1/$e):0,Ze=.5*(2*je*U*de+2*p/Math.PI)-l,We=.5*(je*W+A)-f,bt=.5*De*(oe*Le+je*U*le*ee)+1/Math.PI,_t=De*(xe*K/4-je*W*de),Ft=.125*De*(K*de-je*W*oe*xe),tn=.5*De*(ee*le+je*Le*U)+.5,Tt=_t*Ft-tn*bt;M=(We*_t-Ze*tn)/Tt,N=(Ze*Ft-We*bt)/Tt,p=Ee(p-M,-Math.PI,Math.PI),A=Ee(A-N,-dj,dj)}while((Math.abs(M)>C||Math.abs(N)>C)&&--b>0);return new Ti(Ce(p),Ce(A))}}class pj extends tm{constructor(l){super(l),this.center=l.center||[0,0],this.parallels=l.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(me(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(l,f){const{scale:p,cosPhi:A}=this;return{x:me(l)*A*p+.5,y:-Math.sin(me(f))/A*p+.5,z:0}}unproject(l,f){const{scale:p,cosPhi:A}=this,b=-(f-.5)/p,C=Ee(Ce((l-.5)/p)/A,-180,180),M=Math.asin(Ee(b*A,-1,1)),N=Ee(Ce(M),-va,va);return new Ti(C,N)}}class Xde extends fj{constructor(l){super(l),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(l,f,p){const A=Ex(l,f,p);return Fo(A,A,Sx(id(p))),{x:A[0],y:A[1],z:A[2]}}locationPoint(l,f){const p=W_(f.lat,f.lng),A=ul([],p),b=l.elevation?l.elevation.getAtPointOrZero(l.locationCoordinate(f),l._centerAltitude):l._centerAltitude;vx(p,p,A,Kf(1,0)*Kn*b);const C=Yf(new Float64Array(16));return qA(C,l.pixelMatrix,l.globeMatrix),Fo(p,p,C),new re(p[0],p[1])}pixelsPerMeter(l,f){return Kf(1,0)*f}pixelSpaceConversion(l,f,p){const A=Kf(1,l)*f,b=jr(Kf(1,45)*f,A,p);return this.pixelsPerMeter(l,f)/b}createTileMatrix(l,f,p){const A=i3(id(p.canonical));return qA(new Float64Array(16),l.globeMatrix,A)}createInversionMatrix(l,f){const{center:p}=l,A=Sx(id(f));return E2(A,A,me(p.lng)),XL(A,A,me(p.lat)),XA(A,A,[l._pixelsPerMercatorPixel,l._pixelsPerMercatorPixel,1]),Float32Array.from(A)}pointCoordinate(l,f,p,A){return G8(l,f,p,!0)||new X_(0,0)}pointCoordinate3D(l,f,p){const A=this.pointCoordinate(l,f,p,0);return[A.x,A.y,A.z]}isPointAboveHorizon(l,f){return!G8(l,f.x,f.y,!1)}farthestPixelDistance(l){const f=function(A,b){const C=A.cameraToCenterDistance,M=A._centerAltitude*b,N=A._camera,U=A._camera.forward(),W=Lp([],Ku([],U,-C),[0,0,M]),K=A.worldSize/(2*Math.PI),ee=[0,0,-K],oe=A.width/A.height,le=Math.tan(A.fovAboveCenter),de=Ku([],N.up(),le),xe=Ku([],N.right(),le*oe),Le=ul([],Lp([],Lp([],U,de),xe)),$e=[];let De;if(new KL(W,Le).closestPointOnSphere(ee,K,$e)){const je=Lp([],$e,ee),Ze=Qf([],je,W);De=Math.cos(A.fovAboveCenter)*Ax(Ze)}else{const je=Qf([],W,ee),Ze=Qf([],ee,W);ul(Ze,Ze);const We=Ax(je)-K;De=Math.sqrt(We*(We+2*K));const bt=Math.acos(De/(K+We))-Math.acos(qc(U,Ze));De*=Math.cos(bt)}return 1.01*De}(l,this.pixelsPerMeter(l.center.lat,l.worldSize)),p=q_(l.zoom);if(p>0){const A=cj(l,Kf(1,l.center.lat)*l.worldSize),b=l.worldSize/(2*Math.PI),C=Math.max(l.width,l.height)/l.worldSize*Math.PI;return jr(f,A+b*(1-Math.cos(C)),Math.pow(p,10))}return f}upVector(l,f,p){return Ex(f,p,l,1)}upVectorScale(l){return{metersToTile:S2(C2(id(l)))}}}function gj(c){const l=c.parallels,f=!!l&&Math.abs(l[0]+l[1])<.01;switch(c.name){case"mercator":return new fj(c);case"equirectangular":return new $de(c);case"naturalEarth":return new Wde(c);case"equalEarth":return new Vde(c);case"winkelTripel":return new qde(c);case"albers":return f?new pj(c):new jde(c);case"lambertConformalConic":return f?new pj(c):new Hde(c);case"globe":return new Xde(c)}throw new Error(`Invalid projection name: ${c.name}`)}const Zde=F2.types,Yde=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Q2(c,l,f,p,A,b,C,M,N,U,W,K,ee){const oe=M?Math.min(em,Math.round(M[0])):0,le=M?Math.min(em,Math.round(M[1])):0;c.emplaceBack(l,f,Math.round(32*p),Math.round(32*A),b,C,(oe<<1)+(N?1:0),le,16*U,16*W,256*K,256*ee)}function K2(c,l,f,p,A,b,C){c.emplaceBack(l,f,p,A,b,C)}function J2(c,l,f,p,A){c.emplaceBack(l,f,p,A),c.emplaceBack(l,f,p,A),c.emplaceBack(l,f,p,A),c.emplaceBack(l,f,p,A)}function Qde(c){for(const l of c.sections)if(VL(l.text))return!0;return!1}class B3{constructor(l){this.layoutVertexArray=new Ht,this.indexArray=new Vn,this.programConfigurations=l,this.segments=new Wo,this.dynamicLayoutVertexArray=new Kt,this.opacityVertexArray=new Wn,this.placedSymbolArray=new Ho,this.globeExtVertexArray=new an}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,f,p,A){this.isEmpty()||(p&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,ode.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,ade.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,Yde,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=l.createVertexBuffer(this.globeExtVertexArray,sde.members,!0)),this.opacityVertexBuffer.itemSize=1),(p||A)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Mt(B3,"SymbolBuffers");class N3{constructor(l,f,p){this.layoutVertexArray=new l,this.layoutAttributes=f,this.indexArray=new p,this.segments=new Wo,this.collisionVertexArray=new Fr,this.collisionVertexArrayExt=new Nr}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,lde.members,!0),this.collisionVertexBufferExt=l.createVertexBuffer(this.collisionVertexArrayExt,ude.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Mt(N3,"CollisionBuffers");class nm{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(C=>C.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Yf([]),this.placementViewportMatrix=Yf([]);const f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=E3(this.zoom,f["text-size"]),this.iconSizeData=E3(this.zoom,f["icon-size"]);const p=this.layers[0].layout,A=p.get("symbol-sort-key"),b=p.get("symbol-z-order");this.canOverlap=p.get("text-allow-overlap")||p.get("icon-allow-overlap")||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&A.constantOr(1)!==void 0,this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=p.get("text-writing-mode").map(C=>ec[C]),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.sourceID=l.sourceID,this.projection=l.projection}createArrays(){this.text=new B3(new WA(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new B3(new WA(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new ll,this.lineVertexArray=new G_,this.symbolInstances=new Yi}calculateGlyphDependencies(l,f,p,A,b){for(let C=0;C<l.length;C++)if(f[l.charCodeAt(C)]=!0,A&&b){const M=Nx[l.charAt(C)];M&&(f[M.charCodeAt(0)]=!0)}}populate(l,f,p,A){const b=this.layers[0],C=b.layout,M=this.projection.name==="globe",N=C.get("text-font"),U=C.get("text-field"),W=C.get("icon-image"),K=(U.value.kind!=="constant"||U.value.value instanceof da&&!U.value.value.isEmpty()||U.value.value.toString().length>0)&&(N.value.kind!=="constant"||N.value.value.length>0),ee=W.value.kind!=="constant"||!!W.value.value||Object.keys(W.parameters).length>0,oe=C.get("symbol-sort-key");if(this.features=[],!K&&!ee)return;const le=f.iconDependencies,de=f.glyphDependencies,xe=f.availableImages,Le=new Q(this.zoom);for(const{feature:$e,id:De,index:je,sourceLayerIndex:Ze}of l){const We=b._featureFilter.needGeometry,bt=KA($e,We);if(!b._featureFilter.filter(Le,bt,p))continue;if(We||(bt.geometry=Dp($e,p,A)),M&&$e.type!==1&&p.z<=5){const Tt=bt.geometry,Gt=.98078528056,jt=(Yt,ln)=>qc(Ex(Yt.x,Yt.y,p,1),Ex(ln.x,ln.y,p,1))<Gt;for(let Yt=0;Yt<Tt.length;Yt++)Tt[Yt]=ahe(Tt[Yt],jt)}let _t,Ft;if(K){const Tt=b.getValueAndResolveTokens("text-field",bt,p,xe),Gt=da.factory(Tt);Qde(Gt)&&(this.hasRTLText=!0),(!this.hasRTLText||L()==="unavailable"||this.hasRTLText&&H.isParsed())&&(_t=hde(Gt,b,bt))}if(ee){const Tt=b.getValueAndResolveTokens("icon-image",bt,p,xe);Ft=Tt instanceof il?Tt:il.fromString(Tt)}if(!_t&&!Ft)continue;const tn=this.sortFeaturesByKey?oe.evaluate(bt,{},p):void 0;if(this.features.push({id:De,text:_t,icon:Ft,index:je,sourceLayerIndex:Ze,geometry:bt.geometry,properties:$e.properties,type:Zde[$e.type],sortKey:tn}),Ft&&(le[Ft.name]=!0),_t){const Tt=N.evaluate(bt,{},p).join(","),Gt=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ec.vertical)>=0;for(const jt of _t.sections)if(jt.image)le[jt.image.name]=!0;else{const Yt=xi(_t.toString()),ln=jt.fontStack||Tt,Bt=de[ln]=de[ln]||{};this.calculateGlyphDependencies(jt.text,Bt,Gt,this.allowVerticalPlacement,Yt)}}}C.get("symbol-placement")==="line"&&(this.features=function($e){const De={},je={},Ze=[];let We=0;function bt(Tt){Ze.push($e[Tt]),We++}function _t(Tt,Gt,jt){const Yt=je[Tt];return delete je[Tt],je[Gt]=Yt,Ze[Yt].geometry[0].pop(),Ze[Yt].geometry[0]=Ze[Yt].geometry[0].concat(jt[0]),Yt}function Ft(Tt,Gt,jt){const Yt=De[Gt];return delete De[Gt],De[Tt]=Yt,Ze[Yt].geometry[0].shift(),Ze[Yt].geometry[0]=jt[0].concat(Ze[Yt].geometry[0]),Yt}function tn(Tt,Gt,jt){const Yt=jt?Gt[0][Gt[0].length-1]:Gt[0][0];return`${Tt}:${Yt.x}:${Yt.y}`}for(let Tt=0;Tt<$e.length;Tt++){const Gt=$e[Tt],jt=Gt.geometry,Yt=Gt.text?Gt.text.toString():null;if(!Yt){bt(Tt);continue}const ln=tn(Yt,jt),Bt=tn(Yt,jt,!0);if(ln in je&&Bt in De&&je[ln]!==De[Bt]){const xn=Ft(ln,Bt,jt),zn=_t(ln,Bt,Ze[xn].geometry);delete De[ln],delete je[Bt],je[tn(Yt,Ze[zn].geometry,!0)]=zn,Ze[xn].geometry=null}else ln in je?_t(ln,Bt,jt):Bt in De?Ft(ln,Bt,jt):(bt(Tt),De[ln]=We-1,je[Bt]=We-1)}return Ze.filter(Tt=>Tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort(($e,De)=>$e.sortKey-De.sortKey)}update(l,f,p,A){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,f,this.layers,p,A),this.icon.programConfigurations.updatePaintArrays(l,f,this.layers,p,A))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=gj(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,f){const p=this.lineVertexArray.length;if(l.segment!==void 0)for(const{x:A,y:b}of f)this.lineVertexArray.emplaceBack(A,b);return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(l,f,p,A,b,C,M,N,U,W,K,ee,oe,le){const de=l.indexArray,xe=l.layoutVertexArray,Le=l.globeExtVertexArray,$e=l.segments.prepareSegment(4*f.length,xe,de,this.canOverlap?C.sortKey:void 0),De=this.glyphOffsetArray.length,je=$e.vertexLength,Ze=this.allowVerticalPlacement&&M===ec.vertical?Math.PI/2:0,We=C.text&&C.text.sections;for(let _t=0;_t<f.length;_t++){const{tl:Ft,tr:tn,bl:Tt,br:Gt,tex:jt,pixelOffsetTL:Yt,pixelOffsetBR:ln,minFontScaleX:Bt,minFontScaleY:xn,glyphOffset:zn,isSDF:En,sectionIndex:Ar}=f[_t],un=$e.vertexLength,Xn=zn[1];if(Q2(xe,U.x,U.y,Ft.x,Xn+Ft.y,jt.x,jt.y,p,En,Yt.x,Yt.y,Bt,xn),Q2(xe,U.x,U.y,tn.x,Xn+tn.y,jt.x+jt.w,jt.y,p,En,ln.x,Yt.y,Bt,xn),Q2(xe,U.x,U.y,Tt.x,Xn+Tt.y,jt.x,jt.y+jt.h,p,En,Yt.x,ln.y,Bt,xn),Q2(xe,U.x,U.y,Gt.x,Xn+Gt.y,jt.x+jt.w,jt.y+jt.h,p,En,ln.x,ln.y,Bt,xn),N){const{x:_r,y:ei,z:yr}=N.anchor,[nr,Hi,wr]=N.up;K2(Le,_r,ei,yr,nr,Hi,wr),K2(Le,_r,ei,yr,nr,Hi,wr),K2(Le,_r,ei,yr,nr,Hi,wr),K2(Le,_r,ei,yr,nr,Hi,wr),J2(l.dynamicLayoutVertexArray,_r,ei,yr,Ze)}else J2(l.dynamicLayoutVertexArray,U.x,U.y,U.z,Ze);de.emplaceBack(un,un+1,un+2),de.emplaceBack(un+1,un+2,un+3),$e.vertexLength+=4,$e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(zn[0]),_t!==f.length-1&&Ar===f[_t+1].sectionIndex||l.programConfigurations.populatePaintArrays(xe.length,C,C.index,{},oe,le,We&&We[Ar])}const bt=N?N.anchor:U;l.placedSymbolArray.emplaceBack(bt.x,bt.y,bt.z,U.x,U.y,De,this.glyphOffsetArray.length-De,je,W,K,U.segment,p?p[0]:0,p?p[1]:0,A[0],A[1],M,0,!1,0,ee,0)}_commitLayoutVertex(l,f,p,A,b,C,M){l.emplaceBack(f,p,A,b,C,Math.round(M.x),Math.round(M.y))}_addCollisionDebugVertices(l,f,p,A,b,C,M){const N=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),U=N.vertexLength,W=M.tileAnchorX,K=M.tileAnchorY;for(let oe=0;oe<4;oe++)p.collisionVertexArray.emplaceBack(0,0,0,0);p.collisionVertexArrayExt.emplaceBack(f,-l.padding,-l.padding),p.collisionVertexArrayExt.emplaceBack(f,l.padding,-l.padding),p.collisionVertexArrayExt.emplaceBack(f,l.padding,l.padding),p.collisionVertexArrayExt.emplaceBack(f,-l.padding,l.padding),this._commitLayoutVertex(p.layoutVertexArray,A,b,C,W,K,new re(l.x1,l.y1)),this._commitLayoutVertex(p.layoutVertexArray,A,b,C,W,K,new re(l.x2,l.y1)),this._commitLayoutVertex(p.layoutVertexArray,A,b,C,W,K,new re(l.x2,l.y2)),this._commitLayoutVertex(p.layoutVertexArray,A,b,C,W,K,new re(l.x1,l.y2)),N.vertexLength+=4;const ee=p.indexArray;ee.emplaceBack(U,U+1),ee.emplaceBack(U+1,U+2),ee.emplaceBack(U+2,U+3),ee.emplaceBack(U+3,U),N.primitiveLength+=4}_addTextDebugCollisionBoxes(l,f,p,A,b,C){for(let M=A;M<b;M++){const N=p.get(M),U=this.getSymbolInstanceTextSize(l,C,f,M);this._addCollisionDebugVertices(N,U,this.textCollisionBox,N.projectedAnchorX,N.projectedAnchorY,N.projectedAnchorZ,C)}}_addIconDebugCollisionBoxes(l,f,p,A,b,C){for(let M=A;M<b;M++){const N=p.get(M),U=this.getSymbolInstanceIconSize(l,f,C.placedIconSymbolIndex);this._addCollisionDebugVertices(N,U,this.iconCollisionBox,N.projectedAnchorX,N.projectedAnchorY,N.projectedAnchorZ,C)}}generateCollisionDebugBuffers(l,f){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new N3(kn,DG.members,Ns),this.iconCollisionBox=new N3(kn,DG.members,Ns);const p=J_(this.iconSizeData,l),A=J_(this.textSizeData,l);for(let b=0;b<this.symbolInstances.length;b++){const C=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(A,l,f,C.textBoxStartIndex,C.textBoxEndIndex,C),this._addTextDebugCollisionBoxes(A,l,f,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C),this._addIconDebugCollisionBoxes(p,l,f,C.iconBoxStartIndex,C.iconBoxEndIndex,C),this._addIconDebugCollisionBoxes(p,l,f,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C)}}getSymbolInstanceTextSize(l,f,p,A){const b=this.text.placedSymbolArray.get(f.rightJustifiedTextSymbolIndex>=0?f.rightJustifiedTextSymbolIndex:f.centerJustifiedTextSymbolIndex>=0?f.centerJustifiedTextSymbolIndex:f.leftJustifiedTextSymbolIndex>=0?f.leftJustifiedTextSymbolIndex:f.verticalPlacedTextSymbolIndex>=0?f.verticalPlacedTextSymbolIndex:A),C=G2(this.textSizeData,l,b)/Qs;return this.tilePixelRatio*C}getSymbolInstanceIconSize(l,f,p){const A=this.icon.placedSymbolArray.get(p),b=G2(this.iconSizeData,l,A);return this.tilePixelRatio*b}_commitDebugCollisionVertexUpdate(l,f,p){l.emplaceBack(f,-p,-p),l.emplaceBack(f,p,-p),l.emplaceBack(f,p,p),l.emplaceBack(f,-p,p)}_updateTextDebugCollisionBoxes(l,f,p,A,b,C){for(let M=A;M<b;M++){const N=p.get(M),U=this.getSymbolInstanceTextSize(l,C,f,M);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,U,N.padding)}}_updateIconDebugCollisionBoxes(l,f,p,A,b,C){for(let M=A;M<b;M++){const N=p.get(M),U=this.getSymbolInstanceIconSize(l,f,C);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,U,N.padding)}}updateCollisionDebugBuffers(l,f){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=J_(this.iconSizeData,l),A=J_(this.textSizeData,l);for(let b=0;b<this.symbolInstances.length;b++){const C=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(A,l,f,C.textBoxStartIndex,C.textBoxEndIndex,C),this._updateTextDebugCollisionBoxes(A,l,f,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C),this._updateIconDebugCollisionBoxes(p,l,f,C.iconBoxStartIndex,C.iconBoxEndIndex,C.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(p,l,f,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(l,f,p,A,b,C,M,N,U){const W={};if(f<p){const{x1:K,y1:ee,x2:oe,y2:le,padding:de,projectedAnchorX:xe,projectedAnchorY:Le,projectedAnchorZ:$e,tileAnchorX:De,tileAnchorY:je,featureIndex:Ze}=l.get(f);W.textBox={x1:K,y1:ee,x2:oe,y2:le,padding:de,projectedAnchorX:xe,projectedAnchorY:Le,projectedAnchorZ:$e,tileAnchorX:De,tileAnchorY:je},W.textFeatureIndex=Ze}if(A<b){const{x1:K,y1:ee,x2:oe,y2:le,padding:de,projectedAnchorX:xe,projectedAnchorY:Le,projectedAnchorZ:$e,tileAnchorX:De,tileAnchorY:je,featureIndex:Ze}=l.get(A);W.verticalTextBox={x1:K,y1:ee,x2:oe,y2:le,padding:de,projectedAnchorX:xe,projectedAnchorY:Le,projectedAnchorZ:$e,tileAnchorX:De,tileAnchorY:je},W.verticalTextFeatureIndex=Ze}if(C<M){const{x1:K,y1:ee,x2:oe,y2:le,padding:de,projectedAnchorX:xe,projectedAnchorY:Le,projectedAnchorZ:$e,tileAnchorX:De,tileAnchorY:je,featureIndex:Ze}=l.get(C);W.iconBox={x1:K,y1:ee,x2:oe,y2:le,padding:de,projectedAnchorX:xe,projectedAnchorY:Le,projectedAnchorZ:$e,tileAnchorX:De,tileAnchorY:je},W.iconFeatureIndex=Ze}if(N<U){const{x1:K,y1:ee,x2:oe,y2:le,padding:de,projectedAnchorX:xe,projectedAnchorY:Le,projectedAnchorZ:$e,tileAnchorX:De,tileAnchorY:je,featureIndex:Ze}=l.get(N);W.verticalIconBox={x1:K,y1:ee,x2:oe,y2:le,padding:de,projectedAnchorX:xe,projectedAnchorY:Le,projectedAnchorZ:$e,tileAnchorX:De,tileAnchorY:je},W.verticalIconFeatureIndex=Ze}return W}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){const p=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,f){const p=l.placedSymbolArray.get(f),A=p.vertexStartIndex+4*p.numGlyphs;for(let b=p.vertexStartIndex;b<A;b+=4)l.indexArray.emplaceBack(b,b+1,b+2),l.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const f=Math.sin(l),p=Math.cos(l),A=[],b=[],C=[];for(let M=0;M<this.symbolInstances.length;++M){C.push(M);const N=this.symbolInstances.get(M);A.push(0|Math.round(f*N.tileAnchorX+p*N.tileAnchorY)),b.push(N.featureIndex)}return C.sort((M,N)=>A[M]-A[N]||b[N]-b[M]),C}addToSortKeyRanges(l,f){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===f?p.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const f of this.symbolInstanceIndexes){const p=this.symbolInstances.get(f);this.featureSortOrder.push(p.featureIndex);const{rightJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:b,leftJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:M,placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:U}=p;A>=0&&this.addIndicesForPlacedSymbol(this.text,A),b>=0&&b!==A&&this.addIndicesForPlacedSymbol(this.text,b),C>=0&&C!==b&&C!==A&&this.addIndicesForPlacedSymbol(this.text,C),M>=0&&this.addIndicesForPlacedSymbol(this.text,M),N>=0&&this.addIndicesForPlacedSymbol(this.icon,N),U>=0&&this.addIndicesForPlacedSymbol(this.icon,U)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Mt(nm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),nm.MAX_GLYPHS=65535,nm.addDynamicAttributes=J2;const Kde=new ke({"symbol-placement":new he(gt.layout_symbol["symbol-placement"]),"symbol-spacing":new he(gt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new he(gt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Se(gt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new he(gt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new he(gt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new he(gt.layout_symbol["icon-ignore-placement"]),"icon-optional":new he(gt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new he(gt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Se(gt.layout_symbol["icon-size"]),"icon-text-fit":new he(gt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new he(gt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Se(gt.layout_symbol["icon-image"]),"icon-rotate":new Se(gt.layout_symbol["icon-rotate"]),"icon-padding":new he(gt.layout_symbol["icon-padding"]),"icon-keep-upright":new he(gt.layout_symbol["icon-keep-upright"]),"icon-offset":new Se(gt.layout_symbol["icon-offset"]),"icon-anchor":new Se(gt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new he(gt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new he(gt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new he(gt.layout_symbol["text-rotation-alignment"]),"text-field":new Se(gt.layout_symbol["text-field"]),"text-font":new Se(gt.layout_symbol["text-font"]),"text-size":new Se(gt.layout_symbol["text-size"]),"text-max-width":new Se(gt.layout_symbol["text-max-width"]),"text-line-height":new Se(gt.layout_symbol["text-line-height"]),"text-letter-spacing":new Se(gt.layout_symbol["text-letter-spacing"]),"text-justify":new Se(gt.layout_symbol["text-justify"]),"text-radial-offset":new Se(gt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new he(gt.layout_symbol["text-variable-anchor"]),"text-anchor":new Se(gt.layout_symbol["text-anchor"]),"text-max-angle":new he(gt.layout_symbol["text-max-angle"]),"text-writing-mode":new he(gt.layout_symbol["text-writing-mode"]),"text-rotate":new Se(gt.layout_symbol["text-rotate"]),"text-padding":new he(gt.layout_symbol["text-padding"]),"text-keep-upright":new he(gt.layout_symbol["text-keep-upright"]),"text-transform":new Se(gt.layout_symbol["text-transform"]),"text-offset":new Se(gt.layout_symbol["text-offset"]),"text-allow-overlap":new he(gt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new he(gt.layout_symbol["text-ignore-placement"]),"text-optional":new he(gt.layout_symbol["text-optional"])});var F3={paint:new ke({"icon-opacity":new Se(gt.paint_symbol["icon-opacity"]),"icon-color":new Se(gt.paint_symbol["icon-color"]),"icon-halo-color":new Se(gt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Se(gt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Se(gt.paint_symbol["icon-halo-blur"]),"icon-translate":new he(gt.paint_symbol["icon-translate"]),"icon-translate-anchor":new he(gt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Se(gt.paint_symbol["text-opacity"]),"text-color":new Se(gt.paint_symbol["text-color"],{runtimeType:Os,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Se(gt.paint_symbol["text-halo-color"]),"text-halo-width":new Se(gt.paint_symbol["text-halo-width"]),"text-halo-blur":new Se(gt.paint_symbol["text-halo-blur"]),"text-translate":new he(gt.paint_symbol["text-translate"]),"text-translate-anchor":new he(gt.paint_symbol["text-translate-anchor"])}),layout:Kde};class mj{constructor(l){this.type=l.property.overrides?l.property.overrides.runtimeType:cu,this.defaultValue=l}evaluate(l){if(l.formattedSection){const f=this.defaultValue.property.overrides;if(f&&f.hasOverride(l.formattedSection))return f.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Mt(mj,"FormatSectionOverride",{omit:["defaultValue"]});class eS extends Zf{constructor(l){super(l,F3)}recalculate(l,f){super.recalculate(l,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const p=this.layout.get("text-writing-mode");if(p){const A=[];for(const b of p)A.indexOf(b)<0&&A.push(b);this.layout._values["text-writing-mode"]=A}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(l,f,p,A){const b=this.layout.get(l).evaluate(f,{},p,A),C=this._unevaluatedLayout._values[l];return C.isDataDriven()||Zi(C.value)||!b?b:function(M,N){return N.replace(/{([^{}]+)}/g,(U,W)=>W in M?String(M[W]):"")}(f.properties,b)}createBucket(l){return new nm(l)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const l of F3.paint.overridableProperties){if(!eS.hasPaintOverride(this.layout,l))continue;const f=this.paint.get(l),p=new mj(f),A=new wp(p,f.property.specification);let b=null;b=f.value.kind==="constant"||f.value.kind==="source"?new jA("source",A):new Ep("composite",A,f.value.zoomStops,f.value._interpolationType),this.paint._values[l]=new Pe(f.property,b,f.parameters)}}_handleOverridablePaintPropertyUpdate(l,f,p){return!(!this.layout||f.isDataDriven()||p.isDataDriven())&&eS.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,f){const p=l.get("text-field"),A=F3.paint.properties[f];let b=!1;const C=M=>{for(const N of M)if(A.overrides&&A.overrides.hasOverride(N))return void(b=!0)};if(p.value.kind==="constant"&&p.value.value instanceof da)C(p.value.value.sections);else if(p.value.kind==="source"){const M=U=>{b||(U instanceof Ff&&Xi(U.value)===Ls?C(U.value.sections):U instanceof Xu?C(U.sections):U.eachChild(M))},N=p.value;N._styleExpression&&M(N._styleExpression.expression)}return b}getProgramConfiguration(l){return new Qg(this,l)}}var Jde={paint:new ke({"background-color":new he(gt.paint_background["background-color"]),"background-pattern":new he(gt.paint_background["background-pattern"]),"background-opacity":new he(gt.paint_background["background-opacity"])})},epe={paint:new ke({"raster-opacity":new he(gt.paint_raster["raster-opacity"]),"raster-hue-rotate":new he(gt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new he(gt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new he(gt.paint_raster["raster-brightness-max"]),"raster-saturation":new he(gt.paint_raster["raster-saturation"]),"raster-contrast":new he(gt.paint_raster["raster-contrast"]),"raster-resampling":new he(gt.paint_raster["raster-resampling"]),"raster-fade-duration":new he(gt.paint_raster["raster-fade-duration"])})};class tpe extends Zf{constructor(l){super(l,{}),this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)}onRemove(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)}}var npe={paint:new ke({"sky-type":new he(gt.paint_sky["sky-type"]),"sky-atmosphere-sun":new he(gt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new he(gt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new he(gt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new he(gt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Fe(gt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new he(gt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new he(gt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new he(gt.paint_sky["sky-opacity"])})};function k3(c,l,f){const p=[0,0,1],A=B8([]);return F8(A,A,f?-me(c)+Math.PI:me(c)),N8(A,A,-me(l)),O8(p,p,A),ul(p,p)}const rpe={circle:class extends Zf{constructor(c){super(c,phe)}createBucket(c){return new c3(c)}queryRadius(c){const l=c;return Z_("circle-radius",this,l)+Z_("circle-stroke-width",this,l)+M2(this.paint.get("circle-translate"))}queryIntersectsFeature(c,l,f,p,A,b,C,M){const N=oG(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,c.pixelToTileUnitsFactor),U=this.paint.get("circle-radius").evaluate(l,f)+this.paint.get("circle-stroke-width").evaluate(l,f);return sG(c,p,b,C,M,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",N,U)}getProgramIds(){return["circle"]}getProgramConfiguration(c){return new Qg(this,c)}},heatmap:class extends Zf{createBucket(c){return new lG(c)}constructor(c){super(c,_he),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=p3({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return Z_("heatmap-radius",this,c)}queryIntersectsFeature(c,l,f,p,A,b,C,M){const N=this.paint.get("heatmap-radius").evaluate(l,f);return sG(c,p,b,C,M,!0,!0,new re(0,0),N)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(c){return new Qg(this,c)}},hillshade:class extends Zf{constructor(c){super(c,yhe)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Zf{constructor(c){super(c,Bhe)}getProgramIds(){const c=this.paint.get("fill-pattern"),l=c&&c.constantOr(1),f=[l?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&f.push(l&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),f}getProgramConfiguration(c){return new Qg(this,c)}recalculate(c,l){super.recalculate(c,l);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new B2(c)}queryRadius(){return M2(this.paint.get("fill-translate"))}queryIntersectsFeature(c,l,f,p,A,b){return!c.queryGeometry.isAboveHorizon&&eG(iG(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,c.pixelToTileUnitsFactor),p)}isTileClipped(){return!0}},"fill-extrusion":class extends Zf{constructor(c){super(c,Qhe)}createBucket(c){return new Lx(c)}queryRadius(){return M2(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(c){return new Qg(this,c)}queryIntersectsFeature(c,l,f,p,A,b,C,M,N){const U=oG(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,c.pixelToTileUnitsFactor),W=this.paint.get("fill-extrusion-height").evaluate(l,f),K=this.paint.get("fill-extrusion-base").evaluate(l,f),ee=[0,0],oe=M&&b.elevation,le=b.elevation?b.elevation.exaggeration():1,de=c.tile.getBucket(this);if(oe&&de instanceof Lx){const je=de.centroidVertexArray,Ze=N+1;Ze<je.length&&(ee[0]=je.geta_centroid_pos0(Ze),ee[1]=je.geta_centroid_pos1(Ze))}if(ee[0]===0&&ee[1]===1)return!1;b.projection.name==="globe"&&(p=TG([p],[new re(0,0),new re(Kn,Kn)],c.tileID.canonical).map(je=>je.polygon).flat());const xe=oe?M:null,[Le,$e]=function(je,Ze,We,bt,_t,Ft,tn,Tt,Gt,jt,Yt){return je.projection.name==="globe"?function(ln,Bt,xn,zn,En,Ar,un,Xn,_r,ei,yr){const nr=[],Hi=[],wr=ln.projection.upVectorScale(yr,ln.center.lat,ln.worldSize).metersToTile,Er=[0,0,0,1],Ci=[0,0,0,1],Di=(Pi,uo,To,Xo)=>{Pi[0]=uo,Pi[1]=To,Pi[2]=Xo,Pi[3]=1},Bi=SG();xn>0&&(xn+=Bi),zn+=Bi;for(const Pi of Bt){const uo=[],To=[];for(const Xo of Pi){const Ii=Xo.x+En.x,ds=Xo.y+En.y,Zo=ln.projection.projectTilePoint(Ii,ds,yr),_o=ln.projection.upVector(yr,Xo.x,Xo.y);let ri=xn,Yo=zn;if(un){const Ni=MG(Ii,ds,xn,zn,un,Xn,_r,ei);ri+=Ni.base,Yo+=Ni.top}xn!==0?Di(Er,Zo.x+_o[0]*wr*ri,Zo.y+_o[1]*wr*ri,Zo.z+_o[2]*wr*ri):Di(Er,Zo.x,Zo.y,Zo.z),Di(Ci,Zo.x+_o[0]*wr*Yo,Zo.y+_o[1]*wr*Yo,Zo.z+_o[2]*wr*Yo),Fo(Er,Er,Ar),Fo(Ci,Ci,Ar),uo.push(new K_(Er[0],Er[1],Er[2])),To.push(new K_(Ci[0],Ci[1],Ci[2]))}nr.push(uo),Hi.push(To)}return[nr,Hi]}(je,Ze,We,bt,_t,Ft,tn,Tt,Gt,jt,Yt):tn?function(ln,Bt,xn,zn,En,Ar,un,Xn,_r){const ei=[],yr=[],nr=[0,0,0,1];for(const Hi of ln){const wr=[],Er=[];for(const Ci of Hi){const Di=Ci.x+zn.x,Bi=Ci.y+zn.y,Pi=MG(Di,Bi,Bt,xn,Ar,un,Xn,_r);nr[0]=Di,nr[1]=Bi,nr[2]=Pi.base,nr[3]=1,ZA(nr,nr,En),nr[3]=Math.max(nr[3],1e-5);const uo=new K_(nr[0]/nr[3],nr[1]/nr[3],nr[2]/nr[3]);nr[0]=Di,nr[1]=Bi,nr[2]=Pi.top,nr[3]=1,ZA(nr,nr,En),nr[3]=Math.max(nr[3],1e-5);const To=new K_(nr[0]/nr[3],nr[1]/nr[3],nr[2]/nr[3]);wr.push(uo),Er.push(To)}ei.push(wr),yr.push(Er)}return[ei,yr]}(Ze,We,bt,_t,Ft,tn,Tt,Gt,jt):function(ln,Bt,xn,zn,En){const Ar=[],un=[],Xn=En[8]*Bt,_r=En[9]*Bt,ei=En[10]*Bt,yr=En[11]*Bt,nr=En[8]*xn,Hi=En[9]*xn,wr=En[10]*xn,Er=En[11]*xn;for(const Ci of ln){const Di=[],Bi=[];for(const Pi of Ci){const uo=Pi.x+zn.x,To=Pi.y+zn.y,Xo=En[0]*uo+En[4]*To+En[12],Ii=En[1]*uo+En[5]*To+En[13],ds=En[2]*uo+En[6]*To+En[14],Zo=En[3]*uo+En[7]*To+En[15],_o=Xo+Xn,ri=Ii+_r,Yo=ds+ei,Ni=Math.max(Zo+yr,1e-5),hl=Xo+nr,Qo=Ii+Hi,Ks=ds+wr,Fs=Math.max(Zo+Er,1e-5);Di.push(new K_(_o/Ni,ri/Ni,Yo/Ni)),Bi.push(new K_(hl/Fs,Qo/Fs,Ks/Fs))}Ar.push(Di),un.push(Bi)}return[Ar,un]}(Ze,We,bt,_t,Ft)}(b,p,K,W,U,C,xe,ee,le,b.center.lat,c.tileID.canonical),De=c.queryGeometry;return function(je,Ze,We){let bt=1/0;eG(We,Ze)&&(bt=IG(We,Ze[0]));for(let _t=0;_t<Ze.length;_t++){const Ft=Ze[_t],tn=je[_t];for(let Tt=0;Tt<Ft.length-1;Tt++){const Gt=Ft[Tt],jt=[Gt,Ft[Tt+1],tn[Tt+1],tn[Tt],Gt];J8(We,jt)&&(bt=Math.min(bt,IG(We,jt)))}}return bt!==1/0&&bt}(Le,$e,De.isPointQuery()?De.screenBounds:De.screenGeometry)}},line:class extends Zf{constructor(c){super(c,OG),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const l=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=l._styleExpression&&l._styleExpression.expression instanceof RA,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,l){super.recalculate(c,l),this.paint._values["line-floorwidth"]=RG.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new U2(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(c){return new Qg(this,c)}queryRadius(c){const l=c,f=LG(Z_("line-width",this,l),Z_("line-gap-width",this,l)),p=Z_("line-offset",this,l);return f/2+Math.abs(p)+M2(this.paint.get("line-translate"))}queryIntersectsFeature(c,l,f,p,A,b){if(c.queryGeometry.isAboveHorizon)return!1;const C=iG(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,c.pixelToTileUnitsFactor),M=c.pixelToTileUnitsFactor/2*LG(this.paint.get("line-width").evaluate(l,f),this.paint.get("line-gap-width").evaluate(l,f)),N=this.paint.get("line-offset").evaluate(l,f);return N&&(p=function(U,W){const K=[],ee=new re(0,0);for(let oe=0;oe<U.length;oe++){const le=U[oe],de=[];for(let xe=0;xe<le.length;xe++){const Le=le[xe],$e=le[xe+1],De=xe===0?ee:Le.sub(le[xe-1])._unit()._perp(),je=xe===le.length-1?ee:$e.sub(Le)._unit()._perp(),Ze=De._add(je)._unit();Ze._mult(1/(Ze.x*je.x+Ze.y*je.y)),de.push(Ze._mult(W)._add(Le))}K.push(de)}return K}(p,N*c.pixelToTileUnitsFactor)),function(U,W,K){for(let ee=0;ee<W.length;ee++){const oe=W[ee];if(U.length>=3){for(let le=0;le<oe.length;le++)if(JA(U,oe[le]))return!0}if(che(U,oe,K))return!0}return!1}(C,p,M)}isTileClipped(){return!0}},symbol:eS,background:class extends Zf{constructor(c){super(c,Jde)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Zf{constructor(c){super(c,epe)}getProgramIds(){return["raster"]}},sky:class extends Zf{constructor(c){super(c,npe),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=p3({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const l=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==l.azimuthal||this._lightPosition.polar!==l.polar}return!1}getCenter(c,l){if(this.paint.get("sky-type")==="atmosphere"){const p=this.paint.get("sky-atmosphere-sun"),A=!p,b=c.style.light,C=b.properties.get("position");return A&&b.properties.get("anchor")==="viewport"&&$t("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),A?k3(C.azimuthal,90-C.polar,l):k3(p[0],90-p[1],l)}const f=this.paint.get("sky-gradient-center");return k3(f[0],90-f[1],l)}is3D(){return!1}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}}};class $x{constructor(l,f,p,A){this.context=l,this.format=p,this.texture=l.gl.createTexture(),this.update(f,A)}update(l,f,p){const{width:A,height:b}=l,{context:C}=this,{gl:M}=C,{HTMLImageElement:N,HTMLCanvasElement:U,HTMLVideoElement:W,ImageData:K,ImageBitmap:ee}=u;if(M.bindTexture(M.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!f||f.premultiply!==!1)),p||this.size&&this.size[0]===A&&this.size[1]===b){const{x:oe,y:le}=p||{x:0,y:0};l instanceof N||l instanceof U||l instanceof W||l instanceof K||ee&&l instanceof ee?M.texSubImage2D(M.TEXTURE_2D,0,oe,le,M.RGBA,M.UNSIGNED_BYTE,l):M.texSubImage2D(M.TEXTURE_2D,0,oe,le,A,b,M.RGBA,M.UNSIGNED_BYTE,l.data)}else this.size=[A,b],l instanceof N||l instanceof U||l instanceof W||l instanceof K||ee&&l instanceof ee?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,l):M.texImage2D(M.TEXTURE_2D,0,this.format,A,b,0,this.format,M.UNSIGNED_BYTE,l.data);this.useMipmap=!!(f&&f.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&M.generateMipmap(M.TEXTURE_2D)}bind(l,f){const{context:p}=this,{gl:A}=p;A.bindTexture(A.TEXTURE_2D,this.texture),l!==this.filter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,l),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,this.useMipmap?l===A.NEAREST?A.NEAREST_MIPMAP_NEAREST:A.LINEAR_MIPMAP_NEAREST:l),this.filter=l),f!==this.wrap&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,f),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}class ipe{constructor(l){this._callback=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ope{constructor(){this.tasks={},this.taskQueue=[],Zt(["process"],this),this.invoker=new ipe(this.process),this.nextId=0}add(l,f){const p=this.nextId++,A=function({type:b,isSymbolTile:C,zoom:M}){return M=M||0,b==="message"?0:b!=="maybePrepare"||C?b!=="parseTile"||C?b==="parseTile"&&C?300-M:b==="maybePrepare"&&C?400-M:500:200-M:100-M}(f);if(A===0){Ln();try{l()}finally{}return{cancel:()=>{}}}return this.tasks[p]={fn:l,metadata:f,priority:A,id:p},this.taskQueue.push(p),this.invoker.trigger(),{cancel:()=>{delete this.tasks[p]}}}process(){Ln();try{if(this.taskQueue=this.taskQueue.filter(p=>!!this.tasks[p]),!this.taskQueue.length)return;const l=this.pick();if(l===null)return;const f=this.tasks[l];if(delete this.tasks[l],this.taskQueue.length&&this.invoker.trigger(),!f)return;f.fn()}finally{}}pick(){let l=null,f=1/0;for(let A=0;A<this.taskQueue.length;A++){const b=this.tasks[this.taskQueue[A]];b.priority<f&&(f=b.priority,l=A)}if(l===null)return null;const p=this.taskQueue[l];return this.taskQueue.splice(l,1),p}remove(){this.invoker.remove()}}class Aj{constructor(l){this._stringToNumber={},this._numberToString=[];for(let f=0;f<l.length;f++){const p=l[f];this._stringToNumber[p]=f,this._numberToString[f]=p}}encode(l){return this._stringToNumber[l]}decode(l){return this._numberToString[l]}}const spe=["tile","layer","source","sourceLayer","state"];class _j{constructor(l,f,p,A,b){this.type="Feature",this._vectorTileFeature=l,this._z=f,this._x=p,this._y=A,this.properties=l.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(l.id=this.id);for(const f of spe)this[f]!==void 0&&(l[f]=this[f]);return l}}const Yc=32,ad=33,rm=new Uint16Array(8184);for(let c=0;c<2046;c++){let l=c+2,f=0,p=0,A=0,b=0,C=0,M=0;for(1&l?A=b=C=Yc:f=p=M=Yc;(l>>=1)>1;){const U=f+A>>1,W=p+b>>1;1&l?(A=f,b=p,f=C,p=M):(f=A,p=b,A=C,b=M),C=U,M=W}const N=4*c;rm[N+0]=f,rm[N+1]=p,rm[N+2]=A,rm[N+3]=b}const ld=new Uint16Array(2178),im=new Uint8Array(1089),tS=new Uint16Array(1089);function yj(c){return c===0?-.03125:c===32?.03125:0}var vj=at([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const xj={type:2,extent:Kn,loadGeometry:()=>[[new re(0,0),new re(Kn+1,0),new re(Kn+1,Kn+1),new re(0,Kn+1),new re(0,0)]]};class z3{constructor(l,f,p,A,b){this.tileID=l,this.uid=In(),this.uses=0,this.tileSize=f,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,this.expiredRequestCount=0,this.state="loading",A&&A.transform&&(this.projection=A.transform.projection)}registerFadeDuration(l){const f=l+this.timeAdded;f<Vo.now()||this.fadeEndTime&&f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=t0(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(l,f,p){if(this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(A,b){const C={};if(!b)return C;for(const M of A){const N=M.layerIds.map(U=>b.getLayer(U)).filter(Boolean);if(N.length!==0){M.layers=N,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(U=>N.filter(W=>W.id===U)[0]));for(const U of N)C[U.id]=M}}return C}(l.buckets,f.style),this.hasSymbolBuckets=!1;for(const A in this.buckets){const b=this.buckets[A];if(b instanceof nm){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const A in this.buckets){const b=this.buckets[A];if(b instanceof nm&&b.hasRTLText){this.hasRTLText=!0,H.isLoading()||H.isLoaded()||L()!=="deferred"||$();break}}this.queryPadding=0;for(const A in this.buckets){const b=this.buckets[A];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(A).queryRadius(b))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage),l.lineAtlas&&(this.lineAtlas=l.lineAtlas)}else this.collisionBoxArray=new Si}unloadVectorData(){if(this.hasData()){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(l){return this.buckets[l.id]}upload(l){for(const p in this.buckets){const A=this.buckets[p];A.uploadPending()&&A.upload(l)}const f=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new $x(l,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new $x(l,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new $x(l,this.lineAtlas.image,f.ALPHA),this.lineAtlas.uploaded=!0)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,f,p,A,b,C,M,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:A,pixelPosMatrix:M,transform:C,params:b,tileTransform:this.tileTransform},l,f,p):{}}querySourceFeatures(l,f){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const A=p.loadVTLayers(),b=f?f.sourceLayer:"",C=A._geojsonTileLayer||A[b];if(!C)return;const M=ma(f&&f.filter),{z:N,x:U,y:W}=this.tileID.canonical,K={z:N,x:U,y:W};for(let ee=0;ee<C.length;ee++){const oe=C.feature(ee);if(M.needGeometry){const xe=KA(oe,!0);if(!M.filter(new Q(this.tileID.overscaledZ),xe,this.tileID.canonical))continue}else if(!M.filter(new Q(this.tileID.overscaledZ),oe))continue;const le=p.getId(oe,b),de=new _j(oe,N,U,W,le);de.tile=K,l.push(de)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const f=this.expirationTime;if(l.cacheControl){const p=qn(l.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const p=Date.now();let A=!1;if(this.expirationTime>p)A=!1;else if(f)if(this.expirationTime<f)A=!0;else{const b=this.expirationTime-f;b?this.expirationTime=p+Math.max(b,3e4):A=!0}else A=!0;A?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0||!f)return;const p=this.latestFeatureIndex.loadVTLayers(),A=f.style.listImages();for(const b in this.buckets){if(!f.style.hasLayer(b))continue;const C=this.buckets[b],M=C.layers[0].sourceLayer||"_geojsonTileLayer",N=p[M],U=l[M];if(!N||!U||Object.keys(U).length===0)continue;if(C.update(U,N,A,this.imageAtlas&&this.imageAtlas.patternPositions||{}),C instanceof U2||C instanceof B2){const K=f.style._getSourceCache(C.layers[0].source);f._terrain&&f._terrain.enabled&&K&&C.programConfigurations.needsUpload&&f._terrain._clearRenderCacheForTile(K.id,this.tileID)}const W=f&&f.style&&f.style.getLayer(b);W&&(this.queryPadding=Math.max(this.queryPadding,W.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Vo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=Vo.now()+l}setTexture(l,f){const p=f.context,A=p.gl;this.texture=this.texture||f.getTileTexture(l.width),this.texture?this.texture.update(l,{useMipmap:!0}):(this.texture=new $x(p,l,A.RGBA,{useMipmap:!0}),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE))}setDependencies(l,f){const p={};for(const A of f)p[A]=!0;this.dependencies[l]=p}hasDependency(l,f){for(const p of l){const A=this.dependencies[p];if(A){for(const b of f)if(A[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(l,f){if(!f||f.name==="mercator"||this._tileDebugBuffer)return;const p=Dp(xj,this.tileID.canonical,this.tileTransform)[0],A=new en,b=new pu;for(let C=0;C<p.length;C++){const{x:M,y:N}=p[C];A.emplaceBack(M,N),b.emplaceBack(C)}b.emplaceBack(0),this._tileDebugIndexBuffer=l.createIndexBuffer(b),this._tileDebugBuffer=l.createVertexBuffer(A,bx.members),this._tileDebugSegments=Wo.simpleSegment(0,0,A.length,b.length)}_makeTileBoundsBuffers(l,f){if(this._tileBoundsBuffer||!f||f.name==="mercator")return;const p=Dp(xj,this.tileID.canonical,this.tileTransform)[0];let A,b;if(this.isRaster){const C=function(M,N){const U=t0(M,N),W=Math.pow(2,M.z);for(let xe=0;xe<ad;xe++)for(let Le=0;Le<ad;Le++){const $e=Ju((M.x+(Le+yj(Le))/Yc)/W),De=ya((M.y+(xe+yj(xe))/Yc)/W),je=N.project($e,De),Ze=xe*ad+Le;ld[2*Ze+0]=Math.round((je.x*U.scale-U.x)*Kn),ld[2*Ze+1]=Math.round((je.y*U.scale-U.y)*Kn)}im.fill(0),tS.fill(0);for(let xe=2045;xe>=0;xe--){const Le=4*xe,$e=rm[Le+0],De=rm[Le+1],je=rm[Le+2],Ze=rm[Le+3],We=$e+je>>1,bt=De+Ze>>1,_t=We+bt-De,Ft=bt+$e-We,tn=De*ad+$e,Tt=Ze*ad+je,Gt=bt*ad+We,jt=Math.hypot((ld[2*tn+0]+ld[2*Tt+0])/2-ld[2*Gt+0],(ld[2*tn+1]+ld[2*Tt+1])/2-ld[2*Gt+1])>=16;im[Gt]=im[Gt]||(jt?1:0),xe<1022&&(im[Gt]=im[Gt]||im[(De+Ft>>1)*ad+($e+_t>>1)]||im[(Ze+Ft>>1)*ad+(je+_t>>1)])}const K=new Ut,ee=new Vn;let oe=0;function le(xe,Le){const $e=Le*ad+xe;return tS[$e]===0&&(K.emplaceBack(ld[2*$e+0],ld[2*$e+1],xe*Kn/Yc,Le*Kn/Yc),tS[$e]=++oe),tS[$e]-1}function de(xe,Le,$e,De,je,Ze){const We=xe+$e>>1,bt=Le+De>>1;if(Math.abs(xe-je)+Math.abs(Le-Ze)>1&&im[bt*ad+We])de(je,Ze,xe,Le,We,bt),de($e,De,je,Ze,We,bt);else{const _t=le(xe,Le),Ft=le($e,De),tn=le(je,Ze);ee.emplaceBack(_t,Ft,tn)}}return de(0,0,Yc,Yc,Yc,0),de(Yc,Yc,0,0,0,Yc),{vertices:K,indices:ee}}(this.tileID.canonical,f);A=C.vertices,b=C.indices}else{A=new Ut,b=new Vn;for(const{x:M,y:N}of p)A.emplaceBack(M,N,0,0);const C=y3(A.int16,void 0,4);for(let M=0;M<C.length;M+=3)b.emplaceBack(C[M],C[M+1],C[M+2])}this._tileBoundsBuffer=l.createVertexBuffer(A,vj.members),this._tileBoundsIndexBuffer=l.createIndexBuffer(b),this._tileBoundsSegments=Wo.simpleSegment(0,0,A.length,b.length)}_makeGlobeTileDebugBuffers(l,f){const p=f.projection;if(!p||p.name!=="globe"||f.freezeTileCoverage)return;const A=this.tileID.canonical,b=Sx(j8(A,f)),C=q_(f.zoom);let M;C>0&&(M=qL(new Float64Array(16),f.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(l,A,f,b,M,C),this._makeGlobeTileDebugTextBuffer(l,A,f,b,M,C)}_globePoint(l,f,p,A,b,C,M){let N=Ex(l,f,p);if(C){const U=1<<p.z,W=od(A.center.lng),K=sd(A.center.lat),ee=(p.x+.5)/U-W;let oe=0;ee>.5?oe=-1:ee<-.5&&(oe=1);let le=(l/Kn+p.x)/U+oe,de=(f/Kn+p.y)/U;le=(le-W)*A._pixelsPerMercatorPixel+W,de=(de-K)*A._pixelsPerMercatorPixel+K;const xe=[le*A.worldSize,de*A.worldSize,0];Fo(xe,xe,C),N=QA(N,xe,M)}return Fo(N,N,b)}_makeGlobeTileDebugBorderBuffer(l,f,p,A,b,C){const M=new en,N=new pu,U=new At,W=(ee,oe,le,de,xe)=>{const Le=(le-ee)/(xe-1),$e=(de-oe)/(xe-1),De=M.length;for(let je=0;je<xe;je++){const Ze=ee+je*Le,We=oe+je*$e;M.emplaceBack(Ze,We);const bt=this._globePoint(Ze,We,f,p,A,b,C);U.emplaceBack(bt[0],bt[1],bt[2]),N.emplaceBack(De+je)}},K=Kn;W(0,0,K,0,16),W(K,0,K,K,16),W(K,K,0,K,16),W(0,K,0,0,16),this._tileDebugIndexBuffer=l.createIndexBuffer(N),this._tileDebugBuffer=l.createVertexBuffer(M,bx.members),this._globeTileDebugBorderBuffer=l.createVertexBuffer(U,z8.members),this._tileDebugSegments=Wo.simpleSegment(0,0,M.length,N.length)}_makeGlobeTileDebugTextBuffer(l,f,p,A,b,C){const M=Kn/4,N=new en,U=new Vn,W=new At,K=25;U.reserve(32),N.reserve(K),W.reserve(K);const ee=(oe,le)=>K*oe+le;for(let oe=0;oe<K;oe++){const le=oe*M;for(let de=0;de<K;de++){const xe=de*M;N.emplaceBack(xe,le);const Le=this._globePoint(xe,le,f,p,A,b,C);W.emplaceBack(Le[0],Le[1],Le[2])}}for(let oe=0;oe<4;oe++)for(let le=0;le<4;le++){const de=ee(oe,le),xe=ee(oe,le+1),Le=ee(oe+1,le),$e=ee(oe+1,le+1);U.emplaceBack(de,xe,Le),U.emplaceBack(Le,xe,$e)}this._tileDebugTextIndexBuffer=l.createIndexBuffer(U),this._tileDebugTextBuffer=l.createVertexBuffer(N,bx.members),this._globeTileDebugTextBuffer=l.createVertexBuffer(W,z8.members),this._tileDebugTextSegments=Wo.simpleSegment(0,0,K,32)}}class ape{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,f,p){const A=String(f);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][A]=this.stateChanges[l][A]||{},Ct(this.stateChanges[l][A],p),this.deletedStates[l]===null){this.deletedStates[l]={};for(const b in this.state[l])b!==A&&(this.deletedStates[l][b]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][A]===null){this.deletedStates[l][A]={};for(const b in this.state[l][A])p[b]||(this.deletedStates[l][A][b]=null)}else for(const b in p)this.deletedStates[l]&&this.deletedStates[l][A]&&this.deletedStates[l][A][b]===null&&delete this.deletedStates[l][A][b]}removeFeatureState(l,f,p){if(this.deletedStates[l]===null)return;const A=String(f);if(this.deletedStates[l]=this.deletedStates[l]||{},p&&f!==void 0)this.deletedStates[l][A]!==null&&(this.deletedStates[l][A]=this.deletedStates[l][A]||{},this.deletedStates[l][A][p]=null);else if(f!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][A])for(p in this.deletedStates[l][A]={},this.stateChanges[l][A])this.deletedStates[l][A][p]=null;else this.deletedStates[l][A]=null;else this.deletedStates[l]=null}getState(l,f){const p=String(f),A=Ct({},(this.state[l]||{})[p],(this.stateChanges[l]||{})[p]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const b=this.deletedStates[l][f];if(b===null)return{};for(const C in b)delete A[C]}return A}initializeTileState(l,f){l.setFeatureState(this.state,f)}coalesceChanges(l,f){const p={};for(const A in this.stateChanges){this.state[A]=this.state[A]||{};const b={};for(const C in this.stateChanges[A])this.state[A][C]||(this.state[A][C]={}),Ct(this.state[A][C],this.stateChanges[A][C]),b[C]=this.state[A][C];p[A]=b}for(const A in this.deletedStates){this.state[A]=this.state[A]||{};const b={};if(this.deletedStates[A]===null)for(const C in this.state[A])b[C]={},this.state[A][C]={};else for(const C in this.deletedStates[A]){if(this.deletedStates[A][C]===null)this.state[A][C]={};else if(this.state[A][C])for(const M of Object.keys(this.deletedStates[A][C]))delete this.state[A][C][M];b[C]=this.state[A][C]}p[A]=p[A]||{},Ct(p[A],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const A in l)l[A].setFeatureState(p,f)}}class bj{constructor(l){this.size=l,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(l,f){const p=this.toIdx(l,f);return{min:this.minimums[p],max:this.maximums[p]}}isLeaf(l,f){return this.leaves[this.toIdx(l,f)]}toIdx(l,f){return f*this.size+l}}function wj(c,l,f,p){let A=0,b=Number.MAX_VALUE;for(let C=0;C<3;C++)if(Math.abs(p[C])<1e-15){if(f[C]<c[C]||f[C]>l[C])return null}else{const M=1/p[C];let N=(c[C]-f[C])*M,U=(l[C]-f[C])*M;if(N>U){const W=N;N=U,U=W}if(N>A&&(A=N),U<b&&(b=U),A>b)return null}return A}function Ej(c,l,f,p,A,b,C,M,N,U,W){const K=p-c,ee=A-l,oe=b-f,le=C-c,de=M-l,xe=N-f,Le=W[1]*xe-W[2]*de,$e=W[2]*le-W[0]*xe,De=W[0]*de-W[1]*le,je=K*Le+ee*$e+oe*De;if(Math.abs(je)<1e-15)return null;const Ze=1/je,We=U[0]-c,bt=U[1]-l,_t=U[2]-f,Ft=(We*Le+bt*$e+_t*De)*Ze;if(Ft<0||Ft>1)return null;const tn=bt*oe-_t*ee,Tt=_t*K-We*oe,Gt=We*ee-bt*K,jt=(W[0]*tn+W[1]*Tt+W[2]*Gt)*Ze;return jt<0||Ft+jt>1?null:(le*tn+de*Tt+xe*Gt)*Ze}function Sj(c,l,f){return(c-l)/(f-l)}function Tj(c,l,f,p,A,b,C,M,N){const U=1<<f,W=b-p,K=C-A,ee=(c+1)/U*W+p,oe=(l+0)/U*K+A,le=(l+1)/U*K+A;M[0]=(c+0)/U*W+p,M[1]=oe,N[0]=ee,N[1]=le}class Cj{constructor(l){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=l,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const f=function(b){const C=Math.ceil(Math.log2(b.dim/8)),M=[];let N=Math.ceil(Math.pow(2,C));const U=1/N,W=(oe,le,de,xe,Le)=>{const $e=xe?1:0,De=(oe+1)*de-$e,je=le*de,Ze=(le+1)*de-$e;Le[0]=oe*de,Le[1]=je,Le[2]=De,Le[3]=Ze};let K=new bj(N);const ee=[];for(let oe=0;oe<N*N;oe++){W(oe%N,Math.floor(oe/N),U,!1,ee);const le=om(ee[0],ee[1],b),de=om(ee[2],ee[1],b),xe=om(ee[2],ee[3],b),Le=om(ee[0],ee[3],b);K.minimums.push(Math.min(le,de,xe,Le)),K.maximums.push(Math.max(le,de,xe,Le)),K.leaves.push(1)}for(M.push(K),N/=2;N>=1;N/=2){const oe=M[M.length-1];K=new bj(N);for(let le=0;le<N*N;le++){W(le%N,Math.floor(le/N),2,!0,ee);const de=oe.getElevation(ee[0],ee[1]),xe=oe.getElevation(ee[2],ee[1]),Le=oe.getElevation(ee[2],ee[3]),$e=oe.getElevation(ee[0],ee[3]),De=oe.isLeaf(ee[0],ee[1]),je=oe.isLeaf(ee[2],ee[1]),Ze=oe.isLeaf(ee[2],ee[3]),We=oe.isLeaf(ee[0],ee[3]),bt=Math.min(de.min,xe.min,Le.min,$e.min),_t=Math.max(de.max,xe.max,Le.max,$e.max),Ft=De&&je&&Ze&&We;K.maximums.push(_t),K.minimums.push(bt),K.leaves.push(_t-bt<=5&&Ft?1:0)}M.push(K)}return M}(this.dem),p=f.length-1,A=f[p];this._addNode(A.minimums[0],A.maximums[0],A.leaves[0]),this._construct(f,0,0,p,0)}raycastRoot(l,f,p,A,b,C,M=1){return wj([l,f,-100],[p,A,this.maximums[0]*M],b,C)}raycast(l,f,p,A,b,C,M=1){if(!this.nodeCount)return null;const N=this.raycastRoot(l,f,p,A,b,C,M);if(N==null)return null;const U=[],W=[],K=[],ee=[],oe=[{idx:0,t:N,nodex:0,nodey:0,depth:0}];for(;oe.length>0;){const{idx:le,t:de,nodex:xe,nodey:Le,depth:$e}=oe.pop();if(this.leaves[le]){Tj(xe,Le,$e,l,f,p,A,K,ee);const je=1<<$e,Ze=(xe+0)/je,We=(xe+1)/je,bt=(Le+0)/je,_t=(Le+1)/je,Ft=om(Ze,bt,this.dem)*M,tn=om(We,bt,this.dem)*M,Tt=om(We,_t,this.dem)*M,Gt=om(Ze,_t,this.dem)*M,jt=Ej(K[0],K[1],Ft,ee[0],K[1],tn,ee[0],ee[1],Tt,b,C),Yt=Ej(ee[0],ee[1],Tt,K[0],ee[1],Gt,K[0],K[1],Ft,b,C),ln=Math.min(jt!==null?jt:Number.MAX_VALUE,Yt!==null?Yt:Number.MAX_VALUE);if(ln!==Number.MAX_VALUE)return ln;{const Bt=vx([],b,C,de);if(Pj(Ft,tn,Gt,Tt,Sj(Bt[0],K[0],ee[0]),Sj(Bt[1],K[1],ee[1]))>=Bt[2])return de}continue}let De=0;for(let je=0;je<this._siblingOffset.length;je++){Tj((xe<<1)+this._siblingOffset[je][0],(Le<<1)+this._siblingOffset[je][1],$e+1,l,f,p,A,K,ee),K[2]=-100,ee[2]=this.maximums[this.childOffsets[le]+je]*M;const Ze=wj(K,ee,b,C);if(Ze!=null){const We=Ze;U[je]=We;let bt=!1;for(let _t=0;_t<De&&!bt;_t++)We>=U[W[_t]]&&(W.splice(_t,0,je),bt=!0);bt||(W[De]=je),De++}}for(let je=0;je<De;je++){const Ze=W[je];oe.push({idx:this.childOffsets[le]+Ze,t:U[Ze],nodex:(xe<<1)+this._siblingOffset[Ze][0],nodey:(Le<<1)+this._siblingOffset[Ze][1],depth:$e+1})}}return null}_addNode(l,f,p){return this.minimums.push(l),this.maximums.push(f),this.leaves.push(p),this.childOffsets.push(0),this.nodeCount++}_construct(l,f,p,A,b){if(l[A].isLeaf(f,p)===1)return;this.childOffsets[b]||(this.childOffsets[b]=this.nodeCount);const C=A-1,M=l[C];let N=0,U=0;for(let W=0;W<this._siblingOffset.length;W++){const K=2*f+this._siblingOffset[W][0],ee=2*p+this._siblingOffset[W][1],oe=M.getElevation(K,ee),le=M.isLeaf(K,ee),de=this._addNode(oe.min,oe.max,le);le&&(N|=1<<W),U||(U=de)}for(let W=0;W<this._siblingOffset.length;W++)N&1<<W||this._construct(l,2*f+this._siblingOffset[W][0],2*p+this._siblingOffset[W][1],C,U+W)}}function Pj(c,l,f,p,A,b){return jr(jr(c,f,b),jr(l,p,b),A)}function om(c,l,f){const p=f.dim,A=Ee(c*p-.5,0,p-1),b=Ee(l*p-.5,0,p-1),C=Math.floor(A),M=Math.floor(b),N=Math.min(C+1,p-1),U=Math.min(M+1,p-1);return Pj(f.get(C,M),f.get(N,M),f.get(C,U),f.get(N,U),A-C,b-M)}const Ij={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function lpe(c,l,f){return(256*c*256+256*l+f)/10-1e4}function upe(c,l,f){return 256*c+l+f/256-32768}class nS{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(l,f,p,A=!1,b=!1){if(this.uid=l,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return $t(`"${p}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=f.height;const C=this.dim=f.height-2,M=new Uint32Array(f.data.buffer);if(this.pixels=new Uint8Array(f.data.buffer),this.encoding=p||"mapbox",this.borderReady=A,!A){for(let N=0;N<C;N++)M[this._idx(-1,N)]=M[this._idx(0,N)],M[this._idx(C,N)]=M[this._idx(C-1,N)],M[this._idx(N,-1)]=M[this._idx(N,0)],M[this._idx(N,C)]=M[this._idx(N,C-1)];M[this._idx(-1,-1)]=M[this._idx(0,0)],M[this._idx(C,-1)]=M[this._idx(C-1,0)],M[this._idx(-1,C)]=M[this._idx(0,C-1)],M[this._idx(C,C)]=M[this._idx(C-1,C-1)],b&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Cj(this)}get(l,f,p=!1){p&&(l=Ee(l,-1,this.dim),f=Ee(f,-1,this.dim));const A=4*this._idx(l,f);return(this.encoding==="terrarium"?upe:lpe)(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}static getUnpackVector(l){return Ij[l]}get unpackVector(){return Ij[this.encoding]}_idx(l,f){if(l<-1||l>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(f+1)*this.stride+(l+1)}static pack(l,f){const p=[0,0,0,0],A=nS.getUnpackVector(f);let b=Math.floor((l+A[3])/A[2]);return p[2]=b%256,b=Math.floor(b/256),p[1]=b%256,b=Math.floor(b/256),p[0]=b,p}getPixels(){return new mu({width:this.stride,height:this.stride},this.pixels)}backfillBorder(l,f,p){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let A=f*this.dim,b=f*this.dim+this.dim,C=p*this.dim,M=p*this.dim+this.dim;switch(f){case-1:A=b-1;break;case 1:b=A+1}switch(p){case-1:C=M-1;break;case 1:M=C+1}const N=-f*this.dim,U=-p*this.dim;for(let W=C;W<M;W++)for(let K=A;K<b;K++){const ee=4*this._idx(K,W),oe=4*this._idx(K+N,W+U);this.pixels[ee+0]=l.pixels[oe+0],this.pixels[ee+1]=l.pixels[oe+1],this.pixels[ee+2]=l.pixels[oe+2],this.pixels[ee+3]=l.pixels[oe+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Mt(nS,"DEMData"),Mt(Cj,"DemMinMaxQuadTree",{omit:["dem"]});class cpe{constructor(l,f){this.max=l,this.onRemove=f,this.reset()}reset(){for(const l in this.data)for(const f of this.data[l])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(l,f,p){const A=l.wrapped().key;this.data[A]===void 0&&(this.data[A]=[]);const b={value:f,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(l,b)},p)),this.data[A].push(b),this.order.push(A),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value}getByKey(l){const f=this.data[l];return f?f[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,f){if(!this.has(l))return this;const p=l.wrapped().key,A=f===void 0?0:this.data[p].indexOf(f),b=this.data[p][A];return this.data[p].splice(A,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(l){const f=[];for(const p in this.data)for(const A of this.data[p])l(A.value)||f.push(A);for(const p of f)this.remove(p.value.tileID,p)}}class ly{constructor(l,f,p){this.func=l,this.mask=f,this.range=p}}ly.ReadOnly=!1,ly.ReadWrite=!0,ly.disabled=new ly(519,ly.ReadOnly,[0,1]);const U3=7680;class G3{constructor(l,f,p,A,b,C){this.test=l,this.ref=f,this.mask=p,this.fail=A,this.depthFail=b,this.pass=C}}G3.disabled=new G3({func:519,mask:0},0,0,U3,U3,U3);class ud{constructor(l,f,p){this.blendFunction=l,this.blendColor=f,this.mask=p}}ud.Replace=[1,0],ud.disabled=new ud(ud.Replace,lo.transparent,[!1,!1,!1,!1]),ud.unblended=new ud(ud.Replace,lo.transparent,[!0,!0,!0,!0]),ud.alphaBlended=new ud([1,771],lo.transparent,[!0,!0,!0,!0]);const j3=1029,V3=2305;class th{constructor(l,f,p){this.enable=l,this.mode=f,this.frontFace=p}}th.disabled=new th(!1,j3,V3),th.backCCW=new th(!0,j3,V3),th.backCW=new th(!0,j3,2304),th.frontCW=new th(!0,1028,2304),th.frontCCW=new th(!0,1028,V3);class n0 extends Ke{constructor(l,f,p){super(),this.id=l,this._onlySymbols=p,f.on("data",A=>{A.dataType==="source"&&A.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&A.dataType==="source"&&A.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),f.on("error",()=>{this._sourceErrored=!0}),this._source=f,this._tiles={},this._cache=new cpe(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new ape,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(l){this.map=l,this._minTileCacheSize=this._minTileCacheSize===void 0&&l?l._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&l?l._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const l in this._tiles){const f=this._tiles[l];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(l,f){return l.isSymbolTile=this._onlySymbols,this._source.loadTile(l,f)}_unloadTile(l){if(this._source.unloadTile)return this._source.unloadTile(l,()=>{})}_abortTile(l){if(this._source.abortTile)return this._source.abortTile(l,()=>{})}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const p=this._tiles[f];p.upload(l),p.prepare(this.map.style.imageManager)}}getIds(){return ct(this._tiles).map(l=>l.tileID).sort(Mj).map(l=>l.key)}getRenderableIds(l){const f=[];for(const p in this._tiles)this._isIdRenderable(+p,l)&&f.push(this._tiles[p]);return l?f.sort((p,A)=>{const b=p.tileID,C=A.tileID,M=new re(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),N=new re(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-C.overscaledZ||N.y-M.y||N.x-M.x}).map(p=>p.tileID.key):f.map(p=>p.tileID).sort(Mj).map(p=>p.key)}hasRenderableParent(l){const f=this.findLoadedParent(l,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(l,f){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(f||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(+l,"reloading")}}_reloadTile(l,f){const p=this._tiles[l];p&&(p.state!=="loading"&&(p.state=f),this._loadTile(p,this._tileLoaded.bind(this,p,l,f)))}_tileLoaded(l,f,p,A){if(A)if(l.state="errored",A.status!==404)this._source.fire(new Hn(A,{tile:l}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform);else l.timeAdded=Vo.now(),p==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(f,l),this._source.type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),this._source.fire(new $o("data",{dataType:"source",tile:l,coord:l.tileID,sourceCacheId:this.id}))}_backfillDEM(l){const f=this.getRenderableIds();for(let A=0;A<f.length;A++){const b=f[A];if(l.neighboringTiles&&l.neighboringTiles[b]){const C=this.getTileByID(b);p(l,C),p(C,l)}}function p(A,b){if(!A.dem||A.dem.borderReady)return;A.needsHillshadePrepare=!0,A.needsDEMTextureUpload=!0;let C=b.tileID.canonical.x-A.tileID.canonical.x;const M=b.tileID.canonical.y-A.tileID.canonical.y,N=Math.pow(2,A.tileID.canonical.z),U=b.tileID.key;C===0&&M===0||Math.abs(M)>1||(Math.abs(C)>1&&(Math.abs(C+N)===1?C+=N:Math.abs(C-N)===1&&(C-=N)),b.dem&&A.dem&&(A.dem.backfillBorder(b.dem,C,M),A.neighboringTiles&&A.neighboringTiles[U]&&(A.neighboringTiles[U].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,f,p,A){for(const b in this._tiles){let C=this._tiles[b];if(A[b]||!C.hasData()||C.tileID.overscaledZ<=f||C.tileID.overscaledZ>p)continue;let M=C.tileID;for(;C&&C.tileID.overscaledZ>f+1;){const U=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[U.key],C&&C.hasData()&&(M=U)}let N=M;for(;N.overscaledZ>f;)if(N=N.scaledTo(N.overscaledZ-1),l[N.key]){A[M.key]=M;break}}}findLoadedParent(l,f){if(l.key in this._loadedParentTiles){const p=this._loadedParentTiles[l.key];return p&&p.tileID.overscaledZ>=f?p:null}for(let p=l.overscaledZ-1;p>=f;p--){const A=l.scaledTo(p),b=this._getLoadedTile(A);if(b)return b}}_getLoadedTile(l){const f=this._tiles[l.key];return f&&f.hasData()?f:this._cache.getByKey(this._source.reparseOverscaled?l.wrapped().key:l.canonical.key)}updateCacheSize(l,f){f=f||this._source.tileSize;const p=Math.ceil(l.width/f)+1,A=Math.ceil(l.height/f)+1,b=Math.floor(p*A*5),C=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(M)}handleWrapJump(l){const f=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,f){const p={};for(const A in this._tiles){const b=this._tiles[A];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+f),p[b.tileID.key]=b}this._tiles=p;for(const A in this._timers)clearTimeout(this._timers[A]),delete this._timers[A];for(const A in this._tiles)this._setTileReloadTimer(+A,this._tiles[A])}}update(l,f,p){if(this.transform=l,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;let A;this.updateCacheSize(l,f),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?A=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new fl(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(A=l.coveringTiles({tileSize:f||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(A=A.filter(M=>this._source.hasTile(M)))):A=[];const b=this._updateRetainedTiles(A);if(Oj(this._source.type)&&A.length!==0){const M={},N={},U=Object.keys(b);for(const K of U){const ee=b[K],oe=this._tiles[K];if(!oe||oe.fadeEndTime&&oe.fadeEndTime<=Vo.now())continue;const le=this.findLoadedParent(ee,Math.max(ee.overscaledZ-n0.maxOverzooming,this._source.minzoom));le&&(this._addTile(le.tileID),M[le.tileID.key]=le.tileID),N[K]=ee}const W=A[A.length-1].overscaledZ;for(const K in this._tiles){const ee=this._tiles[K];if(b[K]||!ee.hasData())continue;let oe=ee.tileID;for(;oe.overscaledZ>W;){oe=oe.scaledTo(oe.overscaledZ-1);const le=this._tiles[oe.key];if(le&&le.hasData()&&N[oe.key]){b[K]=ee.tileID;break}}}for(const K in M)b[K]||(this._coveredTiles[K]=!0,b[K]=M[K])}for(const M in b)this._tiles[M].clearFadeHold();const C=function(M,N){const U=[];for(const W in M)W in N||U.push(W);return U}(this._tiles,b);for(const M of C){const N=this._tiles[M];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(+M)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(+l)}_updateRetainedTiles(l){const f={};if(l.length===0)return f;const p={},A=l.reduce((U,W)=>Math.min(U,W.overscaledZ),1/0),b=l[0].overscaledZ,C=Math.max(b-n0.maxOverzooming,this._source.minzoom),M=Math.max(b+n0.maxUnderzooming,this._source.minzoom),N={};for(const U of l){const W=this._addTile(U);f[U.key]=U,W.hasData()||A<this._source.maxzoom&&(N[U.key]=U)}this._retainLoadedChildren(N,A,M,f);for(const U of l){let W=this._tiles[U.key];if(W.hasData())continue;if(U.canonical.z>=this._source.maxzoom){const ee=U.children(this._source.maxzoom)[0],oe=this.getTile(ee);if(oe&&oe.hasData()){f[ee.key]=ee;continue}}else{const ee=U.children(this._source.maxzoom);if(f[ee[0].key]&&f[ee[1].key]&&f[ee[2].key]&&f[ee[3].key])continue}let K=W.wasRequested();for(let ee=U.overscaledZ-1;ee>=C;--ee){const oe=U.scaledTo(ee);if(p[oe.key]||(p[oe.key]=!0,W=this.getTile(oe),!W&&K&&(W=this._addTile(oe)),W&&(f[oe.key]=oe,K=W.wasRequested(),W.hasData())))break}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const f=[];let p,A=this._tiles[l].tileID;for(;A.overscaledZ>0;){if(A.key in this._loadedParentTiles){p=this._loadedParentTiles[A.key];break}f.push(A.key);const b=A.scaledTo(A.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;A=b}for(const b of f)this._loadedParentTiles[b]=p}}_addTile(l){let f=this._tiles[l.key];if(f)return f;f=this._cache.getAndRemove(l),f&&(this._setTileReloadTimer(l.key,f),f.tileID=l,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,f)));const p=!!f;if(!p){const A=this.map?this.map.painter:null;f=new z3(l,this._source.tileSize*l.overscaleFactor(),this.transform.tileZoom,A,this._isRaster),this._loadTile(f,this._tileLoaded.bind(this,f,l.key,f.state))}return f?(f.uses++,this._tiles[l.key]=f,p||this._source.fire(new $o("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f):null}_setTileReloadTimer(l,f){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const p=f.getExpiryTimeout();p&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},p))}_removeTile(l){const f=this._tiles[l];f&&(f.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(+l);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(l,f,p){const A=[],b=this.transform;if(!b)return A;const C=b.projection.name==="globe",M=od(b.center.lng);for(const N in this._tiles){const U=this._tiles[N];if(p&&U.clearQueryDebugViz(),U.holdingForFade())continue;let W;if(C){const K=U.tileID.canonical;if(K.z===0){const ee=[Math.abs(Ee(M,...Hx(K,-1))-M),Math.abs(Ee(M,...Hx(K,1))-M)];W=[0,2*ee.indexOf(Math.min(...ee))-1]}else{const ee=[Math.abs(Ee(M,...Hx(K,-1))-M),Math.abs(Ee(M,...Hx(K,0))-M),Math.abs(Ee(M,...Hx(K,1))-M)];W=[ee.indexOf(Math.min(...ee))-1]}}else W=[0];for(const K of W){const ee=l.containsTile(U,b,f,K);ee&&A.push(ee)}}return A}getVisibleCoordinates(l){const f=this.getRenderableIds(l).map(p=>this._tiles[p].tileID);for(const p of f)p.projMatrix=this.transform.calculateProjMatrix(p.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(Oj(this._source.type))for(const l in this._tiles){const f=this._tiles[l];if(f.fadeEndTime!==void 0&&f.fadeEndTime>=Vo.now())return!0}return!1}setFeatureState(l,f,p){this._state.updateState(l=l||"_geojsonTileLayer",f,p)}removeFeatureState(l,f,p){this._state.removeFeatureState(l=l||"_geojsonTileLayer",f,p)}getFeatureState(l,f){return this._state.getState(l=l||"_geojsonTileLayer",f)}setDependencies(l,f,p){const A=this._tiles[l];A&&A.setDependencies(f,p)}reloadTilesForDependencies(l,f){for(const p in this._tiles)this._tiles[p].hasDependency(l,f)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(l,f))}_preloadTiles(l,f){if(!this._sourceLoaded){const M=()=>{this._sourceLoaded&&(this._source.off("data",M),this._preloadTiles(l,f))};return void this._source.on("data",M)}const p=new Map,A=Array.isArray(l)?l:[l],b=this.map.painter.terrain,C=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const M of A){const N=M.coveringTiles({tileSize:C,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const U of N)p.set(U.key,U);this.usedForTerrain&&M.updateElevation(!1)}qe(Array.from(p.values()),(M,N)=>{const U=new z3(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(U,W=>{this._source.type==="raster-dem"&&U.dem&&this._backfillDEM(U),N(W,U)})},f)}}function Mj(c,l){const f=Math.abs(2*c.wrap)-+(c.wrap<0),p=Math.abs(2*l.wrap)-+(l.wrap<0);return c.overscaledZ-l.overscaledZ||p-f||l.canonical.y-c.canonical.y||l.canonical.x-c.canonical.x}function Oj(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function Hx(c,l){const f=1<<c.z;return[c.x/f+l,(c.x+1)/f+l]}n0.maxOverzooming=10,n0.maxUnderzooming=3;class rS{constructor(l,f,p){this._demTile=l,this._dem=this._demTile.dem,this._scale=f,this._offset=p}static create(l,f,p){const A=p||l.findDEMTileFor(f);if(!A||!A.dem)return;const b=A.dem,C=A.tileID,M=1<<f.canonical.z-C.canonical.z;return new rS(A,A.tileSize/Kn/M,[(f.canonical.x/M-C.canonical.x)*b.dim,(f.canonical.y/M-C.canonical.y)*b.dim])}tileCoordToPixel(l,f){const p=f*this._scale+this._offset[1],A=Math.floor(l*this._scale+this._offset[0]),b=Math.floor(p);return new re(A,b)}getElevationAt(l,f,p,A){const b=l*this._scale+this._offset[0],C=f*this._scale+this._offset[1],M=Math.floor(b),N=Math.floor(C),U=this._dem;return A=!!A,p?jr(jr(U.get(M,N,A),U.get(M,N+1,A),C-N),jr(U.get(M+1,N,A),U.get(M+1,N+1,A),C-N),b-M):U.get(M,N,A)}getElevationAtPixel(l,f,p){return this._dem.get(l,f,!!p)}getMeterToDEM(l){return(1<<this._demTile.tileID.canonical.z)*Kf(1,l)*this._dem.stride}}class Rj{constructor(l,f){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new Bn(Kn,16,0),this.featureIndexArray=new $A,this.promoteId=f}insert(l,f,p,A,b,C=0){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,A,b,C);const N=this.grid;for(let U=0;U<f.length;U++){const W=f[U],K=[1/0,1/0,-1/0,-1/0];for(let ee=0;ee<W.length;ee++){const oe=W[ee];K[0]=Math.min(K[0],oe.x),K[1]=Math.min(K[1],oe.y),K[2]=Math.max(K[2],oe.x),K[3]=Math.max(K[3],oe.y)}K[0]<Kn&&K[1]<Kn&&K[2]>=0&&K[3]>=0&&N.insert(M,K[0],K[1],K[2],K[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new w3(new V2(this.rawTileData)).layers,this.sourceLayerCoder=new Aj(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const l in this.vtLayers)this.vtFeatures[l]=[]}return this.vtLayers}query(l,f,p,A){this.loadVTLayers();const b=l.params||{},C=ma(b.filter),M=l.tileResult,N=l.transform,U=M.bufferedTilespaceBounds,W=this.grid.query(U.min.x,U.min.y,U.max.x,U.max.y,(le,de,xe,Le)=>rG(M.bufferedTilespaceGeometry,le,de,xe,Le));W.sort(fpe);let K=null;N.elevation&&W.length>0&&(K=rS.create(N.elevation,this.tileID));const ee={};let oe;for(let le=0;le<W.length;le++){const de=W[le];if(de===oe)continue;oe=de;const xe=this.featureIndexArray.get(de);let Le=null;this.loadMatchingFeature(ee,xe,C,b.layers,b.availableImages,f,p,A,($e,De,je,Ze=0)=>(Le||(Le=Dp($e,this.tileID.canonical,l.tileTransform)),De.queryIntersectsFeature(M,$e,je,Le,this.z,l.transform,l.pixelPosMatrix,K,Ze)))}return ee}loadMatchingFeature(l,f,p,A,b,C,M,N,U){const{featureIndex:W,bucketIndex:K,sourceLayerIndex:ee,layoutVertexArrayOffset:oe}=f,le=this.bucketLayerIDs[K];if(A&&!function($e,De){for(let je=0;je<$e.length;je++)if(De.indexOf($e[je])>=0)return!0;return!1}(A,le))return;const de=this.sourceLayerCoder.decode(ee),xe=this.vtLayers[de].feature(W);if(p.needGeometry){const $e=KA(xe,!0);if(!p.filter(new Q(this.tileID.overscaledZ),$e,this.tileID.canonical))return}else if(!p.filter(new Q(this.tileID.overscaledZ),xe))return;const Le=this.getId(xe,de);for(let $e=0;$e<le.length;$e++){const De=le[$e];if(A&&A.indexOf(De)<0)continue;const je=C[De];if(!je)continue;let Ze={};Le!==void 0&&N&&(Ze=N.getState(je.sourceLayer||"_geojsonTileLayer",Le));const We=Ct({},M[De]);We.paint=Lj(We.paint,je.paint,xe,Ze,b),We.layout=Lj(We.layout,je.layout,xe,Ze,b);const bt=!U||U(xe,je,Ze,oe);if(!bt)continue;const _t=new _j(xe,this.z,this.x,this.y,Le);_t.layer=We;let Ft=l[De];Ft===void 0&&(Ft=l[De]=[]),Ft.push({featureIndex:W,feature:_t,intersectionZ:bt})}}lookupSymbolFeatures(l,f,p,A,b,C,M,N){const U={};this.loadVTLayers();const W=ma(b);for(const K of l)this.loadMatchingFeature(U,{bucketIndex:p,sourceLayerIndex:A,featureIndex:K,layoutVertexArrayOffset:0},W,C,M,N,f);return U}loadFeature(l){const{featureIndex:f,sourceLayerIndex:p}=l;this.loadVTLayers();const A=this.sourceLayerCoder.decode(p),b=this.vtFeatures[A];if(b[f])return b[f];const C=this.vtLayers[A].feature(f);return b[f]=C,C}hasLayer(l){for(const f of this.bucketLayerIDs)for(const p of f)if(l===p)return!0;return!1}getId(l,f){let p=l.id;if(this.promoteId){const A=typeof this.promoteId=="string"?this.promoteId:this.promoteId[f];A!=null&&(p=l.properties[A]),typeof p=="boolean"&&(p=Number(p))}return p}}function Lj(c,l,f,p,A){return hn(c,(b,C)=>{const M=l instanceof Re?l.get(C):null;return M&&M.evaluate?M.evaluate(f,p,A):M})}function fpe(c,l){return l-c}Mt(Rj,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Dj{constructor(l,f){this.width=l,this.height=f,this.nextRow=0,this.image=new Bp({width:l,height:f}),this.positions={},this.uploaded=!1}getDash(l,f){const p=this.getKey(l,f);return this.positions[p]}trim(){const l=this.width,f=this.height=Tn(this.nextRow);this.image.resize({width:l,height:f})}getKey(l,f){return l.join(",")+f}getDashRanges(l,f,p){const A=[];let b=l.length%2==1?-l[l.length-1]*p:0,C=l[0]*p,M=!0;A.push({left:b,right:C,isDash:M,zeroLength:l[0]===0});let N=l[0];for(let U=1;U<l.length;U++){M=!M;const W=l[U];b=N*p,N+=W,C=N*p,A.push({left:b,right:C,isDash:M,zeroLength:W===0})}return A}addRoundDash(l,f,p){const A=f/2;for(let b=-p;b<=p;b++){const C=this.width*(this.nextRow+p+b);let M=0,N=l[M];for(let U=0;U<this.width;U++){U/N.right>1&&(N=l[++M]);const W=Math.abs(U-N.left),K=Math.abs(U-N.right),ee=Math.min(W,K);let oe;const le=b/p*(A+1);if(N.isDash){const de=A-Math.abs(le);oe=Math.sqrt(ee*ee+de*de)}else oe=A-Math.sqrt(ee*ee+le*le);this.image.data[C+U]=Math.max(0,Math.min(255,oe+128))}}}addRegularDash(l,f){for(let N=l.length-1;N>=0;--N){const U=l[N],W=l[N+1];U.zeroLength?l.splice(N,1):W&&W.isDash===U.isDash&&(W.left=U.left,l.splice(N,1))}const p=l[0],A=l[l.length-1];p.isDash===A.isDash&&(p.left=A.left-this.width,A.right=p.right+this.width);const b=this.width*this.nextRow;let C=0,M=l[C];for(let N=0;N<this.width;N++){N/M.right>1&&(M=l[++C]);const U=Math.abs(N-M.left),W=Math.abs(N-M.right),K=Math.min(U,W);this.image.data[b+N]=Math.max(0,Math.min(255,(M.isDash?K:-K)+f+128))}}addDash(l,f){const p=this.getKey(l,f);if(this.positions[p])return this.positions[p];const A=f==="round",b=A?7:0,C=2*b+1;if(this.nextRow+C>this.height)return $t("LineAtlas out of space"),null;l.length===0&&l.push(1);let M=0;for(let W=0;W<l.length;W++)l[W]<0&&($t("Negative value is found in line dasharray, replacing values with 0"),l[W]=0),M+=l[W];if(M!==0){const W=this.width/M,K=this.getDashRanges(l,this.width,W);A?this.addRoundDash(K,W,b):this.addRegularDash(K,f==="square"?.5*W:0)}const N=this.nextRow+b;this.nextRow+=C;const U={tl:[N,b],br:[M,0]};return this.positions[p]=U,U}}Mt(Dj,"LineAtlas");const Bj=1*eh;class Nj{constructor(l){const f={},p=[];for(const M in l){const N=l[M],U=f[M]={};for(const W in N.glyphs){const K=N.glyphs[+W];if(!K||K.bitmap.width===0||K.bitmap.height===0)continue;const ee=K.metrics.localGlyph?Bj:1,oe={x:0,y:0,w:K.bitmap.width+2*ee,h:K.bitmap.height+2*ee};p.push(oe),U[W]=oe}}const{w:A,h:b}=C3(p),C=new Bp({width:A||1,height:b||1});for(const M in l){const N=l[M];for(const U in N.glyphs){const W=N.glyphs[+U];if(!W||W.bitmap.width===0||W.bitmap.height===0)continue;const K=f[M][U],ee=W.metrics.localGlyph?Bj:1;Bp.copy(W.bitmap,C,{x:0,y:0},{x:K.x+ee,y:K.y+ee},W.bitmap)}}this.image=C,this.positions=f}}Mt(Nj,"GlyphAtlas");class hpe{constructor(l){this.tileID=new fl(l.tileID.overscaledZ,l.tileID.wrap,l.tileID.canonical.z,l.tileID.canonical.x,l.tileID.canonical.y),this.tileZoom=l.tileZoom,this.uid=l.uid,this.zoom=l.zoom,this.canonical=l.tileID.canonical,this.pixelRatio=l.pixelRatio,this.tileSize=l.tileSize,this.source=l.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=l.showCollisionBoxes,this.collectResourceTiming=!!l.collectResourceTiming,this.returnDependencies=!!l.returnDependencies,this.promoteId=l.promoteId,this.enableTerrain=!!l.enableTerrain,this.isSymbolTile=l.isSymbolTile,this.tileTransform=t0(l.tileID.canonical,l.projection),this.projection=l.projection}parse(l,f,p,A,b){this.status="parsing",this.data=l,this.collisionBoxArray=new Si;const C=new Aj(Object.keys(l.layers).sort()),M=new Rj(this.tileID,this.promoteId);M.bucketLayerIDs=[];const N={},U=new Dj(256,256),W={featureIndex:M,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:U,availableImages:p},K=f.familiesBySource[this.source];for(const Ze in K){const We=l.layers[Ze];if(!We)continue;let bt=!1,_t=!1;for(const Tt of K[Ze])Tt[0].type==="symbol"?bt=!0:_t=!0;if(this.isSymbolTile===!0&&!bt||this.isSymbolTile===!1&&!_t)continue;We.version===1&&$t(`Vector tile source "${this.source}" layer "${Ze}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ft=C.encode(Ze),tn=[];for(let Tt=0;Tt<We.length;Tt++){const Gt=We.feature(Tt),jt=M.getId(Gt,Ze);tn.push({feature:Gt,id:jt,index:Tt,sourceLayerIndex:Ft})}for(const Tt of K[Ze]){const Gt=Tt[0];this.isSymbolTile!==void 0&&Gt.type==="symbol"!==this.isSymbolTile||Gt.minzoom&&this.zoom<Math.floor(Gt.minzoom)||Gt.maxzoom&&this.zoom>=Gt.maxzoom||Gt.visibility!=="none"&&($3(Tt,this.zoom,p),(N[Gt.id]=Gt.createBucket({index:M.bucketLayerIDs.length,layers:Tt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ft,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:p})).populate(tn,W,this.tileID.canonical,this.tileTransform),M.bucketLayerIDs.push(Tt.map(jt=>jt.id)))}}let ee,oe,le,de;U.trim();const xe={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Le=()=>{if(ee)return b(ee);if(oe&&le&&de){const Ze=new Nj(oe),We=new VG(le,de);for(const bt in N){const _t=N[bt];_t instanceof nm?($3(_t.layers,this.zoom,p),kde(_t,oe,Ze.positions,le,We.iconPositions,this.showCollisionBoxes,p,this.tileID.canonical,this.tileZoom,this.projection)):_t.hasPattern&&(_t instanceof U2||_t instanceof B2||_t instanceof Lx)&&($3(_t.layers,this.zoom,p),_t.addFeatures(W,this.tileID.canonical,We.patternPositions,p,this.tileTransform))}this.status="done",b(null,{buckets:ct(N).filter(bt=>!bt.isEmpty()),featureIndex:M,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ze.image,lineAtlas:U,imageAtlas:We,glyphMap:this.returnDependencies?oe:null,iconMap:this.returnDependencies?le:null,glyphPositions:this.returnDependencies?Ze.positions:null})}},$e=hn(W.glyphDependencies,Ze=>Object.keys(Ze).map(Number));Object.keys($e).length?A.send("getGlyphs",{uid:this.uid,stacks:$e},(Ze,We)=>{ee||(ee=Ze,oe=We,Le())},void 0,!1,xe):oe={};const De=Object.keys(W.iconDependencies);De.length?A.send("getImages",{icons:De,source:this.source,tileID:this.tileID,type:"icons"},(Ze,We)=>{ee||(ee=Ze,le=We,Le())},void 0,!1,xe):le={};const je=Object.keys(W.patternDependencies);je.length?A.send("getImages",{icons:je,source:this.source,tileID:this.tileID,type:"patterns"},(Ze,We)=>{ee||(ee=Ze,de=We,Le())},void 0,!1,xe):de={},Le()}}function $3(c,l,f){const p=new Q(l);for(const A of c)A.recalculate(p,f)}class Fj{constructor(l){this.entries={},this.scheduler=l}request(l,f,p,A){const b=this.entries[l]=this.entries[l]||{callbacks:[]};if(b.result){const[C,M]=b.result;return this.scheduler?this.scheduler.add(()=>{A(C,M)},f):A(C,M),()=>{}}return b.callbacks.push(A),b.cancel||(b.cancel=p((C,M)=>{b.result=[C,M];for(const N of b.callbacks)this.scheduler?this.scheduler.add(()=>{N(C,M)},f):N(C,M);setTimeout(()=>delete this.entries[l],3e3)})),()=>{b.result||(b.callbacks=b.callbacks.filter(C=>C!==A),b.callbacks.length||(b.cancel(),delete this.entries[l]))}}}function kj(c,l,f){const p=JSON.stringify(c.request);return c.data&&(this.deduped.entries[p]={result:[null,c.data]}),this.deduped.request(p,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},A=>{const b=Fc(c.request,(C,M,N,U)=>{C?A(C):M&&A(null,{vectorTile:f?void 0:new w3(new V2(M)),rawData:M,cacheControl:N,expires:U})});return()=>{b.cancel(),A()}},l)}const zj=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class H3{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[f,p]=new Uint8Array(l,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");const A=p>>4;if(A!==1)throw new Error(`Got v${A} data when expected v1.`);const b=zj[15&p];if(!b)throw new Error("Unrecognized array type.");const[C]=new Uint16Array(l,2,1),[M]=new Uint32Array(l,4,1);return new H3(M,C,b,l)}constructor(l,f=64,p=Float64Array,A){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=p,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const b=zj.indexOf(this.ArrayType),C=2*l*this.ArrayType.BYTES_PER_ELEMENT,M=l*this.IndexArrayType.BYTES_PER_ELEMENT,N=(8-M%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${p}.`);A&&A instanceof ArrayBuffer?(this.data=A,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+M+N,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+C+M+N),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+M+N,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=l)}add(l,f){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=l,this.coords[this._pos++]=f,p}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return W3(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,f,p,A){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:C,nodeSize:M}=this,N=[0,b.length-1,0],U=[];for(;N.length;){const W=N.pop()||0,K=N.pop()||0,ee=N.pop()||0;if(K-ee<=M){for(let xe=ee;xe<=K;xe++){const Le=C[2*xe],$e=C[2*xe+1];Le>=l&&Le<=p&&$e>=f&&$e<=A&&U.push(b[xe])}continue}const oe=ee+K>>1,le=C[2*oe],de=C[2*oe+1];le>=l&&le<=p&&de>=f&&de<=A&&U.push(b[oe]),(W===0?l<=le:f<=de)&&(N.push(ee),N.push(oe-1),N.push(1-W)),(W===0?p>=le:A>=de)&&(N.push(oe+1),N.push(K),N.push(1-W))}return U}within(l,f,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:A,coords:b,nodeSize:C}=this,M=[0,A.length-1,0],N=[],U=p*p;for(;M.length;){const W=M.pop()||0,K=M.pop()||0,ee=M.pop()||0;if(K-ee<=C){for(let xe=ee;xe<=K;xe++)Gj(b[2*xe],b[2*xe+1],l,f)<=U&&N.push(A[xe]);continue}const oe=ee+K>>1,le=b[2*oe],de=b[2*oe+1];Gj(le,de,l,f)<=U&&N.push(A[oe]),(W===0?l-p<=le:f-p<=de)&&(M.push(ee),M.push(oe-1),M.push(1-W)),(W===0?l+p>=le:f+p>=de)&&(M.push(oe+1),M.push(K),M.push(1-W))}return N}}function W3(c,l,f,p,A,b){if(A-p<=f)return;const C=p+A>>1;Uj(c,l,C,p,A,b),W3(c,l,f,p,C-1,1-b),W3(c,l,f,C+1,A,1-b)}function Uj(c,l,f,p,A,b){for(;A>p;){if(A-p>600){const U=A-p+1,W=f-p+1,K=Math.log(U),ee=.5*Math.exp(2*K/3),oe=.5*Math.sqrt(K*ee*(U-ee)/U)*(W-U/2<0?-1:1);Uj(c,l,f,Math.max(p,Math.floor(f-W*ee/U+oe)),Math.min(A,Math.floor(f+(U-W)*ee/U+oe)),b)}const C=l[2*f+b];let M=p,N=A;for(Wx(c,l,p,f),l[2*A+b]>C&&Wx(c,l,p,A);M<N;){for(Wx(c,l,M,N),M++,N--;l[2*M+b]<C;)M++;for(;l[2*N+b]>C;)N--}l[2*p+b]===C?Wx(c,l,p,N):(N++,Wx(c,l,N,A)),N<=f&&(p=N+1),f<=N&&(A=N-1)}}function Wx(c,l,f,p){q3(c,f,p),q3(l,2*f,2*p),q3(l,2*f+1,2*p+1)}function q3(c,l,f){const p=c[l];c[l]=c[f],c[f]=p}function Gj(c,l,f,p){const A=c-f,b=l-p;return A*A+b*b}s.ARRAY_TYPE=gu,s.AUTH_ERR_MSG=Me,s.Aabb=cl,s.Actor=class{constructor(c,l,f){this.target=c,this.parent=l,this.mapId=f,this.callbacks={},this.cancelCallbacks={},Zt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ln()?c:u,this.scheduler=new ope}send(c,l,f,p,A=!1,b){const C=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(f.metadata=b,this.callbacks[C]=f);const M=cr(this.globalScope)?void 0:[];return this.target.postMessage({id:C,type:c,hasCallback:!!f,targetMapId:p,mustQueue:A,sourceMapId:this.mapId,data:Vr(l,M)},M),{cancel:()=>{f&&delete this.callbacks[C],this.target.postMessage({id:C,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(c){const l=c.data,f=l.id;if(f&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){const p=this.cancelCallbacks[f];delete this.cancelCallbacks[f],p&&p.cancel()}else if(l.mustQueue||Ln()){const p=this.callbacks[f];this.cancelCallbacks[f]=this.scheduler.add(()=>this.processTask(f,l),p&&p.metadata||{type:"message"})}else this.processTask(f,l)}processTask(c,l){if(l.type==="<response>"){const f=this.callbacks[c];delete this.callbacks[c],f&&(l.error?f(Jr(l.error)):f(null,Jr(l.data)))}else{const f=cr(this.globalScope)?void 0:[],p=l.hasCallback?(b,C)=>{delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:b?Vr(b):null,data:Vr(C,f)},f)}:b=>{},A=Jr(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,A,p);else if(this.parent.getWorkerSource){const b=l.type.split(".");this.parent.getWorkerSource(l.sourceMapId,b[0],A.source)[b[1]](A,p)}else p(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=z2,s.Color=lo,s.ColorMode=ud,s.CullFaceMode=th,s.DEMData=nS,s.DataConstantProperty=he,s.DedupedRequest=Fj,s.DepthMode=ly,s.EXTENT=Kn,s.Elevation=class{isDataAvailableAtPoint(c){const l=this._source();if(this.isUsingMockSource()||!l||c.y<0||c.y>1)return!1;const f=l.getSource().maxzoom,p=1<<f,A=Math.floor(c.x),b=Math.floor((c.x-A)*p),C=Math.floor(c.y*p),M=this.findDEMTileFor(new fl(f,A,f,b,C));return!(!M||!M.dem)}getAtPointOrZero(c,l=0){return this.getAtPoint(c,l)||0}getAtPoint(c,l,f=!0){if(this.isUsingMockSource())return null;l==null&&(l=null);const p=this._source();if(!p||c.y<0||c.y>1)return l;const A=p.getSource().maxzoom,b=1<<A,C=Math.floor(c.x),M=c.x-C,N=new fl(A,C,A,Math.floor(M*b),Math.floor(c.y*b)),U=this.findDEMTileFor(N);if(!U||!U.dem)return l;const W=U.dem,K=1<<U.tileID.canonical.z,ee=(M*K-U.tileID.canonical.x)*W.dim,oe=(c.y*K-U.tileID.canonical.y)*W.dim,le=Math.floor(ee),de=Math.floor(oe);return(f?this.exaggeration():1)*jr(jr(W.get(le,de),W.get(le,de+1),oe-de),jr(W.get(le+1,de),W.get(le+1,de+1),oe-de),ee-le)}getAtTileOffset(c,l,f){const p=1<<c.canonical.z;return this.getAtPointOrZero(new X_(c.wrap+(c.canonical.x+l/Kn)/p,(c.canonical.y+f/Kn)/p))}getAtTileOffsetFunc(c,l,f,p){return A=>{const b=this.getAtTileOffset(c,A.x,A.y),C=p.upVector(c.canonical,A.x,A.y);return Ku(C,C,b*p.upVectorScale(c.canonical,l,f).metersToTile),C}}getForTilePoints(c,l,f,p){if(this.isUsingMockSource())return!1;const A=rS.create(this,c,p);return!!A&&(l.forEach(b=>{b[2]=this.exaggeration()*A.getElevationAt(b[0],b[1],f)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const l=this.findDEMTileFor(c);if(!l||!l.dem)return null;const f=l.dem.tree,p=l.tileID,A=1<<c.canonical.z-p.canonical.z;let b=c.canonical.x/A-p.canonical.x,C=c.canonical.y/A-p.canonical.y,M=0;for(let N=0;N<c.canonical.z-p.canonical.z&&!f.leaves[M];N++){b*=2,C*=2;const U=2*Math.floor(C)+Math.floor(b);M=f.childOffsets[M]+U,b%=1,C%=1}return{min:this.exaggeration()*f.minimums[M],max:this.exaggeration()*f.maximums[M]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,l,f){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=Hn,s.EvaluationParameters=Q,s.Event=$o,s.Evented=Ke,s.FillExtrusionBucket=Lx,s.Frustum=e3,s.FrustumCorners=JL,s.GLOBE_RADIUS=rd,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=U8,s.GLOBE_ZOOM_THRESHOLD_MIN=t3,s.GlobeSharedBuffers=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const c of this._wireframeSegments)c.destroy()}}_fillGridMeshWithLods(c,l){const f=new en,p=new Vn,A=[],b=c+1+2,C=l[0]+1,M=l[0]+1+(1+l.length),N=(U,W,K)=>{let ee=U===b-1?U-2:U===0?U:U-1;return ee+=K?24575:0,[ee,W]};for(let U=0;U<b;++U)f.emplaceBack(...N(U,0,!0));for(let U=0;U<C;++U)for(let W=0;W<b;++W)f.emplaceBack(...N(W,U,(W===0||W===b-1)&&!0));for(let U=0;U<l.length;++U){const W=l[U];for(let K=0;K<b;++K)f.emplaceBack(...N(K,W,!0))}for(let U=0;U<l.length;++U){const W=p.length,K=l[U]+1+2,ee=new Vn;for(let de=0;de<K-1;de++){const xe=de===K-2,Le=xe?b*(M-l.length+U-de):b;for(let $e=0;$e<b-1;$e++){const De=de*b+$e;de===0||xe||$e===0||$e===b-2?(ee.emplaceBack(De+1,De,De+Le),ee.emplaceBack(De+Le,De+Le+1,De+1)):(p.emplaceBack(De+1,De,De+Le),p.emplaceBack(De+Le,De+Le+1,De+1))}}const oe=Wo.simpleSegment(0,W,f.length,p.length-W);for(let de=0;de<ee.uint16.length;de+=3)p.emplaceBack(ee.uint16[de],ee.uint16[de+1],ee.uint16[de+2]);const le=Wo.simpleSegment(0,W,f.length,p.length-W);A.push({withoutSkirts:oe,withSkirts:le})}return{vertices:f,indices:p,segments:A}}_createGrid(c){const l=this._fillGridMeshWithLods(YA,wx);this._gridSegments=l.segments,this._gridBuffer=c.createVertexBuffer(l.vertices,bx.members),this._gridIndexBuffer=c.createIndexBuffer(l.indices,!0)}_createPoles(c){const l=new Vn;for(let A=0;A<=YA;A++)l.emplaceBack(0,A+1,A+2);this._poleIndexBuffer=c.createIndexBuffer(l,!0);const f=new Ei,p=new Ei;this._poleSegments=[];for(let A=0,b=0;A<t3;A++){const C=360/(1<<A);f.emplaceBack(0,-rd,0,.5,0),p.emplaceBack(0,-rd,0,.5,1);for(let M=0;M<=YA;M++){const N=M/YA,U=jr(0,C,N),[W,K,ee]=H_(ohe,she,U,rd);f.emplaceBack(W,K,ee,N,0),p.emplaceBack(W,K,ee,N,1)}this._poleSegments.push(Wo.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(f,k8,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(p,k8,!1)}getGridBuffers(c,l){return[this._gridBuffer,this._gridIndexBuffer,l?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}getWirefameBuffers(c,l){if(!this._wireframeSegments){const f=new Ns,p=YA,A=p+1+2,b=1;this._wireframeSegments=[];for(let C=0,M=0;C<wx.length;C++){const N=wx[C];for(let W=b;W<N+b;W++)for(let K=b;K<p+b;K++){const ee=W*A+K;f.emplaceBack(ee,ee+1),f.emplaceBack(ee,ee+A),f.emplaceBack(ee,ee+A+1)}const U=N*p*3;this._wireframeSegments.push(Wo.simpleSegment(0,M,(N+1)*A,U)),M+=U}this._wireframeIndexBuffer=c.createIndexBuffer(f)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[l]]}},s.GlyphManager=ry,s.ImagePosition=P3,s.KDBush=H3,s.LivePerformanceUtils=qi,s.LngLat=Ti,s.LngLatBounds=Kg,s.LocalGlyphMode=O3,s.MAX_MERCATOR_LATITUDE=va,s.MercatorCoordinate=X_,s.ONE_EM=Qs,s.OverscaledTileID=fl,s.PerformanceMarkers=Tr,s.Point=re,s.Properties=ke,s.RGBAImage=mu,s.Ray=KL,s.RequestManager=class{constructor(c,l,f){this._transformRequestFn=c,this._customAccessToken=l,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){const c=function(){let l="";for(let f=0;f<10;f++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",F,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=c.token,this._skuTokenExpiresAt=c.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(c,l){return this._transformRequestFn&&this._transformRequestFn(c,l)||{url:c}}normalizeStyleURL(c,l){if(!it(c))return c;const f=dn(c);return f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||l)}normalizeGlyphsURL(c,l){if(!it(c))return c;const f=dn(c);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||l)}normalizeSourceURL(c,l,f,p){if(!it(c))return c;const A=dn(c);return A.path=`/v4/${A.authority}.json`,A.params.push("secure"),f&&A.params.push(`language=${f}`),p&&A.params.push(`worldview=${p}`),this._makeAPIURL(A,this._customAccessToken||l)}normalizeSpriteURL(c,l,f,p){const A=dn(c);return it(c)?(A.path=`/styles/v1${A.path}/sprite${l}${f}`,this._makeAPIURL(A,this._customAccessToken||p)):(A.path+=`${l}${f}`,Qt(A))}normalizeTileURL(c,l,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),c&&!it(c))return c;const p=dn(c);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||f&&p.authority!=="raster"&&f===512?"@2x":""}${E.supported?".webp":"$1"}`),p.authority==="raster"?p.path=`/${_.RASTER_URL_PREFIX}${p.path}`:(p.path=p.path.replace(/^.+\/v4\//,"/"),p.path=`/${_.TILE_URL_VERSION}${p.path}`);const A=this._customAccessToken||function(b){for(const C of b){const M=C.match(/^access_token=(.*)$/);if(M)return M[1]}return null}(p.params)||_.ACCESS_TOKEN;return _.REQUIRE_ACCESS_TOKEN&&A&&this._skuToken&&p.params.push(`sku=${this._skuToken}`),this._makeAPIURL(p,A)}canonicalizeTileURL(c,l){const f=dn(c);if(!f.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!f.path.match(/\.[\w]+$/))return c;let p="mapbox://";f.path.match(/^\/raster\/v1\//)?p+=`raster/${f.path.replace(`/${_.RASTER_URL_PREFIX}/`,"")}`:p+=`tiles/${f.path.replace(`/${_.TILE_URL_VERSION}/`,"")}`;let A=f.params;return l&&(A=A.filter(b=>!b.match(/^access_token=/))),A.length&&(p+=`?${A.join("&")}`),p}canonicalizeTileset(c,l){const f=!!l&&it(l),p=[];for(const A of c.tiles||[])ht(A)?p.push(this.canonicalizeTileURL(A,f)):p.push(A);return p}_makeAPIURL(c,l){const f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",p=dn(_.API_URL);if(c.protocol=p.protocol,c.authority=p.authority,c.protocol==="http"){const A=c.params.indexOf("secure");A>=0&&c.params.splice(A,1)}if(p.path!=="/"&&(c.path=`${p.path}${c.path}`),!_.REQUIRE_ACCESS_TOKEN)return Qt(c);if(l=l||_.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return c.params=c.params.filter(A=>A.indexOf("access_token")===-1),c.params.push(`access_token=${l||""}`),Qt(c)}},s.ResourceType=$u,s.SegmentVector=Wo,s.SourceCache=n0,s.StencilMode=G3,s.StructArrayLayout1ui2=pu,s.StructArrayLayout2f1f2i16=er,s.StructArrayLayout2i4=en,s.StructArrayLayout2ui4=Ns,s.StructArrayLayout3f12=Nr,s.StructArrayLayout3ui6=Vn,s.StructArrayLayout4i8=Ut,s.StructArrayLayout5f20=Ei,s.Texture=$x,s.Tile=z3,s.Transitionable=fe,s.Uniform1f=b2,s.Uniform1i=class extends Op{constructor(c){super(c),this.current=0}set(c,l,f){this.fetchUniformLocation(c,l)&&this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}},s.Uniform2f=class extends Op{constructor(c){super(c),this.current=[0,0]}set(c,l,f){this.fetchUniformLocation(c,l)&&(f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1])))}},s.Uniform3f=class extends Op{constructor(c){super(c),this.current=[0,0,0]}set(c,l,f){this.fetchUniformLocation(c,l)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2])))}},s.Uniform4f=x8,s.UniformColor=b8,s.UniformMatrix2f=class extends Op{constructor(c){super(c),this.current=Vfe}set(c,l,f){if(this.fetchUniformLocation(c,l)){for(let p=0;p<4;p++)if(f[p]!==this.current[p]){this.current=f,this.gl.uniformMatrix2fv(this.location,!1,f);break}}}},s.UniformMatrix3f=class extends Op{constructor(c){super(c),this.current=jfe}set(c,l,f){if(this.fetchUniformLocation(c,l)){for(let p=0;p<9;p++)if(f[p]!==this.current[p]){this.current=f,this.gl.uniformMatrix3fv(this.location,!1,f);break}}}},s.UniformMatrix4f=class extends Op{constructor(c){super(c),this.current=Gfe}set(c,l,f){if(this.fetchUniformLocation(c,l)){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let p=1;p<16;p++)if(f[p]!==this.current[p]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}}},s.UnwrappedTileID=PG,s.ValidationError=Sn,s.VectorTileFeature=F2,s.VectorTileWorkerSource=class extends Ke{constructor(c,l,f,p,A){super(),this.actor=c,this.layerIndex=l,this.availableImages=f,this.loadVectorData=A||kj,this.loading={},this.loaded={},this.deduped=new Fj(c.scheduler),this.isSpriteLoaded=p,this.scheduler=c.scheduler}loadTile(c,l){const f=c.uid,p=c&&c.request,A=p&&p.collectResourceTiming,b=this.loading[f]=new hpe(c);b.abort=this.loadVectorData(c,(C,M)=>{const N=!this.loading[f];if(delete this.loading[f],N||C||!M)return b.status="done",N||(this.loaded[f]=b),l(C);const U=M.rawData,W={};M.expires&&(W.expires=M.expires),M.cacheControl&&(W.cacheControl=M.cacheControl),b.vectorTile=M.vectorTile||new w3(new V2(U));const K=()=>{b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,(ee,oe)=>{if(ee||!oe)return l(ee);const le={};if(A){const de=ro(p);de.length>0&&(le.resourceTiming=JSON.parse(JSON.stringify(de)))}l(null,Ct({rawTileData:U.slice(0)},oe,W,le))})};this.isSpriteLoaded?K():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(K,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom}):K()}),this.loaded=this.loaded||{},this.loaded[f]=b})}reloadTile(c,l){const f=this.loaded,p=c.uid,A=this;if(f&&f[p]){const b=f[p];b.showCollisionBoxes=c.showCollisionBoxes,b.enableTerrain=!!c.enableTerrain,b.projection=c.projection,b.tileTransform=t0(c.tileID.canonical,c.projection);const C=(M,N)=>{const U=b.reloadCallback;U&&(delete b.reloadCallback,b.parse(b.vectorTile,A.layerIndex,this.availableImages,A.actor,U)),l(M,N)};b.status==="parsing"?b.reloadCallback=C:b.status==="done"&&(b.vectorTile?b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,C):C())}}abortTile(c,l){const f=c.uid,p=this.loading[f];p&&(p.abort&&p.abort(),delete this.loading[f]),l()}removeTile(c,l){const f=this.loaded,p=c.uid;f&&f[p]&&delete f[p],l()}},s.WritingMode=ec,s.ZoomDependentExpression=Ep,s.add=Lp,s.addDynamicAttributes=J2,s.adjoint=function(c,l){var f=l[0],p=l[1],A=l[2],b=l[3],C=l[4],M=l[5],N=l[6],U=l[7],W=l[8];return c[0]=C*W-M*U,c[1]=A*U-p*W,c[2]=p*M-A*C,c[3]=M*N-b*W,c[4]=f*W-A*N,c[5]=A*b-f*M,c[6]=b*U-C*N,c[7]=p*N-f*U,c[8]=f*C-p*b,c},s.asyncAll=qe,s.bezier=tt,s.bindAll=Zt,s.boundsAttributes=vj,s.bufferConvexPolygon=function(c,l){const f=[];for(let p=0;p<c.length;p++){const A=Be(p-1,-1,c.length-1),b=Be(p+1,-1,c.length-1),C=c[p],M=c[b],N=c[A].sub(C).unit(),U=M.sub(C).unit(),W=U.angleWithSep(N.x,N.y),K=N.add(U).unit().mult(-1*l/Math.sin(W/2));f.push(C.add(K))}return f},s.cacheEntryPossiblyAdded=function(c){au++,au>Nl&&(c.getActor().send("enforceCacheSizeLimit",Fa),au=0)},s.calculateGlobeLabelMatrix=function(c,l){const{x:f,y:p}=c.point,A=H8(f,p,c.worldSize/c._pixelsPerMercatorPixel,0,0);return qA(A,A,i3(id(l)))},s.calculateGlobeMatrix=function(c){const{x:l,y:f}=c.point,{lng:p,lat:A}=c._center;return H8(l,f,c.worldSize,p,A)},s.calculateGlobeMercatorMatrix=function(c){const l=c.pixelsPerMeter,f=l/Kf(1,c.center.lat),p=Yf(new Float64Array(16));return mx(p,p,[c.point.x,c.point.y,0]),XA(p,p,[f,f,l]),Float32Array.from(p)},s.circumferenceAtLatitude=s3,s.clamp=Ee,s.clearTileCache=function(c){if(!Fl())return;const l=u.caches.delete(Do);c&&l.catch(c).then(()=>c())},s.clipLine=nj,s.clone=function(c){var l=new gu(16);return l[0]=c[0],l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5],l[6]=c[6],l[7]=c[7],l[8]=c[8],l[9]=c[9],l[10]=c[10],l[11]=c[11],l[12]=c[12],l[13]=c[13],l[14]=c[14],l[15]=c[15],l},s.clone$1=It,s.collisionCircleLayout=cde,s.config=_,s.conjugate=function(c,l){return c[0]=-l[0],c[1]=-l[1],c[2]=-l[2],c[3]=l[3],c},s.create=function(){var c=new gu(16);return gu!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},s.create$1=S8,s.createExpression=Qh,s.createLayout=at,s.createStyleLayer=function(c){return c.type==="custom"?new tpe(c):new rpe[c.type](c)},s.cross=QL,s.degToRad=me,s.distance=function(c,l){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])},s.div=function(c,l,f){return c[0]=l[0]/f[0],c[1]=l[1]/f[1],c[2]=l[2]/f[2],c},s.dot=qc,s.earthRadius=Tx,s.ease=pt,s.easeCubicInOut=Ye,s.ecefToLatLng=function([c,l,f]){const p=Math.hypot(c,l,f),A=Math.atan2(c,f),b=.5*Math.PI-Math.acos(-l/p);return new Ti(Ce(A),Ce(b))},s.emitValidationErrors=Rt,s.endsWith=Wt,s.enforceCacheSizeLimit=function(c){su(),_s&&_s.then(l=>{l.keys().then(f=>{for(let p=0;p<f.length-c;p++)l.delete(f[p])})})},s.evaluateSizeForFeature=G2,s.evaluateSizeForZoom=J_,s.evaluateVariableOffset=aj,s.evented=I,s.exactEquals=function(c,l){return c[0]===l[0]&&c[1]===l[1]&&c[2]===l[2]&&c[3]===l[3]},s.exactEquals$1=function(c,l){return c[0]===l[0]&&c[1]===l[1]&&c[2]===l[2]},s.exported=Vo,s.exported$1=E,s.extend=Ct,s.extend$1=za,s.fillExtrusionHeightLift=SG,s.filterObject=lr,s.fromMat4=function(c,l){return c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=l[4],c[4]=l[5],c[5]=l[6],c[6]=l[8],c[7]=l[9],c[8]=l[10],c},s.fromQuat=function(c,l){var f=l[0],p=l[1],A=l[2],b=l[3],C=f+f,M=p+p,N=A+A,U=f*C,W=p*C,K=p*M,ee=A*C,oe=A*M,le=A*N,de=b*C,xe=b*M,Le=b*N;return c[0]=1-K-le,c[1]=W+Le,c[2]=ee-xe,c[3]=0,c[4]=W-Le,c[5]=1-U-le,c[6]=oe+de,c[7]=0,c[8]=ee+xe,c[9]=oe-de,c[10]=1-U-K,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},s.fromRotation=function(c,l){var f=Math.sin(l),p=Math.cos(l);return c[0]=p,c[1]=f,c[2]=0,c[3]=-f,c[4]=p,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},s.fromScaling=C8,s.furthestTileCorner=function(c){const l=Math.round((c+45+360)%360/90)%4;return be[l]},s.getAABBPointSquareDist=function(c,l,f){let p=0;for(let A=0;A<2;++A){const b=f?f[A]:0;c[A]>b&&(p+=(c[A]-b)*(c[A]-b)),l[A]<b&&(p+=(b-l[A])*(b-l[A]))}return p},s.getAnchorAlignment=M3,s.getAnchorJustification=L3,s.getBounds=function(c){let l=1/0,f=1/0,p=-1/0,A=-1/0;for(const b of c)l=Math.min(l,b.x),f=Math.min(f,b.y),p=Math.max(p,b.x),A=Math.max(A,b.y);return{min:new re(l,f),max:new re(p,A)}},s.getColumn=Ri,s.getDefaultExportFromCjs=k,s.getGridMatrix=function(c,l,f,p){const A=l.getNorth(),b=l.getSouth(),C=l.getWest(),M=l.getEast(),N=1<<c.z,U=M-C,W=A-b,K=U/YA,ee=-W/wx[f],oe=[0,K,0,ee,0,0,A,C,0];if(c.z>0){const le=180/p;T8(oe,oe,[le/U+1,0,0,0,le/W+1,0,-.5*le/K,.5*le/ee,1])}return oe[2]=N,oe[5]=c.x,oe[8]=c.y,oe},s.getImage=ze,s.getJSON=function(c,l){return uu(Ct(c,{type:"json"}),l)},s.getLatitudinalLod=function(c){const l=va-5;c=Ee(c,-l,l)/l*90;const f=Math.pow(Math.abs(Math.sin(me(c))),3);return Math.round(f*(wx.length-1))},s.getMapSessionAPI=fr,s.getPerformanceMeasurement=ro,s.getProjection=gj,s.getRTLTextPluginStatus=L,s.getReferrer=Hu,s.getTilePoint=function(c,{x:l,y:f},p=0){return new re(((l-p)*c.scale-c.x)*Kn,(f*c.scale-c.y)*Kn)},s.getTileVec3=function(c,l,f=0){return $_(((l.x-f)*c.scale-c.x)*Kn,(l.y*c.scale-c.y)*Kn,Z8(l.z,l.y))},s.getVideo=function(c,l){const f=u.document.createElement("video");f.muted=!0,f.onloadstart=function(){l(null,f)};for(let p=0;p<c.length;p++){const A=u.document.createElement("source");Wu(c[p])||(f.crossOrigin="Anonymous"),A.src=c[p],f.appendChild(A)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(c){const l=[0,0,0],f=Yf(new Float64Array(16));return qA(f,c.pixelMatrix,c.globeMatrix),Fo(l,l,f),new re(l[0],l[1])},s.globeDenormalizeECEF=i3,s.globeECEFOrigin=function(c,l){const f=[0,0,0];return Fo(f,f,Sx(id(l.canonical))),Fo(f,f,c),f},s.globeMetersToEcef=S2,s.globeNormalizeECEF=Sx,s.globePixelsToTileUnits=function(c,l){return Kn/(512*Math.pow(2,c))*C2(id(l))},s.globePoleMatrixForTile=function(c,l,f){const p=Yf(new Float64Array(16)),A=(l/(1<<c)-.5)*Math.PI*2;return E2(p,f.globeMatrix,A),Float32Array.from(p)},s.globeTileBounds=id,s.globeTiltAtLngLat=W8,s.globeToMercatorTransition=q_,s.globeUseCustomAntiAliasing=function(c,l,f){const p=q_(f.zoom),A=c.style.map._antialias,b=!!l.extStandardDerivatives,C=l.extStandardDerivativesForceOff||c.terrain&&c.terrain.exaggeration()>0;return p===0&&!A&&!C&&b},s.identity=Yf,s.identity$1=B8,s.invert=qL,s.isFullscreen=function(){return!!u.document.fullscreenElement||!!u.document.webkitFullscreenElement},s.isLngLatBehindGlobe=o3,s.isMapAuthenticated=function(c){return rr.has(c)},s.isMapboxURL=it,s.isSafariWithAntialiasingBug=function(c){const l=c.navigator?c.navigator.userAgent:null;return!!cr(c)&&l&&(l.match("Version/15.4")||l.match("Version/15.5")||l.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=ya,s.latLngToECEF=W_,s.len=Kfe,s.length=Ax,s.length$1=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},s.lngFromMercatorX=Ju,s.loadVectorTile=kj,s.makeRequest=uu,s.mapValue=function(c,l,f,p,A){return Ee((c-l)/(f-l)*(A-p)+p,p,A)},s.mercatorScale=Y8,s.mercatorXfromLng=od,s.mercatorYfromLat=sd,s.mercatorZfromAltitude=Kf,s.mul=Yfe,s.mul$1=Qfe,s.multiply=qA,s.multiply$1=T8,s.multiply$2=M8,s.nextPowerOfTwo=Tn,s.normalize=ul,s.normalize$1=Jfe,s.normalize$2=L8,s.number=jr,s.ortho=function(c,l,f,p,A,b,C){var M=1/(l-f),N=1/(p-A),U=1/(b-C);return c[0]=-2*M,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*N,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*U,c[11]=0,c[12]=(l+f)*M,c[13]=(A+p)*N,c[14]=(C+b)*U,c[15]=1,c},s.pbf=BG,s.perspective=function(c,l,f,p,A){var b,C=1/Math.tan(l/2);return c[0]=C/f,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=C,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,A!=null&&A!==1/0?(c[10]=(A+p)*(b=1/(p-A)),c[14]=2*A*p*b):(c[10]=-1,c[14]=-2*p),c},s.pick=function(c,l){const f={};for(let p=0;p<l.length;p++){const A=l[p];A in c&&(f[A]=c[A])}return f},s.plugin=H,s.pointGeometry=ie,s.polesInViewport=function(c){const l=Yf(new Float64Array(16));qA(l,c.pixelMatrix,c.globeMatrix);const f=[0,Xc,0],p=[0,Zc,0];return Fo(f,f,l),Fo(p,p,l),[f[0]>0&&f[0]<=c.width&&f[1]>0&&f[1]<=c.height&&!o3(c,new Ti(c.center.lat,90)),p[0]>0&&p[0]<=c.width&&p[1]>0&&p[1]<=c.height&&!o3(c,new Ti(c.center.lat,-90))]},s.polygonContainsPoint=JA,s.polygonIntersectsBox=rG,s.polygonIntersectsPolygon=J8,s.polygonizeBounds=function(c,l,f=0,p=!0){const A=new re(f,f),b=c.sub(A),C=l.add(A),M=[b,new re(C.x,b.y),C,new re(b.x,C.y)];return p&&M.push(b.clone()),M},s.posAttributes=bx,s.postMapLoadEvent=Gn,s.postPerformanceEvent=Ue,s.postTurnstileEvent=Pt,s.potpack=C3,s.prevPowerOfTwo=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},s.radToDeg=Ce,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(c){return c({pluginStatus:v,pluginURL:h}),I.on("pluginStateChange",c),c},s.removeAuthState=function(c){rr.delete(c)},s.renderColorRamp=p3,s.resample=Q8,s.rotateX=XL,s.rotateX$1=N8,s.rotateY=E2,s.rotateY$1=F8,s.rotateZ=function(c,l,f){var p=Math.sin(f),A=Math.cos(f),b=l[0],C=l[1],M=l[2],N=l[3],U=l[4],W=l[5],K=l[6],ee=l[7];return l!==c&&(c[8]=l[8],c[9]=l[9],c[10]=l[10],c[11]=l[11],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[0]=b*A+U*p,c[1]=C*A+W*p,c[2]=M*A+K*p,c[3]=N*A+ee*p,c[4]=U*A-b*p,c[5]=W*A-C*p,c[6]=K*A-M*p,c[7]=ee*A-N*p,c},s.rotateZ$1=function(c,l,f){f*=.5;var p=l[0],A=l[1],b=l[2],C=l[3],M=Math.sin(f),N=Math.cos(f);return c[0]=p*N+A*M,c[1]=A*N-p*M,c[2]=b*N+C*M,c[3]=C*N-b*M,c},s.scale=XA,s.scale$1=R8,s.scale$2=Ku,s.scaleAndAdd=vx,s.set=function(c,l,f,p){return c[0]=l,c[1]=f,c[2]=p,c},s.setCacheLimits=function(c,l){Fa=c,Nl=l},s.setColumn=function(c,l,f){c[4*l+0]=f[0],c[4*l+1]=f[1],c[4*l+2]=f[2],c[4*l+3]=f[3]},s.setRTLTextPlugin=function(c,l,f=!1){if(v===fx||v===hx||v===dx)throw new Error("setRTLTextPlugin cannot be called multiple times.");h=Vo.resolveURL(c),v=fx,Zg=l,S(),f||$()},s.smoothstep=Ne,s.spec=gt,s.squaredLength=function(c){var l=c[0],f=c[1],p=c[2];return l*l+f*f+p*p},s.storeAuthState=function(c,l){l?rr.add(c):rr.delete(c)},s.sub=Qf,s.subtract=YL,s.symbolSize=fde,s.tileAABB=function(c,l,f,p,A,b,C,M,N){if(N.name==="globe")return ihe(c,l,new z2(f,p,A));const U=t0({z:f,x:p,y:A},N);return new cl([(b+U.x/U.scale)*l,l*(U.y/U.scale),C],[(b+U.x2/U.scale)*l,l*(U.y2/U.scale),M])},s.tileCornersToBounds=T2,s.tileTransform=t0,s.transformMat3=function(c,l,f){var p=l[0],A=l[1],b=l[2];return c[0]=p*f[0]+A*f[3]+b*f[6],c[1]=p*f[1]+A*f[4]+b*f[7],c[2]=p*f[2]+A*f[5]+b*f[8],c},s.transformMat4=Fo,s.transformMat4$1=ZA,s.transformQuat=O8,s.transitionTileAABBinECEF=j8,s.translate=mx,s.transpose=function(c,l){if(c===l){var f=l[1],p=l[2],A=l[5];c[1]=l[3],c[2]=l[6],c[3]=f,c[5]=l[7],c[6]=p,c[7]=A}else c[0]=l[0],c[1]=l[3],c[2]=l[6],c[3]=l[1],c[4]=l[4],c[5]=l[7],c[6]=l[2],c[7]=l[5],c[8]=l[8];return c},s.triggerPluginCompletionEvent=m,s.uniqueId=In,s.updateGlobeVertexNormal=function(c,l,f,p,A){const b=5*l+2;c.float32[b+0]=f,c.float32[b+1]=p,c.float32[b+2]=A},s.validateCustomStyleLayer=function(c){const l=[],f=c.id;return f===void 0&&l.push({message:`layers.${f}: missing required property "id"`}),c.render===void 0&&l.push({message:`layers.${f}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&l.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),l},s.validateFilter=c=>Cn(td(c)),s.validateFog=c=>Cn(_e(c)),s.validateLayer=c=>Cn(O(c)),s.validateLight=c=>Cn(ae(c)),s.validateSource=c=>Cn(G(c)),s.validateStyle=kt,s.validateTerrain=c=>Cn(pe(c)),s.values=ct,s.vectorTile=N2,s.version=d,s.warnOnce=$t,s.window=u,s.wrap=Be}),o(["./shared"],function(s){function u(Ge){if(typeof Ge=="number"||typeof Ge=="boolean"||typeof Ge=="string"||Ge==null)return JSON.stringify(Ge);if(Array.isArray(Ge)){let Ae="[";for(const ze of Ge)Ae+=`${u(ze)},`;return`${Ae}]`}let ge="{";for(const Ae of Object.keys(Ge).sort())ge+=`${Ae}:${u(Ge[Ae])},`;return`${ge}}`}function d(Ge){let ge="";for(const Ae of s.refProperties)ge+=`/${u(Ge[Ae])}`;return ge}class g{constructor(ge){this.keyCache={},ge&&this.replace(ge)}replace(ge){this._layerConfigs={},this._layers={},this.update(ge,[])}update(ge,Ae){for(const Me of ge)this._layerConfigs[Me.id]=Me,(this._layers[Me.id]=s.createStyleLayer(Me)).compileFilter(),this.keyCache[Me.id]&&delete this.keyCache[Me.id];for(const Me of Ae)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};const ze=function(Me,it){const ht={};for(let rt=0;rt<Me.length;rt++){const wt=it&&it[Me[rt].id]||d(Me[rt]);it&&(it[Me[rt].id]=wt);let sn=ht[wt];sn||(sn=ht[wt]=[]),sn.push(Me[rt])}const ft=[];for(const rt in ht)ft.push(ht[rt]);return ft}(s.values(this._layerConfigs),this.keyCache);for(const Me of ze){const it=Me.map(dn=>this._layers[dn.id]),ht=it[0];if(ht.visibility==="none")continue;const ft=ht.source||"";let rt=this.familiesBySource[ft];rt||(rt=this.familiesBySource[ft]={});const wt=ht.sourceLayer||"_geojsonTileLayer";let sn=rt[wt];sn||(sn=rt[wt]=[]),sn.push(it)}}}class _{loadTile(ge,Ae){const{uid:ze,encoding:Me,rawImageData:it,padding:ht,buildQuadTree:ft}=ge,rt=s.window.ImageBitmap&&it instanceof s.window.ImageBitmap?this.getImageData(it,ht):it;Ae(null,new s.DEMData(ze,rt,Me,ht<1,ft))}getImageData(ge,Ae){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ge.width,ge.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ge.width,this.offscreenCanvas.height=ge.height,this.offscreenCanvasContext.drawImage(ge,0,0,ge.width,ge.height);const ze=this.offscreenCanvasContext.getImageData(-Ae,-Ae,ge.width+2*Ae,ge.height+2*Ae);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ze}}function E(Ge,ge){if(Ge.length!==0){P(Ge[0],ge);for(var Ae=1;Ae<Ge.length;Ae++)P(Ge[Ae],!ge)}}function P(Ge,ge){for(var Ae=0,ze=0,Me=0,it=Ge.length,ht=it-1;Me<it;ht=Me++){var ft=(Ge[Me][0]-Ge[ht][0])*(Ge[ht][1]+Ge[Me][1]),rt=Ae+ft;ze+=Math.abs(Ae)>=Math.abs(ft)?Ae-rt+ft:ft-rt+Ae,Ae=rt}Ae+ze>=0!=!!ge&&Ge.reverse()}var R=s.getDefaultExportFromCjs(function Ge(ge,Ae){var ze,Me=ge&&ge.type;if(Me==="FeatureCollection")for(ze=0;ze<ge.features.length;ze++)Ge(ge.features[ze],Ae);else if(Me==="GeometryCollection")for(ze=0;ze<ge.geometries.length;ze++)Ge(ge.geometries[ze],Ae);else if(Me==="Feature")Ge(ge.geometry,Ae);else if(Me==="Polygon")E(ge.coordinates,Ae);else if(Me==="MultiPolygon")for(ze=0;ze<ge.coordinates.length;ze++)E(ge.coordinates[ze],Ae);return ge});const B=s.VectorTileFeature.prototype.toGeoJSON;var V={exports:{}},z=s.pointGeometry,F=s.vectorTile.VectorTileFeature,k=X;function X(Ge,ge){this.options=ge||{},this.features=Ge,this.length=Ge.length}function Y(Ge,ge){this.id=typeof Ge.id=="number"?Ge.id:void 0,this.type=Ge.type,this.rawGeometry=Ge.type===1?[Ge.geometry]:Ge.geometry,this.properties=Ge.tags,this.extent=ge||4096}X.prototype.feature=function(Ge){return new Y(this.features[Ge],this.options.extent)},Y.prototype.loadGeometry=function(){var Ge=this.rawGeometry;this.geometry=[];for(var ge=0;ge<Ge.length;ge++){for(var Ae=Ge[ge],ze=[],Me=0;Me<Ae.length;Me++)ze.push(new z(Ae[Me][0],Ae[Me][1]));this.geometry.push(ze)}return this.geometry},Y.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ge=this.geometry,ge=1/0,Ae=-1/0,ze=1/0,Me=-1/0,it=0;it<Ge.length;it++)for(var ht=Ge[it],ft=0;ft<ht.length;ft++){var rt=ht[ft];ge=Math.min(ge,rt.x),Ae=Math.max(Ae,rt.x),ze=Math.min(ze,rt.y),Me=Math.max(Me,rt.y)}return[ge,ze,Ae,Me]},Y.prototype.toGeoJSON=F.prototype.toGeoJSON;var J=s.pbf,ie=k;function ce(Ge){var ge=new J;return function(Ae,ze){for(var Me in Ae.layers)ze.writeMessage(3,re,Ae.layers[Me])}(Ge,ge),ge.finish()}function re(Ge,ge){var Ae;ge.writeVarintField(15,Ge.version||1),ge.writeStringField(1,Ge.name||""),ge.writeVarintField(5,Ge.extent||4096);var ze={keys:[],values:[],keycache:{},valuecache:{}};for(Ae=0;Ae<Ge.length;Ae++)ze.feature=Ge.feature(Ae),ge.writeMessage(2,ue,ze);var Me=ze.keys;for(Ae=0;Ae<Me.length;Ae++)ge.writeStringField(3,Me[Ae]);var it=ze.values;for(Ae=0;Ae<it.length;Ae++)ge.writeMessage(4,Ye,it[Ae])}function ue(Ge,ge){var Ae=Ge.feature;Ae.id!==void 0&&ge.writeVarintField(1,Ae.id),ge.writeMessage(2,se,Ge),ge.writeVarintField(3,Ae.type),ge.writeMessage(4,be,Ae)}function se(Ge,ge){var Ae=Ge.feature,ze=Ge.keys,Me=Ge.values,it=Ge.keycache,ht=Ge.valuecache;for(var ft in Ae.properties){var rt=Ae.properties[ft],wt=it[ft];if(rt!==null){wt===void 0&&(ze.push(ft),it[ft]=wt=ze.length-1),ge.writeVarint(wt);var sn=typeof rt;sn!=="string"&&sn!=="boolean"&&sn!=="number"&&(rt=JSON.stringify(rt));var dn=sn+":"+rt,Qt=ht[dn];Qt===void 0&&(Me.push(rt),ht[dn]=Qt=Me.length-1),ge.writeVarint(Qt)}}}function me(Ge,ge){return(ge<<3)+(7&Ge)}function Ce(Ge){return Ge<<1^Ge>>31}function be(Ge,ge){for(var Ae=Ge.loadGeometry(),ze=Ge.type,Me=0,it=0,ht=Ae.length,ft=0;ft<ht;ft++){var rt=Ae[ft],wt=1;ze===1&&(wt=rt.length),ge.writeVarint(me(1,wt));for(var sn=ze===3?rt.length-1:rt.length,dn=0;dn<sn;dn++){dn===1&&ze!==1&&ge.writeVarint(me(2,sn-1));var Qt=rt[dn].x-Me,sr=rt[dn].y-it;ge.writeVarint(Ce(Qt)),ge.writeVarint(Ce(sr)),Me+=Qt,it+=sr}ze===3&&ge.writeVarint(me(7,1))}}function Ye(Ge,ge){var Ae=typeof Ge;Ae==="string"?ge.writeStringField(1,Ge):Ae==="boolean"?ge.writeBooleanField(7,Ge):Ae==="number"&&(Ge%1!=0?ge.writeDoubleField(3,Ge):Ge<0?ge.writeSVarintField(6,Ge):ge.writeVarintField(5,Ge))}V.exports=ce,V.exports.fromVectorTileJs=ce,V.exports.fromGeojsonVt=function(Ge,ge){ge=ge||{};var Ae={};for(var ze in Ge)Ae[ze]=new ie(Ge[ze].features,ge),Ae[ze].name=ze,Ae[ze].version=ge.version,Ae[ze].extent=ge.extent;return ce({layers:Ae})},V.exports.GeoJSONWrapper=ie;var tt=s.getDefaultExportFromCjs(V.exports);const pt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ge=>Ge},Ee=Math.fround||(Ne=new Float32Array(1),Ge=>(Ne[0]=+Ge,Ne[0]));var Ne;const Be=3,qe=5,ct=6;class Ct{constructor(ge){this.options=Object.assign(Object.create(pt),ge),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ge){const{log:Ae,minZoom:ze,maxZoom:Me}=this.options;Ae&&console.time("total time");const it=`prepare ${ge.length} points`;Ae&&console.time(it),this.points=ge;const ht=[];for(let rt=0;rt<ge.length;rt++){const wt=ge[rt];if(!wt.geometry)continue;const[sn,dn]=wt.geometry.coordinates,Qt=Ee(Mn(sn)),sr=Ee(Tn(dn));ht.push(Qt,sr,1/0,rt,-1,1),this.options.reduce&&ht.push(0)}let ft=this.trees[Me+1]=this._createTree(ht);Ae&&console.timeEnd(it);for(let rt=Me;rt>=ze;rt--){const wt=+Date.now();ft=this.trees[rt]=this._createTree(this._cluster(ft,rt)),Ae&&console.log("z%d: %d clusters in %dms",rt,ft.numItems,+Date.now()-wt)}return Ae&&console.timeEnd("total time"),this}getClusters(ge,Ae){let ze=((ge[0]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,ge[1]));let it=ge[2]===180?180:((ge[2]+180)%360+360)%360-180;const ht=Math.max(-90,Math.min(90,ge[3]));if(ge[2]-ge[0]>=360)ze=-180,it=180;else if(ze>it){const dn=this.getClusters([ze,Me,180,ht],Ae),Qt=this.getClusters([-180,Me,it,ht],Ae);return dn.concat(Qt)}const ft=this.trees[this._limitZoom(Ae)],rt=ft.range(Mn(ze),Tn(ht),Mn(it),Tn(Me)),wt=ft.data,sn=[];for(const dn of rt){const Qt=this.stride*dn;sn.push(wt[Qt+qe]>1?Dt(wt,Qt,this.clusterProps):this.points[wt[Qt+Be]])}return sn}getChildren(ge){const Ae=this._getOriginId(ge),ze=this._getOriginZoom(ge),Me="No cluster with the specified id.",it=this.trees[ze];if(!it)throw new Error(Me);const ht=it.data;if(Ae*this.stride>=ht.length)throw new Error(Me);const ft=this.options.radius/(this.options.extent*Math.pow(2,ze-1)),rt=it.within(ht[Ae*this.stride],ht[Ae*this.stride+1],ft),wt=[];for(const sn of rt){const dn=sn*this.stride;ht[dn+4]===ge&&wt.push(ht[dn+qe]>1?Dt(ht,dn,this.clusterProps):this.points[ht[dn+Be]])}if(wt.length===0)throw new Error(Me);return wt}getLeaves(ge,Ae,ze){const Me=[];return this._appendLeaves(Me,ge,Ae=Ae||10,ze=ze||0,0),Me}getTile(ge,Ae,ze){const Me=this.trees[this._limitZoom(ge)],it=Math.pow(2,ge),{extent:ht,radius:ft}=this.options,rt=ft/ht,wt=(ze-rt)/it,sn=(ze+1+rt)/it,dn={features:[]};return this._addTileFeatures(Me.range((Ae-rt)/it,wt,(Ae+1+rt)/it,sn),Me.data,Ae,ze,it,dn),Ae===0&&this._addTileFeatures(Me.range(1-rt/it,wt,1,sn),Me.data,it,ze,it,dn),Ae===it-1&&this._addTileFeatures(Me.range(0,wt,rt/it,sn),Me.data,-1,ze,it,dn),dn.features.length?dn:null}getClusterExpansionZoom(ge){let Ae=this._getOriginZoom(ge)-1;for(;Ae<=this.options.maxZoom;){const ze=this.getChildren(ge);if(Ae++,ze.length!==1)break;ge=ze[0].properties.cluster_id}return Ae}_appendLeaves(ge,Ae,ze,Me,it){const ht=this.getChildren(Ae);for(const ft of ht){const rt=ft.properties;if(rt&&rt.cluster?it+rt.point_count<=Me?it+=rt.point_count:it=this._appendLeaves(ge,rt.cluster_id,ze,Me,it):it<Me?it++:ge.push(ft),ge.length===ze)break}return it}_createTree(ge){const Ae=new s.KDBush(ge.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ze=0;ze<ge.length;ze+=this.stride)Ae.add(ge[ze],ge[ze+1]);return Ae.finish(),Ae.data=ge,Ae}_addTileFeatures(ge,Ae,ze,Me,it,ht){for(const ft of ge){const rt=ft*this.stride,wt=Ae[rt+qe]>1;let sn,dn,Qt;if(wt)sn=In(Ae,rt,this.clusterProps),dn=Ae[rt],Qt=Ae[rt+1];else{const tr=this.points[Ae[rt+Be]];sn=tr.properties;const[st,Pt]=tr.geometry.coordinates;dn=Mn(st),Qt=Tn(Pt)}const sr={type:1,geometry:[[Math.round(this.options.extent*(dn*it-ze)),Math.round(this.options.extent*(Qt*it-Me))]],tags:sn};let pr;pr=wt||this.options.generateId?Ae[rt+Be]:this.points[Ae[rt+Be]].id,pr!==void 0&&(sr.id=pr),ht.features.push(sr)}}_limitZoom(ge){return Math.max(this.options.minZoom,Math.min(Math.floor(+ge),this.options.maxZoom+1))}_cluster(ge,Ae){const{radius:ze,extent:Me,reduce:it,minPoints:ht}=this.options,ft=ze/(Me*Math.pow(2,Ae)),rt=ge.data,wt=[],sn=this.stride;for(let dn=0;dn<rt.length;dn+=sn){if(rt[dn+2]<=Ae)continue;rt[dn+2]=Ae;const Qt=rt[dn],sr=rt[dn+1],pr=ge.within(rt[dn],rt[dn+1],ft),tr=rt[dn+qe];let st=tr;for(const Pt of pr){const rn=Pt*sn;rt[rn+2]>Ae&&(st+=rt[rn+qe])}if(st>tr&&st>=ht){let Pt,rn=Qt*tr,Gn=sr*tr,w=-1;const Ue=((dn/sn|0)<<5)+(Ae+1)+this.points.length;for(const Ir of pr){const fr=Ir*sn;if(rt[fr+2]<=Ae)continue;rt[fr+2]=Ae;const rr=rt[fr+qe];rn+=rt[fr]*rr,Gn+=rt[fr+1]*rr,rt[fr+4]=Ue,it&&(Pt||(Pt=this._map(rt,dn,!0),w=this.clusterProps.length,this.clusterProps.push(Pt)),it(Pt,this._map(rt,fr)))}rt[dn+4]=Ue,wt.push(rn/st,Gn/st,1/0,Ue,-1,st),it&&wt.push(w)}else{for(let Pt=0;Pt<sn;Pt++)wt.push(rt[dn+Pt]);if(st>1)for(const Pt of pr){const rn=Pt*sn;if(!(rt[rn+2]<=Ae)){rt[rn+2]=Ae;for(let Gn=0;Gn<sn;Gn++)wt.push(rt[rn+Gn])}}}}return wt}_getOriginId(ge){return ge-this.points.length>>5}_getOriginZoom(ge){return(ge-this.points.length)%32}_map(ge,Ae,ze){if(ge[Ae+qe]>1){const ht=this.clusterProps[ge[Ae+ct]];return ze?Object.assign({},ht):ht}const Me=this.points[ge[Ae+Be]].properties,it=this.options.map(Me);return ze&&it===Me?Object.assign({},it):it}}function Dt(Ge,ge,Ae){return{type:"Feature",id:Ge[ge+Be],properties:In(Ge,ge,Ae),geometry:{type:"Point",coordinates:[(ze=Ge[ge],360*(ze-.5)),Nt(Ge[ge+1])]}};var ze}function In(Ge,ge,Ae){const ze=Ge[ge+qe],Me=ze>=1e4?`${Math.round(ze/1e3)}k`:ze>=1e3?Math.round(ze/100)/10+"k":ze,it=Ge[ge+ct],ht=it===-1?{}:Object.assign({},Ae[it]);return Object.assign(ht,{cluster:!0,cluster_id:Ge[ge+Be],point_count:ze,point_count_abbreviated:Me})}function Mn(Ge){return Ge/360+.5}function Tn(Ge){const ge=Math.sin(Ge*Math.PI/180),Ae=.5-.25*Math.log((1+ge)/(1-ge))/Math.PI;return Ae<0?0:Ae>1?1:Ae}function Nt(Ge){const ge=(180-360*Ge)*Math.PI/180;return 360*Math.atan(Math.exp(ge))/Math.PI-90}function Zt(Ge,ge,Ae,ze){for(var Me,it=ze,ht=Ae-ge>>1,ft=Ae-ge,rt=Ge[ge],wt=Ge[ge+1],sn=Ge[Ae],dn=Ge[Ae+1],Qt=ge+3;Qt<Ae;Qt+=3){var sr=Wt(Ge[Qt],Ge[Qt+1],rt,wt,sn,dn);if(sr>it)Me=Qt,it=sr;else if(sr===it){var pr=Math.abs(Qt-ht);pr<ft&&(Me=Qt,ft=pr)}}it>ze&&(Me-ge>3&&Zt(Ge,ge,Me,ze),Ge[Me+2]=it,Ae-Me>3&&Zt(Ge,Me,Ae,ze))}function Wt(Ge,ge,Ae,ze,Me,it){var ht=Me-Ae,ft=it-ze;if(ht!==0||ft!==0){var rt=((Ge-Ae)*ht+(ge-ze)*ft)/(ht*ht+ft*ft);rt>1?(Ae=Me,ze=it):rt>0&&(Ae+=ht*rt,ze+=ft*rt)}return(ht=Ge-Ae)*ht+(ft=ge-ze)*ft}function hn(Ge,ge,Ae,ze){var Me={id:Ge===void 0?null:Ge,type:ge,geometry:Ae,tags:ze,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(it){var ht=it.geometry,ft=it.type;if(ft==="Point"||ft==="MultiPoint"||ft==="LineString")lr(it,ht);else if(ft==="Polygon"||ft==="MultiLineString")for(var rt=0;rt<ht.length;rt++)lr(it,ht[rt]);else if(ft==="MultiPolygon")for(rt=0;rt<ht.length;rt++)for(var wt=0;wt<ht[rt].length;wt++)lr(it,ht[rt][wt])}(Me),Me}function lr(Ge,ge){for(var Ae=0;Ae<ge.length;Ae+=3)Ge.minX=Math.min(Ge.minX,ge[Ae]),Ge.minY=Math.min(Ge.minY,ge[Ae+1]),Ge.maxX=Math.max(Ge.maxX,ge[Ae]),Ge.maxY=Math.max(Ge.maxY,ge[Ae+1])}function It(Ge,ge,Ae,ze){if(ge.geometry){var Me=ge.geometry.coordinates,it=ge.geometry.type,ht=Math.pow(Ae.tolerance/((1<<Ae.maxZoom)*Ae.extent),2),ft=[],rt=ge.id;if(Ae.promoteId?rt=ge.properties[Ae.promoteId]:Ae.generateId&&(rt=ze||0),it==="Point")Xt(Me,ft);else if(it==="MultiPoint")for(var wt=0;wt<Me.length;wt++)Xt(Me[wt],ft);else if(it==="LineString")$t(Me,ft,ht,!1);else if(it==="MultiLineString"){if(Ae.lineMetrics){for(wt=0;wt<Me.length;wt++)$t(Me[wt],ft=[],ht,!1),Ge.push(hn(rt,"LineString",ft,ge.properties));return}cn(Me,ft,ht,!1)}else if(it==="Polygon")cn(Me,ft,ht,!0);else{if(it!=="MultiPolygon"){if(it==="GeometryCollection"){for(wt=0;wt<ge.geometry.geometries.length;wt++)It(Ge,{id:rt,geometry:ge.geometry.geometries[wt],properties:ge.properties},Ae,ze);return}throw new Error("Input data is not a valid GeoJSON object.")}for(wt=0;wt<Me.length;wt++){var sn=[];cn(Me[wt],sn,ht,!0),ft.push(sn)}}Ge.push(hn(rt,it,ft,ge.properties))}}function Xt(Ge,ge){ge.push(Jt(Ge[0])),ge.push(Ln(Ge[1])),ge.push(0)}function $t(Ge,ge,Ae,ze){for(var Me,it,ht=0,ft=0;ft<Ge.length;ft++){var rt=Jt(Ge[ft][0]),wt=Ln(Ge[ft][1]);ge.push(rt),ge.push(wt),ge.push(0),ft>0&&(ht+=ze?(Me*wt-rt*it)/2:Math.sqrt(Math.pow(rt-Me,2)+Math.pow(wt-it,2))),Me=rt,it=wt}var sn=ge.length-3;ge[2]=1,Zt(ge,0,sn,Ae),ge[sn+2]=1,ge.size=Math.abs(ht),ge.start=0,ge.end=ge.size}function cn(Ge,ge,Ae,ze){for(var Me=0;Me<Ge.length;Me++){var it=[];$t(Ge[Me],it,Ae,ze),ge.push(it)}}function Jt(Ge){return Ge/360+.5}function Ln(Ge){var ge=Math.sin(Ge*Math.PI/180),Ae=.5-.25*Math.log((1+ge)/(1-ge))/Math.PI;return Ae<0?0:Ae>1?1:Ae}function qn(Ge,ge,Ae,ze,Me,it,ht,ft){if(ze/=ge,it>=(Ae/=ge)&&ht<ze)return Ge;if(ht<Ae||it>=ze)return null;for(var rt=[],wt=0;wt<Ge.length;wt++){var sn=Ge[wt],dn=sn.geometry,Qt=sn.type,sr=Me===0?sn.minX:sn.minY,pr=Me===0?sn.maxX:sn.maxY;if(sr>=Ae&&pr<ze)rt.push(sn);else if(!(pr<Ae||sr>=ze)){var tr=[];if(Qt==="Point"||Qt==="MultiPoint")or(dn,tr,Ae,ze,Me);else if(Qt==="LineString")cr(dn,tr,Ae,ze,Me,!1,ft.lineMetrics);else if(Qt==="MultiLineString")Ri(dn,tr,Ae,ze,Me,!1);else if(Qt==="Polygon")Ri(dn,tr,Ae,ze,Me,!0);else if(Qt==="MultiPolygon")for(var st=0;st<dn.length;st++){var Pt=[];Ri(dn[st],Pt,Ae,ze,Me,!0),Pt.length&&tr.push(Pt)}if(tr.length){if(ft.lineMetrics&&Qt==="LineString"){for(st=0;st<tr.length;st++)rt.push(hn(sn.id,Qt,tr[st],sn.tags));continue}Qt!=="LineString"&&Qt!=="MultiLineString"||(tr.length===1?(Qt="LineString",tr=tr[0]):Qt="MultiLineString"),Qt!=="Point"&&Qt!=="MultiPoint"||(Qt=tr.length===3?"Point":"MultiPoint"),rt.push(hn(sn.id,Qt,tr,sn.tags))}}}return rt.length?rt:null}function or(Ge,ge,Ae,ze,Me){for(var it=0;it<Ge.length;it+=3){var ht=Ge[it+Me];ht>=Ae&&ht<=ze&&(ge.push(Ge[it]),ge.push(Ge[it+1]),ge.push(Ge[it+2]))}}function cr(Ge,ge,Ae,ze,Me,it,ht){for(var ft,rt,wt=cs(Ge),sn=Me===0?Fa:Nl,dn=Ge.start,Qt=0;Qt<Ge.length-3;Qt+=3){var sr=Ge[Qt],pr=Ge[Qt+1],tr=Ge[Qt+2],st=Ge[Qt+3],Pt=Ge[Qt+4],rn=Me===0?sr:pr,Gn=Me===0?st:Pt,w=!1;ht&&(ft=Math.sqrt(Math.pow(sr-st,2)+Math.pow(pr-Pt,2))),rn<Ae?Gn>Ae&&(rt=sn(wt,sr,pr,st,Pt,Ae),ht&&(wt.start=dn+ft*rt)):rn>ze?Gn<ze&&(rt=sn(wt,sr,pr,st,Pt,ze),ht&&(wt.start=dn+ft*rt)):Do(wt,sr,pr,tr),Gn<Ae&&rn>=Ae&&(rt=sn(wt,sr,pr,st,Pt,Ae),w=!0),Gn>ze&&rn<=ze&&(rt=sn(wt,sr,pr,st,Pt,ze),w=!0),!it&&w&&(ht&&(wt.end=dn+ft*rt),ge.push(wt),wt=cs(Ge)),ht&&(dn+=ft)}var Ue=Ge.length-3;sr=Ge[Ue],pr=Ge[Ue+1],tr=Ge[Ue+2],(rn=Me===0?sr:pr)>=Ae&&rn<=ze&&Do(wt,sr,pr,tr),Ue=wt.length-3,it&&Ue>=3&&(wt[Ue]!==wt[0]||wt[Ue+1]!==wt[1])&&Do(wt,wt[0],wt[1],wt[2]),wt.length&&ge.push(wt)}function cs(Ge){var ge=[];return ge.size=Ge.size,ge.start=Ge.start,ge.end=Ge.end,ge}function Ri(Ge,ge,Ae,ze,Me,it){for(var ht=0;ht<Ge.length;ht++)cr(Ge[ht],ge,Ae,ze,Me,it,!1)}function Do(Ge,ge,Ae,ze){Ge.push(ge),Ge.push(Ae),Ge.push(ze)}function Fa(Ge,ge,Ae,ze,Me,it){var ht=(it-ge)/(ze-ge);return Ge.push(it),Ge.push(Ae+(Me-Ae)*ht),Ge.push(1),ht}function Nl(Ge,ge,Ae,ze,Me,it){var ht=(it-Ae)/(Me-Ae);return Ge.push(ge+(ze-ge)*ht),Ge.push(it),Ge.push(1),ht}function _s(Ge,ge){for(var Ae=[],ze=0;ze<Ge.length;ze++){var Me,it=Ge[ze],ht=it.type;if(ht==="Point"||ht==="MultiPoint"||ht==="LineString")Me=mo(it.geometry,ge);else if(ht==="MultiLineString"||ht==="Polygon"){Me=[];for(var ft=0;ft<it.geometry.length;ft++)Me.push(mo(it.geometry[ft],ge))}else if(ht==="MultiPolygon")for(Me=[],ft=0;ft<it.geometry.length;ft++){for(var rt=[],wt=0;wt<it.geometry[ft].length;wt++)rt.push(mo(it.geometry[ft][wt],ge));Me.push(rt)}Ae.push(hn(it.id,ht,Me,it.tags))}return Ae}function mo(Ge,ge){var Ae=[];Ae.size=Ge.size,Ge.start!==void 0&&(Ae.start=Ge.start,Ae.end=Ge.end);for(var ze=0;ze<Ge.length;ze+=3)Ae.push(Ge[ze]+ge,Ge[ze+1],Ge[ze+2]);return Ae}function Fl(Ge,ge){if(Ge.transformed)return Ge;var Ae,ze,Me,it=1<<Ge.z,ht=Ge.x,ft=Ge.y;for(Ae=0;Ae<Ge.features.length;Ae++){var rt=Ge.features[Ae],wt=rt.geometry,sn=rt.type;if(rt.geometry=[],sn===1)for(ze=0;ze<wt.length;ze+=2)rt.geometry.push(su(wt[ze],wt[ze+1],ge,it,ht,ft));else for(ze=0;ze<wt.length;ze++){var dn=[];for(Me=0;Me<wt[ze].length;Me+=2)dn.push(su(wt[ze][Me],wt[ze][Me+1],ge,it,ht,ft));rt.geometry.push(dn)}}return Ge.transformed=!0,Ge}function su(Ge,ge,Ae,ze,Me,it){return[Math.round(Ae*(Ge*ze-Me)),Math.round(Ae*(ge*ze-it))]}function kl(Ge,ge,Ae,ze,Me){for(var it=ge===Me.maxZoom?0:Me.tolerance/((1<<ge)*Me.extent),ht={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ae,y:ze,z:ge,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ft=0;ft<Ge.length;ft++){ht.numFeatures++,au(ht,Ge[ft],it,Me);var rt=Ge[ft].minX,wt=Ge[ft].minY,sn=Ge[ft].maxX,dn=Ge[ft].maxY;rt<ht.minX&&(ht.minX=rt),wt<ht.minY&&(ht.minY=wt),sn>ht.maxX&&(ht.maxX=sn),dn>ht.maxY&&(ht.maxY=dn)}return ht}function au(Ge,ge,Ae,ze){var Me=ge.geometry,it=ge.type,ht=[];if(it==="Point"||it==="MultiPoint")for(var ft=0;ft<Me.length;ft+=3)ht.push(Me[ft]),ht.push(Me[ft+1]),Ge.numPoints++,Ge.numSimplified++;else if(it==="LineString")$u(ht,Me,Ge,Ae,!1,!1);else if(it==="MultiLineString"||it==="Polygon")for(ft=0;ft<Me.length;ft++)$u(ht,Me[ft],Ge,Ae,it==="Polygon",ft===0);else if(it==="MultiPolygon")for(var rt=0;rt<Me.length;rt++){var wt=Me[rt];for(ft=0;ft<wt.length;ft++)$u(ht,wt[ft],Ge,Ae,!0,ft===0)}if(ht.length){var sn=ge.tags||null;if(it==="LineString"&&ze.lineMetrics){for(var dn in sn={},ge.tags)sn[dn]=ge.tags[dn];sn.mapbox_clip_start=Me.start/Me.size,sn.mapbox_clip_end=Me.end/Me.size}var Qt={geometry:ht,type:it==="Polygon"||it==="MultiPolygon"?3:it==="LineString"||it==="MultiLineString"?2:1,tags:sn};ge.id!==null&&(Qt.id=ge.id),Ge.features.push(Qt)}}function $u(Ge,ge,Ae,ze,Me,it){var ht=ze*ze;if(ze>0&&ge.size<(Me?ht:ze))Ae.numPoints+=ge.length/3;else{for(var ft=[],rt=0;rt<ge.length;rt+=3)(ze===0||ge[rt+2]>ht)&&(Ae.numSimplified++,ft.push(ge[rt]),ft.push(ge[rt+1])),Ae.numPoints++;Me&&function(wt,sn){for(var dn=0,Qt=0,sr=wt.length,pr=sr-2;Qt<sr;pr=Qt,Qt+=2)dn+=(wt[Qt]-wt[pr])*(wt[Qt+1]+wt[pr+1]);if(dn>0===sn)for(Qt=0,sr=wt.length;Qt<sr/2;Qt+=2){var tr=wt[Qt],st=wt[Qt+1];wt[Qt]=wt[sr-2-Qt],wt[Qt+1]=wt[sr-1-Qt],wt[sr-2-Qt]=tr,wt[sr-1-Qt]=st}}(ft,it),Ge.push(ft)}}function lu(Ge,ge){var Ae=(ge=this.options=function(Me,it){for(var ht in it)Me[ht]=it[ht];return Me}(Object.create(this.options),ge)).debug;if(Ae&&console.time("preprocess data"),ge.maxZoom<0||ge.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ge.promoteId&&ge.generateId)throw new Error("promoteId and generateId cannot be used together.");var ze=function(Me,it){var ht=[];if(Me.type==="FeatureCollection")for(var ft=0;ft<Me.features.length;ft++)It(ht,Me.features[ft],it,ft);else It(ht,Me.type==="Feature"?Me:{geometry:Me},it);return ht}(Ge,ge);this.tiles={},this.tileCoords=[],Ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ge.indexMaxZoom,ge.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ze=function(Me,it){var ht=it.buffer/it.extent,ft=Me,rt=qn(Me,1,-1-ht,ht,0,-1,2,it),wt=qn(Me,1,1-ht,2+ht,0,-1,2,it);return(rt||wt)&&(ft=qn(Me,1,-ht,1+ht,0,-1,2,it)||[],rt&&(ft=_s(rt,1).concat(ft)),wt&&(ft=ft.concat(_s(wt,-1)))),ft}(ze,ge),ze.length&&this.splitTile(ze,0,0,0),Ae&&(ze.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Hu(Ge,ge,Ae){return 32*((1<<Ge)*Ae+ge)+Ge}function uu(Ge,ge){const Ae=Ge.tileID.canonical;if(!this._geoJSONIndex)return ge(null,null);const ze=this._geoJSONIndex.getTile(Ae.z,Ae.x,Ae.y);if(!ze)return ge(null,null);const Me=new class{constructor(ht){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=ht.length,this._features=ht}feature(ht){return new class{constructor(ft){this._feature=ft,this.extent=s.EXTENT,this.type=ft.type,this.properties=ft.tags,"id"in ft&&!isNaN(ft.id)&&(this.id=parseInt(ft.id,10))}loadGeometry(){if(this._feature.type===1){const ft=[];for(const rt of this._feature.geometry)ft.push([new s.Point(rt[0],rt[1])]);return ft}{const ft=[];for(const rt of this._feature.geometry){const wt=[];for(const sn of rt)wt.push(new s.Point(sn[0],sn[1]));ft.push(wt)}return ft}}toGeoJSON(ft,rt,wt){return B.call(this,ft,rt,wt)}}(this._features[ht])}}(ze.features);let it=tt(Me);it.byteOffset===0&&it.byteLength===it.buffer.byteLength||(it=new Uint8Array(it)),ge(null,{vectorTile:Me,rawData:it.buffer})}lu.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},lu.prototype.splitTile=function(Ge,ge,Ae,ze,Me,it,ht){for(var ft=[Ge,ge,Ae,ze],rt=this.options,wt=rt.debug;ft.length;){ze=ft.pop(),Ae=ft.pop(),ge=ft.pop(),Ge=ft.pop();var sn=1<<ge,dn=Hu(ge,Ae,ze),Qt=this.tiles[dn];if(!Qt&&(wt>1&&console.time("creation"),Qt=this.tiles[dn]=kl(Ge,ge,Ae,ze,rt),this.tileCoords.push({z:ge,x:Ae,y:ze}),wt)){wt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ge,Ae,ze,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));var sr="z"+ge;this.stats[sr]=(this.stats[sr]||0)+1,this.total++}if(Qt.source=Ge,Me){if(ge===rt.maxZoom||ge===Me)continue;var pr=1<<Me-ge;if(Ae!==Math.floor(it/pr)||ze!==Math.floor(ht/pr))continue}else if(ge===rt.indexMaxZoom||Qt.numPoints<=rt.indexMaxPoints)continue;if(Qt.source=null,Ge.length!==0){wt>1&&console.time("clipping");var tr,st,Pt,rn,Gn,w,Ue=.5*rt.buffer/rt.extent,Ir=.5-Ue,fr=.5+Ue,rr=1+Ue;tr=st=Pt=rn=null,Gn=qn(Ge,sn,Ae-Ue,Ae+fr,0,Qt.minX,Qt.maxX,rt),w=qn(Ge,sn,Ae+Ir,Ae+rr,0,Qt.minX,Qt.maxX,rt),Ge=null,Gn&&(tr=qn(Gn,sn,ze-Ue,ze+fr,1,Qt.minY,Qt.maxY,rt),st=qn(Gn,sn,ze+Ir,ze+rr,1,Qt.minY,Qt.maxY,rt),Gn=null),w&&(Pt=qn(w,sn,ze-Ue,ze+fr,1,Qt.minY,Qt.maxY,rt),rn=qn(w,sn,ze+Ir,ze+rr,1,Qt.minY,Qt.maxY,rt),w=null),wt>1&&console.timeEnd("clipping"),ft.push(tr||[],ge+1,2*Ae,2*ze),ft.push(st||[],ge+1,2*Ae,2*ze+1),ft.push(Pt||[],ge+1,2*Ae+1,2*ze),ft.push(rn||[],ge+1,2*Ae+1,2*ze+1)}}},lu.prototype.getTile=function(Ge,ge,Ae){var ze=this.options,Me=ze.extent,it=ze.debug;if(Ge<0||Ge>24)return null;var ht=1<<Ge,ft=Hu(Ge,ge=(ge%ht+ht)%ht,Ae);if(this.tiles[ft])return Fl(this.tiles[ft],Me);it>1&&console.log("drilling down to z%d-%d-%d",Ge,ge,Ae);for(var rt,wt=Ge,sn=ge,dn=Ae;!rt&&wt>0;)wt--,sn=Math.floor(sn/2),dn=Math.floor(dn/2),rt=this.tiles[Hu(wt,sn,dn)];return rt&&rt.source?(it>1&&console.log("found parent tile z%d-%d-%d",wt,sn,dn),it>1&&console.time("drilling down"),this.splitTile(rt.source,wt,sn,dn,Ge,ge,Ae),it>1&&console.timeEnd("drilling down"),this.tiles[ft]?Fl(this.tiles[ft],Me):null):null};class Fc extends s.VectorTileWorkerSource{constructor(ge,Ae,ze,Me,it){super(ge,Ae,ze,Me,uu),it&&(this.loadGeoJSON=it)}loadData(ge,Ae){const ze=ge&&ge.request,Me=ze&&ze.collectResourceTiming;this.loadGeoJSON(ge,(it,ht)=>{if(it||!ht)return Ae(it);if(typeof ht!="object")return Ae(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`));{R(ht,!0);try{if(ge.filter){const rt=s.createExpression(ge.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(rt.result==="error")throw new Error(rt.value.map(sn=>`${sn.key}: ${sn.message}`).join(", "));ht={type:"FeatureCollection",features:ht.features.filter(sn=>rt.value.evaluate({zoom:0},sn))}}this._geoJSONIndex=ge.cluster?new Ct(function({superclusterOptions:rt,clusterProperties:wt}){if(!wt||!rt)return rt;const sn={},dn={},Qt={accumulated:null,zoom:0},sr={properties:null},pr=Object.keys(wt);for(const tr of pr){const[st,Pt]=wt[tr],rn=s.createExpression(Pt),Gn=s.createExpression(typeof st=="string"?[st,["accumulated"],["get",tr]]:st);sn[tr]=rn.value,dn[tr]=Gn.value}return rt.map=tr=>{sr.properties=tr;const st={};for(const Pt of pr)st[Pt]=sn[Pt].evaluate(Qt,sr);return st},rt.reduce=(tr,st)=>{sr.properties=st;for(const Pt of pr)Qt.accumulated=tr[Pt],tr[Pt]=dn[Pt].evaluate(Qt,sr)},rt}(ge)).load(ht.features):function(rt,wt){return new lu(rt,wt)}(ht,ge.geojsonVtOptions)}catch(rt){return Ae(rt)}this.loaded={};const ft={};if(Me){const rt=s.getPerformanceMeasurement(ze);rt&&(ft.resourceTiming={},ft.resourceTiming[ge.source]=JSON.parse(JSON.stringify(rt)))}Ae(null,ft)}})}reloadTile(ge,Ae){const ze=this.loaded;return ze&&ze[ge.uid]?super.reloadTile(ge,Ae):this.loadTile(ge,Ae)}loadGeoJSON(ge,Ae){if(ge.request)s.getJSON(ge.request,Ae);else{if(typeof ge.data!="string")return Ae(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`));try{return Ae(null,JSON.parse(ge.data))}catch{return Ae(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ge,Ae){try{Ae(null,this._geoJSONIndex.getClusterExpansionZoom(ge.clusterId))}catch(ze){Ae(ze)}}getClusterChildren(ge,Ae){try{Ae(null,this._geoJSONIndex.getChildren(ge.clusterId))}catch(ze){Ae(ze)}}getClusterLeaves(ge,Ae){try{Ae(null,this._geoJSONIndex.getLeaves(ge.clusterId,ge.limit,ge.offset))}catch(ze){Ae(ze)}}}class Wu{constructor(ge){this.self=ge,this.actor=new s.Actor(ge,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:Fc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Ae,ze)=>{if(this.workerSourceTypes[Ae])throw new Error(`Worker source with name "${Ae}" already registered.`);this.workerSourceTypes[Ae]=ze},this.self.registerRTLTextPlugin=Ae=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=Ae.applyArabicShaping,s.plugin.processBidirectionalText=Ae.processBidirectionalText,s.plugin.processStyledBidirectionalText=Ae.processStyledBidirectionalText}}clearCaches(ge,Ae,ze){delete this.layerIndexes[ge],delete this.availableImages[ge],delete this.workerSources[ge],delete this.demWorkerSources[ge],ze()}checkIfReady(ge,Ae,ze){ze()}setReferrer(ge,Ae){this.referrer=Ae}spriteLoaded(ge,Ae){this.isSpriteLoaded[ge]=Ae;for(const ze in this.workerSources[ge]){const Me=this.workerSources[ge][ze];for(const it in Me)Me[it]instanceof s.VectorTileWorkerSource&&(Me[it].isSpriteLoaded=Ae,Me[it].fire(new s.Event("isSpriteLoaded")))}}setImages(ge,Ae,ze){this.availableImages[ge]=Ae;for(const Me in this.workerSources[ge]){const it=this.workerSources[ge][Me];for(const ht in it)it[ht].availableImages=Ae}ze()}enableTerrain(ge,Ae,ze){this.terrain=Ae,ze()}setProjection(ge,Ae){this.projections[ge]=s.getProjection(Ae)}setLayers(ge,Ae,ze){this.getLayerIndex(ge).replace(Ae),ze()}updateLayers(ge,Ae,ze){this.getLayerIndex(ge).update(Ae.layers,Ae.removedIds),ze()}loadTile(ge,Ae,ze){const Me=this.enableTerrain?s.extend({enableTerrain:this.terrain},Ae):Ae;Me.projection=this.projections[ge]||this.defaultProjection,this.getWorkerSource(ge,Ae.type,Ae.source).loadTile(Me,ze)}loadDEMTile(ge,Ae,ze){const Me=this.enableTerrain?s.extend({buildQuadTree:this.terrain},Ae):Ae;this.getDEMWorkerSource(ge,Ae.source).loadTile(Me,ze)}reloadTile(ge,Ae,ze){const Me=this.enableTerrain?s.extend({enableTerrain:this.terrain},Ae):Ae;Me.projection=this.projections[ge]||this.defaultProjection,this.getWorkerSource(ge,Ae.type,Ae.source).reloadTile(Me,ze)}abortTile(ge,Ae,ze){this.getWorkerSource(ge,Ae.type,Ae.source).abortTile(Ae,ze)}removeTile(ge,Ae,ze){this.getWorkerSource(ge,Ae.type,Ae.source).removeTile(Ae,ze)}removeSource(ge,Ae,ze){if(!this.workerSources[ge]||!this.workerSources[ge][Ae.type]||!this.workerSources[ge][Ae.type][Ae.source])return;const Me=this.workerSources[ge][Ae.type][Ae.source];delete this.workerSources[ge][Ae.type][Ae.source],Me.removeSource!==void 0?Me.removeSource(Ae,ze):ze()}loadWorkerSource(ge,Ae,ze){try{this.self.importScripts(Ae.url),ze()}catch(Me){ze(Me.toString())}}syncRTLPluginState(ge,Ae,ze){try{s.plugin.setState(Ae);const Me=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&Me!=null){this.self.importScripts(Me);const it=s.plugin.isParsed();ze(it?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Me}`),it)}}catch(Me){ze(Me.toString())}}getAvailableImages(ge){let Ae=this.availableImages[ge];return Ae||(Ae=[]),Ae}getLayerIndex(ge){let Ae=this.layerIndexes[ge];return Ae||(Ae=this.layerIndexes[ge]=new g),Ae}getWorkerSource(ge,Ae,ze){if(this.workerSources[ge]||(this.workerSources[ge]={}),this.workerSources[ge][Ae]||(this.workerSources[ge][Ae]={}),!this.workerSources[ge][Ae][ze]){const Me={send:(it,ht,ft,rt,wt,sn)=>{this.actor.send(it,ht,ft,ge,wt,sn)},scheduler:this.actor.scheduler};this.workerSources[ge][Ae][ze]=new this.workerSourceTypes[Ae](Me,this.getLayerIndex(ge),this.getAvailableImages(ge),this.isSpriteLoaded[ge])}return this.workerSources[ge][Ae][ze]}getDEMWorkerSource(ge,Ae){return this.demWorkerSources[ge]||(this.demWorkerSources[ge]={}),this.demWorkerSources[ge][Ae]||(this.demWorkerSources[ge][Ae]=new _),this.demWorkerSources[ge][Ae]}enforceCacheSizeLimit(ge,Ae){s.enforceCacheSizeLimit(Ae)}getWorkerPerformanceMetrics(ge,Ae,ze){ze(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Wu(self)),Wu}),o(["./shared"],function(s){function u(v,h){if(Array.isArray(v)){if(!Array.isArray(h)||v.length!==h.length)return!1;for(let m=0;m<v.length;m++)if(!u(v[m],h[m]))return!1;return!0}if(typeof v=="object"&&v!==null&&h!==null){if(typeof h!="object"||Object.keys(v).length!==Object.keys(h).length)return!1;for(const m in v)if(!u(v[m],h[m]))return!1;return!0}return v===h}var d=g;function g(v){return!function(h){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var S,I,L=new Blob([""],{type:"text/javascript"}),$=URL.createObjectURL(L);try{I=new Worker($),S=!0}catch{S=!1}return I&&I.terminate(),URL.revokeObjectURL($),S}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var S=document.createElement("canvas");S.width=S.height=1;var I=S.getContext("2d");if(!I)return!1;var L=I.getImageData(0,0,1,1);return L&&L.width===S.width}()?(_[m=h&&h.failIfMajorPerformanceCaveat]===void 0&&(_[m]=function(S){var I,L=function($){var H=document.createElement("canvas"),Q=Object.create(g.webGLContextAttributes);return Q.failIfMajorPerformanceCaveat=$,H.getContext("webgl",Q)||H.getContext("experimental-webgl",Q)}(S);if(!L)return!1;try{I=L.createShader(L.VERTEX_SHADER)}catch{return!1}return!(!I||L.isContextLost())&&(L.shaderSource(I,"void main() {}"),L.compileShader(I),L.getShaderParameter(I,L.COMPILE_STATUS)===!0)}(m)),_[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var m}(v)}var _={};function E(v,h,m){const S=s.window.document.createElement(v);return h!==void 0&&(S.className=h),m&&m.appendChild(S),S}function P(v,h,m){const S=s.window.document.createElementNS("http://www.w3.org/2000/svg",v);for(const I of Object.keys(h))S.setAttributeNS(null,I,h[I]);return m&&m.appendChild(S),S}g.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const R=s.window.document&&s.window.document.documentElement.style,B=R&&R.userSelect!==void 0?"userSelect":"WebkitUserSelect";let V;function z(){R&&B&&(V=R[B],R[B]="none")}function F(){R&&B&&(R[B]=V)}function k(v){v.preventDefault(),v.stopPropagation(),s.window.removeEventListener("click",k,!0)}function X(){s.window.addEventListener("click",k,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",k,!0)},0)}function Y(v,h){const m=v.getBoundingClientRect();return ce(v,m,h)}function J(v,h){const m=v.getBoundingClientRect(),S=[];for(let I=0;I<h.length;I++)S.push(ce(v,m,h[I]));return S}function ie(v){return s.window.InstallTrigger!==void 0&&v.button===2&&v.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:v.button}function ce(v,h,m){const S=v.offsetWidth===h.width?1:v.offsetWidth/h.width;return new s.Point((m.clientX-h.left)*S,(m.clientY-h.top)*S)}function re(v,h){var m=h[0],S=h[1],I=h[2],L=h[3],$=m*L-I*S;return $?(v[0]=L*($=1/$),v[1]=-S*$,v[2]=-I*$,v[3]=m*$,v):null}function ue(v){const{userImage:h}=v;return!!(h&&h.render&&h.render())&&(v.data.replace(new Uint8Array(h.data.buffer)),!0)}class se extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(h){if(this.loaded!==h&&(this.loaded=h,h)){for(const{ids:m,callback:S}of this.requestors)this._notify(m,S);this.requestors=[]}}hasImage(h){return!!this.getImage(h)}getImage(h){return this.images[h]}addImage(h,m){this._validate(h,m)&&(this.images[h]=m)}_validate(h,m){let S=!0;return this._validateStretch(m.stretchX,m.data&&m.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${h}" has invalid "stretchX" value`))),S=!1),this._validateStretch(m.stretchY,m.data&&m.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${h}" has invalid "stretchY" value`))),S=!1),this._validateContent(m.content,m)||(this.fire(new s.ErrorEvent(new Error(`Image "${h}" has invalid "content" value`))),S=!1),S}_validateStretch(h,m){if(!h)return!0;let S=0;for(const I of h){if(I[0]<S||I[1]<I[0]||m<I[1])return!1;S=I[1]}return!0}_validateContent(h,m){return!(h&&(h.length!==4||h[0]<0||m.data.width<h[0]||h[1]<0||m.data.height<h[1]||h[2]<0||m.data.width<h[2]||h[3]<0||m.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))}updateImage(h,m){m.version=this.images[h].version+1,this.images[h]=m,this.updatedImages[h]=!0}removeImage(h){const m=this.images[h];delete this.images[h],delete this.patterns[h],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(h,m){let S=!0;if(!this.isLoaded())for(const I of h)this.images[I]||(S=!1);this.isLoaded()||S?this._notify(h,m):this.requestors.push({ids:h,callback:m})}_notify(h,m){const S={};for(const I of h){this.images[I]||this.fire(new s.Event("styleimagemissing",{id:I}));const L=this.images[I];L?S[I]={data:L.data.clone(),pixelRatio:L.pixelRatio,sdf:L.sdf,version:L.version,stretchX:L.stretchX,stretchY:L.stretchY,content:L.content,hasRenderCallback:!!(L.userImage&&L.userImage.render)}:s.warnOnce(`Image "${I}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}m(null,S)}getPixelSize(){const{width:h,height:m}=this.atlasImage;return{width:h,height:m}}getPattern(h){const m=this.patterns[h],S=this.getImage(h);if(!S)return null;if(m&&m.position.version===S.version)return m.position;if(m)m.position.version=S.version;else{const I={w:S.data.width+2,h:S.data.height+2,x:0,y:0},L=new s.ImagePosition(I,S);this.patterns[h]={bin:I,position:L}}return this._updatePatternAtlas(),this.patterns[h].position}bind(h){const m=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(h,this.atlasImage,m.RGBA),this.atlasTexture&&this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(){const h=[];for(const L in this.patterns)h.push(this.patterns[L].bin);const{w:m,h:S}=s.potpack(h),I=this.atlasImage;I.resize({width:m||1,height:S||1});for(const L in this.patterns){const{bin:$}=this.patterns[L],H=$.x+1,Q=$.y+1,ne=this.images[L].data,te=ne.width,fe=ne.height;s.RGBAImage.copy(ne,I,{x:0,y:0},{x:H,y:Q},{width:te,height:fe}),s.RGBAImage.copy(ne,I,{x:0,y:fe-1},{x:H,y:Q-1},{width:te,height:1}),s.RGBAImage.copy(ne,I,{x:0,y:0},{x:H,y:Q+fe},{width:te,height:1}),s.RGBAImage.copy(ne,I,{x:te-1,y:0},{x:H-1,y:Q},{width:1,height:fe}),s.RGBAImage.copy(ne,I,{x:0,y:0},{x:H+te,y:Q},{width:1,height:fe})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(h){for(const m of h){if(this.callbackDispatchedThisFrame[m])continue;this.callbackDispatchedThisFrame[m]=!0;const S=this.images[m];ue(S)&&this.updateImage(m,S)}}}const me=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(v,h){return function([m,S,I]){const L=s.degToRad(S+90),$=s.degToRad(I);return{x:m*Math.cos(L)*Math.sin($),y:m*Math.sin(L)*Math.sin($),z:m*Math.cos($),azimuthal:S,polar:I}}(v.expression.evaluate(h))}interpolate(v,h,m){return{x:s.number(v.x,h.x,m),y:s.number(v.y,h.y,m),z:s.number(v.z,h.z,m),azimuthal:s.number(v.azimuthal,h.azimuthal,m),polar:s.number(v.polar,h.polar,m)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)});class Ce extends s.Evented{constructor(h){super(),this._transitionable=new s.Transitionable(me),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(h,m={}){if(!this._validate(s.validateLight,h,m))for(const S in h){const I=h[S];s.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-11),I):this._transitionable.setValue(S,I)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,m,S){return(!S||S.validate!==!1)&&s.emitValidationErrors(this,h.call(s.validateStyle,s.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const be=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)});let Ye=class extends s.Evented{constructor(v,h){super(),this._transitionable=new s.Transitionable(be),this.set(v),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(v){for(const h in v){const m=v[h];s.endsWith(h,"-transition")?this._transitionable.setTransition(h.slice(0,-11),m):this._transitionable.setValue(h,m)}}updateTransitions(v){this._transitioning=this._transitionable.transitioned(v,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(v){this.properties=this._transitioning.possiblyEvaluate(v)}};function tt(v,h,m,S){const I=s.smoothstep(45,65,m),[L,$]=pt(v,S),H=s.length(h);let Q=1-Math.min(1,Math.exp((H-L)/($-L)*-6));return Q*=Q*Q,Q=Math.min(1,1.00747*Q),Q*I*v.alpha}function pt(v,h){const m=.5/Math.tan(.5*h);return[v.range[0]+m,v.range[1]+m]}const Ee=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])});class Ne extends s.Evented{constructor(h,m){super(),this._transitionable=new s.Transitionable(Ee),this.set(h),this._transitioning=this._transitionable.untransitioned(),this._transform=m}get state(){const h=this._transform,m=h.projection.name==="globe",S=s.globeToMercatorTransition(h.zoom),I=this.properties.get("range"),L=[.5,3];return{range:m?[s.number(L[0],I[0],S),s.number(L[1],I[1],S)]:I,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(h,m={}){if(!this._validate(s.validateFog,h,m)){for(const S of Object.keys(s.spec.fog))h&&h[S]===void 0&&(h[S]=s.spec.fog[S].default);for(const S in h){const I=h[S];s.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-11),I):this._transitionable.setValue(S,I)}}}getOpacity(h){if(!this._transform.projection.supportsFog)return 0;const m=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,h))*m.a}getOpacityAtLatLng(h,m){return this._transform.projection.supportsFog?function(S,I,L){const $=s.MercatorCoordinate.fromLngLat(I),H=L.elevation?L.elevation.getAtPointOrZero($):0,Q=[$.x,$.y,H];return s.transformMat4(Q,Q,L.mercatorFogMatrix),tt(S,Q,L.pitch,L._fov)}(this.state,h,m):0}getFovAdjustedRange(h){return this._transform.projection.supportsFog?pt(this.state,h):[0,1]}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,m,S){return(!S||S.validate!==!1)&&s.emitValidationErrors(this,h.call(s.validateStyle,s.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class Be{constructor(h,m){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const S=this.workerPool.acquire(this.id);for(let I=0;I<S.length;I++){const L=new Be.Actor(S[I],m,this.id);L.name=`Worker ${I}`,this.actors.push(L)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(h,m,S){s.asyncAll(this.actors,(I,L)=>{I.send(h,m,L)},S=S||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(h=>{h.remove()}),this.actors=[],this.workerPool.release(this.id)}}function qe(v,h,m){return h*(s.EXTENT/(v.tileSize*Math.pow(2,m-v.tileID.overscaledZ)))}Be.Actor=s.Actor;class ct{constructor(h,m,S,I){this.screenBounds=h,this.cameraPoint=m,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=S,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,I)}static createFromScreenPoints(h,m){let S,I;if(h instanceof s.Point||typeof h[0]=="number"){const L=s.Point.convert(h);S=[L],I=m.isPointAboveHorizon(L)}else{const L=s.Point.convert(h[0]),$=s.Point.convert(h[1]);S=[L,$],I=s.polygonizeBounds(L,$).every(H=>m.isPointAboveHorizon(H))}return new ct(S,m.getCameraPoint(),I,m)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(h){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],h)}bufferedCameraGeometry(h){const m=this.screenBounds[0],S=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],I=s.polygonizeBounds(m,S,0,!1);return this.cameraPoint.y>S.y&&(this.cameraPoint.x>m.x&&this.cameraPoint.x<S.x?I.splice(3,0,this.cameraPoint):this.cameraPoint.x>=S.x?I[2]=this.cameraPoint:this.cameraPoint.x<=m.x&&(I[3]=this.cameraPoint)),s.bufferConvexPolygon(I,h)}bufferedCameraGeometryGlobe(h){const m=this.screenBounds[0],S=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],I=s.polygonizeBounds(m,S,h),L=this.cameraPoint.clone();switch(3*((L.y>m.y)+(L.y>S.y))+((L.x>m.x)+(L.x>S.x))){case 0:I[0]=L,I[4]=L.clone();break;case 1:I.splice(1,0,L);break;case 2:I[1]=L;break;case 3:I.splice(4,0,L);break;case 5:I.splice(2,0,L);break;case 6:I[3]=L;break;case 7:I.splice(3,0,L);break;case 8:I[2]=L}return I}containsTile(h,m,S,I=0){const L=h.queryPadding/m._pixelsPerMercatorPixel+1,$=S?this._bufferedCameraMercator(L,m):this._bufferedScreenMercator(L,m);let H=h.tileID.wrap+($.unwrapped?I:0);const Q=$.polygon.map(Re=>s.getTilePoint(h.tileTransform,Re,H));if(!s.polygonIntersectsBox(Q,0,0,s.EXTENT,s.EXTENT))return;H=h.tileID.wrap+(this.screenGeometryMercator.unwrapped?I:0);const ne=this.screenGeometryMercator.polygon.map(Re=>s.getTileVec3(h.tileTransform,Re,H)),te=ne.map(Re=>new s.Point(Re[0],Re[1])),fe=m.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),ve=s.getTileVec3(h.tileTransform,fe,H),Te=ne.map(Re=>{const he=s.sub(Re,Re,ve);return s.normalize(he,he),new s.Ray(ve,he)}),Ie=qe(h,1,m.zoom)*m._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:te,tilespaceRays:Te,bufferedTilespaceGeometry:Q,bufferedTilespaceBounds:(Pe=s.getBounds(Q),Pe.min.x=s.clamp(Pe.min.x,0,s.EXTENT),Pe.min.y=s.clamp(Pe.min.y,0,s.EXTENT),Pe.max.x=s.clamp(Pe.max.x,0,s.EXTENT),Pe.max.y=s.clamp(Pe.max.y,0,s.EXTENT),Pe),tile:h,tileID:h.tileID,pixelToTileUnitsFactor:Ie};var Pe}_bufferedScreenMercator(h,m){const S=In(h);if(this._screenRaycastCache[S])return this._screenRaycastCache[S];{let I;return I=m.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(h),m):{polygon:this.bufferedScreenGeometry(h).map(L=>m.pointCoordinate3D(L)),unwrapped:!0},this._screenRaycastCache[S]=I,I}}_bufferedCameraMercator(h,m){const S=In(h);if(this._cameraRaycastCache[S])return this._cameraRaycastCache[S];{let I;return I=m.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(h),m):{polygon:this.bufferedCameraGeometry(h).map(L=>m.pointCoordinate3D(L)),unwrapped:!0},this._cameraRaycastCache[S]=I,I}}_projectAndResample(h,m){const S=function(L,$){const H=s.multiply([],$.pixelMatrix,$.globeMatrix),Q=[0,-s.GLOBE_RADIUS,0,1],ne=[0,s.GLOBE_RADIUS,0,1],te=[0,0,0,1];s.transformMat4$1(Q,Q,H),s.transformMat4$1(ne,ne,H),s.transformMat4$1(te,te,H);const fe=new s.Point(Q[0]/Q[3],Q[1]/Q[3]),ve=new s.Point(ne[0]/ne[3],ne[1]/ne[3]),Te=s.polygonContainsPoint(L,fe)&&Q[3]<te[3],Ie=s.polygonContainsPoint(L,ve)&&ne[3]<te[3];if(!Te&&!Ie)return null;const Pe=function(Je,lt,at){for(let xt=1;xt<Je.length;xt++){const en=Dt(lt.pointCoordinate3D(Je[xt-1]).x),At=Dt(lt.pointCoordinate3D(Je[xt]).x);if(at<0){if(en<At)return{idx:xt,t:-en/(At-1-en)}}else if(At<en)return{idx:xt,t:(1-en)/(At+1-en)}}return null}(L,$,Te?-1:1);if(!Pe)return null;const{idx:Re,t:he}=Pe;let Se=Re>1?Ct(L.slice(0,Re),$):[],Fe=Re<L.length?Ct(L.slice(Re),$):[];Se=Se.map(Je=>new s.Point(Dt(Je.x),Je.y)),Fe=Fe.map(Je=>new s.Point(Dt(Je.x),Je.y));const ke=[...Se];ke.length===0&&ke.push(Fe[Fe.length-1]);const Qe=s.number(ke[ke.length-1].y,(Fe.length===0?Se[0]:Fe[0]).y,he);let et;return et=Te?[new s.Point(0,Qe),new s.Point(0,0),new s.Point(1,0),new s.Point(1,Qe)]:[new s.Point(1,Qe),new s.Point(1,1),new s.Point(0,1),new s.Point(0,Qe)],ke.push(...et),Fe.length===0?ke.push(Se[0]):ke.push(...Fe),{polygon:ke.map(Je=>new s.MercatorCoordinate(Je.x,Je.y)),unwrapped:!1}}(h,m);if(S)return S;const I=function(L,$){let H=!1,Q=-1/0,ne=0;for(let fe=0;fe<L.length-1;fe++)L[fe].x>Q&&(Q=L[fe].x,ne=fe);for(let fe=0;fe<L.length-1;fe++){const ve=(ne+fe)%(L.length-1),Te=L[ve],Ie=L[ve+1];Math.abs(Te.x-Ie.x)>.5&&(Te.x<Ie.x?(Te.x+=1,ve===0&&(L[L.length-1].x+=1)):(Ie.x+=1,ve+1===L.length-1&&(L[0].x+=1)),H=!0)}const te=s.mercatorXfromLng($.center.lng);return H&&te<Math.abs(te-1)&&L.forEach(fe=>{fe.x-=1}),{polygon:L,unwrapped:H}}(Ct(h,m).map(L=>new s.Point(Dt(L.x),L.y)),m);return{polygon:I.polygon.map(L=>new s.MercatorCoordinate(L.x,L.y)),unwrapped:I.unwrapped}}}function Ct(v,h){return s.resample(v,m=>{const S=h.pointCoordinate3D(m);m.x=S.x,m.y=S.y},1/256)}function Dt(v){return v<0?1+v%1:v%1}function In(v){return 100*v|0}function Mn(v,h,m,S,I){const L=function($,H){if($)return I($);if(H){v.url&&H.tiles&&v.tiles&&delete v.tiles;const Q=s.pick(s.extend(H,v),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);H.vector_layers&&(Q.vectorLayers=H.vector_layers,Q.vectorLayerIds=Q.vectorLayers.map(ne=>ne.id)),Q.tiles=h.canonicalizeTileset(Q,v.url),I(null,Q)}};return v.url?s.getJSON(h.transformRequest(h.normalizeSourceURL(v.url,null,m,S),s.ResourceType.Source),L):s.exported.frame(()=>L(null,v))}class Tn{constructor(h,m,S){this.bounds=s.LngLatBounds.convert(this.validateBounds(h)),this.minzoom=m||0,this.maxzoom=S||24}validateBounds(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]}contains(h){const m=Math.pow(2,h.z),S=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*m),I=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*m),L=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*m),$=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*m);return h.x>=S&&h.x<L&&h.y>=I&&h.y<$}}class Nt{constructor(h,m,S){this.context=h;const I=h.gl;this.buffer=I.createBuffer(),this.dynamicDraw=!!S,this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),I.bufferData(I.ELEMENT_ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||m.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(h){const m=this.context.gl;this.context.unbindVAO(),this.bind(),m.bufferSubData(m.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Zt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Wt{constructor(h,m,S,I){this.length=m.length,this.attributes=S,this.itemSize=m.bytesPerElement,this.dynamicDraw=I,this.context=h;const L=h.gl;this.buffer=L.createBuffer(),h.bindVertexBuffer.set(this.buffer),L.bufferData(L.ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?L.DYNAMIC_DRAW:L.STATIC_DRAW),this.dynamicDraw||m.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(h){const m=this.context.gl;this.bind(),m.bufferSubData(m.ARRAY_BUFFER,0,h.arrayBuffer)}enableAttributes(h,m){for(let S=0;S<this.attributes.length;S++){const I=m.attributes[this.attributes[S].name];I!==void 0&&h.enableVertexAttribArray(I)}}setVertexAttribPointers(h,m,S){for(let I=0;I<this.attributes.length;I++){const L=this.attributes[I],$=m.attributes[L.name];$!==void 0&&h.vertexAttribPointer($,L.components,h[Zt[L.type]],!1,this.itemSize,L.offset+this.itemSize*(S||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class hn{constructor(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(h){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class lr extends hn{getDefault(){return s.Color.transparent}set(h){const m=this.current;(h.r!==m.r||h.g!==m.g||h.b!==m.b||h.a!==m.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)}}class It extends hn{getDefault(){return 1}set(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)}}class Xt extends hn{getDefault(){return 0}set(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)}}class $t extends hn{getDefault(){return[!0,!0,!0,!0]}set(h){const m=this.current;(h[0]!==m[0]||h[1]!==m[1]||h[2]!==m[2]||h[3]!==m[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)}}class cn extends hn{getDefault(){return!0}set(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)}}class Jt extends hn{getDefault(){return 255}set(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)}}class Ln extends hn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(h){const m=this.current;(h.func!==m.func||h.ref!==m.ref||h.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)}}class qn extends hn{getDefault(){const h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]}set(h){const m=this.current;(h[0]!==m[0]||h[1]!==m[1]||h[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)}}class or extends hn{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const m=this.gl;h?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=h,this.dirty=!1}}class cr extends hn{getDefault(){return[0,1]}set(h){const m=this.current;(h[0]!==m[0]||h[1]!==m[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)}}class cs extends hn{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const m=this.gl;h?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=h,this.dirty=!1}}class Ri extends hn{getDefault(){return this.gl.LESS}set(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)}}class Do extends hn{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const m=this.gl;h?m.enable(m.BLEND):m.disable(m.BLEND),this.current=h,this.dirty=!1}}class Fa extends hn{getDefault(){const h=this.gl;return[h.ONE,h.ZERO]}set(h){const m=this.current;(h[0]!==m[0]||h[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)}}class Nl extends hn{getDefault(){return s.Color.transparent}set(h){const m=this.current;(h.r!==m.r||h.g!==m.g||h.b!==m.b||h.a!==m.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)}}class _s extends hn{getDefault(){return this.gl.FUNC_ADD}set(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)}}class mo extends hn{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const m=this.gl;h?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=h,this.dirty=!1}}class Fl extends hn{getDefault(){return this.gl.BACK}set(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)}}class su extends hn{getDefault(){return this.gl.CCW}set(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)}}let kl,au=class extends hn{getDefault(){return null}set(v){(v!==this.current||this.dirty)&&(this.gl.useProgram(v),this.current=v,this.dirty=!1)}};class $u extends hn{getDefault(){return this.gl.TEXTURE0}set(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)}}class lu extends hn{getDefault(){const h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]}set(h){const m=this.current;(h[0]!==m[0]||h[1]!==m[1]||h[2]!==m[2]||h[3]!==m[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)}}class Hu extends hn{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;const m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,h),this.current=h,this.dirty=!1}}class uu extends hn{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;const m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class Fc extends hn{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;const m=this.gl;m.bindTexture(m.TEXTURE_2D,h),this.current=h,this.dirty=!1}}class Wu extends hn{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;const m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}}class Ge extends hn{getDefault(){return null}set(h){const m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1}}class ge extends hn{constructor(h){super(h),this.vao=h.extVertexArrayObject}getDefault(){return null}set(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)}}class Ae extends hn{getDefault(){return 4}set(h){if(h===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}}class ze extends hn{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}}class Me extends hn{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}}class it extends hn{constructor(h,m){super(h),this.context=h,this.parent=m}getDefault(){return null}}class ht extends it{setDirty(){this.dirty=!0}set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}}class ft extends it{attachment(){return this.gl.DEPTH_ATTACHMENT}set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,this.attachment(),m.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class rt extends ft{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class wt{constructor(h,m,S,I){this.context=h,this.width=m,this.height=S;const L=this.framebuffer=h.gl.createFramebuffer();this.colorAttachment=new ht(h,L),I&&(this.depthAttachment=new ft(h,L))}destroy(){const h=this.context.gl,m=this.colorAttachment.get();if(m&&h.deleteTexture(m),this.depthAttachment){const S=this.depthAttachment.get();S&&h.deleteRenderbuffer(S)}h.deleteFramebuffer(this.framebuffer)}}class sn{constructor(h,m=!1){if(this.gl=h,this.isWebGL2=m,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),m){const S=h;this.extVertexArrayObject={createVertexArrayOES:S.createVertexArray.bind(h),deleteVertexArrayOES:S.deleteVertexArray.bind(h),bindVertexArrayOES:S.bindVertexArray.bind(h)}}this.clearColor=new lr(this),this.clearDepth=new It(this),this.clearStencil=new Xt(this),this.colorMask=new $t(this),this.depthMask=new cn(this),this.stencilMask=new Jt(this),this.stencilFunc=new Ln(this),this.stencilOp=new qn(this),this.stencilTest=new or(this),this.depthRange=new cr(this),this.depthTest=new cs(this),this.depthFunc=new Ri(this),this.blend=new Do(this),this.blendFunc=new Fa(this),this.blendColor=new Nl(this),this.blendEquation=new _s(this),this.cullFace=new mo(this),this.cullFaceSide=new Fl(this),this.frontFace=new su(this),this.program=new au(this),this.activeTexture=new $u(this),this.viewport=new lu(this),this.bindFramebuffer=new Hu(this),this.bindRenderbuffer=new uu(this),this.bindTexture=new Fc(this),this.bindVertexBuffer=new Wu(this),this.bindElementBuffer=new Ge(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ge(this),this.pixelStoreUnpack=new Ae(this),this.pixelStoreUnpackPremultiplyAlpha=new ze(this),this.pixelStoreUnpackFlipY=new Me(this),this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=h.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=h.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=h.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),m||(this.extTextureHalfFloat=h.getExtension("OES_texture_half_float")),(m||this.extTextureHalfFloat&&h.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=h.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=m||h.getExtension("OES_standard_derivatives"),this.extTimerQuery=h.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(h,m){return new Nt(this,h,m)}createVertexBuffer(h,m,S){return new Wt(this,h,m,S)}createRenderbuffer(h,m,S){const I=this.gl,L=I.createRenderbuffer();return this.bindRenderbuffer.set(L),I.renderbufferStorage(I.RENDERBUFFER,h,m,S),this.bindRenderbuffer.set(null),L}createFramebuffer(h,m,S){return new wt(this,h,m,S)}clear({color:h,depth:m,stencil:S}){const I=this.gl;let L=0;h&&(L|=I.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),m!==void 0&&(L|=I.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(m),this.depthMask.set(!0)),S!==void 0&&(L|=I.STENCIL_BUFFER_BIT,this.clearStencil.set(S),this.stencilMask.set(255)),I.clear(L)}setCullFace(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))}setDepthMode(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)}setStencilMode(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)}setColorMode(h){u(h.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class dn extends s.Evented{constructor(h,m,S,I){if(super(),this.id=h,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(m,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(I),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(h){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const m=Array.isArray(this.map._language)?this.map._language.join():this.map._language,S=this.map._worldview;this._tileJSONRequest=Mn(this._options,this.map._requestManager,m,S,(I,L)=>{this._tileJSONRequest=null,this._loaded=!0,I?(m&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${m}`),S&&S.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${S}`),this.fire(new s.ErrorEvent(I))):L&&(s.extend(this,L),L.bounds&&(this.tileBounds=new Tn(L.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(L.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),h&&h(I)})}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(h){return this._options.tiles=h,this.reload(),this}setUrl(h){return this.url=h,this._options.url=h,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(h,m){const S=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),I={request:this.map._requestManager.transformRequest(S,s.ResourceType.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:h.isSymbolTile};if(I.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired")h.state==="loading"?h.reloadCallback=m:h.request=h.actor.send("reloadTile",I,L.bind(this));else if(h.actor=this._tileWorkers[S]=this._tileWorkers[S]||this.dispatcher.getActor(),this.dispatcher.ready)h.request=h.actor.send("loadTile",I,L.bind(this),void 0,!0);else{const $=s.loadVectorTile.call({deduped:this._deduped},I,(H,Q)=>{H||!Q?L.call(this,H):(I.data={cacheControl:Q.cacheControl,expires:Q.expires,rawData:Q.rawData.slice(0)},h.actor&&h.actor.send("loadTile",I,L.bind(this),void 0,!0))},!0);h.request={cancel:$}}function L($,H){return delete h.request,h.aborted?m(null):$&&$.status!==404?m($):(H&&H.resourceTiming&&(h.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&h.setExpiryData(H),h.loadVectorData(H,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),m(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id})}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Qt extends s.Evented{constructor(h,m,S,I){super(),this.id=h,this.dispatcher=S,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},m),s.extend(this,s.pick(m,["url","scheme","tileSize"]))}load(h){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Mn(this._options,this.map._requestManager,null,null,(m,S)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new s.ErrorEvent(m)):S&&(s.extend(this,S),S.bounds&&(this.tileBounds=new Tn(S.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(S.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),h&&h(m)})}loaded(){return this._loaded}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(h){return this._options.tiles=h,this.reload(),this}setUrl(h){return this.url=h,this._options.url=h,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,m){const S=s.exported.devicePixelRatio>=2,I=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),S,this.tileSize);h.request=s.getImage(this.map._requestManager.transformRequest(I,s.ResourceType.Tile),(L,$,H,Q)=>(delete h.request,h.aborted?(h.state="unloaded",m(null)):L?(h.state="errored",m(L)):$?(this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:H,expires:Q}),h.setTexture($,this.map.painter),h.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void m(null)):m(null)))}static loadTileData(h,m,S){h.setTexture(m,S)}static unloadTileData(h,m){h.texture&&m.saveTileTexture(h.texture)}abortTile(h,m){h.request&&(h.request.cancel(),delete h.request),m()}unloadTile(h,m){h.texture&&this.map.painter.saveTileTexture(h.texture),m()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function sr(v,h,m,S,I,L,$,H){const Q=[v,m,I,h,S,L,1,1,1],ne=[$,H,1],te=s.adjoint([],Q),[fe,ve,Te]=s.transformMat3(ne,ne,s.transpose(te,te));return s.multiply$1(Q,[fe,0,0,0,ve,0,0,0,Te],Q)}class pr extends s.Evented{constructor(h,m,S,I){super(),this.id=h,this.dispatcher=S,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=m,this._dirty=!1}load(h,m){this._loaded=m||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(S,I)=>{if(this._imageRequest=null,this._loaded=!0,S)this.fire(new s.ErrorEvent(S));else if(I){const{HTMLImageElement:L}=s.window;this.image=I instanceof L?s.exported.getImageData(I):I,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,h&&(this.coordinates=h),this._finishLoading()}})}loaded(){return this._loaded}updateImage(h){return this.image&&h.url?(this._imageRequest&&h.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=h.url,this.load(h.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(h){this.map=h,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(h){this.coordinates=h,this._boundsArray=void 0;const m=h.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(S){let I=1/0,L=1/0,$=-1/0,H=-1/0;for(const fe of S)I=Math.min(I,fe.x),L=Math.min(L,fe.y),$=Math.max($,fe.x),H=Math.max(H,fe.y);const Q=Math.max($-I,H-L),ne=Math.max(0,Math.floor(-Math.log(Q)/Math.LN2)),te=Math.pow(2,ne);return new s.CanonicalTileID(ne,Math.floor((I+$)/2*te),Math.floor((L+H)/2*te))}(m),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(h){for(const Q in this.tiles){const ne=this.tiles[Q];ne.state!=="loaded"&&(ne.state="loaded",ne.texture=this.texture)}if(this._boundsArray)return;const m=s.tileTransform(this.tileID,this.map.transform.projection),[S,I,L,$]=this.coordinates.map(Q=>{const ne=m.projection.project(Q[0],Q[1]);return s.getTilePoint(m,ne)._round()});this.perspectiveTransform=function(Q,ne,te,fe,ve,Te,Ie,Pe,Re,he){const Se=sr(0,0,Q,0,0,ne,Q,ne),Fe=sr(te,fe,ve,Te,Ie,Pe,Re,he);return s.multiply$1(Fe,s.adjoint(Se,Se),Fe),[Fe[6]/Fe[8]*Q/s.EXTENT,Fe[7]/Fe[8]*ne/s.EXTENT]}(this.width,this.height,S.x,S.y,I.x,I.y,$.x,$.y,L.x,L.y);const H=this._boundsArray=new s.StructArrayLayout4i8;H.emplaceBack(S.x,S.y,0,0),H.emplaceBack(I.x,I.y,s.EXTENT,0),H.emplaceBack($.x,$.y,0,s.EXTENT),H.emplaceBack(L.x,L.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=h.createVertexBuffer(H,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const h=this.map.painter.context,m=h.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(h,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(h)}loadTile(h,m){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},m(null)):(h.state="errored",m(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const tr={vector:dn,raster:Qt,"raster-dem":class extends Qt{constructor(v,h,m,S){super(v,h,m,S),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}loadTile(v,h){const m=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function S(I,L){I&&(v.state="errored",h(I)),L&&(v.dem=L,v.dem.onDeserialize(),v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0,v.state="loaded",h(null))}v.request=s.getImage(this.map._requestManager.transformRequest(m,s.ResourceType.Tile),(function(I,L,$,H){if(delete v.request,v.aborted)v.state="unloaded",h(null);else if(I)v.state="errored",h(I);else if(L){this.map._refreshExpiredTiles&&v.setExpiryData({cacheControl:$,expires:H});const Q=s.window.ImageBitmap&&L instanceof s.window.ImageBitmap&&(kl==null&&(kl=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),kl),ne=1-(L.width-s.prevPowerOfTwo(L.width))/2;ne<1||v.neighboringTiles||(v.neighboringTiles=this._getNeighboringTiles(v.tileID));const te=Q?L:s.exported.getImageData(L,ne),fe={uid:v.uid,coord:v.tileID,source:this.id,rawImageData:te,encoding:this.encoding,padding:ne};v.actor&&v.state!=="expired"||(v.actor=this.dispatcher.getActor(),v.actor.send("loadDEMTile",fe,S.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(v){const h=v.canonical,m=Math.pow(2,h.z),S=(h.x-1+m)%m,I=h.x===0?v.wrap-1:v.wrap,L=(h.x+1+m)%m,$=h.x+1===m?v.wrap+1:v.wrap,H={};return H[new s.OverscaledTileID(v.overscaledZ,I,h.z,S,h.y).key]={backfilled:!1},H[new s.OverscaledTileID(v.overscaledZ,$,h.z,L,h.y).key]={backfilled:!1},h.y>0&&(H[new s.OverscaledTileID(v.overscaledZ,I,h.z,S,h.y-1).key]={backfilled:!1},H[new s.OverscaledTileID(v.overscaledZ,v.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},H[new s.OverscaledTileID(v.overscaledZ,$,h.z,L,h.y-1).key]={backfilled:!1}),h.y+1<m&&(H[new s.OverscaledTileID(v.overscaledZ,I,h.z,S,h.y+1).key]={backfilled:!1},H[new s.OverscaledTileID(v.overscaledZ,v.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},H[new s.OverscaledTileID(v.overscaledZ,$,h.z,L,h.y+1).key]={backfilled:!1}),H}unloadTile(v){v.demTexture&&this.map.painter.saveTileTexture(v.demTexture),v.fbo&&(v.fbo.destroy(),delete v.fbo),v.dem&&delete v.dem,delete v.neighboringTiles,v.state="unloaded"}},geojson:class extends s.Evented{constructor(v,h,m,S){super(),this.id=v,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=m.getActor(),this.setEventedParent(S),this._data=h.data,this._options=s.extend({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const I=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*I,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*I,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:s.EXTENT,radius:(h.clusterRadius!==void 0?h.clusterRadius:50)*I,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}onAdd(v){this.map=v,this.setData(this._data)}setData(v){return this._data=v,this._updateWorkerData(),this}getClusterExpansionZoom(v,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:v,source:this.id},h),this}getClusterChildren(v,h){return this.actor.send("geojson.getClusterChildren",{clusterId:v,source:this.id},h),this}getClusterLeaves(v,h,m,S){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:v,limit:h,offset:m},S),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const v=s.extend({},this.workerOptions),h=this._data;typeof h=="string"?(v.request=this.map._requestManager.transformRequest(s.exported.resolveURL(h),s.ResourceType.Source),v.request.collectResourceTiming=this._collectResourceTiming):v.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,v,(m,S)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new s.ErrorEvent(m));else{const I={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&S&&S.resourceTiming&&S.resourceTiming[this.id]&&(I.resourceTiming=S.resourceTiming[this.id]),this.fire(new s.Event("data",I)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(v,h){const m=v.actor?"reloadTile":"loadTile";v.actor=this.actor,v.request=this.actor.send(m,{type:this.type,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(S,I)=>(delete v.request,v.unloadVectorData(),v.aborted?h(null):S?h(S):(v.loadVectorData(I,this.map.painter,m==="reloadTile"),h(null))),void 0,m==="loadTile")}abortTile(v){v.request&&(v.request.cancel(),delete v.request),v.aborted=!0}unloadTile(v){v.unloadVectorData(),this.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends pr{constructor(v,h,m,S){super(v,h,m,S),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;const v=this.options;this.urls=[];for(const h of v.urls)this.urls.push(this.map._requestManager.transformRequest(h,s.ResourceType.Source).url);s.getVideo(this.urls,(h,m)=>{this._loaded=!0,h?this.fire(new s.ErrorEvent(h)):m&&(this.video=m,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(v){if(this.video){const h=this.video.seekable;v<h.start(0)||v>h.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=v}}getVideo(){return this.video}onAdd(v){this.map||(this.map=v,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const v=this.map.painter.context,h=v.gl;this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(v,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(v)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:pr,canvas:class extends pr{constructor(v,h,m,S){super(v,h,m,S),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(I=>!Array.isArray(I)||I.length!==2||I.some(L=>typeof L!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${v}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${v}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${v}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${v}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${v}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(v){this.map=v,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let v=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,v=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,v=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context;this.texture?(v||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(h,this.canvas,h.gl.RGBA,{premultiply:!0}),this._prepareData(h)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const v of[this.canvas.width,this.canvas.height])if(isNaN(v)||v<=0)return!0;return!1}},custom:class extends s.Evented{constructor(v,h,m,S){super(),this.id=v,this.type="custom",this._dataType="raster",this._dispatcher=m,this._implementation=h,this.setEventedParent(S),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Tn(this._implementation.bounds,this.minzoom,this.maxzoom)),h.update=this._update.bind(this),h.clearTiles=this._clearTiles.bind(this),h.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(h,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(v){this._map=v,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(v),this.load()}onRemove(v){this._implementation.onRemove&&this._implementation.onRemove(v)}hasTile(v){if(this._implementation.hasTile){const{x:h,y:m,z:S}=v.canonical;return this._implementation.hasTile({x:h,y:m,z:S})}return!this.tileBounds||this.tileBounds.contains(v.canonical)}loadTile(v,h){const{x:m,y:S,z:I}=v.tileID.canonical,L=new s.window.AbortController;v.request=Promise.resolve(this._implementation.loadTile({x:m,y:S,z:I},{signal:L.signal})).then((function($){return delete v.request,v.aborted?(v.state="unloaded",h(null)):$===void 0?(v.state="errored",h(null)):$===null?(this.loadTileData(v,{width:this.tileSize,height:this.tileSize,data:null}),v.state="loaded",h(null)):function(H){return H instanceof s.window.ImageData||H instanceof s.window.HTMLCanvasElement||H instanceof s.window.ImageBitmap||H instanceof s.window.HTMLImageElement}($)?(this.loadTileData(v,$),v.state="loaded",void h(null)):(v.state="errored",h(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch($=>{$.code!==20&&(v.state="errored",h($))}),v.request.cancel=()=>L.abort()}loadTileData(v,h){Qt.loadTileData(v,h,this._map.painter)}unloadTileData(v){Qt.unloadTileData(v,this._map.painter)}unloadTile(v,h){if(this.unloadTileData(v),this._implementation.unloadTile){const{x:m,y:S,z:I}=v.tileID.canonical;this._implementation.unloadTile({x:m,y:S,z:I})}h()}abortTile(v,h){v.request&&v.request.cancel&&(v.request.cancel(),delete v.request),h()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(v=>({x:v.canonical.x,y:v.canonical.y,z:v.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},st=function(v,h,m,S){const I=new tr[h.type](v,h,m,S);if(I.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${I.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],I),I};function Pt(v,h){const m=s.identity([]);return s.scale(m,m,[.5*v.width,.5*-v.height,1]),s.translate(m,m,[1,-1,0]),s.multiply(m,m,v.calculateProjMatrix(h.toUnwrapped())),Float32Array.from(m)}function rn(v,h,m,S,I,L,$,H=!1){const Q=v.tilesIn(S,$,H);Q.sort(w);const ne=[];for(const fe of Q)ne.push({wrappedTileID:fe.tile.tileID.wrapped().key,queryResults:fe.tile.queryRenderedFeatures(h,m,v._state,fe,I,L,Pt(v.transform,fe.tile.tileID),H)});const te=function(fe){const ve={},Te={};for(const Ie of fe){const Pe=Ie.queryResults,Re=Ie.wrappedTileID,he=Te[Re]=Te[Re]||{};for(const Se in Pe){const Fe=Pe[Se],ke=he[Se]=he[Se]||{},Qe=ve[Se]=ve[Se]||[];for(const et of Fe)ke[et.featureIndex]||(ke[et.featureIndex]=!0,Qe.push(et))}}return ve}(ne);for(const fe in te)te[fe].forEach(ve=>{const Te=ve.feature,Ie=Te.layer;Ie&&Ie.type!=="background"&&Ie.type!=="sky"&&(Te.source=Ie.source,Ie["source-layer"]&&(Te.sourceLayer=Ie["source-layer"]),Te.state=Te.id!==void 0?v.getFeatureState(Ie["source-layer"],Te.id):{})});return te}function Gn(v,h){const m=v.getRenderableIds().map(L=>v.getTileByID(L)),S=[],I={};for(let L=0;L<m.length;L++){const $=m[L],H=$.tileID.canonical.key;I[H]||(I[H]=!0,$.querySourceFeatures(S,h))}return S}function w(v,h){const m=v.tileID,S=h.tileID;return m.overscaledZ-S.overscaledZ||m.canonical.y-S.canonical.y||m.wrap-S.wrap||m.canonical.x-S.canonical.x}function Ue(){return Zg.workerClass!=null?new Zg.workerClass:new s.window.Worker(Zg.workerUrl)}const Ir="mapboxgl_preloaded_worker_pool";class fr{constructor(){this.active={}}acquire(h){if(!this.workers)for(this.workers=[];this.workers.length<fr.workerCount;)this.workers.push(new Ue);return this.active[h]=!0,this.workers.slice()}release(h){delete this.active[h],this.numActive()===0&&(this.workers.forEach(m=>{m.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ir]}numActive(){return Object.keys(this.active).length}}let rr;function Tr(){return rr||(rr=new fr),rr}function qi(v,h){const m={};for(const S in v)S!=="ref"&&(m[S]=v[S]);return s.refProperties.forEach(S=>{S in h&&(m[S]=h[S])}),m}function qr(v){v=v.slice();const h=Object.create(null);for(let m=0;m<v.length;m++)h[v[m].id]=v[m];for(let m=0;m<v.length;m++)"ref"in v[m]&&(v[m]=qi(v[m],h[v[m].ref]));return v}fr.workerCount=2;const jn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ro(v,h,m){m.push({command:jn.addSource,args:[v,h[v]]})}function ca(v,h,m){h.push({command:jn.removeSource,args:[v]}),m[v]=!0}function kc(v,h,m,S){ca(v,m,S),ro(v,h,m)}function zl(v,h,m){let S;for(S in v[m])if(v[m].hasOwnProperty(S)&&S!=="data"&&!u(v[m][S],h[m][S]))return!1;for(S in h[m])if(h[m].hasOwnProperty(S)&&S!=="data"&&!u(v[m][S],h[m][S]))return!1;return!0}function Qr(v,h,m,S,I,L){let $;for($ in h=h||{},v=v||{})v.hasOwnProperty($)&&(u(v[$],h[$])||m.push({command:L,args:[S,$,h[$],I]}));for($ in h)h.hasOwnProperty($)&&!v.hasOwnProperty($)&&(u(v[$],h[$])||m.push({command:L,args:[S,$,h[$],I]}))}function Vo(v){return v.id}function Bo(v,h){return v[h.id]=h,v}class ka{constructor(h,m){this.reset(h,m)}reset(h,m){this.points=h||[],this._distances=[0];for(let S=1;S<this.points.length;S++)this._distances[S]=this._distances[S-1]+this.points[S].dist(this.points[S-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(m||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(h){if(this.points.length===1)return this.points[0];h=s.clamp(h,0,1);let m=1,S=this._distances[m];const I=h*this.paddedLength+this.padding;for(;S<I&&m<this._distances.length;)S=this._distances[++m];const L=m-1,$=this._distances[L],H=S-$,Q=H>0?(I-$)/H:0;return this.points[L].mult(1-Q).add(this.points[m].mult(Q))}}class $o{constructor(h,m,S){const I=this.boxCells=[],L=this.circleCells=[];this.xCellCount=Math.ceil(h/S),this.yCellCount=Math.ceil(m/S);for(let $=0;$<this.xCellCount*this.yCellCount;$++)I.push([]),L.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=m,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/m,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(h,m,S,I,L){this._forEachCell(m,S,I,L,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(m),this.bboxes.push(S),this.bboxes.push(I),this.bboxes.push(L)}insertCircle(h,m,S,I){this._forEachCell(m-I,S-I,m+I,S+I,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(m),this.circles.push(S),this.circles.push(I)}_insertBoxCell(h,m,S,I,L,$){this.boxCells[L].push($)}_insertCircleCell(h,m,S,I,L,$){this.circleCells[L].push($)}_query(h,m,S,I,L,$){if(S<0||h>this.width||I<0||m>this.height)return!L&&[];const H=[];if(h<=0&&m<=0&&this.width<=S&&this.height<=I){if(L)return!0;for(let Q=0;Q<this.boxKeys.length;Q++)H.push({key:this.boxKeys[Q],x1:this.bboxes[4*Q],y1:this.bboxes[4*Q+1],x2:this.bboxes[4*Q+2],y2:this.bboxes[4*Q+3]});for(let Q=0;Q<this.circleKeys.length;Q++){const ne=this.circles[3*Q],te=this.circles[3*Q+1],fe=this.circles[3*Q+2];H.push({key:this.circleKeys[Q],x1:ne-fe,y1:te-fe,x2:ne+fe,y2:te+fe})}return $?H.filter($):H}return this._forEachCell(h,m,S,I,this._queryCell,H,{hitTest:L,seenUids:{box:{},circle:{}}},$),L?H.length>0:H}_queryCircle(h,m,S,I,L){const $=h-S,H=h+S,Q=m-S,ne=m+S;if(H<0||$>this.width||ne<0||Q>this.height)return!I&&[];const te=[];return this._forEachCell($,Q,H,ne,this._queryCellCircle,te,{hitTest:I,circle:{x:h,y:m,radius:S},seenUids:{box:{},circle:{}}},L),I?te.length>0:te}query(h,m,S,I,L){return this._query(h,m,S,I,!1,L)}hitTest(h,m,S,I,L){return this._query(h,m,S,I,!0,L)}hitTestCircle(h,m,S,I){return this._queryCircle(h,m,S,!0,I)}_queryCell(h,m,S,I,L,$,H,Q){const ne=H.seenUids,te=this.boxCells[L];if(te!==null){const ve=this.bboxes;for(const Te of te)if(!ne.box[Te]){ne.box[Te]=!0;const Ie=4*Te;if(h<=ve[Ie+2]&&m<=ve[Ie+3]&&S>=ve[Ie+0]&&I>=ve[Ie+1]&&(!Q||Q(this.boxKeys[Te]))){if(H.hitTest)return $.push(!0),!0;$.push({key:this.boxKeys[Te],x1:ve[Ie],y1:ve[Ie+1],x2:ve[Ie+2],y2:ve[Ie+3]})}}}const fe=this.circleCells[L];if(fe!==null){const ve=this.circles;for(const Te of fe)if(!ne.circle[Te]){ne.circle[Te]=!0;const Ie=3*Te;if(this._circleAndRectCollide(ve[Ie],ve[Ie+1],ve[Ie+2],h,m,S,I)&&(!Q||Q(this.circleKeys[Te]))){if(H.hitTest)return $.push(!0),!0;{const Pe=ve[Ie],Re=ve[Ie+1],he=ve[Ie+2];$.push({key:this.circleKeys[Te],x1:Pe-he,y1:Re-he,x2:Pe+he,y2:Re+he})}}}}}_queryCellCircle(h,m,S,I,L,$,H,Q){const ne=H.circle,te=H.seenUids,fe=this.boxCells[L];if(fe!==null){const Te=this.bboxes;for(const Ie of fe)if(!te.box[Ie]){te.box[Ie]=!0;const Pe=4*Ie;if(this._circleAndRectCollide(ne.x,ne.y,ne.radius,Te[Pe+0],Te[Pe+1],Te[Pe+2],Te[Pe+3])&&(!Q||Q(this.boxKeys[Ie])))return $.push(!0),!0}}const ve=this.circleCells[L];if(ve!==null){const Te=this.circles;for(const Ie of ve)if(!te.circle[Ie]){te.circle[Ie]=!0;const Pe=3*Ie;if(this._circlesCollide(Te[Pe],Te[Pe+1],Te[Pe+2],ne.x,ne.y,ne.radius)&&(!Q||Q(this.circleKeys[Ie])))return $.push(!0),!0}}}_forEachCell(h,m,S,I,L,$,H,Q){const ne=this._convertToXCellCoord(h),te=this._convertToYCellCoord(m),fe=this._convertToXCellCoord(S),ve=this._convertToYCellCoord(I);for(let Te=ne;Te<=fe;Te++)for(let Ie=te;Ie<=ve;Ie++)if(L.call(this,h,m,S,I,this.xCellCount*Ie+Te,$,H,Q))return}_convertToXCellCoord(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))}_convertToYCellCoord(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))}_circlesCollide(h,m,S,I,L,$){const H=I-h,Q=L-m,ne=S+$;return ne*ne>H*H+Q*Q}_circleAndRectCollide(h,m,S,I,L,$,H){const Q=($-I)/2,ne=Math.abs(h-(I+Q));if(ne>Q+S)return!1;const te=(H-L)/2,fe=Math.abs(m-(L+te));if(fe>te+S)return!1;if(ne<=Q||fe<=te)return!0;const ve=ne-Q,Te=fe-te;return ve*ve+Te*Te<=S*S}}const Hn={unknown:0,flipRequired:1,flipNotRequired:2},Ke=Math.tan(85*Math.PI/180);function gt(v,h,m,S,I,L,$){const H=s.create();if(m)if(L.name==="globe"){const Q=s.calculateGlobeLabelMatrix(I,h);s.multiply(H,H,Q)}else{const Q=re([],$);H[0]=Q[0],H[1]=Q[1],H[4]=Q[2],H[5]=Q[3],S||s.rotateZ(H,H,I.angle)}else s.multiply(H,I.labelPlaneMatrix,v);return H}function za(v,h,m,S,I,L,$){const H=gt(v,h,m,S,I,L,$);return L.name==="globe"&&m||(H[2]=H[6]=H[10]=H[14]=0),H}function Vi(v,h,m,S,I,L,$){if(m){if(L.name==="globe"){const H=gt(v,h,m,S,I,L,$);return s.invert(H,H),s.multiply(H,v,H),H}{const H=s.clone(v),Q=s.identity([]);return Q[0]=$[0],Q[1]=$[1],Q[4]=$[2],Q[5]=$[3],s.multiply(H,H,Q),S||s.rotateZ(H,H,-I.angle),H}}return I.glCoordMatrix}function gi(v,h,m,S){const I=[v,h,m,1];m?s.transformMat4$1(I,I,S):xr(I,I,S);const L=I[3];return I[0]/=L,I[1]/=L,I[2]/=L,I}function Nf(v,h){return Math.min(.5+v/h*.5,1.5)}function fa(v,h){const m=v[0]/v[3],S=v[1]/v[3];return m>=-h[0]&&m<=h[0]&&S>=-h[1]&&S<=h[1]}function Ve(v,h,m,S,I,L,$,H,Q,ne){const te=m.transform,fe=S?v.textSizeData:v.iconSizeData,ve=s.evaluateSizeForZoom(fe,m.transform.zoom),Te=te.projection.name==="globe",Ie=[256/m.width*2+1,256/m.height*2+1],Pe=S?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;Pe.clear();let Re=null;Te&&(Re=S?v.text.globeExtVertexArray:v.icon.globeExtVertexArray);const he=v.lineVertexArray,Se=S?v.text.placedSymbolArray:v.icon.placedSymbolArray,Fe=m.transform.width/m.transform.height;let ke,Qe=!1;for(let et=0;et<Se.length;et++){const Je=Se.get(et),{numGlyphs:lt,writingMode:at}=Je;if(at!==s.WritingMode.vertical||Qe||ke===s.WritingMode.horizontal||(Qe=!0),ke=at,(Je.hidden||at===s.WritingMode.vertical)&&!Qe){Rs(lt,Pe);continue}Qe=!1;const xt=new s.Point(Je.tileAnchorX,Je.tileAnchorY);let{x:en,y:At,z:Ut}=te.projection.projectTilePoint(xt.x,xt.y,ne.canonical);if(Q){const[hr,kn,er]=Q(xt);en+=hr,At+=kn,Ut+=er}const St=[en,At,Ut,1];if(s.transformMat4$1(St,St,h),!fa(St,Ie)){Rs(lt,Pe);continue}const Kt=Nf(m.transform.cameraToCenterDistance,St[3]),vt=s.evaluateSizeForFeature(fe,ve,Je),zt=$?vt/Kt:vt*Kt,nn=gi(en,At,Ut,I);if(nn[3]<=0){Rs(lt,Pe);continue}let Ht={};const an=$?null:Q,Wn=_n(Je,zt,!1,H,h,I,L,v.glyphOffsetArray,he,Pe,Re,nn,xt,Ht,Fe,an,te.projection,ne,$);Qe=Wn.useVertical,an&&Wn.needsFlipping&&(Ht={}),(Wn.notEnoughRoom||Qe||Wn.needsFlipping&&_n(Je,zt,!0,H,h,I,L,v.glyphOffsetArray,he,Pe,Re,nn,xt,Ht,Fe,an,te.projection,ne,$).notEnoughRoom)&&Rs(lt,Pe)}S?(v.text.dynamicLayoutVertexBuffer.updateData(Pe),Re&&v.text.globeExtVertexBuffer.updateData(Re)):(v.icon.dynamicLayoutVertexBuffer.updateData(Pe),Re&&v.icon.globeExtVertexBuffer.updateData(Re))}function $h(v,h,m,S,I,L,$,H,Q,ne,te,fe,ve,Te,Ie,Pe){const{lineStartIndex:Re,glyphStartIndex:he,segment:Se}=H,Fe=he+H.numGlyphs,ke=Re+H.lineLength,Qe=h.getoffsetX(he),et=h.getoffsetX(Fe-1),Je=Os(v*Qe,m,S,I,L,$,Se,Re,ke,Q,ne,te,fe,ve,!0,Te,Ie,Pe);if(!Je)return null;const lt=Os(v*et,m,S,I,L,$,Se,Re,ke,Q,ne,te,fe,ve,!0,Te,Ie,Pe);return lt?{first:Je,last:lt}:null}function cu(v,h,m,S){return v===s.WritingMode.horizontal&&Math.abs(S)>Math.abs(m)?{useVertical:!0}:v===s.WritingMode.vertical?S>0?{needsFlipping:!0}:null:h!==Hn.unknown&&function(I,L){return I===0||Math.abs(L/I)>Ke}(m,S)?h===Hn.flipRequired?{needsFlipping:!0}:null:m<0?{needsFlipping:!0}:null}function _n(v,h,m,S,I,L,$,H,Q,ne,te,fe,ve,Te,Ie,Pe,Re,he,Se){const Fe=h/24,ke=v.lineOffsetX*Fe,Qe=v.lineOffsetY*Fe,{lineStartIndex:et,glyphStartIndex:Je,numGlyphs:lt,segment:at,writingMode:xt,flipState:en}=v,At=et+v.lineLength,Ut=St=>{if(te){const[nn,Ht,an]=St.up,Wn=ne.length;s.updateGlobeVertexNormal(te,Wn+0,nn,Ht,an),s.updateGlobeVertexNormal(te,Wn+1,nn,Ht,an),s.updateGlobeVertexNormal(te,Wn+2,nn,Ht,an),s.updateGlobeVertexNormal(te,Wn+3,nn,Ht,an)}const[Kt,vt,zt]=St.point;s.addDynamicAttributes(ne,Kt,vt,zt,St.angle)};if(lt>1){const St=$h(Fe,H,ke,Qe,m,fe,ve,v,Q,L,Te,Pe,!1,Re,he,Se);if(!St)return{notEnoughRoom:!0};if(S&&!m){let[Kt,vt,zt]=St.first.point,[nn,Ht,an]=St.last.point;[Kt,vt]=gi(Kt,vt,zt,$),[nn,Ht]=gi(nn,Ht,an,$);const Wn=cu(xt,en,(nn-Kt)*Ie,Ht-vt);if(v.flipState=Wn&&Wn.needsFlipping?Hn.flipRequired:Hn.flipNotRequired,Wn)return Wn}Ut(St.first);for(let Kt=Je+1;Kt<Je+lt-1;Kt++){const vt=Os(Fe*H.getoffsetX(Kt),ke,Qe,m,fe,ve,at,et,At,Q,L,Te,Pe,!1,!1,Re,he,Se);if(!vt)return ne.length-=4*(Kt-Je),{notEnoughRoom:!0};Ut(vt)}Ut(St.last)}else{if(S&&!m){const Kt=gi(ve.x,ve.y,0,I),vt=et+at+1,zt=new s.Point(Q.getx(vt),Q.gety(vt)),nn=gi(zt.x,zt.y,0,I),Ht=nn[3]>0?nn:Cr(ve,zt,Kt,1,I,void 0,Re,he.canonical),an=cu(xt,en,(Ht[0]-Kt[0])*Ie,Ht[1]-Kt[1]);if(v.flipState=an&&an.needsFlipping?Hn.flipRequired:Hn.flipNotRequired,an)return an}const St=Os(Fe*H.getoffsetX(Je),ke,Qe,m,fe,ve,at,et,At,Q,L,Te,Pe,!1,!1,Re,he,Se);if(!St)return{notEnoughRoom:!0};Ut(St)}return{}}function ur(v,h,m,S,I){const{x:L,y:$,z:H}=S.projectTilePoint(v.x,v.y,h);if(!I)return gi(L,$,H,m);const[Q,ne,te]=I(v);return gi(L+Q,$+ne,H+te,m)}function Cr(v,h,m,S,I,L,$,H){const Q=ur(v.sub(h)._unit()._add(v),H,I,$,L);return s.sub(Q,m,Q),s.normalize(Q,Q),s.scaleAndAdd(Q,m,Q,S)}function Os(v,h,m,S,I,L,$,H,Q,ne,te,fe,ve,Te,Ie,Pe,Re,he){const Se=S?v-h:v+h;let Fe=Se>0?1:-1,ke=0;S&&(Fe*=-1,ke=Math.PI),Fe<0&&(ke+=Math.PI);let Qe=H+$+(Fe>0?0:1)|0,et=I,Je=I,lt=0,at=0;const xt=Math.abs(Se),en=[],At=[];let Ut=L,St=Ut;const Kt=()=>Cr(St,Ut,Je,xt-lt+1,te,ve,Pe,Re.canonical);for(;lt+at<=xt;){if(Qe+=Fe,Qe<H||Qe>=Q)return null;if(Je=et,St=Ut,en.push(Je),Te&&At.push(St),Ut=new s.Point(ne.getx(Qe),ne.gety(Qe)),et=fe[Qe],!et){const er=ur(Ut,Re.canonical,te,Pe,ve);et=er[3]>0?fe[Qe]=er:Kt()}lt+=at,at=s.distance(Je,et)}Ie&&ve&&(fe[Qe]&&(et=Kt(),at=s.distance(Je,et)),fe[Qe]=et);const vt=(xt-lt)/at,zt=Ut.sub(St)._mult(vt)._add(St),nn=s.sub([],et,Je),Ht=s.scaleAndAdd([],Je,nn,vt);let an=[0,0,1],Wn=nn[0],hr=nn[1];if(he&&(an=Pe.upVector(Re.canonical,zt.x,zt.y),an[0]!==0||an[1]!==0||an[2]!==1)){const er=[an[2],0,-an[0]],Fr=s.cross([],an,er);s.normalize(er,er),s.normalize(Fr,Fr),Wn=s.dot(nn,er),hr=s.dot(nn,Fr)}if(m){const er=s.cross([],an,nn);s.normalize(er,er),s.scaleAndAdd(Ht,Ht,er,m*Fe)}const kn=ke+Math.atan2(hr,Wn);return en.push(Ht),Te&&At.push(zt),{point:Ht,angle:kn,path:en,tilePath:At,up:an}}function Rs(v,h){const m=h.length,S=m+4*v;h.resize(S),h.float32.fill(-1/0,4*m,4*S)}function xr(v,h,m){const S=h[0],I=h[1];return v[0]=m[0]*S+m[4]*I+m[12],v[1]=m[1]*S+m[5]*I+m[13],v[3]=m[3]*S+m[7]*I+m[15],v}const ys=100;class Ls{constructor(h,m,S=new $o(h.width+200,h.height+200,25),I=new $o(h.width+200,h.height+200,25)){this.transform=h,this.grid=S,this.ignoredGrid=I,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+ys,this.screenBottomBoundary=h.height+ys,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200,this.fogState=m}placeCollisionBox(h,m,S,I,L,$,H,Q){let ne=S.projectedAnchorX,te=S.projectedAnchorY,fe=S.projectedAnchorZ;const ve=S.elevation,Te=S.tileID,Ie=h.getProjection();if(ve&&Te){const[et,Je,lt]=Ie.upVector(Te.canonical,S.tileAnchorX,S.tileAnchorY),at=Ie.upVectorScale(Te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;ne+=et*ve*at,te+=Je*ve*at,fe+=lt*ve*at}const Pe=this.projectAndGetPerspectiveRatio(H,ne,te,fe,S.tileID,Ie.name==="globe"||!!ve||this.transform.pitch>0,Ie),Re=$*Pe.perspectiveRatio,he=(S.x1*m+I.x-S.padding)*Re+Pe.point.x,Se=(S.y1*m+I.y-S.padding)*Re+Pe.point.y,Fe=(S.x2*m+I.x+S.padding)*Re+Pe.point.x,ke=(S.y2*m+I.y+S.padding)*Re+Pe.point.y,Qe=Pe.perspectiveRatio<=.55||Pe.occluded;return!this.isInsideGrid(he,Se,Fe,ke)||!L&&this.grid.hitTest(he,Se,Fe,ke,Q)||Qe?{box:[],offscreen:!1,occluded:Pe.occluded}:{box:[he,Se,Fe,ke],offscreen:this.isOffscreen(he,Se,Fe,ke),occluded:!1}}placeCollisionCircles(h,m,S,I,L,$,H,Q,ne,te,fe,ve,Te,Ie,Pe){const Re=[],he=this.transform.elevation,Se=h.getProjection(),Fe=he?he.getAtTileOffsetFunc(Pe,this.transform.center.lat,this.transform.worldSize,Se):null,ke=new s.Point(S.tileAnchorX,S.tileAnchorY);let{x:Qe,y:et,z:Je}=Se.projectTilePoint(ke.x,ke.y,Pe.canonical);if(Fe){const[zt,nn,Ht]=Fe(ke);Qe+=zt,et+=nn,Je+=Ht}const lt=Se.name==="globe",at=this.projectAndGetPerspectiveRatio(H,Qe,et,Je,Pe,lt||!!he||this.transform.pitch>0,Se),{perspectiveRatio:xt}=at,en=(fe?$/xt:$*xt)/s.ONE_EM,At=gi(Qe,et,Je,Q),Ut=at.signedDistanceFromCamera>0?$h(en,L,S.lineOffsetX*en,S.lineOffsetY*en,!1,At,ke,S,I,Q,{},he&&!fe?Fe:null,fe&&!!he,Se,Pe,fe):null;let St=!1,Kt=!1,vt=!0;if(Ut&&!at.occluded){const zt=.5*Te*xt+Ie,nn=new s.Point(-100,-100),Ht=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),an=new ka,{first:Wn,last:hr}=Ut,kn=Wn.path.length;let er=[];for(let Vn=kn-1;Vn>=1;Vn--)er.push(Wn.path[Vn]);for(let Vn=1;Vn<hr.path.length;Vn++)er.push(hr.path[Vn]);const Fr=2.5*zt;ne&&(er=er.map(([Vn,fi,bi],wi)=>(Fe&&!lt&&(bi=Fe(wi<kn-1?Wn.tilePath[kn-1-wi]:hr.tilePath[wi-kn+2])[2]),gi(Vn,fi,bi,ne))),er.some(Vn=>Vn[3]<=0)&&(er=[]));let Nr=[];if(er.length>0){let Vn=1/0,fi=-1/0,bi=1/0,wi=-1/0;for(const Ei of er)Vn=Math.min(Vn,Ei[0]),bi=Math.min(bi,Ei[1]),fi=Math.max(fi,Ei[0]),wi=Math.max(wi,Ei[1]);fi>=nn.x&&Vn<=Ht.x&&wi>=nn.y&&bi<=Ht.y&&(Nr=[er.map(Ei=>new s.Point(Ei[0],Ei[1]))],(Vn<nn.x||fi>Ht.x||bi<nn.y||wi>Ht.y)&&(Nr=s.clipLine(Nr,nn.x,nn.y,Ht.x,Ht.y)))}for(const Vn of Nr){an.reset(Vn,.25*zt);let fi=0;fi=an.length<=.5*zt?1:Math.ceil(an.paddedLength/Fr)+1;for(let bi=0;bi<fi;bi++){const wi=bi/Math.max(fi-1,1),Ei=an.lerp(wi),_a=Ei.x+ys,Ns=Ei.y+ys;Re.push(_a,Ns,zt,0);const pu=_a-zt,Wc=Ns-zt,io=_a+zt,Si=Ns+zt;if(vt=vt&&this.isOffscreen(pu,Wc,io,Si),Kt=Kt||this.isInsideGrid(pu,Wc,io,Si),!m&&this.grid.hitTestCircle(_a,Ns,zt,ve)&&(St=!0,!te))return{circles:[],offscreen:!1,collisionDetected:St,occluded:!1}}}}return{circles:!te&&St||!Kt?[]:Re,offscreen:vt,collisionDetected:St,occluded:at.occluded}}queryRenderedSymbols(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const m=[];let S=1/0,I=1/0,L=-1/0,$=-1/0;for(const te of h){const fe=new s.Point(te.x+ys,te.y+ys);S=Math.min(S,fe.x),I=Math.min(I,fe.y),L=Math.max(L,fe.x),$=Math.max($,fe.y),m.push(fe)}const H=this.grid.query(S,I,L,$).concat(this.ignoredGrid.query(S,I,L,$)),Q={},ne={};for(const te of H){const fe=te.key;if(Q[fe.bucketInstanceId]===void 0&&(Q[fe.bucketInstanceId]={}),Q[fe.bucketInstanceId][fe.featureIndex])continue;const ve=[new s.Point(te.x1,te.y1),new s.Point(te.x2,te.y1),new s.Point(te.x2,te.y2),new s.Point(te.x1,te.y2)];s.polygonIntersectsPolygon(m,ve)&&(Q[fe.bucketInstanceId][fe.featureIndex]=!0,ne[fe.bucketInstanceId]===void 0&&(ne[fe.bucketInstanceId]=[]),ne[fe.bucketInstanceId].push(fe.featureIndex))}return ne}insertCollisionBox(h,m,S,I,L){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:S,featureIndex:I,collisionGroupID:L},h[0],h[1],h[2],h[3])}insertCollisionCircles(h,m,S,I,L){const $=m?this.ignoredGrid:this.grid,H={bucketInstanceId:S,featureIndex:I,collisionGroupID:L};for(let Q=0;Q<h.length;Q+=4)$.insertCircle(H,h[Q],h[Q+1],h[Q+2])}projectAndGetPerspectiveRatio(h,m,S,I,L,$,H){const Q=[m,S,I,1];let ne=!1;I||this.transform.pitch>0?(s.transformMat4$1(Q,Q,h),this.fogState&&L&&H.name!=="globe"&&(ne=function(ve,Te,Ie,Pe,Re,he){const Se=he.calculateFogTileMatrix(Re),Fe=[Te,Ie,Pe];return s.transformMat4(Fe,Fe,Se),tt(ve,Fe,he.pitch,he._fov)}(this.fogState,m,S,I,L.toUnwrapped(),this.transform)>.9)):xr(Q,Q,h);const te=Q[3];return{point:new s.Point((Q[0]/te+1)/2*this.transform.width+ys,(-Q[1]/te+1)/2*this.transform.height+ys),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(H)/te*.5,1.5),signedDistanceFromCamera:te,occluded:$&&Q[2]>te||ne}}isOffscreen(h,m,S,I){return S<ys||h>=this.screenRightBoundary||I<ys||m>this.screenBottomBoundary}isInsideGrid(h,m,S,I){return S>=0&&h<this.gridRightBoundary&&I>=0&&m<this.gridBottomBoundary}getViewportMatrix(){const h=s.identity([]);return s.translate(h,h,[-100,-100,0]),h}}function ye(v,h,m){const S=h.createTileMatrix(v,v.worldSize,m.toUnwrapped());return s.multiply(new Float32Array(16),v.projMatrix,S)}function Oe(v,h,m){if(h.projection.name===m.projection.name)return v.projMatrix;const S=m.clone();return S.setProjection(h.projection),ye(S,h.getProjection(),v)}function He(v,h,m){return h.name===m.projection.name?v.projMatrix:ye(m,h,v)}class Ot{constructor(h,m,S,I){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?m:-m))):I&&S?1:0,this.placed=S}isHidden(){return this.opacity===0&&!this.placed}}class on{constructor(h,m,S,I,L,$=!1){this.text=new Ot(h?h.text:null,m,S,L),this.icon=new Ot(h?h.icon:null,m,I,L),this.clipped=$}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fn{constructor(h,m,S,I=!1){this.text=h,this.icon=m,this.skipFade=S,this.clipped=I}}class Rr{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Ao{constructor(h,m,S,I,L){this.bucketInstanceId=h,this.featureIndex=m,this.sourceLayerIndex=S,this.bucketIndex=I,this.tileID=L}}class Lr{constructor(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}}get(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){const m=++this.maxGroupID;this.collisionGroups[h]={ID:m,predicate:S=>S.collisionGroupID===m}}return this.collisionGroups[h]}}function ao(v,h,m,S,I){const{horizontalAlign:L,verticalAlign:$}=s.getAnchorAlignment(v),H=-(L-.5)*h,Q=-($-.5)*m,ne=s.evaluateVariableOffset(v,S);return new s.Point(H+ne[0]*I,Q+ne[1]*I)}function vs(v,h,m,S,I){const L=new s.Point(v,h);return m&&L._rotate(S?I:-I),L}class Ig{constructor(h,m,S,I,L){this.transform=h.clone(),this.projection=h.projection.name,this.collisionIndex=new Ls(this.transform,L),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Lr(S),this.collisionCircleArrays={},this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(h,m,S,I){const L=S.getBucket(m),$=S.latestFeatureIndex;if(!L||!$||m.id!==L.layerIds[0])return;const H=L.layers[0].layout,Q=S.collisionBoxArray,ne=Math.pow(2,this.transform.zoom-S.tileID.overscaledZ),te=S.tileSize/s.EXTENT,fe=S.tileID.toUnwrapped();this.transform.setProjection(L.projection);const ve=(Te=S.tileID,Ie=L.getProjection(),Pe=this.transform,Ie.name===this.projection?Pe.calculateProjMatrix(Te.toUnwrapped()):ye(Pe,Ie,Te));var Te,Ie,Pe;const Re=H.get("text-pitch-alignment")==="map",he=H.get("text-rotation-alignment")==="map";m.compileFilter();const Se=m.dynamicFilter(),Fe=m.dynamicFilterNeedsFeature(),ke=this.transform.calculatePixelsToTileUnitsMatrix(S),Qe=za(ve,S.tileID.canonical,Re,he,this.transform,L.getProjection(),ke);let et=null;if(Re){const at=Vi(ve,S.tileID.canonical,Re,he,this.transform,L.getProjection(),ke);et=s.multiply([],this.transform.labelPlaneMatrix,at)}let Je=null;Se&&S.latestFeatureIndex&&(Je={unwrappedTileID:fe,dynamicFilter:Se,dynamicFilterNeedsFeature:Fe,featureIndex:S.latestFeatureIndex}),this.retainedQueryData[L.bucketInstanceId]=new Ao(L.bucketInstanceId,$,L.sourceLayerIndex,L.index,S.tileID);const lt={bucket:L,layout:H,posMatrix:ve,textLabelPlaneMatrix:Qe,labelToScreenMatrix:et,clippingData:Je,scale:ne,textPixelRatio:te,holdingForFade:S.holdingForFade(),collisionBoxArray:Q,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(L.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(L.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(L.sourceID)};if(I)for(const at of L.sortKeyRanges){const{sortKey:xt,symbolInstanceStart:en,symbolInstanceEnd:At}=at;h.push({sortKey:xt,symbolInstanceStart:en,symbolInstanceEnd:At,parameters:lt})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:L.symbolInstances.length,parameters:lt})}attemptAnchorPlacement(h,m,S,I,L,$,H,Q,ne,te,fe,ve,Te,Ie,Pe,Re,he,Se){const{textOffset0:Fe,textOffset1:ke,crossTileID:Qe}=ve,et=[Fe,ke],Je=ao(h,S,I,et,L),lt=this.collisionIndex.placeCollisionBox(Ie,L,m,vs(Je.x,Je.y,$,H,this.transform.angle),fe,Q,ne,te.predicate);if(Re){const at=Ie.getSymbolInstanceIconSize(Se,this.transform.zoom,ve.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Ie,at,Re,vs(Je.x,Je.y,$,H,this.transform.angle),fe,Q,ne,te.predicate).box.length===0)return}if(lt.box.length>0){let at;return this.prevPlacement&&this.prevPlacement.variableOffsets[Qe]&&this.prevPlacement.placements[Qe]&&this.prevPlacement.placements[Qe].text&&(at=this.prevPlacement.variableOffsets[Qe].anchor),this.variableOffsets[Qe]={textOffset:et,width:S,height:I,anchor:h,textScale:L,prevAnchor:at},this.markUsedJustification(Ie,h,ve,Pe),Ie.allowVerticalPlacement&&(this.markUsedOrientation(Ie,Pe,ve),this.placedOrientations[Qe]=Pe),{shift:Je,placedGlyphBoxes:lt}}}placeLayerBucketPart(h,m,S,I){const{bucket:L,layout:$,posMatrix:H,textLabelPlaneMatrix:Q,labelToScreenMatrix:ne,clippingData:te,textPixelRatio:fe,holdingForFade:ve,collisionBoxArray:Te,partiallyEvaluatedTextSize:Ie,partiallyEvaluatedIconSize:Pe,collisionGroup:Re}=h.parameters,he=$.get("text-optional"),Se=$.get("icon-optional"),Fe=$.get("text-allow-overlap"),ke=$.get("icon-allow-overlap"),Qe=$.get("text-rotation-alignment")==="map",et=$.get("text-pitch-alignment")==="map",Je=$.get("icon-text-fit")!=="none",lt=$.get("symbol-z-order")==="viewport-y";this.transform.setProjection(L.projection);let at=Fe&&(ke||!L.hasIconData()||Se),xt=ke&&(Fe||!L.hasTextData()||he);!L.collisionArrays&&Te&&L.deserializeCollisionBoxes(Te),S&&I&&L.updateCollisionDebugBuffers(this.transform.zoom,Te);const en=(At,Ut,St)=>{const{crossTileID:Kt,numVerticalGlyphVertices:vt}=At;if(te){const io={zoom:this.transform.zoom,pitch:this.transform.pitch};let Si=null;if(te.dynamicFilterNeedsFeature){const ni=this.retainedQueryData[L.bucketInstanceId];Si=te.featureIndex.loadFeature({featureIndex:At.featureIndex,bucketIndex:ni.bucketIndex,sourceLayerIndex:ni.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,te.dynamicFilter)(io,Si,this.retainedQueryData[L.bucketInstanceId].tileID.canonical,new s.Point(At.tileAnchorX,At.tileAnchorY),this.transform.calculateDistanceTileData(te.unwrappedTileID)))return this.placements[Kt]=new Fn(!1,!1,!1,!0),void m.add(Kt)}if(m.has(Kt))return;if(ve)return void(this.placements[Kt]=new Fn(!1,!1,!1));let zt=!1,nn=!1,Ht=!0,an=!1,Wn=!1,hr=null,kn={box:null,offscreen:null,occluded:null},er={box:null,offscreen:null,occluded:null},Fr=null,Nr=null,Vn=null,fi=0,bi=0,wi=0;St.textFeatureIndex?fi=St.textFeatureIndex:At.useRuntimeCollisionCircles&&(fi=At.featureIndex),St.verticalTextFeatureIndex&&(bi=St.verticalTextFeatureIndex);const Ei=io=>{io.tileID=this.retainedQueryData[L.bucketInstanceId].tileID;const Si=this.transform.elevation;(Si||io.elevation)&&(io.elevation=Si?Si.getAtTileOffset(io.tileID,io.tileAnchorX,io.tileAnchorY):0)},_a=St.textBox;if(_a){Ei(_a);const io=ni=>{let Ho=s.WritingMode.horizontal;if(L.allowVerticalPlacement&&!ni&&this.prevPlacement){const ja=this.prevPlacement.placedOrientations[Kt];ja&&(this.placedOrientations[Kt]=ja,Ho=ja,this.markUsedOrientation(L,Ho,At))}return Ho},Si=(ni,Ho)=>{if(L.allowVerticalPlacement&&vt>0&&St.verticalTextBox){for(const ja of L.writingModes)if(ja===s.WritingMode.vertical?(kn=Ho(),er=kn):kn=ni(),kn&&kn.box&&kn.box.length)break}else kn=ni()};if($.get("text-variable-anchor")){let ni=$.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Kt]){const Yi=this.prevPlacement.variableOffsets[Kt];ni.indexOf(Yi.anchor)>0&&(ni=ni.filter(ll=>ll!==Yi.anchor),ni.unshift(Yi.anchor))}const Ho=(Yi,ll,G_)=>{const Ip=L.getSymbolInstanceTextSize(Ie,At,this.transform.zoom,Ut),$A=(Yi.x2-Yi.x1)*Ip+2*Yi.padding,qf=(Yi.y2-Yi.y1)*Ip+2*Yi.padding,nd=Je&&!ke?ll:null;nd&&Ei(nd);let Mp={box:[],offscreen:!1,occluded:!1};const j_=Fe?2*ni.length:ni.length;for(let HA=0;HA<j_;++HA){const px=this.attemptAnchorPlacement(ni[HA%ni.length],Yi,$A,qf,Ip,Qe,et,fe,H,Re,HA>=ni.length,At,Ut,L,G_,nd,Ie,Pe);if(px&&(Mp=px.placedGlyphBoxes,Mp&&Mp.box&&Mp.box.length)){zt=!0,hr=px.shift;break}}return Mp};Si(()=>Ho(_a,St.iconBox,s.WritingMode.horizontal),()=>{const Yi=St.verticalTextBox;return Yi&&Ei(Yi),L.allowVerticalPlacement&&!(kn&&kn.box&&kn.box.length)&&vt>0&&Yi?Ho(Yi,St.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),kn&&(zt=kn.box,Ht=kn.offscreen,an=kn.occluded);const ja=io(!(!kn||!kn.box));if(!zt&&this.prevPlacement){const Yi=this.prevPlacement.variableOffsets[Kt];Yi&&(this.variableOffsets[Kt]=Yi,this.markUsedJustification(L,Yi.anchor,At,ja))}}else{const ni=(Ho,ja)=>{const Yi=L.getSymbolInstanceTextSize(Ie,At,this.transform.zoom,Ut),ll=this.collisionIndex.placeCollisionBox(L,Yi,Ho,new s.Point(0,0),Fe,fe,H,Re.predicate);return ll&&ll.box&&ll.box.length&&(this.markUsedOrientation(L,ja,At),this.placedOrientations[Kt]=ja),ll};Si(()=>ni(_a,s.WritingMode.horizontal),()=>{const Ho=St.verticalTextBox;return L.allowVerticalPlacement&&vt>0&&Ho?(Ei(Ho),ni(Ho,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),io(!!(kn&&kn.box&&kn.box.length))}}if(Fr=kn,zt=Fr&&Fr.box&&Fr.box.length>0,Ht=Fr&&Fr.offscreen,an=Fr&&Fr.occluded,At.useRuntimeCollisionCircles){const io=L.text.placedSymbolArray.get(At.centerJustifiedTextSymbolIndex>=0?At.centerJustifiedTextSymbolIndex:At.verticalPlacedTextSymbolIndex),Si=s.evaluateSizeForFeature(L.textSizeData,Ie,io),ni=$.get("text-padding");Nr=this.collisionIndex.placeCollisionCircles(L,Fe,io,L.lineVertexArray,L.glyphOffsetArray,Si,H,Q,ne,S,et,Re.predicate,At.collisionCircleDiameter*Si/s.ONE_EM,ni,this.retainedQueryData[L.bucketInstanceId].tileID),zt=Fe||Nr.circles.length>0&&!Nr.collisionDetected,Ht=Ht&&Nr.offscreen,an=Nr.occluded}if(St.iconFeatureIndex&&(wi=St.iconFeatureIndex),St.iconBox){const io=Si=>{Ei(Si);const ni=Je&&hr?vs(hr.x,hr.y,Qe,et,this.transform.angle):new s.Point(0,0),Ho=L.getSymbolInstanceIconSize(Pe,this.transform.zoom,At.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(L,Ho,Si,ni,ke,fe,H,Re.predicate)};er&&er.box&&er.box.length&&St.verticalIconBox?(Vn=io(St.verticalIconBox),nn=Vn.box.length>0):(Vn=io(St.iconBox),nn=Vn.box.length>0),Ht=Ht&&Vn.offscreen,Wn=Vn.occluded}const Ns=he||At.numHorizontalGlyphVertices===0&&vt===0,pu=Se||At.numIconVertices===0;if(Ns||pu?pu?Ns||(nn=nn&&zt):zt=nn&&zt:nn=zt=nn&&zt,zt&&Fr&&Fr.box&&this.collisionIndex.insertCollisionBox(Fr.box,$.get("text-ignore-placement"),L.bucketInstanceId,er&&er.box&&bi?bi:fi,Re.ID),nn&&Vn&&this.collisionIndex.insertCollisionBox(Vn.box,$.get("icon-ignore-placement"),L.bucketInstanceId,wi,Re.ID),Nr&&(zt&&this.collisionIndex.insertCollisionCircles(Nr.circles,$.get("text-ignore-placement"),L.bucketInstanceId,fi,Re.ID),S)){const io=L.bucketInstanceId;let Si=this.collisionCircleArrays[io];Si===void 0&&(Si=this.collisionCircleArrays[io]=new Rr);for(let ni=0;ni<Nr.circles.length;ni+=4)Si.circles.push(Nr.circles[ni+0]),Si.circles.push(Nr.circles[ni+1]),Si.circles.push(Nr.circles[ni+2]),Si.circles.push(Nr.collisionDetected?1:0)}const Wc=L.projection.name!=="globe";at=at&&(Wc||!an),xt=xt&&(Wc||!Wn),this.placements[Kt]=new Fn(zt||at,nn||xt,Ht||L.justReloaded),m.add(Kt)};if(lt){const At=L.getSortedSymbolIndexes(this.transform.angle);for(let Ut=At.length-1;Ut>=0;--Ut){const St=At[Ut];en(L.symbolInstances.get(St),St,L.collisionArrays[St])}}else for(let At=h.symbolInstanceStart;At<h.symbolInstanceEnd;At++)en(L.symbolInstances.get(At),At,L.collisionArrays[At]);if(S&&L.bucketInstanceId in this.collisionCircleArrays){const At=this.collisionCircleArrays[L.bucketInstanceId];s.invert(At.invProjMatrix,H),At.viewportMatrix=this.collisionIndex.getViewportMatrix()}L.justReloaded=!1}markUsedJustification(h,m,S,I){const{leftJustifiedTextSymbolIndex:L,centerJustifiedTextSymbolIndex:$,rightJustifiedTextSymbolIndex:H,verticalPlacedTextSymbolIndex:Q,crossTileID:ne}=S,te=s.getAnchorJustification(m),fe=I===s.WritingMode.vertical?Q:te==="left"?L:te==="center"?$:te==="right"?H:-1;L>=0&&(h.text.placedSymbolArray.get(L).crossTileID=fe>=0&&L!==fe?0:ne),$>=0&&(h.text.placedSymbolArray.get($).crossTileID=fe>=0&&$!==fe?0:ne),H>=0&&(h.text.placedSymbolArray.get(H).crossTileID=fe>=0&&H!==fe?0:ne),Q>=0&&(h.text.placedSymbolArray.get(Q).crossTileID=fe>=0&&Q!==fe?0:ne)}markUsedOrientation(h,m,S){const I=m===s.WritingMode.horizontal||m===s.WritingMode.horizontalOnly?m:0,L=m===s.WritingMode.vertical?m:0,{leftJustifiedTextSymbolIndex:$,centerJustifiedTextSymbolIndex:H,rightJustifiedTextSymbolIndex:Q,verticalPlacedTextSymbolIndex:ne}=S,te=h.text.placedSymbolArray;$>=0&&(te.get($).placedOrientation=I),H>=0&&(te.get(H).placedOrientation=I),Q>=0&&(te.get(Q).placedOrientation=I),ne>=0&&(te.get(ne).placedOrientation=L)}commit(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;const m=this.prevPlacement;let S=!1;this.prevZoomAdjustment=m?m.zoomAdjustment(this.transform.zoom):0;const I=m?m.symbolFadeChange(h):1,L=m?m.opacities:{},$=m?m.variableOffsets:{},H=m?m.placedOrientations:{};for(const Q in this.placements){const ne=this.placements[Q],te=L[Q];te?(this.opacities[Q]=new on(te,I,ne.text,ne.icon,null,ne.clipped),S=S||ne.text!==te.text.placed||ne.icon!==te.icon.placed):(this.opacities[Q]=new on(null,I,ne.text,ne.icon,ne.skipFade,ne.clipped),S=S||ne.text||ne.icon)}for(const Q in L){const ne=L[Q];if(!this.opacities[Q]){const te=new on(ne,I,!1,!1);te.isHidden()||(this.opacities[Q]=te,S=S||ne.text.placed||ne.icon.placed)}}for(const Q in $)this.variableOffsets[Q]||!this.opacities[Q]||this.opacities[Q].isHidden()||(this.variableOffsets[Q]=$[Q]);for(const Q in H)this.placedOrientations[Q]||!this.opacities[Q]||this.opacities[Q].isHidden()||(this.placedOrientations[Q]=H[Q]);S?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=m?m.lastPlacementChangeTime:h)}updateLayerOpacities(h,m){const S=new Set;for(const I of m){const L=I.getBucket(h);L&&I.latestFeatureIndex&&h.id===L.layerIds[0]&&this.updateBucketOpacities(L,S,I.collisionBoxArray)}}updateBucketOpacities(h,m,S){h.hasTextData()&&h.text.opacityVertexArray.clear(),h.hasIconData()&&h.icon.opacityVertexArray.clear(),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();const I=h.layers[0].layout,L=!!h.layers[0].dynamicFilter(),$=new on(null,0,!1,!1,!0),H=I.get("text-allow-overlap"),Q=I.get("icon-allow-overlap"),ne=I.get("text-variable-anchor"),te=I.get("text-rotation-alignment")==="map",fe=I.get("text-pitch-alignment")==="map",ve=I.get("icon-text-fit")!=="none",Te=new on(null,0,H&&(Q||!h.hasIconData()||I.get("icon-optional")),Q&&(H||!h.hasTextData()||I.get("text-optional")),!0);!h.collisionArrays&&S&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(S);const Ie=(Re,he,Se)=>{for(let Fe=0;Fe<he/4;Fe++)Re.opacityVertexArray.emplaceBack(Se)};let Pe=0;for(let Re=0;Re<h.symbolInstances.length;Re++){const he=h.symbolInstances.get(Re),{numHorizontalGlyphVertices:Se,numVerticalGlyphVertices:Fe,crossTileID:ke,numIconVertices:Qe}=he,et=m.has(ke);let Je=this.opacities[ke];et?Je=$:Je||(Je=Te,this.opacities[ke]=Je),m.add(ke);const lt=Se>0||Fe>0,at=Qe>0,xt=this.placedOrientations[ke],en=xt===s.WritingMode.vertical,At=xt===s.WritingMode.horizontal||xt===s.WritingMode.horizontalOnly;if(!lt&&!at||Je.isHidden()||Pe++,lt){const Ut=Wh(Je.text);Ie(h.text,Se,en?Xi:Ut),Ie(h.text,Fe,At?Xi:Ut);const St=Je.text.isHidden(),{leftJustifiedTextSymbolIndex:Kt,centerJustifiedTextSymbolIndex:vt,rightJustifiedTextSymbolIndex:zt,verticalPlacedTextSymbolIndex:nn}=he,Ht=h.text.placedSymbolArray,an=St||en?1:0;Kt>=0&&(Ht.get(Kt).hidden=an),vt>=0&&(Ht.get(vt).hidden=an),zt>=0&&(Ht.get(zt).hidden=an),nn>=0&&(Ht.get(nn).hidden=St||At?1:0);const Wn=this.variableOffsets[ke];Wn&&this.markUsedJustification(h,Wn.anchor,he,xt);const hr=this.placedOrientations[ke];hr&&(this.markUsedJustification(h,"left",he,hr),this.markUsedOrientation(h,hr,he))}if(at){const Ut=Wh(Je.icon),{placedIconSymbolIndex:St,verticalPlacedIconSymbolIndex:Kt}=he,vt=h.icon.placedSymbolArray,zt=Je.icon.isHidden()?1:0;St>=0&&(Ie(h.icon,Qe,en?Xi:Ut),vt.get(St).hidden=zt),Kt>=0&&(Ie(h.icon,he.numVerticalIconVertices,At?Xi:Ut),vt.get(Kt).hidden=zt)}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){const Ut=h.collisionArrays[Re];if(Ut){let St=new s.Point(0,0),Kt=!0;if(Ut.textBox||Ut.verticalTextBox){if(ne){const zt=this.variableOffsets[ke];zt?(St=ao(zt.anchor,zt.width,zt.height,zt.textOffset,zt.textScale),te&&St._rotate(fe?this.transform.angle:-this.transform.angle)):Kt=!1}L&&(Kt=!Je.clipped),Ut.textBox&&Hh(h.textCollisionBox.collisionVertexArray,Je.text.placed,!Kt||en,St.x,St.y),Ut.verticalTextBox&&Hh(h.textCollisionBox.collisionVertexArray,Je.text.placed,!Kt||At,St.x,St.y)}const vt=Kt&&!!(!At&&Ut.verticalIconBox);Ut.iconBox&&Hh(h.iconCollisionBox.collisionVertexArray,Je.icon.placed,vt,ve?St.x:0,ve?St.y:0),Ut.verticalIconBox&&Hh(h.iconCollisionBox.collisionVertexArray,Je.icon.placed,!vt,ve?St.x:0,ve?St.y:0)}}}if(h.fullyClipped=Pe===0,h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=Re.invProjMatrix,h.placementViewportMatrix=Re.viewportMatrix,h.collisionCircleArray=Re.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}}symbolFadeChange(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(h){return Math.max(0,(this.transform.zoom-h)/1.5)}hasTransitions(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(h,m){const S=this.zoomAtLastRecencyCheck===m?1-this.zoomAdjustment(m):1;return this.zoomAtLastRecencyCheck=m,this.commitTime+this.fadeDuration*S>h}setStale(){this.stale=!0}}function Hh(v,h,m,S,I){v.emplaceBack(h?1:0,m?1:0,S||0,I||0),v.emplaceBack(h?1:0,m?1:0,S||0,I||0),v.emplaceBack(h?1:0,m?1:0,S||0,I||0),v.emplaceBack(h?1:0,m?1:0,S||0,I||0)}const ha=Math.pow(2,25),lo=Math.pow(2,24),op=Math.pow(2,17),sp=Math.pow(2,16),da=Math.pow(2,9),il=Math.pow(2,8),EA=Math.pow(2,1);function Wh(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const h=v.placed?1:0,m=Math.floor(127*v.opacity);return m*ha+h*lo+m*op+h*sp+m*da+h*il+m*EA+h}const Xi=0;class ap{constructor(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&h.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(h,m,S,I,L){const $=this._bucketParts;for(;this._currentTileIndex<h.length;)if(m.getBucketParts($,I,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,L())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,$.sort((H,Q)=>H.sortKey-Q.sortKey));this._currentPartIndex<$.length;){const H=$[this._currentPartIndex];if(m.placeLayerBucketPart(H,this._seenCrossTileIDs,S,H.symbolInstanceStart===0),this._currentPartIndex++,L())return!0}return!1}}class SA{constructor(h,m,S,I,L,$,H,Q){this.placement=new Ig(h,L,$,H,Q),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=S,this._showCollisionBoxes=I,this._done=!1}isDone(){return this._done}continuePlacement(h,m,S){const I=s.exported.now(),L=()=>{const $=s.exported.now()-I;return!this._forceFullPlacement&&$>2};for(;this._currentPlacementIndex>=0;){const $=m[h[this._currentPlacementIndex]],H=this.placement.collisionIndex.transform.zoom;if($.type==="symbol"&&(!$.minzoom||$.minzoom<=H)&&(!$.maxzoom||$.maxzoom>H)){if(this._inProgressLayer||(this._inProgressLayer=new ap($)),this._inProgressLayer.continuePlacement(S[$.source],this.placement,this._showCollisionBoxes,$,L))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(h){return this.placement.commit(h),this.placement}}const Ff=512/s.EXTENT/2;class li{constructor(h,m,S){this.tileID=h,this.bucketInstanceId=S,this.index=new s.KDBush(m.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const I=h.canonical.x*s.EXTENT,L=h.canonical.y*s.EXTENT;for(let $=0;$<m.length;$++){const{key:H,crossTileID:Q,tileAnchorX:ne,tileAnchorY:te}=m.get($),fe=Math.floor((I+ne)*Ff),ve=Math.floor((L+te)*Ff);this.index.add(fe,ve),this.keys.push(H),this.crossTileIDs.push(Q)}this.index.finish()}findMatches(h,m,S){const I=this.tileID.canonical.z<m.canonical.z?1:Math.pow(2,this.tileID.canonical.z-m.canonical.z),L=Ff/Math.pow(2,m.canonical.z-this.tileID.canonical.z),$=m.canonical.x*s.EXTENT,H=m.canonical.y*s.EXTENT;for(let Q=0;Q<h.length;Q++){const ne=h.get(Q);if(ne.crossTileID)continue;const{key:te,tileAnchorX:fe,tileAnchorY:ve}=ne,Te=Math.floor(($+fe)*L),Ie=Math.floor((H+ve)*L),Pe=this.index.range(Te-I,Ie-I,Te+I,Ie+I);for(const Re of Pe){const he=this.crossTileIDs[Re];if(this.keys[Re]===te&&!S.has(he)){S.add(he),ne.crossTileID=he;break}}}}}class qu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class xs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(h){const m=Math.round((h-this.lng)/360);if(m!==0)for(const S in this.indexes){const I=this.indexes[S],L={};for(const $ in I){const H=I[$];H.tileID=H.tileID.unwrapTo(H.tileID.wrap+m),L[H.tileID.key]=H}this.indexes[S]=L}this.lng=h}addBucket(h,m,S){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===m.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(let L=0;L<m.symbolInstances.length;L++)m.symbolInstances.get(L).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]=new Set);const I=this.usedCrossTileIDs[h.overscaledZ];for(const L in this.indexes){const $=this.indexes[L];if(Number(L)>h.overscaledZ)for(const H in $){const Q=$[H];Q.tileID.isChildOf(h)&&Q.findMatches(m.symbolInstances,h,I)}else{const H=$[h.scaledTo(Number(L)).key];H&&H.findMatches(m.symbolInstances,h,I)}}for(let L=0;L<m.symbolInstances.length;L++){const $=m.symbolInstances.get(L);$.crossTileID||($.crossTileID=S.generate(),I.add($.crossTileID))}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new li(h,m.symbolInstances,m.bucketInstanceId),!0}removeBucketCrossTileIDs(h,m){for(const S of m.crossTileIDs)this.usedCrossTileIDs[h].delete(S)}removeStaleBuckets(h){let m=!1;for(const S in this.indexes){const I=this.indexes[S];for(const L in I)h[I[L].bucketInstanceId]||(this.removeBucketCrossTileIDs(S,I[L]),delete I[L],m=!0)}return m}}class Ul{constructor(){this.layerIndexes={},this.crossTileIDs=new qu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(h,m,S,I){let L=this.layerIndexes[h.id];L===void 0&&(L=this.layerIndexes[h.id]=new xs);let $=!1;const H={};I.name!=="globe"&&L.handleWrapJump(S);for(const Q of m){const ne=Q.getBucket(h);ne&&h.id===ne.layerIds[0]&&(ne.bucketInstanceId||(ne.bucketInstanceId=++this.maxBucketInstanceId),L.addBucket(Q.tileID,ne,this.crossTileIDs)&&($=!0),H[ne.bucketInstanceId]=!0)}return L.removeStaleBuckets(H)&&($=!0),$}pruneUnusedLayers(h){const m={};h.forEach(S=>{m[S]=!0});for(const S in this.layerIndexes)m[S]||delete this.layerIndexes[S]}}const Xu=(v,h)=>s.emitValidationErrors(v,h&&h.filter(m=>m.identifier!=="source.canvas")),kf=s.pick(jn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),T_=s.pick(jn,["setCenter","setZoom","setBearing","setPitch"]),lp={version:8,layers:[],sources:{}},Zu={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ds extends s.Evented{constructor(h,m={}){super(),this.map=h,this.dispatcher=new Be(Tr(),this),this.imageManager=new se,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(h._requestManager,m.localFontFamily?s.LocalGlyphMode.all:m.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,m.localFontFamily||m.localIdeographFontFamily),this.crossTileSymbolIndex=new Ul,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const S=this;this._rtlTextPluginCallback=Ds.registerForPluginStateChange(I=>{S.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:I.pluginStatus,pluginURL:I.pluginURL},(L,$)=>{if(s.triggerPluginCompletionEvent(L),$&&$.every(H=>H))for(const H in S._sourceCaches){const Q=S._sourceCaches[H],ne=Q.getSource().type;ne!=="vector"&&ne!=="geojson"||Q.reload()}})}),this.on("data",I=>{if(I.dataType!=="source"||I.sourceDataType!=="metadata")return;const L=this.getSource(I.sourceId);if(L&&L.vectorLayerIds)for(const $ in this._layers){const H=this._layers[$];H.source===L.id&&this._validateLayer(H)}})}loadURL(h,m={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const S=typeof m.validate=="boolean"?m.validate:!s.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,m.accessToken);const I=this.map._requestManager.transformRequest(h,s.ResourceType.Style);this._request=s.getJSON(I,(L,$)=>{this._request=null,L?this.fire(new s.ErrorEvent(L)):$&&this._load($,S)})}loadJSON(h,m={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(h,m.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(lp,!1)}_updateLayerCount(h,m){const S=m?1:-1;h.is3D()&&(this._num3DLayers+=S),h.type==="circle"&&(this._numCircleLayers+=S),h.type==="symbol"&&(this._numSymbolLayers+=S)}_load(h,m){if(m&&Xu(this,s.validateStyle(h)))return;this._loaded=!0,this.stylesheet=s.clone$1(h),this._updateMapProjection();for(const I in h.sources)this.addSource(I,h.sources[I],{validate:!1});this._changed=!1,h.sprite?this._loadSprite(h.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(h.glyphs);const S=qr(this.stylesheet.layers);this._order=S.map(I=>I.id),this._layers={},this._serializedLayers={};for(const I of S){const L=s.createStyleLayer(I);L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L,this._serializedLayers[L.id]=L.serialize(),this._updateLayerCount(L,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ce(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(h){h?this.stylesheet.projection=h:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(h){this._spriteRequest=function(m,S,I){let L,$,H;const Q=s.exported.devicePixelRatio>1?"@2x":"";let ne=s.getJSON(S.transformRequest(S.normalizeSpriteURL(m,Q,".json"),s.ResourceType.SpriteJSON),(ve,Te)=>{ne=null,H||(H=ve,L=Te,fe())}),te=s.getImage(S.transformRequest(S.normalizeSpriteURL(m,Q,".png"),s.ResourceType.SpriteImage),(ve,Te)=>{te=null,H||(H=ve,$=Te,fe())});function fe(){if(H)I(H);else if(L&&$){const ve=s.exported.getImageData($),Te={};for(const Ie in L){const{width:Pe,height:Re,x:he,y:Se,sdf:Fe,pixelRatio:ke,stretchX:Qe,stretchY:et,content:Je}=L[Ie],lt=new s.RGBAImage({width:Pe,height:Re});s.RGBAImage.copy(ve,lt,{x:he,y:Se},{x:0,y:0},{width:Pe,height:Re}),Te[Ie]={data:lt,pixelRatio:ke,sdf:Fe,stretchX:Qe,stretchY:et,content:Je}}I(null,Te)}}return{cancel(){ne&&(ne.cancel(),ne=null),te&&(te.cancel(),te=null)}}}(h,this.map._requestManager,(m,S)=>{if(this._spriteRequest=null,m)this.fire(new s.ErrorEvent(m));else if(S)for(const I in S)this.imageManager.addImage(I,S[I]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(h){const m=this.getSource(h.source);if(!m)return;const S=h.sourceLayer;S&&(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(S)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${S}" does not exist on source "${m.id}" as specified by style layer "${h.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const h in this._sourceCaches)if(!this._sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(h){const m=[];for(const S of h){const I=this._layers[S];I.type!=="custom"&&m.push(I.serialize())}return m}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const h in this._sourceCaches)if(this._sourceCaches[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(h){return!!this.terrain&&(typeof h.isLayerDraped=="function"?h.isLayerDraped():Zu[h.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(h){if(!this._loaded)return;const m=this._changed;if(this._changed){const I=Object.keys(this._updatedLayers),L=Object.keys(this._removedLayers);(I.length||L.length)&&this._updateWorkerLayers(I,L);for(const $ in this._updatedSources){const H=this._updatedSources[$];H==="reload"?this._reloadSource($):H==="clear"&&this._clearSource($)}this._updateTilesForChangedImages();for(const $ in this._updatedPaintProps)this._layers[$].updateTransitions(h);this.light.updateTransitions(h),this.fog&&this.fog.updateTransitions(h),this._resetUpdates()}const S={};for(const I in this._sourceCaches){const L=this._sourceCaches[I];S[I]=L.used,L.used=!1}for(const I of this._order){const L=this._layers[I];if(L.recalculate(h,this._availableImages),!L.isHidden(h.zoom)){const H=this._getLayerSourceCache(L);H&&(H.used=!0)}const $=this.map.painter;if($){const H=L.getProgramIds();if(!H)continue;const Q=L.getProgramConfiguration(h.zoom);for(const ne of H)$.useProgram(ne,Q)}}for(const I in S){const L=this._sourceCaches[I];S[I]!==L.used&&L.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:L.getSource().id}))}this.light.recalculate(h),this.terrain&&this.terrain.recalculate(h),this.fog&&this.fog.recalculate(h),this.z=h.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),m&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const h=Object.keys(this._changedImages);if(h.length){for(const m in this._sourceCaches)this._sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}}_updateWorkerLayers(h,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:m})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(h){if(this._checkLoaded(),Xu(this,s.validateStyle(h)))return!1;(h=s.clone$1(h)).layers=qr(h.layers);const m=function(I,L){if(!I)return[{command:jn.setStyle,args:[L]}];let $=[];try{if(!u(I.version,L.version))return[{command:jn.setStyle,args:[L]}];u(I.center,L.center)||$.push({command:jn.setCenter,args:[L.center]}),u(I.zoom,L.zoom)||$.push({command:jn.setZoom,args:[L.zoom]}),u(I.bearing,L.bearing)||$.push({command:jn.setBearing,args:[L.bearing]}),u(I.pitch,L.pitch)||$.push({command:jn.setPitch,args:[L.pitch]}),u(I.sprite,L.sprite)||$.push({command:jn.setSprite,args:[L.sprite]}),u(I.glyphs,L.glyphs)||$.push({command:jn.setGlyphs,args:[L.glyphs]}),u(I.transition,L.transition)||$.push({command:jn.setTransition,args:[L.transition]}),u(I.light,L.light)||$.push({command:jn.setLight,args:[L.light]}),u(I.fog,L.fog)||$.push({command:jn.setFog,args:[L.fog]}),u(I.projection,L.projection)||$.push({command:jn.setProjection,args:[L.projection]});const H={},Q=[];(function(fe,ve,Te,Ie){let Pe;for(Pe in ve=ve||{},fe=fe||{})fe.hasOwnProperty(Pe)&&(ve.hasOwnProperty(Pe)||ca(Pe,Te,Ie));for(Pe in ve){if(!ve.hasOwnProperty(Pe))continue;const Re=ve[Pe];fe.hasOwnProperty(Pe)?u(fe[Pe],Re)||(fe[Pe].type==="geojson"&&Re.type==="geojson"&&zl(fe,ve,Pe)?Te.push({command:jn.setGeoJSONSourceData,args:[Pe,Re.data]}):kc(Pe,ve,Te,Ie)):ro(Pe,ve,Te)}})(I.sources,L.sources,Q,H);const ne=[];I.layers&&I.layers.forEach(fe=>{fe.source&&H[fe.source]?$.push({command:jn.removeLayer,args:[fe.id]}):ne.push(fe)});let te=I.terrain;te&&H[te.source]&&($.push({command:jn.setTerrain,args:[void 0]}),te=void 0),$=$.concat(Q),u(te,L.terrain)||$.push({command:jn.setTerrain,args:[L.terrain]}),function(fe,ve,Te){ve=ve||[];const Ie=(fe=fe||[]).map(Vo),Pe=ve.map(Vo),Re=fe.reduce(Bo,{}),he=ve.reduce(Bo,{}),Se=Ie.slice(),Fe=Object.create(null);let ke,Qe,et,Je,lt,at,xt;for(ke=0,Qe=0;ke<Ie.length;ke++)et=Ie[ke],he.hasOwnProperty(et)?Qe++:(Te.push({command:jn.removeLayer,args:[et]}),Se.splice(Se.indexOf(et,Qe),1));for(ke=0,Qe=0;ke<Pe.length;ke++)et=Pe[Pe.length-1-ke],Se[Se.length-1-ke]!==et&&(Re.hasOwnProperty(et)?(Te.push({command:jn.removeLayer,args:[et]}),Se.splice(Se.lastIndexOf(et,Se.length-Qe),1)):Qe++,at=Se[Se.length-ke],Te.push({command:jn.addLayer,args:[he[et],at]}),Se.splice(Se.length-ke,0,et),Fe[et]=!0);for(ke=0;ke<Pe.length;ke++)if(et=Pe[ke],Je=Re[et],lt=he[et],!Fe[et]&&!u(Je,lt))if(u(Je.source,lt.source)&&u(Je["source-layer"],lt["source-layer"])&&u(Je.type,lt.type)){for(xt in Qr(Je.layout,lt.layout,Te,et,null,jn.setLayoutProperty),Qr(Je.paint,lt.paint,Te,et,null,jn.setPaintProperty),u(Je.filter,lt.filter)||Te.push({command:jn.setFilter,args:[et,lt.filter]}),u(Je.minzoom,lt.minzoom)&&u(Je.maxzoom,lt.maxzoom)||Te.push({command:jn.setLayerZoomRange,args:[et,lt.minzoom,lt.maxzoom]}),Je)Je.hasOwnProperty(xt)&&xt!=="layout"&&xt!=="paint"&&xt!=="filter"&&xt!=="metadata"&&xt!=="minzoom"&&xt!=="maxzoom"&&(xt.indexOf("paint.")===0?Qr(Je[xt],lt[xt],Te,et,xt.slice(6),jn.setPaintProperty):u(Je[xt],lt[xt])||Te.push({command:jn.setLayerProperty,args:[et,xt,lt[xt]]}));for(xt in lt)lt.hasOwnProperty(xt)&&!Je.hasOwnProperty(xt)&&xt!=="layout"&&xt!=="paint"&&xt!=="filter"&&xt!=="metadata"&&xt!=="minzoom"&&xt!=="maxzoom"&&(xt.indexOf("paint.")===0?Qr(Je[xt],lt[xt],Te,et,xt.slice(6),jn.setPaintProperty):u(Je[xt],lt[xt])||Te.push({command:jn.setLayerProperty,args:[et,xt,lt[xt]]}))}else Te.push({command:jn.removeLayer,args:[et]}),at=Se[Se.lastIndexOf(et)+1],Te.push({command:jn.addLayer,args:[lt,at]})}(ne,L.layers,$)}catch(H){console.warn("Unable to compute style diff:",H),$=[{command:jn.setStyle,args:[L]}]}return $}(this.serialize(),h).filter(I=>!(I.command in T_));if(m.length===0)return!1;const S=m.filter(I=>!(I.command in kf));if(S.length>0)throw new Error(`Unimplemented: ${S.map(I=>I.command).join(", ")}.`);return m.forEach(I=>{I.command!=="setTransition"&&I.command!=="setProjection"&&this[I.command].apply(this,I.args)}),this.stylesheet=h,this._updateMapProjection(),!0}addImage(h,m){return this.getImage(h)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(h,m),this._afterImageUpdated(h),this)}updateImage(h,m){this.imageManager.updateImage(h,m)}getImage(h){return this.imageManager.getImage(h)}removeImage(h){return this.getImage(h)?(this.imageManager.removeImage(h),this._afterImageUpdated(h),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(h,m,S={}){if(this._checkLoaded(),this.getSource(h)!==void 0)throw new Error("There is already a source with this ID");if(!m.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(m).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(s.validateSource,`sources.${h}`,m,null,S))return;this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);const I=st(h,m,this.dispatcher,this);I.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(h),source:I.serialize(),sourceId:h}));const L=$=>{const H=($?"symbol:":"other:")+h,Q=this._sourceCaches[H]=new s.SourceCache(H,I,$);($?this._symbolSourceCaches:this._otherSourceCaches)[h]=Q,Q.style=this,Q.onAdd(this.map)};L(!1),m.type!=="vector"&&m.type!=="geojson"||L(!0),I.onAdd&&I.onAdd(this.map),this._changed=!0}removeSource(h){this._checkLoaded();const m=this.getSource(h);if(!m)throw new Error("There is no source with this ID");for(const I in this._layers)if(this._layers[I].source===h)return this.fire(new s.ErrorEvent(new Error(`Source "${h}" cannot be removed while layer "${I}" is using it.`)));if(this.terrain&&this.terrain.get().source===h)return this.fire(new s.ErrorEvent(new Error(`Source "${h}" cannot be removed while terrain is using it.`)));const S=this._getSourceCaches(h);for(const I of S)delete this._sourceCaches[I.id],delete this._updatedSources[I.id],I.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:I.getSource().id})),I.setEventedParent(null),I.clearTiles();return delete this._otherSourceCaches[h],delete this._symbolSourceCaches[h],m.setEventedParent(null),m.onRemove&&m.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(h,m){this._checkLoaded(),this.getSource(h).setData(m),this._changed=!0}getSource(h){const m=this._getSourceCache(h);return m&&m.getSource()}_getSources(){const h=[];for(const m in this._otherSourceCaches){const S=this._getSourceCache(m);S&&h.push(S.getSource())}return h}addLayer(h,m,S={}){this._checkLoaded();const I=h.id;if(this.getLayer(I))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${I}" already exists on this map`)));let L;if(h.type==="custom"){if(Xu(this,s.validateCustomStyleLayer(h)))return;L=s.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(I,h.source),h=s.clone$1(h),h=s.extend(h,{source:I})),this._validate(s.validateLayer,`layers.${I}`,h,{arrayIndex:-1},S))return;L=s.createStyleLayer(h),this._validateLayer(L),L.setEventedParent(this,{layer:{id:I}}),this._serializedLayers[L.id]=L.serialize(),this._updateLayerCount(L,!0)}const $=m?this._order.indexOf(m):this._order.length;if(m&&$===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${m}" does not exist on this map.`)));this._order.splice($,0,I),this._layerOrderChanged=!0,this._layers[I]=L;const H=this._getLayerSourceCache(L);if(this._removedLayers[I]&&L.source&&H&&L.type!=="custom"){const Q=this._removedLayers[I];delete this._removedLayers[I],Q.type!==L.type?this._updatedSources[L.source]="clear":(this._updatedSources[L.source]="reload",H.pause())}this._updateLayer(L),L.onAdd&&L.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(h,m){if(this._checkLoaded(),this._changed=!0,!this._layers[h])return void this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot be moved.`)));if(h===m)return;const S=this._order.indexOf(h);this._order.splice(S,1);const I=m?this._order.indexOf(m):this._order.length;m&&I===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${m}" does not exist on this map.`))):(this._order.splice(I,0,h),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(h){this._checkLoaded();const m=this._layers[h];if(!m)return void this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot be removed.`)));m.setEventedParent(null),this._updateLayerCount(m,!1);const S=this._order.indexOf(h);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=m,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],m.onRemove&&m.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(h){return this._layers[h]}hasLayer(h){return h in this._layers}hasLayerType(h){for(const m in this._layers)if(this._layers[m].type===h)return!0;return!1}setLayerZoomRange(h,m,S){this._checkLoaded();const I=this.getLayer(h);I?I.minzoom===m&&I.maxzoom===S||(m!=null&&(I.minzoom=m),S!=null&&(I.maxzoom=S),this._updateLayer(I)):this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(h,m,S={}){this._checkLoaded();const I=this.getLayer(h);if(I){if(!u(I.filter,m))return m==null?(I.filter=void 0,void this._updateLayer(I)):void(this._validate(s.validateFilter,`layers.${I.id}.filter`,m,{layerType:I.type},S)||(I.filter=s.clone$1(m),this._updateLayer(I)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot be filtered.`)))}getFilter(h){const m=this.getLayer(h);return m&&s.clone$1(m.filter)}setLayoutProperty(h,m,S,I={}){this._checkLoaded();const L=this.getLayer(h);L?u(L.getLayoutProperty(m),S)||(L.setLayoutProperty(m,S,I),this._updateLayer(L)):this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(h,m){const S=this.getLayer(h);if(S)return S.getLayoutProperty(m);this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style.`)))}setPaintProperty(h,m,S,I={}){this._checkLoaded();const L=this.getLayer(h);L?u(L.getPaintProperty(m),S)||(L.setPaintProperty(m,S,I)&&this._updateLayer(L),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(h,m){const S=this.getLayer(h);return S&&S.getPaintProperty(m)}setFeatureState(h,m){this._checkLoaded();const S=h.source,I=h.sourceLayer,L=this.getSource(S);if(!L)return void this.fire(new s.ErrorEvent(new Error(`The source '${S}' does not exist in the map's style.`)));const $=L.type;if($==="geojson"&&I)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if($==="vector"&&!I)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));h.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const H=this._getSourceCaches(S);for(const Q of H)Q.setFeatureState(I,h.id,m)}removeFeatureState(h,m){this._checkLoaded();const S=h.source,I=this.getSource(S);if(!I)return void this.fire(new s.ErrorEvent(new Error(`The source '${S}' does not exist in the map's style.`)));const L=I.type,$=L==="vector"?h.sourceLayer:void 0;if(L==="vector"&&!$)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(m&&typeof h.id!="string"&&typeof h.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const H=this._getSourceCaches(S);for(const Q of H)Q.removeFeatureState($,h.id,m)}getFeatureState(h){this._checkLoaded();const m=h.source,S=h.sourceLayer,I=this.getSource(m);if(I){if(I.type!=="vector"||S)return h.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(m)[0].getFeatureState(S,h.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const h={};for(const m in this._sourceCaches){const S=this._sourceCaches[m].getSource();h[S.id]||(h[S.id]=S.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:h,layers:this._serializeLayers(this._order)},m=>m!==void 0)}_updateLayer(h){this._updatedLayers[h.id]=!0;const m=this._getLayerSourceCache(h);h.source&&!this._updatedSources[h.source]&&m&&m.getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",m.pause()),this._changed=!0,h.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(h){const m=$=>this._layers[$].type==="fill-extrusion",S={},I=[];for(let $=this._order.length-1;$>=0;$--){const H=this._order[$];if(m(H)){S[H]=$;for(const Q of h){const ne=Q[H];if(ne)for(const te of ne)I.push(te)}}}I.sort(($,H)=>H.intersectionZ-$.intersectionZ);const L=[];for(let $=this._order.length-1;$>=0;$--){const H=this._order[$];if(m(H))for(let Q=I.length-1;Q>=0;Q--){const ne=I[Q].feature;if(S[ne.layer.id]<$)break;L.push(ne),I.pop()}else for(const Q of h){const ne=Q[H];if(ne)for(const te of ne)L.push(te.feature)}}return L}queryRenderedFeatures(h,m,S){m&&m.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",m.filter,null,m);const I={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const Q of m.layers){const ne=this._layers[Q];if(!ne)return this.fire(new s.ErrorEvent(new Error(`The layer '${Q}' does not exist in the map's style and cannot be queried for features.`))),[];I[ne.source]=!0}}const L=[];m.availableImages=this._availableImages;const $=m&&m.layers?m.layers.some(Q=>{const ne=this.getLayer(Q);return ne&&ne.is3D()}):this.has3DLayers(),H=ct.createFromScreenPoints(h,S);for(const Q in this._sourceCaches){const ne=this._sourceCaches[Q].getSource().id;m.layers&&!I[ne]||L.push(rn(this._sourceCaches[Q],this._layers,this._serializedLayers,H,m,S,$,!!this.map._showQueryGeometry))}return this.placement&&L.push(function(Q,ne,te,fe,ve,Te,Ie){const Pe={},Re=Te.queryRenderedSymbols(fe),he=[];for(const Se of Object.keys(Re).map(Number))he.push(Ie[Se]);he.sort(w);for(const Se of he){const Fe=Se.featureIndex.lookupSymbolFeatures(Re[Se.bucketInstanceId],ne,Se.bucketIndex,Se.sourceLayerIndex,ve.filter,ve.layers,ve.availableImages,Q);for(const ke in Fe){const Qe=Pe[ke]=Pe[ke]||[],et=Fe[ke];et.sort((Je,lt)=>{const at=Se.featureSortOrder;if(at){const xt=at.indexOf(Je.featureIndex);return at.indexOf(lt.featureIndex)-xt}return lt.featureIndex-Je.featureIndex});for(const Je of et)Qe.push(Je)}}for(const Se in Pe)Pe[Se].forEach(Fe=>{const ke=Fe.feature,Qe=te(Q[Se]);if(!Qe)return;const et=Qe.getFeatureState(ke.layer["source-layer"],ke.id);ke.source=ke.layer.source,ke.layer["source-layer"]&&(ke.sourceLayer=ke.layer["source-layer"]),ke.state=et});return Pe}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),H.screenGeometry,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(L)}querySourceFeatures(h,m){m&&m.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",m.filter,null,m);const S=this._getSourceCaches(h);let I=[];for(const L of S)I=I.concat(Gn(L,m));return I}addSourceType(h,m,S){return Ds.getSourceType(h)?S(new Error(`A source type called "${h}" already exists.`)):(Ds.setSourceType(h,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:m.workerSourceURL},S):S(null,null))}getLight(){return this.light.getLight()}setLight(h,m={}){this._checkLoaded();const S=this.light.getLight();let I=!1;for(const $ in h)if(!u(h[$],S[$])){I=!0;break}if(!I)return;const L=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(h,m),this.light.updateTransitions(L)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(h,m=1){if(this._checkLoaded(),!h)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let S=h;if(m===1){if(typeof S.source=="object"){const I="terrain-dem-src";this.addSource(I,S.source),S=s.clone$1(S),S=s.extend(S,{source:I})}if(this._validate(s.validateTerrain,"terrain",S))return}if(!this.terrain||this.terrain&&m!==this.terrain.drapeRenderMode){if(!S)return;this._createTerrain(S,m)}else{const I=this.terrain,L=I.get();for(const $ of Object.keys(s.spec.terrain))!S.hasOwnProperty($)&&s.spec.terrain[$].default&&(S[$]=s.spec.terrain[$].default);for(const $ in S)if(!u(S[$],L[$])){I.set(S),this.stylesheet.terrain=S;const H=this._setTransitionParameters({duration:0});I.updateTransitions(H);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(h){const m=this.fog=new Ne(h,this.map.transform);this.stylesheet.fog=h;const S=this._setTransitionParameters({duration:0});m.updateTransitions(S)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const h of this.map._markers)h._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(h){if(this._checkLoaded(),!h)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const m=this.fog,S=m.get();Object.keys(h).length===0&&m.set(h);for(const I in h)if(!u(h[I],S[I])){m.set(h),this.stylesheet.fog=h;const L=this._setTransitionParameters({duration:0});m.updateTransitions(L);break}}else this._createFog(h);this._markersNeedUpdate=!0}_setTransitionParameters(h){return{now:s.exported.now(),transition:s.extend(h,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const h=this._order.filter(S=>this.isLayerDraped(this._layers[S])),m=this._order.filter(S=>!this.isLayerDraped(this._layers[S]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...h),this._drapedFirstOrder.push(...m)}_createTerrain(h,m){const S=this.terrain=new Ye(h,m);this.stylesheet.terrain=h,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const I=this._setTransitionParameters({duration:0});S.updateTransitions(I)}_force3DLayerUpdate(){for(const h in this._layers){const m=this._layers[h];m.type==="fill-extrusion"&&this._updateLayer(m)}}_forceSymbolLayerUpdate(){for(const h in this._layers){const m=this._layers[h];m.type==="symbol"&&this._updateLayer(m)}}_validate(h,m,S,I,L={}){return(!L||L.validate!==!1)&&Xu(this,h.call(s.validateStyle,s.extend({key:m,style:this.serialize(),value:S,styleSpec:s.spec},I)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this._sourceCaches)this._sourceCaches[h].clearTiles(),this._sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(h){const m=this._getSourceCaches(h);for(const S of m)S.clearTiles()}_reloadSource(h){const m=this._getSourceCaches(h);for(const S of m)S.resume(),S.reload()}_reloadSources(){for(const h of this._getSources())h.reload&&h.reload()}_updateSources(h){for(const m in this._sourceCaches)this._sourceCaches[m].update(h)}_generateCollisionBoxes(){for(const h in this._sourceCaches){const m=this._sourceCaches[h];m.resume(),m.reload()}}_updatePlacement(h,m,S,I,L=!1){let $=!1,H=!1;const Q={};for(const ne of this._order){const te=this._layers[ne];if(te.type!=="symbol")continue;if(!Q[te.source]){const ve=this._getLayerSourceCache(te);if(!ve)continue;Q[te.source]=ve.getRenderableIds(!0).map(Te=>ve.getTileByID(Te)).sort((Te,Ie)=>Ie.tileID.overscaledZ-Te.tileID.overscaledZ||(Te.tileID.isLessThan(Ie.tileID)?-1:1))}const fe=this.crossTileSymbolIndex.addLayer(te,Q[te.source],h.center.lng,h.projection);$=$||fe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),L=L||this._layerOrderChanged||S===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(L||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),h.zoom))&&(this.pauseablePlacement=new SA(h,this._order,L,m,S,I,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Q),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),H=!0),$&&this.pauseablePlacement.placement.setStale()),H||$)for(const ne of this._order){const te=this._layers[ne];te.type==="symbol"&&this.placement.updateLayerOpacities(te,Q[te.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const h in this._sourceCaches)this._sourceCaches[h].releaseSymbolFadeTiles()}getImages(h,m,S){this.imageManager.getImages(m.icons,S),this._updateTilesForChangedImages();const I=L=>{L&&L.setDependencies(m.tileID.key,m.type,m.icons)};I(this._otherSourceCaches[m.source]),I(this._symbolSourceCaches[m.source])}getGlyphs(h,m,S){this.glyphManager.getGlyphs(m.stacks,S)}getResource(h,m,S){return s.makeRequest(m,S)}_getSourceCache(h){return this._otherSourceCaches[h]}_getLayerSourceCache(h){return h.type==="symbol"?this._symbolSourceCaches[h.source]:this._otherSourceCaches[h.source]}_getSourceCaches(h){const m=[];return this._otherSourceCaches[h]&&m.push(this._otherSourceCaches[h]),this._symbolSourceCaches[h]&&m.push(this._symbolSourceCaches[h]),m}_isSourceCacheLoaded(h){const m=this._getSourceCaches(h);return m.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${h}'`))),!1):m.every(S=>S.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ds.getSourceType=function(v){return tr[v]},Ds.setSourceType=function(v,h){tr[v]=h},Ds.registerForPluginStateChange=s.registerForPluginStateChange;var Mg=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,zc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ol=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Gl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Bs=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let up={},zf={};const Uf=[];qh(Mg,Uf),qh(ol,Uf),qh(Gl,Uf),qh(Bs,Uf),up=Kr("",ol),zf=Kr(Bs,Gl);const C_=Kr(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Og=Mg,Rg=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var TA={background:Kr(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Kr(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Kr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Kr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Kr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Kr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Kr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Kr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Kr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Kr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Kr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Kr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Kr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Kr(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Kr(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Kr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Kr(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Kr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Kr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Kr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Kr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Kr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Kr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Kr(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Kr(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,zc),skyboxGradient:Kr(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,zc),skyboxCapture:Kr(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Kr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Kr(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function qh(v,h){const m=v.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let S of m)if(S=S.trim(),S[0]==="#"&&S.includes("if")&&!S.includes("endif")){S=S.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const I=S.split(" ");for(const L of I)h.includes(L)||h.push(L)}}function Kr(v,h){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,S=h.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),I={},L=[...Uf];return qh(v,L),qh(h,L),{fragmentSource:v=v.replace(m,($,H,Q,ne,te)=>(I[te]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_${te}
varying ${Q} ${ne} ${te};
#else
uniform ${Q} ${ne} u_${te};
#endif
`:`
#ifdef HAS_UNIFORM_u_${te}
    ${Q} ${ne} ${te} = u_${te};
#endif
`)),vertexSource:h=h.replace(m,($,H,Q,ne,te)=>{const fe=ne==="float"?"vec2":"vec4",ve=te.match(/color/)?"color":fe;return I[te]?H==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${Q} ${fe} a_${te};
varying ${Q} ${ne} ${te};
#else
uniform ${Q} ${ne} u_${te};
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = a_${te};
#else
    ${Q} ${ne} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = unpack_mix_${ve}(a_${te}, u_${te}_t);
#else
    ${Q} ${ne} ${te} = u_${te};
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${Q} ${fe} a_${te};
#else
uniform ${Q} ${ne} u_${te};
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${Q} ${ne} ${te} = a_${te};
#else
    ${Q} ${ne} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${Q} ${ne} ${te} = unpack_mix_${ve}(a_${te}, u_${te}_t);
#else
    ${Q} ${ne} ${te} = u_${te};
#endif
`}),staticAttributes:S,usedDefines:L}}class cp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(h,m,S,I,L,$,H){this.context=h;let Q=this.boundPaintVertexBuffers.length!==I.length;for(let te=0;!Q&&te<I.length;te++)this.boundPaintVertexBuffers[te]!==I[te]&&(Q=!0);let ne=this.boundDynamicVertexBuffers.length!==H.length;for(let te=0;!ne&&te<H.length;te++)this.boundDynamicVertexBuffers[te]!==H[te]&&(ne=!0);if(!h.extVertexArrayObject||!this.vao||this.boundProgram!==m||this.boundLayoutVertexBuffer!==S||Q||ne||this.boundIndexBuffer!==L||this.boundVertexOffset!==$)this.freshBind(m,S,I,L,$,H);else{h.bindVertexArrayOES.set(this.vao);for(const te of H)te&&te.bind();L&&L.dynamicDraw&&L.bind()}}freshBind(h,m,S,I,L,$){let H;const Q=h.numAttributes,ne=this.context,te=ne.gl;if(ne.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ne.extVertexArrayObject.createVertexArrayOES(),ne.bindVertexArrayOES.set(this.vao),H=0,this.boundProgram=h,this.boundLayoutVertexBuffer=m,this.boundPaintVertexBuffers=S,this.boundIndexBuffer=I,this.boundVertexOffset=L,this.boundDynamicVertexBuffers=$;else{H=ne.currentNumAttributes||0;for(let fe=Q;fe<H;fe++)te.disableVertexAttribArray(fe)}m.enableAttributes(te,h),m.bind(),m.setVertexAttribPointers(te,h,L);for(const fe of S)fe.enableAttributes(te,h),fe.bind(),fe.setVertexAttribPointers(te,h,L);for(const fe of $)fe&&(fe.enableAttributes(te,h),fe.bind(),fe.setVertexAttribPointers(te,h,L));I&&I.bind(),ne.currentNumAttributes=Q}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function CA(v,h){const m=Math.pow(2,h.canonical.z),S=h.canonical.y;return[new s.MercatorCoordinate(0,S/m).toLngLat().lat,new s.MercatorCoordinate(0,(S+1)/m).toLngLat().lat]}function PA(v,h,m,S,I,L,$){const H=v.context,Q=H.gl,ne=m.fbo;if(!ne)return;v.prepareDrawTile();const te=v.useProgram("hillshade");H.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,ne.colorAttachment.get());const fe=((Pe,Re,he,Se)=>{const Fe=he.paint.get("hillshade-shadow-color"),ke=he.paint.get("hillshade-highlight-color"),Qe=he.paint.get("hillshade-accent-color");let et=he.paint.get("hillshade-illumination-direction")*(Math.PI/180);he.paint.get("hillshade-illumination-anchor")==="viewport"&&(et-=Pe.transform.angle);const Je=!Pe.options.moving;return{u_matrix:Se||Pe.transform.calculateProjMatrix(Re.tileID.toUnwrapped(),Je),u_image:0,u_latrange:CA(0,Re.tileID),u_light:[he.paint.get("hillshade-exaggeration"),et],u_shadow:Fe,u_highlight:ke,u_accent:Qe}})(v,m,S,v.terrain?h.projMatrix:null);v.prepareDrawProgram(H,te,h.toUnwrapped());const{tileBoundsBuffer:ve,tileBoundsIndexBuffer:Te,tileBoundsSegments:Ie}=v.getTileBoundsBuffers(m);te.draw(H,Q.TRIANGLES,I,L,$,s.CullFaceMode.disabled,fe,S.id,ve,Te,Ie)}function Lg(v,h,m){if(!h.needsDEMTextureUpload)return;const S=v.context,I=S.gl;S.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||v.getTileTexture(m.stride);const L=m.getPixels();h.demTexture?h.demTexture.update(L,{premultiply:!1}):h.demTexture=new s.Texture(S,L,I.RGBA,{premultiply:!1}),h.needsDEMTextureUpload=!1}function Gf(v,h,m,S,I,L){const $=v.context,H=$.gl;if(!h.dem)return;const Q=h.dem;if($.activeTexture.set(H.TEXTURE1),Lg(v,h,Q),!h.demTexture)return;h.demTexture.bind(H.NEAREST,H.CLAMP_TO_EDGE);const ne=Q.dim;$.activeTexture.set(H.TEXTURE0);let te=h.fbo;if(!te){const Ie=new s.Texture($,{width:ne,height:ne,data:null},H.RGBA);Ie.bind(H.LINEAR,H.CLAMP_TO_EDGE),te=h.fbo=$.createFramebuffer(ne,ne,!0),te.colorAttachment.set(Ie.texture)}$.bindFramebuffer.set(te.framebuffer),$.viewport.set([0,0,ne,ne]);const{tileBoundsBuffer:fe,tileBoundsIndexBuffer:ve,tileBoundsSegments:Te}=v.getMercatorTileBoundsBuffers();v.useProgram("hillshadePrepare").draw($,H.TRIANGLES,S,I,L,s.CullFaceMode.disabled,((Ie,Pe)=>{const Re=Pe.stride,he=s.create();return s.ortho(he,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(he,he,[0,-s.EXTENT,0]),{u_matrix:he,u_image:1,u_dimension:[Re,Re],u_zoom:Ie.overscaledZ,u_unpack:Pe.unpackVector}})(h.tileID,Q),m.id,fe,ve,Te),h.needsHillshadePrepare=!1}const IA=v=>({u_matrix:new s.UniformMatrix4f(v),u_image0:new s.Uniform1i(v),u_skirt_height:new s.Uniform1f(v)}),jf=(v,h)=>({u_matrix:v,u_image0:0,u_skirt_height:h}),fp=(v,h,m,S,I,L,$,H,Q,ne,te,fe,ve,Te,Ie)=>({u_proj_matrix:Float32Array.from(v),u_globe_matrix:h,u_normalize_matrix:Float32Array.from(S),u_merc_matrix:m,u_zoom_transition:I,u_merc_center:L,u_image0:0,u_frustum_tl:$,u_frustum_tr:H,u_frustum_br:Q,u_frustum_bl:ne,u_globe_pos:te,u_globe_radius:fe,u_viewport:ve,u_grid_matrix:Ie?Float32Array.from(Ie):new Float32Array(9),u_skirt_height:Te});function fu(v,h){return v!=null&&h!=null&&!(!v.hasData()||!h.hasData())&&v.demTexture!=null&&h.demTexture!=null&&v.tileID.key!==h.tileID.key}const pa=new class{constructor(){this.operations={}}newMorphing(v,h,m,S,I){if(v in this.operations){const L=this.operations[v];L.to.tileID.key!==m.tileID.key&&(L.queued=m)}else this.operations[v]={startTime:S,phase:0,duration:I,from:h,to:m,queued:null}}getMorphValuesForProxy(v){if(!(v in this.operations))return null;const h=this.operations[v];return{from:h.from,to:h.to,phase:h.phase}}update(v){for(const h in this.operations){const m=this.operations[h];for(m.phase=(v-m.startTime)/m.duration;m.phase>=1||!this._validOp(m);)if(!this._nextOp(m,v)){delete this.operations[h];break}}}_nextOp(v,h){return!!v.queued&&(v.from=v.to,v.to=v.queued,v.queued=null,v.phase=0,v.startTime=h,!0)}_validOp(v){return v.from.hasData()&&v.to.hasData()}},Vf={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Uc(v){return 6*Math.pow(1.5,22-v)}function P_(v,h){const m=1<<v.z;return!h&&(v.x===0||v.x===m-1)||v.y===0||v.y===m-1}const hp=v=>({u_matrix:v});function MA(v,h,m,S,I){if(I>0){const L=s.exported.now(),$=(L-v.timeAdded)/I,H=h?(L-h.timeAdded)/I:-1,Q=m.getSource(),ne=S.coveringZoomLevel({tileSize:Q.tileSize,roundZoom:Q.roundZoom}),te=!h||Math.abs(h.tileID.overscaledZ-ne)>Math.abs(v.tileID.overscaledZ-ne),fe=te&&v.refreshedUponExpiration?1:s.clamp(te?$:1-H,0,1);return v.refreshedUponExpiration&&$>=1&&(v.refreshedUponExpiration=!1),h?{opacity:1,mix:1-fe}:{opacity:fe,mix:0}}return{opacity:1,mix:0}}class OA extends s.SourceCache{constructor(h){const m={type:"raster-dem",maxzoom:h.transform.maxZoom},S=new Be(Tr(),null),I=st("mock-dem",m,S,h.style);super("mock-dem",I,!1),I.setEventedParent(this),this._sourceLoaded=!0}_loadTile(h,m){h.state="loaded",m(null)}}class Dg extends s.SourceCache{constructor(h){const m=st("proxy",{type:"geojson",maxzoom:h.transform.maxZoom},new Be(Tr(),null),h.style);super("proxy",m,!1),m.setEventedParent(this),this.map=this.getSource().map=h,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(h,m,S){if(h.freezeTileCoverage)return;this.transform=h;const I=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((L,$)=>{if(L[$.key]="",!this._tiles[$.key]){const H=new s.Tile($,this._source.tileSize*$.overscaleFactor(),h.tileZoom);H.state="loaded",this._tiles[$.key]=H}return L},{});for(const L in this._tiles)L in I||(this.freeFBO(L),this._tiles[L].unloadVectorData(),delete this._tiles[L])}freeFBO(h){const m=this.proxyCachedFBO[h];if(m!==void 0){const S=Object.values(m);this.renderCachePool.push(...S),delete this.proxyCachedFBO[h]}}deallocRenderCache(){this.renderCache.forEach(h=>h.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Bg extends s.OverscaledTileID{constructor(h,m,S){super(h.overscaledZ,h.wrap,h.canonical.z,h.canonical.x,h.canonical.y),this.proxyTileKey=m,this.projMatrix=S}}class RA extends s.Elevation{constructor(h,m){super(),this.painter=h,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[S,I,L]=function(Q){const ne=new s.StructArrayLayout2i4,te=new s.StructArrayLayout3ui6,fe=131;ne.reserve(17161),te.reserve(33800);const ve=s.EXTENT/128,Te=s.EXTENT+ve/2,Ie=Te+ve;for(let Re=-ve;Re<Ie;Re+=ve)for(let he=-ve;he<Ie;he+=ve){const Se=he<0||he>Te||Re<0||Re>Te?24575:0,Fe=s.clamp(Math.round(he),0,s.EXTENT),ke=s.clamp(Math.round(Re),0,s.EXTENT);ne.emplaceBack(Fe+Se,ke)}const Pe=(Re,he)=>{const Se=he*fe+Re;te.emplaceBack(Se+1,Se,Se+fe),te.emplaceBack(Se+fe,Se+fe+1,Se+1)};for(let Re=1;Re<129;Re++)for(let he=1;he<129;he++)Pe(he,Re);return[0,129].forEach(Re=>{for(let he=0;he<130;he++)Pe(he,Re),Pe(Re,he)}),[ne,te,32768]}(),$=h.context;this.gridBuffer=$.createVertexBuffer(S,s.posAttributes.members),this.gridIndexBuffer=$.createIndexBuffer(I),this.gridSegments=s.SegmentVector.simpleSegment(0,0,S.length,I.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,S.length,L),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Dg(m.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const H=$.gl;this._overlapStencilMode=new s.StencilMode({func:H.GEQUAL,mask:255},0,255,H.KEEP,H.KEEP,H.REPLACE),this._previousZoom=h.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=m,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new OA(m.map)}set style(h){h.on("data",this._onStyleDataEvent.bind(this)),h.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=h,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(h,m,S){if(h&&h.terrain){this._style!==h&&(this.style=h),this.enabled=!0;const I=h.terrain.properties;this.sourceCache=h.terrain.drapeRenderMode===0?this._mockSourceCache:h._getSourceCache(I.get("source")),this._exaggeration=I.get("exaggeration");const L=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const $=this.getScaledDemTileSize();this.sourceCache.update(m,$,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),m.updateElevation(!0,S),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(m),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(h){this._findCoveringTileCache[h]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const h=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||h.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${h.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${h.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(h){h.coord&&h.dataType==="source"?this._clearRenderCacheForTile(h.sourceCacheId,h.coord):h.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const h in this._style._sourceCaches)this._style._sourceCaches[h].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(h=>h.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const h=2*this.proxySourceCache.getSource().tileSize;return[h,h]}set useVertexMorphing(h){this._useVertexMorphing=h}updateTileBinding(h){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const m=this.proxySourceCache,S=this.painter.transform;this._initializing&&(this._initializing=S._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(S.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const I=this.proxyCoords=m.getIds().map(Q=>{const ne=m.getTileByID(Q).tileID;return ne.projMatrix=S.calculateProjMatrix(ne.toUnwrapped()),ne});(function(Q,ne){const te=ne.transform.pointCoordinate(ne.transform.getCameraPoint()),fe=new s.Point(te.x,te.y);Q.sort((ve,Te)=>{if(Te.overscaledZ-ve.overscaledZ)return Te.overscaledZ-ve.overscaledZ;const Ie=new s.Point(ve.canonical.x+(1<<ve.canonical.z)*ve.wrap,ve.canonical.y),Pe=new s.Point(Te.canonical.x+(1<<Te.canonical.z)*Te.wrap,Te.canonical.y),Re=fe.mult(1<<ve.canonical.z);return Re.x-=.5,Re.y-=.5,Re.distSqr(Ie)-Re.distSqr(Pe)})})(I,this.painter),this._previousZoom=S.zoom;const L=this.proxyToSource||{};this.proxyToSource={},I.forEach(Q=>{this.proxyToSource[Q.key]={}}),this.terrainTileForTile={};const $=this._style._sourceCaches;for(const Q in $){const ne=$[Q];if(!ne.used||(ne!==this.sourceCache&&this.resetTileLookupCache(ne.id),this._setupProxiedCoordsForOrtho(ne,h[Q],L),ne.usedForTerrain))continue;const te=h[Q];ne.getSource().reparseOverscaled&&this._assignTerrainTiles(te)}this.proxiedCoords[m.id]=I.map(Q=>new Bg(Q,Q.key,this.orthoMatrix)),this._assignTerrainTiles(I),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(L),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const H={};this._visibleDemTiles=[];for(const Q of this.proxyCoords){const ne=this.terrainTileForTile[Q.key];if(!ne)continue;const te=ne.tileID.key;te in H||(this._visibleDemTiles.push(ne),H[te]=te)}}_assignTerrainTiles(h){this._initializing||h.forEach(m=>{if(this.terrainTileForTile[m.key])return;const S=this._findTileCoveringTileID(m,this.sourceCache);S&&(this.terrainTileForTile[m.key]=S)})}_prepareDEMTextures(){const h=this.painter.context,m=h.gl;for(const S in this.terrainTileForTile){const I=this.terrainTileForTile[S],L=I.dem;!L||I.demTexture&&!I.needsDEMTextureUpload||(h.activeTexture.set(m.TEXTURE1),Lg(this.painter,I,L))}}_prepareDemTileUniforms(h,m,S,I){if(!m||m.demTexture==null)return!1;const L=h.tileID.canonical,$=Math.pow(2,m.tileID.canonical.z-L.z),H=I||"";return S[`u_dem_tl${H}`]=[L.x*$%1,L.y*$%1],S[`u_dem_scale${H}`]=$,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const h=this.painter.context,m=h.gl;if(!this._emptyDepthBufferTexture){const S=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(h,S,m.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let h=0;const m=this._visibleDemTiles.reduce((S,I)=>{if(!I.dem)return S;const L=I.dem.tree.minimums[0];return L>0&&h++,S+L},0);return h?m/h:0}_updateEmptyDEMTexture(){const h=this.painter.context,m=h.gl;h.activeTexture.set(m.TEXTURE2);const S=this._getLoadedAreaMinimum(),I=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(S,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let L=this._emptyDEMTexture;return L?L.update(I,{premultiply:!1}):L=this._emptyDEMTexture=new s.Texture(h,I,m.RGBA,{premultiply:!1}),L}setupElevationDraw(h,m,S){const I=this.painter.context,L=I.gl,$=(H=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(H),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var H;$.u_dem_size=this.sourceCache.getSource().tileSize,$.u_exaggeration=this.exaggeration();let Q=null,ne=null,te=1;if(S&&S.morphing&&this._useVertexMorphing){const fe=S.morphing.srcDemTile,ve=S.morphing.dstDemTile;te=S.morphing.phase,fe&&ve&&(this._prepareDemTileUniforms(h,fe,$,"_prev")&&(ne=fe),this._prepareDemTileUniforms(h,ve,$)&&(Q=ve))}if(ne&&Q?(I.activeTexture.set(L.TEXTURE2),Q.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE,L.NEAREST),I.activeTexture.set(L.TEXTURE4),ne.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE,L.NEAREST),$.u_dem_lerp=te):(Q=this.terrainTileForTile[h.tileID.key],I.activeTexture.set(L.TEXTURE2),(this._prepareDemTileUniforms(h,Q,$)?Q.demTexture:this.emptyDEMTexture).bind(L.NEAREST,L.CLAMP_TO_EDGE)),I.activeTexture.set(L.TEXTURE3),S&&S.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE),this._depthFBO&&($.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE),$.u_depth_size_inv=[1,1]),S&&S.useMeterToDem&&Q){const fe=(1<<Q.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;$.u_meter_to_dem=fe}if(S&&S.labelPlaneMatrixInv&&($.u_label_plane_matrix_inv=S.labelPlaneMatrixInv),m.setTerrainUniformValues(I,$),this.painter.transform.projection.name==="globe"){const fe=this.globeUniformValues(this.painter.transform,h.tileID.canonical,S&&S.useDenormalizedUpVectorScale);m.setGlobeUniformValues(I,fe)}}globeUniformValues(h,m,S){const I=h.projection;return{u_tile_tl_up:I.upVector(m,0,0),u_tile_tr_up:I.upVector(m,s.EXTENT,0),u_tile_br_up:I.upVector(m,s.EXTENT,s.EXTENT),u_tile_bl_up:I.upVector(m,0,s.EXTENT),u_tile_up_scale:S?s.globeMetersToEcef(1):I.upVectorScale(m,h.center.lat,h.worldSize).metersToTile}}renderToBackBuffer(h){const m=this.painter,S=this.painter.context;h.length!==0&&(S.bindFramebuffer.set(null),S.viewport.set([0,0,m.width,m.height]),m.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(I,L,$,H,Q){if(I.transform.projection.name==="globe")(function(ne,te,fe,ve,Te){const Ie=ne.context,Pe=Ie.gl;let Re,he;const Se=ne.options.showTerrainWireframe?2:0,Fe=ne.transform,ke=s.globeUseCustomAntiAliasing(ne,Ie,Fe),Qe=(Kt,vt)=>{if(he===Kt)return;const zt=[Vf[Kt],"PROJECTION_GLOBE_VIEW"];ke&&zt.push("CUSTOM_ANTIALIASING"),vt&&zt.push(Vf[Se]),Re=ne.useProgram("globeRaster",null,zt),he=Kt},et=ne.colorModeForRenderPass(),Je=new s.DepthMode(Pe.LEQUAL,s.DepthMode.ReadWrite,ne.depthRangeFor3D);pa.update(Te);const lt=s.calculateGlobeMercatorMatrix(Fe),at=[s.mercatorXfromLng(Fe.center.lng),s.mercatorYfromLat(Fe.center.lat)],xt=Se?[!1,!0]:[!1],en=ne.globeSharedBuffers,At=[Fe.width*s.exported.devicePixelRatio,Fe.height*s.exported.devicePixelRatio],Ut=Float32Array.from(Fe.globeMatrix),St={useDenormalizedUpVectorScale:!0};if(xt.forEach(Kt=>{const vt=ne.transform,zt=Uc(vt.zoom)*te.exaggeration();he=-1;const nn=Kt?Pe.LINES:Pe.TRIANGLES;for(const Ht of ve){const an=fe.getTile(Ht),Wn=s.StencilMode.disabled,hr=te.prevTerrainTileForTile[Ht.key],kn=te.terrainTileForTile[Ht.key];fu(hr,kn)&&pa.newMorphing(Ht.key,hr,kn,Te,250),Ie.activeTexture.set(Pe.TEXTURE0),an.texture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE);const er=pa.getMorphValuesForProxy(Ht.key),Fr=er?1:0;er&&s.extend$1(St,{morphing:{srcDemTile:er.from,dstDemTile:er.to,phase:s.easeCubicInOut(er.phase)}});const Nr=s.tileCornersToBounds(Ht.canonical),Vn=s.getLatitudinalLod(Nr.getCenter().lat),fi=s.getGridMatrix(Ht.canonical,Nr,Vn,vt.worldSize/vt._pixelsPerMercatorPixel),bi=s.globeNormalizeECEF(s.globeTileBounds(Ht.canonical)),wi=fp(vt.projMatrix,Ut,lt,bi,s.globeToMercatorTransition(vt.zoom),at,vt.frustumCorners.TL,vt.frustumCorners.TR,vt.frustumCorners.BR,vt.frustumCorners.BL,vt.globeCenterInViewSpace,vt.globeRadius,At,zt,fi);if(Qe(Fr,Kt),te.setupElevationDraw(an,Re,St),ne.prepareDrawProgram(Ie,Re,Ht.toUnwrapped()),en){const[Ei,_a,Ns]=Kt?en.getWirefameBuffers(ne.context,Vn):en.getGridBuffers(Vn,zt!==0);Re.draw(Ie,nn,Je,Wn,et,s.CullFaceMode.backCCW,wi,"globe_raster",Ei,_a,Ns)}}}),en){const Kt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ke&&Kt.push("CUSTOM_ANTIALIASING"),Re=ne.useProgram("globeRaster",null,Kt);for(const vt of ve){const{x:zt,y:nn,z:Ht}=vt.canonical,an=nn===0,Wn=nn===(1<<Ht)-1,[hr,kn,er,Fr]=en.getPoleBuffers(Ht);if(Fr&&(an||Wn)){const Nr=fe.getTile(vt);Ie.activeTexture.set(Pe.TEXTURE0),Nr.texture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE);let Vn=s.globePoleMatrixForTile(Ht,zt,Fe);const fi=s.globeNormalizeECEF(s.globeTileBounds(vt.canonical)),bi=(wi,Ei)=>wi.draw(Ie,Pe.TRIANGLES,Je,s.StencilMode.disabled,et,s.CullFaceMode.disabled,fp(Fe.projMatrix,Vn,Vn,fi,0,at,Fe.frustumCorners.TL,Fe.frustumCorners.TR,Fe.frustumCorners.BR,Fe.frustumCorners.BL,Fe.globeCenterInViewSpace,Fe.globeRadius,At,0),"globe_pole_raster",Ei,er,Fr);te.setupElevationDraw(Nr,Re,St),ne.prepareDrawProgram(Ie,Re,vt.toUnwrapped()),an&&bi(Re,hr),Wn&&(Vn=s.scale(s.create(),Vn,[1,-1,1]),bi(Re,kn))}}}})(I,L,$,H,Q);else{const ne=I.context,te=ne.gl;let fe,ve;const Te=I.options.showTerrainWireframe?2:0,Ie=(Fe,ke)=>{if(ve===Fe)return;const Qe=[Vf[Fe]];ke&&Qe.push(Vf[Te]),fe=I.useProgram("terrainRaster",null,Qe),ve=Fe},Pe=I.colorModeForRenderPass(),Re=new s.DepthMode(te.LEQUAL,s.DepthMode.ReadWrite,I.depthRangeFor3D);pa.update(Q);const he=I.transform,Se=Uc(he.zoom)*L.exaggeration();(Te?[!1,!0]:[!1]).forEach(Fe=>{ve=-1;const ke=Fe?te.LINES:te.TRIANGLES,[Qe,et]=Fe?L.getWirefameBuffer():[L.gridIndexBuffer,L.gridSegments];for(const Je of H){const lt=$.getTile(Je),at=s.StencilMode.disabled,xt=L.prevTerrainTileForTile[Je.key],en=L.terrainTileForTile[Je.key];fu(xt,en)&&pa.newMorphing(Je.key,xt,en,Q,250),ne.activeTexture.set(te.TEXTURE0),lt.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE,te.LINEAR_MIPMAP_NEAREST);const At=pa.getMorphValuesForProxy(Je.key),Ut=At?1:0;let St;At&&(St={morphing:{srcDemTile:At.from,dstDemTile:At.to,phase:s.easeCubicInOut(At.phase)}});const Kt=jf(Je.projMatrix,P_(Je.canonical,he.renderWorldCopies)?Se/10:Se);Ie(Ut,Fe),L.setupElevationDraw(lt,fe,St),I.prepareDrawProgram(ne,fe,Je.toUnwrapped()),fe.draw(ne,ke,Re,at,Pe,s.CullFaceMode.backCCW,Kt,"terrain_raster",L.gridBuffer,Qe,et)}})}}(m,this,this.proxySourceCache,h,this._updateTimestamp),this.renderingToTexture=!0,m.gpuTimingDeferredRenderEnd(),h.splice(0,h.length))}renderBatch(h){if(this._drapedRenderBatches.length===0)return h+1;this.renderingToTexture=!0;const m=this.painter,S=this.painter.context,I=this.proxySourceCache,L=this.proxiedCoords[I.id],$=this._drapedRenderBatches.shift(),H=[],Q=m.style.order;let ne=0;for(const te of L){const fe=I.getTileByID(te.proxyTileKey),ve=I.proxyCachedFBO[te.key]?I.proxyCachedFBO[te.key][h]:void 0,Te=ve!==void 0?I.renderCache[ve]:this.pool[ne++],Ie=ve!==void 0;if(fe.texture=Te.tex,Ie&&!Te.dirty){H.push(fe.tileID);continue}let Pe;S.bindFramebuffer.set(Te.fb.framebuffer),this.renderedToTile=!1,Te.dirty&&(S.clear({color:s.Color.transparent,stencil:0}),Te.dirty=!1);for(let Re=$.start;Re<=$.end;++Re){const he=m.style._layers[Q[Re]];if(he.isHidden(m.transform.zoom))continue;const Se=m.style._getLayerSourceCache(he),Fe=Se?this.proxyToSource[te.key][Se.id]:[te];if(!Fe)continue;const ke=Fe;S.viewport.set([0,0,Te.fb.width,Te.fb.height]),Pe!==(Se?Se.id:null)&&(this._setupStencil(Te,Fe,he,Se),Pe=Se?Se.id:null),m.renderLayer(m,Se,he,ke)}this.renderedToTile?(Te.dirty=!0,H.push(fe.tileID)):Ie||--ne,ne===5&&(ne=0,this.renderToBackBuffer(H))}return this.renderToBackBuffer(H),this.renderingToTexture=!1,S.bindFramebuffer.set(null),S.viewport.set([0,0,m.width,m.height]),$.end+1}postRender(){}renderCacheEfficiency(h){const m=h.order.length;if(m===0)return{efficiency:100};let S,I=0,L=0,$=!1;for(let H=0;H<m;++H){const Q=h._layers[h.order[H]];this._style.isLayerDraped(Q)?($&&++I,++L):$||($=!0,S=Q.id)}return L===0?{efficiency:100}:{efficiency:100*(1-I/L),firstUndrapedLayer:S}}getMinElevationBelowMSL(){let h=0;return this._visibleDemTiles.filter(m=>m.dem).forEach(m=>{h=Math.min(h,m.dem.tree.minimums[0])}),h===0?h:(h-30)*this._exaggeration}raycast(h,m,S){if(!this._visibleDemTiles)return null;const I=this._visibleDemTiles.filter(L=>L.dem).map(L=>{const $=L.tileID,H=1<<$.overscaledZ,{x:Q,y:ne}=$.canonical,te=Q/H,fe=(Q+1)/H,ve=ne/H,Te=(ne+1)/H;return{minx:te,miny:ve,maxx:fe,maxy:Te,t:L.dem.tree.raycastRoot(te,ve,fe,Te,h,m,S),tile:L}});I.sort((L,$)=>(L.t!==null?L.t:Number.MAX_VALUE)-($.t!==null?$.t:Number.MAX_VALUE));for(const L of I){if(L.t==null)return null;const $=L.tile.dem.tree.raycast(L.minx,L.miny,L.maxx,L.maxy,h,m,S);if($!=null)return $}return null}_createFBO(){const h=this.painter.context,m=h.gl,S=this.drapeBufferSize;h.activeTexture.set(m.TEXTURE0);const I=new s.Texture(h,{width:S[0],height:S[1],data:null},m.RGBA);I.bind(m.LINEAR,m.CLAMP_TO_EDGE);const L=h.createFramebuffer(S[0],S[1],!1);return L.colorAttachment.set(I.texture),L.depthAttachment=new rt(h,L.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=h.createRenderbuffer(h.gl.DEPTH_STENCIL,S[0],S[1]),this._stencilRef=0,L.depthAttachment.set(this._sharedDepthStencil),h.clear({stencil:0})):L.depthAttachment.set(this._sharedDepthStencil),h.extTextureFilterAnisotropic&&!h.extTextureFilterAnisotropicForceOff&&m.texParameterf(m.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax),{fb:L,tex:I,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h].hasTransition())return!0;return this._style.order.some(h=>{const m=this._style._layers[h],S=m.isHidden(this.painter.transform.zoom);return m.type==="custom"?!S&&m.shouldRedrape():!S&&m.hasTransition()})}_clearLineLayersFromRenderCache(){let h=!1;for(const S of this._style._getSources())if(S instanceof dn){h=!0;break}if(!h)return;const m={};for(let S=0;S<this._style.order.length;++S){const I=this._style._layers[this._style.order[S]],L=this._style._getLayerSourceCache(I);if(L&&!m[L.id]&&!I.isHidden(this.painter.transform.zoom)&&I.type==="line"&&I.widthExpression()instanceof s.ZoomDependentExpression){m[L.id]=!0;for(const $ of this.proxyCoords){const H=this.proxyToSource[$.key][L.id];if(H)for(const Q of H)this._clearRenderCacheForTile(L.id,Q)}}}}_clearRasterLayersFromRenderCache(){let h=!1;for(const S in this._style._sourceCaches)if(this._style._sourceCaches[S]._source instanceof Qt){h=!0;break}if(!h)return;const m={};for(let S=0;S<this._style.order.length;++S){const I=this._style._layers[this._style.order[S]],L=this._style._getLayerSourceCache(I);if(!L||m[L.id]||I.isHidden(this.painter.transform.zoom)||I.type!=="raster")continue;const $=I.paint.get("raster-fade-duration");for(const H of this.proxyCoords){const Q=this.proxyToSource[H.key][L.id];if(Q)for(const ne of Q){const te=MA(L.getTile(ne),L.findLoadedParent(ne,0),L,this.painter.transform,$);(te.opacity!==1||te.mix!==0)&&this._clearRenderCacheForTile(L.id,ne)}}}}_setupDrapedRenderBatches(){const h=this._style.order,m=h.length;if(m===0)return;const S=[];let I,L=0,$=this._style._layers[h[L]];for(;!this._style.isLayerDraped($)&&$.isHidden(this.painter.transform.zoom)&&++L<m;)$=this._style._layers[h[L]];for(;L<m;++L){const H=this._style._layers[h[L]];H.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(H)?I===void 0&&(I=L):I!==void 0&&(S.push({start:I,end:L-1}),I=void 0))}I!==void 0&&S.push({start:I,end:L-1}),this._drapedRenderBatches=S}_setupRenderCache(h){const m=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,m.renderCache.length>m.renderCachePool.length){const $=Object.values(m.proxyCachedFBO);m.proxyCachedFBO={};for(let H=0;H<$.length;++H){const Q=Object.values($[H]);m.renderCachePool.push(...Q)}}return}this._clearRasterLayersFromRenderCache();const S=this.proxyCoords,I=this._tilesDirty;for(let $=S.length-1;$>=0;$--){const H=S[$];if(m.getTileByID(H.key),m.proxyCachedFBO[H.key]!==void 0){const Q=h[H.key],ne=this.proxyToSource[H.key];let te=0;for(const fe in ne){const ve=ne[fe],Te=Q[fe];if(!Te||Te.length!==ve.length||ve.some((Ie,Pe)=>Ie!==Te[Pe]||I[fe]&&I[fe].hasOwnProperty(Ie.key))){te=-1;break}++te}for(const fe in m.proxyCachedFBO[H.key])m.renderCache[m.proxyCachedFBO[H.key][fe]].dirty=te<0||te!==Object.values(Q).length}}const L=[...this._drapedRenderBatches];L.sort(($,H)=>H.end-H.start-($.end-$.start));for(const $ of L)for(const H of S){if(m.proxyCachedFBO[H.key])continue;let Q=m.renderCachePool.pop();Q===void 0&&m.renderCache.length<50&&(Q=m.renderCache.length,m.renderCache.push(this._createFBO())),Q!==void 0&&(m.proxyCachedFBO[H.key]={},m.proxyCachedFBO[H.key][$.start]=Q,m.renderCache[Q].dirty=!0)}this._tilesDirty={}}_setupStencil(h,m,S,I){if(!I||!this._sourceTilesOverlap[I.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const L=this.painter.context,$=L.gl;if(m.length<=1)return void(this._overlapStencilType=!1);let H;if(S.isTileClipped())H=m.length,this._overlapStencilMode.test={func:$.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(m[0].overscaledZ>m[m.length-1].overscaledZ))return void(this._overlapStencilType=!1);H=1,this._overlapStencilMode.test={func:$.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+H>255&&(L.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=H,this._overlapStencilMode.ref=this._stencilRef,S.isTileClipped()&&this._renderTileClippingMasks(m,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(h){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[h.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(h,m){const S=this.painter,I=this.painter.context,L=I.gl;S._tileClippingMaskIDs={},I.setColorMode(s.ColorMode.disabled),I.setDepthMode(s.DepthMode.disabled);const $=S.useProgram("clippingMask");for(const H of h){const Q=S._tileClippingMaskIDs[H.key]=--m;$.draw(I,L.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:L.ALWAYS,mask:0},Q,255,L.KEEP,L.KEEP,L.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,hp(H.projMatrix),"$clipping",S.tileExtentBuffer,S.quadTriangleIndexBuffer,S.tileExtentSegments)}}pointCoordinate(h){const m=this.painter.transform;if(h.x<0||h.x>m.width||h.y<0||h.y>m.height)return null;const S=[h.x,h.y,1,1];s.transformMat4$1(S,S,m.pixelMatrixInverse),s.scale$1(S,S,1/S[3]),S[0]/=m.worldSize,S[1]/=m.worldSize;const I=m._camera.position,L=s.mercatorZfromAltitude(1,m.center.lat),$=[I[0],I[1],I[2]/L,0],H=s.subtract([],S.slice(0,3),$);s.normalize(H,H);const Q=this.raycast($,H,this._exaggeration);return Q!==null&&Q?(s.scaleAndAdd($,$,H,Q),$[3]=$[2],$[2]*=L,$):null}drawDepth(){const h=this.painter,m=h.context,S=this.proxySourceCache,I=Math.ceil(h.width),L=Math.ceil(h.height);if(!this._depthFBO||this._depthFBO.width===I&&this._depthFBO.height===L||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const $=m.gl,H=m.createFramebuffer(I,L,!0);m.activeTexture.set($.TEXTURE0);const Q=new s.Texture(m,{width:I,height:L,data:null},$.RGBA);Q.bind($.NEAREST,$.CLAMP_TO_EDGE),H.colorAttachment.set(Q.texture);const ne=m.createRenderbuffer(m.gl.DEPTH_COMPONENT16,I,L);H.depthAttachment.set(ne),this._depthFBO=H,this._depthTexture=Q}m.bindFramebuffer.set(this._depthFBO.framebuffer),m.viewport.set([0,0,I,L]),function($,H,Q,ne){if($.transform.projection.name==="globe")return;const te=$.context,fe=te.gl;te.clear({depth:1});const ve=$.useProgram("terrainDepth"),Te=new s.DepthMode(fe.LESS,s.DepthMode.ReadWrite,$.depthRangeFor3D);for(const Ie of ne){const Pe=Q.getTile(Ie),Re=jf(Ie.projMatrix,0);H.setupElevationDraw(Pe,ve),ve.draw(te,fe.TRIANGLES,Te,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,Re,"terrain_depth",H.gridBuffer,H.gridIndexBuffer,H.gridNoSkirtSegments)}}(h,this,S,this.proxyCoords)}_setupProxiedCoordsForOrtho(h,m,S){if(h.getSource()instanceof pr)return this._setupProxiedCoordsForImageSource(h,m,S);this._findCoveringTileCache[h.id]=this._findCoveringTileCache[h.id]||{};const I=this.proxiedCoords[h.id]=[],L=this.proxyCoords;for(let H=0;H<L.length;H++){const Q=L[H],ne=this._findTileCoveringTileID(Q,h);if(ne){const te=this._createProxiedId(Q,ne,S[Q.key]&&S[Q.key][h.id]);I.push(te),this.proxyToSource[Q.key][h.id]=[te]}}let $=!1;for(let H=0;H<m.length;H++){const Q=h.getTile(m[H]);if(!Q||!Q.hasData())continue;const ne=this._findTileCoveringTileID(Q.tileID,this.proxySourceCache);if(ne&&ne.tileID.canonical.z!==Q.tileID.canonical.z){const te=this.proxyToSource[ne.tileID.key][h.id],fe=this._createProxiedId(ne.tileID,Q,S[ne.tileID.key]&&S[ne.tileID.key][h.id]);te?te.splice(te.length-1,0,fe):this.proxyToSource[ne.tileID.key][h.id]=[fe],I.push(fe),$=!0}}this._sourceTilesOverlap[h.id]=$}_setupProxiedCoordsForImageSource(h,m,S){if(!h.getSource().loaded())return;const I=this.proxiedCoords[h.id]=[],L=this.proxyCoords,$=h.getSource(),H=new s.Point($.tileID.x,$.tileID.y)._div(1<<$.tileID.z),Q=$.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((te,fe)=>(te.min.x=Math.min(te.min.x,fe.x-H.x),te.min.y=Math.min(te.min.y,fe.y-H.y),te.max.x=Math.max(te.max.x,fe.x-H.x),te.max.y=Math.max(te.max.y,fe.y-H.y),te),{min:new s.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),ne=(te,fe)=>{const ve=te.wrap+te.canonical.x/(1<<te.canonical.z),Te=te.canonical.y/(1<<te.canonical.z),Ie=s.EXTENT/(1<<te.canonical.z),Pe=fe.wrap+fe.canonical.x/(1<<fe.canonical.z),Re=fe.canonical.y/(1<<fe.canonical.z);return ve+Ie<Pe+Q.min.x||ve>Pe+Q.max.x||Te+Ie<Re+Q.min.y||Te>Re+Q.max.y};for(let te=0;te<L.length;te++){const fe=L[te];for(let ve=0;ve<m.length;ve++){const Te=h.getTile(m[ve]);if(!Te||!Te.hasData()||ne(fe,Te.tileID))continue;const Ie=this._createProxiedId(fe,Te,S[fe.key]&&S[fe.key][h.id]),Pe=this.proxyToSource[fe.key][h.id];Pe?Pe.push(Ie):this.proxyToSource[fe.key][h.id]=[Ie],I.push(Ie)}}}_createProxiedId(h,m,S){let I=this.orthoMatrix;if(S){const L=S.find($=>$.key===m.tileID.key);if(L)return L}if(m.tileID.key!==h.key){const L=h.canonical.z-m.tileID.canonical.z;let $,H,Q;I=s.create();const ne=m.tileID.wrap-h.wrap<<h.overscaledZ;L>0?($=s.EXTENT>>L,H=$*((m.tileID.canonical.x<<L)-h.canonical.x+ne),Q=$*((m.tileID.canonical.y<<L)-h.canonical.y)):($=s.EXTENT<<-L,H=s.EXTENT*(m.tileID.canonical.x-(h.canonical.x+ne<<-L)),Q=s.EXTENT*(m.tileID.canonical.y-(h.canonical.y<<-L))),s.ortho(I,0,$,0,$,0,1),s.translate(I,I,[H,Q,0])}return new Bg(m.tileID,h.key,I)}_findTileCoveringTileID(h,m){let S=m.getTile(h);if(S&&S.hasData())return S;const I=this._findCoveringTileCache[m.id],L=I[h.key];if(S=L?m.getTileByID(L):null,S&&S.hasData()||L===null)return S;let $=S?S.tileID:h,H=$.overscaledZ;const Q=m.getSource().minzoom,ne=[];if(!L){const fe=m.getSource().maxzoom;if(h.canonical.z>=fe){const ve=h.canonical.z-fe;m.getSource().reparseOverscaled?(H=Math.max(h.canonical.z+2,m.transform.tileZoom),$=new s.OverscaledTileID(H,h.wrap,fe,h.canonical.x>>ve,h.canonical.y>>ve)):ve!==0&&(H=fe,$=new s.OverscaledTileID(H,h.wrap,fe,h.canonical.x>>ve,h.canonical.y>>ve))}$.key!==h.key&&(ne.push($.key),S=m.getTile($))}const te=fe=>{ne.forEach(ve=>{I[ve]=fe}),ne.length=0};for(H-=1;H>=Q&&(!S||!S.hasData());H--){S&&te(S.tileID.key);const fe=$.calculateScaledKey(H);if(S=m.getTileByID(fe),S&&S.hasData())break;const ve=I[fe];if(ve===null)break;ve===void 0?ne.push(fe):S=m.getTileByID(ve)}return te(S?S.tileID.key:null),S&&S.hasData()?S:null}findDEMTileFor(h){return this.enabled?this._findTileCoveringTileID(h,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(h,m){let S=this._tilesDirty[h];S||(S=this._tilesDirty[h]={}),S[m.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const h=function(m){let S=0;const I=new s.StructArrayLayout2ui4,L=131;for(let $=1;$<129;$++){for(let H=1;H<129;H++)S=$*L+H,I.emplaceBack(S,S+1),I.emplaceBack(S,S+L),I.emplaceBack(S+1,S+L),$===128&&I.emplaceBack(S+L,S+L+1);I.emplaceBack(S+1,S+1+L)}return I}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(h),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,h.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class jr{static cacheKey(h,m,S,I){let L=`${m}${I?I.cacheKey:""}`;for(const $ of S)h.usedDefines.includes($)&&(L+=`/${$}`);return L}constructor(h,m,S,I,L,$){const H=h.gl;this.program=H.createProgram();const Q=function(he){const Se=[];for(let Fe=0;Fe<he.length;Fe++){if(he[Fe]===null)continue;const ke=he[Fe].split(" ");Se.push(ke.pop())}return Se}(S.staticAttributes),ne=I?I.getBinderAttributes():[],te=Q.concat(ne);let fe=I?I.defines():[];fe=fe.concat($.map(he=>`#define ${he}`));const ve=h.isWebGL2?`#version 300 es
`:"",Te=ve+fe.concat(h.extStandardDerivatives&&ve.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Rg):Rg,Rg,Og,C_.fragmentSource,zf.fragmentSource,S.fragmentSource).join(`
`),Ie=ve+fe.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Og,C_.vertexSource,zf.vertexSource,up.vertexSource,S.vertexSource).join(`
`),Pe=H.createShader(H.FRAGMENT_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);H.shaderSource(Pe,Te),H.compileShader(Pe),H.attachShader(this.program,Pe);const Re=H.createShader(H.VERTEX_SHADER);if(H.isContextLost())this.failedToCreate=!0;else{H.shaderSource(Re,Ie),H.compileShader(Re),H.attachShader(this.program,Re),this.attributes={},this.numAttributes=te.length;for(let he=0;he<this.numAttributes;he++)te[he]&&(H.bindAttribLocation(this.program,he,te[he]),this.attributes[te[he]]=he);H.linkProgram(this.program),H.deleteShader(Re),H.deleteShader(Pe),this.fixedUniforms=L(h),this.binderUniforms=I?I.getUniforms(h):[],$.includes("TERRAIN")&&(this.terrainUniforms=(he=>({u_dem:new s.Uniform1i(he),u_dem_prev:new s.Uniform1i(he),u_dem_unpack:new s.Uniform4f(he),u_dem_tl:new s.Uniform2f(he),u_dem_scale:new s.Uniform1f(he),u_dem_tl_prev:new s.Uniform2f(he),u_dem_scale_prev:new s.Uniform1f(he),u_dem_size:new s.Uniform1f(he),u_dem_lerp:new s.Uniform1f(he),u_exaggeration:new s.Uniform1f(he),u_depth:new s.Uniform1i(he),u_depth_size_inv:new s.Uniform2f(he),u_meter_to_dem:new s.Uniform1f(he),u_label_plane_matrix_inv:new s.UniformMatrix4f(he)}))(h)),$.includes("GLOBE")&&(this.globeUniforms=(he=>({u_tile_tl_up:new s.Uniform3f(he),u_tile_tr_up:new s.Uniform3f(he),u_tile_br_up:new s.Uniform3f(he),u_tile_bl_up:new s.Uniform3f(he),u_tile_up_scale:new s.Uniform1f(he)}))(h)),$.includes("FOG")&&(this.fogUniforms=(he=>({u_fog_matrix:new s.UniformMatrix4f(he),u_fog_range:new s.Uniform2f(he),u_fog_color:new s.Uniform4f(he),u_fog_horizon_blend:new s.Uniform1f(he),u_fog_temporal_offset:new s.Uniform1f(he),u_frustum_tl:new s.Uniform3f(he),u_frustum_tr:new s.Uniform3f(he),u_frustum_br:new s.Uniform3f(he),u_frustum_bl:new s.Uniform3f(he),u_globe_pos:new s.Uniform3f(he),u_globe_radius:new s.Uniform1f(he),u_globe_transition:new s.Uniform1f(he),u_is_globe:new s.Uniform1i(he),u_viewport:new s.Uniform2f(he)}))(h))}}setTerrainUniformValues(h,m){if(!this.terrainUniforms)return;const S=this.terrainUniforms;if(!this.failedToCreate){h.program.set(this.program);for(const I in m)S[I]&&S[I].set(this.program,I,m[I])}}setGlobeUniformValues(h,m){if(!this.globeUniforms)return;const S=this.globeUniforms;if(!this.failedToCreate){h.program.set(this.program);for(const I in m)S[I]&&S[I].set(this.program,I,m[I])}}setFogUniformValues(h,m){if(!this.fogUniforms)return;const S=this.fogUniforms;if(!this.failedToCreate){h.program.set(this.program);for(const I in m)S[I].set(this.program,I,m[I])}}draw(h,m,S,I,L,$,H,Q,ne,te,fe,ve,Te,Ie,Pe){const Re=h.gl;if(this.failedToCreate)return;h.program.set(this.program),h.setDepthMode(S),h.setStencilMode(I),h.setColorMode(L),h.setCullFace($);for(const Se of Object.keys(this.fixedUniforms))this.fixedUniforms[Se].set(this.program,Se,H[Se]);Ie&&Ie.setUniforms(this.program,h,this.binderUniforms,ve,{zoom:Te});const he={[Re.LINES]:2,[Re.TRIANGLES]:3,[Re.LINE_STRIP]:1}[m];for(const Se of fe.get()){const Fe=Se.vaos||(Se.vaos={});(Fe[Q]||(Fe[Q]=new cp)).bind(h,this,ne,Ie?Ie.getPaintVertexBuffers():[],te,Se.vertexOffset,Pe||[]),Re.drawElements(m,Se.primitiveLength*he,Re.UNSIGNED_SHORT,Se.primitiveOffset*he*2)}}}function hu(v,h){const m=Math.pow(2,h.tileID.overscaledZ),S=h.tileSize*Math.pow(2,v.transform.tileZoom)/m,I=S*(h.tileID.canonical.x+h.tileID.wrap*m),L=S*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_tile_units_to_pixels:1/qe(h,1,v.transform.tileZoom),u_pixel_coord_upper:[I>>16,L>>16],u_pixel_coord_lower:[65535&I,65535&L]}}const I_=s.create(),LA=(v,h,m,S,I,L,$,H,Q,ne,te)=>{const fe=h.style.light,ve=fe.properties.get("position"),Te=[ve.x,ve.y,ve.z],Ie=s.create$1();fe.properties.get("anchor")==="viewport"&&(s.fromRotation(Ie,-h.transform.angle),s.transformMat3(Te,Te,Ie));const Pe=fe.properties.get("color"),Re=h.transform,he={u_matrix:v,u_lightpos:Te,u_lightintensity:fe.properties.get("intensity"),u_lightcolor:[Pe.r,Pe.g,Pe.b],u_vertical_gradient:+m,u_opacity:S,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:I_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:I,u_edge_radius:L};return Re.projection.name==="globe"&&(he.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],he.u_zoom_transition=Q,he.u_inv_rot_matrix=te,he.u_merc_center=ne,he.u_up_dir=Re.projection.upVector(new s.CanonicalTileID(0,0,0),ne[0]*s.EXTENT,ne[1]*s.EXTENT),he.u_height_lift=H),he},M_=(v,h,m,S,I,L,$,H,Q,ne,te,fe)=>{const ve=LA(v,h,m,S,I,L,$,Q,ne,te,fe),Te={u_height_factor:-Math.pow(2,$.overscaledZ)/H.tileSize/8};return s.extend(ve,hu(h,H),Te)},$f=v=>({u_matrix:v}),DA=(v,h,m)=>s.extend($f(v),hu(h,m)),nx=(v,h)=>({u_matrix:v,u_world:h}),rx=(v,h,m,S)=>s.extend(DA(v,h,m),{u_world:S}),O_=s.create(),Ng=(v,h,m,S,I,L)=>{const $=v.transform,H=$.projection.name==="globe";let Q;if(L.paint.get("circle-pitch-alignment")==="map")if(H){const te=s.globePixelsToTileUnits($.zoom,h.canonical)*$._pixelsPerMercatorPixel;Q=Float32Array.from([te,0,0,te])}else Q=$.calculatePixelsToTileUnitsMatrix(m);else Q=new Float32Array([$.pixelsToGLUnits[0],0,0,$.pixelsToGLUnits[1]]);const ne={u_camera_to_center_distance:$.cameraToCenterDistance,u_matrix:v.translatePosMatrix(h.projMatrix,m,L.paint.get("circle-translate"),L.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:Q,u_inv_rot_matrix:O_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(H){ne.u_inv_rot_matrix=S,ne.u_merc_center=I,ne.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],ne.u_zoom_transition=s.globeToMercatorTransition($.zoom);const te=I[0]*s.EXTENT,fe=I[1]*s.EXTENT;ne.u_up_dir=$.projection.upVector(new s.CanonicalTileID(0,0,0),te,fe)}return ne},dp=v=>{const h=[];return v.paint.get("circle-pitch-alignment")==="map"&&h.push("PITCH_WITH_MAP"),v.paint.get("circle-pitch-scale")==="map"&&h.push("SCALE_WITH_MAP"),h},BA=(v,h,m,S)=>{const I=s.EXTENT/m.tileSize;return{u_matrix:v,u_camera_to_center_distance:h.getCameraToCenterDistance(S),u_extrude_scale:[h.pixelsToGLUnits[0]/I,h.pixelsToGLUnits[1]/I]}},bs=(v,h,m=1)=>({u_matrix:v,u_color:h,u_overlay:0,u_overlay_scale:m}),No=s.create(),R_=(v,h,m,S,I,L,$)=>{const H=v.transform,Q=H.projection.name==="globe",ne=Q?s.globePixelsToTileUnits(H.zoom,h.canonical)*H._pixelsPerMercatorPixel:qe(m,1,L),te={u_matrix:h.projMatrix,u_extrude_scale:ne,u_intensity:$,u_inv_rot_matrix:No,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(Q){te.u_inv_rot_matrix=S,te.u_merc_center=I,te.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],te.u_zoom_transition=s.globeToMercatorTransition(H.zoom);const fe=I[0]*s.EXTENT,ve=I[1]*s.EXTENT;te.u_up_dir=H.projection.upVector(new s.CanonicalTileID(0,0,0),fe,ve)}return te},ix=(v,h,m,S,I,L,$)=>{const H=v.transform,Q=H.calculatePixelsToTileUnitsMatrix(h);return{u_matrix:NA(v,h,m,S),u_pixels_to_tile_units:Q,u_device_pixel_ratio:L,u_units_to_pixels:[1/H.pixelsToGLUnits[0],1/H.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:I,u_texsize:fs(m)?h.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Xh(h,v.transform),u_alpha_discard_threshold:0,u_trim_offset:$}},pp=(v,h,m,S,I)=>{const L=v.transform;return{u_matrix:NA(v,h,m,S),u_texsize:h.imageAtlasTexture.size,u_pixels_to_tile_units:L.calculatePixelsToTileUnitsMatrix(h),u_device_pixel_ratio:I,u_image:0,u_tile_units_to_pixels:Xh(h,L),u_units_to_pixels:[1/L.pixelsToGLUnits[0],1/L.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Xh(v,h){return 1/qe(v,1,h.tileZoom)}function NA(v,h,m,S){return v.translatePosMatrix(S||h.tileID.projMatrix,h,m.paint.get("line-translate"),m.paint.get("line-translate-anchor"))}function fs(v){const h=v.paint.get("line-dasharray").value;return h.value||h.kind!=="constant"}const gp=(v,h,m,S,I,L)=>{return{u_matrix:v,u_tl_parent:h,u_scale_parent:m,u_fade_t:S.mix,u_opacity:S.opacity*I.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:I.paint.get("raster-brightness-min"),u_brightness_high:I.paint.get("raster-brightness-max"),u_saturation_factor:(H=I.paint.get("raster-saturation"),H>0?1-1/(1.001-H):-H),u_contrast_factor:($=I.paint.get("raster-contrast"),$>0?1/(1-$):1+$),u_spin_weights:ws(I.paint.get("raster-hue-rotate")),u_perspective_transform:L};var $,H};function ws(v){v*=Math.PI/180;const h=Math.sin(v),m=Math.cos(v);return[(2*m+1)/3,(-Math.sqrt(3)*h-m+1)/3,(Math.sqrt(3)*h-m+1)/3]}const Fg=s.create(),mp=(v,h,m,S,I,L,$,H,Q,ne,te,fe,ve,Te,Ie,Pe)=>{const Re=I.transform,he={u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:Re.cameraToCenterDistance,u_rotate_symbol:+m,u_aspect_ratio:Re.width/Re.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_matrix:L,u_label_plane_matrix:$,u_coord_matrix:H,u_is_text:+Q,u_pitch_with_map:+S,u_texsize:ne,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Fg,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Fg,u_up_vector:[0,-1,0]};return Pe.name==="globe"&&(he.u_tile_id=[te.canonical.x,te.canonical.y,1<<te.canonical.z],he.u_zoom_transition=fe,he.u_inv_rot_matrix=Te,he.u_merc_center=ve,he.u_camera_forward=Re._camera.forward(),he.u_ecef_origin=s.globeECEFOrigin(Re.globeMatrix,te.toUnwrapped()),he.u_tile_matrix=Float32Array.from(Re.globeMatrix),he.u_up_vector=Ie),he},kg=(v,h,m,S,I,L,$,H,Q,ne,te,fe,ve,Te,Ie,Pe,Re)=>s.extend(mp(v,h,m,S,I,L,$,H,Q,ne,fe,ve,Te,Ie,Pe,Re),{u_gamma_scale:S?I.transform.cameraToCenterDistance*Math.cos(I.terrain?0:I.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+te}),Ua=(v,h,m,S,I,L,$,H,Q,ne,te,fe,ve,Te,Ie,Pe)=>s.extend(kg(v,h,m,S,I,L,$,H,!0,Q,!0,te,fe,ve,Te,Ie,Pe),{u_texsize_icon:ne,u_texture_icon:1}),zg=(v,h,m)=>({u_matrix:v,u_opacity:h,u_color:m}),FA=(v,h,m,S,I)=>s.extend(function(L,$,H){const Q=$.imageManager.getPattern(L.toString()),{width:ne,height:te}=$.imageManager.getPixelSize(),fe=Math.pow(2,H.tileID.overscaledZ),ve=H.tileSize*Math.pow(2,$.transform.tileZoom)/fe,Te=ve*(H.tileID.canonical.x+H.tileID.wrap*fe),Ie=ve*H.tileID.canonical.y;return{u_image:0,u_pattern_tl:Q.tl,u_pattern_br:Q.br,u_texsize:[ne,te],u_pattern_size:Q.displaySize,u_tile_units_to_pixels:1/qe(H,1,$.transform.tileZoom),u_pixel_coord_upper:[Te>>16,Ie>>16],u_pixel_coord_lower:[65535&Te,65535&Ie]}}(S,m,I),{u_matrix:v,u_opacity:h}),Hf={fillExtrusion:v=>({u_matrix:new s.UniformMatrix4f(v),u_lightpos:new s.Uniform3f(v),u_lightintensity:new s.Uniform1f(v),u_lightcolor:new s.Uniform3f(v),u_vertical_gradient:new s.Uniform1f(v),u_opacity:new s.Uniform1f(v),u_edge_radius:new s.Uniform1f(v),u_ao:new s.Uniform2f(v),u_tile_id:new s.Uniform3f(v),u_zoom_transition:new s.Uniform1f(v),u_inv_rot_matrix:new s.UniformMatrix4f(v),u_merc_center:new s.Uniform2f(v),u_up_dir:new s.Uniform3f(v),u_height_lift:new s.Uniform1f(v)}),fillExtrusionPattern:v=>({u_matrix:new s.UniformMatrix4f(v),u_lightpos:new s.Uniform3f(v),u_lightintensity:new s.Uniform1f(v),u_lightcolor:new s.Uniform3f(v),u_vertical_gradient:new s.Uniform1f(v),u_height_factor:new s.Uniform1f(v),u_edge_radius:new s.Uniform1f(v),u_ao:new s.Uniform2f(v),u_tile_id:new s.Uniform3f(v),u_zoom_transition:new s.Uniform1f(v),u_inv_rot_matrix:new s.UniformMatrix4f(v),u_merc_center:new s.Uniform2f(v),u_up_dir:new s.Uniform3f(v),u_height_lift:new s.Uniform1f(v),u_image:new s.Uniform1i(v),u_texsize:new s.Uniform2f(v),u_pixel_coord_upper:new s.Uniform2f(v),u_pixel_coord_lower:new s.Uniform2f(v),u_tile_units_to_pixels:new s.Uniform1f(v),u_opacity:new s.Uniform1f(v)}),fill:v=>({u_matrix:new s.UniformMatrix4f(v)}),fillPattern:v=>({u_matrix:new s.UniformMatrix4f(v),u_image:new s.Uniform1i(v),u_texsize:new s.Uniform2f(v),u_pixel_coord_upper:new s.Uniform2f(v),u_pixel_coord_lower:new s.Uniform2f(v),u_tile_units_to_pixels:new s.Uniform1f(v)}),fillOutline:v=>({u_matrix:new s.UniformMatrix4f(v),u_world:new s.Uniform2f(v)}),fillOutlinePattern:v=>({u_matrix:new s.UniformMatrix4f(v),u_world:new s.Uniform2f(v),u_image:new s.Uniform1i(v),u_texsize:new s.Uniform2f(v),u_pixel_coord_upper:new s.Uniform2f(v),u_pixel_coord_lower:new s.Uniform2f(v),u_tile_units_to_pixels:new s.Uniform1f(v)}),circle:v=>({u_camera_to_center_distance:new s.Uniform1f(v),u_extrude_scale:new s.UniformMatrix2f(v),u_device_pixel_ratio:new s.Uniform1f(v),u_matrix:new s.UniformMatrix4f(v),u_inv_rot_matrix:new s.UniformMatrix4f(v),u_merc_center:new s.Uniform2f(v),u_tile_id:new s.Uniform3f(v),u_zoom_transition:new s.Uniform1f(v),u_up_dir:new s.Uniform3f(v)}),collisionBox:v=>({u_matrix:new s.UniformMatrix4f(v),u_camera_to_center_distance:new s.Uniform1f(v),u_extrude_scale:new s.Uniform2f(v)}),collisionCircle:v=>({u_matrix:new s.UniformMatrix4f(v),u_inv_matrix:new s.UniformMatrix4f(v),u_camera_to_center_distance:new s.Uniform1f(v),u_viewport_size:new s.Uniform2f(v)}),debug:v=>({u_color:new s.UniformColor(v),u_matrix:new s.UniformMatrix4f(v),u_overlay:new s.Uniform1i(v),u_overlay_scale:new s.Uniform1f(v)}),clippingMask:v=>({u_matrix:new s.UniformMatrix4f(v)}),heatmap:v=>({u_extrude_scale:new s.Uniform1f(v),u_intensity:new s.Uniform1f(v),u_matrix:new s.UniformMatrix4f(v),u_inv_rot_matrix:new s.UniformMatrix4f(v),u_merc_center:new s.Uniform2f(v),u_tile_id:new s.Uniform3f(v),u_zoom_transition:new s.Uniform1f(v),u_up_dir:new s.Uniform3f(v)}),heatmapTexture:v=>({u_image:new s.Uniform1i(v),u_color_ramp:new s.Uniform1i(v),u_opacity:new s.Uniform1f(v)}),hillshade:v=>({u_matrix:new s.UniformMatrix4f(v),u_image:new s.Uniform1i(v),u_latrange:new s.Uniform2f(v),u_light:new s.Uniform2f(v),u_shadow:new s.UniformColor(v),u_highlight:new s.UniformColor(v),u_accent:new s.UniformColor(v)}),hillshadePrepare:v=>({u_matrix:new s.UniformMatrix4f(v),u_image:new s.Uniform1i(v),u_dimension:new s.Uniform2f(v),u_zoom:new s.Uniform1f(v),u_unpack:new s.Uniform4f(v)}),line:v=>({u_matrix:new s.UniformMatrix4f(v),u_pixels_to_tile_units:new s.UniformMatrix2f(v),u_device_pixel_ratio:new s.Uniform1f(v),u_units_to_pixels:new s.Uniform2f(v),u_dash_image:new s.Uniform1i(v),u_gradient_image:new s.Uniform1i(v),u_image_height:new s.Uniform1f(v),u_texsize:new s.Uniform2f(v),u_tile_units_to_pixels:new s.Uniform1f(v),u_alpha_discard_threshold:new s.Uniform1f(v),u_trim_offset:new s.Uniform2f(v)}),linePattern:v=>({u_matrix:new s.UniformMatrix4f(v),u_texsize:new s.Uniform2f(v),u_pixels_to_tile_units:new s.UniformMatrix2f(v),u_device_pixel_ratio:new s.Uniform1f(v),u_image:new s.Uniform1i(v),u_units_to_pixels:new s.Uniform2f(v),u_tile_units_to_pixels:new s.Uniform1f(v),u_alpha_discard_threshold:new s.Uniform1f(v)}),raster:v=>({u_matrix:new s.UniformMatrix4f(v),u_tl_parent:new s.Uniform2f(v),u_scale_parent:new s.Uniform1f(v),u_fade_t:new s.Uniform1f(v),u_opacity:new s.Uniform1f(v),u_image0:new s.Uniform1i(v),u_image1:new s.Uniform1i(v),u_brightness_low:new s.Uniform1f(v),u_brightness_high:new s.Uniform1f(v),u_saturation_factor:new s.Uniform1f(v),u_contrast_factor:new s.Uniform1f(v),u_spin_weights:new s.Uniform3f(v),u_perspective_transform:new s.Uniform2f(v)}),symbolIcon:v=>({u_is_size_zoom_constant:new s.Uniform1i(v),u_is_size_feature_constant:new s.Uniform1i(v),u_size_t:new s.Uniform1f(v),u_size:new s.Uniform1f(v),u_camera_to_center_distance:new s.Uniform1f(v),u_rotate_symbol:new s.Uniform1i(v),u_aspect_ratio:new s.Uniform1f(v),u_fade_change:new s.Uniform1f(v),u_matrix:new s.UniformMatrix4f(v),u_label_plane_matrix:new s.UniformMatrix4f(v),u_coord_matrix:new s.UniformMatrix4f(v),u_is_text:new s.Uniform1i(v),u_pitch_with_map:new s.Uniform1i(v),u_texsize:new s.Uniform2f(v),u_tile_id:new s.Uniform3f(v),u_zoom_transition:new s.Uniform1f(v),u_inv_rot_matrix:new s.UniformMatrix4f(v),u_merc_center:new s.Uniform2f(v),u_camera_forward:new s.Uniform3f(v),u_tile_matrix:new s.UniformMatrix4f(v),u_up_vector:new s.Uniform3f(v),u_ecef_origin:new s.Uniform3f(v),u_texture:new s.Uniform1i(v)}),symbolSDF:v=>({u_is_size_zoom_constant:new s.Uniform1i(v),u_is_size_feature_constant:new s.Uniform1i(v),u_size_t:new s.Uniform1f(v),u_size:new s.Uniform1f(v),u_camera_to_center_distance:new s.Uniform1f(v),u_rotate_symbol:new s.Uniform1i(v),u_aspect_ratio:new s.Uniform1f(v),u_fade_change:new s.Uniform1f(v),u_matrix:new s.UniformMatrix4f(v),u_label_plane_matrix:new s.UniformMatrix4f(v),u_coord_matrix:new s.UniformMatrix4f(v),u_is_text:new s.Uniform1i(v),u_pitch_with_map:new s.Uniform1i(v),u_texsize:new s.Uniform2f(v),u_texture:new s.Uniform1i(v),u_gamma_scale:new s.Uniform1f(v),u_device_pixel_ratio:new s.Uniform1f(v),u_tile_id:new s.Uniform3f(v),u_zoom_transition:new s.Uniform1f(v),u_inv_rot_matrix:new s.UniformMatrix4f(v),u_merc_center:new s.Uniform2f(v),u_camera_forward:new s.Uniform3f(v),u_tile_matrix:new s.UniformMatrix4f(v),u_up_vector:new s.Uniform3f(v),u_ecef_origin:new s.Uniform3f(v),u_is_halo:new s.Uniform1i(v)}),symbolTextAndIcon:v=>({u_is_size_zoom_constant:new s.Uniform1i(v),u_is_size_feature_constant:new s.Uniform1i(v),u_size_t:new s.Uniform1f(v),u_size:new s.Uniform1f(v),u_camera_to_center_distance:new s.Uniform1f(v),u_rotate_symbol:new s.Uniform1i(v),u_aspect_ratio:new s.Uniform1f(v),u_fade_change:new s.Uniform1f(v),u_matrix:new s.UniformMatrix4f(v),u_label_plane_matrix:new s.UniformMatrix4f(v),u_coord_matrix:new s.UniformMatrix4f(v),u_is_text:new s.Uniform1i(v),u_pitch_with_map:new s.Uniform1i(v),u_texsize:new s.Uniform2f(v),u_texsize_icon:new s.Uniform2f(v),u_texture:new s.Uniform1i(v),u_texture_icon:new s.Uniform1i(v),u_gamma_scale:new s.Uniform1f(v),u_device_pixel_ratio:new s.Uniform1f(v),u_is_halo:new s.Uniform1i(v)}),background:v=>({u_matrix:new s.UniformMatrix4f(v),u_opacity:new s.Uniform1f(v),u_color:new s.UniformColor(v)}),backgroundPattern:v=>({u_matrix:new s.UniformMatrix4f(v),u_opacity:new s.Uniform1f(v),u_image:new s.Uniform1i(v),u_pattern_tl:new s.Uniform2f(v),u_pattern_br:new s.Uniform2f(v),u_texsize:new s.Uniform2f(v),u_pattern_size:new s.Uniform2f(v),u_pixel_coord_upper:new s.Uniform2f(v),u_pixel_coord_lower:new s.Uniform2f(v),u_tile_units_to_pixels:new s.Uniform1f(v)}),terrainRaster:IA,terrainDepth:IA,skybox:v=>({u_matrix:new s.UniformMatrix4f(v),u_sun_direction:new s.Uniform3f(v),u_cubemap:new s.Uniform1i(v),u_opacity:new s.Uniform1f(v),u_temporal_offset:new s.Uniform1f(v)}),skyboxGradient:v=>({u_matrix:new s.UniformMatrix4f(v),u_color_ramp:new s.Uniform1i(v),u_center_direction:new s.Uniform3f(v),u_radius:new s.Uniform1f(v),u_opacity:new s.Uniform1f(v),u_temporal_offset:new s.Uniform1f(v)}),skyboxCapture:v=>({u_matrix_3f:new s.UniformMatrix3f(v),u_sun_direction:new s.Uniform3f(v),u_sun_intensity:new s.Uniform1f(v),u_color_tint_r:new s.Uniform4f(v),u_color_tint_m:new s.Uniform4f(v),u_luminance:new s.Uniform1f(v)}),globeRaster:v=>({u_proj_matrix:new s.UniformMatrix4f(v),u_globe_matrix:new s.UniformMatrix4f(v),u_normalize_matrix:new s.UniformMatrix4f(v),u_merc_matrix:new s.UniformMatrix4f(v),u_zoom_transition:new s.Uniform1f(v),u_merc_center:new s.Uniform2f(v),u_image0:new s.Uniform1i(v),u_grid_matrix:new s.UniformMatrix3f(v),u_skirt_height:new s.Uniform1f(v),u_frustum_tl:new s.Uniform3f(v),u_frustum_tr:new s.Uniform3f(v),u_frustum_br:new s.Uniform3f(v),u_frustum_bl:new s.Uniform3f(v),u_globe_pos:new s.Uniform3f(v),u_globe_radius:new s.Uniform1f(v),u_viewport:new s.Uniform2f(v)}),globeAtmosphere:v=>({u_frustum_tl:new s.Uniform3f(v),u_frustum_tr:new s.Uniform3f(v),u_frustum_br:new s.Uniform3f(v),u_frustum_bl:new s.Uniform3f(v),u_horizon:new s.Uniform1f(v),u_transition:new s.Uniform1f(v),u_fadeout_range:new s.Uniform1f(v),u_color:new s.Uniform4f(v),u_high_color:new s.Uniform4f(v),u_space_color:new s.Uniform4f(v),u_star_intensity:new s.Uniform1f(v),u_star_density:new s.Uniform1f(v),u_star_size:new s.Uniform1f(v),u_temporal_offset:new s.Uniform1f(v),u_horizon_angle:new s.Uniform1f(v),u_rotation_matrix:new s.UniformMatrix4f(v)})};let du;function jl(v,h,m,S,I,L,$){const H=v.context,Q=H.gl,ne=v.transform,te=v.useProgram("collisionBox"),fe=[];let ve=0,Te=0;for(let ke=0;ke<S.length;ke++){const Qe=S[ke],et=h.getTile(Qe),Je=et.getBucket(m);if(!Je)continue;const lt=Oe(Qe,Je,ne);let at=lt;I[0]===0&&I[1]===0||(at=v.translatePosMatrix(lt,et,I,L));const xt=$?Je.textCollisionBox:Je.iconCollisionBox,en=Je.collisionCircleArray;if(en.length>0){const At=s.create(),Ut=at;s.mul(At,Je.placementInvProjMatrix,ne.glCoordMatrix),s.mul(At,At,Je.placementViewportMatrix),fe.push({circleArray:en,circleOffset:Te,transform:Ut,invTransform:At,projection:Je.getProjection()}),ve+=en.length/4,Te=ve}xt&&(v.terrain&&v.terrain.setupElevationDraw(et,te),te.draw(H,Q.LINES,s.DepthMode.disabled,s.StencilMode.disabled,v.colorModeForRenderPass(),s.CullFaceMode.disabled,BA(at,ne,et,Je.getProjection()),m.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,null,ne.zoom,null,[xt.collisionVertexBuffer,xt.collisionVertexBufferExt]))}if(!$||!fe.length)return;const Ie=v.useProgram("collisionCircle"),Pe=new s.StructArrayLayout2f1f2i16;Pe.resize(4*ve),Pe._trim();let Re=0;for(const ke of fe)for(let Qe=0;Qe<ke.circleArray.length/4;Qe++){const et=4*Qe,Je=ke.circleArray[et+0],lt=ke.circleArray[et+1],at=ke.circleArray[et+2],xt=ke.circleArray[et+3];Pe.emplace(Re++,Je,lt,at,xt,0),Pe.emplace(Re++,Je,lt,at,xt,1),Pe.emplace(Re++,Je,lt,at,xt,2),Pe.emplace(Re++,Je,lt,at,xt,3)}(!du||du.length<2*ve)&&(du=function(ke){const Qe=2*ke,et=new s.StructArrayLayout3ui6;et.resize(Qe),et._trim();for(let Je=0;Je<Qe;Je++){const lt=6*Je;et.uint16[lt+0]=4*Je+0,et.uint16[lt+1]=4*Je+1,et.uint16[lt+2]=4*Je+2,et.uint16[lt+3]=4*Je+2,et.uint16[lt+4]=4*Je+3,et.uint16[lt+5]=4*Je+0}return et}(ve));const he=H.createIndexBuffer(du,!0),Se=H.createVertexBuffer(Pe,s.collisionCircleLayout.members,!0);for(const ke of fe){const Qe={u_matrix:ke.transform,u_inv_matrix:ke.invTransform,u_camera_to_center_distance:(Fe=ne).getCameraToCenterDistance(ke.projection),u_viewport_size:[Fe.width,Fe.height]};Ie.draw(H,Q.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,v.colorModeForRenderPass(),s.CullFaceMode.disabled,Qe,m.id,Se,he,s.SegmentVector.simpleSegment(0,2*ke.circleOffset,ke.circleArray.length,ke.circleArray.length/2),null,ne.zoom)}var Fe;Se.destroy(),he.destroy()}const L_=s.create();function Ug({width:v,height:h,anchor:m,textOffset:S,textScale:I},L){const{horizontalAlign:$,verticalAlign:H}=s.getAnchorAlignment(m),Q=-($-.5)*v,ne=-(H-.5)*h,te=s.evaluateVariableOffset(m,S);return new s.Point((Q/I+te[0])*L,(ne/I+te[1])*L)}function ox(v,h,m,S,I,L,$,H,Q,ne,te){const fe=v.text.placedSymbolArray,ve=v.text.dynamicLayoutVertexArray,Te=v.icon.dynamicLayoutVertexArray,Ie={},Pe=v.getProjection(),Re=He(H,Pe,L),he=L.elevation,Se=Pe.upVectorScale(H.canonical,L.center.lat,L.worldSize).metersToTile;ve.clear();for(let Fe=0;Fe<fe.length;Fe++){const ke=fe.get(Fe),{tileAnchorX:Qe,tileAnchorY:et,numGlyphs:Je}=ke,lt=ke.hidden||!ke.crossTileID||v.allowVerticalPlacement&&!ke.placedOrientation?null:S[ke.crossTileID];if(lt){let at=0,xt=0,en=0;if(he){const an=he?he.getAtTileOffset(H,Qe,et):0,[Wn,hr,kn]=Pe.upVector(H.canonical,Qe,et);at=an*Wn*Se,xt=an*hr*Se,en=an*kn*Se}let[At,Ut,St,Kt]=gi(ke.projectedAnchorX+at,ke.projectedAnchorY+xt,ke.projectedAnchorZ+en,m?Re:$);const vt=Nf(L.getCameraToCenterDistance(Pe),Kt);let zt=I.evaluateSizeForFeature(v.textSizeData,ne,ke)*vt/s.ONE_EM;m&&(zt*=v.tilePixelRatio/Q);const nn=Ug(lt,zt);m?({x:At,y:Ut,z:St}=Pe.projectTilePoint(Qe+nn.x,et+nn.y,H.canonical),[At,Ut,St]=gi(At+at,Ut+xt,St+en,$)):(h&&nn._rotate(-L.angle),At+=nn.x,Ut+=nn.y,St=0);const Ht=v.allowVerticalPlacement&&ke.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let an=0;an<Je;an++)s.addDynamicAttributes(ve,At,Ut,St,Ht);te&&ke.associatedIconIndex>=0&&(Ie[ke.associatedIconIndex]={x:At,y:Ut,z:St,angle:Ht})}else Rs(Je,ve)}if(te){Te.clear();const Fe=v.icon.placedSymbolArray;for(let ke=0;ke<Fe.length;ke++){const Qe=Fe.get(ke),{numGlyphs:et}=Qe,Je=Ie[ke];if(Qe.hidden||!Je)Rs(et,Te);else{const{x:lt,y:at,z:xt,angle:en}=Je;for(let At=0;At<et;At++)s.addDynamicAttributes(Te,lt,at,xt,en)}}v.icon.dynamicLayoutVertexBuffer.updateData(Te)}v.text.dynamicLayoutVertexBuffer.updateData(ve)}function Ap(v,h,m){return m.iconsInText&&h?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function kA(v,h,m,S,I,L,$,H,Q,ne,te,fe){const ve=v.context,Te=ve.gl,Ie=v.transform,Pe=H==="map",Re=Q==="map",he=Pe&&m.layout.get("symbol-placement")!=="point",Se=Pe&&!Re&&!he,Fe=m.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ke=!1;const Qe=v.depthModeForSublayer(0,s.DepthMode.ReadOnly),et=[s.mercatorXfromLng(Ie.center.lng),s.mercatorYfromLat(Ie.center.lat)],Je=m.layout.get("text-variable-anchor"),lt=Ie.projection.name==="globe",at=[],xt=[0,-1,0];let en=xt;!lt&&!Ie.mercatorFromTransition||Pe||(en=function(At){const Ut=At._camera.getWorldToCamera(At.worldSize,1),St=s.multiply([],Ut,At.globeMatrix);s.invert(St,St);const Kt=[0,0,0],vt=[0,1,0,0];return s.transformMat4$1(vt,vt,St),Kt[0]=vt[0],Kt[1]=vt[1],Kt[2]=vt[2],s.normalize(Kt,Kt),Kt}(Ie));for(const At of S){const Ut=h.getTile(At),St=Ut.getBucket(m);if(!St||St.projection.name==="mercator"&&lt)continue;const Kt=I?St.text:St.icon;if(!Kt||St.fullyClipped||!Kt.segments.get().length)continue;const vt=Kt.programConfigurations.get(m.id),zt=I||St.sdfIcons,nn=I?St.textSizeData:St.iconSizeData,Ht=Re||Ie.pitch!==0,an=s.evaluateSizeForZoom(nn,Ie.zoom);let Wn,hr,kn,er,Fr=[0,0],Nr=null;if(I)hr=Ut.glyphAtlasTexture,kn=Te.LINEAR,Wn=Ut.glyphAtlasTexture.size,St.iconsInText&&(Fr=Ut.imageAtlasTexture.size,Nr=Ut.imageAtlasTexture,er=Ht||v.options.rotating||v.options.zooming||nn.kind==="composite"||nn.kind==="camera"?Te.LINEAR:Te.NEAREST);else{const qf=m.layout.get("icon-size").constantOr(0)!==1||St.iconsNeedLinear;hr=Ut.imageAtlasTexture,kn=zt||v.options.rotating||v.options.zooming||qf||Ht?Te.LINEAR:Te.NEAREST,Wn=Ut.imageAtlasTexture.size}const Vn=St.projection.name==="globe",fi=Vn?en:xt,bi=Vn?s.globeToMercatorTransition(Ie.zoom):0,wi=He(At,St.getProjection(),Ie),Ei=Ie.calculatePixelsToTileUnitsMatrix(Ut),_a=gt(wi,Ut.tileID.canonical,Re,Pe,Ie,St.getProjection(),Ei),Ns=v.terrain&&Re&&he?s.invert(s.create(),_a):L_,pu=Vi(wi,Ut.tileID.canonical,Re,Pe,Ie,St.getProjection(),Ei),Wc=Je&&St.hasTextData(),io=m.layout.get("icon-text-fit")!=="none"&&Wc&&St.hasIconData();if(he){const qf=Ie.elevation,nd=qf?qf.getAtTileOffsetFunc(At,Ie.center.lat,Ie.worldSize,St.getProjection()):null,Mp=za(wi,Ut.tileID.canonical,Re,Pe,Ie,St.getProjection(),Ei);Ve(St,wi,v,I,Mp,pu,Re,ne,nd,At)}const Si=he||I&&Je||io,ni=v.translatePosMatrix(wi,Ut,L,$),Ho=Si?L_:_a,ja=v.translatePosMatrix(pu,Ut,L,$,!0),Yi=St.getProjection().createInversionMatrix(Ie,At.canonical),ll=[];v.terrainRenderModeElevated()&&Re&&ll.push("PITCH_WITH_MAP_TERRAIN"),Vn&&ll.push("PROJECTION_GLOBE_VIEW"),Si&&ll.push("PROJECTED_POS_ON_VIEWPORT");const G_=zt&&m.paint.get(I?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ip;Ip=zt?St.iconsInText?Ua(nn.kind,an,Se,Re,v,ni,Ho,ja,Wn,Fr,At,bi,et,Yi,fi,St.getProjection()):kg(nn.kind,an,Se,Re,v,ni,Ho,ja,I,Wn,!0,At,bi,et,Yi,fi,St.getProjection()):mp(nn.kind,an,Se,Re,v,ni,Ho,ja,I,Wn,At,bi,et,Yi,fi,St.getProjection());const $A={program:v.useProgram(Ap(zt,I,St),vt,ll),buffers:Kt,uniformValues:Ip,atlasTexture:hr,atlasTextureIcon:Nr,atlasInterpolation:kn,atlasInterpolationIcon:er,isSDF:zt,hasHalo:G_,tile:Ut,labelPlaneMatrixInv:Ns};if(Fe&&St.canOverlap){ke=!0;const qf=Kt.segments.get();for(const nd of qf)at.push({segments:new s.SegmentVector([nd]),sortKey:nd.sortKey,state:$A})}else at.push({segments:Kt.segments,sortKey:0,state:$A})}ke&&at.sort((At,Ut)=>At.sortKey-Ut.sortKey);for(const At of at){const Ut=At.state;if(v.terrain&&v.terrain.setupElevationDraw(Ut.tile,Ut.program,{useDepthForOcclusion:!lt,labelPlaneMatrixInv:Ut.labelPlaneMatrixInv}),ve.activeTexture.set(Te.TEXTURE0),Ut.atlasTexture.bind(Ut.atlasInterpolation,Te.CLAMP_TO_EDGE),Ut.atlasTextureIcon&&(ve.activeTexture.set(Te.TEXTURE1),Ut.atlasTextureIcon&&Ut.atlasTextureIcon.bind(Ut.atlasInterpolationIcon,Te.CLAMP_TO_EDGE)),Ut.isSDF){const St=Ut.uniformValues;Ut.hasHalo&&(St.u_is_halo=1,_p(Ut.buffers,At.segments,m,v,Ut.program,Qe,te,fe,St)),St.u_is_halo=0}_p(Ut.buffers,At.segments,m,v,Ut.program,Qe,te,fe,Ut.uniformValues)}}function _p(v,h,m,S,I,L,$,H,Q){const ne=S.context,te=[v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer,v.globeExtVertexBuffer];I.draw(ne,ne.gl.TRIANGLES,L,$,H,s.CullFaceMode.disabled,Q,m.id,v.layoutVertexBuffer,v.indexBuffer,h,m.paint,S.transform.zoom,v.programConfigurations.get(m.id),te)}function D_(v,h,m,S,I,L,$){const H=v.context.gl,Q=m.paint.get("fill-pattern"),ne=Q&&Q.constantOr(1);let te,fe,ve,Te,Ie;$?(fe=ne&&!m.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",te=H.LINES):(fe=ne?"fillPattern":"fill",te=H.TRIANGLES);for(const Pe of S){const Re=h.getTile(Pe);if(ne&&!Re.patternsLoaded())continue;const he=Re.getBucket(m);if(!he)continue;v.prepareDrawTile();const Se=he.programConfigurations.get(m.id),Fe=v.useProgram(fe,Se);ne&&(v.context.activeTexture.set(H.TEXTURE0),Re.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Se.updatePaintBuffers());const ke=Q.constantOr(null);if(ke&&Re.imageAtlas){const et=Re.imageAtlas.patternPositions[ke.toString()];et&&Se.setConstantPatternPositions(et)}const Qe=v.translatePosMatrix(Pe.projMatrix,Re,m.paint.get("fill-translate"),m.paint.get("fill-translate-anchor"));if($){Te=he.indexBuffer2,Ie=he.segments2;const et=v.terrain&&v.terrain.renderingToTexture?v.terrain.drapeBufferSize:[H.drawingBufferWidth,H.drawingBufferHeight];ve=fe==="fillOutlinePattern"&&ne?rx(Qe,v,Re,et):nx(Qe,et)}else Te=he.indexBuffer,Ie=he.segments,ve=ne?DA(Qe,v,Re):$f(Qe);v.prepareDrawProgram(v.context,Fe,Pe.toUnwrapped()),Fe.draw(v.context,te,I,v.stencilModeForClipping(Pe),L,s.CullFaceMode.disabled,ve,m.id,he.layoutVertexBuffer,Te,Ie,m.paint,v.transform.zoom,Se)}}function Gg(v,h,m,S,I,L,$){const H=v.context,Q=H.gl,ne=v.transform,te=m.paint.get("fill-extrusion-pattern"),fe=te.constantOr(1),ve=m.paint.get("fill-extrusion-opacity"),Te=[m.paint.get("fill-extrusion-ambient-occlusion-intensity"),m.paint.get("fill-extrusion-ambient-occlusion-radius")],Ie=m.layout.get("fill-extrusion-edge-radius"),Pe=Ie>0&&!m.paint.get("fill-extrusion-rounded-roof"),Re=Pe?0:Ie,he=ne.projection.name==="globe"?s.fillExtrusionHeightLift():0,Se=ne.projection.name==="globe",Fe=Se?s.globeToMercatorTransition(ne.zoom):0,ke=[s.mercatorXfromLng(ne.center.lng),s.mercatorYfromLat(ne.center.lat)],Qe=[];Se&&Qe.push("PROJECTION_GLOBE_VIEW"),Te[0]>0&&Qe.push("FAUX_AO"),Pe&&Qe.push("ZERO_ROOF_RADIUS");for(const et of S){const Je=h.getTile(et),lt=Je.getBucket(m);if(!lt||lt.projection.name!==ne.projection.name)continue;const at=lt.programConfigurations.get(m.id),xt=v.useProgram(fe?"fillExtrusionPattern":"fillExtrusion",at,Qe);if(v.terrain){const zt=v.terrain;if(v.style.terrainSetForDrapingOnly())zt.setupElevationDraw(Je,xt,{useMeterToDem:!0});else{if(!lt.enableTerrain)continue;if(zt.setupElevationDraw(Je,xt,{useMeterToDem:!0}),B_(H,h,et,lt,m,zt),!lt.centroidVertexBuffer){const nn=xt.attributes.a_centroid_pos;nn!==void 0&&Q.vertexAttrib2f(nn,0,0)}}}fe&&(v.context.activeTexture.set(Q.TEXTURE0),Je.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),at.updatePaintBuffers());const en=te.constantOr(null);if(en&&Je.imageAtlas){const zt=Je.imageAtlas.patternPositions[en.toString()];zt&&at.setConstantPatternPositions(zt)}const At=v.translatePosMatrix(et.projMatrix,Je,m.paint.get("fill-extrusion-translate"),m.paint.get("fill-extrusion-translate-anchor")),Ut=ne.projection.createInversionMatrix(ne,et.canonical),St=m.paint.get("fill-extrusion-vertical-gradient"),Kt=fe?M_(At,v,St,ve,Te,Re,et,Je,he,Fe,ke,Ut):LA(At,v,St,ve,Te,Re,et,he,Fe,ke,Ut);v.prepareDrawProgram(H,xt,et.toUnwrapped());const vt=[];v.terrain&&vt.push(lt.centroidVertexBuffer),Se&&vt.push(lt.layoutVertexExtBuffer),xt.draw(H,H.gl.TRIANGLES,I,L,$,s.CullFaceMode.backCCW,Kt,m.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,m.paint,v.transform.zoom,at,vt)}}function B_(v,h,m,S,I,L){const $=[he=>{let Se=he.canonical.x-1,Fe=he.wrap;return Se<0&&(Se=(1<<he.canonical.z)-1,Fe--),new s.OverscaledTileID(he.overscaledZ,Fe,he.canonical.z,Se,he.canonical.y)},he=>{let Se=he.canonical.x+1,Fe=he.wrap;return Se===1<<he.canonical.z&&(Se=0,Fe++),new s.OverscaledTileID(he.overscaledZ,Fe,he.canonical.z,Se,he.canonical.y)},he=>new s.OverscaledTileID(he.overscaledZ,he.wrap,he.canonical.z,he.canonical.x,(he.canonical.y===0?1<<he.canonical.z:he.canonical.y)-1),he=>new s.OverscaledTileID(he.overscaledZ,he.wrap,he.canonical.z,he.canonical.x,he.canonical.y===(1<<he.canonical.z)-1?0:he.canonical.y+1)],H=he=>{const Se=h.getSource().minzoom,Fe=Qe=>{const et=h.getTileByID(Qe);if(et&&et.hasData())return et.getBucket(I)},ke=[0,-1,1];for(const Qe of ke){if(he.overscaledZ+Qe<Se)continue;const et=Fe(he.calculateScaledKey(he.overscaledZ+Qe));if(et)return et}},Q=[0,0,0],ne=(he,Se)=>(Q[0]=Math.min(he.min.y,Se.min.y),Q[1]=Math.max(he.max.y,Se.max.y),Q[2]=s.EXTENT-Se.min.x>he.max.x?Se.min.x-s.EXTENT:he.max.x,Q),te=(he,Se)=>(Q[0]=Math.min(he.min.x,Se.min.x),Q[1]=Math.max(he.max.x,Se.max.x),Q[2]=s.EXTENT-Se.min.y>he.max.y?Se.min.y-s.EXTENT:he.max.y,Q),fe=[(he,Se)=>ne(he,Se),(he,Se)=>ne(Se,he),(he,Se)=>te(he,Se),(he,Se)=>te(Se,he)],ve=new s.Point(0,0);let Te,Ie,Pe;const Re=(he,Se,Fe,ke,Qe)=>{const et=[[ke?Fe:he,ke?he:Fe,0],[ke?Fe:Se,ke?Se:Fe,0]],Je=Qe<0?s.EXTENT+Qe:Qe,lt=[ke?Je:(he+Se)/2,ke?(he+Se)/2:Je,0];return Fe===0&&Qe<0||Fe!==0&&Qe>0?L.getForTilePoints(Pe,[lt],!0,Ie):et.push(lt),L.getForTilePoints(m,et,!0,Te),Math.max(et[0][2],et[1][2],lt[2])/L.exaggeration()};for(let he=0;he<4;he++){const Se=(he<2?1:5)-he,Fe=S.borders[he];if(Fe.length===0)continue;const ke=Pe=$[he](m),Qe=H(ke);if(!(Qe&&Qe instanceof s.FillExtrusionBucket&&Qe.enableTerrain)||S.borderDoneWithNeighborZ[he]===Qe.canonical.z&&Qe.borderDoneWithNeighborZ[Se]===S.canonical.z||(Ie=L.findDEMTileFor(ke),!Ie||!Ie.dem))continue;if(!Te){const at=L.findDEMTileFor(m);if(!at||!at.dem)return;Te=at}const et=Qe.borders[Se];let Je=0;const lt=Qe.borderDoneWithNeighborZ[Se]!==S.canonical.z;if(S.canonical.z===Qe.canonical.z){for(let at=0;at<Fe.length;at++){const xt=S.featuresOnBorder[Fe[at]],en=xt.borders[he];let At;for(;Je<et.length&&(At=Qe.featuresOnBorder[et[Je]],!(At.borders[Se][1]>en[0]+3));)lt&&Qe.encodeCentroid(void 0,At,!1),Je++;if(At&&Je<et.length){const Ut=Je;let St=0;for(;!(At.borders[Se][0]>en[1]-3)&&(St++,++Je!==et.length);)At=Qe.featuresOnBorder[et[Je]];if(At=Qe.featuresOnBorder[et[Ut]],xt.intersectsCount()>1||At.intersectsCount()>1||St!==1){St!==1&&(Je=Ut),S.encodeCentroid(void 0,xt,!1),lt&&Qe.encodeCentroid(void 0,At,!1);continue}const Kt=fe[he](xt,At),vt=he%2?s.EXTENT-1:0;ve.x=Re(Kt[0],Math.min(s.EXTENT-1,Kt[1]),vt,he<2,Kt[2]),ve.y=0,S.encodeCentroid(ve,xt,!1),lt&&Qe.encodeCentroid(ve,At,!1)}else S.encodeCentroid(void 0,xt,!1)}S.borderDoneWithNeighborZ[he]=Qe.canonical.z,S.needsCentroidUpdate=!0,lt&&(Qe.borderDoneWithNeighborZ[Se]=S.canonical.z,Qe.needsCentroidUpdate=!0)}else{for(const at of Fe)S.encodeCentroid(void 0,S.featuresOnBorder[at],!1);if(lt){for(const at of et)Qe.encodeCentroid(void 0,Qe.featuresOnBorder[at],!1);Qe.borderDoneWithNeighborZ[Se]=S.canonical.z,Qe.needsCentroidUpdate=!0}S.borderDoneWithNeighborZ[he]=Qe.canonical.z,S.needsCentroidUpdate=!0}}(S.needsCentroidUpdate||!S.centroidVertexBuffer&&S.centroidVertexArray.length!==0)&&S.uploadCentroid(v)}const Zh=new s.Color(1,0,0,1),sx=new s.Color(0,1,0,1),jg=new s.Color(0,0,1,1),ax=new s.Color(1,0,1,1),lx=new s.Color(0,1,1,1);function ux(v,h,m){const S=v.context,I=v.transform,L=S.gl,$=I.projection.name==="globe",H=$?["PROJECTION_GLOBE_VIEW"]:null;let Q=m.projMatrix;if($&&s.globeToMercatorTransition(I.zoom)>0){const xt=s.transitionTileAABBinECEF(m.canonical,I),en=s.globeDenormalizeECEF(xt);Q=s.multiply(new Float32Array(16),I.globeMatrix,en),s.multiply(Q,I.projMatrix,Q)}const ne=v.useProgram("debug",null,H),te=h.getTileByID(m.key);v.terrain&&v.terrain.setupElevationDraw(te,ne);const fe=s.DepthMode.disabled,ve=s.StencilMode.disabled,Te=v.colorModeForRenderPass(),Ie="$debug";S.activeTexture.set(L.TEXTURE0),v.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),$?te._makeGlobeTileDebugBuffers(v.context,I):te._makeDebugTileBoundsBuffers(v.context,I.projection);const Pe=te._tileDebugBuffer||v.debugBuffer,Re=te._tileDebugIndexBuffer||v.debugIndexBuffer,he=te._tileDebugSegments||v.debugSegments;ne.draw(S,L.LINE_STRIP,fe,ve,Te,s.CullFaceMode.disabled,bs(Q,s.Color.red),Ie,Pe,Re,he,null,null,null,[te._globeTileDebugBorderBuffer]);const Se=te.latestRawTileData,Fe=Math.floor((Se&&Se.byteLength||0)/1024),ke=h.getTile(m).tileSize,Qe=512/Math.min(ke,512)*(m.overscaledZ/I.zoom)*.5;let et=m.canonical.toString();m.overscaledZ!==m.canonical.z&&(et+=` => ${m.overscaledZ}`),et+=` ${Fe}kb`,function(xt,en){xt.initDebugOverlayCanvas();const At=xt.debugOverlayCanvas,Ut=xt.context.gl,St=xt.debugOverlayCanvas.getContext("2d");St.clearRect(0,0,At.width,At.height),St.shadowColor="white",St.shadowBlur=2,St.lineWidth=1.5,St.strokeStyle="white",St.textBaseline="top",St.font="bold 36px Open Sans, sans-serif",St.fillText(en,5,5),St.strokeText(en,5,5),xt.debugOverlayTexture.update(At),xt.debugOverlayTexture.bind(Ut.LINEAR,Ut.CLAMP_TO_EDGE)}(v,et);const Je=te._tileDebugTextBuffer||v.debugBuffer,lt=te._tileDebugTextIndexBuffer||v.quadTriangleIndexBuffer,at=te._tileDebugTextSegments||v.debugSegments;ne.draw(S,L.TRIANGLES,fe,ve,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,bs(Q,s.Color.transparent,Qe),Ie,Je,lt,at,null,null,null,[te._globeTileDebugTextBuffer])}function zA(v,h,m,S){ga(v,0,h+m/2,v.transform.width,m,S)}function yp(v,h,m,S){ga(v,h-m/2,0,m,v.transform.height,S)}function ga(v,h,m,S,I,L){const $=v.context,H=$.gl;H.enable(H.SCISSOR_TEST),H.scissor(h*s.exported.devicePixelRatio,m*s.exported.devicePixelRatio,S*s.exported.devicePixelRatio,I*s.exported.devicePixelRatio),$.clear({color:L}),H.disable(H.SCISSOR_TEST)}const UA=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:N_}=UA;function Yu(v,h,m,S){v.emplaceBack(h,m,S)}class Vg{constructor(h){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,Yu(this.vertexArray,-1,-1,1),Yu(this.vertexArray,1,-1,1),Yu(this.vertexArray,-1,1,1),Yu(this.vertexArray,1,1,1),Yu(this.vertexArray,-1,-1,-1),Yu(this.vertexArray,1,-1,-1),Yu(this.vertexArray,-1,1,-1),Yu(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=h.createVertexBuffer(this.vertexArray,N_),this.indexBuffer=h.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function sl(v,h,m,S,I,L){const $=v.gl,H=h.paint.get("sky-atmosphere-color"),Q=h.paint.get("sky-atmosphere-halo-color"),ne=h.paint.get("sky-atmosphere-sun-intensity"),te=((fe,ve,Te,Ie,Pe)=>({u_matrix_3f:fe,u_sun_direction:ve,u_sun_intensity:Te,u_color_tint_r:[Ie.r,Ie.g,Ie.b,Ie.a],u_color_tint_m:[Pe.r,Pe.g,Pe.b,Pe.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),S),I,ne,H,Q);$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,$.TEXTURE_CUBE_MAP_POSITIVE_X+L,h.skyboxTexture,0),m.draw(v,$.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,te,"skyboxCapture",h.skyboxGeometry.vertexBuffer,h.skyboxGeometry.indexBuffer,h.skyboxGeometry.segment)}const vp=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class xp{constructor(h){const m=new s.StructArrayLayout5f20;m.emplaceBack(-1,1,1,0,0),m.emplaceBack(1,1,1,1,0),m.emplaceBack(1,-1,1,1,1),m.emplaceBack(-1,-1,1,0,1);const S=new s.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,3,0),this.vertexBuffer=h.createVertexBuffer(m,vp.members),this.indexBuffer=h.createIndexBuffer(S),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Gc={symbol:function(v,h,m,S,I){if(v.renderPass!=="translucent")return;const L=s.StencilMode.disabled,$=v.colorModeForRenderPass();m.layout.get("text-variable-anchor")&&function(H,Q,ne,te,fe,ve,Te){const Ie=Q.transform,Pe=fe==="map",Re=ve==="map";for(const he of H){const Se=te.getTile(he),Fe=Se.getBucket(ne);if(!Fe||!Fe.text||!Fe.text.segments.get().length)continue;const ke=s.evaluateSizeForZoom(Fe.textSizeData,Ie.zoom),Qe=He(he,Fe.getProjection(),Ie),et=Ie.calculatePixelsToTileUnitsMatrix(Se),Je=gt(Qe,Se.tileID.canonical,Re,Pe,Ie,Fe.getProjection(),et),lt=ne.layout.get("icon-text-fit")!=="none"&&Fe.hasIconData();if(ke){const at=Math.pow(2,Ie.zoom-Se.tileID.overscaledZ);ox(Fe,Pe,Re,Te,s.symbolSize,Ie,Je,he,at,ke,lt)}}}(S,v,m,h,m.layout.get("text-rotation-alignment"),m.layout.get("text-pitch-alignment"),I),m.paint.get("icon-opacity").constantOr(1)!==0&&kA(v,h,m,S,!1,m.paint.get("icon-translate"),m.paint.get("icon-translate-anchor"),m.layout.get("icon-rotation-alignment"),m.layout.get("icon-pitch-alignment"),m.layout.get("icon-keep-upright"),L,$),m.paint.get("text-opacity").constantOr(1)!==0&&kA(v,h,m,S,!0,m.paint.get("text-translate"),m.paint.get("text-translate-anchor"),m.layout.get("text-rotation-alignment"),m.layout.get("text-pitch-alignment"),m.layout.get("text-keep-upright"),L,$),h.map.showCollisionBoxes&&(jl(v,h,m,S,m.paint.get("text-translate"),m.paint.get("text-translate-anchor"),!0),jl(v,h,m,S,m.paint.get("icon-translate"),m.paint.get("icon-translate-anchor"),!1))},circle:function(v,h,m,S){if(v.renderPass!=="translucent")return;const I=m.paint.get("circle-opacity"),L=m.paint.get("circle-stroke-width"),$=m.paint.get("circle-stroke-opacity"),H=m.layout.get("circle-sort-key").constantOr(1)!==void 0;if(I.constantOr(1)===0&&(L.constantOr(1)===0||$.constantOr(1)===0))return;const Q=v.context,ne=Q.gl,te=v.transform,fe=v.depthModeForSublayer(0,s.DepthMode.ReadOnly),ve=s.StencilMode.disabled,Te=v.colorModeForRenderPass(),Ie=te.projection.name==="globe",Pe=[s.mercatorXfromLng(te.center.lng),s.mercatorYfromLat(te.center.lat)],Re=[];for(let Se=0;Se<S.length;Se++){const Fe=S[Se],ke=h.getTile(Fe),Qe=ke.getBucket(m);if(!Qe||Qe.projection.name!==te.projection.name)continue;const et=Qe.programConfigurations.get(m.id),Je=dp(m);Ie&&Je.push("PROJECTION_GLOBE_VIEW");const lt=v.useProgram("circle",et,Je),at=Qe.layoutVertexBuffer,xt=Qe.globeExtVertexBuffer,en=Qe.indexBuffer,At=te.projection.createInversionMatrix(te,Fe.canonical),Ut={programConfiguration:et,program:lt,layoutVertexBuffer:at,globeExtVertexBuffer:xt,indexBuffer:en,uniformValues:Ng(v,Fe,ke,At,Pe,m),tile:ke};if(H){const St=Qe.segments.get();for(const Kt of St)Re.push({segments:new s.SegmentVector([Kt]),sortKey:Kt.sortKey,state:Ut})}else Re.push({segments:Qe.segments,sortKey:0,state:Ut})}H&&Re.sort((Se,Fe)=>Se.sortKey-Fe.sortKey);const he={useDepthForOcclusion:!Ie};for(const Se of Re){const{programConfiguration:Fe,program:ke,layoutVertexBuffer:Qe,globeExtVertexBuffer:et,indexBuffer:Je,uniformValues:lt,tile:at}=Se.state,xt=Se.segments;v.terrain&&v.terrain.setupElevationDraw(at,ke,he),v.prepareDrawProgram(Q,ke,at.tileID.toUnwrapped()),ke.draw(Q,ne.TRIANGLES,fe,ve,Te,s.CullFaceMode.disabled,lt,m.id,Qe,Je,xt,m.paint,te.zoom,Fe,[et])}},heatmap:function(v,h,m,S){if(m.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const I=v.context,L=I.gl,$=s.StencilMode.disabled,H=new s.ColorMode([L.ONE,L.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(Te,Ie,Pe,Re){const he=Te.gl,Se=Ie.width*Re,Fe=Ie.height*Re;Te.activeTexture.set(he.TEXTURE1),Te.viewport.set([0,0,Se,Fe]);let ke=Pe.heatmapFbo;if(!ke||ke&&(ke.width!==Se||ke.height!==Fe)){ke&&ke.destroy();const Qe=he.createTexture();he.bindTexture(he.TEXTURE_2D,Qe),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_S,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_T,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MIN_FILTER,he.LINEAR),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MAG_FILTER,he.LINEAR),ke=Pe.heatmapFbo=Te.createFramebuffer(Se,Fe,!1),function(et,Je,lt,at,xt,en){const At=et.gl;At.texImage2D(At.TEXTURE_2D,0,et.isWebGL2&&et.extRenderToTextureHalfFloat?At.RGBA16F:At.RGBA,xt,en,0,At.RGBA,et.extRenderToTextureHalfFloat?et.isWebGL2?At.HALF_FLOAT:et.extTextureHalfFloat.HALF_FLOAT_OES:At.UNSIGNED_BYTE,null),at.colorAttachment.set(lt)}(Te,0,Qe,ke,Se,Fe)}else he.bindTexture(he.TEXTURE_2D,ke.colorAttachment.get()),Te.bindFramebuffer.set(ke.framebuffer)})(I,v,m,v.transform.projection.name==="globe"?.5:.25),I.clear({color:s.Color.transparent});const Q=v.transform,ne=Q.projection.name==="globe",te=ne?["PROJECTION_GLOBE_VIEW"]:null,fe=ne?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,ve=[s.mercatorXfromLng(Q.center.lng),s.mercatorYfromLat(Q.center.lat)];for(let Te=0;Te<S.length;Te++){const Ie=S[Te];if(h.hasRenderableParent(Ie))continue;const Pe=h.getTile(Ie),Re=Pe.getBucket(m);if(!Re||Re.projection.name!==Q.projection.name)continue;const he=Re.programConfigurations.get(m.id),Se=v.useProgram("heatmap",he,te),{zoom:Fe}=v.transform;v.terrain&&v.terrain.setupElevationDraw(Pe,Se),v.prepareDrawProgram(I,Se,Ie.toUnwrapped());const ke=Q.projection.createInversionMatrix(Q,Ie.canonical);Se.draw(I,L.TRIANGLES,s.DepthMode.disabled,$,H,fe,R_(v,Ie,Pe,ke,ve,Fe,m.paint.get("heatmap-intensity")),m.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,m.paint,v.transform.zoom,he,ne?[Re.globeExtVertexBuffer]:null)}I.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),function(I,L){const $=I.context,H=$.gl,Q=L.heatmapFbo;if(!Q)return;$.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,Q.colorAttachment.get()),$.activeTexture.set(H.TEXTURE1);let ne=L.colorRampTexture;ne||(ne=L.colorRampTexture=new s.Texture($,L.colorRamp,H.RGBA)),ne.bind(H.LINEAR,H.CLAMP_TO_EDGE),I.useProgram("heatmapTexture").draw($,H.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,I.colorModeForRenderPass(),s.CullFaceMode.disabled,((te,fe,ve,Te)=>({u_image:0,u_color_ramp:1,u_opacity:fe.paint.get("heatmap-opacity")}))(0,L),L.id,I.viewportBuffer,I.quadTriangleIndexBuffer,I.viewportSegments,L.paint,I.transform.zoom)}(v,m))},line:function(v,h,m,S){if(v.renderPass!=="translucent")return;const I=m.paint.get("line-opacity"),L=m.paint.get("line-width");if(I.constantOr(1)===0||L.constantOr(1)===0)return;const $=v.depthModeForSublayer(0,s.DepthMode.ReadOnly),H=v.colorModeForRenderPass(),Q=v.terrain&&v.terrain.renderingToTexture?1:s.exported.devicePixelRatio,ne=m.paint.get("line-dasharray"),te=ne.constantOr(1),fe=m.layout.get("line-cap"),ve=m.paint.get("line-pattern"),Te=ve.constantOr(1),Ie=m.paint.get("line-gradient"),Pe=Te?"linePattern":"line",Re=v.context,he=Re.gl,Se=(ke=>{const Qe=[];fs(ke)&&Qe.push("RENDER_LINE_DASH"),ke.paint.get("line-gradient")&&Qe.push("RENDER_LINE_GRADIENT");const et=ke.paint.get("line-trim-offset");et[0]===0&&et[1]===0||Qe.push("RENDER_LINE_TRIM_OFFSET");const Je=ke.paint.get("line-pattern").constantOr(1),lt=ke.paint.get("line-opacity").constantOr(1)!==1;return!Je&&lt&&Qe.push("RENDER_LINE_ALPHA_DISCARD"),Qe})(m);let Fe=Se.includes("RENDER_LINE_ALPHA_DISCARD");v.terrain&&v.terrain.clipOrMaskOverlapStencilType()&&(Fe=!1);for(const ke of S){const Qe=h.getTile(ke);if(Te&&!Qe.patternsLoaded())continue;const et=Qe.getBucket(m);if(!et)continue;v.prepareDrawTile();const Je=et.programConfigurations.get(m.id),lt=v.useProgram(Pe,Je,Se),at=ve.constantOr(null);if(at&&Qe.imageAtlas){const zt=Qe.imageAtlas.patternPositions[at.toString()];zt&&Je.setConstantPatternPositions(zt)}const xt=ne.constantOr(null),en=fe.constantOr(null);if(!Te&&xt&&en&&Qe.lineAtlas){const zt=Qe.lineAtlas.getDash(xt,en);zt&&Je.setConstantPatternPositions(zt)}let[At,Ut]=m.paint.get("line-trim-offset");(en==="round"||en==="square")&&At!==Ut&&(At===0&&(At-=1),Ut===1&&(Ut+=1));const St=v.terrain?ke.projMatrix:null,Kt=Te?pp(v,Qe,m,St,Q):ix(v,Qe,m,St,et.lineClipsArray.length,Q,[At,Ut]);if(Ie){const zt=et.gradients[m.id];let nn=zt.texture;if(m.gradientVersion!==zt.version){let Ht=256;if(m.stepInterpolant){const an=h.getSource().maxzoom,Wn=ke.canonical.z===an?Math.ceil(1<<v.transform.maxZoom-ke.canonical.z):1;Ht=s.clamp(s.nextPowerOfTwo(et.maxLineLength/s.EXTENT*1024*Wn),256,Re.maxTextureSize)}zt.gradient=s.renderColorRamp({expression:m.gradientExpression(),evaluationKey:"lineProgress",resolution:Ht,image:zt.gradient||void 0,clips:et.lineClipsArray}),zt.texture?zt.texture.update(zt.gradient):zt.texture=new s.Texture(Re,zt.gradient,he.RGBA),zt.version=m.gradientVersion,nn=zt.texture}Re.activeTexture.set(he.TEXTURE1),nn.bind(m.stepInterpolant?he.NEAREST:he.LINEAR,he.CLAMP_TO_EDGE)}te&&(Re.activeTexture.set(he.TEXTURE0),Qe.lineAtlasTexture.bind(he.LINEAR,he.REPEAT),Je.updatePaintBuffers()),Te&&(Re.activeTexture.set(he.TEXTURE0),Qe.imageAtlasTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE),Je.updatePaintBuffers()),v.prepareDrawProgram(Re,lt,ke.toUnwrapped());const vt=zt=>{lt.draw(Re,he.TRIANGLES,$,zt,H,s.CullFaceMode.disabled,Kt,m.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,m.paint,v.transform.zoom,Je,[et.layoutVertexBuffer2])};if(Fe){const zt=v.stencilModeForClipping(ke).ref;zt===0&&v.terrain&&Re.clear({stencil:0});const nn={func:he.EQUAL,mask:255};Kt.u_alpha_discard_threshold=.8,vt(new s.StencilMode(nn,zt,255,he.KEEP,he.KEEP,he.INVERT)),Kt.u_alpha_discard_threshold=0,vt(new s.StencilMode(nn,zt,255,he.KEEP,he.KEEP,he.KEEP))}else vt(v.stencilModeForClipping(ke))}Fe&&(v.resetStencilClippingMasks(),v.terrain&&Re.clear({stencil:0}))},fill:function(v,h,m,S){const I=m.paint.get("fill-color"),L=m.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const $=v.colorModeForRenderPass(),H=m.paint.get("fill-pattern"),Q=v.opaquePassEnabledForLayer()&&!H.constantOr(1)&&I.constantOr(s.Color.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===Q){const ne=v.depthModeForSublayer(1,v.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);D_(v,h,m,S,ne,$,!1)}if(v.renderPass==="translucent"&&m.paint.get("fill-antialias")){const ne=v.depthModeForSublayer(m.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);D_(v,h,m,S,ne,$,!0)}},"fill-extrusion":function(v,h,m,S){const I=m.paint.get("fill-extrusion-opacity");if(I!==0&&v.renderPass==="translucent"){const L=new s.DepthMode(v.context.gl.LEQUAL,s.DepthMode.ReadWrite,v.depthRangeFor3D);if(I!==1||m.paint.get("fill-extrusion-pattern").constantOr(1))Gg(v,h,m,S,L,s.StencilMode.disabled,s.ColorMode.disabled),Gg(v,h,m,S,L,v.stencilModeFor3D(),v.colorModeForRenderPass()),v.resetStencilClippingMasks();else{const $=v.colorModeForRenderPass();Gg(v,h,m,S,L,s.StencilMode.disabled,$)}}},hillshade:function(v,h,m,S){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const I=v.context,L=v.depthModeForSublayer(0,s.DepthMode.ReadOnly),$=v.colorModeForRenderPass(),H=v.terrain&&v.terrain.renderingToTexture,[Q,ne]=v.renderPass!=="translucent"||H?[{},S]:v.stencilConfigForOverlap(S);for(const te of ne){const fe=h.getTile(te);if(fe.needsHillshadePrepare&&v.renderPass==="offscreen")Gf(v,fe,m,L,s.StencilMode.disabled,$);else if(v.renderPass==="translucent"){const ve=H&&v.terrain?v.terrain.stencilModeForRTTOverlap(te):Q[te.overscaledZ];PA(v,te,fe,m,L,ve,$)}}I.viewport.set([0,0,v.width,v.height]),v.resetStencilClippingMasks()},raster:function(v,h,m,S,I,L){if(v.renderPass!=="translucent"||m.paint.get("raster-opacity")===0||!S.length)return;const $=v.context,H=$.gl,Q=h.getSource(),ne=v.useProgram("raster"),te=v.colorModeForRenderPass(),fe=v.terrain&&v.terrain.renderingToTexture,[ve,Te]=Q instanceof pr||fe?[{},S]:v.stencilConfigForOverlap(S),Ie=Te[Te.length-1].overscaledZ,Pe=!v.options.moving;for(const Re of Te){const he=fe?s.DepthMode.disabled:v.depthModeForSublayer(Re.overscaledZ-Ie,m.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,H.LESS),Se=Re.toUnwrapped(),Fe=h.getTile(Re);if(fe&&(!Fe||!Fe.hasData()))continue;const ke=fe?Re.projMatrix:v.transform.calculateProjMatrix(Se,Pe),Qe=v.terrain&&fe?v.terrain.stencilModeForRTTOverlap(Re):ve[Re.overscaledZ],et=L?0:m.paint.get("raster-fade-duration");Fe.registerFadeDuration(et);const Je=h.findLoadedParent(Re,0),lt=MA(Fe,Je,h,v.transform,et);let at,xt;v.terrain&&v.terrain.prepareDrawTile();const en=m.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;$.activeTexture.set(H.TEXTURE0),Fe.texture.bind(en,H.CLAMP_TO_EDGE),$.activeTexture.set(H.TEXTURE1),Je?(Je.texture.bind(en,H.CLAMP_TO_EDGE),at=Math.pow(2,Je.tileID.overscaledZ-Fe.tileID.overscaledZ),xt=[Fe.tileID.canonical.x*at%1,Fe.tileID.canonical.y*at%1]):Fe.texture.bind(en,H.CLAMP_TO_EDGE),Fe.texture.useMipmap&&$.extTextureFilterAnisotropic&&v.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);const At=gp(ke,xt||[0,0],at||1,lt,m,Q instanceof pr?Q.perspectiveTransform:[0,0]);if(v.prepareDrawProgram($,ne,Se),Q instanceof pr)Q.boundsBuffer&&Q.boundsSegments&&ne.draw($,H.TRIANGLES,he,s.StencilMode.disabled,te,s.CullFaceMode.disabled,At,m.id,Q.boundsBuffer,v.quadTriangleIndexBuffer,Q.boundsSegments);else{const{tileBoundsBuffer:Ut,tileBoundsIndexBuffer:St,tileBoundsSegments:Kt}=v.getTileBoundsBuffers(Fe);ne.draw($,H.TRIANGLES,he,Qe,te,s.CullFaceMode.disabled,At,m.id,Ut,St,Kt)}}v.resetStencilClippingMasks()},background:function(v,h,m,S){const I=m.paint.get("background-color"),L=m.paint.get("background-opacity");if(L===0)return;const $=v.context,H=$.gl,Q=v.transform,ne=Q.tileSize,te=m.paint.get("background-pattern");if(v.isPatternMissing(te))return;const fe=!te&&I.a===1&&L===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==fe)return;const ve=s.StencilMode.disabled,Te=v.depthModeForSublayer(0,fe==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),Ie=v.colorModeForRenderPass(),Pe=v.useProgram(te?"backgroundPattern":"background");let Re,he=S;he||(Re=v.getBackgroundTiles(),he=Object.values(Re).map(Se=>Se.tileID)),te&&($.activeTexture.set(H.TEXTURE0),v.imageManager.bind(v.context));for(const Se of he){const Fe=Se.toUnwrapped(),ke=S?Se.projMatrix:v.transform.calculateProjMatrix(Fe);v.prepareDrawTile();const Qe=h?h.getTile(Se):Re?Re[Se.key]:new s.Tile(Se,ne,Q.zoom,v),et=te?FA(ke,L,v,te,{tileID:Se,tileSize:ne}):zg(ke,L,I);v.prepareDrawProgram($,Pe,Fe);const{tileBoundsBuffer:Je,tileBoundsIndexBuffer:lt,tileBoundsSegments:at}=v.getTileBoundsBuffers(Qe);Pe.draw($,H.TRIANGLES,Te,ve,Ie,s.CullFaceMode.disabled,et,m.id,Je,lt,at)}},sky:function(v,h,m){const S=v.transform,I=S.projection.name==="mercator"||S.projection.name==="globe"?1:s.smoothstep(7,8,S.zoom),L=m.paint.get("sky-opacity")*I;if(L===0)return;const $=v.context,H=m.paint.get("sky-type"),Q=new s.DepthMode($.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),ne=v.frameCounter/1e3%1;H==="atmosphere"?v.renderPass==="offscreen"?m.needsSkyboxCapture(v)&&(function(te,fe,ve,Te){const Ie=te.context,Pe=Ie.gl;let Re=fe.skyboxFbo;if(!Re){Re=fe.skyboxFbo=Ie.createFramebuffer(32,32,!1),fe.skyboxGeometry=new Vg(Ie),fe.skyboxTexture=Ie.gl.createTexture(),Pe.bindTexture(Pe.TEXTURE_CUBE_MAP,fe.skyboxTexture),Pe.texParameteri(Pe.TEXTURE_CUBE_MAP,Pe.TEXTURE_WRAP_S,Pe.CLAMP_TO_EDGE),Pe.texParameteri(Pe.TEXTURE_CUBE_MAP,Pe.TEXTURE_WRAP_T,Pe.CLAMP_TO_EDGE),Pe.texParameteri(Pe.TEXTURE_CUBE_MAP,Pe.TEXTURE_MIN_FILTER,Pe.LINEAR),Pe.texParameteri(Pe.TEXTURE_CUBE_MAP,Pe.TEXTURE_MAG_FILTER,Pe.LINEAR);for(let ke=0;ke<6;++ke)Pe.texImage2D(Pe.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0,Pe.RGBA,32,32,0,Pe.RGBA,Pe.UNSIGNED_BYTE,null)}Ie.bindFramebuffer.set(Re.framebuffer),Ie.viewport.set([0,0,32,32]);const he=fe.getCenter(te,!0),Se=te.useProgram("skyboxCapture"),Fe=new Float64Array(16);s.identity(Fe),s.rotateY(Fe,Fe,.5*-Math.PI),sl(Ie,fe,Se,Fe,he,0),s.identity(Fe),s.rotateY(Fe,Fe,.5*Math.PI),sl(Ie,fe,Se,Fe,he,1),s.identity(Fe),s.rotateX(Fe,Fe,.5*-Math.PI),sl(Ie,fe,Se,Fe,he,2),s.identity(Fe),s.rotateX(Fe,Fe,.5*Math.PI),sl(Ie,fe,Se,Fe,he,3),s.identity(Fe),sl(Ie,fe,Se,Fe,he,4),s.identity(Fe),s.rotateY(Fe,Fe,Math.PI),sl(Ie,fe,Se,Fe,he,5),Ie.viewport.set([0,0,te.width,te.height])}(v,m),m.markSkyboxValid(v)):v.renderPass==="sky"&&function(te,fe,ve,Te,Ie){const Pe=te.context,Re=Pe.gl,he=te.transform,Se=te.useProgram("skybox");Pe.activeTexture.set(Re.TEXTURE0),Re.bindTexture(Re.TEXTURE_CUBE_MAP,fe.skyboxTexture);const Fe=((ke,Qe,et,Je,lt)=>({u_matrix:ke,u_sun_direction:Qe,u_cubemap:0,u_opacity:Je,u_temporal_offset:lt}))(he.skyboxMatrix,fe.getCenter(te,!1),0,Te,Ie);te.prepareDrawProgram(Pe,Se),Se.draw(Pe,Re.TRIANGLES,ve,s.StencilMode.disabled,te.colorModeForRenderPass(),s.CullFaceMode.backCW,Fe,"skybox",fe.skyboxGeometry.vertexBuffer,fe.skyboxGeometry.indexBuffer,fe.skyboxGeometry.segment)}(v,m,Q,L,ne):H==="gradient"&&v.renderPass==="sky"&&function(te,fe,ve,Te,Ie){const Pe=te.context,Re=Pe.gl,he=te.transform,Se=te.useProgram("skyboxGradient");fe.skyboxGeometry||(fe.skyboxGeometry=new Vg(Pe)),Pe.activeTexture.set(Re.TEXTURE0);let Fe=fe.colorRampTexture;Fe||(Fe=fe.colorRampTexture=new s.Texture(Pe,fe.colorRamp,Re.RGBA)),Fe.bind(Re.LINEAR,Re.CLAMP_TO_EDGE);const ke=((Qe,et,Je,lt,at)=>({u_matrix:Qe,u_color_ramp:0,u_center_direction:et,u_radius:s.degToRad(Je),u_opacity:lt,u_temporal_offset:at}))(he.skyboxMatrix,fe.getCenter(te,!1),fe.paint.get("sky-gradient-radius"),Te,Ie);te.prepareDrawProgram(Pe,Se),Se.draw(Pe,Re.TRIANGLES,ve,s.StencilMode.disabled,te.colorModeForRenderPass(),s.CullFaceMode.backCW,ke,"skyboxGradient",fe.skyboxGeometry.vertexBuffer,fe.skyboxGeometry.indexBuffer,fe.skyboxGeometry.segment)}(v,m,Q,L,ne)},debug:function(v,h,m){for(let S=0;S<m.length;S++)ux(v,h,m[S])},custom:function(v,h,m,S){const I=v.context,L=m.implementation;if(!v.transform.projection.unsupportedLayers||!v.transform.projection.unsupportedLayers.includes("custom")||v.terrain&&(v.terrain.renderingToTexture||v.renderPass==="offscreen")&&m.isLayerDraped()){if(v.renderPass==="offscreen"){const $=L.prerender;if($){if(v.setCustomLayerDefaults(),I.setColorMode(v.colorModeForRenderPass()),v.transform.projection.name==="globe"){const H=v.transform.pointMerc;$.call(L,I.gl,v.transform.customLayerMatrix(),v.transform.getProjection(),v.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(v.transform.zoom),[H.x,H.y],v.transform.pixelsPerMeterRatio)}else $.call(L,I.gl,v.transform.customLayerMatrix());I.setDirty(),v.setBaseState()}}else if(v.renderPass==="translucent"){if(v.terrain&&v.terrain.renderingToTexture){const H=L.renderToTile;if(H){const Q=S[0].canonical,ne=new s.MercatorCoordinate(Q.x+S[0].wrap*(1<<Q.z),Q.y,Q.z);I.setDepthMode(s.DepthMode.disabled),I.setStencilMode(s.StencilMode.disabled),I.setColorMode(v.colorModeForRenderPass()),v.setCustomLayerDefaults(),H.call(L,I.gl,ne),I.setDirty(),v.setBaseState()}return}v.setCustomLayerDefaults(),I.setColorMode(v.colorModeForRenderPass()),I.setStencilMode(s.StencilMode.disabled);const $=L.renderingMode==="3d"?new s.DepthMode(v.context.gl.LEQUAL,s.DepthMode.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,s.DepthMode.ReadOnly);if(I.setDepthMode($),v.transform.projection.name==="globe"){const H=v.transform.pointMerc;L.render(I.gl,v.transform.customLayerMatrix(),v.transform.getProjection(),v.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(v.transform.zoom),[H.x,H.y],v.transform.pixelsPerMeterRatio)}else L.render(I.gl,v.transform.customLayerMatrix());I.setDirty(),v.setBaseState(),I.bindFramebuffer.set(null)}}else s.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class jc{constructor(h,m,S=!1){this.context=new sn(h,S),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(h,m){const S=!!h&&!!h.terrain&&this.transform.projection.supportsTerrain;if(!(S||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new RA(this,h));const I=this._terrain;this.transform.elevation=S?I:null,I.update(h,this.transform,m)}_updateFog(h){const m=h.fog;if(!m||this.transform.projection.name==="globe"||m.getOpacity(this.transform.pitch)<1||m.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[S,I]=m.getFovAdjustedRange(this.transform._fov);if(S>I)return void(this.transform.fogCullDistSq=null);const L=S+.78*(I-S);this.transform.fogCullDistSq=L*L}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(h,m){if(this.width=h*s.exported.devicePixelRatio,this.height=m*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const S of this.style.order)this.style._layers[S].resize()}setup(){const h=this.context,m=new s.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(s.EXTENT,0),m.emplaceBack(0,s.EXTENT),m.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=h.createVertexBuffer(m,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const S=new s.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(s.EXTENT,0),S.emplaceBack(0,s.EXTENT),S.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=h.createVertexBuffer(S,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const I=new s.StructArrayLayout2i4;I.emplaceBack(-1,-1),I.emplaceBack(1,-1),I.emplaceBack(-1,1),I.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(I,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const L=new s.StructArrayLayout4i8;L.emplaceBack(0,0,0,0),L.emplaceBack(s.EXTENT,0,s.EXTENT,0),L.emplaceBack(0,s.EXTENT,0,s.EXTENT),L.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=h.createVertexBuffer(L,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const $=new s.StructArrayLayout3ui6;$.emplaceBack(0,1,2),$.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer($);const H=new s.StructArrayLayout1ui2;for(const ne of[0,1,3,2,0])H.emplaceBack(ne);this.debugIndexBuffer=h.createIndexBuffer(H),this.emptyTexture=new s.Texture(h,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),h.gl.RGBA),this.identityMat=s.create();const Q=this.context.gl;this.stencilClearMode=new s.StencilMode({func:Q.ALWAYS,mask:0},0,255,Q.ZERO,Q.ZERO,Q.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new xp(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(h){return h._makeTileBoundsBuffers(this.context,this.transform.projection),h._tileBoundsBuffer?{tileBoundsBuffer:h._tileBoundsBuffer,tileBoundsIndexBuffer:h._tileBoundsIndexBuffer,tileBoundsSegments:h._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const h=this.context,m=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(h,m.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,hp(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(h,m,S){if(!m||this.currentStencilSource===m.id||!h.isTileClipped()||!S||S.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let H=!1;for(const Q of S)if(this._tileClippingMaskIDs[Q.key]===void 0){H=!0;break}if(!H)return}this.currentStencilSource=m.id;const I=this.context,L=I.gl;this.nextStencilID+S.length>256&&this.clearStencil(),I.setColorMode(s.ColorMode.disabled),I.setDepthMode(s.DepthMode.disabled);const $=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const H of S){const Q=m.getTile(H),ne=this._tileClippingMaskIDs[H.key]=this.nextStencilID++,{tileBoundsBuffer:te,tileBoundsIndexBuffer:fe,tileBoundsSegments:ve}=this.getTileBoundsBuffers(Q);$.draw(I,L.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:L.ALWAYS,mask:0},ne,255,L.KEEP,L.KEEP,L.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,hp(H.projMatrix),"$clipping",te,fe,ve)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const h=this.nextStencilID++,m=this.context.gl;return new s.StencilMode({func:m.NOTEQUAL,mask:255},h,255,m.KEEP,m.KEEP,m.REPLACE)}stencilModeForClipping(h){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(h);const m=this.context.gl;return new s.StencilMode({func:m.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,m.KEEP,m.KEEP,m.REPLACE)}stencilConfigForOverlap(h){const m=this.context.gl,S=h.sort(($,H)=>H.overscaledZ-$.overscaledZ),I=S[S.length-1].overscaledZ,L=S[0].overscaledZ-I+1;if(L>1){this.currentStencilSource=void 0,this.nextStencilID+L>256&&this.clearStencil();const $={};for(let H=0;H<L;H++)$[H+I]=new s.StencilMode({func:m.GEQUAL,mask:255},H+this.nextStencilID,255,m.KEEP,m.KEEP,m.REPLACE);return this.nextStencilID+=L,[$,S]}return[{[I]:s.StencilMode.disabled},S]}colorModeForRenderPass(){const h=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([h.CONSTANT_COLOR,h.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(h,m,S){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const I=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new s.DepthMode(S||this.context.gl.LEQUAL,m,[I,I])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(h,m){this.style=h,this.options=m,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const S=this.style.order,I=this.style._sourceCaches;for(const ne in I){const te=I[ne];te.used&&te.prepare(this.context)}const L={},$={},H={};for(const ne in I){const te=I[ne];L[ne]=te.getVisibleCoordinates(),$[ne]=L[ne].slice().reverse(),H[ne]=te.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ne=0;ne<S.length;ne++)if(this.style._layers[S[ne]].is3D()){this.opaquePassCutoff=ne;break}if(this.terrain&&(this.terrain.updateTileBinding(H),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),!s.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const ne of S){const te=this.style._layers[ne],fe=h._getLayerSourceCache(te);if(!te.hasOffscreenPass()||te.isHidden(this.transform.zoom))continue;const ve=fe?$[fe.id]:void 0;(te.type==="custom"||te.isSky()||ve&&ve.length)&&this.renderLayer(this,fe,te,ve)}this.depthRangeFor3D=[0,1-(h.order.length+2)*this.numSublayers*this.depthEpsilon];const Q=this.terrain;if(Q&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&Q.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:m.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=m.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const ne=this.style._layers[S[this.currentLayer]],te=h._getLayerSourceCache(ne);if(ne.isSky())continue;const fe=te?$[te.id]:void 0;this._renderTileClippingMasks(ne,te,fe),this.renderLayer(this,te,ne,fe)}if(this.style.fog&&this.transform.projection.supportsFog&&function(ne,te){const fe=ne.context,ve=fe.gl,Te=ne.transform,Ie=new s.DepthMode(ve.LEQUAL,s.DepthMode.ReadOnly,[0,1]),Pe=ne.useProgram("globeAtmosphere",null,Te.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Re=s.globeToMercatorTransition(Te.zoom),he=te.properties.get("color").toArray01(),Se=te.properties.get("high-color").toArray01(),Fe=te.properties.get("space-color").toArray01PremultipliedAlpha(),ke=s.identity$1([]);s.rotateY$1(ke,ke,-s.degToRad(Te._center.lng)),s.rotateX$1(ke,ke,s.degToRad(Te._center.lat)),s.rotateZ$1(ke,ke,Te.angle),s.rotateX$1(ke,ke,-Te._pitch);const Qe=s.fromQuat(new Float32Array(16),ke),et=s.mapValue(te.properties.get("star-intensity"),0,1,0,.25),Je=5e-4,lt=s.mapValue(te.properties.get("horizon-blend"),0,1,Je,.25),at=s.globeUseCustomAntiAliasing(ne,fe,Te)&&lt===Je?Te.worldSize/(2*Math.PI*1.025)-1:Te.globeRadius,xt=ne.frameCounter/1e3%1,en=s.length(Te.globeCenterInViewSpace),At=Math.sqrt(Math.pow(en,2)-Math.pow(at,2)),Ut=Math.acos(At/en),St=((vt,zt,nn,Ht,an,Wn,hr,kn,er,Fr,Nr,Vn,fi,bi)=>({u_frustum_tl:vt,u_frustum_tr:zt,u_frustum_br:nn,u_frustum_bl:Ht,u_horizon:an,u_transition:Wn,u_fadeout_range:hr,u_color:kn,u_high_color:er,u_space_color:Fr,u_star_intensity:Nr,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Vn,u_horizon_angle:fi,u_rotation_matrix:bi}))(Te.frustumCorners.TL,Te.frustumCorners.TR,Te.frustumCorners.BR,Te.frustumCorners.BL,Te.frustumCorners.horizon,Re,lt,he,Se,Fe,et,xt,Ut,Qe);ne.prepareDrawProgram(fe,Pe);const Kt=ne.atmosphereBuffer;Kt&&Pe.draw(fe,ve.TRIANGLES,Ie,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,St,"skybox",Kt.vertexBuffer,Kt.indexBuffer,Kt.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const ne=this.style._layers[S[this.currentLayer]],te=h._getLayerSourceCache(ne);ne.isSky()&&this.renderLayer(this,te,ne,te?$[te.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<S.length;){const ne=this.style._layers[S[this.currentLayer]],te=h._getLayerSourceCache(ne);if(ne.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(ne)){if(ne.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const fe=te?(ne.type==="symbol"?H:$)[te.id]:void 0;this._renderTileClippingMasks(ne,te,te?L[te.id]:void 0),this.renderLayer(this,te,ne,fe),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ne=null;s.values(this.style._layers).forEach(te=>{const fe=h._getLayerSourceCache(te);fe&&!te.isHidden(this.transform.zoom)&&(!ne||ne.getSource().maxzoom<fe.getSource().maxzoom)&&(ne=fe)}),ne&&this.options.showTileBoundaries&&Gc.debug(this,ne,ne.getVisibleCoordinates())}this.options.showPadding&&function(ne){const te=ne.transform.padding;zA(ne,ne.transform.height-(te.top||0),3,Zh),zA(ne,te.bottom||0,3,sx),yp(ne,te.left||0,3,jg),yp(ne,ne.transform.width-(te.right||0),3,ax);const fe=ne.transform.centerPoint;(function(ve,Te,Ie,Pe){ga(ve,Te-1,Ie-10,2,20,Pe),ga(ve,Te-10,Ie-1,20,2,Pe)})(ne,fe.x,ne.transform.height-fe.y,lx)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}renderLayer(h,m,S,I){S.isHidden(this.transform.zoom)||(S.type==="background"||S.type==="sky"||S.type==="custom"||I&&I.length)&&(this.id=S.id,this.gpuTimingStart(S),(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes(S.type)||h.terrain&&S.type==="custom")&&Gc[S.type](h,m,S,I,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(h){if(!this.options.gpuTiming)return;const m=this.context.extTimerQuery;let S=this.gpuTimers[h.id];S||(S=this.gpuTimers[h.id]={calls:0,cpuTime:0,query:m.createQueryEXT()}),S.calls++,m.beginQueryEXT(m.TIME_ELAPSED_EXT,S.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const h=this.context.extTimerQuery,m=h.createQueryEXT();this.deferredRenderGpuTimeQueries.push(m),h.beginQueryEXT(h.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const h=this.context.extTimerQuery;h.endQueryEXT(h.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;h.endQueryEXT(h.TIME_ELAPSED_EXT)}collectGpuTimers(){const h=this.gpuTimers;return this.gpuTimers={},h}collectDeferredRenderGpuQueries(){const h=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],h}queryGpuTimers(h){const m={};for(const S in h){const I=h[S],L=this.context.extTimerQuery,$=L.getQueryObjectEXT(I.query,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(I.query),m[S]=$}return m}queryGpuTimeDeferredRender(h){if(!this.options.gpuTimingDeferredRender)return 0;const m=this.context.extTimerQuery;let S=0;for(const I of h)S+=m.getQueryObjectEXT(I,m.QUERY_RESULT_EXT)/1e6,m.deleteQueryEXT(I);return S}translatePosMatrix(h,m,S,I,L){if(!S[0]&&!S[1])return h;const $=L?I==="map"?this.transform.angle:0:I==="viewport"?-this.transform.angle:0;if($){const ne=Math.sin($),te=Math.cos($);S=[S[0]*te-S[1]*ne,S[0]*ne+S[1]*te]}const H=[L?S[0]:qe(m,S[0],this.transform.zoom),L?S[1]:qe(m,S[1],this.transform.zoom),0],Q=new Float32Array(16);return s.translate(Q,h,H),Q}saveTileTexture(h){const m=this._tileTextures[h.size[0]];m?m.push(h):this._tileTextures[h.size[0]]=[h]}getTileTexture(h){const m=this._tileTextures[h];return m&&m.length>0?m.pop():null}isPatternMissing(h){return h===null||h!==void 0&&!this.imageManager.getPattern(h.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const h=this.terrain&&this.terrain.renderingToTexture,m=this.terrain&&this.terrain.exaggeration()===0,S=this.style&&this.style.fog,I=[];return this.terrainRenderModeElevated()&&I.push("TERRAIN"),this.transform.projection.name==="globe"&&I.push("GLOBE"),m&&I.push("ZERO_EXAGGERATION"),S&&!h&&S.getOpacity(this.transform.pitch)!==0&&I.push("FOG"),h&&I.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&I.push("OVERDRAW_INSPECTOR"),I}useProgram(h,m,S){this.cache=this.cache||{};const I=S||[],L=this.currentGlobalDefines().concat(I),$=jr.cacheKey(TA[h],h,L,m);return this.cache[$]||(this.cache[$]=new jr(this.context,h,TA[h],m,Hf[h],L)),this.cache[$]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(h,m,S){if(this.terrain&&this.terrain.renderingToTexture)return;const I=this.style.fog;if(I){const L=I.getOpacity(this.transform.pitch),$=((H,Q,ne,te,fe,ve,Te,Ie,Pe,Re,he)=>{const Se=H.transform,Fe=Q.properties.get("color").toArray01();Fe[3]=te;const ke=H.frameCounter/1e3%1;return{u_fog_matrix:ne?Se.calculateFogTileMatrix(ne):H.identityMat,u_fog_range:Q.getFovAdjustedRange(Se._fov),u_fog_color:Fe,u_fog_horizon_blend:Q.properties.get("horizon-blend"),u_fog_temporal_offset:ke,u_frustum_tl:fe,u_frustum_tr:ve,u_frustum_br:Te,u_frustum_bl:Ie,u_globe_pos:Pe,u_globe_radius:Re,u_viewport:he,u_globe_transition:s.globeToMercatorTransition(Se.zoom),u_is_globe:+(Se.projection.name==="globe")}})(this,I,S,L,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);m.setFogUniformValues(h,$)}}setTileLoadedFlag(h){this.tileLoaded=h}saveCanvasCopy(){const h=this.canvasCopy();h&&(this.frameCopies.push(h),this.tileLoaded=!1)}canvasCopy(){const h=this.context.gl,m=h.createTexture();return h.bindTexture(h.TEXTURE_2D,m),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGBA,0,0,h.drawingBufferWidth,h.drawingBufferHeight,0),m}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const h=this.style&&this.style.fog;return!!h&&h.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const h=this._backgroundTiles,m=this._backgroundTiles={},S=this.transform.coveringTiles({tileSize:512});for(const I of S)m[I.key]=h[I.key]||new s.Tile(I,512,this.transform.tileZoom,this);return m}clearBackgroundTiles(){this._backgroundTiles={}}}class $g{constructor(h=0,m=0,S=0,I=0){if(isNaN(h)||h<0||isNaN(m)||m<0||isNaN(S)||S<0||isNaN(I)||I<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=h,this.bottom=m,this.left=S,this.right=I}interpolate(h,m,S){return m.top!=null&&h.top!=null&&(this.top=s.number(h.top,m.top,S)),m.bottom!=null&&h.bottom!=null&&(this.bottom=s.number(h.bottom,m.bottom,S)),m.left!=null&&h.left!=null&&(this.left=s.number(h.left,m.left,S)),m.right!=null&&h.right!=null&&(this.right=s.number(h.right,m.right,S)),this}getCenter(h,m){const S=s.clamp((this.left+h-this.right)/2,0,h),I=s.clamp((this.top+m-this.bottom)/2,0,m);return new s.Point(S,I)}equals(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right}clone(){return new $g(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Hg(v,h){const m=s.getColumn(v,3);s.fromQuat(v,h),s.setColumn(v,3,m)}function Xr(v,h){const m=s.identity$1([]);return s.rotateZ$1(m,m,-h),s.rotateX$1(m,m,-v),m}function bp(v,h){const m=[v[0],v[1],0],S=[h[0],h[1],0];if(s.length(m)>=1e-15){const $=s.normalize([],m);s.scale$2(S,$,s.dot(S,$)),h[0]=S[0],h[1]=S[1]}const I=s.cross([],h,v);if(s.len(I)<1e-15)return null;const L=Math.atan2(-I[1],I[0]);return Xr(Math.atan2(Math.sqrt(v[0]*v[0]+v[1]*v[1]),-v[2]),L)}class F_{constructor(h,m){this.position=h,this.orientation=m}get position(){return this._position}set position(h){if(h){const m=h instanceof s.MercatorCoordinate?h:new s.MercatorCoordinate(h[0],h[1],h[2]);this._renderWorldCopies&&(m.x=s.wrap(m.x,0,1)),this._position=m}else this._position=null}lookAtPoint(h,m){if(this.orientation=null,!this.position)return;const S=this.position,I=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(h)):0,L=s.MercatorCoordinate.fromLngLat(h,I),$=[L.x-S.x,L.y-S.y,L.z-S.z];m||(m=[0,0,1]),m[2]=Math.abs(m[2]),this.orientation=bp($,m)}setPitchBearing(h,m){this.orientation=Xr(s.degToRad(h),s.degToRad(-m))}}class Wg{constructor(h,m){this._transform=s.identity([]),this.orientation=m,this.position=h}get mercatorPosition(){const h=this.position;return new s.MercatorCoordinate(h[0],h[1],h[2])}get position(){const h=s.getColumn(this._transform,3);return[h[0],h[1],h[2]]}set position(h){var m;h&&s.setColumn(this._transform,3,[(m=h)[0],m[1],m[2],1])}get orientation(){return this._orientation}set orientation(h){this._orientation=h||s.identity$1([]),h&&Hg(this._transform,this._orientation)}getPitchBearing(){const h=this.forward(),m=this.right();return{bearing:Math.atan2(-m[1],m[0]),pitch:Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2])}}setPitchBearing(h,m){this._orientation=Xr(h,m),Hg(this._transform,this._orientation)}forward(){const h=s.getColumn(this._transform,2);return[-h[0],-h[1],-h[2]]}up(){const h=s.getColumn(this._transform,1);return[-h[0],-h[1],-h[2]]}right(){const h=s.getColumn(this._transform,0);return[h[0],h[1],h[2]]}getCameraToWorld(h,m){const S=new Float64Array(16);return s.invert(S,this.getWorldToCamera(h,m)),S}getWorldToCameraPosition(h,m,S){const I=this.position;s.scale$2(I,I,-h);const L=new Float64Array(16);return s.fromScaling(L,[S,S,S]),s.translate(L,L,I),L[10]*=m,L}getWorldToCamera(h,m){const S=new Float64Array(16),I=new Float64Array(4),L=this.position;return s.conjugate(I,this._orientation),s.scale$2(L,L,-h),s.fromQuat(S,I),s.translate(S,S,L),S[1]*=-1,S[5]*=-1,S[9]*=-1,S[13]*=-1,S[8]*=m,S[9]*=m,S[10]*=m,S[11]*=m,S}getCameraToClipPerspective(h,m,S,I){const L=new Float64Array(16);return s.perspective(L,h,m,S,I),L}getDistanceToElevation(h,m=!1){const S=h===0?0:s.mercatorZfromAltitude(h,m?s.latFromMercatorY(this.position[1]):this.position[1]),I=this.forward();return(S-this.position[2])/I[2]}clone(){return new Wg([...this.position],[...this.orientation])}}function Yh(v,h){const m=qg(v.projection,v.zoom,v.width,v.height),S=function(L,$,H,Q,ne){const te=new s.LngLat(H.lng-180*Qu,H.lat),fe=new s.LngLat(H.lng+180*Qu,H.lat),ve=L.project(te.lng,te.lat),Te=L.project(fe.lng,fe.lat),Ie=-Math.atan2(Te.y-ve.y,Te.x-ve.x),Pe=s.MercatorCoordinate.fromLngLat(H);Pe.y=s.clamp(Pe.y,-1+Qu,1-Qu);const Re=Pe.toLngLat(),he=L.project(Re.lng,Re.lat),Se=s.MercatorCoordinate.fromLngLat(Re);Se.x+=Qu;const Fe=Se.toLngLat(),ke=L.project(Fe.lng,Fe.lat),Qe=wp(ke.x-he.x,ke.y-he.y,Ie),et=s.MercatorCoordinate.fromLngLat(Re);et.y+=Qu;const Je=et.toLngLat(),lt=L.project(Je.lng,Je.lat),at=wp(lt.x-he.x,lt.y-he.y,Ie),xt=Math.abs(Qe.x)/Math.abs(at.y),en=s.identity([]);s.rotateZ(en,en,-Ie*(1-(ne?0:Q)));const At=s.identity([]);return s.scale(At,At,[1,1-(1-xt)*Q,1]),At[4]=-at.x/at.y*Q,s.rotateZ(At,At,Ie),s.multiply(At,en,At),At}(v.projection,0,v.center,m,h),I=k_(v);return s.scale(S,S,[I,I,1]),S}function k_(v){const h=v.projection,m=qg(v.projection,v.zoom,v.width,v.height),S=GA(h,v.center),I=GA(h,s.LngLat.convert(h.center));return Math.pow(2,S*m+(1-m)*I)}function qg(v,h,m,S,I=1/0){const L=v.range;if(!L)return 0;const $=Math.min(I,Math.max(m,S)),H=Math.log($/1024)/Math.LN2;return s.smoothstep(L[0]+H,L[1]+H,h)}const Qu=1/4e4;function GA(v,h){const m=s.clamp(h.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),S=new s.LngLat(h.lng-180*Qu,m),I=new s.LngLat(h.lng+180*Qu,m),L=v.project(S.lng,m),$=v.project(I.lng,m),H=s.MercatorCoordinate.fromLngLat(S),Q=s.MercatorCoordinate.fromLngLat(I),ne=$.x-L.x,te=$.y-L.y,fe=Q.x-H.x,ve=Q.y-H.y,Te=Math.sqrt((fe*fe+ve*ve)/(ne*ne+te*te));return Math.log(Te)/Math.LN2}function wp(v,h,m){const S=Math.cos(m),I=Math.sin(m);return{x:v*S-h*I,y:v*I+h*S}}class Zi{constructor(h,m,S,I,L,$,H){this.tileSize=512,this._renderWorldCopies=L===void 0||L,this._minZoom=h||0,this._maxZoom=m||22,this._minPitch=S??0,this._maxPitch=I??60,this.setProjection($),this.setMaxBounds(H),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new $g,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Wg,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const h=new Zi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return h._elevation=this._elevation,h._centerAltitude=this._centerAltitude,h._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,h.tileSize=this.tileSize,h.mercatorFromTransition=this.mercatorFromTransition,h.width=this.width,h.height=this.height,h.cameraElevationReference=this.cameraElevationReference,h._center=this._center,h._setZoom(this.zoom),h._seaLevelZoom=this._seaLevelZoom,h.angle=this.angle,h._fov=this._fov,h._pitch=this._pitch,h._nearZ=this._nearZ,h._farZ=this._farZ,h._averageElevation=this._averageElevation,h._unmodified=this._unmodified,h._edgeInsets=this._edgeInsets.clone(),h._camera=this._camera.clone(),h._calcMatrices(),h.freezeTileCoverage=this.freezeTileCoverage,h.frustumCorners=this.frustumCorners,h}get elevation(){return this._elevation}set elevation(h){this._elevation!==h&&(this._elevation=h,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(h,m=!1){const S=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||S)&&this._updateCameraOnTerrain(),(h||S)&&this._constrainCamera(m),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(h){this.projectionOptions=h||{name:"mercator"};const m=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const S=!u(m,this.getProjection());return S&&this._calcMatrices(),this.mercatorFromTransition=!1,S}setMercatorFromTransition(){const h=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const m=h!==this.projection.name;return m&&this._calcMatrices(),m}get minZoom(){return this._minZoom}set minZoom(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))}get maxZoom(){return this._maxZoom}set maxZoom(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))}get minPitch(){return this._minPitch}set minPitch(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))}get maxPitch(){return this._maxPitch}set maxPitch(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const h=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(h))}get cameraWorldSize(){const h=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(h))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.Point(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(h){this.rotation=h}get rotation(){return-this.angle/Math.PI*180}set rotation(h){const m=-h*Math.PI/180;var S;this.angle!==m&&(this._unmodified=!1,this.angle=m,this._calcMatrices(),this.rotationMatrix=(S=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(S[1]=0,S[2]=0),S[0]=1,S[3]=1,S),function(I,L,$){var H=L[0],Q=L[1],ne=L[2],te=L[3],fe=Math.sin($),ve=Math.cos($);I[0]=H*ve+ne*fe,I[1]=Q*ve+te*fe,I[2]=H*-fe+ne*ve,I[3]=Q*-fe+te*ve}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(h){const m=s.clamp(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==m&&(this._unmodified=!1,this._pitch=m,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const h=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/h)}set fov(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=s.degToRad(h),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(h){this._averageElevation=h,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(h){const m=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==m&&(this._unmodified=!1,this._setZoom(m),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(h){this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;this._centerAltitude=h.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=h.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const h=this._elevation,m=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],S=this.horizonLineFromTop();let I=0,L=0;for(let $=0;$<m.length;$++){const H=new s.Point(m[$][0]*this.width,S+m[$][1]*(this.height-S)),Q=h.pointCoordinate(H);if(!Q)continue;const ne=1/Math.hypot(Q[0]-this._camera.position[0],Q[1]-this._camera.position[1]);I+=Q[3]*ne,L+=ne}return L===0?NaN:I/L}get center(){return this._center}set center(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const h=this._seaLevelZoom,m=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),S=this.pixelsPerMeter/this.worldSize*m,I=this._mercatorZfromZoom(h),L=this._mercatorZfromZoom(this._maxZoom),$=Math.max(I-S,L);this._setZoom(this._zoomFromMercatorZ($))}get padding(){return this._edgeInsets.toJSON()}set padding(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())}computeZoomRelativeTo(h){const m=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,h.toAltitude()));let S;S=h.z<this._camera.position[2]?[m.x,m.y,m.z]:[h.x,h.y,h.z];const I=s.length(s.sub([],this._camera.position,S));return s.clamp(this._zoomFromMercatorZ(I),this._minZoom,this._maxZoom)}setFreeCameraOptions(h){if(!this.height||!h.position&&!h.orientation)return;this._updateCameraState();let m=!1;if(h.orientation&&!s.exactEquals(h.orientation,this._camera.orientation)&&(m=this._setCameraOrientation(h.orientation)),h.position){const S=[h.position.x,h.position.y,h.position.z];s.exactEquals$1(S,this._camera.position)||(this._setCameraPosition(S),m=!0)}m&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const h=this._camera.position,m=new F_;return m.position=new s.MercatorCoordinate(h[0],h[1],h[2]),m.orientation=this._camera.orientation,m._elevation=this.elevation,m._renderWorldCopies=this.renderWorldCopies,m}_setCameraOrientation(h){if(!s.length$1(h))return!1;s.normalize$1(h,h);const m=s.transformQuat([],[0,0,-1],h),S=s.transformQuat([],[0,-1,0],h);if(S[2]<0)return!1;const I=bp(m,S);return!!I&&(this._camera.orientation=I,!0)}_setCameraPosition(h){const m=this.zoomScale(this.minZoom)*this.tileSize,S=this.zoomScale(this.maxZoom)*this.tileSize,I=this.cameraToCenterDistance;h[2]=s.clamp(h[2],I/S,I/m),this._camera.position=h}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(h){return this._edgeInsets.equals(h)}interpolatePadding(h,m,S){this._unmodified=!1,this._edgeInsets.interpolate(h,m,S),this._constrain(),this._calcMatrices()}coveringZoomLevel(h){const m=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,m)}getVisibleUnwrappedCoordinates(h){const m=[new s.UnwrappedTileID(0,h)];if(this.renderWorldCopies){const S=this.pointCoordinate(new s.Point(0,0)),I=this.pointCoordinate(new s.Point(this.width,0)),L=this.pointCoordinate(new s.Point(this.width,this.height)),$=this.pointCoordinate(new s.Point(0,this.height)),H=Math.floor(Math.min(S.x,I.x,L.x,$.x)),Q=Math.floor(Math.max(S.x,I.x,L.x,$.x)),ne=1;for(let te=H-ne;te<=Q+ne;te++)te!==0&&m.push(new s.UnwrappedTileID(te,h))}return m}coveringTiles(h){let m=this.coveringZoomLevel(h);const S=m,I=this.elevation&&!h.isTerrainDEM,L=this.projection.name==="mercator";if(h.minzoom!==void 0&&m<h.minzoom)return[];h.maxzoom!==void 0&&m>h.maxzoom&&(m=h.maxzoom);const $=this.locationCoordinate(this.center),H=this.center.lat,Q=1<<m,ne=[Q*$.x,Q*$.y,0],te=this.projection.name==="globe",fe=!te,ve=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m,fe),Te=te?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Ie=Q*s.mercatorZfromAltitude(1,this.center.lat),Pe=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),Re=[Q*Te.x,Q*Te.y,Pe*(fe?1:Ie)],he=this.cameraToCenterDistance/h.tileSize*(h.roundZoom?1:.502),Se=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?m:0,Fe=h.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ke=h.isTerrainDEM?-Fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Qe=this.projection.isReprojectedInTileSpace?k_(this):1,et=vt=>{const nn=new s.MercatorCoordinate(vt.x+25e-6,vt.y,vt.z),Ht=new s.MercatorCoordinate(vt.x,vt.y+25e-6,vt.z),an=vt.toLngLat(),Wn=nn.toLngLat(),hr=Ht.toLngLat(),kn=this.locationCoordinate(an),er=this.locationCoordinate(Wn),Fr=this.locationCoordinate(hr),Nr=Math.hypot(er.x-kn.x,er.y-kn.y),Vn=Math.hypot(Fr.x-kn.x,Fr.y-kn.y);return Math.sqrt(Nr*Vn)*Qe/25e-6},Je=vt=>{const zt=Fe,nn=ke;return{aabb:s.tileAABB(this,Q,0,0,0,vt,nn,zt,this.projection),zoom:0,x:0,y:0,minZ:nn,maxZ:zt,wrap:vt,fullyVisible:!1}},lt=[];let at=[];const xt=m,en=h.reparseOverscaled?S:m,At=vt=>vt*vt,Ut=At((Pe-this._centerAltitude)*Ie),St=vt=>{if(!this._elevation||!vt.tileID||!L)return;const zt=this._elevation.getMinMaxForTile(vt.tileID),nn=vt.aabb;zt?(nn.min[2]=zt.min,nn.max[2]=zt.max,nn.center[2]=(nn.min[2]+nn.max[2])/2):(vt.shouldSplit=Kt(vt),vt.shouldSplit||(nn.min[2]=nn.max[2]=nn.center[2]=this._centerAltitude))},Kt=vt=>{if(vt.zoom<Se)return!0;if(vt.zoom===xt)return!1;if(vt.shouldSplit!=null)return vt.shouldSplit;const zt=vt.aabb.distanceX(Re),nn=vt.aabb.distanceY(Re);let Ht=Ut,an=1;if(te){Ht=At(vt.aabb.distanceZ(Re));const kn=Math.pow(2,vt.zoom),er=s.latFromMercatorY((vt.y+1)/kn),Fr=s.latFromMercatorY(vt.y/kn),Nr=Math.min(Math.max(H,er),Fr),Vn=s.circumferenceAtLatitude(Nr)/s.circumferenceAtLatitude(H);if(an=Nr===H?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Vn/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&vt.zoom===xt-1&&Vn>=.9)return!0}else if(I&&(Ht=At(vt.aabb.distanceZ(Re)*Ie)),this.projection.isReprojectedInTileSpace&&S<=5){const kn=Math.pow(2,vt.zoom),er=et(new s.MercatorCoordinate((vt.x+.5)/kn,(vt.y+.5)/kn));an=er>.85?1:er}const Wn=zt*zt+nn*nn+Ht,hr=At((1<<xt-vt.zoom)*he*an*((kn,er)=>{if(er*At(.707)<kn)return 1;const Fr=Math.sqrt(er/kn);return Fr/(1.4144271570014144+(Math.pow(1.1,Fr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ht,Ut),Wn));return Wn<hr};if(this.renderWorldCopies)for(let vt=1;vt<=3;vt++)lt.push(Je(-vt)),lt.push(Je(vt));for(lt.push(Je(0));lt.length>0;){const vt=lt.pop(),zt=vt.x,nn=vt.y;let Ht=vt.fullyVisible;if(!Ht){const an=vt.aabb.intersects(ve);if(an===0)continue;Ht=an===2}if(vt.zoom!==xt&&Kt(vt))for(let an=0;an<4;an++){const Wn=(zt<<1)+an%2,hr=(nn<<1)+(an>>1),kn={aabb:L?vt.aabb.quadrant(an):s.tileAABB(this,Q,vt.zoom+1,Wn,hr,vt.wrap,vt.minZ,vt.maxZ,this.projection),zoom:vt.zoom+1,x:Wn,y:hr,wrap:vt.wrap,fullyVisible:Ht,tileID:void 0,shouldSplit:void 0,minZ:vt.minZ,maxZ:vt.maxZ};I&&!te&&(kn.tileID=new s.OverscaledTileID(vt.zoom+1===xt?en:vt.zoom+1,vt.wrap,vt.zoom+1,Wn,hr),St(kn)),lt.push(kn)}else{const an=vt.zoom===xt?en:vt.zoom;if(h.minzoom&&h.minzoom>an)continue;const Wn=ne[0]-(.5+zt+(vt.wrap<<vt.zoom))*(1<<m-vt.zoom),hr=ne[1]-.5-nn,kn=vt.tileID?vt.tileID:new s.OverscaledTileID(an,vt.wrap,vt.zoom,zt,nn);at.push({tileID:kn,distanceSq:Wn*Wn+hr*hr})}}if(this.fogCullDistSq){const vt=this.fogCullDistSq,zt=this.horizonLineFromTop();at=at.filter(nn=>{const Ht=[0,0,0,1],an=[s.EXTENT,s.EXTENT,0,1],Wn=this.calculateFogTileMatrix(nn.tileID.toUnwrapped());s.transformMat4$1(Ht,Ht,Wn),s.transformMat4$1(an,an,Wn);const hr=s.getAABBPointSquareDist(Ht,an);if(hr===0)return!0;let kn=!1;const er=this._elevation;if(er&&hr>vt&&zt!==0){const Fr=this.calculateProjMatrix(nn.tileID.toUnwrapped());let Nr;h.isTerrainDEM||(Nr=er.getMinMaxForTile(nn.tileID)),Nr||(Nr={min:ke,max:Fe});const Vn=s.furthestTileCorner(this.rotation),fi=[Vn[0]*s.EXTENT,Vn[1]*s.EXTENT,Nr.max];s.transformMat4(fi,fi,Fr),kn=(1-fi[1])*this.height*.5<zt}return hr<vt||kn})}return at.sort((vt,zt)=>vt.distanceSq-zt.distanceSq).map(vt=>vt.tileID)}resize(h,m){this.width=h,this.height=m,this.pixelsToGLUnits=[2/h,-2/m],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(h){return Math.pow(2,h)}scaleZoom(h){return Math.log(h)/Math.LN2}project(h){const m=s.clamp(h.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),S=this.projection.project(h.lng,m);return new s.Point(S.x*this.worldSize,S.y*this.worldSize)}unproject(h){return this.projection.unproject(h.x/this.worldSize,h.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(h,m){let S,I;const L=this.centerPoint;if(this.projection.name==="globe"){const H=this.worldSize;S=(m.x-L.x)/H,I=(m.y-L.y)/H}else{const H=this.pointCoordinate(m),Q=this.pointCoordinate(L);S=H.x-Q.x,I=H.y-Q.y}const $=this.locationCoordinate(h);this.setLocation(new s.MercatorCoordinate($.x-S,$.y-I))}setLocation(h){this.center=this.coordinateLocation(h),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(h){return this.projection.locationPoint(this,h)}locationPoint3D(h){return this.projection.locationPoint(this,h,!0)}pointLocation(h){return this.coordinateLocation(this.pointCoordinate(h))}pointLocation3D(h){return this.coordinateLocation(this.pointCoordinate3D(h))}locationCoordinate(h,m){const S=m?s.mercatorZfromAltitude(m,h.lat):void 0,I=this.projection.project(h.lng,h.lat);return new s.MercatorCoordinate(I.x,I.y,S)}coordinateLocation(h){return this.projection.unproject(h.x,h.y)}pointRayIntersection(h,m){const S=m??this._centerAltitude,I=[h.x,h.y,0,1],L=[h.x,h.y,1,1];s.transformMat4$1(I,I,this.pixelMatrixInverse),s.transformMat4$1(L,L,this.pixelMatrixInverse);const $=L[3];s.scale$1(I,I,1/I[3]),s.scale$1(L,L,1/$);const H=I[2],Q=L[2];return{p0:I,p1:L,t:H===Q?0:(S-H)/(Q-H)}}screenPointToMercatorRay(h){const m=[h.x,h.y,0,1],S=[h.x,h.y,1,1];return s.transformMat4$1(m,m,this.pixelMatrixInverse),s.transformMat4$1(S,S,this.pixelMatrixInverse),s.scale$1(m,m,1/m[3]),s.scale$1(S,S,1/S[3]),m[2]=s.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,S[2]=s.mercatorZfromAltitude(S[2],this._center.lat)*this.worldSize,s.scale$1(m,m,1/this.worldSize),s.scale$1(S,S,1/this.worldSize),new s.Ray([m[0],m[1],m[2]],s.normalize([],s.sub([],S,m)))}rayIntersectionCoordinate(h){const{p0:m,p1:S,t:I}=h,L=s.mercatorZfromAltitude(m[2],this._center.lat),$=s.mercatorZfromAltitude(S[2],this._center.lat);return new s.MercatorCoordinate(s.number(m[0],S[0],I)/this.worldSize,s.number(m[1],S[1],I)/this.worldSize,s.number(L,$,I))}pointCoordinate(h,m=this._centerAltitude){return this.projection.pointCoordinate(this,h.x,h.y,m)}pointCoordinate3D(h){if(!this.elevation)return this.pointCoordinate(h);let m=this.projection.pointCoordinate3D(this,h.x,h.y);if(m)return new s.MercatorCoordinate(m[0],m[1],m[2]);let S=0,I=this.horizonLineFromTop();if(h.y>I)return this.pointCoordinate(h);const L=.02*I,$=h.clone();for(let H=0;H<10&&I-S>L;H++){$.y=s.number(S,I,.66);const Q=this.projection.pointCoordinate3D(this,$.x,$.y);Q?(I=$.y,m=Q):S=$.y}return m?new s.MercatorCoordinate(m[0],m[1],m[2]):this.pointCoordinate(h)}isPointAboveHorizon(h){return this.projection.isPointAboveHorizon(this,h)}isPointOnSurface(h){if(h.y<0||h.y>this.height||h.x<0||h.x>this.width)return!1;if(this.elevation||this.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(h);const m=this.pointCoordinate(h);return m.y>=0&&m.y<=1}_coordinatePoint(h,m){const S=m&&this.elevation?this.elevation.getAtPointOrZero(h,this._centerAltitude):this._centerAltitude,I=[h.x*this.worldSize,h.y*this.worldSize,S+h.toAltitude(),1];return s.transformMat4$1(I,I,this.pixelMatrix),I[3]>0?new s.Point(I[0]/I[3],I[1]/I[3]):new s.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:h,left:m}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,L=this.pointLocation3D(new s.Point(m,h)),$=this.pointLocation3D(new s.Point(I,h)),H=this.pointLocation3D(new s.Point(I,S)),Q=this.pointLocation3D(new s.Point(m,S));let ne=Math.min(L.lng,$.lng,H.lng,Q.lng),te=Math.max(L.lng,$.lng,H.lng,Q.lng),fe=Math.min(L.lat,$.lat,H.lat,Q.lat),ve=Math.max(L.lat,$.lat,H.lat,Q.lat);const Te=Math.pow(2,-this.zoom)/16*270,Ie=this.projection.name==="globe"?1:4,Pe=(Re,he,Se,Fe,ke)=>{const Qe=(Re+Se)/2,et=(he+Fe)/2,Je=new s.Point(Qe,et),{lng:lt,lat:at}=this.pointLocation3D(Je),xt=Math.max(0,ne-lt,fe-at,lt-te,at-ve);ne=Math.min(ne,lt),te=Math.max(te,lt),fe=Math.min(fe,at),ve=Math.max(ve,at),(ke<Ie||xt>Te)&&(Pe(Re,he,Qe,et,ke+1),Pe(Qe,et,Se,Fe,ke+1))};if(Pe(m,h,I,h,1),Pe(I,h,I,S,1),Pe(I,S,m,S,1),Pe(m,S,m,h,1),this.projection.name==="globe"){const[Re,he]=s.polesInViewport(this);Re?(ve=90,te=180,ne=-180):he&&(fe=-90,te=180,ne=-180)}return new s.LngLatBounds(new s.LngLat(ne,fe),new s.LngLat(te,ve))}_getBoundsRectangular(h,m){const{top:S,left:I}=this._edgeInsets,L=this.height-this._edgeInsets.bottom,$=this.width-this._edgeInsets.right,H=new s.Point(I,S),Q=new s.Point($,S),ne=new s.Point($,L),te=new s.Point(I,L);let fe=this.pointCoordinate(H,h),ve=this.pointCoordinate(Q,h);const Te=this.pointCoordinate(ne,m),Ie=this.pointCoordinate(te,m),Pe=(Re,he)=>(he.y-Re.y)/(he.x-Re.x);return fe.y>1&&ve.y>=0?fe=new s.MercatorCoordinate((1-Ie.y)/Pe(Ie,fe)+Ie.x,1):fe.y<0&&ve.y<=1&&(fe=new s.MercatorCoordinate(-Ie.y/Pe(Ie,fe)+Ie.x,0)),ve.y>1&&fe.y>=0?ve=new s.MercatorCoordinate((1-Te.y)/Pe(Te,ve)+Te.x,1):ve.y<0&&fe.y<=1&&(ve=new s.MercatorCoordinate(-Te.y/Pe(Te,ve)+Te.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(fe)).extend(this.coordinateLocation(ve)).extend(this.coordinateLocation(Ie)).extend(this.coordinateLocation(Te))}_getBoundsRectangularTerrain(){const h=this.elevation;if(!h.visibleDemTiles.length||h.isUsingMockSource())return this._getBoundsRectangular(0,0);const m=h.visibleDemTiles.reduce((S,I)=>{if(I.dem){const L=I.dem.tree;S.min=Math.min(S.min,L.minimums[0]),S.max=Math.max(S.max,L.maximums[0])}return S},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(m.min*h.exaggeration(),m.max*h.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(h=!0){const m=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,S=this.height/2-m*(1-this._horizonShift);return h?Math.max(0,S):S}getMaxBounds(){return this.maxBounds}setMaxBounds(h){this.maxBounds=h,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,h&&(this.minLat=h.getSouth(),this.maxLat=h.getNorth(),this.minLng=h.getWest(),this.maxLng=h.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(h,m){return this.projection.createTileMatrix(this,m,h)}calculateDistanceTileData(h){const m=h.key,S=this._distanceTileDataCache;if(S[m])return S[m];const I=h.canonical,L=1/this.height,$=this.cameraWorldSize,H=$/this.zoomScale(I.z),Q=(I.x+Math.pow(2,I.z)*h.wrap)*H,ne=I.y*H,te=this.point;te.x*=$/this.worldSize,te.y*=$/this.worldSize;const fe=this.angle,ve=Math.sin(-fe),Te=-Math.cos(-fe);return S[m]={bearing:[ve,Te],center:[(te.x-Q)*L,(te.y-ne)*L],scale:H/s.EXTENT*L},S[m]}calculateFogTileMatrix(h){const m=h.key,S=this._fogTileMatrixCache;if(S[m])return S[m];const I=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,h);return s.multiply(I,this.worldToFogMatrix,I),S[m]=new Float32Array(I),S[m]}calculateProjMatrix(h,m=!1){const S=h.key,I=m?this._alignedProjMatrixCache:this._projMatrixCache;if(I[S])return I[S];const L=this.calculatePosMatrix(h,this.worldSize);return s.multiply(L,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.alignedProjMatrix:this.projMatrix,L),I[S]=new Float32Array(L),I[S]}calculatePixelsToTileUnitsMatrix(h){const m=h.tileID.key,S=this._pixelsToTileUnitsCache;if(S[m])return S[m];const I=function(L,$){const{scale:H}=L.tileTransform,Q=H*s.EXTENT/(L.tileSize*Math.pow(2,$.zoom-L.tileID.overscaledZ+L.tileID.canonical.z));return ne=new Float32Array(4),ve=(te=$.inverseAdjustmentMatrix)[1],Te=te[2],Ie=te[3],Re=(fe=[Q,Q])[1],ne[0]=te[0]*(Pe=fe[0]),ne[1]=ve*Pe,ne[2]=Te*Re,ne[3]=Ie*Re,ne;var ne,te,fe,ve,Te,Ie,Pe,Re}(h,this);return S[m]=I,S[m]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const h=1/this.worldSize,m=s.fromScaling([],[h,h,h]);return s.multiply(m,m,this.globeMatrix),m}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const h=this._elevation;this._updateCameraState();const m=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,S=this._computeCameraPosition(m),I=this._camera.forward(),L=s.mercatorZfromAltitude(1,this._center.lat);S[2]/=L,I[2]/=L,s.normalize(I,I);const $=h.raycast(S,I,h.exaggeration());if($){const H=s.scaleAndAdd([],S,I,$),Q=new s.MercatorCoordinate(H[0],H[1],s.mercatorZfromAltitude(H[2],s.latFromMercatorY(H[1]))),ne=(Q.z+s.length([Q.x-S[0],Q.y-S[1],Q.z-S[2]*L]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(ne),this._centerAltitude=Q.toAltitude(),this._center=this.coordinateLocation(Q),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(h=!1){if(!this._elevation)return;const m=this._elevation,S=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,I=this._computeCameraPosition(S),L=m.getAtPointOrZero(new s.MercatorCoordinate(...I)),$=this.pixelsPerMeter/this.worldSize*L,H=this._minimumHeightOverTerrain(),Q=I[2]-$;if(Q<=H)if(Q<0||h){const ne=this.locationCoordinate(this._center,this._centerAltitude),te=[I[0],I[1],ne.z-I[2]],fe=s.length(te);te[2]-=(H-Q)/this._pixelsPerMercatorPixel;const ve=s.length(te);if(ve===0)return;s.scale$2(te,te,fe/ve*this._pixelsPerMercatorPixel),this._camera.position=[I[0],I[1],ne.z*this._pixelsPerMercatorPixel-te[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const h=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||h){const ve=this.center;return ve.lat=s.clamp(ve.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!h)&&(ve.lng=s.clamp(ve.lng,this.minLng,this.maxLng)),this.center=ve,void(this._constraining=!1)}const m=this._unmodified,{x:S,y:I}=this.point;let L=0,$=S,H=I;const Q=this.width/2,ne=this.height/2,te=this.worldMinY*this.scale,fe=this.worldMaxY*this.scale;if(I-ne<te&&(H=te+ne),I+ne>fe&&(H=fe-ne),fe-te<this.height&&(L=Math.max(L,this.height/(fe-te)),H=(fe+te)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ve=this.worldMinX*this.scale,Te=this.worldMaxX*this.scale,Ie=this.worldSize/2-(ve+Te)/2;$=(S+Ie+this.worldSize)%this.worldSize-Ie,$-Q<ve&&($=ve+Q),$+Q>Te&&($=Te-Q),Te-ve<this.width&&(L=Math.max(L,this.width/(Te-ve)),$=(Te+ve)/2)}$===S&&H===I||(this.center=this.unproject(new s.Point($,H))),L&&(this.zoom+=this.scaleZoom(L)),this._constrainCamera(),this._unmodified=m,this._constraining=!1}_minZoomForBounds(){let h=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(h=Math.max(h,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),h}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const h=this.centerOffset,m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const S=qg(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,S),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const I=this.projection.zAxisUnit==="meters"?m:1,L=this._camera.getWorldToCamera(this.worldSize,I),$=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);$[8]=2*-h.x/this.width,$[9]=2*h.y/this.height;let H=s.mul([],$,L);if(this.projection.isReprojectedInTileSpace){const et=this.locationCoordinate(this.center),Je=s.identity([]);s.translate(Je,Je,[et.x*this.worldSize,et.y*this.worldSize,0]),s.multiply(Je,Je,Yh(this)),s.translate(Je,Je,[-et.x*this.worldSize,-et.y*this.worldSize,0]),s.multiply(H,H,Je),this.inverseAdjustmentMatrix=function(lt){const at=Yh(lt,!0);return re([],[at[0],at[1],at[4],at[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],H,[this.worldSize,this.worldSize,this.worldSize/I,1]),this.projMatrix=H,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const Q=s.invert([],$);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(Q,this.horizonLineFromTop(),this.height);const ne=new Float32Array(16);s.identity(ne),s.scale(ne,ne,[1,-1,1]),s.rotateX(ne,ne,this._pitch),s.rotateZ(ne,ne,this.angle);const te=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),fe=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;te[8]=2*-h.x/this.width,te[9]=2*(h.y+fe)/this.height,this.skyboxMatrix=s.multiply(ne,te,ne);const ve=this.point,Te=ve.x,Ie=ve.y,Pe=this.width%2/2,Re=this.height%2/2,he=Math.cos(this.angle),Se=Math.sin(this.angle),Fe=Te-Math.round(Te)+he*Pe+Se*Re,ke=Ie-Math.round(Ie)+he*Re+Se*Pe,Qe=new Float64Array(H);if(s.translate(Qe,Qe,[Fe>.5?Fe-1:Fe,ke>.5?ke-1:ke,0]),this.alignedProjMatrix=Qe,H=s.create(),s.scale(H,H,[this.width/2,-this.height/2,1]),s.translate(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=s.create(),s.scale(H,H,[1,-1,1]),s.translate(H,H,[-1,-1,0]),s.scale(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},H=s.invert(new Float64Array(16),this.pixelMatrix),!H)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=H,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const et=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(et,et,L),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=H;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const h=this.cameraWorldSizeForFog,m=this.cameraPixelsPerMeter,S=this._camera.position,I=1/this.height/this._pixelsPerMercatorPixel,L=[h,h,m];s.scale$2(L,L,I),s.scale$2(S,S,-1),s.multiply$2(S,S,L);const $=s.create();s.translate($,$,S),s.scale($,$,L),this.mercatorFogMatrix=$,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(h,m,I)}_computeCameraPosition(h){const m=(h=h||this.pixelsPerMeter)/this.pixelsPerMeter,S=this._camera.forward(),I=this.point,L=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*m-h/this.worldSize*this._centerAltitude;return[I.x/this.worldSize-S[0]*L,I.y/this.worldSize-S[1]*L,h/this.worldSize*this._centerAltitude-S[2]*L]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(h){const m=this._maxCameraBoundsDistance()*Math.cos(this._pitch),S=this._camera.position[2],I=h[2];let L=1;this.projection.wrap&&(this.center=this.center.wrap()),I>0&&(L=Math.min((m-S)/I,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,h,L),this._updateStateFromCamera()}_updateStateFromCamera(){const h=this._camera.position,m=this._camera.forward(),{pitch:S,bearing:I}=this._camera.getPitchBearing(),L=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,$=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),H=Math.max((h[2]-L)/Math.cos(S),$),Q=this._zoomFromMercatorZ(H);s.scaleAndAdd(h,h,m,H),this._pitch=s.clamp(S,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(I,-Math.PI,Math.PI),this._setZoom(s.clamp(Q,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(h[0],h[1],h[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(h){return Math.pow(2,h)*this.tileSize}_mercatorZfromZoom(h){return this.cameraToCenterDistance/this._worldSizeFromZoom(h)}_minimumHeightOverTerrain(){const h=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(h)}_zoomFromMercatorZ(h){return this.scaleZoom(this.cameraToCenterDistance/(h*this.tileSize))}zoomFromMercatorZAdjusted(h){let m=0,S=s.GLOBE_ZOOM_THRESHOLD_MAX,I=0,L=1/0;for(;S-m>1e-6&&S>m;){const $=m+.5*(S-m),H=this.tileSize*Math.pow(2,$),Q=this.getCameraToCenterDistance(this.projection,$,H),ne=this.scaleZoom(Q/(h*this.tileSize)),te=Math.abs($-ne);te<L&&(L=te,I=$),$<ne?m=$:S=$}return I}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(h,m){const S=Math.min(h.x,m.x),I=Math.max(h.x,m.x),L=Math.min(h.y,m.y),$=Math.max(h.y,m.y);if(L<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const H=[new s.Point(S,L),new s.Point(I,$),new s.Point(S,$),new s.Point(I,L)],Q=this.renderWorldCopies?-3:0,ne=this.renderWorldCopies?4:1;for(const te of H){const fe=this.pointRayIntersection(te);if(fe.t<0)return!0;const ve=this.rayIntersectionCoordinate(fe);if(ve.x<Q||ve.y<0||ve.x>ne||ve.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.Point(0,0),new s.Point(this.width,this.height))}zoomDeltaToMovement(h,m){const S=s.length(s.sub([],this._camera.position,h)),I=this._zoomFromMercatorZ(S)+m;return S-this._mercatorZfromZoom(I)}getCameraPoint(){if(this.projection.name==="globe"){const h=function([m,S,I],L){const $=[m,S,I,1];s.transformMat4$1($,$,L);const H=$[3]=Math.max($[3],1e-6);return $[0]/=H,$[1]/=H,$[2]/=H,$}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.Point(h[0],h[1])}{const h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,h))}}getCameraToCenterDistance(h,m=this.zoom,S=this.worldSize){const I=qg(h,m,this.width,this.height,1024),L=h.pixelSpaceConversion(this.center.lat,S,I);return .5/Math.tan(.5*this._fov)*this.height*L}getWorldToCameraMatrix(){const h=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(h,h,this.globeMatrix),h}}function Qh(v,h){let m=!1,S=null;const I=()=>{S=null,m&&(v(),S=setTimeout(I,h),m=!1)};return()=>(m=!0,S||I(),S)}class jA{constructor(h){this._hashName=h&&encodeURIComponent(h),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Qh(this._updateHashUnthrottled.bind(this),300)}addTo(h){return this._map=h,s.window.addEventListener("hashchange",this._onHashChange,!1),h.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const h=this._map;if(!h)return"";const m=Ep(h);if(this._hashName){const S=this._hashName;let I=!1;const L=s.window.location.hash.slice(1).split("&").map($=>{const H=$.split("=")[0];return H===S?(I=!0,`${H}=${m}`):$}).filter($=>$);return I||L.push(`${S}=${m}`),`#${L.join("&")}`}return`#${m}`}_getCurrentHash(){const h=s.window.location.hash.replace("#","");if(this._hashName){let m;return h.split("&").map(S=>S.split("=")).forEach(S=>{S[0]===this._hashName&&(m=S)}),(m&&m[1]||"").split("/")}return h.split("/")}_onHashChange(){const h=this._map;if(!h)return!1;const m=this._getCurrentHash();if(m.length>=3&&!m.some(S=>isNaN(S))){const S=h.dragRotate.isEnabled()&&h.touchZoomRotate.isEnabled()?+(m[3]||0):h.getBearing();return h.jumpTo({center:[+m[2],+m[1]],zoom:+m[0],bearing:S,pitch:+(m[4]||0)}),!0}return!1}_updateHashUnthrottled(){const h=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,h)}}function Ep(v,h){const m=v.getCenter(),S=Math.round(100*v.getZoom())/100,I=Math.ceil((S*Math.LN2+Math.log(512/360/.5))/Math.LN10),L=Math.pow(10,I),$=Math.round(m.lng*L)/L,H=Math.round(m.lat*L)/L,Q=v.getBearing(),ne=v.getPitch();let te=h?`/${$}/${H}/${S}`:`${S}/${H}/${$}`;return(Q||ne)&&(te+="/"+Math.round(10*Q)/10),ne&&(te+=`/${Math.round(ne)}`),te}const Kh={linearity:.3,easing:s.bezier(0,0,.3,1)},Sp=s.extend({deceleration:2500,maxSpeed:1400},Kh),Tp=s.extend({deceleration:20,maxSpeed:1400},Kh),Sn=s.extend({deceleration:1e3,maxSpeed:360},Kh),Vl=s.extend({deceleration:1e3,maxSpeed:90},Kh);class z_{constructor(h){this._map=h,this.clear()}clear(){this._inertiaBuffer=[]}record(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:h})}_drainInertiaBuffer(){const h=this._inertiaBuffer,m=s.exported.now();for(;h.length>0&&m-h[0].time>160;)h.shift()}_onMoveEnd(h){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const m={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:L}of this._inertiaBuffer)m.zoom+=L.zoomDelta||0,m.bearing+=L.bearingDelta||0,m.pitch+=L.pitchDelta||0,L.panDelta&&m.pan._add(L.panDelta),L.around&&(m.around=L.around),L.pinchAround&&(m.pinchAround=L.pinchAround);const S=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,I={};if(m.pan.mag()){const L=Pp(m.pan.mag(),S,s.extend({},Sp,h||{}));I.offset=m.pan.mult(L.amount/m.pan.mag()),I.center=this._map.transform.center,Cp(I,L)}if(m.zoom){const L=Pp(m.zoom,S,Tp);I.zoom=this._map.transform.zoom+L.amount,Cp(I,L)}if(m.bearing){const L=Pp(m.bearing,S,Sn);I.bearing=this._map.transform.bearing+s.clamp(L.amount,-179,179),Cp(I,L)}if(m.pitch){const L=Pp(m.pitch,S,Vl);I.pitch=this._map.transform.pitch+L.amount,Cp(I,L)}if(I.zoom||I.bearing){const L=m.pinchAround===void 0?m.around:m.pinchAround;I.around=L?this._map.unproject(L):this._map.getCenter()}return this.clear(),I.noMoveStart=!0,I}}function Cp(v,h){(!v.duration||v.duration<h.duration)&&(v.duration=h.duration,v.easing=h.easing)}function Pp(v,h,m){const{maxSpeed:S,linearity:I,deceleration:L}=m,$=s.clamp(v*I/(h/1e3),-S,S),H=Math.abs($)/(L*I);return{easing:m.easing,duration:1e3*H,amount:$*(H/2)}}class hs extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,m,S,I={}){const L=Y(m.getCanvasContainer(),S),$=m.unproject(L);super(h,s.extend({point:L,lngLat:$,originalEvent:S},I)),this._defaultPrevented=!1,this.target=m}}class Vc extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,m,S){const I=h==="touchend"?S.changedTouches:S.touches,L=J(m.getCanvasContainer(),I),$=L.map(Q=>m.unproject(Q)),H=L.reduce((Q,ne,te,fe)=>Q.add(ne.div(fe.length)),new s.Point(0,0));super(h,{points:L,point:H,lngLats:$,lngLat:m.unproject(H),originalEvent:S}),this._defaultPrevented=!1}}class Ga extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,m,S){super(h,{originalEvent:S}),this._defaultPrevented=!1}}class Mr{constructor(h,m){this._map=h,this._clickTolerance=m.clickTolerance}reset(){this._mousedownPos=void 0}wheel(h){return this._firePreventable(new Ga(h.type,this._map,h))}mousedown(h,m){return this._mousedownPos=m,this._firePreventable(new hs(h.type,this._map,h))}mouseup(h){this._map.fire(new hs(h.type,this._map,h))}preclick(h){const m=s.extend({},h);m.type="preclick",this._map.fire(new hs(m.type,this._map,m))}click(h,m){this._mousedownPos&&this._mousedownPos.dist(m)>=this._clickTolerance||(this.preclick(h),this._map.fire(new hs(h.type,this._map,h)))}dblclick(h){return this._firePreventable(new hs(h.type,this._map,h))}mouseover(h){this._map.fire(new hs(h.type,this._map,h))}mouseout(h){this._map.fire(new hs(h.type,this._map,h))}touchstart(h){return this._firePreventable(new Vc(h.type,this._map,h))}touchmove(h){this._map.fire(new Vc(h.type,this._map,h))}touchend(h){this._map.fire(new Vc(h.type,this._map,h))}touchcancel(h){this._map.fire(new Vc(h.type,this._map,h))}_firePreventable(h){if(this._map.fire(h),h.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ma{constructor(h){this._map=h}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(h){this._map.fire(new hs(h.type,this._map,h))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new hs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(h){this._delayContextMenu?this._contextMenuEvent=h:this._map.fire(new hs(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class U_{constructor(h,m){this._map=h,this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=m.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(h,m){this.isEnabled()&&h.shiftKey&&h.button===0&&(z(),this._startPos=this._lastPos=m,this._active=!0)}mousemoveWindow(h,m){if(!this._active)return;const S=m,I=this._startPos,L=this._lastPos;if(!I||!L||L.equals(S)||!this._box&&S.dist(I)<this._clickTolerance)return;this._lastPos=S,this._box||(this._box=E("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",h));const $=Math.min(I.x,S.x),H=Math.max(I.x,S.x),Q=Math.min(I.y,S.y),ne=Math.max(I.y,S.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${$}px,${Q}px)`,this._box.style.width=H-$+"px",this._box.style.height=ne-Q+"px")})}mouseupWindow(h,m){if(!this._active)return;const S=this._startPos,I=m;if(S&&h.button===0){if(this.reset(),X(),S.x!==I.x||S.y!==I.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:h})),{cameraAnimation:L=>L.fitScreenCoordinates(S,I,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",h)}}keydown(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),F(),delete this._startPos,delete this._lastPos}_fireEvent(h,m){return this._map.fire(new s.Event(h,{originalEvent:m}))}}function $c(v,h){const m={};for(let S=0;S<v.length;S++)m[v[S].identifier]=h[S];return m}class Wf{constructor(h){this.reset(),this.numTouches=h.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(h,m,S){(this.centroid||S.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=h.timeStamp),S.length===this.numTouches&&(this.centroid=function(I){const L=new s.Point(0,0);for(const $ of I)L._add($);return L.div(I.length)}(m),this.touches=$c(S,m)))}touchmove(h,m,S){if(this.aborted||!this.centroid)return;const I=$c(S,m);for(const L in this.touches){const $=I[L];(!$||$.dist(this.touches[L])>30)&&(this.aborted=!0)}}touchend(h,m,S){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),S.length===0){const I=!this.aborted&&this.centroid;if(this.reset(),I)return I}}}class VA{constructor(h){this.singleTap=new Wf(h),this.numTaps=h.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(h,m,S){this.singleTap.touchstart(h,m,S)}touchmove(h,m,S){this.singleTap.touchmove(h,m,S)}touchend(h,m,S){const I=this.singleTap.touchend(h,m,S);if(I){const L=h.timeStamp-this.lastTime<500,$=!this.lastTap||this.lastTap.dist(I)<30;if(L&&$||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=I,this.count===this.numTaps)return this.reset(),I}}}class Hc{constructor(){this._zoomIn=new VA({numTouches:1,numTaps:2}),this._zoomOut=new VA({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(h,m,S){this._zoomIn.touchstart(h,m,S),this._zoomOut.touchstart(h,m,S)}touchmove(h,m,S){this._zoomIn.touchmove(h,m,S),this._zoomOut.touchmove(h,m,S)}touchend(h,m,S){const I=this._zoomIn.touchend(h,m,S),L=this._zoomOut.touchend(h,m,S);return I?(this._active=!0,h.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:$=>$.easeTo({duration:300,zoom:$.getZoom()+1,around:$.unproject(I)},{originalEvent:h})}):L?(this._active=!0,h.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:$=>$.easeTo({duration:300,zoom:$.getZoom()-1,around:$.unproject(L)},{originalEvent:h})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const An={0:1,2:2};class Dn{constructor(h){this.reset(),this._clickTolerance=h.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(h,m){return!1}_move(h,m){return{}}mousedown(h,m){if(this._lastPoint)return;const S=ie(h);this._correctButton(h,S)&&(this._lastPoint=m,this._eventButton=S)}mousemoveWindow(h,m){const S=this._lastPoint;if(S){if(h.preventDefault(),this._eventButton!=null&&function(I,L){const $=An[L];return I.buttons===void 0||(I.buttons&$)!==$}(h,this._eventButton))this.reset();else if(this._moved||!(m.dist(S)<this._clickTolerance))return this._moved=!0,this._lastPoint=m,this._move(S,m)}}mouseupWindow(h){this._lastPoint&&ie(h)===this._eventButton&&(this._moved&&X(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xg extends Dn{mousedown(h,m){super.mousedown(h,m),this._lastPoint&&(this._active=!0)}_correctButton(h,m){return m===0&&!h.ctrlKey}_move(h,m){return{around:m,panDelta:m.sub(h)}}}class Jh extends Dn{_correctButton(h,m){return m===0&&h.ctrlKey||m===2}_move(h,m){const S=.8*(m.x-h.x);if(S)return this._active=!0,{bearingDelta:S}}contextmenu(h){h.preventDefault()}}class ed extends Dn{_correctButton(h,m){return m===0&&h.ctrlKey||m===2}_move(h,m){const S=-.5*(m.y-h.y);if(S)return this._active=!0,{pitchDelta:S}}contextmenu(h){h.preventDefault()}}class Aa{constructor(h,m){this._map=h,this._el=h.getCanvasContainer(),this._minTouches=1,this._clickTolerance=m.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)}touchstart(h,m,S){return this._calculateTransform(h,m,S)}touchmove(h,m,S){if(this._active&&!(S.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(S.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return h.cancelable&&h.preventDefault(),this._calculateTransform(h,m,S)}}touchend(h,m,S){this._calculateTransform(h,m,S),this._active&&S.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(h,m,S){S.length>0&&(this._active=!0);const I=$c(S,m),L=new s.Point(0,0),$=new s.Point(0,0);let H=0;for(const ne in I){const te=I[ne],fe=this._touches[ne];fe&&(L._add(te),$._add(te.sub(fe)),H++,I[ne]=te)}if(this._touches=I,H<this._minTouches||!$.mag())return;const Q=$.div(H);return this._sum._add(Q),this._sum.mag()<this._clickTolerance?void 0:{around:L.div(H),panDelta:Q}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=E("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class td{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(h){}_move(h,m,S){return{}}touchstart(h,m,S){this._firstTwoTouches||S.length<2||(this._firstTwoTouches=[S[0].identifier,S[1].identifier],this._start([m[0],m[1]]))}touchmove(h,m,S){const I=this._firstTwoTouches;if(!I)return;h.preventDefault();const[L,$]=I,H=al(S,m,L),Q=al(S,m,$);if(!H||!Q)return;const ne=this._aroundCenter?null:H.add(Q).div(2);return this._move([H,Q],ne,h)}touchend(h,m,S){if(!this._firstTwoTouches)return;const[I,L]=this._firstTwoTouches,$=al(S,m,I),H=al(S,m,L);$&&H||(this._active&&X(),this.reset())}touchcancel(){this.reset()}enable(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function al(v,h,m){for(let S=0;S<v.length;S++)if(v[S].identifier===m)return h[S]}function y(v,h){return Math.log(v/h)/Math.LN2}class x extends td{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(h){this._startDistance=this._distance=h[0].dist(h[1])}_move(h,m){const S=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(y(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:y(this._distance,S),pinchAround:m}}}function T(v,h){return 180*v.angleWith(h)/Math.PI}class O extends td{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])}_move(h,m){const S=this._vector;if(this._vector=h[0].sub(h[1]),S&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:T(this._vector,S),pinchAround:m}}_isBelowThreshold(h){this._minDiameter=Math.min(this._minDiameter,h.mag());const m=25/(Math.PI*this._minDiameter)*360,S=this._startVector;if(!S)return!1;const I=T(h,S);return Math.abs(I)<m}}function D(v){return Math.abs(v.y)>Math.abs(v.x)}class j extends td{constructor(h){super(),this._map=h}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(h){this._lastPoints=h,D(h[0].sub(h[1]))&&(this._valid=!1)}_move(h,m,S){const I=this._lastPoints;if(!I)return;const L=h[0].sub(I[0]),$=h[1].sub(I[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&S.touches.length<3||(this._valid=this.gestureBeginsVertically(L,$,S.timeStamp),!this._valid)?void 0:(this._lastPoints=h,this._active=!0,{pitchDelta:(L.y+$.y)/2*-.5})}gestureBeginsVertically(h,m,S){if(this._valid!==void 0)return this._valid;const I=h.mag()>=2,L=m.mag()>=2;if(!I&&!L)return;if(!I||!L)return this._firstMove==null&&(this._firstMove=S),S-this._firstMove<100&&void 0;const $=h.y>0==m.y>0;return D(h)&&D(m)&&$}}const G={panStep:100,bearingStep:15,pitchStep:10};class Z{constructor(){const h=G;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(h){if(h.altKey||h.ctrlKey||h.metaKey)return;let m=0,S=0,I=0,L=0,$=0;switch(h.keyCode){case 61:case 107:case 171:case 187:m=1;break;case 189:case 109:case 173:m=-1;break;case 37:h.shiftKey?S=-1:(h.preventDefault(),L=-1);break;case 39:h.shiftKey?S=1:(h.preventDefault(),L=1);break;case 38:h.shiftKey?I=1:(h.preventDefault(),$=-1);break;case 40:h.shiftKey?I=-1:(h.preventDefault(),$=1);break;default:return}return this._rotationDisabled&&(S=0,I=0),{cameraAnimation:H=>{const Q=H.getZoom();H.easeTo({duration:300,easeId:"keyboardHandler",easing:ae,zoom:m?Math.round(Q)+m*(h.shiftKey?2:1):Q,bearing:H.getBearing()+S*this._bearingStep,pitch:H.getPitch()+I*this._pitchStep,offset:[-L*this._panStep,-$*this._panStep],center:H.getCenter()},{originalEvent:h})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ae(v){return v*(2-v)}const pe=4.000244140625;class _e{constructor(h,m){this._map=h,this._el=h.getCanvasContainer(),this._handler=m,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(h){this._defaultZoomRate=h}setWheelZoomRate(h){this._wheelZoomRate=h}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!h&&h.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(h){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(h.ctrlKey||h.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let m=h.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY;const S=s.exported.now(),I=S-(this._lastWheelEventTime||0);this._lastWheelEventTime=S,m!==0&&m%pe==0?this._type="wheel":m!==0&&Math.abs(m)<4?this._type="trackpad":I>400?(this._type=null,this._lastValue=m,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(I*m)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,m+=this._lastValue)),h.shiftKey&&m&&(m/=4),this._type&&(this._lastWheelEvent=h,this._delta-=m,this._active||this._start(h)),h.preventDefault()}_onTimeout(h){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)}_start(h){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const m=Y(this._el,h);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:m,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const h=this._map.transform;this._type==="wheel"&&h.projection.wrap&&(h._center.lng>=180||h._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const m=()=>h._terrainEnabled()&&this._aroundCoord?h.computeZoomRelativeTo(this._aroundCoord):h.zoom;if(this._delta!==0){const Q=this._type==="wheel"&&Math.abs(this._delta)>pe?this._wheelZoomRate:this._defaultZoomRate;let ne=2/(1+Math.exp(-Math.abs(this._delta*Q)));this._delta<0&&ne!==0&&(ne=1/ne);const te=m(),fe=Math.pow(2,te),ve=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):fe;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(ve*ne))),this._type==="wheel"&&(this._startZoom=te,this._easing=this._smoothOutEasing(200)),this._delta=0}const S=typeof this._targetZoom=="number"?this._targetZoom:m(),I=this._startZoom,L=this._easing;let $,H=!1;if(this._type==="wheel"&&I&&L){const Q=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),ne=L(Q);$=s.number(I,S,ne),Q<1?this._frameId||(this._frameId=!0):H=!0}else $=S,H=!0;return this._active=!0,H&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!H,zoomDelta:$-m(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(h){let m=s.ease;if(this._prevEase){const S=this._prevEase,I=(s.exported.now()-S.start)/S.duration,L=S.easing(I+.01)-S.easing(I),$=.27/Math.sqrt(L*L+1e-4)*.01,H=Math.sqrt(.0729-$*$);m=s.bezier($,H,.25,1)}return this._prevEase={start:s.exported.now(),duration:h,easing:m},m}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=E("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Xe{constructor(h,m){this._clickZoom=h,this._tapZoom=m}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class nt{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(h,m){return h.preventDefault(),{cameraAnimation:S=>{S.easeTo({duration:300,zoom:S.getZoom()+(h.shiftKey?-1:1),around:S.unproject(m)},{originalEvent:h})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mt{constructor(){this._tap=new VA({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(h,m,S){this._swipePoint||(this._tapTime&&h.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?S.length>0&&(this._swipePoint=m[0],this._swipeTouch=S[0].identifier):this._tap.touchstart(h,m,S))}touchmove(h,m,S){if(this._tapTime){if(this._swipePoint){if(S[0].identifier!==this._swipeTouch)return;const I=m[0],L=I.y-this._swipePoint.y;return this._swipePoint=I,h.preventDefault(),this._active=!0,{zoomDelta:L/128}}}else this._tap.touchmove(h,m,S)}touchend(h,m,S){this._tapTime?this._swipePoint&&S.length===0&&this.reset():this._tap.touchend(h,m,S)&&(this._tapTime=h.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kt{constructor(h,m,S){this._el=h,this._mousePan=m,this._touchPan=S}enable(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vt{constructor(h,m,S){this._pitchWithRotate=h.pitchWithRotate,this._mouseRotate=m,this._mousePitch=S}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class yn{constructor(h,m,S,I){this._el=h,this._touchZoom=m,this._touchRotate=S,this._tapDragZoom=I,this._rotationDisabled=!1,this._enabled=!0}enable(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Cn=v=>v.zoom||v.drag||v.pitch||v.rotate;class Rt extends s.Event{}class fn{constructor(){this.constants=[1,1,.01],this.radius=0}setup(h,m){const S=s.sub([],m,h);this.radius=s.length(S[2]<0?s.div([],S,this.constants):[S[0],S[1],0])}projectRay(h){s.div(h,h,this.constants),s.normalize(h,h),s.mul$1(h,h,this.constants);const m=s.scale$2([],h,this.radius);if(m[2]>0){const S=s.scale$2([],[0,0,1],s.dot(m,[0,0,1])),I=s.scale$2([],s.normalize([],[m[0],m[1],0]),this.radius),L=s.add([],m,s.scale$2([],s.sub([],s.add([],I,S),m),2));m[0]=L[0],m[1]=L[1]}return m}}function ot(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class On{constructor(h,m){this._map=h,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new z_(h),this._bearingSnap=m.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new fn,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(m),s.bindAll(["handleEvent","handleWindowEvent"],this);const S=this._el;this._listeners=[[S,"touchstart",{passive:!0}],[S,"touchmove",{passive:!1}],[S,"touchend",void 0],[S,"touchcancel",void 0],[S,"mousedown",void 0],[S,"mousemove",void 0],[S,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[S,"mouseover",void 0],[S,"mouseout",void 0],[S,"dblclick",void 0],[S,"click",void 0],[S,"keydown",{capture:!1}],[S,"keyup",void 0],[S,"wheel",{passive:!1}],[S,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[I,L,$]of this._listeners)I.addEventListener(L,I===s.window.document?this.handleWindowEvent:this.handleEvent,$)}destroy(){for(const[h,m,S]of this._listeners)h.removeEventListener(m,h===s.window.document?this.handleWindowEvent:this.handleEvent,S)}_addDefaultHandlers(h){const m=this._map,S=m.getCanvasContainer();this._add("mapEvent",new Mr(m,h));const I=m.boxZoom=new U_(m,h);this._add("boxZoom",I);const L=new Hc,$=new nt;m.doubleClickZoom=new Xe($,L),this._add("tapZoom",L),this._add("clickZoom",$);const H=new mt;this._add("tapDragZoom",H);const Q=m.touchPitch=new j(m);this._add("touchPitch",Q);const ne=new Jh(h),te=new ed(h);m.dragRotate=new Vt(h,ne,te),this._add("mouseRotate",ne,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]);const fe=new Xg(h),ve=new Aa(m,h);m.dragPan=new kt(S,fe,ve),this._add("mousePan",fe),this._add("touchPan",ve,["touchZoom","touchRotate"]);const Te=new O,Ie=new x;m.touchZoomRotate=new yn(S,Ie,Te,H),this._add("touchRotate",Te,["touchPan","touchZoom"]),this._add("touchZoom",Ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ma(m));const Pe=m.scrollZoom=new _e(m,this);this._add("scrollZoom",Pe,["mousePan"]);const Re=m.keyboard=new Z;this._add("keyboard",Re);for(const he of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])h.interactive&&h[he]&&m[he].enable(h[he])}_add(h,m,S){this._handlers.push({handlerName:h,handler:m,allowed:S}),this._handlersById[h]=m}stop(h){if(!this._updatingCamera){for(const{handler:m}of this._handlers)m.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[]}}isActive(){for(const{handler:h}of this._handlers)if(h.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Cn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(h,m,S){for(const I in h)if(I!==S&&(!m||m.indexOf(I)<0))return!0;return!1}handleWindowEvent(h){this.handleEvent(h,`${h.type}Window`)}_getMapTouches(h){const m=[];for(const S of h)this._el.contains(S.target)&&m.push(S);return m}handleEvent(h,m){this._updatingCamera=!0;const S=h.type==="renderFrame",I=S?void 0:h,L={needsRenderFrame:!1},$={},H={},Q=h.touches?this._getMapTouches(h.touches):void 0,ne=Q?J(this._el,Q):S?void 0:Y(this._el,h);for(const{handlerName:ve,handler:Te,allowed:Ie}of this._handlers){if(!Te.isEnabled())continue;let Pe;this._blockedByActive(H,Ie,ve)?Te.reset():Te[m||h.type]&&(Pe=Te[m||h.type](h,ne,Q),this.mergeHandlerResult(L,$,Pe,ve,I),Pe&&Pe.needsRenderFrame&&this._triggerRenderFrame()),(Pe||Te.isActive())&&(H[ve]=Te)}const te={};for(const ve in this._previousActiveHandlers)H[ve]||(te[ve]=I);this._previousActiveHandlers=H,(Object.keys(te).length||ot(L))&&(this._changes.push([L,$,te]),this._triggerRenderFrame()),(Object.keys(H).length||ot(L))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:fe}=L;fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],fe(this._map))}mergeHandlerResult(h,m,S,I,L){if(!S)return;s.extend(h,S);const $={handlerName:I,originalEvent:S.originalEvent||L};S.zoomDelta!==void 0&&(m.zoom=$),S.panDelta!==void 0&&(m.drag=$),S.pitchDelta!==void 0&&(m.pitch=$),S.bearingDelta!==void 0&&(m.rotate=$)}_applyChanges(){const h={},m={},S={};for(const[I,L,$]of this._changes)I.panDelta&&(h.panDelta=(h.panDelta||new s.Point(0,0))._add(I.panDelta)),I.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+I.zoomDelta),I.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+I.bearingDelta),I.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+I.pitchDelta),I.around!==void 0&&(h.around=I.around),I.aroundCoord!==void 0&&(h.aroundCoord=I.aroundCoord),I.pinchAround!==void 0&&(h.pinchAround=I.pinchAround),I.noInertia&&(h.noInertia=I.noInertia),s.extend(m,L),s.extend(S,$);this._updateMapTransform(h,m,S),this._changes=[]}_updateMapTransform(h,m,S){const I=this._map,L=I.transform,$=Se=>[Se.x,Se.y,Se.z];if((Se=>{const Fe=this._eventsInProgress.drag;return Fe&&!this._handlersById[Fe.handlerName].isActive()})()&&!ot(h)){const Se=L.zoom;L.cameraElevationReference="sea",L.recenterOnTerrain(),L.cameraElevationReference="ground",Se!==L.zoom&&this._map._update(!0)}if(L._isCameraConstrained&&I._stop(!0),!ot(h))return void this._fireEvents(m,S,!0);let{panDelta:H,zoomDelta:Q,bearingDelta:ne,pitchDelta:te,around:fe,aroundCoord:ve,pinchAround:Te}=h;L._isCameraConstrained&&(Q>0&&(Q=0),L._isCameraConstrained=!1),Te!==void 0&&(fe=Te),(Q||(Se=>m[Se]&&!this._eventsInProgress[Se])("drag"))&&fe&&(this._dragOrigin=$(L.pointCoordinate3D(fe)),this._trackingEllipsoid.setup(L._camera.position,this._dragOrigin)),L.cameraElevationReference="sea",I._stop(!0),fe=fe||I.transform.centerPoint,ne&&(L.bearing+=ne),te&&(L.pitch+=te),L._updateCameraState();const Ie=[0,0,0];if(H)if(L.projection.name==="mercator"){const Se=this._trackingEllipsoid.projectRay(L.screenPointToMercatorRay(fe).dir),Fe=this._trackingEllipsoid.projectRay(L.screenPointToMercatorRay(fe.sub(H)).dir);Ie[0]=Fe[0]-Se[0],Ie[1]=Fe[1]-Se[1]}else{const Se=L.pointCoordinate(fe);if(L.projection.name==="globe"){H=H.rotate(-L.angle);const Fe=L._pixelsPerMercatorPixel/L.worldSize;Ie[0]=-H.x*s.mercatorScale(s.latFromMercatorY(Se.y))*Fe,Ie[1]=-H.y*s.mercatorScale(L.center.lat)*Fe}else{const Fe=L.pointCoordinate(fe.sub(H));Se&&Fe&&(Ie[0]=Fe.x-Se.x,Ie[1]=Fe.y-Se.y)}}const Pe=L.zoom,Re=[0,0,0];if(Q){const Se=$(ve||L.pointCoordinate3D(fe)),Fe={dir:s.normalize([],s.sub([],Se,L._camera.position))};if(Fe.dir[2]<0){const ke=L.zoomDeltaToMovement(Se,Q);s.scale$2(Re,Fe.dir,ke)}}const he=s.add(Ie,Ie,Re);L._translateCameraConstrained(he),Q&&Math.abs(L.zoom-Pe)>1e-4&&L.recenterOnTerrain(),L.cameraElevationReference="ground",this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(m,S,!0)}_fireEvents(h,m,S){const I=Cn(this._eventsInProgress),L=Cn(h),$={};for(const te in h){const{originalEvent:fe}=h[te];this._eventsInProgress[te]||($[`${te}start`]=fe),this._eventsInProgress[te]=h[te]}!I&&L&&this._fireEvent("movestart",L.originalEvent);for(const te in $)this._fireEvent(te,$[te]);L&&this._fireEvent("move",L.originalEvent);for(const te in h){const{originalEvent:fe}=h[te];this._fireEvent(te,fe)}const H={};let Q;for(const te in this._eventsInProgress){const{handlerName:fe,originalEvent:ve}=this._eventsInProgress[te];this._handlersById[fe].isActive()||(delete this._eventsInProgress[te],Q=m[fe]||ve,H[`${te}end`]=Q)}for(const te in H)this._fireEvent(te,H[te]);const ne=Cn(this._eventsInProgress);if(S&&(I||L)&&!ne){this._updatingCamera=!0;const te=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),fe=ve=>ve!==0&&-this._bearingSnap<ve&&ve<this._bearingSnap;te?(fe(te.bearing||this._map.getBearing())&&(te.bearing=0),this._map.easeTo(te,{originalEvent:Q})):(this._map.fire(new s.Event("moveend",{originalEvent:Q})),fe(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(h,m){this._map.fire(new s.Event(h,m?{originalEvent:m}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(h=>{this._frameId=void 0,this.handleEvent(new Rt("renderFrame",{timeStamp:h})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Bn="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Pn extends s.Evented{constructor(h,m){super(),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=m.bearingSnap,this._respectPrefersReducedMotion=m.respectPrefersReducedMotion!==!1,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(h,m){return this.jumpTo({center:h},m)}panBy(h,m,S){return h=s.Point.convert(h).mult(-1),this.panTo(this.transform.center,s.extend({offset:h},m),S)}panTo(h,m,S){return this.easeTo(s.extend({center:h},m),S)}getZoom(){return this.transform.zoom}setZoom(h,m){return this.jumpTo({zoom:h},m),this}zoomTo(h,m,S){return this.easeTo(s.extend({zoom:h},m),S)}zoomIn(h,m){return this.zoomTo(this.getZoom()+1,h,m),this}zoomOut(h,m){return this.zoomTo(this.getZoom()-1,h,m),this}getBearing(){return this.transform.bearing}setBearing(h,m){return this.jumpTo({bearing:h},m),this}getPadding(){return this.transform.padding}setPadding(h,m){return this.jumpTo({padding:h},m),this}rotateTo(h,m,S){return this.easeTo(s.extend({bearing:h},m),S)}resetNorth(h,m){return this.rotateTo(0,s.extend({duration:1e3},h),m),this}resetNorthPitch(h,m){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},h),m),this}snapToNorth(h,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,m):this}getPitch(){return this.transform.pitch}setPitch(h,m){return this.jumpTo({pitch:h},m),this}cameraForBounds(h,m){h=s.LngLatBounds.convert(h);const S=m&&m.bearing||0,I=m&&m.pitch||0,L=h.getNorthWest(),$=h.getSouthEast();return this._cameraForBounds(this.transform,L,$,S,I,m)}_extendCameraOptions(h){const m={top:0,bottom:0,right:0,left:0};if(typeof(h=s.extend({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const S=h.padding;h.padding={top:S,bottom:S,right:S,left:S}}return h.padding=s.extend(m,h.padding),h}_minimumAABBFrustumDistance(h,m){const S=m.max[0]-m.min[0],I=m.max[1]-m.min[1];return S/I>h.aspect?S/(2*Math.tan(.5*h.fovX)*h.aspect):I/(2*Math.tan(.5*h.fovY)*h.aspect)}_cameraForBoundsOnGlobe(h,m,S,I,L,$){const H=h.clone(),Q=this._extendCameraOptions($);H.bearing=I,H.pitch=L;const ne=s.LngLat.convert(m),te=s.LngLat.convert(S),fe=.5*(ne.lat+te.lat),ve=.5*(ne.lng+te.lng),Te=s.latLngToECEF(fe,ve),Ie=s.normalize([],Te),Pe=s.normalize([],s.cross([],Ie,[0,1,0])),Re=s.cross([],Pe,Ie),he=[Pe[0],Pe[1],Pe[2],0,Re[0],Re[1],Re[2],0,Ie[0],Ie[1],Ie[2],0,0,0,0,1],Se=[Te,s.latLngToECEF(ne.lat,ne.lng),s.latLngToECEF(te.lat,ne.lng),s.latLngToECEF(te.lat,te.lng),s.latLngToECEF(ne.lat,te.lng),s.latLngToECEF(fe,ne.lng),s.latLngToECEF(fe,te.lng),s.latLngToECEF(ne.lat,ve),s.latLngToECEF(te.lat,ve)];let Fe=s.Aabb.fromPoints(Se.map(Ht=>[s.dot(Pe,Ht),s.dot(Re,Ht),s.dot(Ie,Ht)]));const ke=s.transformMat4([],Fe.center,he);s.squaredLength(ke)===0&&s.set(ke,0,0,1),s.normalize(ke,ke),s.scale$2(ke,ke,s.GLOBE_RADIUS),H.center=s.ecefToLatLng(ke);const Qe=H.getWorldToCameraMatrix(),et=s.invert(new Float64Array(16),Qe);Fe=s.Aabb.applyTransform(Fe,s.multiply([],Qe,he)),s.transformMat4(ke,ke,Qe);const Je=.5*(Fe.max[2]-Fe.min[2]),lt=this._minimumAABBFrustumDistance(H,Fe),at=s.scale$2([],[0,0,1],Je),xt=s.add(at,ke,at),en=lt+(H.pitch===0?0:s.distance(ke,xt)),At=H.globeCenterInViewSpace,Ut=s.sub([],ke,[At[0],At[1],At[2]]);s.normalize(Ut,Ut),s.scale$2(Ut,Ut,en);const St=s.add([],ke,Ut);s.transformMat4(St,St,et);const Kt=s.earthRadius/s.GLOBE_RADIUS,vt=s.length(St),zt=s.mercatorZfromAltitude(Math.max(vt*Kt-s.earthRadius,Number.EPSILON),0),nn=Math.min(H.zoomFromMercatorZAdjusted(zt),Q.maxZoom);return nn>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(H.setProjection({name:"mercator"}),H.zoom=nn,this._cameraForBounds(H,m,S,I,L,$)):{center:H.center,zoom:nn,bearing:I,pitch:L}}queryTerrainElevation(h,m){const S=this.transform.elevation;return S?(m=s.extend({},{exaggerated:!0},m),S.getAtPoint(s.MercatorCoordinate.fromLngLat(h),null,m.exaggerated)):null}_cameraForBounds(h,m,S,I,L,$){if(h.projection.name==="globe")return this._cameraForBoundsOnGlobe(h,m,S,I,L,$);const H=h.clone(),Q=this._extendCameraOptions($),ne=H.padding;H.bearing=I,H.pitch=L;const te=s.LngLat.convert(m),fe=s.LngLat.convert(S),ve=new s.LngLat(te.lng,fe.lat),Te=new s.LngLat(fe.lng,te.lat),Ie=H.project(te),Pe=H.project(fe),Re=this.queryTerrainElevation(te),he=this.queryTerrainElevation(fe),Se=this.queryTerrainElevation(ve),Fe=this.queryTerrainElevation(Te),ke=[[Ie.x,Ie.y,Math.min(Re||0,he||0,Se||0,Fe||0)],[Pe.x,Pe.y,Math.max(Re||0,he||0,Se||0,Fe||0)]];let Qe=s.Aabb.fromPoints(ke);const et=H.getWorldToCameraMatrix(),Je=s.invert(new Float64Array(16),et);Qe=s.Aabb.applyTransform(Qe,et);const lt=s.sub([],Qe.max,Qe.min),at=ne.left||0,xt=ne.right||0,en=ne.bottom||0,At=ne.top||0,{left:Ut,right:St,top:Kt,bottom:vt}=Q.padding,zt=.5*(at+xt),nn=.5*(At+en),Ht=Math.min(H.scaleZoom(H.scale*Math.min((H.width-(at+xt+Ut+St))/lt[0],(H.height-(en+At+vt+Kt))/lt[1])),Q.maxZoom),an=H.scale/H.zoomScale(Ht);Qe=new s.Aabb([Qe.min[0]-(Ut+zt)*an,Qe.min[1]-(vt+nn)*an,Qe.min[2]],[Qe.max[0]+(St+zt)*an,Qe.max[1]+(Kt+nn)*an,Qe.max[2]]);const Wn=.5*lt[2],hr=this._minimumAABBFrustumDistance(H,Qe),kn=[0,0,1,0];s.transformMat4$1(kn,kn,et),s.normalize$2(kn,kn);const er=s.scale$2([],kn,hr+Wn),Fr=s.add([],Qe.center,er),Nr=(typeof Q.offset.x=="number"&&typeof Q.offset.y=="number"?new s.Point(Q.offset.x,Q.offset.y):s.Point.convert(Q.offset)).rotate(-s.degToRad(I));Qe.center[0]-=Nr.x*an,Qe.center[1]+=Nr.y*an,s.transformMat4(Qe.center,Qe.center,Je),s.transformMat4(Fr,Fr,Je);const Vn=[Qe.center[0],Qe.center[1],Fr[2]*H.pixelsPerMeter];s.scale$2(Vn,Vn,1/H.worldSize);const fi=s.lngFromMercatorX(Vn[0]),bi=s.latFromMercatorY(Vn[1]),wi=Math.min(H._zoomFromMercatorZ(Vn[2]),Q.maxZoom),Ei=new s.LngLat(fi,bi);return H.mercatorFromTransition&&wi<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(H.setProjection({name:"globe"}),H.zoom=wi,this._cameraForBounds(H,m,S,I,L,$)):{center:Ei,zoom:wi,bearing:I,pitch:L}}fitBounds(h,m,S){const I=this.cameraForBounds(h,m);return this._fitInternal(I,m,S)}fitScreenCoordinates(h,m,S,I,L){const $=s.Point.convert(h),H=s.Point.convert(m),Q=new s.Point(Math.min($.x,H.x),Math.min($.y,H.y)),ne=new s.Point(Math.max($.x,H.x),Math.max($.y,H.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge($,H))return this;const te=this.transform.pointLocation3D(Q),fe=this.transform.pointLocation3D(ne),ve=this.transform.pointLocation3D(new s.Point(Q.x,ne.y)),Te=this.transform.pointLocation3D(new s.Point(ne.x,Q.y)),Ie=[Math.min(te.lng,fe.lng,ve.lng,Te.lng),Math.min(te.lat,fe.lat,ve.lat,Te.lat)],Pe=[Math.max(te.lng,fe.lng,ve.lng,Te.lng),Math.max(te.lat,fe.lat,ve.lat,Te.lat)],Re=I&&I.pitch?I.pitch:this.getPitch(),he=this._cameraForBounds(this.transform,Ie,Pe,S,Re,I);return this._fitInternal(he,I,L)}_fitInternal(h,m,S){return h?(delete(m=s.extend(h,m)).padding,m.linear?this.easeTo(m,S):this.flyTo(m,S)):this}jumpTo(h,m){this.stop();const S=h.preloadOnly?this.transform.clone():this.transform;let I=!1,L=!1,$=!1;return"zoom"in h&&S.zoom!==+h.zoom&&(I=!0,S.zoom=+h.zoom),h.center!==void 0&&(S.center=s.LngLat.convert(h.center)),"bearing"in h&&S.bearing!==+h.bearing&&(L=!0,S.bearing=+h.bearing),"pitch"in h&&S.pitch!==+h.pitch&&($=!0,S.pitch=+h.pitch),h.padding==null||S.isPaddingEqual(h.padding)||(S.padding=h.padding),h.preloadOnly?(this._preloadTiles(S),this):(this.fire(new s.Event("movestart",m)).fire(new s.Event("move",m)),I&&this.fire(new s.Event("zoomstart",m)).fire(new s.Event("zoom",m)).fire(new s.Event("zoomend",m)),L&&this.fire(new s.Event("rotatestart",m)).fire(new s.Event("rotate",m)).fire(new s.Event("rotateend",m)),$&&this.fire(new s.Event("pitchstart",m)).fire(new s.Event("pitch",m)).fire(new s.Event("pitchend",m)),this.fire(new s.Event("moveend",m)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(Bn),this.transform.getFreeCameraOptions()}setFreeCameraOptions(h,m){const S=this.transform;if(!S.projection.supportsFreeCamera)return s.warnOnce(Bn),this;this.stop();const I=S.zoom,L=S.pitch,$=S.bearing;S.setFreeCameraOptions(h);const H=I!==S.zoom,Q=L!==S.pitch,ne=$!==S.bearing;return this.fire(new s.Event("movestart",m)).fire(new s.Event("move",m)),H&&this.fire(new s.Event("zoomstart",m)).fire(new s.Event("zoom",m)).fire(new s.Event("zoomend",m)),ne&&this.fire(new s.Event("rotatestart",m)).fire(new s.Event("rotate",m)).fire(new s.Event("rotateend",m)),Q&&this.fire(new s.Event("pitchstart",m)).fire(new s.Event("pitch",m)).fire(new s.Event("pitchend",m)),this.fire(new s.Event("moveend",m)),this}easeTo(h,m){this._stop(!1,h.easeId),((h=s.extend({offset:[0,0],duration:500,easing:s.ease},h)).animate===!1||this._prefersReducedMotion(h))&&(h.duration=0);const S=this.transform,I=this.getZoom(),L=this.getBearing(),$=this.getPitch(),H=this.getPadding(),Q="zoom"in h?+h.zoom:I,ne="bearing"in h?this._normalizeBearing(h.bearing,L):L,te="pitch"in h?+h.pitch:$,fe="padding"in h?h.padding:S.padding,ve=s.Point.convert(h.offset);let Te,Ie,Pe;if(S.projection.name==="globe"){const at=s.MercatorCoordinate.fromLngLat(S.center),xt=ve.rotate(-S.angle);at.x+=xt.x/S.worldSize,at.y+=xt.y/S.worldSize;const en=at.toLngLat(),At=s.LngLat.convert(h.center||en);this._normalizeCenter(At),Te=S.centerPoint.add(xt),Ie=new s.Point(at.x,at.y).mult(S.worldSize),Pe=new s.Point(s.mercatorXfromLng(At.lng),s.mercatorYfromLat(At.lat)).mult(S.worldSize).sub(Ie)}else{Te=S.centerPoint.add(ve);const at=S.pointLocation(Te),xt=s.LngLat.convert(h.center||at);this._normalizeCenter(xt),Ie=S.project(at),Pe=S.project(xt).sub(Ie)}const Re=S.zoomScale(Q-I);let he,Se;h.around&&(he=s.LngLat.convert(h.around),Se=S.locationPoint(he));const Fe=this._zooming||Q!==I,ke=this._rotating||L!==ne,Qe=this._pitching||te!==$,et=!S.isPaddingEqual(fe),Je=at=>xt=>{if(Fe&&(at.zoom=s.number(I,Q,xt)),ke&&(at.bearing=s.number(L,ne,xt)),Qe&&(at.pitch=s.number($,te,xt)),et&&(at.interpolatePadding(H,fe,xt),Te=at.centerPoint.add(ve)),he)at.setLocationAtPoint(he,Se);else{const en=at.zoomScale(at.zoom-I),At=Q>I?Math.min(2,Re):Math.max(.5,Re),Ut=Math.pow(At,1-xt),St=at.unproject(Ie.add(Pe.mult(xt*Ut)).mult(en));at.setLocationAtPoint(at.renderWorldCopies?St.wrap():St,Te)}return h.preloadOnly||this._fireMoveEvents(m),at};if(h.preloadOnly){const at=this._emulate(Je,h.duration,S);return this._preloadTiles(at),this}const lt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Fe,this._rotating=ke,this._pitching=Qe,this._padding=et,this._easeId=h.easeId,this._prepareEase(m,h.noMoveStart,lt),this._ease(Je(S),at=>{S.recenterOnTerrain(),this._afterEase(m,at)},h),this}_prepareEase(h,m,S={}){this._moving=!0,this.transform.cameraElevationReference="sea",m||S.moving||this.fire(new s.Event("movestart",h)),this._zooming&&!S.zooming&&this.fire(new s.Event("zoomstart",h)),this._rotating&&!S.rotating&&this.fire(new s.Event("rotatestart",h)),this._pitching&&!S.pitching&&this.fire(new s.Event("pitchstart",h))}_fireMoveEvents(h){this.fire(new s.Event("move",h)),this._zooming&&this.fire(new s.Event("zoom",h)),this._rotating&&this.fire(new s.Event("rotate",h)),this._pitching&&this.fire(new s.Event("pitch",h))}_afterEase(h,m){if(this._easeId&&m&&this._easeId===m)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const S=this._zooming,I=this._rotating,L=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new s.Event("zoomend",h)),I&&this.fire(new s.Event("rotateend",h)),L&&this.fire(new s.Event("pitchend",h)),this.fire(new s.Event("moveend",h))}flyTo(h,m){if(this._prefersReducedMotion(h)){const Ht=s.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ht,m)}this.stop(),h=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},h);const S=this.transform,I=this.getZoom(),L=this.getBearing(),$=this.getPitch(),H=this.getPadding(),Q="zoom"in h?s.clamp(+h.zoom,S.minZoom,S.maxZoom):I,ne="bearing"in h?this._normalizeBearing(h.bearing,L):L,te="pitch"in h?+h.pitch:$,fe="padding"in h?h.padding:S.padding,ve=S.zoomScale(Q-I),Te=s.Point.convert(h.offset);let Ie=S.centerPoint.add(Te);const Pe=S.pointLocation(Ie),Re=s.LngLat.convert(h.center||Pe);this._normalizeCenter(Re);const he=S.project(Pe),Se=S.project(Re).sub(he);let Fe=h.curve;const ke=Math.max(S.width,S.height),Qe=ke/ve,et=Se.mag();if("minZoom"in h){const Ht=s.clamp(Math.min(h.minZoom,I,Q),S.minZoom,S.maxZoom),an=ke/S.zoomScale(Ht-I);Fe=Math.sqrt(an/et*2)}const Je=Fe*Fe;function lt(Ht){const an=(Qe*Qe-ke*ke+(Ht?-1:1)*Je*Je*et*et)/(2*(Ht?Qe:ke)*Je*et);return Math.log(Math.sqrt(an*an+1)-an)}function at(Ht){return(Math.exp(Ht)-Math.exp(-Ht))/2}function xt(Ht){return(Math.exp(Ht)+Math.exp(-Ht))/2}const en=lt(0);let At=function(Ht){return xt(en)/xt(en+Fe*Ht)},Ut=function(Ht){return ke*((xt(en)*(at(an=en+Fe*Ht)/xt(an))-at(en))/Je)/et;var an},St=(lt(1)-en)/Fe;if(Math.abs(et)<1e-6||!isFinite(St)){if(Math.abs(ke-Qe)<1e-6)return this.easeTo(h,m);const Ht=Qe<ke?-1:1;St=Math.abs(Math.log(Qe/ke))/Fe,Ut=function(){return 0},At=function(an){return Math.exp(Ht*Fe*an)}}h.duration="duration"in h?+h.duration:1e3*St/("screenSpeed"in h?+h.screenSpeed/Fe:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0);const Kt=L!==ne,vt=te!==$,zt=!S.isPaddingEqual(fe),nn=Ht=>an=>{const Wn=an*St,hr=1/At(Wn);Ht.zoom=an===1?Q:I+Ht.scaleZoom(hr),Kt&&(Ht.bearing=s.number(L,ne,an)),vt&&(Ht.pitch=s.number($,te,an)),zt&&(Ht.interpolatePadding(H,fe,an),Ie=Ht.centerPoint.add(Te));const kn=an===1?Re:Ht.unproject(he.add(Se.mult(Ut(Wn))).mult(hr));return Ht.setLocationAtPoint(Ht.renderWorldCopies?kn.wrap():kn,Ie),Ht._updateCameraOnTerrain(),h.preloadOnly||this._fireMoveEvents(m),Ht};if(h.preloadOnly){const Ht=this._emulate(nn,h.duration,S);return this._preloadTiles(Ht),this}return this._zooming=!0,this._rotating=Kt,this._pitching=vt,this._padding=zt,this._prepareEase(m,!1),this._ease(nn(S),()=>this._afterEase(m),h),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(h,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const S=this._onEaseEnd;this._onEaseEnd=void 0,S.call(this,m)}if(!h){const S=this.handlers;S&&S.stop(!1)}return this}_ease(h,m,S){S.animate===!1||S.duration===0?(h(1),m()):(this._easeStart=s.exported.now(),this._easeOptions=S,this._onEaseFrame=h,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const h=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),m=this._onEaseFrame;m&&m(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(h,m){h=s.wrap(h,-180,180);const S=Math.abs(h-m);return Math.abs(h-360-m)<S&&(h-=360),Math.abs(h+360-m)<S&&(h+=360),h}_normalizeCenter(h){const m=this.transform;if(!m.renderWorldCopies||m.maxBounds)return;const S=h.lng-m.center.lng;h.lng+=S>180?-360:S<-180?360:0}_prefersReducedMotion(h){return this._respectPrefersReducedMotion&&s.exported.prefersReducedMotion&&!(h&&h.essential)}_emulate(h,m,S){const I=Math.ceil(15*m/1e3),L=[],$=h(S.clone());for(let H=0;H<=I;H++){const Q=$(H/I);L.push(Q.clone())}return L}}class Mt{constructor(h={}){this.options=h,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(h){const m=this.options&&this.options.compact;return this._map=h,this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=E("button","mapboxgl-ctrl-attrib-button",this._container),E("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=E("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),m&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),m===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(h,m){const S=this._map._getUIString(`AttributionControl.${m}`);h.setAttribute("aria-label",S),h.removeAttribute("title"),h.firstElementChild&&h.firstElementChild.setAttribute("title",S)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let h=this._editLink;h||(h=this._editLink=this._container.querySelector(".mapbox-improve-map"));const m=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(h){const S=m.reduce((I,L,$)=>(L.value&&(I+=`${L.key}=${L.value}${$<m.length-1?"&":""}`),I),"?");h.href=`${s.config.FEEDBACK_URL}/${S}#${Ep(this._map,!0)}`,h.rel="noopener nofollow",this._setElementTitle(h,"MapFeedback")}}_updateData(h){!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let h=[];if(this._map.style.stylesheet){const I=this._map.style.stylesheet;this.styleOwner=I.owner,this.styleId=I.id}const m=this._map.style._sourceCaches;for(const I in m){const L=m[I];if(L.used){const $=L.getSource();$.attribution&&h.indexOf($.attribution)<0&&h.push($.attribution)}}h.sort((I,L)=>I.length-L.length),h=h.filter((I,L)=>{for(let $=L+1;$<h.length;$++)if(h[$].indexOf(I)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=[...this.options.customAttribution,...h]:h.unshift(this.options.customAttribution));const S=h.join(" | ");S!==this._attribHTML&&(this._attribHTML=S,h.length?(this._innerContainer.innerHTML=S,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class br{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(h){this._map=h,this._container=E("div","mapboxgl-ctrl");const m=E("a","mapboxgl-ctrl-logo");return m.target="_blank",m.rel="noopener nofollow",m.href="https://www.mapbox.com/",m.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),m.setAttribute("rel","noopener nofollow"),this._container.appendChild(m),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(h){h&&h.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const h=this._map.style._sourceCaches;if(Object.entries(h).length===0)return!0;for(const m in h){const S=h[m].getSource();if(S.hasOwnProperty("mapbox_logo")&&!S.mapbox_logo)return!1}return!0}_updateCompact(){const h=this._container.children;if(h.length){const m=h[0];this._map.getCanvasContainer().offsetWidth<250?m.classList.add("mapboxgl-compact"):m.classList.remove("mapboxgl-compact")}}}class ui{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(h){const m=++this._id;return this._queue.push({callback:h,id:m,cancelled:!1}),m}remove(h){const m=this._currentlyRunning,S=m?this._queue.concat(m):this._queue;for(const I of S)if(I.id===h)return void(I.cancelled=!0)}run(h=0){const m=this._currentlyRunning=this._queue;this._queue=[];for(const S of m)if(!S.cancelled&&(S.callback(h),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Vr(v,h,m){if(v=new s.LngLat(v.lng,v.lat),h){const S=new s.LngLat(v.lng-360,v.lat),I=new s.LngLat(v.lng+360,v.lat),L=360*Math.ceil(Math.abs(v.lng-m.center.lng)/360),$=m.locationPoint(v).distSqr(h),H=h.x<0||h.y<0||h.x>m.width||h.y>m.height;m.locationPoint(S).distSqr(h)<$&&(H||Math.abs(S.lng-m.center.lng)<L)?v=S:m.locationPoint(I).distSqr(h)<$&&(H||Math.abs(I.lng-m.center.lng)<L)&&(v=I)}for(;Math.abs(v.lng-m.center.lng)>180;){const S=m.locationPoint(v);if(S.x>=0&&S.y>=0&&S.x<=m.width&&S.y<=m.height)break;v.lng>m.center.lng?v.lng-=360:v.lng+=360}return v}const Jr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class qt extends s.Evented{constructor(h,m){if(super(),(h instanceof s.window.HTMLElement||m)&&(h=s.extend({element:h},m)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=h&&h.occludedOpacity||.2,h&&h.element)this._element=h.element,this._offset=s.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=E("div");const I=41,L=27,$=P("svg",{display:"block",height:I*this._scale+"px",width:L*this._scale+"px",viewBox:`0 0 ${L} ${I}`},this._element),H=P("radialGradient",{id:"shadowGradient"},P("defs",{},$));P("stop",{offset:"10%","stop-opacity":.4},H),P("stop",{offset:"100%","stop-opacity":.05},H),P("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},$),P("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},$),P("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},$),P("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},$),this._offset=s.Point.convert(h&&h.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",I=>{I.preventDefault()}),this._element.addEventListener("mousedown",I=>{I.preventDefault()});const S=this._element.classList;for(const I in Jr)S.remove(`mapboxgl-marker-anchor-${I}`);S.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(h){return h===this._map||(this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._updateMoving),h.on("moveend",this._update),h.on("remove",this._clearFadeTimer),h._addMarker(this),this.setDraggable(this._draggable),this._update(),h.on("click",this._onMapClick)),this}remove(){const h=this._map;return h&&(h.off("click",this._onMapClick),h.off("move",this._updateMoving),h.off("moveend",this._update),h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler),h.off("mouseup",this._onUp),h.off("touchend",this._onUp),h.off("mousemove",this._onMove),h.off("touchmove",this._onMove),h.off("remove",this._clearFadeTimer),h._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=s.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){const I=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[I,-1*(38.1-13.5+I)],"bottom-right":[-I,-1*(38.1-13.5+I)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=h,h._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(h){const m=h.code,S=h.charCode||h.keyCode;m!=="Space"&&m!=="Enter"&&S!==32&&S!==13||this.togglePopup()}_onMapClick(h){const m=h.originalEvent.target,S=this._element;this._popup&&(m===S||S.contains(m))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const h=this._popup;return h?(h.isOpen()?(h.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(h.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const h=this._map,m=this._pos;if(!h||!m)return!1;const S=h.unproject(m),I=h.getFreeCameraOptions();if(!I.position)return!1;const L=I.position.toLngLat();return L.distanceTo(S)<.9*L.distanceTo(this._lngLat)}_evaluateOpacity(){const h=this._map;if(!h)return;const m=this._pos;if(!m||m.x<0||m.x>h.transform.width||m.y<0||m.y>h.transform.height)return void this._clearFadeTimer();const S=h.unproject(m);let I;h._showingGlobe()&&s.isLngLatBehindGlobe(h.transform,this._lngLat)?I=0:(I=1-h._queryFogOpacity(S),h.transform._terrainEnabled()&&h.getTerrain()&&this._behindTerrain()&&(I*=this._occludedOpacity)),this._element.style.opacity=`${I}`,this._element.style.pointerEvents=I>0?"auto":"none",this._popup&&this._popup._setOpacity(I),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const h=this._pos;if(!h||!this._map)return;const m=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${h.x}px,${h.y}px)
            ${Jr[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${m.x}px,${m.y}px)
        `}_calculateXYTransform(){const h=this._pos,m=this._map,S=this.getPitchAlignment();if(!m||!h||S!=="map")return"";if(!m._showingGlobe()){const Q=m.getPitch();return Q?`rotateX(${Q}deg)`:""}const I=s.radToDeg(s.globeTiltAtLngLat(m.transform,this._lngLat)),L=h.sub(s.globeCenterToScreenPoint(m.transform)),$=Math.abs(L.x)+Math.abs(L.y);if($===0)return"";const H=I/$;return`rotateX(${-L.y*H}deg) rotateY(${L.x*H}deg)`}_calculateZTransform(){const h=this._pos,m=this._map;if(!m||!h)return"";let S=0;const I=this.getRotationAlignment();if(I==="map")if(m._showingGlobe()){const L=m.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),$=m.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(L);S=s.radToDeg(Math.atan2($.y,$.x))-90}else S=-m.getBearing();else if(I==="horizon"){const L=s.smoothstep(4,6,m.getZoom()),$=s.globeCenterToScreenPoint(m.transform);$.y+=L*m.transform.height;const H=h.sub($),Q=s.radToDeg(Math.atan2(H.y,H.x));S=(Q>90?Q-270:Q+90)*(1-L)}return S+=this._rotation,S?`rotateZ(${S}deg)`:""}_update(h){s.window.cancelAnimationFrame(this._updateFrameId);const m=this._map;m&&(m.transform.renderWorldCopies&&(this._lngLat=Vr(this._lngLat,this._pos,m.transform)),this._pos=m.project(this._lngLat),h===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),m._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(m._showingGlobe()||m.getTerrain()||m.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(h){return this._offset=s.Point.convert(h),this._update(),this}_onMove(h){const m=this._map;if(!m)return;const S=this._pointerdownPos,I=this._positionDelta;if(S&&I){if(!this._isDragging){const L=this._clickTolerance||m._clickTolerance;if(h.point.dist(S)<L)return;this._isDragging=!0}this._pos=h.point.sub(I),this._lngLat=m.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const h=this._map;h&&(h.off("mousemove",this._onMove),h.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(h){const m=this._map,S=this._pos;m&&S&&this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(S),this._pointerdownPos=h.point,this._state="pending",m.on("mousemove",this._onMove),m.on("touchmove",this._onMove),m.once("mouseup",this._onUp),m.once("touchend",this._onUp))}setDraggable(h){this._draggable=!!h;const m=this._map;return m&&(h?(m.on("mousedown",this._addDragHandler),m.on("touchstart",this._addDragHandler)):(m.off("mousedown",this._addDragHandler),m.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(h){return this._rotation=h||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(h){return this._rotationAlignment=h||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(h){return this._pitchAlignment=h||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(h){return this._occludedOpacity=h||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const xi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},$i=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gr(v=new s.Point(0,0),h="bottom"){if(typeof v=="number"){const m=Math.round(Math.sqrt(.5*Math.pow(v,2)));switch(h){case"top":return new s.Point(0,v);case"top-left":return new s.Point(m,m);case"top-right":return new s.Point(-m,m);case"bottom":return new s.Point(0,-v);case"bottom-left":return new s.Point(m,-m);case"bottom-right":return new s.Point(-m,-m);case"left":return new s.Point(v,0);case"right":return new s.Point(-v,0)}return new s.Point(0,0)}return v instanceof s.Point||Array.isArray(v)?s.Point.convert(v):s.Point.convert(v[h]||[0,0])}class cx{constructor(h){this.jumpTo(h)}getValue(h){if(h<=this._startTime)return this._start;if(h>=this._endTime)return this._end;const m=s.easeCubicInOut((h-this._startTime)/(this._endTime-this._startTime));return this._start*(1-m)+this._end*m}isEasing(h){return h>=this._startTime&&h<=this._endTime}jumpTo(h){this._startTime=-1/0,this._endTime=-1/0,this._start=h,this._end=h}easeTo(h,m,S){this._start=this.getValue(m),this._end=h,this._startTime=m,this._endTime=m+S}}const _2={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},y2={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},jL={showCompass:!0,showZoom:!0,visualizePitch:!1};class VL{constructor(h,m,S=!1){this._clickTolerance=10,this.element=m,this.mouseRotate=new Jh({clickTolerance:h.dragRotate._mouseRotate._clickTolerance}),this.map=h,S&&(this.mousePitch=new ed({clickTolerance:h.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),m.addEventListener("mousedown",this.mousedown),m.addEventListener("touchstart",this.touchstart,{passive:!1}),m.addEventListener("touchmove",this.touchmove),m.addEventListener("touchend",this.touchend),m.addEventListener("touchcancel",this.reset)}down(h,m){this.mouseRotate.mousedown(h,m),this.mousePitch&&this.mousePitch.mousedown(h,m),z()}move(h,m){const S=this.map,I=this.mouseRotate.mousemoveWindow(h,m),L=I&&I.bearingDelta;if(L&&S.setBearing(S.getBearing()+L),this.mousePitch){const $=this.mousePitch.mousemoveWindow(h,m),H=$&&$.pitchDelta;H&&S.setPitch(S.getPitch()+H)}}off(){const h=this.element;h.removeEventListener("mousedown",this.mousedown),h.removeEventListener("touchstart",this.touchstart,{passive:!1}),h.removeEventListener("touchmove",this.touchmove),h.removeEventListener("touchend",this.touchend),h.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){F(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(h){this.down(s.extend({},h,{ctrlKey:!0,preventDefault:()=>h.preventDefault()}),Y(this.element,h)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(h){this.move(h,Y(this.element,h))}mouseup(h){this.mouseRotate.mouseupWindow(h),this.mousePitch&&this.mousePitch.mouseupWindow(h),this.offTemp()}touchstart(h){h.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=J(this.element,h.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>h.preventDefault()},this._startPos))}touchmove(h){h.targetTouches.length!==1?this.reset():(this._lastPos=J(this.element,h.targetTouches)[0],this.move({preventDefault:()=>h.preventDefault()},this._lastPos))}touchend(h){h.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const fx={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},hx={maxWidth:100,unit:"metric"},dx={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Zg={version:s.version,supported:d,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Pn{constructor(v){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(v=s.extend({},y2,v)).minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(v.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(v.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Zi(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies),v),this._interactive=v.interactive,this._minTileCacheSize=v.minTileCacheSize,this._maxTileCacheSize=v.maxTileCacheSize,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._useWebGL2=v.useWebGL2,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=v.crossSourceCollisions,this._collectResourceTiming=v.collectResourceTiming,this._optimizeForTerrain=v.optimizeForTerrain,this._language=this._parseLanguage(v.language),this._worldview=v.worldview,this._renderTaskQueue=new ui,this._domRenderTaskQueue=new ui,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},_2,v.locale),this._clickTolerance=v.clickTolerance,this._cooperativeGestures=v.cooperativeGestures,this._performanceMetricsCollection=v.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new cx(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(v.transformRequest,v.accessToken,v.testMode),this._silenceAuthErrors=!!v.testMode,typeof v.container=="string"){if(this._container=s.window.document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),v.maxBounds&&this.setMaxBounds(v.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new On(this,v),this._localFontFamily=v.localFontFamily,this._localIdeographFontFamily=v.localIdeographFontFamily,v.style&&this.setStyle(v.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),v.projection&&this.setProjection(v.projection),this._hash=v.hash&&new jA(typeof v.hash=="string"&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,s.extend({},v.fitBoundsOptions,{duration:0})))),this.resize(),v.attributionControl&&this.addControl(new Mt({customAttribution:v.customAttribution})),this._logoControl=new br,this.addControl(this._logoControl,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new s.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new s.Event(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(v,h){if(h===void 0&&(h=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const m=v.onAdd(this);this._controls.push(v);const S=this._controlPositions[h];return h.indexOf("bottom")!==-1?S.insertBefore(m,S.firstChild):S.appendChild(m),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const h=this._controls.indexOf(v);return h>-1&&this._controls.splice(h,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(v){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const h=!this._moving;return h&&this.fire(new s.Event("movestart",v)).fire(new s.Event("move",v)),this.fire(new s.Event("resize",v)),h&&this.fire(new s.Event("moveend",v)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(v){return this.transform.setMaxBounds(s.LngLatBounds.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v?this.setZoom(v):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v?this.setZoom(v):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v?this.setPitch(v):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v?this.setPitch(v):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(v){return v==="auto"?s.window.navigator.language:Array.isArray(v)?v.length===0?void 0:v.map(h=>h==="auto"?s.window.navigator.language:h):v}setLanguage(v){const h=this._parseLanguage(v);if(!this.style||h===this._language)return this;this._language=h,this.style._reloadSources();for(const m of this._controls)m._setLanguage&&m._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(v){return this.style&&v!==this._worldview?(this._worldview=v,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(v){return this._lazyInitEmptyStyle(),v?typeof v=="string"&&(v={name:v}):v=null,this._useExplicitProjection=!!v,this._prioritizeAndUpdateProjection(v,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const v=this.transform,h=v.projection.name;let m;h==="globe"&&v.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(v.setMercatorFromTransition(),m=!0):h==="mercator"&&v.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(v.setProjection({name:"globe"}),m=!0),m&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(v,h){return this._updateProjection(v||h||{name:"mercator"})}_updateProjection(v){let h;if(h=v.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(v),this.style.applyProjectionUpdate(),h){this.painter.clearBackgroundTiles();for(const m in this.style._sourceCaches)this.style._sourceCaches[m].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(v){return this.transform.locationPoint3D(s.LngLat.convert(v))}unproject(v){return this.transform.pointLocation3D(s.Point.convert(v))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(v,h,m){if(v==="mouseenter"||v==="mouseover"){let S=!1;const I=$=>{const H=h.filter(ne=>this.getLayer(ne)),Q=H.length?this.queryRenderedFeatures($.point,{layers:H}):[];Q.length?S||(S=!0,m.call(this,new hs(v,this,$.originalEvent,{features:Q}))):S=!1},L=()=>{S=!1};return{layers:new Set(h),listener:m,delegates:{mousemove:I,mouseout:L}}}if(v==="mouseleave"||v==="mouseout"){let S=!1;const I=$=>{const H=h.filter(Q=>this.getLayer(Q));(H.length?this.queryRenderedFeatures($.point,{layers:H}):[]).length?S=!0:S&&(S=!1,m.call(this,new hs(v,this,$.originalEvent)))},L=$=>{S&&(S=!1,m.call(this,new hs(v,this,$.originalEvent)))};return{layers:new Set(h),listener:m,delegates:{mousemove:I,mouseout:L}}}{const S=I=>{const L=h.filter(H=>this.getLayer(H)),$=L.length?this.queryRenderedFeatures(I.point,{layers:L}):[];$.length&&(I.features=$,m.call(this,I),delete I.features)};return{layers:new Set(h),listener:m,delegates:{[v]:S}}}}on(v,h,m){if(m===void 0)return super.on(v,h);Array.isArray(h)||(h=[h]);const S=this._createDelegatedListener(v,h,m);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(S);for(const I in S.delegates)this.on(I,S.delegates[I]);return this}once(v,h,m){if(m===void 0)return super.once(v,h);Array.isArray(h)||(h=[h]);const S=this._createDelegatedListener(v,h,m);for(const I in S.delegates)this.once(I,S.delegates[I]);return this}off(v,h,m){if(m===void 0)return super.off(v,h);h=new Set(Array.isArray(h)?h:[h]);const S=(L,$)=>{if(L.size!==$.size)return!1;for(const H of L)if(!$.has(H))return!1;return!0},I=this._delegatedListeners?this._delegatedListeners[v]:void 0;return I&&(L=>{for(let $=0;$<L.length;$++){const H=L[$];if(H.listener===m&&S(H.layers,h)){for(const Q in H.delegates)this.off(Q,H.delegates[Q]);return L.splice($,1),this}}})(I),this}queryRenderedFeatures(v,h){return this.style?(h!==void 0||v===void 0||v instanceof s.Point||Array.isArray(v)||(h=v,v=void 0),this.style.queryRenderedFeatures(v=v||[[0,0],[this.transform.width,this.transform.height]],h=h||{},this.transform)):[]}querySourceFeatures(v,h){return this.style.querySourceFeatures(v,h)}isPointOnSurface(v){const{name:h}=this.transform.projection;return h!=="globe"&&h!=="mercator"&&s.warnOnce(`${h} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.Point.convert(v))}setStyle(v,h){return(h=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},h)).diff!==!1&&h.localIdeographFontFamily===this._localIdeographFontFamily&&h.localFontFamily===this._localFontFamily&&this.style&&v?(this._diffStyle(v,h),this):(this._localIdeographFontFamily=h.localIdeographFontFamily,this._localFontFamily=h.localFontFamily,this._updateStyle(v,h))}_getUIString(v){const h=this._locale[v];if(h==null)throw new Error(`Missing UI string '${v}'`);return h}_updateStyle(v,h){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),v&&(this.style=new Ds(this,h||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v):this.style.loadJSON(v)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ds(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,h){if(typeof v=="string"){const m=this._requestManager.normalizeStyleURL(v),S=this._requestManager.transformRequest(m,s.ResourceType.Style);s.getJSON(S,(I,L)=>{I?this.fire(new s.ErrorEvent(I)):L&&this._updateDiff(L,h)})}else typeof v=="object"&&this._updateDiff(v,h)}_updateDiff(v,h){try{this.style.setState(v)&&this._update(!0)}catch(m){s.warnOnce(`Unable to perform style diff: ${m.message||m.error||m}.  Rebuilding the style from scratch.`),this._updateStyle(v,h)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(v,h){return this._lazyInitEmptyStyle(),this.style.addSource(v,h),this._update(!0)}isSourceLoaded(v){return!!this.style&&this.style._isSourceCacheLoaded(v)}areTilesLoaded(){const v=this.style&&this.style._sourceCaches;for(const h in v){const m=v[h]._tiles;for(const S in m){const I=m[S];if(I.state!=="loaded"&&I.state!=="errored")return!1}}return!0}addSourceType(v,h,m){this._lazyInitEmptyStyle(),this.style.addSourceType(v,h,m)}removeSource(v){return this.style.removeSource(v),this._updateTerrain(),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,h,{pixelRatio:m=1,sdf:S=!1,stretchX:I,stretchY:L,content:$}={}){if(this._lazyInitEmptyStyle(),h instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&h instanceof s.window.ImageBitmap){const{width:H,height:Q,data:ne}=s.exported.getImageData(h);this.style.addImage(v,{data:new s.RGBAImage({width:H,height:Q},ne),pixelRatio:m,stretchX:I,stretchY:L,content:$,sdf:S,version:0})}else if(h.width===void 0||h.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:H,height:Q}=h,ne=h;this.style.addImage(v,{data:new s.RGBAImage({width:H,height:Q},new Uint8Array(ne.data)),pixelRatio:m,stretchX:I,stretchY:L,content:$,sdf:S,version:0,userImage:ne}),ne.onAdd&&ne.onAdd(this,v)}}updateImage(v,h){const m=this.style.getImage(v);if(!m)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const S=h instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&h instanceof s.window.ImageBitmap?s.exported.getImageData(h):h,{width:I,height:L}=S;I!==void 0&&L!==void 0?I===m.data.width&&L===m.data.height?(m.data.replace(S.data,!(h instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&h instanceof s.window.ImageBitmap)),this.style.updateImage(v,m)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${I}, ${L})
                must be that same as the previous version of the image
                (${m.data.width}, ${m.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v,h){s.getImage(this._requestManager.transformRequest(v,s.ResourceType.Image),(m,S)=>{h(m,S instanceof s.window.HTMLImageElement?s.exported.getImageData(S):S)})}listImages(){return this.style.listImages()}addLayer(v,h){return this._lazyInitEmptyStyle(),this.style.addLayer(v,h),this._update(!0)}moveLayer(v,h){return this.style.moveLayer(v,h),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}setLayerZoomRange(v,h,m){return this.style.setLayerZoomRange(v,h,m),this._update(!0)}setFilter(v,h,m={}){return this.style.setFilter(v,h,m),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,h,m,S={}){return this.style.setPaintProperty(v,h,m,S),this._update(!0)}getPaintProperty(v,h){return this.style.getPaintProperty(v,h)}setLayoutProperty(v,h,m,S={}){return this.style.setLayoutProperty(v,h,m,S),this._update(!0)}getLayoutProperty(v,h){return this.style.getLayoutProperty(v,h)}setLight(v,h={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,h),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(v){return this._lazyInitEmptyStyle(),!v&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(v),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(v){return this._lazyInitEmptyStyle(),this.style.setFog(v),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(v){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(v),this.transform):0}setFeatureState(v,h){return this.style.setFeatureState(v,h),this._update()}removeFeatureState(v,h){return this.style.removeFeatureState(v,h),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}_updateContainerDimensions(){if(!this._container)return;const v=this._container.getBoundingClientRect().width||400,h=this._container.getBoundingClientRect().height||300;let m,S,I,L=this._container;for(;L&&(!S||!I);){const $=s.window.getComputedStyle(L).transform;$&&$!=="none"&&(m=$.match(/matrix.*\((.+)\)/)[1].split(", "),m[0]&&m[0]!=="0"&&m[0]!=="1"&&(S=m[0]),m[3]&&m[3]!=="0"&&m[3]!=="1"&&(I=m[3])),L=L.parentElement}this._containerWidth=S?Math.abs(v/S):v,this._containerHeight=I?Math.abs(h/I):h}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const v=this._container;v.classList.add("mapboxgl-map"),(this._missingCSSCanary=E("div","mapboxgl-canary",v)).style.visibility="hidden",this._detectMissingCSS();const h=this._canvasContainer=E("div","mapboxgl-canvas-container",v);this._interactive&&h.classList.add("mapboxgl-interactive"),this._canvas=E("canvas","mapboxgl-canvas",h),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const m=this._controlContainer=E("div","mapboxgl-control-container",v),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{S[I]=E("div",`mapboxgl-ctrl-${I}`,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,h){const m=s.exported.devicePixelRatio||1;this._canvas.width=m*Math.ceil(v),this._canvas.height=m*Math.ceil(h),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${h}px`}_addMarker(v){this._markers.push(v)}_removeMarker(v){const h=this._markers.indexOf(v);h!==-1&&this._markers.splice(h,1)}_addPopup(v){this._popups.push(v)}_removePopup(v){const h=this._popups.indexOf(v);h!==-1&&this._popups.splice(h,1)}_setupPainter(){const v=s.extend({},d.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),h=this._useWebGL2&&this._canvas.getContext("webgl2",v),m=h||this._canvas.getContext("webgl",v)||this._canvas.getContext("experimental-webgl",v);m?(this._useWebGL2&&!h&&s.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),s.storeAuthState(m,!0),this.painter=new jc(m,this.transform,!!h),this.on("data",S=>{S.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(m)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(v){v.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:v}))}_contextRestored(v){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:v}))}_onMapScroll(v){if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_requestDomTask(v){!this.loaded()||this.loaded()&&!this.isMoving()?v():this._domRenderTaskQueue.add(v)}_render(v){let h;const m=this.painter.context.extTimerQuery,S=s.exported.now();if(this.listens("gpu-timing-frame")&&(h=m.createQueryEXT(),m.beginQueryEXT(m.TIME_ELAPSED_EXT,h)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(v),this._domRenderTaskQueue.run(v),this._removed)return;this._updateProjectionTransition();const I=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const H=this.transform.zoom,Q=this.transform.pitch,ne=s.exported.now(),te=new s.EvaluationParameters(H,{now:ne,fadeDuration:I,pitch:Q,transition:this.style.getTransition()});this.style.update(te)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let L=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),L=this._updateAverageElevation(S),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):L=this._updateAverageElevation(S),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,I,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:I,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),h){const H=s.exported.now()-S;m.endQueryEXT(m.TIME_ELAPSED_EXT,h),setTimeout(()=>{const Q=m.getQueryObjectEXT(h,m.QUERY_RESULT_EXT)/1e6;m.deleteQueryEXT(h),this.fire(new s.Event("gpu-timing-frame",{cpuTime:H,gpuTime:Q})),s.window.performance.mark("frame-gpu",{startTime:S,detail:{gpuTime:Q}})},50)}if(this.listens("gpu-timing-layer")){const H=this.painter.collectGpuTimers();setTimeout(()=>{const Q=this.painter.queryGpuTimers(H);this.fire(new s.Event("gpu-timing-layer",{layerTimes:Q}))},50)}if(this.listens("gpu-timing-deferred-render")){const H=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const Q=this.painter.queryGpuTimeDeferredRender(H);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:Q}))},50)}const $=this._sourcesDirty||this._styleDirty||this._placementDirty||L;if($||this._repaint)this.triggerRepaint();else{const H=!this.isMoving()&&this.loaded();if(H&&(L=this._updateAverageElevation(S,!0)),L)this.triggerRepaint();else if(this._triggerFrame(!1),H&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Q=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:Q})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||$||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(v){for(const h of this._markers)v&&!this.getRenderWorldCopies()&&(h._lngLat=h._lngLat.wrap()),h._update();for(const h of this._popups)!v||this.getRenderWorldCopies()||h._trackPointer||(h._lngLat=h._lngLat.wrap()),h._update()}_updateAverageElevation(v,h=!1){const m=S=>(this.transform.averageElevation=S,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&m(0);if((h||v-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(v)){const S=this.transform.averageElevation;let I=this.transform.sampleAverageElevation(),L=!1;this.transform.elevation&&(L=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(I)?I=0:this._averageElevationLastSampledAt=v;const $=Math.abs(S-I);if($>1){if(this._isInitialLoad||L)return this._averageElevation.jumpTo(I),m(I);this._averageElevation.easeTo(I,v,300)}else if($>1e-4)return this._averageElevation.jumpTo(I),m(I)}return!!this._averageElevation.isEasing(v)&&m(this._averageElevation.getValue(v))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,v=>{if(v&&(v.message===s.AUTH_ERR_MSG||v.status===401)){const h=this.painter.context.gl;s.storeAuthState(h,!1),this._logoControl instanceof br&&this._logoControl._updateLogo(),h&&h.clear(h.DEPTH_BUFFER_BIT|h.COLOR_BUFFER_BIT|h.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const v=this._isDragging();this.painter.updateTerrain(this.style,v)}_calculateSpeedIndex(){const v=this.painter.canvasCopy(),h=this.painter.getCanvasCopiesAndTimestamps();h.timeStamps.push(performance.now());const m=this.painter.context.gl,S=m.createFramebuffer();function I(L){m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,L,0);const $=new Uint8Array(m.drawingBufferWidth*m.drawingBufferHeight*4);return m.readPixels(0,0,m.drawingBufferWidth,m.drawingBufferHeight,m.RGBA,m.UNSIGNED_BYTE,$),$}return m.bindFramebuffer(m.FRAMEBUFFER,S),this._canvasPixelComparison(I(v),h.canvasCopies.map(I),h.timeStamps)}_canvasPixelComparison(v,h,m){let S=m[1]-m[0];const I=v.length/4;for(let L=0;L<h.length;L++){const $=h[L];let H=0;for(let Q=0;Q<$.length;Q+=4)$[Q]===v[Q]&&$[Q+1]===v[Q+1]&&$[Q+2]===v[Q+2]&&$[Q+3]===v[Q+3]&&(H+=1);S+=(m[L+2]-m[L+1])*(1-H/I)}return S}remove(){this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const v=this.painter.context.gl.getExtension("WEBGL_lose_context");v&&v.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(v){this._renderNextFrame=this._renderNextFrame||v,this.style&&!this._frame&&(this._frame=s.exported.frame(h=>{const m=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,m&&this._render(h)}))}_preloadTiles(v){const h=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(h,(m,S)=>m._preloadTiles(v,S),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(v){this._trackResize&&this.resize({originalEvent:v})._update()}_onVisibilityChange(){s.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(v){this._showTerrainWireframe!==v&&(this._showTerrainWireframe=v,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(v){this._speedIndexTiming!==v&&(this._speedIndexTiming=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(v){this._showTileAABBs!==v&&(this._showTileAABBs=v,v&&this._update())}_setCacheLimits(v,h){s.setCacheLimits(v,h)}get version(){return s.version}},NavigationControl:class{constructor(v){this.options=s.extend({},jL,v),this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",h=>h.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",h=>{this._map&&this._map.zoomIn({},{originalEvent:h})}),E("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",h=>{this._map&&this._map.zoomOut({},{originalEvent:h})}),E("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",h=>{const m=this._map;m&&(this.options.visualizePitch?m.resetNorthPitch({},{originalEvent:h}):m.resetNorth({},{originalEvent:h}))}),this._compassIcon=E("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const v=this._map;if(!v)return;const h=v.getZoom(),m=h===v.getMaxZoom(),S=h===v.getMinZoom();this._zoomInButton.disabled=m,this._zoomOutButton.disabled=S,this._zoomInButton.setAttribute("aria-disabled",m.toString()),this._zoomOutButton.setAttribute("aria-disabled",S.toString())}_rotateCompassArrow(){const v=this._map;if(!v)return;const h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(v.transform.pitch*(Math.PI/180)),.5)}) rotateX(${v.transform.pitch}deg) rotateZ(${v.transform.angle*(180/Math.PI)}deg)`:`rotate(${v.transform.angle*(180/Math.PI)}deg)`;v._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=h)})}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),v.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&v.on("pitch",this._rotateCompassArrow),v.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new VL(v,this._compass,this.options.visualizePitch)),this._container}onRemove(){const v=this._map;v&&(this._container.remove(),this.options.showZoom&&v.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&v.off("pitch",this._rotateCompassArrow),v.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(v,h){const m=E("button",v,this._container);return m.type="button",m.addEventListener("click",h),m}_setButtonTitle(v,h){if(!this._map)return;const m=this._map._getUIString(`NavigationControl.${h}`);v.setAttribute("aria-label",m),v.firstElementChild&&v.firstElementChild.setAttribute("title",m)}},GeolocateControl:class extends s.Evented{constructor(v){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},fx,v),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Qh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(v){return this._map=v,this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(v){const h=(m=!!this.options.geolocation)=>{this._supportsGeolocation=m,v(m)};this._supportsGeolocation!==void 0?v(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(m=>h(m.state!=="denied")).catch(()=>h()):h()}_isOutOfMapMaxBounds(v){const h=this._map.getMaxBounds(),m=v.coords;return!!h&&(m.longitude<h.getWest()||m.longitude>h.getEast()||m.latitude<h.getSouth()||m.latitude>h.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(v){if(this._map){if(this._isOutOfMapMaxBounds(v))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",v)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=v,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(v),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(v),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",v)),this._finish()}}_updateCamera(v){const h=new s.LngLat(v.coords.longitude,v.coords.latitude),m=v.coords.accuracy,S=this._map.getBearing(),I=s.extend({bearing:S},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(m),I,{geolocateSource:!0})}_updateMarker(v){if(v){const h=new s.LngLat(v.coords.longitude,v.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=v.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const v=this._map.transform,h=s.mercatorZfromAltitude(1,v._center.lat)*v.worldSize,m=Math.ceil(2*this._accuracy*h);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(v){if(this._map){if(this.options.trackUserLocation)if(v.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",h),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(v.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",v)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(v){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=E("button","mapboxgl-ctrl-geolocate",this._container),E("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",v===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",h),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",h),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=E("div","mapboxgl-user-location"),this._dotElement.appendChild(E("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(E("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new qt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=E("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new qt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}}_onDeviceOrientation(v){this._userLocationDotMarker&&(v.webkitCompassHeading?this._heading=v.webkitCompassHeading:v.absolute===!0&&(this._heading=-1*v.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(v={maximumAge:6e5,timeout:0},this._noTimeout=!0):(v=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,v),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const v=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(h=>{h==="granted"&&v()}).catch(console.error):v()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Mt,ScaleControl:class{constructor(v){this.options=s.extend({},hx,v),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const v=this.options.maxWidth||100,h=this._map,m=h._containerHeight/2,S=h._containerWidth/2-v/2,I=h.unproject([S,m]),L=h.unproject([S+v,m]),$=I.distanceTo(L);if(this.options.unit==="imperial"){const H=3.2808*$;H>5280?this._setScale(v,H/5280,"mile"):this._setScale(v,H,"foot")}else this.options.unit==="nautical"?this._setScale(v,$/1852,"nautical-mile"):$>=1e3?this._setScale(v,$/1e3,"kilometer"):this._setScale(v,$,"meter")}_setScale(v,h,m){this._map._requestDomTask(()=>{const S=function(L){const $=Math.pow(10,`${Math.floor(L)}`.length-1);let H=L/$;return H=H>=10?10:H>=5?5:H>=3?3:H>=2?2:H>=1?1:function(Q){const ne=Math.pow(10,Math.ceil(-Math.log(Q)/Math.LN10));return Math.round(Q*ne)/ne}(H),$*H}(h),I=S/h;this._container.innerHTML=this._isNumberFormatSupported&&m!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:m}).format(S):`${S}&nbsp;${dx[m]}`,this._container.style.width=v*I+"px"})}onAdd(v){return this._map=v,this._language=v.getLanguage(),this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-scale",v.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(v){this._language=v,this._update()}setUnit(v){this.options.unit=v,this._update()}},FullscreenControl:class{constructor(v){this._fullscreen=!1,v&&v.container&&(v.container instanceof s.window.HTMLElement?this._container=v.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=E("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const v=this._fullscreenButton=E("button","mapboxgl-ctrl-fullscreen",this._controlContainer);E("span","mapboxgl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",v)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(v){super(),this.options=s.extend(Object.create(xi),v),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(v&&v.className?v.className.trim().split(/\s+/):[])}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&v.on("preclick",this._onClose),this.options.closeOnMove&&v.on("move",this._onClose),v.on("remove",this.remove),this._update(),v._addPopup(this),this._focusFirstElement(),this._trackPointer?(v.on("mousemove",this._onMouseEvent),v.on("mouseup",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")):v.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const v=this._map;return v&&(v.off("move",this._update),v.off("move",this._onClose),v.off("preclick",this._onClose),v.off("click",this._onClose),v.off("remove",this.remove),v.off("mousemove",this._onMouseEvent),v.off("mouseup",this._onMouseEvent),v.off("drag",this._onMouseEvent),v._canvasContainer&&v._canvasContainer.classList.remove("mapboxgl-track-pointer"),v._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(v){this._lngLat=s.LngLat.convert(v),this._pos=null,this._trackPointer=!1,this._update();const h=this._map;return h&&(h.on("move",this._update),h.off("mousemove",this._onMouseEvent),h._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const v=this._map;return v&&(v.off("move",this._update),v.on("mousemove",this._onMouseEvent),v.on("drag",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(s.window.document.createTextNode(v))}setHTML(v){const h=s.window.document.createDocumentFragment(),m=s.window.document.createElement("body");let S;for(m.innerHTML=v;S=m.firstChild,S;)h.appendChild(S);return this.setDOMContent(h)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){let h=this._content;if(h)for(;h.hasChildNodes();)h.firstChild&&h.removeChild(h.firstChild);else h=this._content=E("div","mapboxgl-popup-content",this._container||void 0);if(h.appendChild(v),this.options.closeButton){const m=this._closeButton=E("button","mapboxgl-popup-close-button",h);m.type="button",m.setAttribute("aria-label","Close popup"),m.setAttribute("aria-hidden","true"),m.innerHTML="&#215;",m.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(v){return this._classList.add(v),this._updateClassList(),this}removeClassName(v){return this._classList.delete(v),this._updateClassList(),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){let h;return this._classList.delete(v)?h=!1:(this._classList.add(v),h=!0),this._updateClassList(),h}_onMouseEvent(v){this._update(v.point)}_getAnchor(v){if(this.options.anchor)return this.options.anchor;const h=this._map,m=this._container,S=this._pos;if(!h||!m||!S)return"bottom";const I=m.offsetWidth,L=m.offsetHeight,$=S.x<I/2,H=S.x>h.transform.width-I/2;if(S.y+v<L)return $?"top-left":H?"top-right":"top";if(S.y>h.transform.height-L){if($)return"bottom-left";if(H)return"bottom-right"}return $?"left":H?"right":"bottom"}_updateClassList(){const v=this._container;if(!v)return;const h=[...this._classList];h.push("mapboxgl-popup"),this._anchor&&h.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&h.push("mapboxgl-popup-track-pointer"),v.className=h.join(" ")}_update(v){const h=this._map,m=this._content;if(!h||!this._lngLat&&!this._trackPointer||!m)return;let S=this._container;if(S||(S=this._container=E("div","mapboxgl-popup",h.getContainer()),this._tip=E("div","mapboxgl-popup-tip",S),S.appendChild(m)),this.options.maxWidth&&S.style.maxWidth!==this.options.maxWidth&&(S.style.maxWidth=this.options.maxWidth),h.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vr(this._lngLat,this._pos,h.transform)),!this._trackPointer||v){const I=this._pos=this._trackPointer&&v?v:h.project(this._lngLat),L=gr(this.options.offset),$=this._anchor=this._getAnchor(L.y),H=gr(this.options.offset,$),Q=I.add(H).round();h._requestDomTask(()=>{this._container&&$&&(this._container.style.transform=`${Jr[$]} translate(${Q.x}px,${Q.y}px)`)})}if(!this._marker&&h._showingGlobe()){const I=s.isLngLatBehindGlobe(h.transform,this._lngLat)?0:1;this._setOpacity(I)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector($i);v&&v.focus()}_onClose(){this.remove()}_setOpacity(v){this._container&&(this._container.style.opacity=`${v}`),this._content&&(this._content.style.pointerEvents=v?"auto":"none")}},Marker:qt,Style:Ds,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:F_,Evented:s.Evented,config:s.config,prewarm:function(){Tr().acquire(Ir)},clearPrewarmedResources:function(){const v=rr;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(Ir),rr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(v){s.config.ACCESS_TOKEN=v},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(v){s.config.API_URL=v},get workerCount(){return fr.workerCount},set workerCount(v){fr.workerCount=v},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(v){s.config.MAX_PARALLEL_IMAGE_REQUESTS=v},clearStorage(v){s.clearTileCache(v)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return Zg});var a=i;return a})})(Jce);var tfe=Jce.exports;const h8=mA(tfe),Ost=Q4({__proto__:null,default:h8},[tfe]);var tx=Lst,Rst=Object.prototype.hasOwnProperty;function Lst(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var r in n)Rst.call(n,r)&&(t[r]=n[r])}return t}var nfe={exports:{}};(function(t,e){(function(){var n={};t.exports=n,n.simpleFilter=function(r,i){return i.filter(function(o){return n.test(r,o)})},n.test=function(r,i){return n.match(r,i)!==null},n.match=function(r,i,o){o=o||{};var a=0,s=[],u=i.length,d=0,g=0,_=o.pre||"",E=o.post||"",P=o.caseSensitive&&i||i.toLowerCase(),R;r=o.caseSensitive&&r||r.toLowerCase();for(var B=0;B<u;B++)R=i[B],P[B]===r[a]?(R=_+R+E,a+=1,g+=1+g):g=0,d+=g,s[s.length]=R;return a===r.length?(d=P===r?1/0:d,{rendered:s.join(""),score:d}):null},n.filter=function(r,i,o){return!i||i.length===0?[]:typeof r!="string"?i:(o=o||{},i.reduce(function(a,s,u,d){var g=s;o.extract&&(g=o.extract(s));var _=n.match(r,g,o);return _!=null&&(a[a.length]={string:_.rendered,score:_.score,index:u,original:s}),a},[]).sort(function(a,s){var u=s.score-a.score;return u||a.index-s.index}))}})()})(nfe);var Dst=nfe.exports,Vu=function(t){return this.component=t,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};Vu.prototype.show=function(){this.element.style.display="block"};Vu.prototype.hide=function(){this.element.style.display="none"};Vu.prototype.add=function(t){this.items.push(t)};Vu.prototype.clear=function(){this.items=[],this.active=0};Vu.prototype.isEmpty=function(){return!this.items.length};Vu.prototype.isVisible=function(){return this.element.style.display==="block"};Vu.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()};Vu.prototype.drawItem=function(t,e){var n=document.createElement("li"),r=document.createElement("a");e&&(n.className+=" active"),r.innerHTML=t.string,n.appendChild(r),this.element.appendChild(n),n.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),n.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,t)}).bind(this))};Vu.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()};Vu.prototype.move=function(t){this.active=t,this.draw()};Vu.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Vu.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Vu.prototype.drawError=function(t){var e=document.createElement("li");e.innerHTML=t,this.element.appendChild(e),this.show()};var Bst=Vu,Nst=tx,Fst=Dst,kst=Bst,Bl=function(t,e,n){return n=n||{},this.options=Nst({minLength:2,limit:5,filter:!0,hideOnBlur:!0},n),this.el=t,this.data=e||[],this.list=new kst(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(r){this.handleKeyUp(r.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(r){this.handleKeyDown(r)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(r){this.handlePaste(r)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Bl.prototype.handleKeyUp=function(t){t===40||t===38||t===27||t===13||t===9||this.handleInputChange(this.el.value)};Bl.prototype.handleKeyDown=function(t){switch(t.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&t.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Bl.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Bl.prototype.handlePaste=function(t){if(t.clipboardData)this.handleInputChange(t.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(t.target.value)},100)}};Bl.prototype.handleInputChange=function(t){if(this.query=this.normalize(t),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(e){for(var n=0;n<e.length&&(this.list.add(e[n]),n!==this.options.limit-1);n++);this.list.draw()}).bind(this))};Bl.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Bl.prototype.update=function(t){this.data=t,this.handleKeyUp()};Bl.prototype.clear=function(){this.data=[],this.list.clear()};Bl.prototype.normalize=function(t){return t=t.toLowerCase(),t};Bl.prototype.match=function(t,e){return t.indexOf(e)>-1};Bl.prototype.value=function(t){if(this.selected=t,this.el.value=this.getItemValue(t),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")};Bl.prototype.getCandidates=function(t){var e={pre:"<strong>",post:"</strong>",extract:(function(r){return this.getItemValue(r)}).bind(this)},n;this.options.filter?(n=Fst.filter(this.query,this.data,e),n=n.map((function(r){return{original:r.original,string:this.render(r.original,r.string)}}).bind(this))):n=this.data.map((function(r){var i=this.render(r);return{original:r,string:i}}).bind(this)),t(n)};Bl.prototype.getItemValue=function(t){return t};Bl.prototype.render=function(t,e){if(e)return e;for(var n=t.original?this.getItemValue(t.original):this.getItemValue(t),r=this.normalize(n),i=r.lastIndexOf(this.query);i>-1;){var o=i+this.query.length;n=n.slice(0,i)+"<strong>"+n.slice(i,o)+"</strong>"+n.slice(o),i=r.slice(0,i).lastIndexOf(this.query)}return n};Bl.prototype.renderError=function(t){this.list.drawError(t)};var zst=Bl,rfe=zst,Ust=rfe;typeof window<"u"&&(window.Suggestions=rfe);var Gst="Expected a function",jQ=0/0,jst="[object Symbol]",Vst=/^\s+|\s+$/g,$st=/^[-+]0x[0-9a-f]+$/i,Hst=/^0b[01]+$/i,Wst=/^0o[0-7]+$/i,qst=parseInt,Xst=typeof Ya=="object"&&Ya&&Ya.Object===Object&&Ya,Zst=typeof self=="object"&&self&&self.Object===Object&&self,Yst=Xst||Zst||Function("return this")(),Qst=Object.prototype,Kst=Qst.toString,Jst=Math.max,eat=Math.min,_N=function(){return Yst.Date.now()};function tat(t,e,n){var r,i,o,a,s,u,d=0,g=!1,_=!1,E=!0;if(typeof t!="function")throw new TypeError(Gst);e=VQ(e)||0,Z4(n)&&(g=!!n.leading,_="maxWait"in n,o=_?Jst(VQ(n.maxWait)||0,e):o,E="trailing"in n?!!n.trailing:E);function P(J){var ie=r,ce=i;return r=i=void 0,d=J,a=t.apply(ce,ie),a}function R(J){return d=J,s=setTimeout(z,e),g?P(J):a}function B(J){var ie=J-u,ce=J-d,re=e-ie;return _?eat(re,o-ce):re}function V(J){var ie=J-u,ce=J-d;return u===void 0||ie>=e||ie<0||_&&ce>=o}function z(){var J=_N();if(V(J))return F(J);s=setTimeout(z,B(J))}function F(J){return s=void 0,E&&r?P(J):(r=i=void 0,a)}function k(){s!==void 0&&clearTimeout(s),d=0,r=u=i=s=void 0}function X(){return s===void 0?a:F(_N())}function Y(){var J=_N(),ie=V(J);if(r=arguments,i=this,u=J,ie){if(s===void 0)return R(u);if(_)return s=setTimeout(z,e),P(u)}return s===void 0&&(s=setTimeout(z,e)),a}return Y.cancel=k,Y.flush=X,Y}function Z4(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function nat(t){return!!t&&typeof t=="object"}function rat(t){return typeof t=="symbol"||nat(t)&&Kst.call(t)==jst}function VQ(t){if(typeof t=="number")return t;if(rat(t))return jQ;if(Z4(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Z4(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(Vst,"");var n=Hst.test(t);return n||Wst.test(t)?qst(t.slice(2),n?2:8):$st.test(t)?jQ:+t}var iat=tat,d8={exports:{}},Sv=typeof Reflect=="object"?Reflect:null,$Q=Sv&&typeof Sv.apply=="function"?Sv.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},bP;Sv&&typeof Sv.ownKeys=="function"?bP=Sv.ownKeys:Object.getOwnPropertySymbols?bP=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:bP=function(e){return Object.getOwnPropertyNames(e)};function oat(t){console&&console.warn&&console.warn(t)}var ife=Number.isNaN||function(e){return e!==e};function so(){so.init.call(this)}d8.exports=so;d8.exports.once=uat;so.EventEmitter=so;so.prototype._events=void 0;so.prototype._eventsCount=0;so.prototype._maxListeners=void 0;var HQ=10;function kL(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(so,"defaultMaxListeners",{enumerable:!0,get:function(){return HQ},set:function(t){if(typeof t!="number"||t<0||ife(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");HQ=t}});so.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};so.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||ife(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ofe(t){return t._maxListeners===void 0?so.defaultMaxListeners:t._maxListeners}so.prototype.getMaxListeners=function(){return ofe(this)};so.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var a;if(n.length>0&&(a=n[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var u=o[e];if(u===void 0)return!1;if(typeof u=="function")$Q(u,this,n);else for(var d=u.length,g=cfe(u,d),r=0;r<d;++r)$Q(g[r],this,n);return!0};function sfe(t,e,n,r){var i,o,a;if(kL(n),o=t._events,o===void 0?(o=t._events=Object.create(null),t._eventsCount=0):(o.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),a=o[e]),a===void 0)a=o[e]=n,++t._eventsCount;else if(typeof a=="function"?a=o[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),i=ofe(t),i>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=e,s.count=a.length,oat(s)}return t}so.prototype.addListener=function(e,n){return sfe(this,e,n,!1)};so.prototype.on=so.prototype.addListener;so.prototype.prependListener=function(e,n){return sfe(this,e,n,!0)};function sat(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function afe(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=sat.bind(r);return i.listener=n,r.wrapFn=i,i}so.prototype.once=function(e,n){return kL(n),this.on(e,afe(this,e,n)),this};so.prototype.prependOnceListener=function(e,n){return kL(n),this.prependListener(e,afe(this,e,n)),this};so.prototype.removeListener=function(e,n){var r,i,o,a,s;if(kL(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(o=-1,a=r.length-1;a>=0;a--)if(r[a]===n||r[a].listener===n){s=r[a].listener,o=a;break}if(o<0)return this;o===0?r.shift():aat(r,o),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,s||n)}return this};so.prototype.off=so.prototype.removeListener;so.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),a;for(i=0;i<o.length;++i)a=o[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function lfe(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?lat(i):cfe(i,i.length)}so.prototype.listeners=function(e){return lfe(this,e,!0)};so.prototype.rawListeners=function(e){return lfe(this,e,!1)};so.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):ufe.call(t,e)};so.prototype.listenerCount=ufe;function ufe(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}so.prototype.eventNames=function(){return this._eventsCount>0?bP(this._events):[]};function cfe(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function aat(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function lat(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function uat(t,e){return new Promise(function(n,r){function i(a){t.removeListener(e,o),r(a)}function o(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}ffe(t,e,o,{once:!0}),e!=="error"&&cat(t,i,{once:!0})})}function cat(t,e,n){typeof t.on=="function"&&ffe(t,"error",e,n)}function ffe(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(o){r.once&&t.removeEventListener(e,i),n(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var fat=d8.exports,hat={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function dat(t){var e=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return e?{key:e[1],value:e[2]}:null}function pat(t){var e=t.match(/<?([^>]*)>(.*)/);if(!e)return null;var n=e[1],r=e[2].split(";"),i=null,o=r.reduce(function(a,s){var u=dat(s);return u?u.key==="rel"?(i||(i=u.value),a):(a[u.key]=u.value,a):a},{});return i?{url:n,rel:i,params:o}:null}function gat(t){return t?t.split(/,\s*</).reduce(function(e,n){var r=pat(n);if(!r)return e;var i=r.rel.split(/\s+/);return i.forEach(function(o){e[o]||(e[o]={url:r.url,params:r.params})}),e},{}):{}}var mat=gat,Aat=mat;function p8(t,e){this.request=t,this.headers=e.headers,this.rawBody=e.body,this.statusCode=e.statusCode;try{this.body=JSON.parse(e.body||"{}")}catch{this.body=e.body}this.links=Aat(this.headers.link)}p8.prototype.hasNextPage=function(){return!!this.links.next};p8.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var _at=p8,zL={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},WQ=zL;function yat(t){var e=t.type||WQ.ERROR_HTTP,n;if(t.body)try{n=JSON.parse(t.body)}catch{n=t.body}else n=null;var r=t.message||null;r||(typeof n=="string"?r=n:n&&typeof n.message=="string"?r=n.message:e===WQ.ERROR_REQUEST_ABORTED&&(r="Request aborted")),this.message=r,this.type=e,this.statusCode=t.statusCode||null,this.request=t.request,this.body=n}var vat=yat;function xat(t){var e=t.indexOf(":"),n=t.substring(0,e).trim().toLowerCase(),r=t.substring(e+1).trim();return{name:n,value:r}}function bat(t){var e={};return t&&t.trim().split(/[\r|\n]+/).forEach(function(n){var r=xat(n);e[r.name]=r.value}),e}var wat=bat,Eat=_at,qQ=vat,yN=zL,Sat=wat,cO={};function Tat(t){var e=cO[t.id];e&&(e.abort(),delete cO[t.id])}function Cat(t,e){return new Eat(t,{body:e.response,headers:Sat(e.getAllResponseHeaders()),statusCode:e.status})}function XQ(t){var e=t.total,n=t.loaded,r=100*n/e;return{total:e,transferred:n,percent:r}}function hfe(t,e){return new Promise(function(n,r){e.onprogress=function(a){t.emitter.emit(yN.EVENT_PROGRESS_DOWNLOAD,XQ(a))};var i=t.file;i&&(e.upload.onprogress=function(a){t.emitter.emit(yN.EVENT_PROGRESS_UPLOAD,XQ(a))}),e.onerror=function(a){r(a)},e.onabort=function(){var a=new qQ({request:t,type:yN.ERROR_REQUEST_ABORTED});r(a)},e.onload=function(){if(delete cO[t.id],e.status<200||e.status>=400){var a=new qQ({request:t,body:e.response,statusCode:e.status});r(a);return}n(e)};var o=t.body;typeof o=="string"?e.send(o):o?e.send(JSON.stringify(o)):i?e.send(i):e.send(),cO[t.id]=e}).then(function(n){return Cat(t,n)})}function dfe(t,e){var n=t.url(e),r=new window.XMLHttpRequest;return r.open(t.method,n),Object.keys(t.headers).forEach(function(i){r.setRequestHeader(i,t.headers[i])}),r}function Pat(t){return Promise.resolve().then(function(){var e=dfe(t,t.client.accessToken);return hfe(t,e)})}var Iat={browserAbort:Tat,sendRequestXhr:hfe,browserSend:Pat,createRequestXhr:dfe},fO={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */fO.exports;(function(t,e){(function(n){var r=e,i=t&&t.exports==r&&t,o=typeof Ya=="object"&&Ya;(o.global===o||o.window===o)&&(n=o);var a=function(R){this.message=R};a.prototype=new Error,a.prototype.name="InvalidCharacterError";var s=function(R){throw new a(R)},u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=/[\t\n\f\r ]/g,g=function(R){R=String(R).replace(d,"");var B=R.length;B%4==0&&(R=R.replace(/==?$/,""),B=R.length),(B%4==1||/[^+a-zA-Z0-9/]/.test(R))&&s("Invalid character: the string to be decoded is not correctly encoded.");for(var V=0,z,F,k="",X=-1;++X<B;)F=u.indexOf(R.charAt(X)),z=V%4?z*64+F:F,V++%4&&(k+=String.fromCharCode(255&z>>(-2*V&6)));return k},_=function(R){R=String(R),/[^\0-\xFF]/.test(R)&&s("The string to be encoded contains characters outside of the Latin1 range.");for(var B=R.length%3,V="",z=-1,F,k,X,Y,J=R.length-B;++z<J;)F=R.charCodeAt(z)<<16,k=R.charCodeAt(++z)<<8,X=R.charCodeAt(++z),Y=F+k+X,V+=u.charAt(Y>>18&63)+u.charAt(Y>>12&63)+u.charAt(Y>>6&63)+u.charAt(Y&63);return B==2?(F=R.charCodeAt(z)<<8,k=R.charCodeAt(++z),Y=F+k,V+=u.charAt(Y>>10)+u.charAt(Y>>4&63)+u.charAt(Y<<2&63)+"="):B==1&&(Y=R.charCodeAt(z),V+=u.charAt(Y>>2)+u.charAt(Y<<4&63)+"=="),V},E={encode:_,decode:g,version:"0.1.0"};if(r&&!r.nodeType)if(i)i.exports=E;else for(var P in E)E.hasOwnProperty(P)&&(r[P]=E[P]);else n.base64=E})(Ya)})(fO,fO.exports);var Mat=fO.exports,Oat=Mat,vN={};function Rat(t){if(vN[t])return vN[t];var e=t.split("."),n=e[0],r=e[1];if(!r)throw new Error("Invalid token");var i=Lat(r),o={usage:n,user:i.u};return d0(i,"a")&&(o.authorization=i.a),d0(i,"exp")&&(o.expires=i.exp*1e3),d0(i,"iat")&&(o.created=i.iat*1e3),d0(i,"scopes")&&(o.scopes=i.scopes),d0(i,"client")&&(o.client=i.client),d0(i,"ll")&&(o.lastLogin=i.ll),d0(i,"iu")&&(o.impersonator=i.iu),vN[t]=o,o}function Lat(t){try{return JSON.parse(Oat.decode(t))}catch{throw new Error("Invalid token")}}function d0(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var pfe=Rat,gfe={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function i(u,d,g){this.fn=u,this.context=d,this.once=g||!1}function o(u,d,g,_,E){if(typeof g!="function")throw new TypeError("The listener must be a function");var P=new i(g,_||u,E),R=n?n+d:d;return u._events[R]?u._events[R].fn?u._events[R]=[u._events[R],P]:u._events[R].push(P):(u._events[R]=P,u._eventsCount++),u}function a(u,d){--u._eventsCount===0?u._events=new r:delete u._events[d]}function s(){this._events=new r,this._eventsCount=0}s.prototype.eventNames=function(){var d=[],g,_;if(this._eventsCount===0)return d;for(_ in g=this._events)e.call(g,_)&&d.push(n?_.slice(1):_);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(g)):d},s.prototype.listeners=function(d){var g=n?n+d:d,_=this._events[g];if(!_)return[];if(_.fn)return[_.fn];for(var E=0,P=_.length,R=new Array(P);E<P;E++)R[E]=_[E].fn;return R},s.prototype.listenerCount=function(d){var g=n?n+d:d,_=this._events[g];return _?_.fn?1:_.length:0},s.prototype.emit=function(d,g,_,E,P,R){var B=n?n+d:d;if(!this._events[B])return!1;var V=this._events[B],z=arguments.length,F,k;if(V.fn){switch(V.once&&this.removeListener(d,V.fn,void 0,!0),z){case 1:return V.fn.call(V.context),!0;case 2:return V.fn.call(V.context,g),!0;case 3:return V.fn.call(V.context,g,_),!0;case 4:return V.fn.call(V.context,g,_,E),!0;case 5:return V.fn.call(V.context,g,_,E,P),!0;case 6:return V.fn.call(V.context,g,_,E,P,R),!0}for(k=1,F=new Array(z-1);k<z;k++)F[k-1]=arguments[k];V.fn.apply(V.context,F)}else{var X=V.length,Y;for(k=0;k<X;k++)switch(V[k].once&&this.removeListener(d,V[k].fn,void 0,!0),z){case 1:V[k].fn.call(V[k].context);break;case 2:V[k].fn.call(V[k].context,g);break;case 3:V[k].fn.call(V[k].context,g,_);break;case 4:V[k].fn.call(V[k].context,g,_,E);break;default:if(!F)for(Y=1,F=new Array(z-1);Y<z;Y++)F[Y-1]=arguments[Y];V[k].fn.apply(V[k].context,F)}}return!0},s.prototype.on=function(d,g,_){return o(this,d,g,_,!1)},s.prototype.once=function(d,g,_){return o(this,d,g,_,!0)},s.prototype.removeListener=function(d,g,_,E){var P=n?n+d:d;if(!this._events[P])return this;if(!g)return a(this,P),this;var R=this._events[P];if(R.fn)R.fn===g&&(!E||R.once)&&(!_||R.context===_)&&a(this,P);else{for(var B=0,V=[],z=R.length;B<z;B++)(R[B].fn!==g||E&&!R[B].once||_&&R[B].context!==_)&&V.push(R[B]);V.length?this._events[P]=V.length===1?V[0]:V:a(this,P)}return this},s.prototype.removeAllListeners=function(d){var g;return d?(g=n?n+d:d,this._events[g]&&a(this,g)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s})(gfe);var Dat=gfe.exports;function Bat(t){return t.map(encodeURIComponent).join(",")}function mfe(t){return Array.isArray(t)?Bat(t):encodeURIComponent(String(t))}function Afe(t,e,n){if(n===!1||n===null)return t;var r=/\?/.test(t)?"&":"?",i=encodeURIComponent(e);return n!==void 0&&n!==""&&n!==!0&&(i+="="+mfe(n)),""+t+r+i}function Nat(t,e){if(!e)return t;var n=t;return Object.keys(e).forEach(function(r){var i=e[r];i!==void 0&&(Array.isArray(i)&&(i=i.filter(function(o){return o!=null}).join(",")),n=Afe(n,r,i))}),n}function Fat(t,e){if(!e||t.slice(0,4)==="http")return t;var n=t[0]==="/"?"":"/";return""+e.replace(/\/$/,"")+n+t}function kat(t,e){return e?t.replace(/\/:([a-zA-Z0-9]+)/g,function(n,r){var i=e[r];if(i===void 0)throw new Error("Unspecified route parameter "+r);var o=mfe(i);return"/"+o}):t}var zat={appendQueryObject:Nat,appendQueryParam:Afe,prependOrigin:Fat,interpolateRouteParams:kat},Uat=pfe,g8=tx,Gat=Dat,kT=zat,ZQ=zL,jat=1;function pA(t,e){if(!t)throw new Error("MapiRequest requires a client");if(!e||!e.path||!e.method)throw new Error("MapiRequest requires an options object with path and method properties");var n={};e.body&&(n["content-type"]="application/json");var r=g8(n,e.headers),i=Object.keys(r).reduce(function(o,a){return o[a.toLowerCase()]=r[a],o},{});this.id=jat++,this._options=e,this.emitter=new Gat,this.client=t,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=e.path,this.method=e.method,this.origin=e.origin||t.origin,this.query=e.query||{},this.params=e.params||{},this.body=e.body||null,this.file=e.file||null,this.encoding=e.encoding||"utf8",this.sendFileAs=e.sendFileAs||null,this.headers=i}pA.prototype.url=function(e){var n=kT.prependOrigin(this.path,this.origin);n=kT.appendQueryObject(n,this.query);var r=this.params,i=e??this.client.accessToken;if(i){n=kT.appendQueryParam(n,"access_token",i);var o=Uat(i).user;r=g8({ownerId:o},r)}return n=kT.interpolateRouteParams(n,r),n};pA.prototype.send=function(){var e=this;if(e.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return e.sent=!0,e.client.sendRequest(e).then(function(n){return e.response=n,e.emitter.emit(ZQ.EVENT_RESPONSE,n),n},function(n){throw e.error=n,e.emitter.emit(ZQ.EVENT_ERROR,n),n})};pA.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};pA.prototype.eachPage=function(e){var n=this;function r(a){function s(){delete n._nextPageRequest;var u=a.nextPage();u&&(n._nextPageRequest=u,o(u))}e(null,a,s)}function i(a){e(a,null,function(){})}function o(a){a.send().then(r,i)}o(this)};pA.prototype.clone=function(){return this._extend()};pA.prototype._extend=function(e){var n=g8(this._options,e);return new pA(this.client,n)};var Vat=pA,$at=pfe,Hat=Vat,Wat=zL;function _fe(t){if(!t||!t.accessToken)throw new Error("Cannot create a client without an access token");$at(t.accessToken),this.accessToken=t.accessToken,this.origin=t.origin||Wat.API_ORIGIN}_fe.prototype.createRequest=function(e){return new Hat(this,e)};var yfe=_fe,vfe=Iat,xfe=yfe;function C1(t){xfe.call(this,t)}C1.prototype=Object.create(xfe.prototype);C1.prototype.constructor=C1;C1.prototype.sendRequest=vfe.browserSend;C1.prototype.abortRequest=vfe.browserAbort;function qat(t){return new C1(t)}var bfe=qat,Xat=bfe,Zat=Xat,Yat=Object.prototype.toString,Qat=function(t){var e;return Yat.call(t)==="[object Object]"&&(e=Object.getPrototypeOf(t),e===null||e===Object.getPrototypeOf({}))},Kat=Qat,Jat=tx,wfe="value",xN=`
  `,wo={};wo.assert=function(t,e){return e=e||{},function(n){var r=gA(t,n);if(r){var i=m8(r,e);throw e.apiName&&(i=e.apiName+": "+i),new Error(i)}}};wo.shape=function(e){var n=rlt(e);return function(i){var o=gA(wo.plainObject,i);if(o)return o;for(var a,s,u=[],d=0;d<n.length;d++)a=n[d].key,s=n[d].value,o=gA(s,i[a]),o&&u.push([a].concat(o));return u.length<2?u[0]:function(g){u=u.map(function(P){var R=P[0],B=m8(P,g).split(`
`).join(xN);return"- "+R+": "+B});var _=g.path.join("."),E=_===wfe?"":" of "+_;return"The following properties"+E+" have invalid values:"+xN+u.join(xN)}}};wo.strictShape=function(e){var n=wo.shape(e);return function(i){var o=n(i);if(o)return o;var a=Object.keys(i).reduce(function(s,u){return e[u]===void 0&&s.push(u),s},[]);if(a.length!==0)return function(){return"The following keys are invalid: "+a.join(", ")}}};wo.arrayOf=function(e){return Efe(e)};wo.tuple=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return Efe(e)};function Efe(t){var e=Array.isArray(t),n=function(r){return e?t[r]:t};return function(i){var o=gA(wo.plainArray,i);if(o)return o;if(e&&i.length!==t.length)return"an array with "+t.length+" items";for(var a=0;a<i.length;a++)if(o=gA(n(a),i[a]),o)return[a].concat(o)}}wo.required=function(e){function n(r){return r==null?function(i){return Sfe(i,Tfe(i.path)?"cannot be undefined/null.":"is required.")}:e.apply(this,arguments)}return n.__required=!0,n};wo.oneOfType=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(r){var i=e.map(function(o){return gA(o,r)}).filter(Boolean);if(i.length===e.length)return i.every(function(o){return o.length===1&&typeof o[0]=="string"})?elt(i.map(function(o){return o[0]})):i.reduce(function(o,a){return a.length>o.length?a:o})}};wo.equal=function(e){return function(r){if(r!==e)return JSON.stringify(e)}};wo.oneOf=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),n=e.map(function(r){return wo.equal(r)});return wo.oneOfType.apply(this,n)};wo.range=function(e){var n=e[0],r=e[1];return function(o){var a=gA(wo.number,o);if(a||o<n||o>r)return"number between "+n+" & "+r+" (inclusive)"}};wo.any=function(){};wo.boolean=function(e){if(typeof e!="boolean")return"boolean"};wo.number=function(e){if(typeof e!="number")return"number"};wo.plainArray=function(e){if(!Array.isArray(e))return"array"};wo.plainObject=function(e){if(!Kat(e))return"object"};wo.string=function(e){if(typeof e!="string")return"string"};wo.func=function(e){if(typeof e!="function")return"function"};function gA(t,e){if(!(e==null&&!t.hasOwnProperty("__required"))){var n=t(e);if(n)return Array.isArray(n)?n:[n]}}function m8(t,e){var n=t.length,r=t[n-1],i=t.slice(0,n-1);return i.length===0&&(i=[wfe]),e=Jat(e,{path:i}),typeof r=="function"?r(e):Sfe(e,tlt(r))}function elt(t){return t.length<2?t[0]:t.length===2?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t.slice(-1)}function tlt(t){return"must be "+nlt(t)+"."}function nlt(t){return/^an? /.test(t)?t:/^[aeiou]/i.test(t)?"an "+t:/^[a-z]/i.test(t)?"a "+t:t}function Sfe(t,e){var n=Tfe(t.path),r=t.path.join(".")+" "+e,i=n?"Item at position ":"";return i+r}function Tfe(t){return typeof t[t.length-1]=="number"||typeof t[0]=="number"}function rlt(t){return Object.keys(t||{}).map(function(e){return{key:e,value:t[e]}})}wo.validate=gA;wo.processMessage=m8;var ilt=wo,olt=tx,Tv=ilt;function slt(t){if(typeof window<"u")return t instanceof Ya.Blob||t instanceof Ya.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof t=="string"||t.pipe!==void 0))return"Filename or Readable stream"}function alt(t,e){return Tv.assert(Tv.strictShape(t),e)}function llt(t){var e="date";if(typeof t=="boolean")return e;try{var n=new Date(t);if(n.getTime&&isNaN(n.getTime()))return e}catch{return e}}function ult(t){return Tv.tuple(Tv.number,Tv.number)(t)}var clt=olt(Tv,{file:slt,date:llt,coordinates:ult,assertShape:alt});function flt(t,e){var n=function(r,i){return e.indexOf(r)!==-1&&i!==void 0};return typeof e=="function"&&(n=e),Object.keys(t).filter(function(r){return n(r,t[r])}).reduce(function(r,i){return r[i]=t[i],r},{})}var hlt=flt;function dlt(t,e){return Object.keys(t).reduce(function(n,r){return n[r]=e(r,t[r]),n},{})}var plt=dlt,glt=plt;function mlt(t){return glt(t,function(e,n){return typeof n=="boolean"?JSON.stringify(n):n})}var Alt=mlt,_lt=yfe,ylt=bfe;function vlt(t){return function(e){var n;_lt.prototype.isPrototypeOf(e)?n=e:n=ylt(e);var r=Object.create(t);return r.client=n,r}}var xlt=vlt,Cfe=tx,hi=clt,hO=hlt,Pfe=Alt,blt=xlt,A8={},Ife=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];A8.forwardGeocode=function(t){hi.assertShape({query:hi.required(hi.string),mode:hi.oneOf("mapbox.places","mapbox.places-permanent"),countries:hi.arrayOf(hi.string),proximity:hi.oneOf(hi.coordinates,"ip"),types:hi.arrayOf(hi.oneOf(Ife)),autocomplete:hi.boolean,bbox:hi.arrayOf(hi.number),limit:hi.number,language:hi.arrayOf(hi.string),routing:hi.boolean,fuzzyMatch:hi.boolean,worldview:hi.string})(t),t.mode=t.mode||"mapbox.places";var e=Pfe(Cfe({country:t.countries},hO(t,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:hO(t,["mode","query"]),query:e})};A8.reverseGeocode=function(t){hi.assertShape({query:hi.required(hi.coordinates),mode:hi.oneOf("mapbox.places","mapbox.places-permanent"),countries:hi.arrayOf(hi.string),types:hi.arrayOf(hi.oneOf(Ife)),bbox:hi.arrayOf(hi.number),limit:hi.number,language:hi.arrayOf(hi.string),reverseMode:hi.oneOf("distance","score"),routing:hi.boolean,worldview:hi.string})(t),t.mode=t.mode||"mapbox.places";var e=Pfe(Cfe({country:t.countries},hO(t,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:hO(t,["mode","query"]),query:e})};var wlt=blt(A8);let Elt="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Mfe=t=>crypto.getRandomValues(new Uint8Array(t)),Ofe=(t,e,n)=>{let r=(2<<Math.log(t.length-1)/Math.LN2)-1,i=-~(1.6*r*e/t.length);return(o=e)=>{let a="";for(;;){let s=n(i),u=i;for(;u--;)if(a+=t[s[u]&r]||"",a.length===o)return a}}},Slt=(t,e=21)=>Ofe(t,e,Mfe),Tlt=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");const Clt=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:Slt,customRandom:Ofe,nanoid:Tlt,random:Mfe,urlAlphabet:Elt},Symbol.toStringTag,{value:"Module"})),Plt=ti(Clt);var Ilt=Plt.nanoid;function Rfe(t){this.origin=t.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=t.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=t,this.send=this.send.bind(this),this.countries=t.countries?t.countries.split(","):null,this.types=t.types?t.types.split(","):null,this.bbox=t.bbox?t.bbox:null,this.language=t.language?t.language.split(","):null,this.limit=t.limit?+t.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(t),this.eventQueue=new Array,this.flushInterval=t.flushInterval||1e3,this.maxQueueSize=t.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}Rfe.prototype={select:function(t,e){var n=this.getSelectedIndex(t,e),r=this.getEventPayload("search.select",e);if(r.resultIndex=n,r.resultPlaceName=t.place_name,r.resultId=t.id,!(n===this.lastSentIndex&&r.queryString===this.lastSentInput||n==-1)&&(this.lastSentIndex=n,this.lastSentInput=r.queryString,!!r.queryString))return this.push(r)},start:function(t){var e=this.getEventPayload("search.start",t);if(e.queryString)return this.push(e)},keyevent:function(t,e){if(t.key&&!(t.metaKey||[9,27,37,39,13,38,40].indexOf(t.keyCode)!==-1)){var n=this.getEventPayload("search.keystroke",e);if(n.lastAction=t.key,!!n.queryString)return this.push(n)}},send:function(t,e){if(!this.enableEventLogging)return e?e():void 0;var n=this.getRequestOptions(t);this.request(n,(function(r){if(r)return this.handleError(r,e);if(e)return e()}).bind(this))},getRequestOptions:function(t){Array.isArray(t)||(t=[t]);var e={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return e},getEventPayload:function(t,e){var n;e.options.proximity?typeof e.options.proximity=="object"?n=[e.options.proximity.longitude,e.options.proximity.latitude]:e.options.proximity==="ip"?n=[999,999]:n=e.options.proximity:n=null;var r=e._map?e._map.getZoom():void 0,i={event:t,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:e.options.autocomplete,fuzzyMatch:e.options.fuzzyMatch,proximity:n,limit:e.options.limit,routing:e.options.routing,worldview:e.options.worldview,mapZoom:r,keyboardLocale:this.locale};return t==="search.select"?i.queryString=e.inputString:t!="search.select"&&e._inputEl?i.queryString=e._inputEl.value:i.queryString=e.inputString,i},request:function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(this.readyState==4)return this.status==204?e(null):e(this.statusText)},n.open(t.method,t.host+"/"+t.path,!0);for(var r in t.headers){var i=t.headers[r];n.setRequestHeader(r,i)}n.send(t.body)},handleError:function(t,e){if(e)return e(t)},generateSessionID:function(){return Ilt()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(t,e){if(e._typeahead){var n=e._typeahead.data,r=t.id,i=n.map(function(a){return a.id}),o=i.indexOf(r);return o}},shouldEnableLogging:function(t){return!(t.enableEventLogging===!1||t.origin&&t.origin!=="https://api.mapbox.com"||t.localGeocoder||t.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(t,e){this.eventQueue.push(t),(this.eventQueue.length>=this.maxQueueSize||e)&&this.flush()},remove:function(){this.flush()}};var Mlt=Rfe,Olt={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},Rlt={placeholder:Olt},Lfe={exports:{}};(function(t){(function(e,n,r){t.exports?t.exports=r():e[n]=r()})(Ya,"subtag",function(){var e="",n=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function r(u){return u.match(n)||[]}function i(u){return r(u).filter(function(d,g){return d&&g})}function o(u){return u=r(u),{language:u[1]||e,extlang:u[2]||e,script:u[3]||e,region:u[4]||e}}function a(u,d,g){Object.defineProperty(u,d,{value:g,enumerable:!0})}function s(u,d,g){function _(E){return r(E)[u]||e}a(_,"pattern",d),a(o,g,_)}return s(1,/^[a-zA-Z]{2,3}$/,"language"),s(2,/^[a-zA-Z]{3}$/,"extlang"),s(3,/^[a-zA-Z]{4}$/,"script"),s(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),a(o,"split",i),o})})(Lfe);var Llt=Lfe.exports;function Dfe(){}Dfe.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const t={enableHighAccuracy:!0};return new Promise(function(e,n){window.navigator.geolocation.getCurrentPosition(e,n,t)})}};var Dlt=Dfe;function Blt(t,e){const n=Bfe(t),r=["address","street","place","country"];var i;if(typeof e=="function")return e(n);const o=r.indexOf(e);return o===-1?i=r:i=r.slice(o),i.reduce(function(a,s){return n[s]?(a!==""&&(a=a+", "),a+n[s]):a},"")}function Bfe(t){const e=t.address||"",n=t.text||"",r=t.place_name||"",o={address:r.split(",")[0],houseNumber:e,street:n,placeName:r};return t.context.forEach(function(a){const s=a.id.split(".")[0];o[s]=a.text}),o}const Nlt=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var Flt={transformFeatureToGeolocationText:Blt,getAddressInfo:Bfe,REVERSE_GEOCODE_COORD_RGX:Nlt},klt=Ust,zlt=iat,A0=tx,Ult=fat.EventEmitter,YQ=hat,bN=Zat,wN=wlt,Glt=Mlt,jlt=Rlt,Vlt=Llt,$lt=Dlt,QQ=Flt;const ym={FORWARD:0,LOCAL:1,REVERSE:2};function Hlt(){var t=document.createElement("div");return t.className="mapboxgl-ctrl-geocoder--powered-by",t.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',t}function Nfe(t){this._eventEmitter=new Ult,this.options=A0({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new $lt}Nfe.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(t){return t.place_name},render:function(t){var e=t.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"}},addTo:function(t){function e(n,r){if(!document.body.contains(r))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const i=n.onAdd();r.appendChild(i)}if(t._controlContainer)t.addControl(this);else if(t instanceof HTMLElement)e(this,t);else if(typeof t=="string"){const n=document.querySelectorAll(t);if(n.length===0)throw new Error("Element ",t,"not found.");if(n.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,n[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(t){if(t&&typeof t!="string"&&(this._map=t),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=wN(bN({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new Glt(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var n=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",zlt(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(d){this.eventManager.keyevent(d,this)}).bind(this));var r=document.createElement("div");r.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var i=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(i),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),e.appendChild(n),e.appendChild(this._inputEl),e.appendChild(r),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var o=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(o),r.appendChild(this._geolocateEl),this._showGeolocateButton()}var a=this._typeahead=new klt(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),a.getItemValue=this.options.getItemValue;var s=a.list.draw,u=this._footerNode=Hlt();return a.list.draw=function(){s.call(this),u.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),u.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(u)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),e},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(t){this._hideLoadingIcon();const e={geometry:{type:"Point",coordinates:[t.coords.longitude,t.coords.latitude]}};this._handleMarker(e),this._fly(e),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(e),this._showClearButton(),this.fresh=!1;const n={limit:1,language:[this.options.language],query:e.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const r=e.geometry.coordinates[0]+","+e.geometry.coordinates[1];this._setInputValue(r),this._eventEmitter.emit("result",{result:e})}else this.geocoderService.reverseGeocode(n).send().then((function(r){const i=r.body.features[0];if(i){const o=QQ.transformFeatureToGeolocationText(i,this.options.addressAccuracy);this._setInputValue(o),i.user_coordinates=e.geometry.coordinates,this._eventEmitter.emit("result",{result:i})}else this._eventEmitter.emit("result",{result:{user_coordinates:e.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(t){t.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+t),n.setAttribute("viewBox","0 0 18 18"),n.setAttribute("xml:space","preserve"),n.setAttribute("width",18),n.setAttribute("height",18),n.innerHTML=e,n},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(t){this._inputEl.value=t,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(t){var e=(t.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this._geocode(e)},_onKeyDown:function(t){var e=27,n=9;if(t.keyCode===e&&this.options.clearAndBlurOnEsc)return this._clear(t),this._inputEl.blur();var r=t.target&&t.target.shadowRoot?t.target.shadowRoot.activeElement:t.target,i=r?r.value:"";if(!i)return this.fresh=!0,t.keyCode!==n&&this.clear(t),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(t.metaKey||[n,e,37,39,13,38,40].indexOf(t.keyCode)!==-1)&&r.value.length>=this.options.minLength&&this._geocode(r.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(t){this.options.clearOnBlur&&this._clearOnBlur(t),this.options.collapsed&&this._collapse()},_onChange:function(){var t=this._typeahead.selected;t&&JSON.stringify(t)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(t),this.options.marker&&this._mapboxgl&&this._handleMarker(t),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(t),this._eventEmitter.emit("result",{result:t}),this.eventManager.select(t,this))},_fly:function(t){var e;if(t.properties&&YQ[t.properties.short_code])e=A0({},this.options.flyTo),this._map&&this._map.fitBounds(YQ[t.properties.short_code].bbox,e);else if(t.bbox){var n=t.bbox;e=A0({},this.options.flyTo),this._map&&this._map.fitBounds([[n[0],n[1]],[n[2],n[3]]],e)}else{var r={zoom:this.options.zoom};e=A0({},r,this.options.flyTo),t.center?e.center=t.center:t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&(e.center=t.geometry.coordinates),this._map&&this._map.flyTo(e)}},_requestType:function(t,e){var n;return t.localGeocoderOnly?n=ym.LOCAL:t.reverseGeocode&&QQ.REVERSE_GEOCODE_COORD_RGX.test(e)?n=ym.REVERSE:n=ym.FORWARD,n},_setupConfig:function(t,e){const n=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],r=/[\s,]+/;var i=this,o=n.reduce(function(s,u){if(i.options[u]===void 0||i.options[u]===null)return s;["countries","types","language"].indexOf(u)>-1?s[u]=i.options[u].split(r):s[u]=i.options[u];const d=typeof i.options[u].longitude=="number"&&typeof i.options[u].latitude=="number";if(u==="proximity"&&d){const g=i.options[u].longitude,_=i.options[u].latitude;s[u]=[g,_]}return s},{});switch(t){case ym.REVERSE:{var a=e.split(r).map(function(s){return parseFloat(s,10)});i.options.flipCoordinates||a.reverse(),o.types&&o.types[0],o=A0(o,{query:a,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(s){s in o&&delete o[s]})}break;case ym.FORWARD:{const s=e.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(s)&&(e=e.replace(/,/g," ")),o=A0(o,{query:e})}break}return o},_geocode:function(t){this.inputString=t,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:t});const e=this._requestType(this.options,t),n=this._setupConfig(e,t);var r;switch(e){case ym.LOCAL:r=Promise.resolve();break;case ym.FORWARD:r=this.geocoderService.forwardGeocode(n).send();break;case ym.REVERSE:r=this.geocoderService.reverseGeocode(n).send();break}var i=this.options.localGeocoder?this.options.localGeocoder(t)||[]:[],o=[],a=null;return r.catch((function(s){a=s}).bind(this)).then((function(s){this._hideLoadingIcon();var u={};return s?s.statusCode=="200"&&(u=s.body,u.request=s.request,u.headers=s.headers):u={type:"FeatureCollection",features:[]},u.config=n,this.fresh&&(this.eventManager.start(this),this.fresh=!1),u.features=u.features?i.concat(u.features):i,this.options.externalGeocoder?(o=this.options.externalGeocoder(t,u.features)||Promise.resolve([]),o.then(function(d){return u.features=u.features?d.concat(u.features):d,u},function(){return u})):u}).bind(this)).then((function(s){if(a)throw a;this.options.filter&&s.features.length&&(s.features=s.features.filter(this.options.filter)),s.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",s),this._typeahead.update(s.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",s))}).bind(this)).catch((function(s){this._hideLoadingIcon(),this._hideAttribution(),i.length&&this.options.localGeocoder||o.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(i)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:i}),this._eventEmitter.emit("error",{error:s})}).bind(this)),r},_clear:function(t){t&&t.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(t){this._clear(t),this._inputEl.focus()},_clearOnBlur:function(t){var e=this;t.relatedTarget&&e._clear(t)},_onQueryResult:function(t){var e=t.body;if(e.features.length){var n=e.features[0];this._typeahead.selected=n,this._inputEl.value=n.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var t=this._map.getCenter().wrap();this.setProximity({longitude:t.lng,latitude:t.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(t){return this._geocode(t).then(this._onQueryResult),this},_renderError:function(){var t="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(t)},_renderLocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(t)},_renderNoResults:function(){var t="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(t)},_renderUserDeniedGeolocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(t)},_renderMessage:function(t){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(t)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var t=this.options.language.split(",")[0],e=Vlt.language(t),n=jlt.placeholder[e];if(n)return n}return"Search"},setInput:function(t){return this._inputEl.value=t,this._typeahead.selected=null,this._typeahead.clear(),t.length>=this.options.minLength&&this._geocode(t),this},setProximity:function(t,e=!0){return this.options.proximity=t,e&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(t){return t&&typeof t=="function"&&(this._typeahead.render=t),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(t){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=t||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(t){return this.options.zoom=t,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(t){return this.options.flyTo=t,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(t){return this.placeholder=t||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(t){return this.options.bbox=t,this},getCountries:function(){return this.options.countries},setCountries:function(t){return this.options.countries=t,this},getTypes:function(){return this.options.types},setTypes:function(t){return this.options.types=t,this},getMinLength:function(){return this.options.minLength},setMinLength:function(t){return this.options.minLength=t,this._typeahead&&(this._typeahead.options.minLength=t),this},getLimit:function(){return this.options.limit},setLimit:function(t){return this.options.limit=t,this._typeahead&&(this._typeahead.options.limit=t),this},getFilter:function(){return this.options.filter},setFilter:function(t){return this.options.filter=t,this},setOrigin:function(t){return this.options.origin=t,this.geocoderService=wN(bN({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(t){return this.options.accessToken=t,this.geocoderService=wN(bN({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(t){return this.options.autocomplete=t,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(t){return this.options.fuzzyMatch=t,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(t){return this.options.routing=t,this},getRouting:function(){return this.options.routing},setWorldview:function(t){return this.options.worldview=t,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(t){if(this._map){this._removeMarker();var e={color:"#4668F2"},n=A0({},e,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(n),t.center?this.mapMarker.setLngLat(t.center).addTo(this._map):t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&this.mapMarker.setLngLat(t.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(t,e){return this._eventEmitter.on(t,e),this},off:function(t,e){return this._eventEmitter.removeListener(t,e),this.eventManager.remove(),this}};var Wlt=Nfe;const qlt=mA(Wlt);h8.accessToken="pk.eyJ1IjoicHY1NjY3IiwiYSI6ImNsZGFtOHVoejBiZ2Mzb3A2djgyaDl1OGEifQ.FSssERk7wLiG1fDpen0iXA";function Xlt(){const t=we.useRef(null),[e,n]=we.useContext(ex);return we.useEffect(()=>{const r=new qlt({accessToken:h8.accessToken,types:"country,region,place,postcode,locality,neighborhood,address,poi",placeholder:"Type in an area of interest to get started."});t.current&&r.addTo(t.current),r.on("result",i=>{n(i.result),console.log(i.result)}),r.on("clear",()=>{})},[]),Un.jsx("div",{children:Un.jsx("div",{ref:t})})}function Zlt(){const e=we.useContext(ex)[0];return console.log("SelectionInterface location: ",e),Un.jsx("div",{children:Un.jsx(Mst,{})})}function UL(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(d){try{u(r.next(d))}catch(g){o(g)}}function s(d){try{u(r.throw(d))}catch(g){o(g)}}function u(d){var g;d.done?i(d.value):(g=d.value,g instanceof n?g:new n(function(_){_(g)})).then(a,s)}u((r=r.apply(t,e||[])).next())})}function Wm(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(d){return function(g){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&g[0]?r.return:g[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,g[1])).done)return i;switch(r=0,i&&(g=[2&g[0],i.value]),g[0]){case 0:case 1:i=g;break;case 4:return a.label++,{value:g[1],done:!1};case 5:a.label++,r=g[1],g=[0];continue;case 7:g=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!((i=i.length>0&&i[i.length-1])||g[0]!==6&&g[0]!==2)){a=0;continue}if(g[0]===3&&(!i||g[1]>i[0]&&g[1]<i[3])){a.label=g[1];break}if(g[0]===6&&a.label<i[1]){a.label=i[1],i=g;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(g);break}i[2]&&a.ops.pop(),a.trys.pop();continue}g=e.call(t,a)}catch(_){g=[6,_],r=0}finally{n=i=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}([u,d])}}}function Y4(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function fh(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(e===void 0||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function Rd(t,e,n){if(n||arguments.length===2)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function KQ(t,e,n,r,i){for(var o=[],a=5;a<arguments.length;a++)o[a-5]=arguments[a];return UL(this,void 0,void 0,function(){var s,u,d,g,_,E;return Wm(this,function(P){switch(P.label){case 0:P.trys.push([0,12,13,14]),s=Y4(o),u=s.next(),P.label=1;case 1:if(u.done)return[3,11];switch(d=u.value,typeof d){case"string":return[3,2];case"number":return[3,4];case"function":return[3,6]}return[3,8];case 2:return[4,Ylt(t,e,d,n,r,i)];case 3:return P.sent(),[3,10];case 4:return[4,Ffe(d)];case 5:return P.sent(),[3,10];case 6:return[4,d.apply(void 0,Rd([t,e,n,r,i],fh(o),!1))];case 7:return P.sent(),[3,10];case 8:return[4,d];case 9:P.sent(),P.label=10;case 10:return u=s.next(),[3,1];case 11:return[3,14];case 12:return g=P.sent(),_={error:g},[3,14];case 13:try{u&&!u.done&&(E=s.return)&&E.call(s)}finally{if(_)throw _.error}return[7];case 14:return[2]}})})}function Ylt(t,e,n,r,i,o){return UL(this,void 0,void 0,function(){var a,s;return Wm(this,function(u){switch(u.label){case 0:return a=t.textContent||"",s=function(d,g){var _=fh(g).slice(0);return Rd(Rd([],fh(d),!1),[NaN],!1).findIndex(function(E,P){return _[P]!==E})}(a,n),[4,Qlt(t,Rd(Rd([],fh(Jlt(a,e,s)),!1),fh(Klt(n,e,s)),!1),r,i,o)];case 1:return u.sent(),[2]}})})}function Ffe(t){return UL(this,void 0,void 0,function(){return Wm(this,function(e){switch(e.label){case 0:return[4,new Promise(function(n){return setTimeout(n,t)})];case 1:return e.sent(),[2]}})})}function Qlt(t,e,n,r,i){return UL(this,void 0,void 0,function(){var o,a,s,u,d,g,_,E,P,R,B,V,z;return Wm(this,function(F){switch(F.label){case 0:if(o=e,i){for(a=0,s=1;s<e.length;s++)if(u=fh([e[s-1],e[s]],2),d=u[0],(g=u[1]).length>d.length||g===""){a=s;break}o=e.slice(a,e.length)}F.label=1;case 1:F.trys.push([1,6,7,8]),_=Y4(function(k){var X,Y,J,ie,ce,re,ue;return Wm(this,function(se){switch(se.label){case 0:X=function(me){return Wm(this,function(Ce){switch(Ce.label){case 0:return[4,{op:function(be){return requestAnimationFrame(function(){return be.textContent=me})},opCode:function(be){var Ye=be.textContent||"";return me===""||Ye.length>me.length?"DELETE":"WRITING"}}];case 1:return Ce.sent(),[2]}})},se.label=1;case 1:se.trys.push([1,6,7,8]),Y=Y4(k),J=Y.next(),se.label=2;case 2:return J.done?[3,5]:(ie=J.value,[5,X(ie)]);case 3:se.sent(),se.label=4;case 4:return J=Y.next(),[3,2];case 5:return[3,8];case 6:return ce=se.sent(),re={error:ce},[3,8];case 7:try{J&&!J.done&&(ue=Y.return)&&ue.call(Y)}finally{if(re)throw re.error}return[7];case 8:return[2]}})}(o)),E=_.next(),F.label=2;case 2:return E.done?[3,5]:(P=E.value,R=P.opCode(t)==="WRITING"?n+n*(Math.random()-.5):r+r*(Math.random()-.5),P.op(t),[4,Ffe(R)]);case 3:F.sent(),F.label=4;case 4:return E=_.next(),[3,2];case 5:return[3,8];case 6:return B=F.sent(),V={error:B},[3,8];case 7:try{E&&!E.done&&(z=_.return)&&z.call(_)}finally{if(V)throw V.error}return[7];case 8:return[2]}})})}function Klt(t,e,n){var r,i;return n===void 0&&(n=0),Wm(this,function(o){switch(o.label){case 0:r=e(t),i=r.length,o.label=1;case 1:return n<i?[4,r.slice(0,++n).join("")]:[3,3];case 2:return o.sent(),[3,1];case 3:return[2]}})}function Jlt(t,e,n){var r,i;return n===void 0&&(n=0),Wm(this,function(o){switch(o.label){case 0:r=e(t),i=r.length,o.label=1;case 1:return i>n?[4,r.slice(0,--i).join("")]:[3,3];case 2:return o.sent(),[3,1];case 3:return[2]}})}var eut="index-module_type__E-SaG";(function(t,e){e===void 0&&(e={});var n=e.insertAt;if(t&&typeof document<"u"){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",n==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}})(`.index-module_type__E-SaG::after {
  content: '|';
  animation: index-module_cursor__PQg0P 1.1s infinite step-start;
}

@keyframes index-module_cursor__PQg0P {
  50% {
    opacity: 0;
  }
}
`);we.memo(we.forwardRef(function(t,e){var n=t.sequence,r=t.repeat,i=t.className,o=t.speed,a=o===void 0?40:o,s=t.deletionSpeed,u=t.omitDeletionAnimation,d=u!==void 0&&u,g=t.preRenderFirstString,_=g!==void 0&&g,E=t.wrapper,P=E===void 0?"span":E,R=t.splitter,B=R===void 0?function(Be){return Rd([],fh(Be),!1)}:R,V=t.cursor,z=V===void 0||V,F=t.style,k=function(Be,qe){var ct={};for(var Ct in Be)Object.prototype.hasOwnProperty.call(Be,Ct)&&qe.indexOf(Ct)<0&&(ct[Ct]=Be[Ct]);if(Be!=null&&typeof Object.getOwnPropertySymbols=="function"){var Dt=0;for(Ct=Object.getOwnPropertySymbols(Be);Dt<Ct.length;Dt++)qe.indexOf(Ct[Dt])<0&&Object.prototype.propertyIsEnumerable.call(Be,Ct[Dt])&&(ct[Ct[Dt]]=Be[Ct[Dt]])}return ct}(t,["sequence","repeat","className","speed","deletionSpeed","omitDeletionAnimation","preRenderFirstString","wrapper","splitter","cursor","style"]),X=k["aria-label"],Y=k["aria-hidden"],J=k.role;s||(s=a);var ie=new Array(2).fill(40);[a,s].forEach(function(Be,qe){switch(typeof Be){case"number":ie[qe]=Math.abs(Be-100);break;case"object":var ct=Be.type,Ct=Be.value;if(typeof Ct!="number")break;ct==="keyStrokeDelayInMs"&&(ie[qe]=Ct)}});var ce,re,ue,se,me,Ce,be=ie[0],Ye=ie[1],tt=function(Be,qe){qe===void 0&&(qe=null);var ct=we.useRef(qe);return we.useEffect(function(){Be&&(typeof Be=="function"?Be(ct.current):Be.current=ct.current)},[Be]),ct}(e),pt=eut;ce=i?"".concat(z?pt+" ":"").concat(i):z?pt:"",re=we.useRef(function(){var Be,qe=n;r===1/0?Be=KQ:typeof r=="number"&&(qe=Array(1+r).fill(n).flat());var ct=Be?Rd(Rd([],fh(qe),!1),[Be],!1):Rd([],fh(qe),!1);return KQ.apply(void 0,Rd([tt.current,B,be,Ye,d],fh(ct),!1)),function(){tt.current}}),ue=we.useRef(),se=we.useRef(!1),me=we.useRef(!1),Ce=fh(we.useState(0),2)[1],se.current&&(me.current=!0),we.useEffect(function(){return se.current||(ue.current=re.current(),se.current=!0),Ce(function(Be){return Be+1}),function(){me.current&&ue.current&&ue.current()}},[]);var Ee=P,Ne=_?n.find(function(Be){return typeof Be=="string"})||"":null;return ut.createElement(Ee,{"aria-hidden":Y,"aria-label":X,role:J,style:F,className:ce,children:X?ut.createElement("span",{"aria-hidden":"true",ref:tt,children:Ne}):Ne,ref:X?void 0:tt})}),function(t,e){return!0});function tut(){return Un.jsxs("div",{children:[Un.jsx("nav",{class:"rounded-xl px-4 lg:px-6 py-8",children:Un.jsx("a",{href:"/",children:Un.jsx(bce,{fit:"contain",height:60,src:"./SolarSense_Logo.png"})})}),Un.jsx("div",{class:"mx-auto max-w-2xl py-6 pt-2 space-y-4",children:Un.jsx(Nh,{style:{fontWeight:"bold",fontSize:"45px",display:"inline-block",color:"#e8caf1"},children:"Unlock Solar Panel Insights with Geospatial AI"})})]})}function JQ({file:t}){return Un.jsx(l8,{inline:!0,sx:e=>({fontSize:e.fontSizes.sm,borderRadius:e.radius.sm,color:e.colors.gray[1]}),children:Un.jsx("span",{style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",maxWidth:pn(200),display:"inline-block"},children:t.name})})}const nut=({value:t})=>Array.isArray(t)?Un.jsx(Group,{spacing:"sm",py:"xs",children:t.map((e,n)=>Un.jsx(JQ,{file:e},n))}):Un.jsx(JQ,{file:t});function rut(){const[t,e]=we.useContext(ex),[n,r]=we.useContext(FL),i=o=>{const a=new FileReader;a.onload=s=>{const u=JSON.parse(s.target.result),d={units:"kilometers",mask:u};r(Kce(z0(M6(u,.06)),.12,d));const g=tR(u.features[0].geometry);u.center=g.geometry.coordinates,e(u),console.log("Uploaded Location: ",u)},a.readAsText(o)};return Un.jsx(l8,{children:Un.jsx("div",{class:"text-white hover:outline-blue-400 focus:outline-none focus:ring focus:ring-violet-300",children:Un.jsx(Qrt,{sx:{color:"white"},placeholder:"Upload GeoJSON",onChange:i,icon:Un.jsx(Pst,{size:pn(20),style:{color:"white"}}),accept:".geojson,application/json",valueComponent:nut})})})}function iut(){return we.useContext(ex),we.useContext(FL),Un.jsx("div",{class:"max-w-2xl mx-auto pb-8",children:Un.jsxs(c8,{children:[Un.jsx(U4,{theme:{colorScheme:"dark"},children:Un.jsxs(Vp,{shadow:"md",closeDelay:250,children:[Un.jsx(Vp.Target,{children:Un.jsx("div",{class:"p-6 hover:outline-blue-400",children:Un.jsx(Xlt,{})})}),Un.jsx(Vp.Dropdown,{children:Un.jsx(Nh,{size:"sm",children:'Then draw an area to be analyzed on the map and click "Submit Selection"!'})})]})}),Un.jsx(Fle,{size:"lg",my:"xs",label:"OR",labelPosition:"center"}),Un.jsxs(Vp,{shadow:"md",closeDelay:250,children:[Un.jsx(Vp.Target,{children:Un.jsx("div",{children:Un.jsx(rut,{})})}),Un.jsx(U4,{theme:{colorScheme:"dark"},children:Un.jsx(Vp.Dropdown,{children:Un.jsx(Nh,{size:"sm",children:'Then click "Submit Selection"!'})})})]})]})})}var out="@vercel/analytics",sut="1.1.1",aut=()=>{window.va||(window.va=function(...e){(window.vaq=window.vaq||[]).push(e)})};function kfe(){return typeof window<"u"}function zfe(){try{const t="production"}catch{}return"production"}function lut(t="auto"){if(t==="auto"){window.vam=zfe();return}window.vam=t}function uut(){return(kfe()?window.vam:zfe())||"production"}function EN(){return uut()==="development"}function cut(t={debug:!0}){var e;if(!kfe())return;lut(t.mode),aut(),t.beforeSend&&((e=window.va)==null||e.call(window,"beforeSend",t.beforeSend));const n=EN()?"https://va.vercel-scripts.com/v1/script.debug.js":"/_vercel/insights/script.js";if(document.head.querySelector(`script[src*="${n}"]`))return;const r=document.createElement("script");r.src=n,r.defer=!0,r.setAttribute("data-sdkn",out),r.setAttribute("data-sdkv",sut),r.onerror=()=>{const i=EN()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${n}. ${i}`)},EN()&&t.debug===!1&&r.setAttribute("data-debug","false"),document.head.appendChild(r)}function fut({beforeSend:t,debug:e=!0,mode:n="auto"}){return we.useEffect(()=>{cut({beforeSend:t,debug:e,mode:n})},[t,e,n]),null}function hut(){return Un.jsx("div",{className:"App",children:Un.jsx(xst,{children:Un.jsxs(vst,{children:[Un.jsx(fut,{}),Un.jsx(tut,{}),Un.jsx(iut,{}),Un.jsx(Zlt,{})]})})})}SN.createRoot(document.getElementById("root")).render(Un.jsx(hut,{}));
