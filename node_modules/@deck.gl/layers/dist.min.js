(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === 'object' && typeof module === 'object')
    module.exports = factory();
  else if (typeof define === 'function' && define.amd) define([], factory);
        else if (typeof exports === 'object') exports['deck'] = factory();
  else root['deck'] = factory();})(globalThis, function () {
"use strict";var __exports__=(()=>{var da=Object.create;var Mt=Object.defineProperty;var ga=Object.getOwnPropertyDescriptor;var ha=Object.getOwnPropertyNames;var ma=Object.getPrototypeOf,ya=Object.prototype.hasOwnProperty;var Ct=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),xa=(e,r)=>{for(var t in r)Mt(e,t,{get:r[t],enumerable:!0})},St=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of ha(r))!ya.call(e,i)&&i!==t&&Mt(e,i,{get:()=>r[i],enumerable:!(n=ga(r,i))||n.enumerable});return e},de=(e,r,t)=>(St(e,r,"default"),t&&St(t,r,"default")),R=(e,r,t)=>(t=e!=null?da(ma(e)):{},St(r||!e||!e.__esModule?Mt(t,"default",{value:e,enumerable:!0}):t,e)),Pa=e=>St(Mt({},"__esModule",{value:!0}),e);var G=Ct((Kl,an)=>{an.exports=globalThis.deck});var K=Ct((vc,cn)=>{cn.exports=globalThis.luma});var Wn=Ct((Fu,Nn)=>{Nn.exports=globalThis.loaders});var qi=Ct((cd,Kr)=>{"use strict";Kr.exports=tr;Kr.exports.default=tr;function tr(e,r,t){t=t||2;var n=r&&r.length,i=n?r[0]*t:e.length,o=Ki(e,0,i,t,!0),a=[];if(!o||o.next===o.prev)return a;var s,l,c,f,u,p,v;if(n&&(o=Ns(e,r,o,t)),e.length>80*t){s=c=e[0],l=f=e[1];for(var d=t;d<i;d+=t)u=e[d],p=e[d+1],u<s&&(s=u),p<l&&(l=p),u>c&&(c=u),p>f&&(f=p);v=Math.max(c-s,f-l),v=v!==0?32767/v:0}return vt(o,a,t,s,l,v,0),a}function Ki(e,r,t,n,i){var o,a;if(i===Yr(e,r,t,n)>0)for(o=r;o<t;o+=n)a=Yi(o,e[o],e[o+1],a);else for(o=t-n;o>=r;o-=n)a=Yi(o,e[o],e[o+1],a);return a&&rr(a,a.next)&&(gt(a),a=a.next),a}function Ae(e,r){if(!e)return e;r||(r=e);var t=e,n;do if(n=!1,!t.steiner&&(rr(t,t.next)||V(t.prev,t,t.next)===0)){if(gt(t),t=r=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==r);return r}function vt(e,r,t,n,i,o,a){if(e){!a&&o&&Zs(e,n,i,o);for(var s=e,l,c;e.prev!==e.next;){if(l=e.prev,c=e.next,o?ks(e,n,i,o):Fs(e)){r.push(l.i/t|0),r.push(e.i/t|0),r.push(c.i/t|0),gt(e),e=c.next,s=c.next;continue}if(e=c,e===s){a?a===1?(e=Ds(Ae(e),r,t),vt(e,r,t,n,i,o,2)):a===2&&js(e,r,t,n,i,o):vt(Ae(e),r,t,n,i,o,1);break}}}}function Fs(e){var r=e.prev,t=e,n=e.next;if(V(r,t,n)>=0)return!1;for(var i=r.x,o=t.x,a=n.x,s=r.y,l=t.y,c=n.y,f=i<o?i<a?i:a:o<a?o:a,u=s<l?s<c?s:c:l<c?l:c,p=i>o?i>a?i:a:o>a?o:a,v=s>l?s>c?s:c:l>c?l:c,d=n.next;d!==r;){if(d.x>=f&&d.x<=p&&d.y>=u&&d.y<=v&&Ge(i,s,o,l,a,c,d.x,d.y)&&V(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function ks(e,r,t,n){var i=e.prev,o=e,a=e.next;if(V(i,o,a)>=0)return!1;for(var s=i.x,l=o.x,c=a.x,f=i.y,u=o.y,p=a.y,v=s<l?s<c?s:c:l<c?l:c,d=f<u?f<p?f:p:u<p?u:p,h=s>l?s>c?s:c:l>c?l:c,y=f>u?f>p?f:p:u>p?u:p,x=Hr(v,d,r,t,n),S=Hr(h,y,r,t,n),g=e.prevZ,P=e.nextZ;g&&g.z>=x&&P&&P.z<=S;){if(g.x>=v&&g.x<=h&&g.y>=d&&g.y<=y&&g!==i&&g!==a&&Ge(s,f,l,u,c,p,g.x,g.y)&&V(g.prev,g,g.next)>=0||(g=g.prevZ,P.x>=v&&P.x<=h&&P.y>=d&&P.y<=y&&P!==i&&P!==a&&Ge(s,f,l,u,c,p,P.x,P.y)&&V(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;g&&g.z>=x;){if(g.x>=v&&g.x<=h&&g.y>=d&&g.y<=y&&g!==i&&g!==a&&Ge(s,f,l,u,c,p,g.x,g.y)&&V(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;P&&P.z<=S;){if(P.x>=v&&P.x<=h&&P.y>=d&&P.y<=y&&P!==i&&P!==a&&Ge(s,f,l,u,c,p,P.x,P.y)&&V(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function Ds(e,r,t){var n=e;do{var i=n.prev,o=n.next.next;!rr(i,o)&&Xi(i,n,n.next,o)&&dt(i,o)&&dt(o,i)&&(r.push(i.i/t|0),r.push(n.i/t|0),r.push(o.i/t|0),gt(n),gt(n.next),n=e=o),n=n.next}while(n!==e);return Ae(n)}function js(e,r,t,n,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&$s(a,s)){var l=Ji(a,s);a=Ae(a,a.next),l=Ae(l,l.next),vt(a,r,t,n,i,o,0),vt(l,r,t,n,i,o,0);return}s=s.next}a=a.next}while(a!==e)}function Ns(e,r,t,n){var i=[],o,a,s,l,c;for(o=0,a=r.length;o<a;o++)s=r[o]*n,l=o<a-1?r[o+1]*n:e.length,c=Ki(e,s,l,n,!1),c===c.next&&(c.steiner=!0),i.push(Hs(c));for(i.sort(Ws),o=0;o<i.length;o++)t=Us(i[o],t);return t}function Ws(e,r){return e.x-r.x}function Us(e,r){var t=Bs(e,r);if(!t)return r;var n=Ji(t,e);return Ae(n,n.next),Ae(t,t.next)}function Bs(e,r){var t=r,n=e.x,i=e.y,o=-1/0,a;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var s=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(s<=n&&s>o&&(o=s,a=t.x<t.next.x?t:t.next,s===n))return a}t=t.next}while(t!==r);if(!a)return null;var l=a,c=a.x,f=a.y,u=1/0,p;t=a;do n>=t.x&&t.x>=c&&n!==t.x&&Ge(i<f?n:o,i,c,f,i<f?o:n,i,t.x,t.y)&&(p=Math.abs(i-t.y)/(n-t.x),dt(t,e)&&(p<u||p===u&&(t.x>a.x||t.x===a.x&&Gs(a,t)))&&(a=t,u=p)),t=t.next;while(t!==l);return a}function Gs(e,r){return V(e.prev,e,r.prev)<0&&V(r.next,e,e.next)<0}function Zs(e,r,t,n){var i=e;do i.z===0&&(i.z=Hr(i.x,i.y,r,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,Vs(i)}function Vs(e){var r,t,n,i,o,a,s,l,c=1;do{for(t=e,e=null,o=null,a=0;t;){for(a++,n=t,s=0,r=0;r<c&&(s++,n=n.nextZ,!!n);r++);for(l=c;s>0||l>0&&n;)s!==0&&(l===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,s--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;t=n}o.nextZ=null,c*=2}while(a>1);return e}function Hr(e,r,t,n,i){return e=(e-t)*i|0,r=(r-n)*i|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e|r<<1}function Hs(e){var r=e,t=e;do(r.x<t.x||r.x===t.x&&r.y<t.y)&&(t=r),r=r.next;while(r!==e);return t}function Ge(e,r,t,n,i,o,a,s){return(i-a)*(r-s)>=(e-a)*(o-s)&&(e-a)*(n-s)>=(t-a)*(r-s)&&(t-a)*(o-s)>=(i-a)*(n-s)}function $s(e,r){return e.next.i!==r.i&&e.prev.i!==r.i&&!Ys(e,r)&&(dt(e,r)&&dt(r,e)&&Ks(e,r)&&(V(e.prev,e,r.prev)||V(e,r.prev,r))||rr(e,r)&&V(e.prev,e,e.next)>0&&V(r.prev,r,r.next)>0)}function V(e,r,t){return(r.y-e.y)*(t.x-r.x)-(r.x-e.x)*(t.y-r.y)}function rr(e,r){return e.x===r.x&&e.y===r.y}function Xi(e,r,t,n){var i=er(V(e,r,t)),o=er(V(e,r,n)),a=er(V(t,n,e)),s=er(V(t,n,r));return!!(i!==o&&a!==s||i===0&&Qt(e,t,r)||o===0&&Qt(e,n,r)||a===0&&Qt(t,e,n)||s===0&&Qt(t,r,n))}function Qt(e,r,t){return r.x<=Math.max(e.x,t.x)&&r.x>=Math.min(e.x,t.x)&&r.y<=Math.max(e.y,t.y)&&r.y>=Math.min(e.y,t.y)}function er(e){return e>0?1:e<0?-1:0}function Ys(e,r){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==r.i&&t.next.i!==r.i&&Xi(t,t.next,e,r))return!0;t=t.next}while(t!==e);return!1}function dt(e,r){return V(e.prev,e,e.next)<0?V(e,r,e.next)>=0&&V(e,e.prev,r)>=0:V(e,r,e.prev)<0||V(e,e.next,r)<0}function Ks(e,r){var t=e,n=!1,i=(e.x+r.x)/2,o=(e.y+r.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&i<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==e);return n}function Ji(e,r){var t=new $r(e.i,e.x,e.y),n=new $r(r.i,r.x,r.y),i=e.next,o=r.prev;return e.next=r,r.prev=e,t.next=i,i.prev=t,n.next=t,t.prev=n,o.next=n,n.prev=o,n}function Yi(e,r,t,n){var i=new $r(e,r,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function gt(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function $r(e,r,t){this.i=e,this.x=r,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}tr.deviation=function(e,r,t,n){var i=r&&r.length,o=i?r[0]*t:e.length,a=Math.abs(Yr(e,0,o,t));if(i)for(var s=0,l=r.length;s<l;s++){var c=r[s]*t,f=s<l-1?r[s+1]*t:e.length;a-=Math.abs(Yr(e,c,f,t))}var u=0;for(s=0;s<n.length;s+=3){var p=n[s]*t,v=n[s+1]*t,d=n[s+2]*t;u+=Math.abs((e[p]-e[d])*(e[v+1]-e[p+1])-(e[p]-e[v])*(e[d+1]-e[p+1]))}return a===0&&u===0?0:Math.abs((u-a)/a)};function Yr(e,r,t,n){for(var i=0,o=r,a=t-n;o<t;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}tr.flatten=function(e){for(var r=e[0][0].length,t={vertices:[],holes:[],dimensions:r},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<r;a++)t.vertices.push(e[i][o][a]);i>0&&(n+=e[i-1].length,t.holes.push(n))}return t}});var Pt={};xa(Pt,{ArcLayer:()=>Ot,BitmapLayer:()=>Nt,ColumnLayer:()=>Be,GeoJsonLayer:()=>mr,GridCellLayer:()=>Jt,IconLayer:()=>me,LineLayer:()=>Gt,PathLayer:()=>Me,PointCloudLayer:()=>Vt,PolygonLayer:()=>cr,ScatterplotLayer:()=>We,SolidPolygonLayer:()=>we,TextLayer:()=>Xe,_MultiIconLayer:()=>$e,_TextBackgroundLayer:()=>Ye});var ie={},sn=R(G());de(ie,R(G()));if(!sn.Layer)throw new Error("@deck.gl/core is not found");de(Pt,ie);function L(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function ln(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function A(e,r,t){return r&&ln(e.prototype,r),t&&ln(e,t),e}function H(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e){return C=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},C(e)}function Mr(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&(e=C(e),e!==null););return e}function O(e,r,t){return typeof Reflect<"u"&&Reflect.get?O=Reflect.get:O=function(i,o,a){var s=Mr(i,o);if(s){var l=Object.getOwnPropertyDescriptor(s,o);return l.get?l.get.call(a):l.value}},O(e,r,t||e)}function Qe(e,r){return Qe=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},Qe(e,r)}function z(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&Qe(e,r)}function Le(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Le=function(t){return typeof t}:Le=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Le(e)}function F(e,r){if(r&&(Le(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return H(e)}function m(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var ge=R(G()),bt=R(K());var fn=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  
    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  
  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(curr, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var un=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function pn(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function vn(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?pn(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):pn(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function _a(e){var r=Sa();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function Sa(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var wt=[0,0,0,255],Ma={getSourcePosition:{type:"accessor",value:function(r){return r.sourcePosition}},getTargetPosition:{type:"accessor",value:function(r){return r.targetPosition}},getSourceColor:{type:"accessor",value:wt},getTargetColor:{type:"accessor",value:wt},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},Ot=function(e){z(t,e);var r=_a(t);function t(){var n;L(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),m(H(n),"state",void 0),n}return A(t,[{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["instanceSourcePositions","instanceTargetPositions"])}},{key:"getShaders",value:function(){return O(C(t.prototype),"getShaders",this).call(this,{vs:fn,fs:un,modules:[ge.project32,ge.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:wt},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:wt},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}},{key:"updateState",value:function(i){O(C(t.prototype),"updateState",this).call(this,i);var o=i.props,a=i.oldProps,s=i.changeFlags;if(s.extensionsChanged||s.propsChanged&&o.numSegments!==a.numSegments){var l,c=this.context.gl;(l=this.state.model)===null||l===void 0||l.delete(),this.state.model=this._getModel(c),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.widthUnits,l=a.widthScale,c=a.widthMinPixels,f=a.widthMaxPixels,u=a.greatCircle,p=a.wrapLongitude;this.state.model.setUniforms(o).setUniforms({greatCircle:u,widthUnits:ge.UNIT[s],widthScale:l,widthMinPixels:c,widthMaxPixels:f,useShortestPath:p}).draw()}},{key:"_getModel",value:function(i){for(var o=this.props,a=o.id,s=o.numSegments,l=[],c=0;c<s;c++)l=l.concat([c,1,0,c,-1,0]);var f=new bt.Model(i,vn(vn({},this.getShaders()),{},{id:a,geometry:new bt.Geometry({drawMode:5,attributes:{positions:new Float32Array(l)}}),isInstanced:!0}));return f.setUniforms({numSegments:s}),f}}]),t}(ge.Layer);m(Ot,"layerName","ArcLayer");m(Ot,"defaultProps",Ma);function Cr(e){if(Array.isArray(e))return e}function wr(e,r){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,o=!1,a,s;try{for(t=t.call(e);!(i=(a=t.next()).done)&&(n.push(a.value),!(r&&n.length===r));i=!0);}catch(l){o=!0,s=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(o)throw s}}return n}}function Te(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function et(e,r){if(e){if(typeof e=="string")return Te(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Te(e,r)}}function br(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Z(e,r){return Cr(e)||wr(e,r)||et(e,r)||br()}var ne=R(G()),jt=R(K());function Or(e){if(Array.isArray(e))return Te(e)}function Lr(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Ar(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ee(e){return Or(e)||Lr(e)||et(e)||Ar()}var Y=1e-6,oe=typeof Float32Array<"u"?Float32Array:Array;var $c=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function Ca(){var e=new oe(4);return oe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function gn(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function hn(e,r,t){var n=r[0],i=r[1],o=r[2],a=r[3];return e[0]=t[0]*n+t[4]*i+t[8]*o+t[12]*a,e[1]=t[1]*n+t[5]*i+t[9]*o+t[13]*a,e[2]=t[2]*n+t[6]*i+t[10]*o+t[14]*a,e[3]=t[3]*n+t[7]*i+t[11]*o+t[15]*a,e}var Yc=function(){var e=Ca();return function(r,t,n,i,o,a){var s,l;for(t||(t=4),n||(n=0),i?l=Math.min(i*t+n,r.length):l=r.length,s=n;s<l;s+=t)e[0]=r[s],e[1]=r[s+1],e[2]=r[s+2],e[3]=r[s+3],o(e,e,a),r[s]=e[0],r[s+1]=e[1],r[s+2]=e[2],r[s+3]=e[3];return r}}();function Re(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function he(e,r){var t=hn([],r,e);return gn(t,t,1/t[3]),t}function tt(e,r,t){return e<r?r:e>t?t:e}function wa(e){return Math.log(e)*Math.LOG2E}var At=Math.log2||wa;function mn(e,r){var t=r[0],n=r[1],i=r[2],o=r[3],a=r[4],s=r[5],l=r[6],c=r[7],f=r[8],u=r[9],p=r[10],v=r[11],d=r[12],h=r[13],y=r[14],x=r[15],S=t*s-n*a,g=t*l-i*a,P=t*c-o*a,_=n*l-i*s,M=n*c-o*s,w=i*c-o*l,b=f*h-u*d,T=f*y-p*d,D=f*x-v*d,k=u*y-p*h,E=u*x-v*h,j=p*x-v*y,I=S*j-g*E+P*k+_*D-M*T+w*b;return I?(I=1/I,e[0]=(s*j-l*E+c*k)*I,e[1]=(i*E-n*j-o*k)*I,e[2]=(h*w-y*M+x*_)*I,e[3]=(p*M-u*w-v*_)*I,e[4]=(l*D-a*j-c*T)*I,e[5]=(t*j-i*D+o*T)*I,e[6]=(y*P-d*w-x*g)*I,e[7]=(f*w-p*P+v*g)*I,e[8]=(a*E-s*D+c*b)*I,e[9]=(n*D-t*E-o*b)*I,e[10]=(d*M-h*P+x*S)*I,e[11]=(u*P-f*M-v*S)*I,e[12]=(s*T-a*k-l*b)*I,e[13]=(t*k-n*T+i*b)*I,e[14]=(h*g-d*_-y*S)*I,e[15]=(f*_-u*g+p*S)*I,e):null}function It(e,r,t){var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],f=r[7],u=r[8],p=r[9],v=r[10],d=r[11],h=r[12],y=r[13],x=r[14],S=r[15],g=t[0],P=t[1],_=t[2],M=t[3];return e[0]=g*n+P*s+_*u+M*h,e[1]=g*i+P*l+_*p+M*y,e[2]=g*o+P*c+_*v+M*x,e[3]=g*a+P*f+_*d+M*S,g=t[4],P=t[5],_=t[6],M=t[7],e[4]=g*n+P*s+_*u+M*h,e[5]=g*i+P*l+_*p+M*y,e[6]=g*o+P*c+_*v+M*x,e[7]=g*a+P*f+_*d+M*S,g=t[8],P=t[9],_=t[10],M=t[11],e[8]=g*n+P*s+_*u+M*h,e[9]=g*i+P*l+_*p+M*y,e[10]=g*o+P*c+_*v+M*x,e[11]=g*a+P*f+_*d+M*S,g=t[12],P=t[13],_=t[14],M=t[15],e[12]=g*n+P*s+_*u+M*h,e[13]=g*i+P*l+_*p+M*y,e[14]=g*o+P*c+_*v+M*x,e[15]=g*a+P*f+_*d+M*S,e}function rt(e,r,t){var n=t[0],i=t[1],o=t[2],a,s,l,c,f,u,p,v,d,h,y,x;return r===e?(e[12]=r[0]*n+r[4]*i+r[8]*o+r[12],e[13]=r[1]*n+r[5]*i+r[9]*o+r[13],e[14]=r[2]*n+r[6]*i+r[10]*o+r[14],e[15]=r[3]*n+r[7]*i+r[11]*o+r[15]):(a=r[0],s=r[1],l=r[2],c=r[3],f=r[4],u=r[5],p=r[6],v=r[7],d=r[8],h=r[9],y=r[10],x=r[11],e[0]=a,e[1]=s,e[2]=l,e[3]=c,e[4]=f,e[5]=u,e[6]=p,e[7]=v,e[8]=d,e[9]=h,e[10]=y,e[11]=x,e[12]=a*n+f*i+d*o+r[12],e[13]=s*n+u*i+h*o+r[13],e[14]=l*n+p*i+y*o+r[14],e[15]=c*n+v*i+x*o+r[15]),e}function Tt(e,r,t){var n=t[0],i=t[1],o=t[2];return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=r[7]*i,e[8]=r[8]*o,e[9]=r[9]*o,e[10]=r[10]*o,e[11]=r[11]*o,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function yn(e,r,t){var n=Math.sin(t),i=Math.cos(t),o=r[4],a=r[5],s=r[6],l=r[7],c=r[8],f=r[9],u=r[10],p=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=o*i+c*n,e[5]=a*i+f*n,e[6]=s*i+u*n,e[7]=l*i+p*n,e[8]=c*i-o*n,e[9]=f*i-a*n,e[10]=u*i-s*n,e[11]=p*i-l*n,e}function xn(e,r,t){var n=Math.sin(t),i=Math.cos(t),o=r[0],a=r[1],s=r[2],l=r[3],c=r[4],f=r[5],u=r[6],p=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=o*i+c*n,e[1]=a*i+f*n,e[2]=s*i+u*n,e[3]=l*i+p*n,e[4]=c*i-o*n,e[5]=f*i-a*n,e[6]=u*i-s*n,e[7]=p*i-l*n,e}function ba(e,r,t,n,i){var o=1/Math.tan(r/2),a;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(a=1/(n-i),e[10]=(i+n)*a,e[14]=2*i*n*a):(e[10]=-1,e[14]=-2*n),e}var Pn=ba;function Ir(e,r){var t=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],f=e[8],u=e[9],p=e[10],v=e[11],d=e[12],h=e[13],y=e[14],x=e[15],S=r[0],g=r[1],P=r[2],_=r[3],M=r[4],w=r[5],b=r[6],T=r[7],D=r[8],k=r[9],E=r[10],j=r[11],I=r[12],W=r[13],$=r[14],B=r[15];return Math.abs(t-S)<=Y*Math.max(1,Math.abs(t),Math.abs(S))&&Math.abs(n-g)<=Y*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(i-P)<=Y*Math.max(1,Math.abs(i),Math.abs(P))&&Math.abs(o-_)<=Y*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-M)<=Y*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(s-w)<=Y*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(l-b)<=Y*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-T)<=Y*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(f-D)<=Y*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(u-k)<=Y*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(p-E)<=Y*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(v-j)<=Y*Math.max(1,Math.abs(v),Math.abs(j))&&Math.abs(d-I)<=Y*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(h-W)<=Y*Math.max(1,Math.abs(h),Math.abs(W))&&Math.abs(y-$)<=Y*Math.max(1,Math.abs(y),Math.abs($))&&Math.abs(x-B)<=Y*Math.max(1,Math.abs(x),Math.abs(B))}function Oa(){var e=new oe(2);return oe!=Float32Array&&(e[0]=0,e[1]=0),e}function Tr(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e}function Sn(e,r){return e[0]=-r[0],e[1]=-r[1],e}function Et(e,r,t,n){var i=r[0],o=r[1];return e[0]=i+n*(t[0]-i),e[1]=o+n*(t[1]-o),e}var qc=function(){var e=Oa();return function(r,t,n,i,o,a){var s,l;for(t||(t=2),n||(n=0),i?l=Math.min(i*t+n,r.length):l=r.length,s=n;s<l;s+=t)e[0]=r[s],e[1]=r[s+1],o(e,e,a),r[s]=e[0],r[s+1]=e[1];return r}}();function La(){var e=new oe(3);return oe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Mn(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function Aa(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e}function Cn(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}var wn=Aa;var Qc=function(){var e=La();return function(r,t,n,i,o,a){var s,l;for(t||(t=3),n||(n=0),i?l=Math.min(i*t+n,r.length):l=r.length,s=n;s<l;s+=t)e[0]=r[s],e[1]=r[s+1],e[2]=r[s+2],o(e,e,a),r[s]=e[0],r[s+1]=e[1],r[s+2]=e[2];return r}}();function ee(e,r){if(!e)throw new Error(r||"@math.gl/web-mercator: assertion failed.")}var te=Math.PI,Ln=te/4,ae=te/180,Rr=180/te,nt=512,On=4003e4,Fe=85.051129,zr=1.5;function Rt(e){return Math.pow(2,e)}function J(e){var r=Z(e,2),t=r[0],n=r[1];ee(Number.isFinite(t)),ee(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var i=t*ae,o=n*ae,a=nt*(i+te)/(2*te),s=nt*(te+Math.log(Math.tan(Ln+o*.5)))/(2*te);return[a,s]}function re(e){var r=Z(e,2),t=r[0],n=r[1],i=t/nt*(2*te)-te,o=2*(Math.atan(Math.exp(n/nt*(2*te)-te))-Ln);return[i*Rr,o*Rr]}function Fr(e){var r=e.latitude,t=e.longitude,n=e.highPrecision,i=n===void 0?!1:n;ee(Number.isFinite(r)&&Number.isFinite(t));var o=nt,a=Math.cos(r*ae),s=o/360,l=s/a,c=o/On/a,f={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[s,l,c],degreesPerUnit:[1/s,1/l,1/c]};if(i){var u=ae*Math.tan(r*ae)/a,p=s*u/2,v=o/On*u,d=v/l*c;f.unitsPerDegree2=[0,p,v],f.unitsPerMeter2=[d,0,d]}return f}function kr(e){var r=e.height,t=e.pitch,n=e.bearing,i=e.altitude,o=e.scale,a=e.center,s=Re();rt(s,s,[0,0,-i]),yn(s,s,-t*ae),xn(s,s,n*ae);var l=o/r;return Tt(s,s,[l,l,l]),a&&rt(s,s,Cn([],a)),s}function An(e){var r=e.width,t=e.height,n=e.altitude,i=e.pitch,o=i===void 0?0:i,a=e.offset,s=e.center,l=e.scale,c=e.nearZMultiplier,f=c===void 0?1:c,u=e.farZMultiplier,p=u===void 0?1:u,v=e.fovy,d=v===void 0?ze(zr):v;n!==void 0&&(d=ze(n));var h=d*ae,y=o*ae,x=zt(d),S=x;s&&(S+=s[2]*l/Math.cos(y)/t);var g=h*(.5+(a?a[1]:0)/t),P=Math.sin(g)*S/Math.sin(tt(Math.PI/2-y-g,.01,Math.PI-.01)),_=Math.sin(y)*P+S,M=S*10,w=Math.min(_*p,M);return{fov:h,aspect:r/t,focalDistance:x,near:f,far:w}}function Dr(e){var r=An(e),t=r.fov,n=r.aspect,i=r.near,o=r.far,a=Pn([],t,n,i,o);return a}function ze(e){return 2*Math.atan(.5/e)*Rr}function zt(e){return .5/Math.tan(.5*e*ae)}function jr(e,r){var t=Z(e,3),n=t[0],i=t[1],o=t[2],a=o===void 0?0:o;return ee(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(a)),he(r,[n,i,a,1])}function Ft(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=Z(e,3),i=n[0],o=n[1],a=n[2];if(ee(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=he(r,[i,o,a,1]);return s}var l=he(r,[i,o,0,1]),c=he(r,[i,o,1,1]),f=l[2],u=c[2],p=f===u?0:((t||0)-f)/(u-f);return Et([],l,c,p)}function kt(e){var r=e.width,t=e.height,n=e.bounds,i=e.minExtent,o=i===void 0?0:i,a=e.maxZoom,s=a===void 0?24:a,l=e.offset,c=l===void 0?[0,0]:l,f=Z(n,2),u=Z(f[0],2),p=u[0],v=u[1],d=Z(f[1],2),h=d[0],y=d[1],x=Ia(e.padding),S=J([p,tt(y,-Fe,Fe)]),g=J([h,tt(v,-Fe,Fe)]),P=[Math.max(Math.abs(g[0]-S[0]),o),Math.max(Math.abs(g[1]-S[1]),o)],_=[r-x.left-x.right-Math.abs(c[0])*2,t-x.top-x.bottom-Math.abs(c[1])*2];ee(_[0]>0&&_[1]>0);var M=_[0]/P[0],w=_[1]/P[1],b=(x.right-x.left)/2/M,T=(x.bottom-x.top)/2/w,D=[(g[0]+S[0])/2+b,(g[1]+S[1])/2+T],k=re(D),E=Math.min(s,At(Math.abs(Math.min(M,w))));return ee(Number.isFinite(E)),{longitude:k[0],latitude:k[1],zoom:E}}function Ia(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(ee(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}var In=Math.PI/180;function Dt(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=e.width,n=e.height,i=e.unproject,o={targetZ:r},a=i([0,n],o),s=i([t,n],o),l,c,f=e.fovy?.5*e.fovy*In:Math.atan(.5/e.altitude),u=(90-e.pitch)*In;return f>u-.01?(l=Tn(e,0,r),c=Tn(e,t,r)):(l=i([0,0],o),c=i([t,0],o)),[a,s,c,l]}function Tn(e,r,t){var n=e.pixelUnprojectionMatrix,i=he(n,[r,0,1,1]),o=he(n,[r,e.height,1,1]),a=t*e.distanceScales.unitsPerMeter[2],s=(a-i[2])/(o[2]-i[2]),l=Et([],i,o,s),c=re(l);return c.push(t),c}var En=function(){function e(){var r=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{width:1,height:1};L(this,e),m(this,"latitude",void 0),m(this,"longitude",void 0),m(this,"zoom",void 0),m(this,"pitch",void 0),m(this,"bearing",void 0),m(this,"altitude",void 0),m(this,"fovy",void 0),m(this,"meterOffset",void 0),m(this,"center",void 0),m(this,"width",void 0),m(this,"height",void 0),m(this,"scale",void 0),m(this,"distanceScales",void 0),m(this,"viewMatrix",void 0),m(this,"projectionMatrix",void 0),m(this,"viewProjectionMatrix",void 0),m(this,"pixelProjectionMatrix",void 0),m(this,"pixelUnprojectionMatrix",void 0),m(this,"equals",function(E){return E instanceof e?E.width===r.width&&E.height===r.height&&Ir(E.projectionMatrix,r.projectionMatrix)&&Ir(E.viewMatrix,r.viewMatrix):!1}),m(this,"project",function(E){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},I=j.topLeft,W=I===void 0?!0:I,$=r.projectPosition(E),B=jr($,r.pixelProjectionMatrix),N=Z(B,2),U=N[0],fe=N[1],ue=W?fe:r.height-fe;return E.length===2?[U,ue]:[U,ue,B[2]]}),m(this,"unproject",function(E){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},I=j.topLeft,W=I===void 0?!0:I,$=j.targetZ,B=$===void 0?void 0:$,N=Z(E,3),U=N[0],fe=N[1],ue=N[2],_t=W?fe:r.height-fe,yr=B&&B*r.distanceScales.unitsPerMeter[2],on=Ft([U,_t,ue],r.pixelUnprojectionMatrix,yr),xr=r.unprojectPosition(on),Pr=Z(xr,3),_r=Pr[0],Sr=Pr[1],va=Pr[2];return Number.isFinite(ue)?[_r,Sr,va]:Number.isFinite(B)?[_r,Sr,B]:[_r,Sr]}),m(this,"projectPosition",function(E){var j=J(E),I=Z(j,2),W=I[0],$=I[1],B=(E[2]||0)*r.distanceScales.unitsPerMeter[2];return[W,$,B]}),m(this,"unprojectPosition",function(E){var j=re(E),I=Z(j,2),W=I[0],$=I[1],B=(E[2]||0)*r.distanceScales.metersPerUnit[2];return[W,$,B]});var n=t.width,i=t.height,o=t.altitude,a=o===void 0?null:o,s=t.fovy,l=s===void 0?null:s,c=t.latitude,f=c===void 0?0:c,u=t.longitude,p=u===void 0?0:u,v=t.zoom,d=v===void 0?0:v,h=t.pitch,y=h===void 0?0:h,x=t.bearing,S=x===void 0?0:x,g=t.position,P=g===void 0?null:g,_=t.nearZMultiplier,M=_===void 0?.02:_,w=t.farZMultiplier,b=w===void 0?1.01:w;n=n||1,i=i||1,l===null&&a===null?(a=zr,l=ze(a)):l===null?l=ze(a):a===null&&(a=zt(l));var T=Rt(d);a=Math.max(.75,a);var D=Fr({longitude:p,latitude:f}),k=J([p,f]);k.push(0),P&&Mn(k,k,wn([],P,D.unitsPerMeter)),this.projectionMatrix=Dr({width:n,height:i,scale:T,center:k,pitch:y,fovy:l,nearZMultiplier:M,farZMultiplier:b}),this.viewMatrix=kr({height:i,scale:T,center:k,pitch:y,bearing:S,altitude:a}),this.width=n,this.height=i,this.scale=T,this.latitude=f,this.longitude=p,this.zoom=d,this.pitch=y,this.bearing=S,this.altitude=a,this.fovy=l,this.center=k,this.meterOffset=P||[0,0,0],this.distanceScales=D,this._initMatrices(),Object.freeze(this)}return A(e,[{key:"_initMatrices",value:function(){var t=this.width,n=this.height,i=this.projectionMatrix,o=this.viewMatrix,a=Re();It(a,a,i),It(a,a,o),this.viewProjectionMatrix=a;var s=Re();Tt(s,s,[t/2,-n/2,1]),rt(s,s,[1,-1,0]),It(s,s,a);var l=mn(Re(),s);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=l}},{key:"projectFlat",value:function(t){return J(t)}},{key:"unprojectFlat",value:function(t){return re(t)}},{key:"getMapCenterByLngLatPosition",value:function(t){var n=t.lngLat,i=t.pos,o=Ft(i,this.pixelUnprojectionMatrix),a=J(n),s=Tr([],a,Sn([],o)),l=Tr([],this.center,s);return re(l)}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=this.width,o=this.height,a=kt(Object.assign({width:i,height:o,bounds:t},n)),s=a.longitude,l=a.latitude,c=a.zoom;return new e({width:i,height:o,longitude:s,latitude:l,zoom:c})}},{key:"getBounds",value:function(t){var n=this.getBoundingRegion(t),i=Math.min.apply(Math,Ee(n.map(function(l){return l[0]}))),o=Math.max.apply(Math,Ee(n.map(function(l){return l[0]}))),a=Math.min.apply(Math,Ee(n.map(function(l){return l[1]}))),s=Math.max.apply(Math,Ee(n.map(function(l){return l[1]})));return[[i,a],[o,s]]}},{key:"getBoundingRegion",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Dt(this,t.z||0)}},{key:"getLocationAtPoint",value:function(t){var n=t.lngLat,i=t.pos;return this.getMapCenterByLngLatPosition({lngLat:n,pos:i})}}]),e}();var Yf=1/Math.PI*180,Kf=1/180*Math.PI,it={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function ke(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function De(e,r,t){return ke(e)?e.map(function(n,i){return De(n,r[i],t)}):t*r+(1-t)*e}function je(e,r,t){var n=it.EPSILON;t&&(it.EPSILON=t);try{if(e===r)return!0;if(ke(e)&&ke(r)){if(e.length!==r.length)return!1;for(var i=0;i<e.length;++i)if(!je(e[i],r[i]))return!1;return!0}return e&&e.equals?e.equals(r):r&&r.equals?r.equals(e):typeof e=="number"&&typeof r=="number"?Math.abs(e-r)<=it.EPSILON*Math.max(1,Math.abs(e),Math.abs(r)):!1}finally{it.EPSILON=n}}var Ea=new Uint16Array([0,2,1,0,3,2]),Ra=new Float32Array([0,1,0,0,1,0,1,1]);function Nr(e,r){if(!r)return za(e);for(var t=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),n=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),i=Math.ceil(t/r)+1,o=Math.ceil(n/r)+1,a=(i-1)*(o-1)*6,s=new Uint32Array(a),l=new Float32Array(i*o*2),c=new Float64Array(i*o*3),f=0,u=0,p=0;p<i;p++)for(var v=p/(i-1),d=0;d<o;d++){var h=d/(o-1),y=Fa(e,v,h);c[f*3+0]=y[0],c[f*3+1]=y[1],c[f*3+2]=y[2]||0,l[f*2+0]=v,l[f*2+1]=1-h,p>0&&d>0&&(s[u++]=f-o,s[u++]=f-o-1,s[u++]=f-1,s[u++]=f-o,s[u++]=f-1,s[u++]=f),f++}return{vertexCount:a,positions:c,indices:s,texCoords:l}}function za(e){for(var r=new Float64Array(12),t=0;t<e.length;t++)r[t*3+0]=e[t][0],r[t*3+1]=e[t][1],r[t*3+2]=e[t][2]||0;return{vertexCount:6,positions:r,indices:Ea,texCoords:Ra}}function Fa(e,r,t){return De(De(e[0],e[1],t),De(e[3],e[2],t),r)}var Rn=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`;var ka=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,zn=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat(ka,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive && !picking_uAttribute) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`);function Fn(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function ot(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Fn(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Fn(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Da(e){var r=ja();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function ja(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Na={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:ne.COORDINATE_SYSTEM.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0}},Nt=function(e){z(t,e);var r=Da(t);function t(){var n;L(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),m(H(n),"state",void 0),n}return A(t,[{key:"getShaders",value:function(){return O(C(t.prototype),"getShaders",this).call(this,{vs:Rn,fs:zn,modules:[ne.project32,ne.picking]})}},{key:"initializeState",value:function(){var i=this,o=this.getAttributeManager();o.remove(["instancePickingColors"]);var a=!0;o.add({indices:{size:1,isIndexed:!0,update:function(l){return l.value=i.state.mesh.indices},noAlloc:a},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:function(l){return l.value=i.state.mesh.positions},noAlloc:a},texCoords:{size:2,update:function(l){return l.value=i.state.mesh.texCoords},noAlloc:a}})}},{key:"updateState",value:function(i){var o=i.props,a=i.oldProps,s=i.changeFlags,l=this.getAttributeManager();if(s.extensionsChanged){var c,f=this.context.gl;(c=this.state.model)===null||c===void 0||c.delete(),this.state.model=this._getModel(f),l.invalidateAll()}if(o.bounds!==a.bounds){var u=this.state.mesh,p=this._createMesh();this.state.model.setVertexCount(p.vertexCount);for(var v in p)u&&u[v]!==p[v]&&l.invalidate(v);this.setState(ot({mesh:p},this._getCoordinateUniforms()))}else o._imageCoordinateSystem!==a._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}},{key:"getPickingInfo",value:function(i){var o=this.props.image,a=i.info;if(!a.color||!o)return a.bitmap=null,a;var s=o,l=s.width,c=s.height;a.index=0;var f=Wa(a.color),u=[Math.floor(f[0]*l),Math.floor(f[1]*c)];return a.bitmap={size:{width:l,height:c},uv:f,pixel:u},a}},{key:"disablePickingIndex",value:function(){this.setState({disablePicking:!0})}},{key:"restorePickingColors",value:function(){this.setState({disablePicking:!1})}},{key:"_updateAutoHighlight",value:function(i){O(C(t.prototype),"_updateAutoHighlight",this).call(this,ot(ot({},i),{},{color:this.encodePickingColor(0)}))}},{key:"_createMesh",value:function(){var i=this.props.bounds,o=i;return kn(i)&&(o=[[i[0],i[1]],[i[0],i[3]],[i[2],i[3]],[i[2],i[1]]]),Nr(o,this.context.viewport.resolution)}},{key:"_getModel",value:function(i){return i?new jt.Model(i,ot(ot({},this.getShaders()),{},{id:this.props.id,geometry:new jt.Geometry({drawMode:4,vertexCount:6}),isInstanced:!1})):null}},{key:"draw",value:function(i){var o=i.uniforms,a=i.moduleParameters,s=this.state,l=s.model,c=s.coordinateConversion,f=s.bounds,u=s.disablePicking,p=this.props,v=p.image,d=p.desaturate,h=p.transparentColor,y=p.tintColor;a.pickingActive&&u||v&&l&&l.setUniforms(o).setUniforms({bitmapTexture:v,desaturate:d,transparentColor:h.map(function(x){return x/255}),tintColor:y.slice(0,3).map(function(x){return x/255}),coordinateConversion:c,bounds:f}).draw()}},{key:"_getCoordinateUniforms",value:function(){var i=ne.COORDINATE_SYSTEM.LNGLAT,o=ne.COORDINATE_SYSTEM.CARTESIAN,a=ne.COORDINATE_SYSTEM.DEFAULT,s=this.props._imageCoordinateSystem;if(s!==a){var l=this.props.bounds;if(!kn(l))throw new Error("_imageCoordinateSystem only supports rectangular bounds");var c=this.context.viewport.resolution?i:o;if(s=s===i?i:o,s===i&&c===o)return{coordinateConversion:-1,bounds:l};if(s===o&&c===i){var f=J([l[0],l[1]]),u=J([l[2],l[3]]);return{coordinateConversion:1,bounds:[f[0],f[1],u[0],u[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}]),t}(ne.Layer);m(Nt,"layerName","BitmapLayer");m(Nt,"defaultProps",Na);function Wa(e){var r=Z(e,3),t=r[0],n=r[1],i=r[2],o=(i&240)/256,a=(i&15)/16;return[(t+a)/256,(n+o)/256]}function kn(e){return Number.isFinite(e[0])}var se=R(G()),Ut=R(K());var Dn=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`;var jn=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var st=R(K()),$n=R(Wn()),Yn=R(G()),Ne;function Hn(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ua(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Ua(e,r){if(e){if(typeof e=="string")return Un(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Un(e,r)}}function Un(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Bn(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Wt(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Bn(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Bn(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Ba=1024,Ga=4,Gn=function(){},Zn=(Ne={},m(Ne,10241,9987),m(Ne,10240,9729),m(Ne,10242,33071),m(Ne,10243,33071),Ne);function Za(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function Va(e,r,t,n){var i=Math.min(t/r.width,n/r.height),o=Math.floor(r.width*i),a=Math.floor(r.height*i);return i===1?{data:r,width:o,height:a}:(e.canvas.height=a,e.canvas.width=o,e.clearRect(0,0,o,a),e.drawImage(r,0,0,r.width,r.height,0,0,o,a),{data:e.canvas,width:o,height:a})}function at(e){return e&&(e.id||e.url)}function Ha(e,r,t,n){var i=e.width,o=e.height,a=new st.Texture2D(e.gl,{width:r,height:t,parameters:n});return(0,st.copyToTexture)(e,a,{targetY:0,width:i,height:o}),e.delete(),a}function Vn(e,r,t){for(var n=0;n<r.length;n++){var i=r[n],o=i.icon,a=i.xOffset,s=at(o);e[s]=Wt(Wt({},o),{},{x:a,y:t})}}function $a(e){for(var r=e.icons,t=e.buffer,n=e.mapping,i=n===void 0?{}:n,o=e.xOffset,a=o===void 0?0:o,s=e.yOffset,l=s===void 0?0:s,c=e.rowHeight,f=c===void 0?0:c,u=e.canvasWidth,p=[],v=0;v<r.length;v++){var d=r[v],h=at(d);if(!i[h]){var y=d.height,x=d.width;a+x+t>u&&(Vn(i,p,l),a=0,l=f+l+t,f=0,p=[]),p.push({icon:d,xOffset:a}),a=a+x+t,f=Math.max(f,y)}}return p.length>0&&Vn(i,p,l),{mapping:i,rowHeight:f,xOffset:a,yOffset:l,canvasWidth:u,canvasHeight:Za(f+l+t)}}function Ya(e,r,t){if(!e||!r)return null;t=t||{};var n={},i=(0,Yn.createIterable)(e),o=i.iterable,a=i.objectInfo,s=Hn(o),l;try{for(s.s();!(l=s.n()).done;){var c=l.value;a.index++;var f=r(c,a),u=at(f);if(!f)throw new Error("Icon is missing.");if(!f.url)throw new Error("Icon url is missing.");!n[u]&&(!t[u]||f.url!==t[u].url)&&(n[u]=Wt(Wt({},f),{},{source:c,sourceIndex:a.index}))}}catch(p){s.e(p)}finally{s.f()}return n}var Kn=function(){function e(r,t){var n=t.onUpdate,i=n===void 0?Gn:n,o=t.onError,a=o===void 0?Gn:o;L(this,e),m(this,"gl",void 0),m(this,"onUpdate",void 0),m(this,"onError",void 0),m(this,"_loadOptions",null),m(this,"_texture",null),m(this,"_externalTexture",null),m(this,"_mapping",{}),m(this,"_textureParameters",null),m(this,"_pendingCount",0),m(this,"_autoPacking",!1),m(this,"_xOffset",0),m(this,"_yOffset",0),m(this,"_rowHeight",0),m(this,"_buffer",Ga),m(this,"_canvasWidth",Ba),m(this,"_canvasHeight",0),m(this,"_canvas",null),this.gl=r,this.onUpdate=i,this.onError=a}return A(e,[{key:"finalize",value:function(){var t;(t=this._texture)===null||t===void 0||t.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(t){var n=this._autoPacking?at(t):t;return this._mapping[n]||{}}},{key:"setProps",value:function(t){var n=t.loadOptions,i=t.autoPacking,o=t.iconAtlas,a=t.iconMapping,s=t.textureParameters;if(n&&(this._loadOptions=n),i!==void 0&&(this._autoPacking=i),a&&(this._mapping=a),o){var l;(l=this._texture)===null||l===void 0||l.delete(),this._texture=null,this._externalTexture=o}s&&(this._textureParameters=s)}},{key:"isLoaded",get:function(){return this._pendingCount===0}},{key:"packIcons",value:function(t,n){if(!(!this._autoPacking||typeof document>"u")){var i=Object.values(Ya(t,n,this._mapping)||{});if(i.length>0){var o=$a({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),a=o.mapping,s=o.xOffset,l=o.yOffset,c=o.rowHeight,f=o.canvasHeight;this._rowHeight=c,this._mapping=a,this._xOffset=s,this._yOffset=l,this._canvasHeight=f,this._texture||(this._texture=new st.Texture2D(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||Zn})),this._texture.height!==this._canvasHeight&&(this._texture=Ha(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||Zn)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}}},{key:"_loadIcons",value:function(t){var n=this,i=this._canvas.getContext("2d",{willReadFrequently:!0}),o=Hn(t),a;try{var s=function(){var c=a.value;n._pendingCount++,(0,$n.load)(c.url,n._loadOptions).then(function(f){var u=at(c),p=n._mapping[u],v=p.x,d=p.y,h=p.width,y=p.height,x=Va(i,f,h,y),S=x.data,g=x.width,P=x.height;n._texture.setSubImageData({data:S,x:v+(h-g)/2,y:d+(y-P)/2,width:g,height:P}),p.width=g,p.height=P,n._texture.generateMipmap(),n.onUpdate()}).catch(function(f){n.onError({url:c.url,source:c.source,sourceIndex:c.sourceIndex,loadOptions:n._loadOptions,error:f})}).finally(function(){n._pendingCount--})};for(o.s();!(a=o.n()).done;)s()}catch(l){o.e(l)}finally{o.f()}}}]),e}();function Xn(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Jn(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Xn(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Xn(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ka(e){var r=Xa();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function Xa(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var qn=[0,0,0,255],Ja={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:function(r){return r.position}},getIcon:{type:"accessor",value:function(r){return r.icon}},getColor:{type:"accessor",value:qn},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}},me=function(e){z(t,e);var r=Ka(t);function t(){var n;L(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),m(H(n),"state",void 0),n}return A(t,[{key:"getShaders",value:function(){return O(C(t.prototype),"getShaders",this).call(this,{vs:Dn,fs:jn,modules:[se.project32,se.picking]})}},{key:"initializeState",value:function(){this.state={iconManager:new Kn(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};var i=this.getAttributeManager();i.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:qn},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(i){O(C(t.prototype),"updateState",this).call(this,i);var o=i.props,a=i.oldProps,s=i.changeFlags,l=this.getAttributeManager(),c=o.iconAtlas,f=o.iconMapping,u=o.data,p=o.getIcon,v=o.textureParameters,d=this.state.iconManager,h=c||this.internalState.isAsyncPropLoading("iconAtlas");if(d.setProps({loadOptions:o.loadOptions,autoPacking:!h,iconAtlas:c,iconMapping:h?f:null,textureParameters:v}),h?a.iconMapping!==o.iconMapping&&l.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&d.packIcons(u,p),s.extensionsChanged){var y,x=this.context.gl;(y=this.state.model)===null||y===void 0||y.delete(),this.state.model=this._getModel(x),l.invalidateAll()}}},{key:"isLoaded",get:function(){return O(C(t.prototype),"isLoaded",this)&&this.state.iconManager.isLoaded}},{key:"finalizeState",value:function(i){O(C(t.prototype),"finalizeState",this).call(this,i),this.state.iconManager.finalize()}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.sizeScale,l=a.sizeMinPixels,c=a.sizeMaxPixels,f=a.sizeUnits,u=a.billboard,p=a.alphaCutoff,v=this.state.iconManager,d=v.getTexture();d&&this.state.model.setUniforms(o).setUniforms({iconsTexture:d,iconsTextureDim:[d.width,d.height],sizeUnits:se.UNIT[f],sizeScale:s,sizeMinPixels:l,sizeMaxPixels:c,billboard:u,alphaCutoff:p}).draw()}},{key:"_getModel",value:function(i){var o=[-1,-1,-1,1,1,1,1,-1];return new Ut.Model(i,Jn(Jn({},this.getShaders()),{},{id:this.props.id,geometry:new Ut.Geometry({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(o)}}}),isInstanced:!0}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"_onError",value:function(i){var o,a=(o=this.getCurrentLayer())===null||o===void 0?void 0:o.props.onIconError;a?a(i):se.log.error(i.error.message)()}},{key:"getInstanceOffset",value:function(i){var o=this.state.iconManager.getIconMapping(i),a=o.width,s=o.height,l=o.anchorX,c=l===void 0?a/2:l,f=o.anchorY,u=f===void 0?s/2:f;return[a/2-c,s/2-u]}},{key:"getInstanceColorMode",value:function(i){var o=this.state.iconManager.getIconMapping(i);return o.mask?1:0}},{key:"getInstanceIconFrame",value:function(i){var o=this.state.iconManager.getIconMapping(i),a=o.x,s=o.y,l=o.width,c=o.height;return[a,s,l,c]}}]),t}(se.Layer);m(me,"defaultProps",Ja);m(me,"layerName","IconLayer");var ye=R(G()),Bt=R(K());var Qn=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      gl_Position = vec4(0.);
      return;
    }
  }
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(p, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var ei=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function ti(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function ri(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?ti(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ti(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function qa(e){var r=Qa();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function Qa(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var es=[0,0,0,255],ts={getSourcePosition:{type:"accessor",value:function(r){return r.sourcePosition}},getTargetPosition:{type:"accessor",value:function(r){return r.targetPosition}},getColor:{type:"accessor",value:es},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},Gt=function(e){z(t,e);var r=qa(t);function t(){return L(this,t),r.apply(this,arguments)}return A(t,[{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["instanceSourcePositions","instanceTargetPositions"])}},{key:"getShaders",value:function(){return O(C(t.prototype),"getShaders",this).call(this,{vs:Qn,fs:ei,modules:[ye.project32,ye.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}},{key:"updateState",value:function(i){if(O(C(t.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var o,a=this.context.gl;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.widthUnits,l=a.widthScale,c=a.widthMinPixels,f=a.widthMaxPixels,u=a.wrapLongitude;this.state.model.setUniforms(o).setUniforms({widthUnits:ye.UNIT[s],widthScale:l,widthMinPixels:c,widthMaxPixels:f,useShortestPath:u?1:0}).draw(),u&&this.state.model.setUniforms({useShortestPath:-1}).draw()}},{key:"_getModel",value:function(i){var o=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Bt.Model(i,ri(ri({},this.getShaders()),{},{id:this.props.id,geometry:new Bt.Geometry({drawMode:5,attributes:{positions:new Float32Array(o)}}),isInstanced:!0}))}}]),t}(ye.Layer);m(Gt,"layerName","LineLayer");m(Gt,"defaultProps",ts);var le=R(G()),Zt=R(K());var ni=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var ii=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function oi(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function ai(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?oi(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):oi(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function rs(e){var r=ns();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function ns(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var si=[0,0,0,255],li=[0,0,1],is={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:function(r){return r.position}},getNormal:{type:"accessor",value:li},getColor:{type:"accessor",value:si},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function os(e){var r=e.header,t=e.attributes;!r||!t||(e.length=r.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0&&(t.instanceColors=t.COLOR_0))}var Vt=function(e){z(t,e);var r=rs(t);function t(){return L(this,t),r.apply(this,arguments)}return A(t,[{key:"getShaders",value:function(){return O(C(t.prototype),"getShaders",this).call(this,{vs:ni,fs:ii,modules:[le.project32,le.gouraudLighting,le.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:li},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:si}})}},{key:"updateState",value:function(i){var o=i.changeFlags,a=i.props;if(O(C(t.prototype),"updateState",this).call(this,i),o.extensionsChanged){var s,l=this.context.gl;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(l),this.getAttributeManager().invalidateAll()}o.dataChanged&&os(a.data)}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.pointSize,l=a.sizeUnits;this.state.model.setUniforms(o).setUniforms({sizeUnits:le.UNIT[l],radiusPixels:s}).draw()}},{key:"_getModel",value:function(i){for(var o=[],a=0;a<3;a++){var s=a/3*Math.PI*2;o.push(Math.cos(s)*2,Math.sin(s)*2,0)}return new Zt.Model(i,ai(ai({},this.getShaders()),{},{id:this.props.id,geometry:new Zt.Geometry({drawMode:4,attributes:{positions:new Float32Array(o)}}),isInstanced:!0}))}}]),t}(le.Layer);m(Vt,"layerName","PointCloudLayer");m(Vt,"defaultProps",is);var pe=R(G()),Ht=R(K());var ci=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var fi=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (!filled) {
    discard;
  } else {
    gl_FragColor = vFillColor;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function ui(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function pi(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?ui(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ui(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function as(e){var r=ss();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function ss(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vi=[0,0,0,255],ls={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:function(r){return r.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:vi},getLineColor:{type:"accessor",value:vi},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},We=function(e){z(t,e);var r=as(t);function t(){return L(this,t),r.apply(this,arguments)}return A(t,[{key:"getShaders",value:function(){return O(C(t.prototype),"getShaders",this).call(this,{vs:ci,fs:fi,modules:[pe.project32,pe.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(i){if(O(C(t.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var o,a=this.context.gl;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.radiusUnits,l=a.radiusScale,c=a.radiusMinPixels,f=a.radiusMaxPixels,u=a.stroked,p=a.filled,v=a.billboard,d=a.antialiasing,h=a.lineWidthUnits,y=a.lineWidthScale,x=a.lineWidthMinPixels,S=a.lineWidthMaxPixels;this.state.model.setUniforms(o).setUniforms({stroked:u?1:0,filled:p,billboard:v,antialiasing:d,radiusUnits:pe.UNIT[s],radiusScale:l,radiusMinPixels:c,radiusMaxPixels:f,lineWidthUnits:pe.UNIT[h],lineWidthScale:y,lineWidthMinPixels:x,lineWidthMaxPixels:S}).draw()}},{key:"_getModel",value:function(i){var o=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Ht.Model(i,pi(pi({},this.getShaders()),{},{id:this.props.id,geometry:new Ht.Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(o)}}}),isInstanced:!0}))}}]),t}(pe.Layer);m(We,"defaultProps",ls);m(We,"layerName","ScatterplotLayer");var q=R(G()),_e=R(K());var Oi=R(G()),Kt=R(K());var Ue={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function xe(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=di(e,t);return n!==r?(cs(e,t),!0):!1}function di(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Math.sign(lt(e,r))}function lt(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=r.start,n=t===void 0?0:t,i=r.end,o=i===void 0?e.length:i,a=r.size||2,s=0,l=n,c=o-a;l<o;l+=a)s+=(e[l]-e[c])*(e[l+1]+e[c+1]),c=l;return s/2}function Wr(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=t.start,i=n===void 0?0:n,o=t.end,a=o===void 0?e.length:o,s=t.size,l=s===void 0?2:s,c=t.isClosed,f=(a-i)/l,u=0;u<f-1;++u)r(e[i+u*l],e[i+u*l+1],e[i+(u+1)*l],e[i+(u+1)*l+1],u,u+1);var p=i+(f-1)*l,v=c||je(e[i],e[p])&&je(e[i+1],e[p+1]);v||r(e[p],e[p+1],e[i],e[i+1],f-1,0)}function cs(e,r){for(var t=r.start,n=t===void 0?0:t,i=r.end,o=i===void 0?e.length:i,a=r.size,s=a===void 0?2:a,l=(o-n)/s,c=Math.floor(l/2),f=0;f<c;++f)for(var u=n+f*s,p=n+(l-1-f)*s,v=0;v<s;++v){var d=e[u+v];e[u+v]=e[p+v],e[p+v]=d}}function gi(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=fs(e,t);return n!==r?(e.reverse(),!0):!1}function fs(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Math.sign(Ur(e,r))}function Ur(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=r.start,n=t===void 0?0:t,i=r.end,o=i===void 0?e.length:i,a=0,s=n,l=o-1;s<o;++s)a+=(e[s][0]-e[l][0])*(e[s][1]+e[l][1]),l=s;return a/2}function hi(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=t.start,i=n===void 0?0:n,o=t.end,a=o===void 0?e.length:o,s=t.isClosed,l=i;l<a-1;++l)r(e[l],e[l+1],l,l+1);var c=s||je(e[a-1],e[0]);c||r(e[a-1],e[0],a-1,0)}var mi=function(){function e(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};L(this,e),m(this,"points",void 0),m(this,"isFlatArray",void 0),m(this,"options",void 0),this.points=r,this.isFlatArray=!ke(r[0]),this.options={start:t.start||0,end:t.end||r.length,size:t.size||2,isClosed:t.isClosed},Object.freeze(this)}return A(e,[{key:"getSignedArea",value:function(){return this.isFlatArray?lt(this.points,this.options):Ur(this.points,this.options)}},{key:"getArea",value:function(){return Math.abs(this.getSignedArea())}},{key:"getWindingDirection",value:function(){return Math.sign(this.getSignedArea())}},{key:"forEachSegment",value:function(t){this.isFlatArray?Wr(this.points,function(n,i,o,a,s,l){t([n,i],[o,a],s,l)},this.options):hi(this.points,t,this.options)}},{key:"modifyWindingDirection",value:function(t){return this.isFlatArray?xe(this.points,t,this.options):gi(this.points,t,this.options)}}]),e}();function X(e,r){var t=r.length,n=e.length;if(n>0){for(var i=!0,o=0;o<t;o++)if(e[n-t+o]!==r[o]){i=!1;break}if(i)return!1}for(var a=0;a<t;a++)e[n+a]=r[a];return!0}function ct(e,r){for(var t=r.length,n=0;n<t;n++)e[n]=r[n]}function Pe(e,r,t,n){for(var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],o=n+r*t,a=0;a<t;a++)i[a]=e[o+a];return i}function $t(e,r,t,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],o,a;if(t&8)o=(n[3]-e[1])/(r[1]-e[1]),a=3;else if(t&4)o=(n[1]-e[1])/(r[1]-e[1]),a=1;else if(t&2)o=(n[2]-e[0])/(r[0]-e[0]),a=2;else if(t&1)o=(n[0]-e[0])/(r[0]-e[0]),a=0;else return null;for(var s=0;s<e.length;s++)i[s]=(a&1)===s?n[a]:o*(r[s]-e[s])+e[s];return i}function ft(e,r){var t=0;return e[0]<r[0]?t|=1:e[0]>r[2]&&(t|=2),e[1]<r[1]?t|=4:e[1]>r[3]&&(t|=8),t}function ut(e,r){var t=r||{},n=t.size,i=n===void 0?2:n,o=t.broken,a=o===void 0?!1:o,s=t.gridResolution,l=s===void 0?10:s,c=t.gridOffset,f=c===void 0?[0,0]:c,u=t.startIndex,p=u===void 0?0:u,v=t.endIndex,d=v===void 0?e.length:v,h=(d-p)/i,y=[],x=[y],S=Pe(e,0,i,p),g,P,_=Pi(S,l,f,[]),M=[];X(y,S);for(var w=1;w<h;w++){for(g=Pe(e,w,i,p,g),P=ft(g,_);P;){$t(S,g,P,_,M);var b=ft(M,_);b&&($t(S,M,b,_,M),P=b),X(y,M),ct(S,M),ps(_,l,P),a&&y.length>i&&(y=[],x.push(y),X(y,S)),P=ft(g,_)}X(y,g),ct(S,g)}return a?x:x[0]}var yi=0,us=1;function Yt(e,r){for(var t=0;t<r.length;t++)e.push(r[t]);return e}function pt(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2?arguments[2]:void 0;if(!e.length)return[];for(var n=t||{},i=n.size,o=i===void 0?2:i,a=n.gridResolution,s=a===void 0?10:a,l=n.gridOffset,c=l===void 0?[0,0]:l,f=n.edgeTypes,u=f===void 0?!1:f,p=[],v=[{pos:e,types:u?new Array(e.length/o).fill(us):null,holes:r||[]}],d=[[],[]],h=[];v.length;){var y=v.shift(),x=y.pos,S=y.types,g=y.holes;vs(x,o,g[0]||x.length,d),h=Pi(d[0],s,c,h);var P=ft(d[1],h);if(P){var _=xi(x,S,o,0,g[0]||x.length,h,P),M={pos:_[0].pos,types:_[0].types,holes:[]},w={pos:_[1].pos,types:_[1].types,holes:[]};v.push(M,w);for(var b=0;b<g.length;b++)_=xi(x,S,o,g[b],g[b+1]||x.length,h,P),_[0]&&(M.holes.push(M.pos.length),M.pos=Yt(M.pos,_[0].pos),u&&(M.types=Yt(M.types,_[0].types))),_[1]&&(w.holes.push(w.pos.length),w.pos=Yt(w.pos,_[1].pos),u&&(w.types=Yt(w.types,_[1].types)))}else{var T={positions:x};u&&(T.edgeTypes=S),g.length&&(T.holeIndices=g),p.push(T)}}return p}function xi(e,r,t,n,i,o,a){for(var s=(i-n)/t,l=[],c=[],f=[],u=[],p=[],v,d,h,y=Pe(e,s-1,t,n),x=Math.sign(a&8?y[1]-o[3]:y[0]-o[2]),S=r&&r[s-1],g=0,P=0,_=0;_<s;_++)v=Pe(e,_,t,n,v),d=Math.sign(a&8?v[1]-o[3]:v[0]-o[2]),h=r&&r[n/t+_],d&&x&&x!==d&&($t(y,v,a,o,p),X(l,p)&&f.push(S),X(c,p)&&u.push(S)),d<=0?(X(l,v)&&f.push(h),g-=d):f.length&&(f[f.length-1]=yi),d>=0?(X(c,v)&&u.push(h),P+=d):u.length&&(u[u.length-1]=yi),ct(y,v),x=d,S=h;return[g?{pos:l,types:r&&f}:null,P?{pos:c,types:r&&u}:null]}function Pi(e,r,t,n){var i=Math.floor((e[0]-t[0])/r)*r+t[0],o=Math.floor((e[1]-t[1])/r)*r+t[1];return n[0]=i,n[1]=o,n[2]=i+r,n[3]=o+r,n}function ps(e,r,t){t&8?(e[1]+=r,e[3]+=r):t&4?(e[1]-=r,e[3]-=r):t&2?(e[0]+=r,e[2]+=r):t&1&&(e[0]-=r,e[2]-=r)}function vs(e,r,t,n){for(var i=1/0,o=-1/0,a=1/0,s=-1/0,l=0;l<t;l+=r){var c=e[l],f=e[l+1];i=c<i?c:i,o=c>o?c:o,a=f<a?f:a,s=f>s?f:s}return n[0][0]=i,n[0][1]=a,n[1][0]=o,n[1][1]=s,n}function Si(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=ds(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function ds(e,r){if(e){if(typeof e=="string")return _i(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _i(e,r)}}function _i(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var gs=85.051129;function Br(e,r){var t=r||{},n=t.size,i=n===void 0?2:n,o=t.startIndex,a=o===void 0?0:o,s=t.endIndex,l=s===void 0?e.length:s,c=t.normalize,f=c===void 0?!0:c,u=e.slice(a,l);Mi(u,i,0,l-a);var p=ut(u,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(f){var v=Si(p),d;try{for(v.s();!(d=v.n()).done;){var h=d.value;Ci(h,i)}}catch(y){v.e(y)}finally{v.f()}}return p}function Gr(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2?arguments[2]:void 0,n=t||{},i=n.size,o=i===void 0?2:i,a=n.normalize,s=a===void 0?!0:a,l=n.edgeTypes,c=l===void 0?!1:l;r=r||[];for(var f=[],u=[],p=0,v=0,d=0;d<=r.length;d++){for(var h=r[d]||e.length,y=v,x=hs(e,o,p,h),S=x;S<h;S++)f[v++]=e[S];for(var g=p;g<x;g++)f[v++]=e[g];Mi(f,o,y,v),ms(f,o,y,v,t?.maxLatitude),p=h,u[d]=v}u.pop();var P=pt(f,u,{size:o,gridResolution:360,gridOffset:[-180,-180],edgeTypes:c});if(s){var _=Si(P),M;try{for(_.s();!(M=_.n()).done;){var w=M.value;Ci(w.positions,o)}}catch(b){_.e(b)}finally{_.f()}}return P}function hs(e,r,t,n){for(var i=-1,o=-1,a=t+1;a<n;a+=r){var s=Math.abs(e[a]);s>i&&(i=s,o=a-1)}return o}function ms(e,r,t,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:gs,o=e[t],a=e[n-r];if(Math.abs(o-a)>180){var s=Pe(e,0,r,t);s[0]+=Math.round((a-o)/360)*360,X(e,s),s[1]=Math.sign(s[1])*i,X(e,s),s[0]=o,X(e,s)}}function Mi(e,r,t,n){for(var i=e[0],o,a=t;a<n;a+=r){o=e[a];var s=o-i;(s>180||s<-180)&&(o-=Math.round(s/360)*360),e[a]=i=o}}function Ci(e,r){for(var t,n=e.length/r,i=0;i<n&&(t=e[i*r],(t+180)%360===0);i++);var o=-Math.round(t/360)*360;if(o!==0)for(var a=0;a<n;a++)e[a*r]+=o}function wi(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function bi(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?wi(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):wi(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ys(e){var r=xs();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function xs(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Li=function(e){z(t,e);var r=ys(t);function t(n){L(this,t);var i=n.id,o=i===void 0?(0,Kt.uid)("column-geometry"):i,a=Ps(n),s=a.indices,l=a.attributes;return r.call(this,bi(bi({},n),{},{id:o,indices:s,attributes:l}))}return t}(Kt.Geometry);function Ps(e){var r=e.radius,t=e.height,n=t===void 0?1:t,i=e.nradial,o=i===void 0?10:i,a=e.vertices;a&&(Oi.log.assert(a.length>=o),a=a.flatMap(function(j){return[j[0],j[1]]}),xe(a,Ue.COUNTER_CLOCKWISE));var s=n>0,l=o+1,c=s?l*3+1:o,f=Math.PI*2/o,u=new Uint16Array(s?o*3*2:0),p=new Float32Array(c*3),v=new Float32Array(c*3),d=0;if(s){for(var h=0;h<l;h++)for(var y=h*f,x=h%o,S=Math.sin(y),g=Math.cos(y),P=0;P<2;P++)p[d+0]=a?a[x*2]:g*r,p[d+1]=a?a[x*2+1]:S*r,p[d+2]=(1/2-P)*n,v[d+0]=a?a[x*2]:g,v[d+1]=a?a[x*2+1]:S,d+=3;p[d+0]=p[d-3],p[d+1]=p[d-2],p[d+2]=p[d-1],d+=3}for(var _=s?0:1;_<l;_++){var M=Math.floor(_/2)*Math.sign(.5-_%2),w=M*f,b=(M+o)%o,T=Math.sin(w),D=Math.cos(w);p[d+0]=a?a[b*2]:D*r,p[d+1]=a?a[b*2+1]:T*r,p[d+2]=n/2,v[d+2]=1,d+=3}if(s)for(var k=0,E=0;E<o;E++)u[k++]=E*2+0,u[k++]=E*2+2,u[k++]=E*2+0,u[k++]=E*2+1,u[k++]=E*2+1,u[k++]=E*2+3;return{indices:u,attributes:{POSITION:{size:3,value:p},NORMAL:{size:3,value:v}}}}var Ai=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
  float elevation = 0.0;
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Ii=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function Ti(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Ei(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Ti(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ti(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function _s(e){var r=Ss();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function Ss(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Xt=[0,0,0,255],Ms={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(r){return r.position}},getFillColor:{type:"accessor",value:Xt},getLineColor:{type:"accessor",value:Xt},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Be=function(e){z(t,e);var r=_s(t);function t(){return L(this,t),r.apply(this,arguments)}return A(t,[{key:"getShaders",value:function(){var i=this.context.gl,o=!(0,_e.isWebGL2)(i),a={},s=this.props.flatShading&&(0,_e.hasFeature)(i,_e.FEATURES.GLSL_DERIVATIVES);return s&&(a.FLAT_SHADING=1),O(C(t.prototype),"getShaders",this).call(this,{vs:Ai,fs:Ii,defines:a,transpileToGLSL100:o,modules:[q.project32,s?q.phongLighting:q.gouraudLighting,q.picking]})}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:Xt},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:Xt},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(i){O(C(t.prototype),"updateState",this).call(this,i);var o=i.props,a=i.oldProps,s=i.changeFlags,l=s.extensionsChanged||o.flatShading!==a.flatShading;if(l){var c,f=this.context.gl;(c=this.state.model)===null||c===void 0||c.delete(),this.state.model=this._getModel(f),this.getAttributeManager().invalidateAll()}(l||o.diskResolution!==a.diskResolution||o.vertices!==a.vertices||(o.extruded||o.stroked)!==(a.extruded||a.stroked))&&this._updateGeometry(o)}},{key:"getGeometry",value:function(i,o,a){var s=new Li({radius:1,height:a?2:0,vertices:o,nradial:i}),l=0;if(o)for(var c=0;c<i;c++){var f=o[c],u=Math.sqrt(f[0]*f[0]+f[1]*f[1]);l+=u/i}else l=1;return this.setState({edgeDistance:Math.cos(Math.PI/i)*l}),s}},{key:"_getModel",value:function(i){return new _e.Model(i,Ei(Ei({},this.getShaders()),{},{id:this.props.id,isInstanced:!0}))}},{key:"_updateGeometry",value:function(i){var o=i.diskResolution,a=i.vertices,s=i.extruded,l=i.stroked,c=this.getGeometry(o,a,s||l);this.setState({fillVertexCount:c.attributes.POSITION.value.length/3,wireframeVertexCount:c.indices.value.length}),this.state.model.setProps({geometry:c})}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.lineWidthUnits,l=a.lineWidthScale,c=a.lineWidthMinPixels,f=a.lineWidthMaxPixels,u=a.radiusUnits,p=a.elevationScale,v=a.extruded,d=a.filled,h=a.stroked,y=a.wireframe,x=a.offset,S=a.coverage,g=a.radius,P=a.angle,_=this.state,M=_.model,w=_.fillVertexCount,b=_.wireframeVertexCount,T=_.edgeDistance;M.setUniforms(o).setUniforms({radius:g,angle:P/180*Math.PI,offset:x,extruded:v,stroked:h,coverage:S,elevationScale:p,edgeDistance:T,radiusUnits:q.UNIT[u],widthUnits:q.UNIT[s],widthScale:l,widthMinPixels:c,widthMaxPixels:f}),v&&y&&(M.setProps({isIndexed:!0}),M.setVertexCount(b).setDrawMode(1).setUniforms({isStroke:!0}).draw()),d&&(M.setProps({isIndexed:!1}),M.setVertexCount(w).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!v&&h&&(M.setProps({isIndexed:!1}),M.setVertexCount(w*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}]),t}(q.Layer);m(Be,"layerName","ColumnLayer");m(Be,"defaultProps",Ms);var Ri=R(K()),zi=R(G());function Cs(e){var r=ws();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function ws(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var bs={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}},Jt=function(e){z(t,e);var r=Cs(t);function t(){return L(this,t),r.apply(this,arguments)}return A(t,[{key:"getGeometry",value:function(i){return new Ri.CubeGeometry}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.elevationScale,l=a.extruded,c=a.offset,f=a.coverage,u=a.cellSize,p=a.angle,v=a.radiusUnits;this.state.model.setUniforms(o).setUniforms({radius:u/2,radiusUnits:zi.UNIT[v],angle:p,offset:c,extruded:l,coverage:f,elevationScale:s,edgeDistance:1,isWireframe:!1}).draw()}}]),t}(Be);m(Jt,"layerName","GridCellLayer");m(Jt,"defaultProps",bs);var Se=R(G()),qt=R(K());var Ui=R(G());function Fi(e,r,t,n){var i;if(Array.isArray(e[0])){var o=e.length*r;i=new Array(o);for(var a=0;a<e.length;a++)for(var s=0;s<r;s++)i[a*r+s]=e[a][s]||0}else i=e;return t?ut(i,{size:r,gridResolution:t}):n?Br(i,{size:r}):i}function ki(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Os(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Os(e,r){if(e){if(typeof e=="string")return Di(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Di(e,r)}}function Di(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ji(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Ni(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?ji(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ji(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ls(e){var r=As();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function As(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Is=1,Ts=2,Zr=4,Bi=function(e){z(t,e);var r=Ls(t);function t(n){return L(this,t),r.call(this,Ni(Ni({},n),{},{attributes:{positions:{size:3,padding:18,initialize:!0,type:n.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}}))}return A(t,[{key:"get",value:function(i){return this.attributes[i]}},{key:"getGeometryFromBuffer",value:function(i){return this.normalize?O(C(t.prototype),"getGeometryFromBuffer",this).call(this,i):null}},{key:"normalizeGeometry",value:function(i){return this.normalize?Fi(i,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):i}},{key:"getGeometrySize",value:function(i){if(Wi(i)){var o=0,a=ki(i),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;o+=this.getGeometrySize(l)}}catch(f){a.e(f)}finally{a.f()}return o}var c=this.getPathLength(i);return c<2?0:this.isClosed(i)?c<3?0:c+2:c}},{key:"updateGeometryAttributes",value:function(i,o){if(o.geometrySize!==0)if(i&&Wi(i)){var a=ki(i),s;try{for(a.s();!(s=a.n()).done;){var l=s.value,c=this.getGeometrySize(l);o.geometrySize=c,this.updateGeometryAttributes(l,o),o.vertexStart+=c}}catch(f){a.e(f)}finally{a.f()}}else this._updateSegmentTypes(i,o),this._updatePositions(i,o)}},{key:"_updateSegmentTypes",value:function(i,o){var a=this.attributes.segmentTypes,s=i?this.isClosed(i):!1,l=o.vertexStart,c=o.geometrySize;a.fill(0,l,l+c),s?(a[l]=Zr,a[l+c-2]=Zr):(a[l]+=Is,a[l+c-2]+=Ts),a[l+c-1]=Zr}},{key:"_updatePositions",value:function(i,o){var a=this.attributes.positions;if(!(!a||!i))for(var s=o.vertexStart,l=o.geometrySize,c=new Array(3),f=s,u=0;u<l;f++,u++)this.getPointOnPath(i,u,c),a[f*3]=c[0],a[f*3+1]=c[1],a[f*3+2]=c[2]}},{key:"getPathLength",value:function(i){return i.length/this.positionSize}},{key:"getPointOnPath",value:function(i,o){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=this.positionSize;o*s>=i.length&&(o+=1-i.length/s);var l=o*s;return a[0]=i[l],a[1]=i[l+1],a[2]=s===3&&i[l+2]||0,a}},{key:"isClosed",value:function(i){if(!this.normalize)return Boolean(this.opts.loop);var o=this.positionSize,a=i.length-o;return i[0]===i[a]&&i[1]===i[a+1]&&(o===2||i[2]===i[a+2])}}]),t}(Ui.Tesselator);function Wi(e){return Array.isArray(e[0])}var Gi=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Zi=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function Vi(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Hi(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Vi(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Vi(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Es(e){var r=Rs();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function Rs(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $i=[0,0,0,255],zs={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:function(r){return r.path}},getColor:{type:"accessor",value:$i},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Vr={enter:function(r,t){return t.length?t.subarray(t.length-r.length):r}},Me=function(e){z(t,e);var r=Es(t);function t(){var n;L(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),m(H(n),"state",void 0),n}return A(t,[{key:"getShaders",value:function(){return O(C(t.prototype),"getShaders",this).call(this,{vs:Gi,fs:Zi,modules:[Se.project32,Se.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this,o=!0,a=this.getAttributeManager();a.addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:Vr,accessor:"getPath",update:this.calculatePositions,noAlloc:o,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:o},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Vr,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:Vr,defaultValue:$i},instancePickingColors:{size:3,type:5121,accessor:function(l,c){var f=c.index,u=c.target;return i.encodePickingColor(l&&l.__source?l.__source.index:f,u)}}}),this.setState({pathTesselator:new Bi({fp64:this.use64bitPositions()})})}},{key:"updateState",value:function(i){O(C(t.prototype),"updateState",this).call(this,i);var o=i.props,a=i.changeFlags,s=this.getAttributeManager(),l=a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getPath);if(l){var c=this.state.pathTesselator,f=o.data.attributes||{};c.updateGeometry({data:o.data,geometryBuffer:f.getPath,buffers:f,normalize:!o._pathType,loop:o._pathType==="loop",getGeometry:o.getPath,positionFormat:o.positionFormat,wrapLongitude:o.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:a.dataChanged}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),a.dataChanged||s.invalidateAll()}if(a.extensionsChanged){var u,p=this.context.gl;(u=this.state.model)===null||u===void 0||u.delete(),this.state.model=this._getModel(p),s.invalidateAll()}}},{key:"getPickingInfo",value:function(i){var o=O(C(t.prototype),"getPickingInfo",this).call(this,i),a=o.index,s=this.props.data;return s[0]&&s[0].__source&&(o.object=s.find(function(l){return l.__source.index===a})),o}},{key:"disablePickingIndex",value:function(i){var o=this.props.data;if(o[0]&&o[0].__source)for(var a=0;a<o.length;a++)o[a].__source.index===i&&this._disablePickingIndex(a);else O(C(t.prototype),"disablePickingIndex",this).call(this,i)}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.jointRounded,l=a.capRounded,c=a.billboard,f=a.miterLimit,u=a.widthUnits,p=a.widthScale,v=a.widthMinPixels,d=a.widthMaxPixels;this.state.model.setUniforms(o).setUniforms({jointType:Number(s),capType:Number(l),billboard:c,widthUnits:Se.UNIT[u],widthScale:p,miterLimit:f,widthMinPixels:v,widthMaxPixels:d}).draw()}},{key:"_getModel",value:function(i){var o=[0,1,2,1,4,2,1,3,4,3,5,4],a=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new qt.Model(i,Hi(Hi({},this.getShaders()),{},{id:this.props.id,geometry:new qt.Geometry({drawMode:4,attributes:{indices:new Uint16Array(o),positions:{value:new Float32Array(a),size:2}}}),isInstanced:!0}))}},{key:"calculatePositions",value:function(i){var o=this.state.pathTesselator;i.startIndices=o.vertexStarts,i.value=o.get("positions")}},{key:"calculateSegmentTypes",value:function(i){var o=this.state.pathTesselator;i.startIndices=o.vertexStarts,i.value=o.get("segmentTypes")}}]),t}(Se.Layer);m(Me,"defaultProps",zs);m(Me,"layerName","PathLayer");var He=R(G());var Q=R(G()),ve=R(K());var io=R(qi());function Xs(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Js(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Js(e,r){if(e){if(typeof e=="string")return Qi(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Qi(e,r)}}function Qi(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var nr=Ue.CLOCKWISE,eo=Ue.COUNTER_CLOCKWISE,Ce={isClosed:!0};function qs(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function Ze(e){return"positions"in e?e.positions:e}function ht(e){return"holeIndices"in e?e.holeIndices:null}function Qs(e){return Array.isArray(e[0])}function el(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function tl(e){var r=e[0],t=e[e.length-1];return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]}function rl(e,r,t,n){for(var i=0;i<r;i++)if(e[t+i]!==e[n-r+i])return!1;return!0}function to(e,r,t,n,i){for(var o=r,a=t.length,s=0;s<a;s++)for(var l=0;l<n;l++)e[o++]=t[s][l]||0;if(!tl(t))for(var c=0;c<n;c++)e[o++]=t[0][c]||0;return Ce.start=r,Ce.end=o,Ce.size=n,xe(e,i,Ce),o}function ro(e,r,t,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;o=o||t.length;var s=o-i;if(s<=0)return r;for(var l=r,c=0;c<s;c++)e[l++]=t[i+c];if(!rl(t,n,i,o))for(var f=0;f<n;f++)e[l++]=t[i+f];return Ce.start=r,Ce.end=l,Ce.size=n,xe(e,a,Ce),l}function ir(e,r){qs(e);var t=[],n=[];if("positions"in e){var i=e,o=i.positions,a=i.holeIndices;if(a){for(var s=0,l=0;l<=a.length;l++)s=ro(t,s,o,r,a[l-1],a[l],l===0?nr:eo),n.push(s);return n.pop(),{positions:t,holeIndices:n}}e=o}if(!Qs(e))return ro(t,0,e,r,0,t.length,nr),t;if(!el(e)){var c=0,f=Xs(e.entries()),u;try{for(f.s();!(u=f.n()).done;){var p=Z(u.value,2),v=p[0],d=p[1];c=to(t,c,d,r,v===0?nr:eo),n.push(c)}}catch(h){f.e(h)}finally{f.f()}return n.pop(),{positions:t,holeIndices:n}}return to(t,0,e,r,nr),t}function Xr(e,r,t){for(var n=e.length/3,i=0,o=0;o<n;o++){var a=(o+1)%n;i+=e[o*3+r]*e[a*3+t],i-=e[a*3+r]*e[o*3+t]}return Math.abs(i/2)}function no(e,r,t,n){for(var i=e.length/3,o=0;o<i;o++){var a=o*3,s=e[a+0],l=e[a+1],c=e[a+2];e[a+r]=s,e[a+t]=l,e[a+n]=c}}function oo(e,r,t,n){var i=ht(e);i&&(i=i.map(function(d){return d/r}));var o=Ze(e),a=n&&r===3;if(t){var s=o.length;o=o.slice();for(var l=[],c=0;c<s;c+=r){l[0]=o[c],l[1]=o[c+1],a&&(l[2]=o[c+2]);var f=t(l);o[c]=f[0],o[c+1]=f[1],a&&(o[c+2]=f[2])}}if(a){var u=Xr(o,0,1),p=Xr(o,0,2),v=Xr(o,1,2);if(!u&&!p&&!v)return[];u>p&&u>v||(p>v?(t||(o=o.slice()),no(o,0,2,1)):(t||(o=o.slice()),no(o,2,0,1)))}return(0,io.default)(o,i,r)}var po=R(G());function so(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=nl(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function nl(e,r){if(e){if(typeof e=="string")return lo(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return lo(e,r)}}function lo(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function co(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function fo(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?co(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):co(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function il(e){var r=ol();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function ol(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vo=function(e){z(t,e);var r=il(t);function t(n){L(this,t);var i=n.fp64,o=n.IndexType,a=o===void 0?Uint32Array:o;return r.call(this,fo(fo({},n),{},{attributes:{positions:{size:3,type:i?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:a,size:1}}}))}return A(t,[{key:"get",value:function(i){var o=this.attributes;return i==="indices"?o.indices&&o.indices.subarray(0,this.vertexCount):o[i]}},{key:"updateGeometry",value:function(i){O(C(t.prototype),"updateGeometry",this).call(this,i);var o=this.buffers.indices;if(o)this.vertexCount=(o.value||o).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}},{key:"normalizeGeometry",value:function(i){if(this.normalize){var o=ir(i,this.positionSize);return this.opts.resolution?pt(Ze(o),ht(o),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?Gr(Ze(o),ht(o),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):o}return i}},{key:"getGeometrySize",value:function(i){if(uo(i)){var o=0,a=so(i),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;o+=this.getGeometrySize(l)}}catch(c){a.e(c)}finally{a.f()}return o}return Ze(i).length/this.positionSize}},{key:"getGeometryFromBuffer",value:function(i){return this.normalize||!this.buffers.indices?O(C(t.prototype),"getGeometryFromBuffer",this).call(this,i):null}},{key:"updateGeometryAttributes",value:function(i,o){if(i&&uo(i)){var a=so(i),s;try{for(a.s();!(s=a.n()).done;){var l=s.value,c=this.getGeometrySize(l);o.geometrySize=c,this.updateGeometryAttributes(l,o),o.vertexStart+=c,o.indexStart=this.indexStarts[o.geometryIndex+1]}}catch(f){a.e(f)}finally{a.f()}}else this._updateIndices(i,o),this._updatePositions(i,o),this._updateVertexValid(i,o)}},{key:"_updateIndices",value:function(i,o){var a=o.geometryIndex,s=o.vertexStart,l=o.indexStart,c=this.attributes,f=this.indexStarts,u=this.typedArrayManager,p=c.indices;if(!(!p||!i)){var v=l,d=oo(i,this.positionSize,this.opts.preproject,this.opts.full3d);p=u.allocate(p,l+d.length,{copy:!0});for(var h=0;h<d.length;h++)p[v++]=d[h]+s;f[a+1]=l+d.length,c.indices=p}}},{key:"_updatePositions",value:function(i,o){var a=o.vertexStart,s=o.geometrySize,l=this.attributes.positions,c=this.positionSize;if(!(!l||!i))for(var f=Ze(i),u=a,p=0;p<s;u++,p++){var v=f[p*c],d=f[p*c+1],h=c>2?f[p*c+2]:0;l[u*3]=v,l[u*3+1]=d,l[u*3+2]=h}}},{key:"_updateVertexValid",value:function(i,o){var a=o.vertexStart,s=o.geometrySize,l=this.positionSize,c=this.attributes.vertexValid,f=i&&ht(i);if(i&&i.edgeTypes?c.set(i.edgeTypes,a):c.fill(1,a,a+s),f)for(var u=0;u<f.length;u++)c[a+f[u]/l-1]=0;c[a+s-1]=0}}]),t}(po.Tesselator);function uo(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}var or=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var go=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(or,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`);var ho=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(or,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`);var mo=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function yo(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Ve(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?yo(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):yo(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function al(e){var r=sl();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function sl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sr=[0,0,0,255],ll={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(r){return r.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:sr},getLineColor:{type:"accessor",value:sr},material:!0},ar={enter:function(r,t){return t.length?t.subarray(t.length-r.length):r}},we=function(e){z(t,e);var r=al(t);function t(){var n;L(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),m(H(n),"state",void 0),n}return A(t,[{key:"getShaders",value:function(i){return O(C(t.prototype),"getShaders",this).call(this,{vs:i==="top"?go:ho,fs:mo,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Q.project32,Q.gouraudLighting,Q.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this,o=this.context,a=o.gl,s=o.viewport,l=this.props.coordinateSystem,c=this.props._full3d;s.isGeospatial&&l===Q.COORDINATE_SYSTEM.DEFAULT&&(l=Q.COORDINATE_SYSTEM.LNGLAT);var f;l===Q.COORDINATE_SYSTEM.LNGLAT&&(c?f=s.projectPosition.bind(s):f=s.projectFlat.bind(s)),this.setState({numInstances:0,polygonTesselator:new vo({preproject:f,fp64:this.use64bitPositions(),IndexType:!a||(0,ve.hasFeatures)(a,ve.FEATURES.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var u=this.getAttributeManager(),p=!0;u.remove(["instancePickingColors"]),u.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:p},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:ar,accessor:"getPolygon",update:this.calculatePositions,noAlloc:p,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:p},elevations:{size:1,transition:ar,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ar,accessor:"getFillColor",defaultValue:sr,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ar,accessor:"getLineColor",defaultValue:sr,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(d,h){var y=h.index,x=h.target;return i.encodePickingColor(d&&d.__source?d.__source.index:y,x)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"getPickingInfo",value:function(i){var o=O(C(t.prototype),"getPickingInfo",this).call(this,i),a=o.index,s=this.props.data;return s[0]&&s[0].__source&&(o.object=s.find(function(l){return l.__source.index===a})),o}},{key:"disablePickingIndex",value:function(i){var o=this.props.data;if(o[0]&&o[0].__source)for(var a=0;a<o.length;a++)o[a].__source.index===i&&this._disablePickingIndex(a);else O(C(t.prototype),"disablePickingIndex",this).call(this,i)}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.extruded,l=a.filled,c=a.wireframe,f=a.elevationScale,u=this.state,p=u.topModel,v=u.sideModel,d=u.polygonTesselator,h=Ve(Ve({},o),{},{extruded:Boolean(s),elevationScale:f});v&&(v.setInstanceCount(d.instanceCount-1),v.setUniforms(h),c&&(v.setDrawMode(3),v.setUniforms({isWireframe:!0}).draw()),l&&(v.setDrawMode(6),v.setUniforms({isWireframe:!1}).draw())),p&&(p.setVertexCount(d.vertexCount),p.setUniforms(h).draw())}},{key:"updateState",value:function(i){O(C(t.prototype),"updateState",this).call(this,i),this.updateGeometry(i);var o=i.props,a=i.oldProps,s=i.changeFlags,l=this.getAttributeManager(),c=s.extensionsChanged||o.filled!==a.filled||o.extruded!==a.extruded;if(c){var f;(f=this.state.models)===null||f===void 0||f.forEach(function(u){return u.delete()}),this.setState(this._getModels(this.context.gl)),l.invalidateAll()}}},{key:"updateGeometry",value:function(i){var o=i.props,a=i.oldProps,s=i.changeFlags,l=s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPolygon);if(l){var c=this.state.polygonTesselator,f=o.data.attributes||{};c.updateGeometry({data:o.data,normalize:o._normalize,geometryBuffer:f.getPolygon,buffers:f,getGeometry:o.getPolygon,positionFormat:o.positionFormat,wrapLongitude:o.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:s.dataChanged,full3d:o._full3d}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),s.dataChanged||this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(i){var o=this.props,a=o.id,s=o.filled,l=o.extruded,c,f;if(s){var u=this.getShaders("top");u.defines.NON_INSTANCED_MODEL=1,c=new ve.Model(i,Ve(Ve({},u),{},{id:"".concat(a,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0}))}return l&&(f=new ve.Model(i,Ve(Ve({},this.getShaders("side")),{},{id:"".concat(a,"-side"),geometry:new ve.Geometry({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1})),f.userData.excludeAttributes={indices:!0}),{models:[f,c].filter(Boolean),topModel:c,sideModel:f}}},{key:"calculateIndices",value:function(i){var o=this.state.polygonTesselator;i.startIndices=o.indexStarts,i.value=o.get("indices")}},{key:"calculatePositions",value:function(i){var o=this.state.polygonTesselator;i.startIndices=o.vertexStarts,i.value=o.get("positions")}},{key:"calculateVertexValid",value:function(i){i.value=this.state.polygonTesselator.get("vertexValid")}}]),t}(Q.Layer);m(we,"defaultProps",ll);m(we,"layerName","SolidPolygonLayer");function lr(e){for(var r=e.data,t=e.getIndex,n=e.dataRange,i=e.replace,o=n.startRow,a=o===void 0?0:o,s=n.endRow,l=s===void 0?1/0:s,c=r.length,f=c,u=c,p=0;p<c;p++){var v=t(r[p]);if(f>p&&v>=a&&(f=p),v>=l){u=p;break}}for(var d=f,h=u-f!==i.length,y=h?r.slice(u):void 0,x=0;x<i.length;x++)r[d++]=i[x];if(y){for(var S=0;S<y.length;S++)r[d++]=y[S];r.length=d}return{startRow:f,endRow:f+i.length}}function cl(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=fl(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function fl(e,r){if(e){if(typeof e=="string")return xo(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xo(e,r)}}function xo(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ul(e){var r=pl();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function pl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Po=[0,0,0,255],vl=[0,0,0,255],dl={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:function(r){return r.polygon}},getFillColor:{type:"accessor",value:vl},getLineColor:{type:"accessor",value:Po},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},cr=function(e){z(t,e);var r=ul(t);function t(){return L(this,t),r.apply(this,arguments)}return A(t,[{key:"initializeState",value:function(){this.state={paths:[]},this.props.getLineDashArray&&He.log.removed("getLineDashArray","PathStyleExtension")()}},{key:"updateState",value:function(i){var o=this,a=i.changeFlags,s=a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getPolygon);if(s&&Array.isArray(a.dataChanged)){var l=this.state.paths.slice(),c=a.dataChanged.map(function(f){return lr({data:l,getIndex:function(p){return p.__source.index},dataRange:f,replace:o._getPaths(f)})});this.setState({paths:l,pathsDiff:c})}else s&&this.setState({paths:this._getPaths(),pathsDiff:null})}},{key:"_getPaths",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=this.props,a=o.data,s=o.getPolygon,l=o.positionFormat,c=o._normalize,f=[],u=l==="XY"?2:3,p=i.startRow,v=i.endRow,d=(0,He.createIterable)(a,p,v),h=d.iterable,y=d.objectInfo,x=cl(h),S;try{for(x.s();!(S=x.n()).done;){var g=S.value;y.index++;var P=s(g,y);c&&(P=ir(P,u));var _=P,M=_.holeIndices,w=P.positions||P;if(M)for(var b=0;b<=M.length;b++){var T=w.slice(M[b-1]||0,M[b]||w.length);f.push(this.getSubLayerRow({path:T},g,y.index))}else f.push(this.getSubLayerRow({path:w},g,y.index))}}catch(D){x.e(D)}finally{x.f()}return f}},{key:"renderLayers",value:function(){var i=this.props,o=i.data,a=i._dataDiff,s=i.stroked,l=i.filled,c=i.extruded,f=i.wireframe,u=i._normalize,p=i._windingOrder,v=i.elevationScale,d=i.transitions,h=i.positionFormat,y=this.props,x=y.lineWidthUnits,S=y.lineWidthScale,g=y.lineWidthMinPixels,P=y.lineWidthMaxPixels,_=y.lineJointRounded,M=y.lineMiterLimit,w=y.lineDashJustified,b=this.props,T=b.getFillColor,D=b.getLineColor,k=b.getLineWidth,E=b.getLineDashArray,j=b.getElevation,I=b.getPolygon,W=b.updateTriggers,$=b.material,B=this.state,N=B.paths,U=B.pathsDiff,fe=this.getSubLayerClass("fill",we),ue=this.getSubLayerClass("stroke",Me),_t=this.shouldRenderSubLayer("fill",N)&&new fe({_dataDiff:a,extruded:c,elevationScale:v,filled:l,wireframe:f,_normalize:u,_windingOrder:p,getElevation:j,getFillColor:T,getLineColor:c&&f?D:Po,material:$,transitions:d},this.getSubLayerProps({id:"fill",updateTriggers:W&&{getPolygon:W.getPolygon,getElevation:W.getElevation,getFillColor:W.getFillColor,lineColors:c&&f,getLineColor:W.getLineColor}}),{data:o,positionFormat:h,getPolygon:I}),yr=!c&&s&&this.shouldRenderSubLayer("stroke",N)&&new ue({_dataDiff:U&&function(){return U},widthUnits:x,widthScale:S,widthMinPixels:g,widthMaxPixels:P,jointRounded:_,miterLimit:M,dashJustified:w,_pathType:"loop",transitions:d&&{getWidth:d.getLineWidth,getColor:d.getLineColor,getPath:d.getPolygon},getColor:this.getSubLayerAccessor(D),getWidth:this.getSubLayerAccessor(k),getDashArray:this.getSubLayerAccessor(E)},this.getSubLayerProps({id:"stroke",updateTriggers:W&&{getWidth:W.getLineWidth,getColor:W.getLineColor,getDashArray:W.getLineDashArray}}),{data:N,positionFormat:h,getPath:function(xr){return xr.path}});return[!c&&_t,yr,c&&_t]}}]),t}(He.CompositeLayer);m(cr,"layerName","PolygonLayer");m(cr,"defaultProps",dl);function Jr(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,o;for(o=0;o<n.length;o++)i=n[o],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}function qr(e,r){if(e==null)return{};var t=Jr(e,r),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}var pa=R(G());function _o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function gl(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?_o(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_o(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function So(e,r){if(!e)return null;var t="startIndices"in e?e.startIndices[r]:r,n=e.featureIds.value[t];return t!==-1?hl(e,n,t):null}function hl(e,r,t){var n={properties:gl({},e.properties[r])};for(var i in e.numericProps)n.properties[i]=e.numericProps[i].value[t];return n}function Mo(e,r){var t={points:null,lines:null,polygons:null};for(var n in t){var i=e[n].globalFeatureIds.value;t[n]=new Uint8ClampedArray(i.length*3);for(var o=[],a=0;a<i.length;a++)r(i[a],o),t[n][a*3+0]=o[0],t[n][a*3+1]=o[1],t[n][a*3+2]=o[2]}return t}var Ke=R(G());var Oo=R(G());var Co=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function wo(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function fr(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?wo(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):wo(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ml(e){var r=yl();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function yl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Qr=192/256,bo=[],xl={getIconOffsets:{type:"accessor",value:function(r){return r.offsets}},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},$e=function(e){z(t,e);var r=ml(t);function t(){var n;L(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),m(H(n),"state",void 0),n}return A(t,[{key:"getShaders",value:function(){return fr(fr({},O(C(t.prototype),"getShaders",this).call(this)),{},{fs:Co})}},{key:"initializeState",value:function(){var i=this;O(C(t.prototype),"initializeState",this).call(this);var o=this.getAttributeManager();o.addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:function(s,l){var c=l.index,f=l.target;return i.encodePickingColor(c,f)}}})}},{key:"updateState",value:function(i){O(C(t.prototype),"updateState",this).call(this,i);var o=i.props,a=i.oldProps,s=o.outlineColor;s!==a.outlineColor&&(s=s.map(function(l){return l/255}),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!o.sdf&&o.outlineWidth&&Oo.log.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}},{key:"draw",value:function(i){var o=this.props,a=o.sdf,s=o.smoothing,l=o.outlineWidth,c=this.state.outlineColor,f=l?Math.max(s,Qr*(1-l)):-1;if(i.uniforms=fr(fr({},i.uniforms),{},{sdfBuffer:Qr,outlineBuffer:f,gamma:s,sdf:Boolean(a),outlineColor:c}),O(C(t.prototype),"draw",this).call(this,i),a&&l){var u=this.state.iconManager,p=u.getTexture();p&&this.state.model.draw({uniforms:{outlineBuffer:Qr}})}}},{key:"getInstanceOffset",value:function(i){var o=this;return i?Array.from(i).flatMap(function(a){return O(C(t.prototype),"getInstanceOffset",o).call(o,a)}):bo}},{key:"getInstanceColorMode",value:function(i){return 1}},{key:"getInstanceIconFrame",value:function(i){var o=this;return i?Array.from(i).flatMap(function(a){return O(C(t.prototype),"getInstanceIconFrame",o).call(o,a)}):bo}}]),t}(me);m($e,"defaultProps",xl);m($e,"layerName","MultiIconLayer");var mt=class{constructor({fontSize:r=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:o="sans-serif",fontWeight:a="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=n;let l=this.size=r+t*4,c=this._createCanvas(l),f=this.ctx=c.getContext("2d",{willReadFrequently:!0});f.font=`${s} ${a} ${r}px ${o}`,f.textBaseline="alphabetic",f.textAlign="left",f.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(r){let t=document.createElement("canvas");return t.width=t.height=r,t}draw(r){let{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:o,actualBoundingBoxRight:a}=this.ctx.measureText(r),s=Math.ceil(n),l=0,c=Math.min(this.size-this.buffer,Math.ceil(a-o)),f=Math.min(this.size-this.buffer,s+Math.ceil(i)),u=c+2*this.buffer,p=f+2*this.buffer,v=Math.max(u*p,0),d=new Uint8ClampedArray(v),h={data:d,width:u,height:p,glyphWidth:c,glyphHeight:f,glyphTop:s,glyphLeft:l,glyphAdvance:t};if(c===0||f===0)return h;let{ctx:y,buffer:x,gridInner:S,gridOuter:g}=this;y.clearRect(x,x,c,f),y.fillText(r,x,x+s);let P=y.getImageData(x,x,c,f);g.fill(1e20,0,v),S.fill(0,0,v);for(let _=0;_<f;_++)for(let M=0;M<c;M++){let w=P.data[4*(_*c+M)+3]/255;if(w===0)continue;let b=(_+x)*u+M+x;if(w===1)g[b]=0,S[b]=1e20;else{let T=.5-w;g[b]=T>0?T*T:0,S[b]=T<0?T*T:0}}Lo(g,0,0,u,p,u,this.f,this.v,this.z),Lo(S,x,x,c,f,u,this.f,this.v,this.z);for(let _=0;_<v;_++){let M=Math.sqrt(g[_])-Math.sqrt(S[_]);d[_]=Math.round(255-255*(M/this.radius+this.cutoff))}return h}};function Lo(e,r,t,n,i,o,a,s,l){for(let c=r;c<r+n;c++)Ao(e,t*o+c,o,i,a,s,l);for(let c=t;c<t+i;c++)Ao(e,c*o+r,1,n,a,s,l)}function Ao(e,r,t,n,i,o,a){o[0]=0,a[0]=-1e20,a[1]=1e20,i[0]=e[r];for(let s=1,l=0,c=0;s<n;s++){i[s]=e[r+s*t];let f=s*s;do{let u=o[l];c=(i[s]-i[u]+f-u*u)/(s-u)/2}while(c<=a[l]&&--l>-1);l++,o[l]=s,a[l]=c,a[l+1]=1e20}for(let s=0,l=0;s<n;s++){for(;a[l+1]<s;)l++;let c=o[l],f=s-c;e[r+s*t]=i[c]+f*f}}var Ho=R(G());var Eo=R(G());function To(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Pl(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Pl(e,r){if(e){if(typeof e=="string")return Io(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Io(e,r)}}function Io(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var _l=32,Sl=[];function Ml(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function Ro(e){var r=e.characterSet,t=e.getFontWidth,n=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,s=a===void 0?{}:a,l=e.xOffset,c=l===void 0?0:l,f=e.yOffset,u=f===void 0?0:f,p=0,v=c,d=n+i*2,h=To(r),y;try{for(h.s();!(y=h.n()).done;){var x=y.value;if(!s[x]){var S=t(x);v+S+i*2>o&&(v=0,p++),s[x]={x:v+i,y:u+p*d+i,width:S,height:d,layoutWidth:S,layoutHeight:n},v+=S+i*2}}}catch(g){h.e(g)}finally{h.f()}return{mapping:s,xOffset:v,yOffset:u+p*d,canvasHeight:Ml(u+(p+1)*d)}}function zo(e,r,t,n){for(var i=0,o=r;o<t;o++){var a,s=e[o];i+=((a=n[s])===null||a===void 0?void 0:a.layoutWidth)||0}return i}function Fo(e,r,t,n,i,o){for(var a=r,s=0,l=r;l<t;l++){var c=zo(e,l,l+1,i);s+c>n&&(a<l&&o.push(l),a=l,s=0),s+=c}return s}function Cl(e,r,t,n,i,o){for(var a=r,s=r,l=r,c=0,f=r;f<t;f++)if((e[f]===" "||e[f+1]===" "||f+1===t)&&(l=f+1),l>s){var u=zo(e,s,l,i);c+u>n&&(a<s&&(o.push(s),a=s,c=0),u>n&&(u=Fo(e,s,l,n,i,o),a=o[o.length-1])),s=l,c+=u}return c}function wl(e,r,t,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0;o===void 0&&(o=e.length);var a=[];return r==="break-all"?Fo(e,i,o,t,n,a):Cl(e,i,o,t,n,a),a}function bl(e,r,t,n,i,o){for(var a=0,s=0,l=r;l<t;l++){var c=e[l],f=n[c];f?(s||(s=f.layoutHeight),i[l]=a+f.layoutWidth/2,a+=f.layoutWidth):(Eo.log.warn("Missing character: ".concat(c," (").concat(c.codePointAt(0),")"))(),i[l]=a,a+=_l)}o[0]=a,o[1]=s}function ko(e,r,t,n,i){for(var o=Array.from(e),a=o.length,s=new Array(a),l=new Array(a),c=new Array(a),f=(t==="break-word"||t==="break-all")&&isFinite(n)&&n>0,u=[0,0],p=[0,0],v=0,d=0,h=0,y=0;y<=a;y++){var x=o[y];if((x===`
`||y===a)&&(h=y),h>d){for(var S=f?wl(o,t,n,i,d,h):Sl,g=0;g<=S.length;g++){var P=g===0?d:S[g-1],_=g<S.length?S[g]:h;bl(o,P,_,i,s,p);for(var M=P;M<_;M++){var w,b=o[M],T=((w=i[b])===null||w===void 0?void 0:w.layoutOffsetY)||0;l[M]=v+p[1]/2+T,c[M]=p[0]}v=v+p[1]*r,u[0]=Math.max(u[0],p[0])}d=h}x===`
`&&(s[d]=0,l[d]=0,c[d]=0,d++)}return u[1]=v,{x:s,y:l,rowWidth:c,size:u}}function Do(e){var r=e.value,t=e.length,n=e.stride,i=e.offset,o=e.startIndices,a=e.characterSet,s=r.BYTES_PER_ELEMENT,l=n?n/s:1,c=i?i/s:0,f=o[t]||Math.ceil((r.length-c)/l),u=a&&new Set,p=new Array(t),v=r;if(l>1||c>0){var d=r.constructor;v=new d(f);for(var h=0;h<f;h++)v[h]=r[h*l+c]}for(var y=0;y<t;y++){var x=o[y],S=o[y+1]||f,g=v.subarray(x,S);p[y]=String.fromCodePoint.apply(null,g),u&&g.forEach(u.add,u)}if(u){var P=To(u),_;try{for(P.s();!(_=P.n()).done;){var M=_.value;a.add(String.fromCodePoint(M))}}catch(w){P.e(w)}finally{P.f()}}return{texts:p,characterCount:f}}var en=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:5;L(this,e),m(this,"limit",void 0),m(this,"_cache",{}),m(this,"_order",[]),this.limit=r}return A(e,[{key:"get",value:function(t){var n=this._cache[t];return n&&(this._deleteOrder(t),this._appendOrder(t)),n}},{key:"set",value:function(t,n){this._cache[t]?(this.delete(t),this._cache[t]=n,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=n,this._appendOrder(t))}},{key:"delete",value:function(t){var n=this._cache[t];n&&(delete this._cache[t],this._deleteOrder(t))}},{key:"_deleteOrder",value:function(t){var n=this._order.indexOf(t);n>=0&&this._order.splice(n,1)}},{key:"_appendOrder",value:function(t){this._order.push(t)}}]),e}();function jo(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ol(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Ol(e,r){if(e){if(typeof e=="string")return No(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return No(e,r)}}function No(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Wo(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Uo(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Wo(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Wo(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ll(){for(var e=[],r=32;r<128;r++)e.push(String.fromCharCode(r));return e}var Ie={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:Ll(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},Bo=1024,Go=.9,Zo=1.2,$o=3,ur=new en($o);function Al(e,r){var t;typeof r=="string"?t=new Set(Array.from(r)):t=new Set(r);var n=ur.get(e);if(!n)return t;for(var i in n.mapping)t.has(i)&&t.delete(i);return t}function Il(e,r){for(var t=0;t<e.length;t++)r.data[4*t+3]=e[t]}function Vo(e,r,t,n){e.font="".concat(n," ").concat(t,"px ").concat(r),e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}function Yo(e){Ho.log.assert(Number.isFinite(e)&&e>=$o,"Invalid cache limit"),ur=new en(e)}var Ko=function(){function e(){L(this,e),m(this,"props",Uo({},Ie)),m(this,"_key",void 0),m(this,"_atlas",void 0)}return A(e,[{key:"texture",get:function(){return this._atlas}},{key:"mapping",get:function(){return this._atlas&&this._atlas.mapping}},{key:"scale",get:function(){var t=this.props,n=t.fontSize,i=t.buffer;return(n*Zo+i*2)/n}},{key:"setProps",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this.props,t),this._key=this._getKey();var n=Al(this._key,this.props.characterSet),i=ur.get(this._key);if(i&&n.size===0){this._atlas!==i&&(this._atlas=i);return}var o=this._generateFontAtlas(n,i);this._atlas=o,ur.set(this._key,o)}},{key:"_generateFontAtlas",value:function(t,n){var i=this.props,o=i.fontFamily,a=i.fontWeight,s=i.fontSize,l=i.buffer,c=i.sdf,f=i.radius,u=i.cutoff,p=n&&n.data;p||(p=document.createElement("canvas"),p.width=Bo);var v=p.getContext("2d",{willReadFrequently:!0});Vo(v,o,s,a);var d=Ro(Uo({getFontWidth:function(N){return v.measureText(N).width},fontHeight:s*Zo,buffer:l,characterSet:t,maxCanvasWidth:Bo},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),h=d.mapping,y=d.canvasHeight,x=d.xOffset,S=d.yOffset;if(p.height!==y){var g=v.getImageData(0,0,p.width,p.height);p.height=y,v.putImageData(g,0,0)}if(Vo(v,o,s,a),c){var P=new mt({fontSize:s,buffer:l,radius:f,cutoff:u,fontFamily:o,fontWeight:"".concat(a)}),_=jo(t),M;try{for(_.s();!(M=_.n()).done;){var w=M.value,b=P.draw(w),T=b.data,D=b.width,k=b.height,E=b.glyphTop;h[w].width=D,h[w].layoutOffsetY=s*Go-E;var j=v.createImageData(D,k);Il(T,j),v.putImageData(j,h[w].x,h[w].y)}}catch(B){_.e(B)}finally{_.f()}}else{var I=jo(t),W;try{for(I.s();!(W=I.n()).done;){var $=W.value;v.fillText($,h[$].x,h[$].y+l+s*Go)}}catch(B){I.e(B)}finally{I.f()}}return{xOffset:x,yOffset:S,mapping:h,data:p,width:p.width,height:p.height}}},{key:"_getKey",value:function(){var t=this.props,n=t.fontFamily,i=t.fontWeight,o=t.fontSize,a=t.buffer,s=t.sdf,l=t.radius,c=t.cutoff;return s?"".concat(n," ").concat(i," ").concat(o," ").concat(a," ").concat(l," ").concat(c):"".concat(n," ").concat(i," ").concat(o," ").concat(a)}}]),e}();var be=R(G()),pr=R(K());var Xo=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var Jo=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function qo(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Qo(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?qo(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):qo(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Tl(e){var r=El();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function El(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Rl={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:function(r){return r.position}},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},Ye=function(e){z(t,e);var r=Tl(t);function t(){var n;L(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),m(H(n),"state",void 0),n}return A(t,[{key:"getShaders",value:function(){return O(C(t.prototype),"getShaders",this).call(this,{vs:Xo,fs:Jo,modules:[be.project32,be.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(i){O(C(t.prototype),"updateState",this).call(this,i);var o=i.changeFlags;if(o.extensionsChanged){var a,s=this.context.gl;(a=this.state.model)===null||a===void 0||a.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.billboard,l=a.sizeScale,c=a.sizeUnits,f=a.sizeMinPixels,u=a.sizeMaxPixels,p=a.getLineWidth,v=this.props.padding;v.length<4&&(v=[v[0],v[1],v[0],v[1]]),this.state.model.setUniforms(o).setUniforms({billboard:s,stroked:Boolean(p),padding:v,sizeUnits:be.UNIT[c],sizeScale:l,sizeMinPixels:f,sizeMaxPixels:u}).draw()}},{key:"_getModel",value:function(i){var o=[0,0,1,0,1,1,0,1];return new pr.Model(i,Qo(Qo({},this.getShaders()),{},{id:this.props.id,geometry:new pr.Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(o)}}}),isInstanced:!0}))}}]),t}(be.Layer);m(Ye,"defaultProps",Rl);m(Ye,"layerName","TextBackgroundLayer");function zl(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Fl(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Fl(e,r){if(e){if(typeof e=="string")return ea(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ea(e,r)}}function ea(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ta(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function vr(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?ta(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ta(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function kl(e){var r=Dl();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function Dl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ra={start:1,middle:0,end:-1},na={top:1,center:0,bottom:-1},tn=[0,0,0,255],jl=1,Nl={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:tn},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Ie.characterSet},fontFamily:Ie.fontFamily,fontWeight:Ie.fontWeight,lineHeight:jl,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:tn},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:function(r){return r.text}},getPosition:{type:"accessor",value:function(r){return r.position}},getColor:{type:"accessor",value:tn},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},Xe=function(e){z(t,e);var r=kl(t);function t(){var n;L(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),m(H(n),"state",void 0),m(H(n),"getBoundingRect",function(s,l){var c=n.transformParagraph(s,l),f=Z(c.size,2),u=f[0],p=f[1],v=n.state.fontAtlasManager.props.fontSize;u/=v,p/=v;var d=n.props,h=d.getTextAnchor,y=d.getAlignmentBaseline,x=ra[typeof h=="function"?h(s,l):h],S=na[typeof y=="function"?y(s,l):y];return[(x-1)*u/2,(S-1)*p/2,u,p]}),m(H(n),"getIconOffsets",function(s,l){for(var c=n.props,f=c.getTextAnchor,u=c.getAlignmentBaseline,p=n.transformParagraph(s,l),v=p.x,d=p.y,h=p.rowWidth,y=Z(p.size,2),x=y[0],S=y[1],g=ra[typeof f=="function"?f(s,l):f],P=na[typeof u=="function"?u(s,l):u],_=v.length,M=new Array(_*2),w=0,b=0;b<_;b++){var T=(1-g)*(x-h[b])/2;M[w++]=(g-1)*x/2+T+v[b],M[w++]=(P-1)*S/2+d[b]}return M}),n}return A(t,[{key:"initializeState",value:function(){this.state={styleVersion:0,fontAtlasManager:new Ko},this.props.maxWidth>0&&Ke.log.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}},{key:"updateState",value:function(i){var o=i.props,a=i.oldProps,s=i.changeFlags,l=s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText);l&&this._updateText();var c=this._updateFontAtlas(),f=c||o.lineHeight!==a.lineHeight||o.wordBreak!==a.wordBreak||o.maxWidth!==a.maxWidth;f&&this.setState({styleVersion:this.state.styleVersion+1})}},{key:"getPickingInfo",value:function(i){var o=i.info;return o.object=o.index>=0?this.props.data[o.index]:null,o}},{key:"_updateFontAtlas",value:function(){var i=this.props,o=i.fontSettings,a=i.fontFamily,s=i.fontWeight,l=this.state,c=l.fontAtlasManager,f=l.characterSet,u=vr(vr({},o),{},{characterSet:f,fontFamily:a,fontWeight:s});if(!c.mapping)return c.setProps(u),!0;for(var p in u)if(u[p]!==c.props[p])return c.setProps(u),!0;return!1}},{key:"_updateText",value:function(){var i,o=this.props,a=o.data,s=o.characterSet,l=(i=a.attributes)===null||i===void 0?void 0:i.getText,c=this.props.getText,f=a.startIndices,u,p=s==="auto"&&new Set;if(l&&f){var v=Do(vr(vr({},ArrayBuffer.isView(l)?{value:l}:l),{},{length:a.length,startIndices:f,characterSet:p})),d=v.texts,h=v.characterCount;u=h,c=function(b,T){var D=T.index;return d[D]}}else{var y=(0,Ke.createIterable)(a),x=y.iterable,S=y.objectInfo;f=[0],u=0;var g=zl(x),P;try{for(g.s();!(P=g.n()).done;){var _=P.value;S.index++;var M=Array.from(c(_,S)||"");p&&M.forEach(p.add,p),u+=M.length,f.push(u)}}catch(w){g.e(w)}finally{g.f()}}this.setState({getText:c,startIndices:f,numInstances:u,characterSet:p||s})}},{key:"transformParagraph",value:function(i,o){var a=this.state.fontAtlasManager,s=a.mapping,l=this.state.getText,c=this.props,f=c.wordBreak,u=c.lineHeight,p=c.maxWidth,v=l(i,o)||"";return ko(v,u,f,p*a.props.fontSize,s)}},{key:"renderLayers",value:function(){var i=this.state,o=i.startIndices,a=i.numInstances,s=i.getText,l=i.fontAtlasManager,c=l.scale,f=l.texture,u=l.mapping,p=i.styleVersion,v=this.props,d=v.data,h=v._dataDiff,y=v.getPosition,x=v.getColor,S=v.getSize,g=v.getAngle,P=v.getPixelOffset,_=v.getBackgroundColor,M=v.getBorderColor,w=v.getBorderWidth,b=v.backgroundPadding,T=v.background,D=v.billboard,k=v.fontSettings,E=v.outlineWidth,j=v.outlineColor,I=v.sizeScale,W=v.sizeUnits,$=v.sizeMinPixels,B=v.sizeMaxPixels,N=v.transitions,U=v.updateTriggers,fe=this.getSubLayerClass("characters",$e),ue=this.getSubLayerClass("background",Ye);return[T&&new ue({getFillColor:_,getLineColor:M,getLineWidth:w,padding:b,getPosition:y,getSize:S,getAngle:g,getPixelOffset:P,billboard:D,sizeScale:I,sizeUnits:W,sizeMinPixels:$,sizeMaxPixels:B,transitions:N&&{getPosition:N.getPosition,getAngle:N.getAngle,getSize:N.getSize,getFillColor:N.getBackgroundColor,getLineColor:N.getBorderColor,getLineWidth:N.getBorderWidth,getPixelOffset:N.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:U.getPosition,getAngle:U.getAngle,getSize:U.getSize,getFillColor:U.getBackgroundColor,getLineColor:U.getBorderColor,getLineWidth:U.getBorderWidth,getPixelOffset:U.getPixelOffset,getBoundingRect:{getText:U.getText,getTextAnchor:U.getTextAnchor,getAlignmentBaseline:U.getAlignmentBaseline,styleVersion:p}}}),{data:d.attributes&&d.attributes.background?{length:d.length,attributes:d.attributes.background}:d,_dataDiff:h,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new fe({sdf:k.sdf,smoothing:Number.isFinite(k.smoothing)?k.smoothing:Ie.smoothing,outlineWidth:E/(k.radius||Ie.radius),outlineColor:j,iconAtlas:f,iconMapping:u,getPosition:y,getColor:x,getSize:S,getAngle:g,getPixelOffset:P,billboard:D,sizeScale:I*c,sizeUnits:W,sizeMinPixels:$*c,sizeMaxPixels:B*c,transitions:N&&{getPosition:N.getPosition,getAngle:N.getAngle,getColor:N.getColor,getSize:N.getSize,getPixelOffset:N.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:U.getText,getPosition:U.getPosition,getAngle:U.getAngle,getColor:U.getColor,getSize:U.getSize,getPixelOffset:U.getPixelOffset,getIconOffsets:{getTextAnchor:U.getTextAnchor,getAlignmentBaseline:U.getAlignmentBaseline,styleVersion:p}}}),{data:d,_dataDiff:h,startIndices:o,numInstances:a,getIconOffsets:this.getIconOffsets,getIcon:s})]}}],[{key:"fontAtlasCacheLimit",set:function(i){Yo(i)}}]),t}(Ke.CompositeLayer);m(Xe,"defaultProps",Nl);m(Xe,"layerName","TextLayer");var yt={circle:{type:We,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:me,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Xe,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},xt={type:Me,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},dr={type:we,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Je(e){var r=e.type,t=e.props,n={};for(var i in t)n[i]=r.defaultProps[t[i]];return n}function gr(e,r){var t=e.props,n=t.transitions,i=t.updateTriggers,o={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(var a in r){var s=r[a],l=e.props[a];a.startsWith("get")&&(l=e.getSubLayerAccessor(l),o.updateTriggers[s]=i[a],n&&(o.transitions[s]=n[a])),o[s]=l}return o}var qe=R(G());function oa(e){if(Array.isArray(e))return e;switch(qe.log.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return qe.log.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}function rn(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},i=t.startRow,o=i===void 0?0:i,a=t.endRow,s=a===void 0?e.length:a,l=o;l<s;l++){var c=e[l],f=c.geometry;if(f)if(f.type==="GeometryCollection"){qe.log.assert(Array.isArray(f.geometries),"GeoJSON does not have geometries array");for(var u=f.geometries,p=0;p<u.length;p++){var v=u[p];ia(v,n,r,c,l)}}else ia(f,n,r,c,l)}return n}function ia(e,r,t,n,i){var o=e.type,a=e.coordinates,s=r.pointFeatures,l=r.lineFeatures,c=r.polygonFeatures,f=r.polygonOutlineFeatures;if(!Ul(o,a)){qe.log.warn("".concat(o," coordinates are malformed"))();return}switch(o){case"Point":s.push(t({geometry:e},n,i));break;case"MultiPoint":a.forEach(function(u){s.push(t({geometry:{type:"Point",coordinates:u}},n,i))});break;case"LineString":l.push(t({geometry:e},n,i));break;case"MultiLineString":a.forEach(function(u){l.push(t({geometry:{type:"LineString",coordinates:u}},n,i))});break;case"Polygon":c.push(t({geometry:e},n,i)),a.forEach(function(u){f.push(t({geometry:{type:"LineString",coordinates:u}},n,i))});break;case"MultiPolygon":a.forEach(function(u){c.push(t({geometry:{type:"Polygon",coordinates:u}},n,i)),u.forEach(function(p){f.push(t({geometry:{type:"LineString",coordinates:p}},n,i))})});break;default:}}var Wl={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Ul(e,r){var t=Wl[e];for(qe.log.assert(t,"Unknown GeoJSON type ".concat(e));r&&--t>0;)r=r[0];return r&&Number.isFinite(r[0])}function aa(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Oe(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?aa(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):aa(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function sa(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function hr(e){return e.geometry.coordinates}function la(e,r){var t=sa(),n=e.pointFeatures,i=e.lineFeatures,o=e.polygonFeatures,a=e.polygonOutlineFeatures;return t.points.data=n,t.points._dataDiff=r.pointFeatures&&function(){return r.pointFeatures},t.points.getPosition=hr,t.lines.data=i,t.lines._dataDiff=r.lineFeatures&&function(){return r.lineFeatures},t.lines.getPath=hr,t.polygons.data=o,t.polygons._dataDiff=r.polygonFeatures&&function(){return r.polygonFeatures},t.polygons.getPolygon=hr,t.polygonsOutline.data=a,t.polygonsOutline._dataDiff=r.polygonOutlineFeatures&&function(){return r.polygonOutlineFeatures},t.polygonsOutline.getPath=hr,t}function ca(e,r){var t=sa(),n=e.points,i=e.lines,o=e.polygons,a=Mo(e,r);return t.points.data={length:n.positions.value.length/n.positions.size,attributes:Oe(Oe({},n.attributes),{},{getPosition:n.positions,instancePickingColors:{size:3,value:a.points}}),properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},t.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:Oe(Oe({},i.attributes),{},{getPath:i.positions,instancePickingColors:{size:3,value:a.lines}}),properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines._pathType="open",t.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:Oe(Oe({},o.attributes),{},{getPolygon:o.positions,pickingColors:{size:3,value:a.polygons}}),properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygons._normalize=!1,o.triangles&&(t.polygons.data.attributes.indices=o.triangles.value),t.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:Oe(Oe({},o.attributes),{},{getPath:o.positions,instancePickingColors:{size:3,value:a.polygons}}),properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygonsOutline._pathType="open",t}var Bl=["instancePickingColors"];function nn(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Gl(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Gl(e,r){if(e){if(typeof e=="string")return fa(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return fa(e,r)}}function fa(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Zl(e){var r=Vl();return function(){var n=C(e),i;if(r){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return F(this,i)}}function Vl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ua(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function ce(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?ua(Object(t),!0).forEach(function(n){m(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ua(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Hl=["points","linestrings","polygons"],$l=ce(ce(ce(ce(ce(ce({},Je(yt.circle)),Je(yt.icon)),Je(yt.text)),Je(xt)),Je(dr)),{},{stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:function(r){return r.properties.icon}},getText:{type:"accessor",value:function(r){return r.properties.text}},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}}),mr=function(e){z(t,e);var r=Zl(t);function t(){return L(this,t),r.apply(this,arguments)}return A(t,[{key:"initializeState",value:function(){this.state={layerProps:{},features:{}}}},{key:"updateState",value:function(i){var o=i.props,a=i.changeFlags;if(a.dataChanged){var s=this.props.data,l=s&&"points"in s&&"polygons"in s&&"lines"in s;this.setState({binary:l}),l?this._updateStateBinary({props:o,changeFlags:a}):this._updateStateJSON({props:o,changeFlags:a})}}},{key:"_updateStateBinary",value:function(i){var o=i.props,a=i.changeFlags,s=ca(o.data,this.encodePickingColor);this.setState({layerProps:s})}},{key:"_updateStateJSON",value:function(i){var o=i.props,a=i.changeFlags,s=oa(o.data),l=this.getSubLayerRow.bind(this),c={},f={};if(Array.isArray(a.dataChanged)){var u=this.state.features;for(var p in u)c[p]=u[p].slice(),f[p]=[];var v=nn(a.dataChanged),d;try{for(v.s();!(d=v.n()).done;){var h=d.value,y=rn(s,l,h);for(var x in u)f[x].push(lr({data:c[x],getIndex:function(P){return P.__source.index},dataRange:h,replace:y[x]}))}}catch(g){v.e(g)}finally{v.f()}}else c=rn(s,l);var S=la(c,f);this.setState({features:c,featuresDiff:f,layerProps:S})}},{key:"getPickingInfo",value:function(i){var o=this,a=O(C(t.prototype),"getPickingInfo",this).call(this,i),s=a.index,l=a.sourceLayer;return a.featureType=Hl.find(function(c){return l.id.startsWith("".concat(o.id,"-").concat(c,"-"))}),s>=0&&l.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(a.index=this.props.data.points.globalFeatureIds.value[s]),a}},{key:"_updateAutoHighlight",value:function(i){var o="".concat(this.id,"-points-"),a=i.featureType==="points",s=nn(this.getSubLayers()),l;try{for(s.s();!(l=s.n()).done;){var c=l.value;c.id.startsWith(o)===a&&c.updateAutoHighlight(i)}}catch(f){s.e(f)}finally{s.f()}}},{key:"_renderPolygonLayer",value:function(){var i=this.props,o=i.extruded,a=i.wireframe,s=this.state.layerProps,l="polygons-fill",c=this.shouldRenderSubLayer(l,s.polygons.data)&&this.getSubLayerClass(l,dr.type);if(c){var f=gr(this,dr.props),u=o&&a;return u||delete f.getLineColor,f.updateTriggers.lineColors=u,new c(f,this.getSubLayerProps({id:l,updateTriggers:f.updateTriggers}),s.polygons)}return null}},{key:"_renderLineLayers",value:function(){var i=this.props,o=i.extruded,a=i.stroked,s=this.state.layerProps,l="polygons-stroke",c="linestrings",f=!o&&a&&this.shouldRenderSubLayer(l,s.polygonsOutline.data)&&this.getSubLayerClass(l,xt.type),u=this.shouldRenderSubLayer(c,s.lines.data)&&this.getSubLayerClass(c,xt.type);if(f||u){var p=gr(this,xt.props);return[f&&new f(p,this.getSubLayerProps({id:l,updateTriggers:p.updateTriggers}),s.polygonsOutline),u&&new u(p,this.getSubLayerProps({id:c,updateTriggers:p.updateTriggers}),s.lines)]}return null}},{key:"_renderPointLayers",value:function(){var i=this.props.pointType,o=this.state,a=o.layerProps,s=o.binary,l=this.props.highlightedObjectIndex;!s&&Number.isFinite(l)&&(l=a.points.data.findIndex(function(M){return M.__source.index===l}));var c=new Set(i.split("+")),f=[],u=nn(c),p;try{for(u.s();!(p=u.n()).done;){var v=p.value,d="points-".concat(v),h=yt[v],y=h&&this.shouldRenderSubLayer(d,a.points.data)&&this.getSubLayerClass(d,h.type);if(y){var x=gr(this,h.props),S=a.points;if(v==="text"&&s){var g=S.data.attributes,P=g.instancePickingColors,_=qr(g,Bl);S=ce(ce({},S),{},{data:ce(ce({},S.data),{},{attributes:_})})}f.push(new y(x,this.getSubLayerProps({id:d,updateTriggers:x.updateTriggers,highlightedObjectIndex:l}),S))}}}catch(M){u.e(M)}finally{u.f()}return f}},{key:"renderLayers",value:function(){var i=this.props.extruded,o=this._renderPolygonLayer(),a=this._renderLineLayers(),s=this._renderPointLayers();return[!i&&o,a,s,i&&o]}},{key:"getSubLayerAccessor",value:function(i){var o=this.state.binary;return!o||typeof i!="function"?O(C(t.prototype),"getSubLayerAccessor",this).call(this,i):function(a,s){var l=s.data,c=s.index,f=So(l,c);return i(f,s)}}}]),t}(pa.CompositeLayer);m(mr,"layerName","GeoJsonLayer");m(mr,"defaultProps",$l);return Pa(Pt);})();
      return __exports__;
      });
