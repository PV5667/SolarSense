(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === 'object' && typeof module === 'object')
    module.exports = factory();
  else if (typeof define === 'function' && define.amd) define([], factory);
        else if (typeof exports === 'object') exports['deck'] = factory();
  else root['deck'] = factory();})(globalThis, function () {
"use strict";var __exports__=(()=>{var Yb=Object.create;var wo=Object.defineProperty;var Xb=Object.getOwnPropertyDescriptor;var qb=Object.getOwnPropertyNames;var Zb=Object.getPrototypeOf,Kb=Object.prototype.hasOwnProperty;var qn=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports),xo=(t,r)=>{for(var e in r)wo(t,e,{get:r[e],enumerable:!0})},Zh=(t,r,e,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of qb(r))!Kb.call(t,i)&&i!==e&&wo(t,i,{get:()=>r[i],enumerable:!(n=Xb(r,i))||n.enumerable});return t};var Be=(t,r,e)=>(e=t!=null?Yb(Zb(t)):{},Zh(r||!t||!t.__esModule?wo(e,"default",{value:t,enumerable:!0}):e,t)),Qb=t=>Zh(wo({},"__esModule",{value:!0}),t);var Vp=qn((RL,If)=>{var Cf=function(t){"use strict";var r=Object.prototype,e=r.hasOwnProperty,n,i=typeof Symbol=="function"?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(C,k,U){return Object.defineProperty(C,k,{value:U,enumerable:!0,configurable:!0,writable:!0}),C[k]}try{u({},"")}catch{u=function(k,U,$){return k[U]=$}}function f(C,k,U,$){var q=k&&k.prototype instanceof g?k:g,J=Object.create(q.prototype),re=new G($||[]);return J._invoke=j(C,U,re),J}t.wrap=f;function c(C,k,U){try{return{type:"normal",arg:C.call(k,U)}}catch($){return{type:"throw",arg:$}}}var h="suspendedStart",p="suspendedYield",d="executing",v="completed",m={};function g(){}function _(){}function w(){}var x={};u(x,a,function(){return this});var P=Object.getPrototypeOf,E=P&&P(P(B([])));E&&E!==r&&e.call(E,a)&&(x=E);var A=w.prototype=g.prototype=Object.create(x);_.prototype=w,u(A,"constructor",w),u(w,"constructor",_),_.displayName=u(w,s,"GeneratorFunction");function R(C){["next","throw","return"].forEach(function(k){u(C,k,function(U){return this._invoke(k,U)})})}t.isGeneratorFunction=function(C){var k=typeof C=="function"&&C.constructor;return k?k===_||(k.displayName||k.name)==="GeneratorFunction":!1},t.mark=function(C){return Object.setPrototypeOf?Object.setPrototypeOf(C,w):(C.__proto__=w,u(C,s,"GeneratorFunction")),C.prototype=Object.create(A),C},t.awrap=function(C){return{__await:C}};function D(C,k){function U(J,re,ae,le){var ge=c(C[J],C,re);if(ge.type==="throw")le(ge.arg);else{var oe=ge.arg,ye=oe.value;return ye&&typeof ye=="object"&&e.call(ye,"__await")?k.resolve(ye.__await).then(function(se){U("next",se,ae,le)},function(se){U("throw",se,ae,le)}):k.resolve(ye).then(function(se){oe.value=se,ae(oe)},function(se){return U("throw",se,ae,le)})}}var $;function q(J,re){function ae(){return new k(function(le,ge){U(J,re,le,ge)})}return $=$?$.then(ae,ae):ae()}this._invoke=q}R(D.prototype),u(D.prototype,o,function(){return this}),t.AsyncIterator=D,t.async=function(C,k,U,$,q){q===void 0&&(q=Promise);var J=new D(f(C,k,U,$),q);return t.isGeneratorFunction(k)?J:J.next().then(function(re){return re.done?re.value:J.next()})};function j(C,k,U){var $=h;return function(J,re){if($===d)throw new Error("Generator is already running");if($===v){if(J==="throw")throw re;return K()}for(U.method=J,U.arg=re;;){var ae=U.delegate;if(ae){var le=I(ae,U);if(le){if(le===m)continue;return le}}if(U.method==="next")U.sent=U._sent=U.arg;else if(U.method==="throw"){if($===h)throw $=v,U.arg;U.dispatchException(U.arg)}else U.method==="return"&&U.abrupt("return",U.arg);$=d;var ge=c(C,k,U);if(ge.type==="normal"){if($=U.done?v:p,ge.arg===m)continue;return{value:ge.arg,done:U.done}}else ge.type==="throw"&&($=v,U.method="throw",U.arg=ge.arg)}}}function I(C,k){var U=C.iterator[k.method];if(U===n){if(k.delegate=null,k.method==="throw"){if(C.iterator.return&&(k.method="return",k.arg=n,I(C,k),k.method==="throw"))return m;k.method="throw",k.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var $=c(U,C.iterator,k.arg);if($.type==="throw")return k.method="throw",k.arg=$.arg,k.delegate=null,m;var q=$.arg;if(!q)return k.method="throw",k.arg=new TypeError("iterator result is not an object"),k.delegate=null,m;if(q.done)k[C.resultName]=q.value,k.next=C.nextLoc,k.method!=="return"&&(k.method="next",k.arg=n);else return q;return k.delegate=null,m}R(A),u(A,s,"Generator"),u(A,a,function(){return this}),u(A,"toString",function(){return"[object Generator]"});function V(C){var k={tryLoc:C[0]};1 in C&&(k.catchLoc=C[1]),2 in C&&(k.finallyLoc=C[2],k.afterLoc=C[3]),this.tryEntries.push(k)}function F(C){var k=C.completion||{};k.type="normal",delete k.arg,C.completion=k}function G(C){this.tryEntries=[{tryLoc:"root"}],C.forEach(V,this),this.reset(!0)}t.keys=function(C){var k=[];for(var U in C)k.push(U);return k.reverse(),function $(){for(;k.length;){var q=k.pop();if(q in C)return $.value=q,$.done=!1,$}return $.done=!0,$}};function B(C){if(C){var k=C[a];if(k)return k.call(C);if(typeof C.next=="function")return C;if(!isNaN(C.length)){var U=-1,$=function q(){for(;++U<C.length;)if(e.call(C,U))return q.value=C[U],q.done=!1,q;return q.value=n,q.done=!0,q};return $.next=$}}return{next:K}}t.values=B;function K(){return{value:n,done:!0}}return G.prototype={constructor:G,reset:function(C){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(F),!C)for(var k in this)k.charAt(0)==="t"&&e.call(this,k)&&!isNaN(+k.slice(1))&&(this[k]=n)},stop:function(){this.done=!0;var C=this.tryEntries[0],k=C.completion;if(k.type==="throw")throw k.arg;return this.rval},dispatchException:function(C){if(this.done)throw C;var k=this;function U(le,ge){return J.type="throw",J.arg=C,k.next=le,ge&&(k.method="next",k.arg=n),!!ge}for(var $=this.tryEntries.length-1;$>=0;--$){var q=this.tryEntries[$],J=q.completion;if(q.tryLoc==="root")return U("end");if(q.tryLoc<=this.prev){var re=e.call(q,"catchLoc"),ae=e.call(q,"finallyLoc");if(re&&ae){if(this.prev<q.catchLoc)return U(q.catchLoc,!0);if(this.prev<q.finallyLoc)return U(q.finallyLoc)}else if(re){if(this.prev<q.catchLoc)return U(q.catchLoc,!0)}else if(ae){if(this.prev<q.finallyLoc)return U(q.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(C,k){for(var U=this.tryEntries.length-1;U>=0;--U){var $=this.tryEntries[U];if($.tryLoc<=this.prev&&e.call($,"finallyLoc")&&this.prev<$.finallyLoc){var q=$;break}}q&&(C==="break"||C==="continue")&&q.tryLoc<=k&&k<=q.finallyLoc&&(q=null);var J=q?q.completion:{};return J.type=C,J.arg=k,q?(this.method="next",this.next=q.finallyLoc,m):this.complete(J)},complete:function(C,k){if(C.type==="throw")throw C.arg;return C.type==="break"||C.type==="continue"?this.next=C.arg:C.type==="return"?(this.rval=this.arg=C.arg,this.method="return",this.next="end"):C.type==="normal"&&k&&(this.next=k),m},finish:function(C){for(var k=this.tryEntries.length-1;k>=0;--k){var U=this.tryEntries[k];if(U.finallyLoc===C)return this.complete(U.completion,U.afterLoc),F(U),m}},catch:function(C){for(var k=this.tryEntries.length-1;k>=0;--k){var U=this.tryEntries[k];if(U.tryLoc===C){var $=U.completion;if($.type==="throw"){var q=$.arg;F(U)}return q}}throw new Error("illegal catch attempt")},delegateYield:function(C,k,U){return this.delegate={iterator:B(C),resultName:k,nextLoc:U},this.method==="next"&&(this.arg=n),m}},t}(typeof If=="object"?If.exports:{});try{regeneratorRuntime=Cf}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=Cf:Function("r","regeneratorRuntime = r")(Cf)}});var Ge=qn((CL,zp)=>{zp.exports=Vp()});var i0=qn((gZ,_u)=>{(function(t,r,e,n){"use strict";var i=["","webkit","Moz","MS","ms","o"],a=r.createElement("div"),o="function",s=Math.round,u=Math.abs,f=Date.now;function c(y,b,O){return setTimeout(w(y,O),b)}function h(y,b,O){return Array.isArray(y)?(p(y,O[b],O),!0):!1}function p(y,b,O){var L;if(y)if(y.forEach)y.forEach(b,O);else if(y.length!==n)for(L=0;L<y.length;)b.call(O,y[L],L,y),L++;else for(L in y)y.hasOwnProperty(L)&&b.call(O,y[L],L,y)}function d(y,b,O){var L="DEPRECATED METHOD: "+b+`
`+O+` AT 
`;return function(){var Y=new Error("get-stack-trace"),ee=Y&&Y.stack?Y.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",_e=t.console&&(t.console.warn||t.console.log);return _e&&_e.call(t.console,L,ee),y.apply(this,arguments)}}var v;typeof Object.assign!="function"?v=function(b){if(b===n||b===null)throw new TypeError("Cannot convert undefined or null to object");for(var O=Object(b),L=1;L<arguments.length;L++){var Y=arguments[L];if(Y!==n&&Y!==null)for(var ee in Y)Y.hasOwnProperty(ee)&&(O[ee]=Y[ee])}return O}:v=Object.assign;var m=d(function(b,O,L){for(var Y=Object.keys(O),ee=0;ee<Y.length;)(!L||L&&b[Y[ee]]===n)&&(b[Y[ee]]=O[Y[ee]]),ee++;return b},"extend","Use `assign`."),g=d(function(b,O){return m(b,O,!0)},"merge","Use `assign`.");function _(y,b,O){var L=b.prototype,Y;Y=y.prototype=Object.create(L),Y.constructor=y,Y._super=L,O&&v(Y,O)}function w(y,b){return function(){return y.apply(b,arguments)}}function x(y,b){return typeof y==o?y.apply(b&&b[0]||n,b):y}function P(y,b){return y===n?b:y}function E(y,b,O){p(j(b),function(L){y.addEventListener(L,O,!1)})}function A(y,b,O){p(j(b),function(L){y.removeEventListener(L,O,!1)})}function R(y,b){for(;y;){if(y==b)return!0;y=y.parentNode}return!1}function D(y,b){return y.indexOf(b)>-1}function j(y){return y.trim().split(/\s+/g)}function I(y,b,O){if(y.indexOf&&!O)return y.indexOf(b);for(var L=0;L<y.length;){if(O&&y[L][O]==b||!O&&y[L]===b)return L;L++}return-1}function V(y){return Array.prototype.slice.call(y,0)}function F(y,b,O){for(var L=[],Y=[],ee=0;ee<y.length;){var _e=b?y[ee][b]:y[ee];I(Y,_e)<0&&L.push(y[ee]),Y[ee]=_e,ee++}return O&&(b?L=L.sort(function(et,ft){return et[b]>ft[b]}):L=L.sort()),L}function G(y,b){for(var O,L,Y=b[0].toUpperCase()+b.slice(1),ee=0;ee<i.length;){if(O=i[ee],L=O?O+Y:b,L in y)return L;ee++}return n}var B=1;function K(){return B++}function C(y){var b=y.ownerDocument||y;return b.defaultView||b.parentWindow||t}var k=/mobile|tablet|ip(ad|hone|od)|android/i,U="ontouchstart"in t,$=G(t,"PointerEvent")!==n,q=U&&k.test(navigator.userAgent),J="touch",re="pen",ae="mouse",le="kinect",ge=25,oe=1,ye=2,se=4,Fe=8,Rr=1,Yt=2,nn=4,an=8,Ke=16,we=Yt|nn,jt=an|Ke,Ft=we|jt,Nt=["x","y"],Yn=["clientX","clientY"];function ht(y,b){var O=this;this.manager=y,this.callback=b,this.element=y.element,this.target=y.options.inputTarget,this.domHandler=function(L){x(y.options.enable,[y])&&O.handler(L)},this.init()}ht.prototype={handler:function(){},init:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(C(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(C(this.element),this.evWin,this.domHandler)}};function Yi(y){var b,O=y.options.inputClass;return O?b=O:$?b=rf:q?b=vo:U?b=nf:b=po,new b(y,Qu)}function Qu(y,b,O){var L=O.pointers.length,Y=O.changedPointers.length,ee=b&oe&&L-Y===0,_e=b&(se|Fe)&&L-Y===0;O.isFirst=!!ee,O.isFinal=!!_e,ee&&(y.session={}),O.eventType=b,Ju(y,O),y.emit("hammer.input",O),y.recognize(O),y.session.prevInput=O}function Ju(y,b){var O=y.session,L=b.pointers,Y=L.length;O.firstInput||(O.firstInput=co(b)),Y>1&&!O.firstMultiple?O.firstMultiple=co(b):Y===1&&(O.firstMultiple=!1);var ee=O.firstInput,_e=O.firstMultiple,Qe=_e?_e.center:ee.center,et=b.center=ho(L);b.timeStamp=f(),b.deltaTime=b.timeStamp-ee.timeStamp,b.angle=un(Qe,et),b.distance=hr(Qe,et),ef(O,b),b.offsetDirection=sn(b.deltaX,b.deltaY);var ft=on(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=ft.x,b.overallVelocityY=ft.y,b.overallVelocity=u(ft.x)>u(ft.y)?ft.x:ft.y,b.scale=_e?Sb(_e.pointers,L):1,b.rotation=_e?Pb(_e.pointers,L):0,b.maxPointers=O.prevInput?b.pointers.length>O.prevInput.maxPointers?b.pointers.length:O.prevInput.maxPointers:b.pointers.length,tf(O,b);var qt=y.element;R(b.srcEvent.target,qt)&&(qt=b.srcEvent.target),b.target=qt}function ef(y,b){var O=b.center,L=y.offsetDelta||{},Y=y.prevDelta||{},ee=y.prevInput||{};(b.eventType===oe||ee.eventType===se)&&(Y=y.prevDelta={x:ee.deltaX||0,y:ee.deltaY||0},L=y.offsetDelta={x:O.x,y:O.y}),b.deltaX=Y.x+(O.x-L.x),b.deltaY=Y.y+(O.y-L.y)}function tf(y,b){var O=y.lastInterval||b,L=b.timeStamp-O.timeStamp,Y,ee,_e,Qe;if(b.eventType!=Fe&&(L>ge||O.velocity===n)){var et=b.deltaX-O.deltaX,ft=b.deltaY-O.deltaY,qt=on(L,et,ft);ee=qt.x,_e=qt.y,Y=u(qt.x)>u(qt.y)?qt.x:qt.y,Qe=sn(et,ft),y.lastInterval=b}else Y=O.velocity,ee=O.velocityX,_e=O.velocityY,Qe=O.direction;b.velocity=Y,b.velocityX=ee,b.velocityY=_e,b.direction=Qe}function co(y){for(var b=[],O=0;O<y.pointers.length;)b[O]={clientX:s(y.pointers[O].clientX),clientY:s(y.pointers[O].clientY)},O++;return{timeStamp:f(),pointers:b,center:ho(b),deltaX:y.deltaX,deltaY:y.deltaY}}function ho(y){var b=y.length;if(b===1)return{x:s(y[0].clientX),y:s(y[0].clientY)};for(var O=0,L=0,Y=0;Y<b;)O+=y[Y].clientX,L+=y[Y].clientY,Y++;return{x:s(O/b),y:s(L/b)}}function on(y,b,O){return{x:b/y||0,y:O/y||0}}function sn(y,b){return y===b?Rr:u(y)>=u(b)?y<0?Yt:nn:b<0?an:Ke}function hr(y,b,O){O||(O=Nt);var L=b[O[0]]-y[O[0]],Y=b[O[1]]-y[O[1]];return Math.sqrt(L*L+Y*Y)}function un(y,b,O){O||(O=Nt);var L=b[O[0]]-y[O[0]],Y=b[O[1]]-y[O[1]];return Math.atan2(Y,L)*180/Math.PI}function Pb(y,b){return un(b[1],b[0],Yn)+un(y[1],y[0],Yn)}function Sb(y,b){return hr(b[0],b[1],Yn)/hr(y[0],y[1],Yn)}var Ab={mousedown:oe,mousemove:ye,mouseup:se},Ob="mousedown",Mb="mousemove mouseup";function po(){this.evEl=Ob,this.evWin=Mb,this.pressed=!1,ht.apply(this,arguments)}_(po,ht,{handler:function(b){var O=Ab[b.type];O&oe&&b.button===0&&(this.pressed=!0),O&ye&&b.which!==1&&(O=se),this.pressed&&(O&se&&(this.pressed=!1),this.callback(this.manager,O,{pointers:[b],changedPointers:[b],pointerType:ae,srcEvent:b}))}});var kb={pointerdown:oe,pointermove:ye,pointerup:se,pointercancel:Fe,pointerout:Fe},Rb={2:J,3:re,4:ae,5:le},Fh="pointerdown",Nh="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Fh="MSPointerDown",Nh="MSPointerMove MSPointerUp MSPointerCancel");function rf(){this.evEl=Fh,this.evWin=Nh,ht.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}_(rf,ht,{handler:function(b){var O=this.store,L=!1,Y=b.type.toLowerCase().replace("ms",""),ee=kb[Y],_e=Rb[b.pointerType]||b.pointerType,Qe=_e==J,et=I(O,b.pointerId,"pointerId");ee&oe&&(b.button===0||Qe)?et<0&&(O.push(b),et=O.length-1):ee&(se|Fe)&&(L=!0),!(et<0)&&(O[et]=b,this.callback(this.manager,ee,{pointers:O,changedPointers:[b],pointerType:_e,srcEvent:b}),L&&O.splice(et,1))}});var Cb={touchstart:oe,touchmove:ye,touchend:se,touchcancel:Fe},Ib="touchstart",Lb="touchstart touchmove touchend touchcancel";function Bh(){this.evTarget=Ib,this.evWin=Lb,this.started=!1,ht.apply(this,arguments)}_(Bh,ht,{handler:function(b){var O=Cb[b.type];if(O===oe&&(this.started=!0),!!this.started){var L=Db.call(this,b,O);O&(se|Fe)&&L[0].length-L[1].length===0&&(this.started=!1),this.callback(this.manager,O,{pointers:L[0],changedPointers:L[1],pointerType:J,srcEvent:b})}}});function Db(y,b){var O=V(y.touches),L=V(y.changedTouches);return b&(se|Fe)&&(O=F(O.concat(L),"identifier",!0)),[O,L]}var jb={touchstart:oe,touchmove:ye,touchend:se,touchcancel:Fe},Fb="touchstart touchmove touchend touchcancel";function vo(){this.evTarget=Fb,this.targetIds={},ht.apply(this,arguments)}_(vo,ht,{handler:function(b){var O=jb[b.type],L=Nb.call(this,b,O);L&&this.callback(this.manager,O,{pointers:L[0],changedPointers:L[1],pointerType:J,srcEvent:b})}});function Nb(y,b){var O=V(y.touches),L=this.targetIds;if(b&(oe|ye)&&O.length===1)return L[O[0].identifier]=!0,[O,O];var Y,ee,_e=V(y.changedTouches),Qe=[],et=this.target;if(ee=O.filter(function(ft){return R(ft.target,et)}),b===oe)for(Y=0;Y<ee.length;)L[ee[Y].identifier]=!0,Y++;for(Y=0;Y<_e.length;)L[_e[Y].identifier]&&Qe.push(_e[Y]),b&(se|Fe)&&delete L[_e[Y].identifier],Y++;if(Qe.length)return[F(ee.concat(Qe),"identifier",!0),Qe]}var Bb=2500,Vh=25;function nf(){ht.apply(this,arguments);var y=w(this.handler,this);this.touch=new vo(this.manager,y),this.mouse=new po(this.manager,y),this.primaryTouch=null,this.lastTouches=[]}_(nf,ht,{handler:function(b,O,L){var Y=L.pointerType==J,ee=L.pointerType==ae;if(!(ee&&L.sourceCapabilities&&L.sourceCapabilities.firesTouchEvents)){if(Y)Vb.call(this,O,L);else if(ee&&zb.call(this,L))return;this.callback(b,O,L)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Vb(y,b){y&oe?(this.primaryTouch=b.changedPointers[0].identifier,zh.call(this,b)):y&(se|Fe)&&zh.call(this,b)}function zh(y){var b=y.changedPointers[0];if(b.identifier===this.primaryTouch){var O={x:b.clientX,y:b.clientY};this.lastTouches.push(O);var L=this.lastTouches,Y=function(){var ee=L.indexOf(O);ee>-1&&L.splice(ee,1)};setTimeout(Y,Bb)}}function zb(y){for(var b=y.srcEvent.clientX,O=y.srcEvent.clientY,L=0;L<this.lastTouches.length;L++){var Y=this.lastTouches[L],ee=Math.abs(b-Y.x),_e=Math.abs(O-Y.y);if(ee<=Vh&&_e<=Vh)return!0}return!1}var Uh=G(a.style,"touchAction"),Gh=Uh!==n,$h="compute",Hh="auto",af="manipulation",fn="none",Xi="pan-x",qi="pan-y",mo=Gb();function of(y,b){this.manager=y,this.set(b)}of.prototype={set:function(y){y==$h&&(y=this.compute()),Gh&&this.manager.element.style&&mo[y]&&(this.manager.element.style[Uh]=y),this.actions=y.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var y=[];return p(this.manager.recognizers,function(b){x(b.options.enable,[b])&&(y=y.concat(b.getTouchAction()))}),Ub(y.join(" "))},preventDefaults:function(y){var b=y.srcEvent,O=y.offsetDirection;if(this.manager.session.prevented){b.preventDefault();return}var L=this.actions,Y=D(L,fn)&&!mo[fn],ee=D(L,qi)&&!mo[qi],_e=D(L,Xi)&&!mo[Xi];if(Y){var Qe=y.pointers.length===1,et=y.distance<2,ft=y.deltaTime<250;if(Qe&&et&&ft)return}if(!(_e&&ee)&&(Y||ee&&O&we||_e&&O&jt))return this.preventSrc(b)},preventSrc:function(y){this.manager.session.prevented=!0,y.preventDefault()}};function Ub(y){if(D(y,fn))return fn;var b=D(y,Xi),O=D(y,qi);return b&&O?fn:b||O?b?Xi:qi:D(y,af)?af:Hh}function Gb(){if(!Gh)return!1;var y={},b=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(O){y[O]=b?t.CSS.supports("touch-action",O):!0}),y}var go=1,wt=2,Xn=4,Cr=8,pr=Cr,Zi=16,Xt=32;function dr(y){this.options=v({},this.defaults,y||{}),this.id=K(),this.manager=null,this.options.enable=P(this.options.enable,!0),this.state=go,this.simultaneous={},this.requireFail=[]}dr.prototype={defaults:{},set:function(y){return v(this.options,y),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(y){if(h(y,"recognizeWith",this))return this;var b=this.simultaneous;return y=yo(y,this),b[y.id]||(b[y.id]=y,y.recognizeWith(this)),this},dropRecognizeWith:function(y){return h(y,"dropRecognizeWith",this)?this:(y=yo(y,this),delete this.simultaneous[y.id],this)},requireFailure:function(y){if(h(y,"requireFailure",this))return this;var b=this.requireFail;return y=yo(y,this),I(b,y)===-1&&(b.push(y),y.requireFailure(this)),this},dropRequireFailure:function(y){if(h(y,"dropRequireFailure",this))return this;y=yo(y,this);var b=I(this.requireFail,y);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(y){return!!this.simultaneous[y.id]},emit:function(y){var b=this,O=this.state;function L(Y){b.manager.emit(Y,y)}O<Cr&&L(b.options.event+Wh(O)),L(b.options.event),y.additionalEvent&&L(y.additionalEvent),O>=Cr&&L(b.options.event+Wh(O))},tryEmit:function(y){if(this.canEmit())return this.emit(y);this.state=Xt},canEmit:function(){for(var y=0;y<this.requireFail.length;){if(!(this.requireFail[y].state&(Xt|go)))return!1;y++}return!0},recognize:function(y){var b=v({},y);if(!x(this.options.enable,[this,b])){this.reset(),this.state=Xt;return}this.state&(pr|Zi|Xt)&&(this.state=go),this.state=this.process(b),this.state&(wt|Xn|Cr|Zi)&&this.tryEmit(b)},process:function(y){},getTouchAction:function(){},reset:function(){}};function Wh(y){return y&Zi?"cancel":y&Cr?"end":y&Xn?"move":y&wt?"start":""}function Yh(y){return y==Ke?"down":y==an?"up":y==Yt?"left":y==nn?"right":""}function yo(y,b){var O=b.manager;return O?O.get(y):y}function Bt(){dr.apply(this,arguments)}_(Bt,dr,{defaults:{pointers:1},attrTest:function(y){var b=this.options.pointers;return b===0||y.pointers.length===b},process:function(y){var b=this.state,O=y.eventType,L=b&(wt|Xn),Y=this.attrTest(y);return L&&(O&Fe||!Y)?b|Zi:L||Y?O&se?b|Cr:b&wt?b|Xn:wt:Xt}});function _o(){Bt.apply(this,arguments),this.pX=null,this.pY=null}_(_o,Bt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ft},getTouchAction:function(){var y=this.options.direction,b=[];return y&we&&b.push(qi),y&jt&&b.push(Xi),b},directionTest:function(y){var b=this.options,O=!0,L=y.distance,Y=y.direction,ee=y.deltaX,_e=y.deltaY;return Y&b.direction||(b.direction&we?(Y=ee===0?Rr:ee<0?Yt:nn,O=ee!=this.pX,L=Math.abs(y.deltaX)):(Y=_e===0?Rr:_e<0?an:Ke,O=_e!=this.pY,L=Math.abs(y.deltaY))),y.direction=Y,O&&L>b.threshold&&Y&b.direction},attrTest:function(y){return Bt.prototype.attrTest.call(this,y)&&(this.state&wt||!(this.state&wt)&&this.directionTest(y))},emit:function(y){this.pX=y.deltaX,this.pY=y.deltaY;var b=Yh(y.direction);b&&(y.additionalEvent=this.options.event+b),this._super.emit.call(this,y)}});function sf(){Bt.apply(this,arguments)}_(sf,Bt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[fn]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.scale-1)>this.options.threshold||this.state&wt)},emit:function(y){if(y.scale!==1){var b=y.scale<1?"in":"out";y.additionalEvent=this.options.event+b}this._super.emit.call(this,y)}});function uf(){dr.apply(this,arguments),this._timer=null,this._input=null}_(uf,dr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Hh]},process:function(y){var b=this.options,O=y.pointers.length===b.pointers,L=y.distance<b.threshold,Y=y.deltaTime>b.time;if(this._input=y,!L||!O||y.eventType&(se|Fe)&&!Y)this.reset();else if(y.eventType&oe)this.reset(),this._timer=c(function(){this.state=pr,this.tryEmit()},b.time,this);else if(y.eventType&se)return pr;return Xt},reset:function(){clearTimeout(this._timer)},emit:function(y){this.state===pr&&(y&&y.eventType&se?this.manager.emit(this.options.event+"up",y):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}});function ff(){Bt.apply(this,arguments)}_(ff,Bt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[fn]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.rotation)>this.options.threshold||this.state&wt)}});function lf(){Bt.apply(this,arguments)}_(lf,Bt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:we|jt,pointers:1},getTouchAction:function(){return _o.prototype.getTouchAction.call(this)},attrTest:function(y){var b=this.options.direction,O;return b&(we|jt)?O=y.overallVelocity:b&we?O=y.overallVelocityX:b&jt&&(O=y.overallVelocityY),this._super.attrTest.call(this,y)&&b&y.offsetDirection&&y.distance>this.options.threshold&&y.maxPointers==this.options.pointers&&u(O)>this.options.velocity&&y.eventType&se},emit:function(y){var b=Yh(y.offsetDirection);b&&this.manager.emit(this.options.event+b,y),this.manager.emit(this.options.event,y)}});function bo(){dr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}_(bo,dr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[af]},process:function(y){var b=this.options,O=y.pointers.length===b.pointers,L=y.distance<b.threshold,Y=y.deltaTime<b.time;if(this.reset(),y.eventType&oe&&this.count===0)return this.failTimeout();if(L&&Y&&O){if(y.eventType!=se)return this.failTimeout();var ee=this.pTime?y.timeStamp-this.pTime<b.interval:!0,_e=!this.pCenter||hr(this.pCenter,y.center)<b.posThreshold;this.pTime=y.timeStamp,this.pCenter=y.center,!_e||!ee?this.count=1:this.count+=1,this._input=y;var Qe=this.count%b.taps;if(Qe===0)return this.hasRequireFailures()?(this._timer=c(function(){this.state=pr,this.tryEmit()},b.interval,this),wt):pr}return Xt},failTimeout:function(){return this._timer=c(function(){this.state=Xt},this.options.interval,this),Xt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==pr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function vr(y,b){return b=b||{},b.recognizers=P(b.recognizers,vr.defaults.preset),new cf(y,b)}vr.VERSION="2.0.7",vr.defaults={domEvents:!1,touchAction:$h,enable:!0,inputTarget:null,inputClass:null,preset:[[ff,{enable:!1}],[sf,{enable:!1},["rotate"]],[lf,{direction:we}],[_o,{direction:we},["swipe"]],[bo],[bo,{event:"doubletap",taps:2},["tap"]],[uf]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var $b=1,Xh=2;function cf(y,b){this.options=v({},vr.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||y,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=y,this.input=Yi(this),this.touchAction=new of(this,this.options.touchAction),qh(this,!0),p(this.options.recognizers,function(O){var L=this.add(new O[0](O[1]));O[2]&&L.recognizeWith(O[2]),O[3]&&L.requireFailure(O[3])},this)}cf.prototype={set:function(y){return v(this.options,y),y.touchAction&&this.touchAction.update(),y.inputTarget&&(this.input.destroy(),this.input.target=y.inputTarget,this.input.init()),this},stop:function(y){this.session.stopped=y?Xh:$b},recognize:function(y){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(y);var O,L=this.recognizers,Y=b.curRecognizer;(!Y||Y&&Y.state&pr)&&(Y=b.curRecognizer=null);for(var ee=0;ee<L.length;)O=L[ee],b.stopped!==Xh&&(!Y||O==Y||O.canRecognizeWith(Y))?O.recognize(y):O.reset(),!Y&&O.state&(wt|Xn|Cr)&&(Y=b.curRecognizer=O),ee++}},get:function(y){if(y instanceof dr)return y;for(var b=this.recognizers,O=0;O<b.length;O++)if(b[O].options.event==y)return b[O];return null},add:function(y){if(h(y,"add",this))return this;var b=this.get(y.options.event);return b&&this.remove(b),this.recognizers.push(y),y.manager=this,this.touchAction.update(),y},remove:function(y){if(h(y,"remove",this))return this;if(y=this.get(y),y){var b=this.recognizers,O=I(b,y);O!==-1&&(b.splice(O,1),this.touchAction.update())}return this},on:function(y,b){if(y!==n&&b!==n){var O=this.handlers;return p(j(y),function(L){O[L]=O[L]||[],O[L].push(b)}),this}},off:function(y,b){if(y!==n){var O=this.handlers;return p(j(y),function(L){b?O[L]&&O[L].splice(I(O[L],b),1):delete O[L]}),this}},emit:function(y,b){this.options.domEvents&&Hb(y,b);var O=this.handlers[y]&&this.handlers[y].slice();if(!(!O||!O.length)){b.type=y,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var L=0;L<O.length;)O[L](b),L++}},destroy:function(){this.element&&qh(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function qh(y,b){var O=y.element;if(O.style){var L;p(y.options.cssProps,function(Y,ee){L=G(O.style,ee),b?(y.oldCssProps[L]=O.style[L],O.style[L]=Y):O.style[L]=y.oldCssProps[L]||""}),b||(y.oldCssProps={})}}function Hb(y,b){var O=r.createEvent("Event");O.initEvent(y,!0,!0),O.gesture=b,b.target.dispatchEvent(O)}v(vr,{INPUT_START:oe,INPUT_MOVE:ye,INPUT_END:se,INPUT_CANCEL:Fe,STATE_POSSIBLE:go,STATE_BEGAN:wt,STATE_CHANGED:Xn,STATE_ENDED:Cr,STATE_RECOGNIZED:pr,STATE_CANCELLED:Zi,STATE_FAILED:Xt,DIRECTION_NONE:Rr,DIRECTION_LEFT:Yt,DIRECTION_RIGHT:nn,DIRECTION_UP:an,DIRECTION_DOWN:Ke,DIRECTION_HORIZONTAL:we,DIRECTION_VERTICAL:jt,DIRECTION_ALL:Ft,Manager:cf,Input:ht,TouchAction:of,TouchInput:vo,MouseInput:po,PointerEventInput:rf,TouchMouseInput:nf,SingleTouchInput:Bh,Recognizer:dr,AttrRecognizer:Bt,Tap:bo,Pan:_o,Swipe:lf,Pinch:sf,Rotate:ff,Press:uf,on:E,off:A,each:p,merge:g,extend:m,assign:v,inherit:_,bindFn:w,prefixed:G});var Wb=typeof t<"u"?t:typeof self<"u"?self:{};Wb.Hammer=vr,n==="function"&&define.amd?define(function(){return vr}):typeof _u<"u"&&_u.exports?_u.exports=vr:t[e]=vr})(window,document,"Hammer")});var pb=qn((uae,hb)=>{"use strict";var oR="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";hb.exports=oR});var gb=qn((fae,mb)=>{"use strict";var sR=pb();function db(){}function vb(){}vb.resetWarningCache=db;mb.exports=function(){function t(n,i,a,o,s,u){if(u!==sR){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}t.isRequired=t;function r(){return t}var e={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:r,element:t,elementType:t,instanceOf:r,node:t,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:vb,resetWarningCache:db};return e.PropTypes=e,e}});var _b=qn((hae,yb)=>{yb.exports=gb()();var lae,cae});var dR={};xo(dR,{AmbientLight:()=>Ys,AttributeManager:()=>Iu,COORDINATE_SYSTEM:()=>me,CompositeLayer:()=>Ah,Controller:()=>Dt,Deck:()=>Vi,DeckGL:()=>Eb,DeckRenderer:()=>mu,DirectionalLight:()=>Cn,FirstPersonController:()=>Wu,FirstPersonView:()=>kh,FirstPersonViewport:()=>$u,FlyToInterpolator:()=>ub,Layer:()=>$i,LayerExtension:()=>Zu,LayerManager:()=>cu,LightingEffect:()=>qa,LinearInterpolator:()=>dt,MapController:()=>du,MapView:()=>eo,OPERATION:()=>yg,OrbitController:()=>Yu,OrbitView:()=>Ch,OrbitViewport:()=>Uu,OrthographicController:()=>Xu,OrthographicView:()=>Ih,OrthographicViewport:()=>Gu,PointLight:()=>ou,PostProcessEffect:()=>gy,TRANSITION_EVENTS:()=>Ja,Tesselator:()=>cb,TransitionInterpolator:()=>Di,UNIT:()=>Ga,VERSION:()=>Ws,View:()=>Lt,Viewport:()=>nt,WebMercatorViewport:()=>Bn,_CameraLight:()=>hy,_GlobeController:()=>qu,_GlobeView:()=>Lh,_GlobeViewport:()=>zu,_LayersPass:()=>qr,_PickLayersPass:()=>Ii,_SunLight:()=>dy,_compareProps:()=>Lu,_count:()=>Du,_deepEqual:()=>Ze,_fillArray:()=>lu,_flatten:()=>en,_memoize:()=>kt,_mergeShaders:()=>ju,_registerLoggers:()=>Hs,assert:()=>Se,createIterable:()=>zi,fp64LowPart:()=>Kc,gouraudLighting:()=>wa,log:()=>he,phongLighting:()=>xa,picking:()=>nh,project:()=>Zr,project32:()=>rh,shadow:()=>Fn});var Al={};xo(Al,{Buffer:()=>fe,ConeGeometry:()=>ws,CubeGeometry:()=>Ts,CylinderGeometry:()=>Es,FEATURES:()=>Ee,Framebuffer:()=>xe,Geometry:()=>ot,IcoSphereGeometry:()=>Ss,Model:()=>$r,PlaneGeometry:()=>Os,Program:()=>Vr,ProgramManager:()=>tr,Renderbuffer:()=>yt,SphereGeometry:()=>ks,Texture2D:()=>Le,Texture3D:()=>si,TextureCube:()=>vn,Timeline:()=>Wr,Transform:()=>rr,TransformFeedback:()=>zr,TruncatedConeGeometry:()=>Hr,cloneTextureFrom:()=>ui,copyToTexture:()=>No,cssToDeviceRatio:()=>mt,getParameters:()=>ri,hasFeatures:()=>Fr,instrumentGLContext:()=>yr,isWebGL2:()=>ie,readPixelsToBuffer:()=>jo,setParameters:()=>Xe,withParameters:()=>Ae});function ne(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ne=function(e){return typeof e}:ne=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ne(t)}function Zn(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function hf(t){if(Array.isArray(t))return Zn(t)}function pf(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Ki(t,r){if(t){if(typeof t=="string")return Zn(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Zn(t,r)}}function df(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ue(t){return hf(t)||pf(t)||Ki(t)||df()}function l(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function T(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Kh(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function S(t,r,e){return r&&Kh(t.prototype,r),e&&Kh(t,e),t}function Qi(t){if(typeof window<"u"&&ne(window.process)==="object"&&window.process.type==="renderer"||typeof process<"u"&&ne(process.versions)==="object"&&Boolean(process.versions.electron))return!0;var r=(typeof navigator>"u"?"undefined":ne(navigator))==="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=t||r;return!!(e&&e.indexOf("Electron")>=0)}function Ye(){var t=(typeof process>"u"?"undefined":ne(process))==="object"&&String(process)==="[object process]"&&!process.browser;return!t||Qi()}var Ir={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:(typeof process>"u"?"undefined":ne(process))==="object"&&process};var Jb=Ir.self||Ir.window||Ir.global,Kn=Ir.window||Ir.self||Ir.global,e1=Ir.document||{},ln=Ir.process||{};var To="8.9.32",VR=Ye();var vf=globalThis;function Qn(t){if(!t&&!Ye())return"Node";if(Qi(t))return"Electron";var r=typeof navigator<"u"?navigator:{},e=t||r.userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";var n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i?"IE":vf.chrome?"Chrome":vf.safari?"Safari":vf.mozInnerScreenX?"Firefox":"Unknown"}function t1(t){try{var r=window[t],e="__storage_test__";return r.setItem(e,e),r.removeItem(e),r}catch{return null}}var Qh=function(){function t(r){T(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";l(this,"storage",void 0),l(this,"id",void 0),l(this,"config",{}),this.storage=t1(n),this.id=r,this.config={},Object.assign(this.config,e),this._loadConfiguration()}return S(t,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){return this.config={},this.updateConfiguration(e)}},{key:"updateConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}return this}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}]),t}();function Jh(t){var r;return t<10?r="".concat(t.toFixed(2),"ms"):t<100?r="".concat(t.toFixed(1),"ms"):t<1e3?r="".concat(t.toFixed(0),"ms"):r="".concat((t/1e3).toFixed(2),"s"),r}function ep(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,e=Math.max(r-t.length,0);return"".concat(" ".repeat(e)).concat(t)}function Eo(t,r,e){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600,i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>n&&(e=Math.min(e,n/t.width));var a=t.width*e,o=t.height*e,s=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(a,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(r," %c+"),s]}var Po;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Po||(Po={}));function tp(t){return typeof t=="string"?Po[t.toUpperCase()]||Po.WHITE:t}function rp(t,r,e){return!Ye&&typeof t=="string"&&(r&&(r=tp(r),t="\x1B[".concat(r,"m").concat(t,"\x1B[39m")),e&&(r=tp(e),t="\x1B[".concat(e+10,"m").concat(t,"\x1B[49m"))),t}function r1(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=n1(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function n1(t,r){if(t){if(typeof t=="string")return np(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return np(t,r)}}function np(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function ip(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"],e=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(e),i=r1(n),a;try{var o=function(){var u=a.value;typeof t[u]=="function"&&(r.find(function(f){return u===f})||(t[u]=t[u].bind(t)))};for(i.s();!(a=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}}function Jn(t,r){if(!t)throw new Error(r||"Assertion failed")}function cn(){var t;if(Ye&&"performance"in Kn){var r,e;t=Kn===null||Kn===void 0||(r=Kn.performance)===null||r===void 0||(e=r.now)===null||e===void 0?void 0:e.call(r)}else if("hrtime"in ln){var n,i=ln===null||ln===void 0||(n=ln.hrtime)===null||n===void 0?void 0:n.call(ln);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}var ei={debug:Ye&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},i1={enabled:!0,level:0};function xt(){}var ap={},op={once:!0},Lr=function(){function t(){T(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""},e=r.id;l(this,"id",void 0),l(this,"VERSION",To),l(this,"_startTs",cn()),l(this,"_deltaTs",cn()),l(this,"_storage",void 0),l(this,"userData",{}),l(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new Qh("__probe-".concat(this.id,"__"),i1),this.userData={},this.timeStamp("".concat(this.id," started")),ip(this),Object.seal(this)}return S(t,[{key:"level",get:function(){return this.getLevel()},set:function(e){this.setLevel(e)}},{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((cn()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((cn()-this._deltaTs).toPrecision(10))}},{key:"priority",get:function(){return this.level},set:function(e){this.level=e}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}},{key:"setLevel",value:function(e){return this._storage.updateConfiguration({level:e}),this}},{key:"get",value:function(e){return this._storage.config[e]}},{key:"set",value:function(e,n){this._storage.updateConfiguration(l({},e,n))}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"assert",value:function(e,n){Jn(e,n)}},{key:"warn",value:function(e){return this._getLogFunction(0,e,ei.warn,arguments,op)}},{key:"error",value:function(e){return this._getLogFunction(0,e,ei.error,arguments)}},{key:"deprecated",value:function(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}},{key:"removed",value:function(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}},{key:"probe",value:function(e,n){return this._getLogFunction(e,n,ei.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(e,n){return this._getLogFunction(e,n,ei.debug,arguments)}},{key:"info",value:function(e,n){return this._getLogFunction(e,n,console.info,arguments)}},{key:"once",value:function(e,n){for(var i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];return this._getLogFunction(e,n,ei.debug||ei.info,arguments,op)}},{key:"table",value:function(e,n,i){return n?this._getLogFunction(e,n,console.table||xt,i&&[i],{tag:u1(n)}):xt}},{key:"image",value:function(e){var n=e.logLevel,i=e.priority,a=e.image,o=e.message,s=o===void 0?"":o,u=e.scale,f=u===void 0?1:u;return this._shouldLog(n||i)?Ye?s1({image:a,message:s,scale:f}):o1({image:a,message:s,scale:f}):xt}},{key:"time",value:function(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}},{key:"timeEnd",value:function(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(e,n){return this._getLogFunction(e,n,console.timeStamp||xt)}},{key:"group",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1},a=sp({logLevel:e,message:n,opts:i}),o=i.collapsed;return a.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(a)}},{key:"groupCollapsed",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction(e,"",console.groupEnd||xt)}},{key:"withGroup",value:function(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return this.isEnabled()&&this.getLevel()>=up(e)}},{key:"_getLogFunction",value:function(e,n,i,a,o){if(this._shouldLog(e)){var s;o=sp({logLevel:e,message:n,args:a,opts:o}),i=i||o.method,Jn(i),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=cn();var u=o.tag||o.message;if(o.once)if(!ap[u])ap[u]=cn();else return xt;return n=a1(this.id,o.message,o),(s=i).bind.apply(s,[console,n].concat(ue(o.args)))}return xt}}]),t}();l(Lr,"VERSION",To);function up(t){if(!t)return 0;var r;switch(ne(t)){case"number":r=t;break;case"object":r=t.logLevel||t.priority||0;break;default:return 0}return Jn(Number.isFinite(r)&&r>=0),r}function sp(t){var r=t.logLevel,e=t.message;t.logLevel=up(r);for(var n=t.args?Array.from(t.args):[];n.length&&n.shift()!==e;);switch(ne(r)){case"string":case"function":e!==void 0&&n.unshift(e),t.message=r;break;case"object":Object.assign(t,r);break;default:}typeof t.message=="function"&&(t.message=t.message());var i=ne(t.message);return Jn(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function a1(t,r,e){if(typeof r=="string"){var n=e.time?ep(Jh(e.total)):"";r=e.time?"".concat(t,": ").concat(n,"  ").concat(r):"".concat(t,": ").concat(r),r=rp(r,e.color,e.background)}return r}function o1(t){var r=t.image,e=t.message,n=e===void 0?"":e,i=t.scale,a=i===void 0?1:i,o=null;try{o=module.require("asciify-image")}catch{}return o?function(){return o(r,{fit:"box",width:"".concat(Math.round(80*a),"%")}).then(function(s){return console.log(s)})}:xt}function s1(t){var r=t.image,e=t.message,n=e===void 0?"":e,i=t.scale,a=i===void 0?1:i;if(typeof r=="string"){var o=new Image;return o.onload=function(){var c,h=Eo(o,n,a);(c=console).log.apply(c,ue(h))},o.src=r,xt}var s=r.nodeName||"";if(s.toLowerCase()==="img"){var u;return(u=console).log.apply(u,ue(Eo(r,n,a))),xt}if(s.toLowerCase()==="canvas"){var f=new Image;return f.onload=function(){var c;return(c=console).log.apply(c,ue(Eo(f,n,a)))},f.src=r.toDataURL(),xt}return xt}function u1(t){for(var r in t)for(var e in t[r])return e||"untitled";return"empty"}var SC=new Lr({id:"@probe.gl/log"});var Q=new Lr({id:"luma.gl"});function Ue(t,r){if(!t)throw new Error(r||"luma.gl: assertion failed.")}var f1="Invalid WebGLRenderingContext";var l1="Requires WebGL2";function mr(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function ie(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function mf(t){return ie(t)?t:null}function gr(t){return Ue(mr(t),f1),t}function ke(t){return Ue(ie(t),l1),t}var Ji={};function c1(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function h1(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function p1(t,r){Ji[t]=!0,r!==void 0&&c1(r)}function d1(t){var r=t.getError;t.getError=function(){var n;do n=r.apply(t),n!==0&&(Ji[n]=!0);while(n!==0);for(n in Ji)if(Ji[n])return delete Ji[n],parseInt(n,10);return 0}}var ea=function t(r){var e=r.gl;this.ext=r,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(r.maxVertexAttribs);for(var n=0;n<this.attribs.length;n++){var i=new t.VertexAttrib(e);this.attribs[n]=i}this.maxAttrib=0};ea.VertexAttrib=function(r){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};ea.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var hn=function(r){var e=this;this.gl=r,d1(r);var n=this.original={getParameter:r.getParameter,enableVertexAttribArray:r.enableVertexAttribArray,disableVertexAttribArray:r.disableVertexAttribArray,bindBuffer:r.bindBuffer,getVertexAttrib:r.getVertexAttrib,vertexAttribPointer:r.vertexAttribPointer};r.getParameter=function(a){return a===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:n.getParameter.apply(this,arguments)},r.enableVertexAttribArray=function(a){var o=e.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,a);var s=o.attribs[a];return s.enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},r.disableVertexAttribArray=function(a){var o=e.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,a);var s=o.attribs[a];return s.enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},r.bindBuffer=function(a,o){switch(a){case 34962:e.currentArrayBuffer=o;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=o;break;default:}return n.bindBuffer.apply(this,arguments)},r.getVertexAttrib=function(a,o){var s=e.currentVertexArrayObject,u=s.attribs[a];switch(o){case 34975:return u.buffer;case 34338:return u.enabled;case 34339:return u.size;case 34340:return u.stride;case 34341:return u.type;case 34922:return u.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},r.vertexAttribPointer=function(a,o,s,u,f,c){var h=e.currentVertexArrayObject;h.maxAttrib=Math.max(h.maxAttrib,a);var p=h.attribs[a];return p.buffer=e.currentArrayBuffer,p.size=o,p.type=s,p.normalized=u,p.stride=f,p.offset=c,p.recache(),n.vertexAttribPointer.apply(this,arguments)},r.instrumentExtension&&r.instrumentExtension(this,"OES_vertex_array_object"),r.canvas&&r.canvas.addEventListener("webglcontextrestored",function(){h1("OESVertexArrayObject emulation library context restored"),e.reset_()},!0),this.reset_()};hn.prototype.VERTEX_ARRAY_BINDING_OES=34229;hn.prototype.reset_=function(){var r=this.vertexArrayObjects!==void 0;if(r)for(var e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;var n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new ea(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};hn.prototype.createVertexArrayOES=function(){var r=new ea(this);return this.vertexArrayObjects.push(r),r};hn.prototype.deleteVertexArrayOES=function(r){r.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(r),1),this.currentVertexArrayObject===r&&this.bindVertexArrayOES(null)};hn.prototype.isVertexArrayOES=function(r){return!!(r&&r instanceof ea&&r.hasBeenBound&&r.ext===this)};hn.prototype.bindVertexArrayOES=function(r){var e=this.gl;if(r&&!r.isAlive){p1(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}var n=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=r||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var a=this.currentVertexArrayObject;if(i!==a){(!i||a.elementArrayBuffer!==i.elementArrayBuffer)&&n.bindBuffer.call(e,34963,a.elementArrayBuffer);for(var o=this.currentArrayBuffer,s=Math.max(i?i.maxAttrib:0,a.maxAttrib),u=0;u<=s;u++){var f=a.attribs[u],c=i?i.attribs[u]:null;if((!i||f.enabled!==c.enabled)&&(f.enabled?n.enableVertexAttribArray.call(e,u):n.disableVertexAttribArray.call(e,u)),f.enabled){var h=!1;(!i||f.buffer!==c.buffer)&&(o!==f.buffer&&(n.bindBuffer.call(e,34962,f.buffer),o=f.buffer),h=!0),(h||f.cached!==c.cached)&&n.vertexAttribPointer.call(e,u,f.size,f.type,f.normalized,f.stride,f.offset)}}this.currentArrayBuffer!==o&&n.bindBuffer.call(e,34962,this.currentArrayBuffer)}};function fp(t){if(typeof t.createVertexArray!="function"){var r=t.getSupportedExtensions;t.getSupportedExtensions=function(){var i=r.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};var e=t.getExtension;t.getExtension=function(i){var a=e.call(this,i);return a||(i!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new hn(this)),this.__OESVertexArrayObject))}}}var ve,lp="OES_element_index",cp="WEBGL_draw_buffers",v1="EXT_disjoint_timer_query",m1="EXT_disjoint_timer_query_webgl2",g1="EXT_texture_filter_anisotropic",hp="WEBGL_debug_renderer_info",y1=35723,_1=4352,b1=36795,w1=34047,x1=37445,T1=37446,Re=function(r){return ie(r)?void 0:0},E1=(ve={},l(ve,3074,function(r){return ie(r)?void 0:36064}),l(ve,y1,function(t){return ie(t)?void 0:_1}),l(ve,35977,Re),l(ve,32937,Re),l(ve,b1,function(t,r){var e=ie(t)?t.getExtension(m1):t.getExtension(v1);return e&&e.GPU_DISJOINT_EXT?r(e.GPU_DISJOINT_EXT):0}),l(ve,x1,function(t,r){var e=t.getExtension(hp);return r(e&&e.UNMASKED_VENDOR_WEBGL||7936)}),l(ve,T1,function(t,r){var e=t.getExtension(hp);return r(e&&e.UNMASKED_RENDERER_WEBGL||7937)}),l(ve,w1,function(t,r){var e=t.luma.extensions[g1];return e?r(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}),l(ve,32883,Re),l(ve,35071,Re),l(ve,37447,Re),l(ve,36063,function(r,e){if(!ie(r)){var n=r.getExtension(cp);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}}),l(ve,35379,Re),l(ve,35374,Re),l(ve,35377,Re),l(ve,34852,function(r){if(!ie(r)){var e=r.getExtension(cp);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}}),l(ve,36203,function(r){return r.getExtension(lp)?2147483647:65535}),l(ve,33001,function(r){return r.getExtension(lp)?16777216:65535}),l(ve,33e3,function(r){return 16777216}),l(ve,37157,Re),l(ve,35373,Re),l(ve,35657,Re),l(ve,36183,Re),l(ve,37137,Re),l(ve,34045,Re),l(ve,35978,Re),l(ve,35979,Re),l(ve,35968,Re),l(ve,35376,Re),l(ve,35375,Re),l(ve,35659,Re),l(ve,37154,Re),l(ve,35371,Re),l(ve,35658,Re),l(ve,35076,Re),l(ve,35077,Re),l(ve,35380,Re),ve);function pp(t,r,e){var n=E1[e],i=typeof n=="function"?n(t,r,e):n,a=i!==void 0?i:r(e);return a}var ti,P1="OES_vertex_array_object",dp="ANGLE_instanced_arrays",S1="WEBGL_draw_buffers",A1="EXT_disjoint_timer_query",O1="EXT_texture_filter_anisotropic",M1="VertexArray requires WebGL2 or OES_vertex_array_object extension";function k1(t,r){return{webgl2:ie(t),ext:t.getExtension(r)}}var gf=(ti={},l(ti,P1,{meta:{suffix:"OES"},createVertexArray:function(){Ue(!1,M1)},deleteVertexArray:function(){},bindVertexArray:function(){},isVertexArray:function(){return!1}}),l(ti,dp,{meta:{suffix:"ANGLE"},vertexAttribDivisor:function(r,e){Ue(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:function(){},drawArraysInstanced:function(){}}),l(ti,S1,{meta:{suffix:"WEBGL"},drawBuffers:function(){Ue(!1)}}),l(ti,A1,{meta:{suffix:"EXT"},createQuery:function(){Ue(!1)},deleteQuery:function(){Ue(!1)},beginQuery:function(){Ue(!1)},endQuery:function(){},getQuery:function(r,e){return this.getQueryObject(r,e)},getQueryParameter:function(r,e){return this.getQueryObject(r,e)},getQueryObject:function(){}}),ti),So={readBuffer:function(r,e,n){ie(r)&&e(n)},getVertexAttrib:function(r,e,n,i){var a=k1(r,dp),o=a.webgl2,s=a.ext,u;switch(i){case 35069:u=o?void 0:!1;break;case 35070:u=!o&&!s?0:void 0;break;default:}return u!==void 0?u:e(n,i)},getProgramParameter:function(r,e,n,i){if(!ie(r))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0;default:}return e(n,i)},getInternalformatParameter:function(r,e,n,i,a){if(!ie(r))switch(a){case 32937:return new Int32Array([0]);default:}return r.getInternalformatParameter(n,i,a)},getTexParameter:function(r,e,n,i){switch(i){case 34046:var a=r.luma.extensions,o=a[O1];i=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break;default:}return e(n,i)},getParameter:pp,hint:function(r,e,n,i){return e(n,i)}};function mp(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=R1(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function R1(t,r){if(t){if(typeof t=="string")return vp(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return vp(t,r)}}function vp(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function gp(t){t.luma=t.luma||{};var r=t.luma;return r.polyfilled||(fp(t),C1(t),L1(t,gf),I1(t,{target:r,target2:t}),r.polyfilled=!0),t}globalThis.polyfillContext=gp;function C1(t){t.luma.extensions={};var r=t.getSupportedExtensions()||[],e=mp(r),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;t.luma[i]=t.getExtension(i)}}catch(a){e.e(a)}finally{e.f()}}function I1(t,r){var e=r.target,n=r.target2;Object.keys(So).forEach(function(i){if(typeof So[i]=="function"){var a=t[i]?t[i].bind(t):function(){},o=So[i].bind(null,t,a);e[i]=o,n[i]=o}})}function L1(t,r){var e=mp(Object.getOwnPropertyNames(r)),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i!=="overrides"&&D1(t,{extension:i,target:t.luma,target2:t})}}catch(a){e.e(a)}finally{e.f()}}function D1(t,r){var e=r.extension,n=r.target,i=r.target2,a=gf[e];Ue(a);for(var o=a.meta,s=o===void 0?{}:o,u=s.suffix,f=u===void 0?"":u,c=t.getExtension(e),h=function(){var m=d[p],g="".concat(m).concat(f),_=null;m==="meta"||typeof t[m]=="function"||(c&&typeof c[g]=="function"?_=function(){return c[g].apply(c,arguments)}:typeof a[m]=="function"&&(_=a[m].bind(n))),_&&(n[m]=_,i[m]=_)},p=0,d=Object.keys(a);p<d.length;p++)h()}function yf(t){if(Array.isArray(t))return t}function _f(t,r){var e=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(e!=null){var n=[],i=!0,a=!1,o,s;try{for(e=e.call(t);!(i=(o=e.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(u){a=!0,s=u}finally{try{!i&&e.return!=null&&e.return()}finally{if(a)throw s}}return n}}function bf(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Z(t,r){return yf(t)||_f(t,r)||Ki(t,r)||bf()}var te,X,Tt,ra=(te={},l(te,3042,!1),l(te,32773,new Float32Array([0,0,0,0])),l(te,32777,32774),l(te,34877,32774),l(te,32969,1),l(te,32968,0),l(te,32971,1),l(te,32970,0),l(te,3106,new Float32Array([0,0,0,0])),l(te,3107,[!0,!0,!0,!0]),l(te,2884,!1),l(te,2885,1029),l(te,2929,!1),l(te,2931,1),l(te,2932,513),l(te,2928,new Float32Array([0,1])),l(te,2930,!0),l(te,3024,!0),l(te,36006,null),l(te,2886,2305),l(te,33170,4352),l(te,2849,1),l(te,32823,!1),l(te,32824,0),l(te,10752,0),l(te,32938,1),l(te,32939,!1),l(te,3089,!1),l(te,3088,new Int32Array([0,0,1024,1024])),l(te,2960,!1),l(te,2961,0),l(te,2968,4294967295),l(te,36005,4294967295),l(te,2962,519),l(te,2967,0),l(te,2963,4294967295),l(te,34816,519),l(te,36003,0),l(te,36004,4294967295),l(te,2964,7680),l(te,2965,7680),l(te,2966,7680),l(te,34817,7680),l(te,34818,7680),l(te,34819,7680),l(te,2978,[0,0,1024,1024]),l(te,3333,4),l(te,3317,4),l(te,37440,!1),l(te,37441,!1),l(te,37443,37444),l(te,35723,4352),l(te,36010,null),l(te,35977,!1),l(te,3330,0),l(te,3332,0),l(te,3331,0),l(te,3314,0),l(te,32878,0),l(te,3316,0),l(te,3315,0),l(te,32877,0),te),Dr=function(r,e,n){return e?r.enable(n):r.disable(n)},yp=function(r,e,n){return r.hint(n,e)},vt=function(r,e,n){return r.pixelStorei(n,e)},j1=function(r,e){var n=ie(r)?36009:36160;return r.bindFramebuffer(n,e)},F1=function(r,e){return r.bindFramebuffer(36008,e)};function ta(t){return Array.isArray(t)||ArrayBuffer.isView(t)}var _p=(X={},l(X,3042,Dr),l(X,32773,function(r,e){return r.blendColor.apply(r,ue(e))}),l(X,32777,"blendEquation"),l(X,34877,"blendEquation"),l(X,32969,"blendFunc"),l(X,32968,"blendFunc"),l(X,32971,"blendFunc"),l(X,32970,"blendFunc"),l(X,3106,function(r,e){return r.clearColor.apply(r,ue(e))}),l(X,3107,function(r,e){return r.colorMask.apply(r,ue(e))}),l(X,2884,Dr),l(X,2885,function(r,e){return r.cullFace(e)}),l(X,2929,Dr),l(X,2931,function(r,e){return r.clearDepth(e)}),l(X,2932,function(r,e){return r.depthFunc(e)}),l(X,2928,function(r,e){return r.depthRange.apply(r,ue(e))}),l(X,2930,function(r,e){return r.depthMask(e)}),l(X,3024,Dr),l(X,35723,yp),l(X,36006,j1),l(X,2886,function(r,e){return r.frontFace(e)}),l(X,33170,yp),l(X,2849,function(r,e){return r.lineWidth(e)}),l(X,32823,Dr),l(X,32824,"polygonOffset"),l(X,10752,"polygonOffset"),l(X,35977,Dr),l(X,32938,"sampleCoverage"),l(X,32939,"sampleCoverage"),l(X,3089,Dr),l(X,3088,function(r,e){return r.scissor.apply(r,ue(e))}),l(X,2960,Dr),l(X,2961,function(r,e){return r.clearStencil(e)}),l(X,2968,function(r,e){return r.stencilMaskSeparate(1028,e)}),l(X,36005,function(r,e){return r.stencilMaskSeparate(1029,e)}),l(X,2962,"stencilFuncFront"),l(X,2967,"stencilFuncFront"),l(X,2963,"stencilFuncFront"),l(X,34816,"stencilFuncBack"),l(X,36003,"stencilFuncBack"),l(X,36004,"stencilFuncBack"),l(X,2964,"stencilOpFront"),l(X,2965,"stencilOpFront"),l(X,2966,"stencilOpFront"),l(X,34817,"stencilOpBack"),l(X,34818,"stencilOpBack"),l(X,34819,"stencilOpBack"),l(X,2978,function(r,e){return r.viewport.apply(r,ue(e))}),l(X,3333,vt),l(X,3317,vt),l(X,37440,vt),l(X,37441,vt),l(X,37443,vt),l(X,3330,vt),l(X,3332,vt),l(X,3331,vt),l(X,36010,F1),l(X,3314,vt),l(X,32878,vt),l(X,3316,vt),l(X,3315,vt),l(X,32877,vt),l(X,"framebuffer",function(r,e){var n=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,n)}),l(X,"blend",function(r,e){return e?r.enable(3042):r.disable(3042)}),l(X,"blendColor",function(r,e){return r.blendColor.apply(r,ue(e))}),l(X,"blendEquation",function(r,e){e=ta(e)?e:[e,e],r.blendEquationSeparate.apply(r,ue(e))}),l(X,"blendFunc",function(r,e){e=ta(e)&&e.length===2?[].concat(ue(e),ue(e)):e,r.blendFuncSeparate.apply(r,ue(e))}),l(X,"clearColor",function(r,e){return r.clearColor.apply(r,ue(e))}),l(X,"clearDepth",function(r,e){return r.clearDepth(e)}),l(X,"clearStencil",function(r,e){return r.clearStencil(e)}),l(X,"colorMask",function(r,e){return r.colorMask.apply(r,ue(e))}),l(X,"cull",function(r,e){return e?r.enable(2884):r.disable(2884)}),l(X,"cullFace",function(r,e){return r.cullFace(e)}),l(X,"depthTest",function(r,e){return e?r.enable(2929):r.disable(2929)}),l(X,"depthFunc",function(r,e){return r.depthFunc(e)}),l(X,"depthMask",function(r,e){return r.depthMask(e)}),l(X,"depthRange",function(r,e){return r.depthRange.apply(r,ue(e))}),l(X,"dither",function(r,e){return e?r.enable(3024):r.disable(3024)}),l(X,"derivativeHint",function(r,e){r.hint(35723,e)}),l(X,"frontFace",function(r,e){return r.frontFace(e)}),l(X,"mipmapHint",function(r,e){return r.hint(33170,e)}),l(X,"lineWidth",function(r,e){return r.lineWidth(e)}),l(X,"polygonOffsetFill",function(r,e){return e?r.enable(32823):r.disable(32823)}),l(X,"polygonOffset",function(r,e){return r.polygonOffset.apply(r,ue(e))}),l(X,"sampleCoverage",function(r,e){return r.sampleCoverage.apply(r,ue(e))}),l(X,"scissorTest",function(r,e){return e?r.enable(3089):r.disable(3089)}),l(X,"scissor",function(r,e){return r.scissor.apply(r,ue(e))}),l(X,"stencilTest",function(r,e){return e?r.enable(2960):r.disable(2960)}),l(X,"stencilMask",function(r,e){e=ta(e)?e:[e,e];var n=e,i=Z(n,2),a=i[0],o=i[1];r.stencilMaskSeparate(1028,a),r.stencilMaskSeparate(1029,o)}),l(X,"stencilFunc",function(r,e){e=ta(e)&&e.length===3?[].concat(ue(e),ue(e)):e;var n=e,i=Z(n,6),a=i[0],o=i[1],s=i[2],u=i[3],f=i[4],c=i[5];r.stencilFuncSeparate(1028,a,o,s),r.stencilFuncSeparate(1029,u,f,c)}),l(X,"stencilOp",function(r,e){e=ta(e)&&e.length===3?[].concat(ue(e),ue(e)):e;var n=e,i=Z(n,6),a=i[0],o=i[1],s=i[2],u=i[3],f=i[4],c=i[5];r.stencilOpSeparate(1028,a,o,s),r.stencilOpSeparate(1029,u,f,c)}),l(X,"viewport",function(r,e){return r.viewport.apply(r,ue(e))}),X);function Ve(t,r,e){return r[t]!==void 0?r[t]:e[t]}var bp={blendEquation:function(r,e,n){return r.blendEquationSeparate(Ve(32777,e,n),Ve(34877,e,n))},blendFunc:function(r,e,n){return r.blendFuncSeparate(Ve(32969,e,n),Ve(32968,e,n),Ve(32971,e,n),Ve(32970,e,n))},polygonOffset:function(r,e,n){return r.polygonOffset(Ve(32824,e,n),Ve(10752,e,n))},sampleCoverage:function(r,e,n){return r.sampleCoverage(Ve(32938,e,n),Ve(32939,e,n))},stencilFuncFront:function(r,e,n){return r.stencilFuncSeparate(1028,Ve(2962,e,n),Ve(2967,e,n),Ve(2963,e,n))},stencilFuncBack:function(r,e,n){return r.stencilFuncSeparate(1029,Ve(34816,e,n),Ve(36003,e,n),Ve(36004,e,n))},stencilOpFront:function(r,e,n){return r.stencilOpSeparate(1028,Ve(2964,e,n),Ve(2965,e,n),Ve(2966,e,n))},stencilOpBack:function(r,e,n){return r.stencilOpSeparate(1029,Ve(34817,e,n),Ve(34818,e,n),Ve(34819,e,n))}},wf={enable:function(r,e){return r(l({},e,!0))},disable:function(r,e){return r(l({},e,!1))},pixelStorei:function(r,e,n){return r(l({},e,n))},hint:function(r,e,n){return r(l({},e,n))},bindFramebuffer:function(r,e,n){var i;switch(e){case 36160:return r((i={},l(i,36006,n),l(i,36010,n),i));case 36009:return r(l({},36006,n));case 36008:return r(l({},36010,n));default:return null}},blendColor:function(r,e,n,i,a){return r(l({},32773,new Float32Array([e,n,i,a])))},blendEquation:function(r,e){var n;return r((n={},l(n,32777,e),l(n,34877,e),n))},blendEquationSeparate:function(r,e,n){var i;return r((i={},l(i,32777,e),l(i,34877,n),i))},blendFunc:function(r,e,n){var i;return r((i={},l(i,32969,e),l(i,32968,n),l(i,32971,e),l(i,32970,n),i))},blendFuncSeparate:function(r,e,n,i,a){var o;return r((o={},l(o,32969,e),l(o,32968,n),l(o,32971,i),l(o,32970,a),o))},clearColor:function(r,e,n,i,a){return r(l({},3106,new Float32Array([e,n,i,a])))},clearDepth:function(r,e){return r(l({},2931,e))},clearStencil:function(r,e){return r(l({},2961,e))},colorMask:function(r,e,n,i,a){return r(l({},3107,[e,n,i,a]))},cullFace:function(r,e){return r(l({},2885,e))},depthFunc:function(r,e){return r(l({},2932,e))},depthRange:function(r,e,n){return r(l({},2928,new Float32Array([e,n])))},depthMask:function(r,e){return r(l({},2930,e))},frontFace:function(r,e){return r(l({},2886,e))},lineWidth:function(r,e){return r(l({},2849,e))},polygonOffset:function(r,e,n){var i;return r((i={},l(i,32824,e),l(i,10752,n),i))},sampleCoverage:function(r,e,n){var i;return r((i={},l(i,32938,e),l(i,32939,n),i))},scissor:function(r,e,n,i,a){return r(l({},3088,new Int32Array([e,n,i,a])))},stencilMask:function(r,e){var n;return r((n={},l(n,2968,e),l(n,36005,e),n))},stencilMaskSeparate:function(r,e,n){return r(l({},e===1028?2968:36005,n))},stencilFunc:function(r,e,n,i){var a;return r((a={},l(a,2962,e),l(a,2967,n),l(a,2963,i),l(a,34816,e),l(a,36003,n),l(a,36004,i),a))},stencilFuncSeparate:function(r,e,n,i,a){var o;return r((o={},l(o,e===1028?2962:34816,n),l(o,e===1028?2967:36003,i),l(o,e===1028?2963:36004,a),o))},stencilOp:function(r,e,n,i){var a;return r((a={},l(a,2964,e),l(a,2965,n),l(a,2966,i),l(a,34817,e),l(a,34818,n),l(a,34819,i),a))},stencilOpSeparate:function(r,e,n,i,a){var o;return r((o={},l(o,e===1028?2964:34817,n),l(o,e===1028?2965:34818,i),l(o,e===1028?2966:34819,a),o))},viewport:function(r,e,n,i,a){return r(l({},2978,[e,n,i,a]))}},Zt=function(r,e){return r.isEnabled(e)},xf=(Tt={},l(Tt,3042,Zt),l(Tt,2884,Zt),l(Tt,2929,Zt),l(Tt,3024,Zt),l(Tt,32823,Zt),l(Tt,32926,Zt),l(Tt,32928,Zt),l(Tt,3089,Zt),l(Tt,2960,Zt),l(Tt,35977,Zt),Tt);function Tf(t){for(var r in t)return!1;return!0}function wp(t,r){if(t===r)return!0;var e=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(r)||ArrayBuffer.isView(r);if(e&&n&&t.length===r.length){for(var i=0;i<t.length;++i)if(t[i]!==r[i])return!1;return!0}return!1}function xp(t,r){var e=t[r].bind(t);t[r]=function(){var i=arguments.length<=0?void 0:arguments[0];return i in t.state.cache&&t.state.enable?t.state.cache[i]:e.apply(void 0,arguments)},Object.defineProperty(t[r],"name",{value:"".concat(r,"-from-cache"),configurable:!1})}function N1(t,r,e){var n=t[r].bind(t);t[r]=function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];var u=e.apply(void 0,[t.state._updateCache].concat(o)),f=u.valueChanged,c=u.oldValue;return f&&n.apply(void 0,o),c},Object.defineProperty(t[r],"name",{value:"".concat(r,"-to-cache"),configurable:!1})}function B1(t){var r=t.useProgram.bind(t);t.useProgram=function(n){t.state.program!==n&&(r(n),t.state.program=n)}}var V1=function(){function t(r){T(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.copyState,i=n===void 0?!1:n,a=e.log,o=a===void 0?function(){}:a;this.gl=r,this.program=null,this.stateStack=[],this.enable=!0,this.cache=i?ri(r):Object.assign({},ra),this.log=o,this._updateCache=this._updateCache.bind(this),Object.seal(this)}return S(t,[{key:"push",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.stateStack.push({})}},{key:"pop",value:function(){Ue(this.stateStack.length>0);var e=this.stateStack[this.stateStack.length-1];Xe(this.gl,e),this.stateStack.pop()}},{key:"_updateCache",value:function(e){var n=!1,i,a=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(var o in e){Ue(o!==void 0);var s=e[o],u=this.cache[o];wp(s,u)||(n=!0,i=u,a&&!(o in a)&&(a[o]=u),this.cache[o]=s)}return{valueChanged:n,oldValue:i}}}]),t}();function Ao(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.enable,n=e===void 0?!0:e,i=r.copyState;if(Ue(i!==void 0),!t.state){var a=globalThis.polyfillContext;a&&a(t),t.state=new V1(t,{copyState:i}),B1(t);for(var o in wf){var s=wf[o];N1(t,o,s)}xp(t,"getParameter"),xp(t,"isEnabled")}return t.state.enable=n,t}function Ef(t){t.state||Ao(t,{copyState:!1}),t.state.push()}function Oo(t){Ue(t.state),t.state.pop()}function z1(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=U1(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function U1(t,r){if(t){if(typeof t=="string")return Tp(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Tp(t,r)}}function Tp(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Xe(t,r){if(Ue(mr(t),"setParameters requires a WebGL context"),!Tf(r)){var e={};for(var n in r){var i=Number(n),a=_p[n];a&&(typeof a=="string"?e[a]=!0:a(t,r[n],i))}var o=t.state&&t.state.cache;if(o)for(var s in e){var u=bp[s];u(t,r,o)}}}function ri(t,r){if(r=r||ra,typeof r=="number"){var e=r,n=xf[e];return n?n(t,e):t.getParameter(e)}var i=Array.isArray(r)?r:Object.keys(r),a={},o=z1(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,f=xf[u];a[u]=f?f(t,Number(u)):t.getParameter(Number(u))}}catch(c){o.e(c)}finally{o.f()}return a}function Mo(t){Xe(t,ra)}function Ae(t,r,e){if(Tf(r))return e(t);var n=r.nocatch,i=n===void 0?!0:n;Ef(t),Xe(t,r);var a;if(i)a=e(t),Oo(t);else try{a=e(t)}finally{Oo(t)}return a}function mt(t){var r=t.luma;if(t.canvas&&r){var e=r.canvasSizeInfo,n="clientWidth"in e?e.clientWidth:t.canvas.clientWidth;return n?t.drawingBufferWidth/n:1}return 1}function ni(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=mt(t),i=t.drawingBufferWidth,a=t.drawingBufferHeight;return G1(r,n,i,a,e)}function Sp(t){var r=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?r:1}function G1(t,r,e,n,i){var a=Ep(t[0],r,e),o=Pp(t[1],r,n,i),s=Ep(t[0]+1,r,e),u=s===e-1?s:s-1;s=Pp(t[1]+1,r,n,i);var f;return i?(s=s===0?s:s+1,f=o,o=s):f=s===n-1?s:s-1,{x:a,y:o,width:Math.max(u-a+1,1),height:Math.max(f-o+1,1)}}function Ep(t,r,e){var n=Math.min(Math.round(t*r),e-1);return n}function Pp(t,r,e,n){return n?Math.max(0,e-1-Math.round(t*r)):Math.min(Math.round(t*r),e-1)}var Pf=Ye(),$1=Pf&&typeof document<"u",Ap={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function ii(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ue(Pf,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},Ap,t);var r=t,e=r.width,n=r.height;function i(f){if(t.throwOnError)throw new Error(f);return console.error(f),null}t.onError=i;var a,o=t,s=o.canvas,u=W1({canvas:s,width:e,height:n,onError:i});return a=H1(u,t),a?(a=yr(a,t),Y1(a),a):null}function yr(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||X1(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},r=Object.assign({},Ap,r);var e=r,n=e.manageState,i=e.debug;return n&&Ao(t,{copyState:!1,log:function(){for(var o=arguments.length,s=new Array(o),u=0;u<o;u++)s[u]=arguments[u];return Q.log.apply(Q,[1].concat(s))()}}),Pf&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,r),Q.level=Math.max(Q.level,1)):Q.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function Op(t){var r=t.getParameter(7936),e=t.getParameter(7937),n=t.getExtension("WEBGL_debug_renderer_info"),i=n&&t.getParameter(n.UNMASKED_VENDOR_WEBGL||7936),a=n&&t.getParameter(n.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||r,renderer:a||e,vendorMasked:r,rendererMasked:e,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function Sf(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){var e=Sp(r.useDevicePixels);q1(t,e,r);return}var n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in r&&"height"in r&&n.resize(r.width,r.height)}function H1(t,r){var e=r.onError,n=null,i=function(h){return n=h.statusMessage||n};t.addEventListener("webglcontextcreationerror",i,!1);var a=r.webgl1,o=a===void 0?!0:a,s=r.webgl2,u=s===void 0?!0:s,f=null;return u&&(f=f||t.getContext("webgl2",r),f=f||t.getContext("experimental-webgl2",r)),o&&(f=f||t.getContext("webgl",r),f=f||t.getContext("experimental-webgl",r)),t.removeEventListener("webglcontextcreationerror",i,!1),f?(r.onContextLost&&t.addEventListener("webglcontextlost",r.onContextLost,!1),r.onContextRestored&&t.addEventListener("webglcontextrestored",r.onContextRestored,!1),f):e("Failed to create ".concat(u&&!o?"WebGL2":"WebGL"," context: ").concat(n||"Unknown error"))}function W1(t){var r=t.canvas,e=t.width,n=e===void 0?800:e,i=t.height,a=i===void 0?600:i,o=t.onError,s;if(typeof r=="string"){var u=$1&&document.readyState==="complete";u||o("createGLContext called on canvas '".concat(r,"' before page was loaded")),s=document.getElementById(r)}else r?s=r:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",s.style.height=Number.isFinite(a)?"".concat(a,"px"):"100%",document.body.insertBefore(s,document.body.firstChild));return s}function Y1(t){var r=ie(t)?"WebGL2":"WebGL1",e=Op(t),n=e?"(".concat(e.vendor,",").concat(e.renderer,")"):"",i=t.debug?" debug":"";Q.info(1,"".concat(r).concat(i," context ").concat(n))()}function X1(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function q1(t,r,e){var n="width"in e?e.width:t.canvas.clientWidth,i="height"in e?e.height:t.canvas.clientHeight;(!n||!i)&&(Q.log(1,"Canvas clientWidth/clientHeight is 0")(),r=1,n=t.canvas.width||1,i=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};var a=t.luma.canvasSizeInfo;if(a.clientWidth!==n||a.clientHeight!==i||a.devicePixelRatio!==r){var o=r,s=Math.floor(n*o),u=Math.floor(i*o);t.canvas.width=s,t.canvas.height=u,(t.drawingBufferWidth!==s||t.drawingBufferHeight!==u)&&(Q.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/n,t.drawingBufferHeight/i),t.canvas.width=Math.floor(n*o),t.canvas.height=Math.floor(i*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:n,clientHeight:i,devicePixelRatio:r})}}function na(){var t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){var r=process.hrtime();t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}var ko=function(){function t(r,e){T(this,t),l(this,"name",void 0),l(this,"type",void 0),l(this,"sampleSize",1),l(this,"time",void 0),l(this,"count",void 0),l(this,"samples",void 0),l(this,"lastTiming",void 0),l(this,"lastSampleTime",void 0),l(this,"lastSampleCount",void 0),l(this,"_count",0),l(this,"_time",0),l(this,"_samples",0),l(this,"_startTime",0),l(this,"_timerPending",!1),this.name=r,this.type=e,this.reset()}return S(t,[{key:"setSampleSize",value:function(e){return this.sampleSize=e,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(e){return this._count+=e,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(e){return this._count-=e,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=na(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(na()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}();var pn=function(){function t(r){T(this,t),l(this,"id",void 0),l(this,"stats",{}),this.id=r.id,this.stats={},this._initializeStats(r.stats),Object.seal(this)}return S(t,[{key:"get",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}},{key:"size",get:function(){return Object.keys(this.stats).length}},{key:"reset",value:function(){for(var e in this.stats)this.stats[e].reset();return this}},{key:"forEach",value:function(e){for(var n in this.stats)e(this.stats[n])}},{key:"getTable",value:function(){var e={};return this.forEach(function(n){e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}},{key:"_initializeStats",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];n.forEach(function(i){return e._getOrCreate(i)})}},{key:"_getOrCreate",value:function(e){if(!e||!e.name)return null;var n=e.name,i=e.type;return this.stats[n]||(e instanceof ko?this.stats[n]=e:this.stats[n]=new ko(n,i)),this.stats[n]}}]),t}();var ia="8.5.21",Z1="set luma.log.level=1 (or higher) to trace rendering",K1=function(){function t(){T(this,t),this.stats=new Map}return S(t,[{key:"get",value:function(e){return this.stats.has(e)||this.stats.set(e,new pn({id:e})),this.stats.get(e)}}]),t}(),Et=new K1;if(globalThis.luma&&globalThis.luma.VERSION!==ia)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(ia));globalThis.luma||(Ye()&&Q.log(1,"luma.gl ".concat(ia," - ").concat(Z1))(),globalThis.luma=globalThis.luma||{VERSION:ia,version:ia,log:Q,stats:Et,globals:{modules:{},nodeIO:{}}});var r3=globalThis.luma;function Af(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function Of(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function W(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dn(t,r){return dn=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},dn(t,r)}function N(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&dn(t,r)}function z(t,r){if(r&&(ne(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return W(t)}function M(t){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},M(t)}function H(t,r){if(!t)throw new Error(r||"luma.gl: assertion failed.")}function Ro(t,r){if(typeof r!="string")return r;var e=Number(r);if(!isNaN(e))return e;r=r.replace(/^.*\./,"");var n=t[r];return H(n!==void 0,"Accessing undefined constant GL.".concat(r)),n}function Pt(t,r){r=Number(r);for(var e in t)if(t[e]===r)return"GL.".concat(e);return String(r)}var Mf={};function Pe(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Mf[t]=Mf[t]||1;var r=Mf[t]++;return"".concat(t,"-").concat(r)}function kf(t){return H(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Kt(t){var r=!0;for(var e in t){r=!1;break}return r}function Co(t,r,e,n){var i="See luma.gl ".concat(e," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),a=Object.getPrototypeOf(t);n.forEach(function(o){a.methodName||(a[o]=function(){throw Q.removed("Calling removed method ".concat(r,".").concat(o,": "),i)(),new Error(o)})})}function Q1(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=J1(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function J1(t,r){if(t){if(typeof t=="string")return Mp(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Mp(t,r)}}function Mp(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var ai="Resource subclass must define virtual methods",Je=function(t){function r(e){T(this,r);var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};gr(e);var i=n.id,a=n.userData,o=a===void 0?{}:a;this.gl=e,this.gl2=e,this.id=i||Pe(this[Symbol.toStringTag]),this.userData=o,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}return S(r,[{key:t,get:function(){return"Resource"}},{key:"toString",value:function(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}},{key:"handle",get:function(){return this._handle}},{key:"delete",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.deleteChildren,a=i===void 0?!1:i,o=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,o&&a&&o.filter(Boolean).forEach(function(s){return s.delete()}),this}},{key:"bind",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof n!="function")return this._bindHandle(n),this;var i;return this._bound?i=n():(this._bindHandle(this.handle),this._bound=!0,i=n(),this._bound=!1,this._bindHandle(null)),i}},{key:"unbind",value:function(){this.bind(null)}},{key:"getParameter",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};n=Ro(this.gl,n),H(n);var a=this.constructor.PARAMETERS||{},o=a[n];if(o){var s=ie(this.gl),u=(!("webgl2"in o)||s)&&(!("extension"in o)||this.gl.getExtension(o.extension));if(!u){var f=o.webgl1,c="webgl2"in o?o.webgl2:o.webgl1,h=s?c:f;return h}}return this._getParameter(n,i)}},{key:"getParameters",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.parameters,a=n.keys,o=this.constructor.PARAMETERS||{},s=ie(this.gl),u={},f=i||Object.keys(o),c=Q1(f),h;try{for(c.s();!(h=c.n()).done;){var p=h.value,d=o[p],v=d&&(!("webgl2"in d)||s)&&(!("extension"in d)||this.gl.getExtension(d.extension));if(v){var m=a?Pt(this.gl,p):p;u[m]=this.getParameter(p,n),a&&d.type==="GLenum"&&(u[m]=Pt(this.gl,u[m]))}}}catch(g){c.e(g)}finally{c.f()}return u}},{key:"setParameter",value:function(n,i){n=Ro(this.gl,n),H(n);var a=this.constructor.PARAMETERS||{},o=a[n];if(o){var s=ie(this.gl),u=(!("webgl2"in o)||s)&&(!("extension"in o)||this.gl.getExtension(o.extension));if(!u)throw new Error("Parameter not available on this platform");o.type==="GLenum"&&(i=Ro(i))}return this._setParameter(n,i),this}},{key:"setParameters",value:function(n){for(var i in n)this.setParameter(i,n[i]);return this}},{key:"stubRemovedMethods",value:function(n,i,a){return Co(this,n,i,a)}},{key:"initialize",value:function(n){}},{key:"_createHandle",value:function(){throw new Error(ai)}},{key:"_deleteHandle",value:function(){throw new Error(ai)}},{key:"_bindHandle",value:function(n){throw new Error(ai)}},{key:"_getOptsFromHandle",value:function(){throw new Error(ai)}},{key:"_getParameter",value:function(n,i){throw new Error(ai)}},{key:"_setParameter",value:function(n,i){throw new Error(ai)}},{key:"_context",value:function(){return this.gl.luma=this.gl.luma||{},this.gl.luma}},{key:"_addStats",value:function(){var n=this[Symbol.toStringTag],i=Et.get("Resource Counts");i.get("Resources Created").incrementCount(),i.get("".concat(n,"s Created")).incrementCount(),i.get("".concat(n,"s Active")).incrementCount()}},{key:"_removeStats",value:function(){var n=this[Symbol.toStringTag],i=Et.get("Resource Counts");i.get("".concat(n,"s Active")).decrementCount()}},{key:"_trackAllocatedMemory",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(n,i),this._trackAllocatedMemoryForContext(n,i,this.gl.canvas&&this.gl.canvas.id),this.byteLength=n}},{key:"_trackAllocatedMemoryForContext",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"",o=Et.get("Memory Usage".concat(a));o.get("GPU Memory").addCount(n),o.get("".concat(i," Memory")).addCount(n)}},{key:"_trackDeallocatedMemory",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(n),this._trackDeallocatedMemoryForContext(n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}},{key:"_trackDeallocatedMemoryForContext",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",a=Et.get("Memory Usage".concat(i));a.get("GPU Memory").subtractCount(this.byteLength),a.get("".concat(n," Memory")).subtractCount(this.byteLength)}}]),r}(Symbol.toStringTag);function Rf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function oi(t,r,e){return Rf()?oi=Reflect.construct:oi=function(i,a,o){var s=[null];s.push.apply(s,a);var u=Function.bind.apply(i,s),f=new u;return o&&dn(f,o.prototype),f},oi.apply(null,arguments)}var ew="Failed to deduce GL constant from typed array";function aa(t){var r=ArrayBuffer.isView(t)?t.constructor:t;switch(r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(ew)}}function jr(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.clamped,n=e===void 0?!0:e;switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function kp(t){var r=t.data,e=t.width,n=t.height,i=t.bytesPerPixel,a=i===void 0?4:i,o=t.temp,s=e*a;o=o||new Uint8Array(s);for(var u=0;u<n/2;++u){var f=u*s,c=(n-u-1)*s;o.set(r.subarray(f,f+s)),r.copyWithin(f,c,c+s),r.set(o,c)}}function Rp(t){for(var r=t.data,e=t.width,n=t.height,i=Math.round(e/2),a=Math.round(n/2),o=new Uint8Array(i*a*4),s=0;s<a;s++)for(var u=0;u<i;u++)for(var f=0;f<4;f++)o[(s*i+u)*4+f]=r[(s*2*e+u*2)*4+f];return{data:o,width:i,height:a}}function oa(t,r,e){var n=e.removedProps,i=n===void 0?{}:n,a=e.deprecatedProps,o=a===void 0?{}:a,s=e.replacedProps,u=s===void 0?{}:s;for(var f in i)if(f in r){var c=i[f],h=c?"".concat(t,".").concat(i[f]):"N/A";Q.removed("".concat(t,".").concat(f),h)()}for(var p in o)if(p in r){var d=o[p];Q.deprecated("".concat(t,".").concat(p),"".concat(t,".").concat(d))()}var v=null;for(var m in u)if(m in r){var g=u[m];Q.deprecated("".concat(t,".").concat(m),"".concat(t,".").concat(g))(),v=v||Object.assign({},r),v[g]=r[m],delete v[m]}return v||r}var tw={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},rw={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}},St=function(){function t(){var r=this;T(this,t);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(function(a){return r._assign(a)}),Object.freeze(this)}return S(t,[{key:"toString",value:function(){return JSON.stringify(this)}},{key:"BYTES_PER_ELEMENT",get:function(){return t.getBytesPerElement(this)}},{key:"BYTES_PER_VERTEX",get:function(){return t.getBytesPerVertex(this)}},{key:"_assign",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=oa("Accessor",e,rw),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}],[{key:"getBytesPerElement",value:function(e){var n=jr(e.type||5126);return n.BYTES_PER_ELEMENT}},{key:"getBytesPerVertex",value:function(e){H(e.size);var n=jr(e.type||5126);return n.BYTES_PER_ELEMENT*e.size}},{key:"resolve",value:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return oi(t,[tw].concat(n))}}]),t}();function nw(t){var r=iw();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function iw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Cp=10,Ip={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},aw={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:Ip},ow={removedProps:Ip},fe=function(t,r){N(n,t);var e=nw(n);function n(i){var a;T(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),a.target=o.target||(a.gl.webgl2?36662:34962),a.initialize(o),Object.seal(W(a)),a}return S(n,[{key:r,get:function(){return"Buffer"}},{key:"getElementCount",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/St.getBytesPerElement(a))}},{key:"getVertexCount",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/St.getBytesPerVertex(a))}},{key:"initialize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(a)&&(a={data:a}),Number.isFinite(a)&&(a={byteLength:a}),a=oa("Buffer",a,aw),this.usage=a.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},a,a.accessor)),a.data?this._setData(a.data,a.offset,a.byteLength):this._setByteLength(a.byteLength||0),this}},{key:"setProps",value:function(a){return a=oa("Buffer",a,ow),"accessor"in a&&this.setAccessor(a.accessor),this}},{key:"setAccessor",value:function(a){return a=Object.assign({},a),delete a.buffer,this.accessor=new St(a),this}},{key:"reallocate",value:function(a){return a>this.byteLength?(this._setByteLength(a),!0):(this.bytesUsed=a,!1)}},{key:"setData",value:function(a){return this.initialize(a)}},{key:"subData",value:function(a){ArrayBuffer.isView(a)&&(a={data:a});var o=a,s=o.data,u=o.offset,f=u===void 0?0:u,c=o.srcOffset,h=c===void 0?0:c,p=a.byteLength||a.length;H(s);var d=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(d,this.handle),h!==0||p!==void 0?(ke(this.gl),this.gl.bufferSubData(this.target,f,s,h,p)):this.gl.bufferSubData(d,f,s),this.gl.bindBuffer(d,null),this.debugData=null,this._inferType(s),this}},{key:"copyData",value:function(a){var o=a.sourceBuffer,s=a.readOffset,u=s===void 0?0:s,f=a.writeOffset,c=f===void 0?0:f,h=a.size,p=this.gl;return ke(p),p.bindBuffer(36662,o.handle),p.bindBuffer(36663,this.handle),p.copyBufferSubData(36662,36663,u,c,h),p.bindBuffer(36662,null),p.bindBuffer(36663,null),this.debugData=null,this}},{key:"getData",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.dstData,s=o===void 0?null:o,u=a.srcByteOffset,f=u===void 0?0:u,c=a.dstOffset,h=c===void 0?0:c,p=a.length,d=p===void 0?0:p;ke(this.gl);var v=jr(this.accessor.type||5126,{clamped:!1}),m=this._getAvailableElementCount(f),g=h,_,w;s?(w=s.length,_=w-g):(_=Math.min(m,d||m),w=g+_);var x=Math.min(m,_);return d=d||x,H(d<=x),s=s||new v(w),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,f,s,h,d),this.gl.bindBuffer(36662,null),s}},{key:"bind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?this.target:o,u=a.index,f=u===void 0?this.accessor&&this.accessor.index:u,c=a.offset,h=c===void 0?0:c,p=a.size;return s===35345||s===35982?p!==void 0?this.gl.bindBufferRange(s,f,this.handle,h,p):(H(h===0),this.gl.bindBufferBase(s,f,this.handle)):this.gl.bindBuffer(s,this.handle),this}},{key:"unbind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?this.target:o,u=a.index,f=u===void 0?this.accessor&&this.accessor.index:u,c=s===35345||s===35982;return c?this.gl.bindBufferBase(s,f,null):this.gl.bindBuffer(s,null),this}},{key:"getDebugData",value:function(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Cp,this.byteLength)}),{data:this.debugData,changed:!0})}},{key:"invalidateDebugData",value:function(){this.debugData=null}},{key:"_setData",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:a.byteLength+o;H(ArrayBuffer.isView(a)),this._trackDeallocatedMemory();var u=this._getTarget();this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,s,this.usage),this.gl.bufferSubData(u,o,a),this.gl.bindBuffer(u,null),this.debugData=a.slice(0,Cp),this.bytesUsed=s,this._trackAllocatedMemory(s);var f=aa(a);return H(f),this.setAccessor(new St(this.accessor,{type:f})),this}},{key:"_setByteLength",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;H(a>=0),this._trackDeallocatedMemory();var s=a;a===0&&(s=new Float32Array(0));var u=this._getTarget();return this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,s,o),this.gl.bindBuffer(u,null),this.usage=o,this.debugData=null,this.bytesUsed=a,this._trackAllocatedMemory(a),this}},{key:"_getTarget",value:function(){return this.gl.webgl2?36663:this.target}},{key:"_getAvailableElementCount",value:function(a){var o=jr(this.accessor.type||5126,{clamped:!1}),s=a/o.BYTES_PER_ELEMENT;return this.getElementCount()-s}},{key:"_inferType",value:function(a){this.accessor.type||this.setAccessor(new St(this.accessor,{type:aa(a)}))}},{key:"_createHandle",value:function(){return this.gl.createBuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_getParameter",value:function(a){this.gl.bindBuffer(this.target,this.handle);var o=this.gl.getBufferParameter(this.target,a);return this.gl.bindBuffer(this.target,null),o}},{key:"type",get:function(){return Q.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}},{key:"bytes",get:function(){return Q.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}},{key:"setByteLength",value:function(a){return Q.deprecated("setByteLength","reallocate")(),this.reallocate(a)}},{key:"updateAccessor",value:function(a){return Q.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new St(this.accessor,a),this}}]),n}(Je,Symbol.toStringTag);var Vt,lt,Qt,Io=(Vt={},l(Vt,6407,{dataFormat:6407,types:[5121,33635]}),l(Vt,6408,{dataFormat:6408,types:[5121,32819,32820]}),l(Vt,6406,{dataFormat:6406,types:[5121]}),l(Vt,6409,{dataFormat:6409,types:[5121]}),l(Vt,6410,{dataFormat:6410,types:[5121]}),l(Vt,33326,{dataFormat:6403,types:[5126],gl2:!0}),l(Vt,33328,{dataFormat:33319,types:[5126],gl2:!0}),l(Vt,34837,{dataFormat:6407,types:[5126],gl2:!0}),l(Vt,34836,{dataFormat:6408,types:[5126],gl2:!0}),Vt),Lo=(lt={},l(lt,6403,1),l(lt,36244,1),l(lt,33319,2),l(lt,33320,2),l(lt,6407,3),l(lt,36248,3),l(lt,6408,4),l(lt,36249,4),l(lt,6402,1),l(lt,34041,1),l(lt,6406,1),l(lt,6409,1),l(lt,6410,2),lt),Do=(Qt={},l(Qt,5126,4),l(Qt,5125,4),l(Qt,5124,4),l(Qt,5123,2),l(Qt,5122,2),l(Qt,5131,2),l(Qt,5120,1),l(Qt,5121,1),Qt);function Lp(t,r){var e=Io[r];if(!e)return!1;if(e.gl1===void 0&&e.gl2===void 0)return!0;var n=ie(t)&&e.gl2||e.gl1;return typeof n=="string"?t.getExtension(n):n}function Dp(t,r){var e=Io[r];switch(e&&e.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}function sw(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=uw(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function uw(t,r){if(t){if(typeof t=="string")return jp(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return jp(t,r)}}function jp(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function fw(t){var r=lw();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function lw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cw=[9729,9728],Fp=globalThis.WebGLBuffer||function(){},gt=function(t,r){N(n,t);var e=fw(n);function n(i,a){var o;T(this,n);var s=a.id,u=s===void 0?Pe("texture"):s,f=a.handle,c=a.target;return o=e.call(this,i,{id:u,handle:f}),o.target=c,o.textureUnit=void 0,o.loaded=!1,o.width=void 0,o.height=void 0,o.depth=void 0,o.format=void 0,o.type=void 0,o.dataFormat=void 0,o.border=void 0,o.textureUnit=void 0,o.mipmaps=void 0,o}return S(n,[{key:r,get:function(){return"Texture"}},{key:"toString",value:function(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}},{key:"initialize",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=o.data;if(s instanceof Promise)return s.then(function(U){return a.initialize(Object.assign({},o,{pixels:U,data:U}))}),this;var u=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement;if(u&&s.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,s.addEventListener("loadeddata",function(){return a.initialize(o)}),this;var f=o.pixels,c=f===void 0?null:f,h=o.format,p=h===void 0?6408:h,d=o.border,v=d===void 0?0:d,m=o.recreate,g=m===void 0?!1:m,_=o.parameters,w=_===void 0?{}:_,x=o.pixelStore,P=x===void 0?{}:x,E=o.textureUnit,A=E===void 0?void 0:E;s||(s=c);var R=o.width,D=o.height,j=o.dataFormat,I=o.type,V=o.compressed,F=V===void 0?!1:V,G=o.mipmaps,B=G===void 0?!0:G,K=o.depth,C=K===void 0?0:K,k=this._deduceParameters({format:p,type:I,dataFormat:j,compressed:F,data:s,width:R,height:D});return R=k.width,D=k.height,F=k.compressed,j=k.dataFormat,I=k.type,this.width=R,this.height=D,this.depth=C,this.format=p,this.type=I,this.dataFormat=j,this.border=v,this.textureUnit=A,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),B&&this._isNPOT()&&(Q.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),B=!1,this._updateForNPOT(w)),this.mipmaps=B,this.setImageData({data:s,width:R,height:D,depth:C,format:p,type:I,dataFormat:j,border:v,mipmaps:B,parameters:P,compressed:F}),B&&this.generateMipmap(),this.setParameters(w),g&&(this.data=s),u&&(this._video={video:s,parameters:w,lastTime:s.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?s.currentTime:-1}),this}},{key:"update",value:function(){if(this._video){var a=this._video,o=a.video,s=a.parameters,u=a.lastTime;if(u===o.currentTime||o.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:o,parameters:s}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=o.currentTime}}},{key:"resize",value:function(a){var o=a.height,s=a.width,u=a.mipmaps,f=u===void 0?!1:u;return s!==this.width||o!==this.height?this.initialize({width:s,height:o,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:f}):this}},{key:"generateMipmap",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Q.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Ae(this.gl,o,function(){a.gl.generateMipmap(a.target)}),this.gl.bindTexture(this.target,null),this)}},{key:"setImageData",value:function(a){this._trackDeallocatedMemory("Texture");var o=a.target,s=o===void 0?this.target:o,u=a.pixels,f=u===void 0?null:u,c=a.level,h=c===void 0?0:c,p=a.format,d=p===void 0?this.format:p,v=a.border,m=v===void 0?this.border:v,g=a.offset,_=g===void 0?0:g,w=a.parameters,x=w===void 0?{}:w,P=a.data,E=P===void 0?null:P,A=a.type,R=A===void 0?this.type:A,D=a.width,j=D===void 0?this.width:D,I=a.height,V=I===void 0?this.height:I,F=a.dataFormat,G=F===void 0?this.dataFormat:F,B=a.compressed,K=B===void 0?!1:B;E||(E=f);var C=this._deduceParameters({format:d,type:R,dataFormat:G,compressed:K,data:E,width:j,height:V});R=C.type,G=C.dataFormat,K=C.compressed,j=C.width,V=C.height;var k=this.gl;k.bindTexture(this.target,this.handle);var U=null,$=this._getDataType({data:E,compressed:K});E=$.data,U=$.dataType;var q,J=0;if(Ae(this.gl,x,function(){switch(U){case"null":k.texImage2D(s,h,d,j,V,m,G,R,E);break;case"typed-array":k.texImage2D(s,h,d,j,V,m,G,R,E,_);break;case"buffer":q=ke(k),q.bindBuffer(35052,E.handle||E),q.texImage2D(s,h,d,j,V,m,G,R,_),q.bindBuffer(35052,null);break;case"browser-object":ie(k)?k.texImage2D(s,h,d,j,V,m,G,R,E):k.texImage2D(s,h,d,G,R,E);break;case"compressed":var le=sw(E.entries()),ge;try{for(le.s();!(ge=le.n()).done;){var oe=Z(ge.value,2),ye=oe[0],se=oe[1];k.compressedTexImage2D(s,ye,se.format,se.width,se.height,m,se.data),J+=se.levelSize}}catch(Fe){le.e(Fe)}finally{le.f()}break;default:H(!1,"Unknown image data type")}}),U==="compressed")this._trackAllocatedMemory(J,"Texture");else if(E&&E.byteLength)this._trackAllocatedMemory(E.byteLength,"Texture");else{var re=Lo[this.dataFormat]||4,ae=Do[this.type]||1;this._trackAllocatedMemory(this.width*this.height*re*ae,"Texture")}return this.loaded=!0,this}},{key:"setSubImageData",value:function(a){var o=this,s=a.target,u=s===void 0?this.target:s,f=a.pixels,c=f===void 0?null:f,h=a.data,p=h===void 0?null:h,d=a.x,v=d===void 0?0:d,m=a.y,g=m===void 0?0:m,_=a.width,w=_===void 0?this.width:_,x=a.height,P=x===void 0?this.height:x,E=a.level,A=E===void 0?0:E,R=a.format,D=R===void 0?this.format:R,j=a.type,I=j===void 0?this.type:j,V=a.dataFormat,F=V===void 0?this.dataFormat:V,G=a.compressed,B=G===void 0?!1:G,K=a.offset,C=K===void 0?0:K,k=a.border,U=k===void 0?this.border:k,$=a.parameters,q=$===void 0?{}:$,J=this._deduceParameters({format:D,type:I,dataFormat:F,compressed:B,data:p,width:w,height:P});if(I=J.type,F=J.dataFormat,B=J.compressed,w=J.width,P=J.height,H(this.depth===0,"texSubImage not supported for 3D textures"),p||(p=c),p&&p.data){var re=p;p=re.data,w=re.shape[0],P=re.shape[1]}p instanceof fe&&(p=p.handle),this.gl.bindTexture(this.target,this.handle),Ae(this.gl,q,function(){if(B)o.gl.compressedTexSubImage2D(u,A,v,g,w,P,D,p);else if(p===null)o.gl.texSubImage2D(u,A,v,g,w,P,F,I,null);else if(ArrayBuffer.isView(p))o.gl.texSubImage2D(u,A,v,g,w,P,F,I,p,C);else if(p instanceof Fp){var ae=ke(o.gl);ae.bindBuffer(35052,p),ae.texSubImage2D(u,A,v,g,w,P,F,I,C),ae.bindBuffer(35052,null)}else if(ie(o.gl)){var le=ke(o.gl);le.texSubImage2D(u,A,v,g,w,P,F,I,p)}else o.gl.texSubImage2D(u,A,v,g,F,I,p)}),this.gl.bindTexture(this.target,null)}},{key:"copyFramebuffer",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Q.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(34016)-33984}},{key:"bind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit,o=this.gl;return a!==void 0&&(this.textureUnit=a,o.activeTexture(33984+a)),o.bindTexture(this.target,this.handle),a}},{key:"unbind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit,o=this.gl;return a!==void 0&&(this.textureUnit=a,o.activeTexture(33984+a)),o.bindTexture(this.target,null),a}},{key:"_getDataType",value:function(a){var o=a.data,s=a.compressed,u=s===void 0?!1:s;return u?{data:o,dataType:"compressed"}:o===null?{data:o,dataType:"null"}:ArrayBuffer.isView(o)?{data:o,dataType:"typed-array"}:o instanceof fe?{data:o.handle,dataType:"buffer"}:o instanceof Fp?{data:o,dataType:"buffer"}:{data:o,dataType:"browser-object"}}},{key:"_deduceParameters",value:function(a){var o=a.format,s=a.data,u=a.width,f=a.height,c=a.dataFormat,h=a.type,p=a.compressed,d=Io[o];c=c||d&&d.dataFormat,h=h||d&&d.types[0],p=p||d&&d.compressed;var v=this._deduceImageSize(s,u,f);return u=v.width,f=v.height,{dataFormat:c,type:h,compressed:p,width:u,height:f,format:o,data:s}}},{key:"_deduceImageSize",value:function(a,o,s){var u;return typeof ImageData<"u"&&a instanceof ImageData?u={width:a.width,height:a.height}:typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement?u={width:a.naturalWidth,height:a.naturalHeight}:typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement?u={width:a.width,height:a.height}:typeof ImageBitmap<"u"&&a instanceof ImageBitmap?u={width:a.width,height:a.height}:typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement?u={width:a.videoWidth,height:a.videoHeight}:a?u={width:o,height:s}:u={width:o>=0?o:1,height:s>=0?s:1},H(u,"Could not deduced texture size"),H(o===void 0||u.width===o,"Deduced texture width does not match supplied width"),H(s===void 0||u.height===s,"Deduced texture height does not match supplied height"),u}},{key:"_createHandle",value:function(){return this.gl.createTexture()}},{key:"_deleteHandle",value:function(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}},{key:"_getParameter",value:function(a){switch(a){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);var o=this.gl.getTexParameter(this.target,a);return this.gl.bindTexture(this.target,null),o}}},{key:"_setParameter",value:function(a,o){switch(this.gl.bindTexture(this.target,this.handle),o=this._getNPOTParam(a,o),a){case 33082:case 33083:this.gl.texParameterf(this.handle,a,o);break;case 4096:case 4097:H(!1);break;default:this.gl.texParameteri(this.target,a,o);break}return this.gl.bindTexture(this.target,null),this}},{key:"_isNPOT",value:function(){return ie(this.gl)||!this.width||!this.height?!1:!kf(this.width)||!kf(this.height)}},{key:"_updateForNPOT",value:function(a){a[this.gl.TEXTURE_MIN_FILTER]===void 0&&(a[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),a[this.gl.TEXTURE_WRAP_S]===void 0&&(a[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),a[this.gl.TEXTURE_WRAP_T]===void 0&&(a[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}},{key:"_getNPOTParam",value:function(a,o){if(this._isNPOT())switch(a){case 10241:cw.indexOf(o)===-1&&(o=9729);break;case 10242:case 10243:o!==33071&&(o=33071);break;default:break}return o}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.format,u=o.linearFiltering,f=!0;return s&&(f=f&&Lp(a,s),f=f&&(!u||Dp(a,s))),f}}]),n}(Je,Symbol.toStringTag);var hw="";function Np(t,r){return H(typeof t=="string"),t=hw+t,new Promise(function(e,n){try{var i=new Image;i.onload=function(){return e(i)},i.onerror=function(){return n(new Error("Could not load image ".concat(t,".")))},i.crossOrigin=r&&r.crossOrigin||"anonymous",i.src=t}catch(a){n(a)}})}function pw(t){var r=dw();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function dw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Le=function(t,r){N(n,t);var e=pw(n);function n(i){var a;T(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return gr(i),(o instanceof Promise||typeof o=="string")&&(o={data:o}),typeof o.data=="string"&&(o=Object.assign({},o,{data:Np(o.data)})),a=e.call(this,i,Object.assign({},o,{target:3553})),a.initialize(o),Object.seal(W(a)),a}return S(n,[{key:r,get:function(){return"Texture2D"}}],[{key:"isSupported",value:function(a,o){return gt.isSupported(a,o)}}]),n}(gt,Symbol.toStringTag);function Bp(t,r,e,n,i,a,o){try{var s=t[a](o),u=s.value}catch(f){e(f);return}s.done?r(u):Promise.resolve(u).then(n,i)}function de(t){return function(){var r=this,e=arguments;return new Promise(function(n,i){var a=t.apply(r,e);function o(u){Bp(a,n,i,o,s,"next",u)}function s(u){Bp(a,n,i,o,s,"throw",u)}o(void 0)})}}var Lf=Be(Ge());function vw(t){var r=mw();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function mw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Df=[34069,34070,34071,34072,34073,34074],vn=function(t,r){N(n,t);var e=vw(n);function n(i){var a;T(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return gr(i),a=e.call(this,i,Object.assign({},o,{target:34067})),a.initialize(o),Object.seal(W(a)),a}return S(n,[{key:r,get:function(){return"TextureCube"}},{key:"initialize",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=o.mipmaps,u=s===void 0?!0:s,f=o.parameters,c=f===void 0?{}:f;return this.opts=o,this.setCubeMapImageData(o).then(function(){a.loaded=!0,u&&a.generateMipmap(o),a.setParameters(c)}),this}},{key:"subImage",value:function(a){var o=a.face,s=a.data,u=a.x,f=u===void 0?0:u,c=a.y,h=c===void 0?0:c,p=a.mipmapLevel,d=p===void 0?0:p;return this._subImage({target:o,data:s,x:f,y:h,mipmapLevel:d})}},{key:"setCubeMapImageData",value:function(){var i=de(Lf.default.mark(function o(s){var u=this,f,c,h,p,d,v,m,g,_,w,x,P,E;return Lf.default.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return f=s.width,c=s.height,h=s.pixels,p=s.data,d=s.border,v=d===void 0?0:d,m=s.format,g=m===void 0?6408:m,_=s.type,w=_===void 0?5121:_,x=this.gl,P=h||p,R.next=5,Promise.all(Df.map(function(D){var j=P[D];return Promise.all(Array.isArray(j)?j:[j])}));case 5:E=R.sent,this.bind(),Df.forEach(function(D,j){E[j].length>1&&u.opts.mipmaps!==!1&&Q.warn("".concat(u.id," has mipmap and multiple LODs."))(),E[j].forEach(function(I,V){f&&c?x.texImage2D(D,V,g,f,c,v,g,w,I):x.texImage2D(D,V,g,g,w,I)})}),this.unbind();case 9:case"end":return R.stop()}},o,this)}));function a(o){return i.apply(this,arguments)}return a}()},{key:"setImageDataForFace",value:function(a){var o=this,s=a.face,u=a.width,f=a.height,c=a.pixels,h=a.data,p=a.border,d=p===void 0?0:p,v=a.format,m=v===void 0?6408:v,g=a.type,_=g===void 0?5121:g,w=this.gl,x=c||h;return this.bind(),x instanceof Promise?x.then(function(P){return o.setImageDataForFace(Object.assign({},a,{face:s,data:P,pixels:P}))}):this.width||this.height?w.texImage2D(s,0,m,u,f,d,m,_,x):w.texImage2D(s,0,m,m,_,x),this}}]),n}(gt,Symbol.toStringTag);vn.FACES=Df;function gw(t){var r=yw();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function yw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var si=function(t,r){N(n,t);var e=gw(n);function n(i){var a;T(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ke(i),o=Object.assign({depth:1},o,{target:32879,unpackFlipY:!1}),a=e.call(this,i,o),a.initialize(o),Object.seal(W(a)),a}return S(n,[{key:r,get:function(){return"Texture3D"}},{key:"setImageData",value:function(a){var o=this,s=a.level,u=s===void 0?0:s,f=a.dataFormat,c=f===void 0?6408:f,h=a.width,p=a.height,d=a.depth,v=d===void 0?1:d,m=a.border,g=m===void 0?0:m,_=a.format,w=a.type,x=w===void 0?5121:w,P=a.offset,E=P===void 0?0:P,A=a.data,R=a.parameters,D=R===void 0?{}:R;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Ae(this.gl,D,function(){ArrayBuffer.isView(A)&&o.gl.texImage3D(o.target,u,c,h,p,v,g,_,x,A),A instanceof fe&&(o.gl.bindBuffer(35052,A.handle),o.gl.texImage3D(o.target,u,c,h,p,v,g,_,x,E))}),A&&A.byteLength)this._trackAllocatedMemory(A.byteLength,"Texture");else{var j=Lo[this.dataFormat]||4,I=Do[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*j*I,"Texture")}return this.loaded=!0,this}}],[{key:"isSupported",value:function(a){return ie(a)}}]),n}(gt,Symbol.toStringTag);function jf(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&(t=M(t),t!==null););return t}function be(t,r,e){return typeof Reflect<"u"&&Reflect.get?be=Reflect.get:be=function(i,a,o){var s=jf(i,a);if(s){var u=Object.getOwnPropertyDescriptor(s,a);return u.get?u.get.call(o):u.value}},be(t,r,e||t)}var pe,mn="EXT_color_buffer_float",Ff=(pe={},l(pe,33189,{bpp:2}),l(pe,33190,{gl2:!0,bpp:3}),l(pe,36012,{gl2:!0,bpp:4}),l(pe,36168,{bpp:1}),l(pe,34041,{bpp:4}),l(pe,35056,{gl2:!0,bpp:4}),l(pe,36013,{gl2:!0,bpp:5}),l(pe,32854,{bpp:2}),l(pe,36194,{bpp:2}),l(pe,32855,{bpp:2}),l(pe,33321,{gl2:!0,bpp:1}),l(pe,33330,{gl2:!0,bpp:1}),l(pe,33329,{gl2:!0,bpp:1}),l(pe,33332,{gl2:!0,bpp:2}),l(pe,33331,{gl2:!0,bpp:2}),l(pe,33334,{gl2:!0,bpp:4}),l(pe,33333,{gl2:!0,bpp:4}),l(pe,33323,{gl2:!0,bpp:2}),l(pe,33336,{gl2:!0,bpp:2}),l(pe,33335,{gl2:!0,bpp:2}),l(pe,33338,{gl2:!0,bpp:4}),l(pe,33337,{gl2:!0,bpp:4}),l(pe,33340,{gl2:!0,bpp:8}),l(pe,33339,{gl2:!0,bpp:8}),l(pe,32849,{gl2:!0,bpp:3}),l(pe,32856,{gl2:!0,bpp:4}),l(pe,32857,{gl2:!0,bpp:4}),l(pe,36220,{gl2:!0,bpp:4}),l(pe,36238,{gl2:!0,bpp:4}),l(pe,36975,{gl2:!0,bpp:4}),l(pe,36214,{gl2:!0,bpp:8}),l(pe,36232,{gl2:!0,bpp:8}),l(pe,36226,{gl2:!0,bpp:16}),l(pe,36208,{gl2:!0,bpp:16}),l(pe,33325,{gl2:mn,bpp:2}),l(pe,33327,{gl2:mn,bpp:4}),l(pe,34842,{gl2:mn,bpp:8}),l(pe,33326,{gl2:mn,bpp:4}),l(pe,33328,{gl2:mn,bpp:8}),l(pe,34836,{gl2:mn,bpp:16}),l(pe,35898,{gl2:mn,bpp:4}),pe);function _w(t){var r=bw();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function bw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ww(t,r,e){var n=e[r];if(!n)return!1;var i=ie(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}var yt=function(t,r){N(n,t);var e=_w(n);function n(i){var a;T(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.initialize(o),Object.seal(W(a)),a}return S(n,[{key:r,get:function(){return"Renderbuffer"}},{key:"initialize",value:function(a){var o=a.format,s=a.width,u=s===void 0?1:s,f=a.height,c=f===void 0?1:f,h=a.samples,p=h===void 0?0:h;return H(o,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),p!==0&&ie(this.gl)?this.gl.renderbufferStorageMultisample(36161,p,o,u,c):this.gl.renderbufferStorage(36161,o,u,c),this.format=o,this.width=u,this.height=c,this.samples=p,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Ff[this.format].bpp),this}},{key:"resize",value:function(a){var o=a.width,s=a.height;return o!==this.width||s!==this.height?this.initialize({width:o,height:s,format:this.format,samples:this.samples}):this}},{key:"_createHandle",value:function(){return this.gl.createRenderbuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_bindHandle",value:function(a){this.gl.bindRenderbuffer(36161,a)}},{key:"_syncHandle",value:function(a){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}},{key:"_getParameter",value:function(a){this.gl.bindRenderbuffer(36161,this.handle);var o=this.gl.getRenderbufferParameter(36161,a);return o}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null},s=o.format;return!s||ww(a,s,Ff)}},{key:"getSamplesForFormat",value:function(a,o){var s=o.format;return a.getInternalformatParameter(36161,s,32937)}}]),n}(Je,Symbol.toStringTag);var xw=256,Tw=1024,Ew=16384,Up=6144,Gp=6145,$p=6146,Hp=34041,Wp="clear: bad arguments";function Jt(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.framebuffer,n=e===void 0?null:e,i=r.color,a=i===void 0?null:i,o=r.depth,s=o===void 0?null:o,u=r.stencil,f=u===void 0?null:u,c={};n&&(c.framebuffer=n);var h=0;a&&(h|=Ew,a!==!0&&(c.clearColor=a)),s&&(h|=xw,s!==!0&&(c.clearDepth=s)),f&&(h|=Tw,s!==!0&&(c.clearStencil=s)),H(h!==0,Wp),Ae(t,c,function(){t.clear(h)})}function Nf(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.framebuffer,n=e===void 0?null:e,i=r.buffer,a=i===void 0?Up:i,o=r.drawBuffer,s=o===void 0?0:o,u=r.value,f=u===void 0?[0,0,0,0]:u;ke(t),Ae(t,{framebuffer:n},function(){switch(a){case Up:switch(f.constructor){case Int32Array:t.clearBufferiv(a,s,f);break;case Uint32Array:t.clearBufferuiv(a,s,f);break;case Float32Array:default:t.clearBufferfv(a,s,f)}break;case Gp:t.clearBufferfv(Gp,0,[f]);break;case $p:t.clearBufferiv($p,0,[f]);break;case Hp:var c=Z(f,2),h=c[0],p=c[1];t.clearBufferfi(Hp,0,h,p);break;default:H(!1,Wp)}})}function Bf(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return H(!1),0}}function Yp(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return H(!1),0}}function _r(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.sourceX,n=e===void 0?0:e,i=r.sourceY,a=i===void 0?0:i,o=r.sourceFormat,s=o===void 0?6408:o,u=r.sourceAttachment,f=u===void 0?36064:u,c=r.target,h=c===void 0?null:c,p=r.sourceWidth,d=r.sourceHeight,v=r.sourceType,m=Vf(t),g=m.framebuffer,_=m.deleteFramebuffer;H(g);var w=g.gl,x=g.handle,P=g.attachments;p=p||g.width,d=d||g.height,f===36064&&x===null&&(f=1028),H(P[f]),v=v||P[f].type,h=Pw(h,v,s,p,d),v=v||aa(h);var E=w.bindFramebuffer(36160,x);return w.readPixels(n,a,p,d,s,v,h),w.bindFramebuffer(36160,E||null),_&&g.delete(),h}function jo(t,r){var e=r.sourceX,n=e===void 0?0:e,i=r.sourceY,a=i===void 0?0:i,o=r.sourceFormat,s=o===void 0?6408:o,u=r.target,f=u===void 0?null:u,c=r.targetByteOffset,h=c===void 0?0:c,p=r.sourceWidth,d=r.sourceHeight,v=r.sourceType,m=Vf(t),g=m.framebuffer,_=m.deleteFramebuffer;H(g),p=p||g.width,d=d||g.height;var w=ke(g.gl);if(v=v||(f?f.type:5121),!f){var x=Bf(s),P=Yp(v),E=h+p*d*x*P;f=new fe(w,{byteLength:E,accessor:{type:v,size:x}})}return f.bind({target:35051}),Ae(w,{framebuffer:g},function(){w.readPixels(n,a,p,d,s,v,h)}),f.unbind({target:35051}),_&&g.delete(),f}function Fo(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.sourceAttachment,n=e===void 0?36064:e,i=r.targetMaxHeight,a=i===void 0?Number.MAX_SAFE_INTEGER:i,o=_r(t,{sourceAttachment:n}),s=t.width,u=t.height;u>a;){var f=Rp({data:o,width:s,height:u});o=f.data,s=f.width,u=f.height}kp({data:o,width:s,height:u});var c=document.createElement("canvas");c.width=s,c.height=u;var h=c.getContext("2d"),p=h.createImageData(s,u);return p.data.set(o),h.putImageData(p,0,0),c.toDataURL()}function No(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=e.sourceX,i=n===void 0?0:n,a=e.sourceY,o=a===void 0?0:a,s=e.targetMipmaplevel,u=s===void 0?0:s,f=e.targetInternalFormat,c=f===void 0?6408:f,h=e.targetX,p=e.targetY,d=e.targetZ,v=e.width,m=e.height,g=Vf(t),_=g.framebuffer,w=g.deleteFramebuffer;H(_);var x=_.gl,P=_.handle,E=typeof h<"u"||typeof p<"u"||typeof d<"u";h=h||0,p=p||0,d=d||0;var A=x.bindFramebuffer(36160,P);H(r);var R=null;if(r instanceof gt&&(R=r,v=Number.isFinite(v)?v:R.width,m=Number.isFinite(m)?m:R.height,R.bind(0),r=R.target),!E)x.copyTexImage2D(r,u,c,i,o,v,m,0);else switch(r){case 3553:case 34067:x.copyTexSubImage2D(r,u,h,p,i,o,v,m);break;case 35866:case 32879:var D=ke(x);D.copyTexSubImage3D(r,u,h,p,d,i,o,v,m);break;default:}return R&&R.unbind(),x.bindFramebuffer(36160,A||null),w&&_.delete(),R}function Vf(t){return t instanceof xe?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Xp(t),deleteFramebuffer:!0}}function Pw(t,r,e,n,i){if(t)return t;r=r||5121;var a=jr(r,{clamped:!1}),o=Bf(e);return new a(n*i*o)}var De,Ee={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function Sw(t){var r=new Le(t,{format:6408,type:5126,dataFormat:6408}),e=new xe(t,{id:"test-framebuffer",check:!1,attachments:l({},36064,r)}),n=e.getStatus();return r.delete(),e.delete(),n===36053}var zf=(De={},l(De,Ee.WEBGL2,[!1,!0]),l(De,Ee.VERTEX_ARRAY_OBJECT,["OES_vertex_array_object",!0]),l(De,Ee.TIMER_QUERY,["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"]),l(De,Ee.INSTANCED_RENDERING,["ANGLE_instanced_arrays",!0]),l(De,Ee.MULTIPLE_RENDER_TARGETS,["WEBGL_draw_buffers",!0]),l(De,Ee.ELEMENT_INDEX_UINT32,["OES_element_index_uint",!0]),l(De,Ee.BLEND_EQUATION_MINMAX,["EXT_blend_minmax",!0]),l(De,Ee.FLOAT_BLEND,["EXT_float_blend"]),l(De,Ee.COLOR_ENCODING_SRGB,["EXT_sRGB",!0]),l(De,Ee.TEXTURE_DEPTH,["WEBGL_depth_texture",!0]),l(De,Ee.TEXTURE_FLOAT,["OES_texture_float",!0]),l(De,Ee.TEXTURE_HALF_FLOAT,["OES_texture_half_float",!0]),l(De,Ee.TEXTURE_FILTER_LINEAR_FLOAT,["OES_texture_float_linear"]),l(De,Ee.TEXTURE_FILTER_LINEAR_HALF_FLOAT,["OES_texture_half_float_linear"]),l(De,Ee.TEXTURE_FILTER_ANISOTROPIC,["EXT_texture_filter_anisotropic"]),l(De,Ee.COLOR_ATTACHMENT_RGBA32F,[Sw,"EXT_color_buffer_float"]),l(De,Ee.COLOR_ATTACHMENT_FLOAT,[!1,"EXT_color_buffer_float"]),l(De,Ee.COLOR_ATTACHMENT_HALF_FLOAT,["EXT_color_buffer_half_float"]),l(De,Ee.GLSL_FRAG_DATA,["WEBGL_draw_buffers",!0]),l(De,Ee.GLSL_FRAG_DEPTH,["EXT_frag_depth",!0]),l(De,Ee.GLSL_DERIVATIVES,["OES_standard_derivatives",!0]),l(De,Ee.GLSL_TEXTURE_LOD,["EXT_shader_texture_lod",!0]),De);function Aw(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Ow(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Ow(t,r){if(t){if(typeof t=="string")return qp(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return qp(t,r)}}function qp(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Mw=2;function sa(t,r){return Fr(t,r)}function Fr(t,r){return r=Array.isArray(r)?r:[r],r.every(function(e){return Zp(t,e)})}function Bo(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(var r in zf)t.luma.caps[r]===void 0&&(t.luma.caps[r]=Zp(t,r));return t.luma.caps}function Zp(t,r){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[r]===void 0&&(t.luma.caps[r]=kw(t,r)),t.luma.caps[r]||Q.log(Mw,"Feature: ".concat(r," not supported"))(),t.luma.caps[r]}function kw(t,r){var e=zf[r];H(e,r);var n,i=ie(t)&&e[1]||e[0];if(typeof i=="function")n=i(t);else if(Array.isArray(i)){n=!0;var a=Aw(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n=n&&Boolean(t.getExtension(s))}}catch(u){a.e(u)}finally{a.f()}}else typeof i=="string"?n=Boolean(t.getExtension(i)):typeof i=="boolean"?n=i:H(!1);return n}function Kp(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Rw(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Rw(t,r){if(t){if(typeof t=="string")return Qp(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Qp(t,r)}}function Qp(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Cw(t){var r=Iw();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Iw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Jp="Multiple render targets not supported",xe=function(t,r){N(n,t);var e=Cw(n);function n(i){var a;T(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.width=null,a.height=null,a.attachments={},a.readBuffer=36064,a.drawBuffers=[36064],a.ownResources=[],a.initialize(o),Object.seal(W(a)),a}return S(n,[{key:r,get:function(){return"Framebuffer"}},{key:"MAX_COLOR_ATTACHMENTS",get:function(){var a=ke(this.gl);return a.getParameter(a.MAX_COLOR_ATTACHMENTS)}},{key:"MAX_DRAW_BUFFERS",get:function(){var a=ke(this.gl);return a.getParameter(a.MAX_DRAW_BUFFERS)}},{key:"color",get:function(){return this.attachments[36064]||null}},{key:"texture",get:function(){return this.attachments[36064]||null}},{key:"depth",get:function(){return this.attachments[36096]||this.attachments[33306]||null}},{key:"stencil",get:function(){return this.attachments[36128]||this.attachments[33306]||null}},{key:"initialize",value:function(a){var o=a.width,s=o===void 0?1:o,u=a.height,f=u===void 0?1:u,c=a.attachments,h=c===void 0?null:c,p=a.color,d=p===void 0?!0:p,v=a.depth,m=v===void 0?!0:v,g=a.stencil,_=g===void 0?!1:g,w=a.check,x=w===void 0?!0:w,P=a.readBuffer,E=P===void 0?void 0:P,A=a.drawBuffers,R=A===void 0?void 0:A;if(H(s>=0&&f>=0,"Width and height need to be integers"),this.width=s,this.height=f,h)for(var D in h){var j=h[D],I=Array.isArray(j)?j[0]:j;I.resize({width:s,height:f})}else h=this._createDefaultAttachments(d,m,_,s,f);this.update({clearAttachments:!0,attachments:h,readBuffer:E,drawBuffers:R}),h&&x&&this.checkStatus()}},{key:"delete",value:function(){var a=Kp(this.ownResources),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.delete()}}catch(u){a.e(u)}finally{a.f()}return be(M(n.prototype),"delete",this).call(this),this}},{key:"update",value:function(a){var o=a.attachments,s=o===void 0?{}:o,u=a.readBuffer,f=a.drawBuffers,c=a.clearAttachments,h=c===void 0?!1:c,p=a.resizeAttachments,d=p===void 0?!0:p;this.attach(s,{clearAttachments:h,resizeAttachments:d});var v=this.gl,m=v.bindFramebuffer(36160,this.handle);return u&&this._setReadBuffer(u),f&&this._setDrawBuffers(f),v.bindFramebuffer(36160,m||null),this}},{key:"resize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.width,s=a.height;if(this.handle===null)return H(o===void 0&&s===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;o===void 0&&(o=this.gl.drawingBufferWidth),s===void 0&&(s=this.gl.drawingBufferHeight),o!==this.width&&s!==this.height&&Q.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(o,"x").concat(s))();for(var u in this.attachments)this.attachments[u].resize({width:o,height:s});return this.width=o,this.height=s,this}},{key:"attach",value:function(a){var o=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=s.clearAttachments,f=u===void 0?!1:u,c=s.resizeAttachments,h=c===void 0?!0:c,p={};f&&Object.keys(this.attachments).forEach(function(D){p[D]=null}),Object.assign(p,a);var d=this.gl.bindFramebuffer(36160,this.handle);for(var v in p){H(v!==void 0,"Misspelled framebuffer binding point?");var m=Number(v),g=p[m],_=g;if(!_)this._unattach(m);else if(_ instanceof yt)this._attachRenderbuffer({attachment:m,renderbuffer:_});else if(Array.isArray(g)){var w=Z(g,3),x=w[0],P=w[1],E=P===void 0?0:P,A=w[2],R=A===void 0?0:A;_=x,this._attachTexture({attachment:m,texture:x,layer:E,level:R})}else this._attachTexture({attachment:m,texture:_,layer:0,level:0});h&&_&&_.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,d||null),Object.assign(this.attachments,a),Object.keys(this.attachments).filter(function(D){return!o.attachments[D]}).forEach(function(D){delete o.attachments[D]})}},{key:"checkStatus",value:function(){var a=this.gl,o=this.getStatus();if(o!==36053)throw new Error(Dw(o));return this}},{key:"getStatus",value:function(){var a=this.gl,o=a.bindFramebuffer(36160,this.handle),s=a.checkFramebufferStatus(36160);return a.bindFramebuffer(36160,o||null),s}},{key:"clear",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=o.color,u=o.depth,f=o.stencil,c=o.drawBuffers,h=c===void 0?[]:c,p=this.gl.bindFramebuffer(36160,this.handle);return(s||u||f)&&Jt(this.gl,{color:s,depth:u,stencil:f}),h.forEach(function(d,v){Nf(a.gl,{drawBuffer:v,value:d})}),this.gl.bindFramebuffer(36160,p||null),this}},{key:"readPixels",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Q.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}},{key:"readPixelsToBuffer",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Q.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}},{key:"copyToDataUrl",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Q.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}},{key:"copyToImage",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Q.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}},{key:"copyToTexture",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Q.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"blit",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Q.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}},{key:"invalidate",value:function(a){var o=a.attachments,s=o===void 0?[]:o,u=a.x,f=u===void 0?0:u,c=a.y,h=c===void 0?0:c,p=a.width,d=a.height,v=ke(this.gl),m=v.bindFramebuffer(36008,this.handle),g=f===0&&h===0&&p===void 0&&d===void 0;return g?v.invalidateFramebuffer(36008,s):v.invalidateFramebuffer(36008,s,f,h,p,d),v.bindFramebuffer(36008,m),this}},{key:"getAttachmentParameter",value:function(a,o,s){var u=this._getAttachmentParameterFallback(o);return u===null&&(this.gl.bindFramebuffer(36160,this.handle),u=this.gl.getFramebufferAttachmentParameter(36160,a,o),this.gl.bindFramebuffer(36160,null)),s&&u>1e3&&(u=Pt(this.gl,u)),u}},{key:"getAttachmentParameters",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,o=arguments.length>1?arguments[1]:void 0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[],u={},f=Kp(s),c;try{for(f.s();!(c=f.n()).done;){var h=c.value,p=o?Pt(this.gl,h):h;u[p]=this.getAttachmentParameter(a,h,o)}}catch(d){f.e(d)}finally{f.f()}return u}},{key:"getParameters",value:function(){for(var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,o=Object.keys(this.attachments),s={},u=0,f=o;u<f.length;u++){var c=f[u],h=Number(c),p=a?Pt(this.gl,h):h;s[p]=this.getAttachmentParameters(h,a)}return s}},{key:"show",value:function(){return typeof window<"u"&&window.open(Fo(this),"luma-debug-texture"),this}},{key:"log",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(a>Q.level||typeof window>"u")return this;o=o||"Framebuffer ".concat(this.id);var s=Fo(this,{targetMaxHeight:100});return Q.image({logLevel:a,message:o,image:s},o)(),this}},{key:"bind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?36160:o;return this.gl.bindFramebuffer(s,this.handle),this}},{key:"unbind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?36160:o;return this.gl.bindFramebuffer(s,null),this}},{key:"_createDefaultAttachments",value:function(a,o,s,u,f){var c=null;if(a){var h;c=c||{},c[36064]=new Le(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:u,height:f,mipmaps:!1,parameters:(h={},l(h,10241,9729),l(h,10240,9729),l(h,10242,33071),l(h,10243,33071),h)}),this.ownResources.push(c[36064])}return o&&s?(c=c||{},c[33306]=new yt(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:u,height:111}),this.ownResources.push(c[33306])):o?(c=c||{},c[36096]=new yt(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:u,height:f}),this.ownResources.push(c[36096])):s&&H(!1),c}},{key:"_unattach",value:function(a){var o=this.attachments[a];o&&(o instanceof yt?this.gl.framebufferRenderbuffer(36160,a,36161,null):this.gl.framebufferTexture2D(36160,a,3553,null,0),delete this.attachments[a])}},{key:"_attachRenderbuffer",value:function(a){var o=a.attachment,s=o===void 0?36064:o,u=a.renderbuffer,f=this.gl;f.framebufferRenderbuffer(36160,s,36161,u.handle),this.attachments[s]=u}},{key:"_attachTexture",value:function(a){var o=a.attachment,s=o===void 0?36064:o,u=a.texture,f=a.layer,c=a.level,h=this.gl;switch(h.bindTexture(u.target,u.handle),u.target){case 35866:case 32879:var p=ke(h);p.framebufferTextureLayer(36160,s,u.target,c,f);break;case 34067:var d=Lw(f);h.framebufferTexture2D(36160,s,d,u.handle,c);break;case 3553:h.framebufferTexture2D(36160,s,3553,u.handle,c);break;default:H(!1,"Illegal texture type")}h.bindTexture(u.target,null),this.attachments[s]=u}},{key:"_setReadBuffer",value:function(a){var o=mf(this.gl);o?o.readBuffer(a):H(a===36064||a===1029,Jp),this.readBuffer=a}},{key:"_setDrawBuffers",value:function(a){var o=this.gl,s=ke(o);if(s)s.drawBuffers(a);else{var u=o.getExtension("WEBGL_draw_buffers");u?u.drawBuffersWEBGL(a):H(a.length===1&&(a[0]===36064||a[0]===1029),Jp)}this.drawBuffers=a}},{key:"_getAttachmentParameterFallback",value:function(a){var o=Bo(this.gl);switch(a){case 36052:return o.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return o.WEBGL2?null:8;case 33297:return o.WEBGL2?null:5125;case 33296:return!o.WEBGL2&&!o.EXT_sRGB?9729:null;default:return null}}},{key:"_createHandle",value:function(){return this.gl.createFramebuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteFramebuffer(this.handle)}},{key:"_bindHandle",value:function(a){return this.gl.bindFramebuffer(36160,a)}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.colorBufferFloat,u=o.colorBufferHalfFloat,f=!0;return s&&(f=Boolean(a.getExtension("EXT_color_buffer_float")||a.getExtension("WEBGL_color_buffer_float")||a.getExtension("OES_texture_float"))),u&&(f=f&&Boolean(a.getExtension("EXT_color_buffer_float")||a.getExtension("EXT_color_buffer_half_float"))),f}},{key:"getDefaultFramebuffer",value:function(a){return a.luma=a.luma||{},a.luma.defaultFramebuffer=a.luma.defaultFramebuffer||new n(a,{id:"default-framebuffer",handle:null,attachments:{}}),a.luma.defaultFramebuffer}}]),n}(Je,Symbol.toStringTag);function Lw(t){return t<34069?t+34069:t}function Dw(t){var r=xe.STATUS||{};return r[t]||"Framebuffer error ".concat(t)}var jw=[36049,36048,33296,33298,33299,33300,33301,33302,33303];xe.ATTACHMENT_PARAMETERS=jw;function ui(t,r){H(t instanceof Le||t instanceof vn||t instanceof si);var e=t.constructor,n=t.gl,i=t.width,a=t.height,o=t.format,s=t.type,u=t.dataFormat,f=t.border,c=t.mipmaps,h=Object.assign({width:i,height:a,format:o,type:s,dataFormat:u,border:f,mipmaps:c},r);return new e(n,h)}function Xp(t,r){var e=t.gl,n=t.width,i=t.height,a=t.id,o=new xe(e,Object.assign({},r,{id:"framebuffer-for-".concat(a),width:n,height:i,attachments:l({},36064,t)}));return o}function Nr(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed",e=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,n=t.match(e);return n?n[1]:r}var Fw=35632,Nw=35633;function Uf(t){switch(t){case Fw:return"fragment";case Nw:return"vertex";default:return"unknown type"}}function Gf(t,r,e,n){for(var i=t.split(/\r?\n/),a={},o={},s=n||Nr(r)||"(unnamed)",u="".concat(Uf(e)," shader ").concat(s),f=0;f<i.length;f++){var c=i[f];if(!(c.length<=1)){var h=c.split(":"),p=h[0],d=parseInt(h[2],10);if(isNaN(d))throw new Error("GLSL compilation error in ".concat(u,": ").concat(t));p!=="WARNING"?a[d]=c:o[d]=c}}var v=Bw(r);return{shaderName:u,errors:ed(a,v),warnings:ed(o,v)}}function ed(t,r){for(var e="",n=0;n<r.length;n++){var i=r[n];if(!(!t[n+3]&&!t[n+2]&&!t[n+1])&&(e+="".concat(i,`
`),t[n+1])){var a=t[n+1],o=a.split(":",3),s=o[0],u=parseInt(o[1],10)||0,f=a.substring(o.join(":").length+1).trim();e+=td("^^^ ".concat(s,": ").concat(f,`

`),u)}}return e}function Bw(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ",n=t.split(/\r?\n/),i=String(n.length+r-1).length;return n.map(function(a,o){var s=String(o+r),u=s.length,f=td(s,i-u);return f+e+a})}function td(t,r){for(var e="",n=0;n<r;++n)e+=" ";return"".concat(e).concat(t)}function fi(t){var r=100,e=t.match(/[^\s]+/g);if(e.length>=2&&e[0]==="#version"){var n=parseInt(e[1],10);Number.isFinite(n)&&(r=n)}return r}function $f(t){var r=Vw();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Vw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zw="Shader: GLSL source code must be a JavaScript string",rd=function(t,r){N(n,t);var e=$f(n);function n(i,a){var o;T(this,n),gr(i),H(typeof a.source=="string",zw);var s=Nr(a.source,null)||a.id||Pe("unnamed ".concat(n.getTypeName(a.shaderType)));return o=e.call(this,i,{id:s}),o.shaderType=a.shaderType,o.source=a.source,o.initialize(a),o}return S(n,[{key:r,get:function(){return"Shader"}},{key:"initialize",value:function(a){var o=a.source,s=Nr(o,null);s&&(this.id=Pe(s)),this._compile(o)}},{key:"getParameter",value:function(a){return this.gl.getShaderParameter(this.handle,a)}},{key:"toString",value:function(){return"".concat(n.getTypeName(this.shaderType),":").concat(this.id)}},{key:"getName",value:function(){return Nr(this.source)||"unnamed-shader"}},{key:"getSource",value:function(){return this.gl.getShaderSource(this.handle)}},{key:"getTranslatedSource",value:function(){var a=this.gl.getExtension("WEBGL_debug_shaders");return a?a.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}},{key:"_compile",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;a.startsWith("#version ")||(a=`#version 100
`.concat(a)),this.source=a,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle);var o=this.getParameter(35713);if(!o){var s=this.gl.getShaderInfoLog(this.handle),u=Gf(s,this.source,this.shaderType,this.id),f=u.shaderName,c=u.errors,h=u.warnings;throw Q.error("GLSL compilation errors in ".concat(f,`
`).concat(c))(),Q.warn("GLSL compilation warnings in ".concat(f,`
`).concat(h))(),new Error("GLSL compilation errors in ".concat(f))}}},{key:"_deleteHandle",value:function(){this.gl.deleteShader(this.handle)}},{key:"_getOptsFromHandle",value:function(){return{type:this.getParameter(35663),source:this.getSource()}}}],[{key:"getTypeName",value:function(a){switch(a){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return H(!1),"unknown"}}}]),n}(Je,Symbol.toStringTag),ua=function(t,r){N(n,t);var e=$f(n);function n(i,a){return T(this,n),typeof a=="string"&&(a={source:a}),e.call(this,i,Object.assign({},a,{shaderType:35633}))}return S(n,[{key:r,get:function(){return"VertexShader"}},{key:"_createHandle",value:function(){return this.gl.createShader(35633)}}]),n}(rd,Symbol.toStringTag),fa=function(t,r){N(n,t);var e=$f(n);function n(i,a){return T(this,n),typeof a=="string"&&(a={source:a}),e.call(this,i,Object.assign({},a,{shaderType:35632}))}return S(n,[{key:r,get:function(){return"FragmentShader"}},{key:"_createHandle",value:function(){return this.gl.createShader(35632)}}]),n}(rd,Symbol.toStringTag);var ce,Uw=(ce={},l(ce,5126,Ce.bind(null,"uniform1fv",_t,1,it)),l(ce,35664,Ce.bind(null,"uniform2fv",_t,2,it)),l(ce,35665,Ce.bind(null,"uniform3fv",_t,3,it)),l(ce,35666,Ce.bind(null,"uniform4fv",_t,4,it)),l(ce,5124,Ce.bind(null,"uniform1iv",Br,1,it)),l(ce,35667,Ce.bind(null,"uniform2iv",Br,2,it)),l(ce,35668,Ce.bind(null,"uniform3iv",Br,3,it)),l(ce,35669,Ce.bind(null,"uniform4iv",Br,4,it)),l(ce,35670,Ce.bind(null,"uniform1iv",Br,1,it)),l(ce,35671,Ce.bind(null,"uniform2iv",Br,2,it)),l(ce,35672,Ce.bind(null,"uniform3iv",Br,3,it)),l(ce,35673,Ce.bind(null,"uniform4iv",Br,4,it)),l(ce,35674,Ce.bind(null,"uniformMatrix2fv",_t,4,br)),l(ce,35675,Ce.bind(null,"uniformMatrix3fv",_t,9,br)),l(ce,35676,Ce.bind(null,"uniformMatrix4fv",_t,16,br)),l(ce,35678,tt),l(ce,35680,tt),l(ce,5125,Ce.bind(null,"uniform1uiv",Vo,1,it)),l(ce,36294,Ce.bind(null,"uniform2uiv",Vo,2,it)),l(ce,36295,Ce.bind(null,"uniform3uiv",Vo,3,it)),l(ce,36296,Ce.bind(null,"uniform4uiv",Vo,4,it)),l(ce,35685,Ce.bind(null,"uniformMatrix2x3fv",_t,6,br)),l(ce,35686,Ce.bind(null,"uniformMatrix2x4fv",_t,8,br)),l(ce,35687,Ce.bind(null,"uniformMatrix3x2fv",_t,6,br)),l(ce,35688,Ce.bind(null,"uniformMatrix3x4fv",_t,12,br)),l(ce,35689,Ce.bind(null,"uniformMatrix4x2fv",_t,8,br)),l(ce,35690,Ce.bind(null,"uniformMatrix4x3fv",_t,12,br)),l(ce,35678,tt),l(ce,35680,tt),l(ce,35679,tt),l(ce,35682,tt),l(ce,36289,tt),l(ce,36292,tt),l(ce,36293,tt),l(ce,36298,tt),l(ce,36299,tt),l(ce,36300,tt),l(ce,36303,tt),l(ce,36306,tt),l(ce,36307,tt),l(ce,36308,tt),l(ce,36311,tt),ce),Gw={},$w={},Hw={},nd=[0];function Hf(t,r,e,n){r===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(nd[0]=t,t=nd);var i=t.length;if(i%r&&Q.warn("Uniform size should be multiples of ".concat(r),t)(),t instanceof e)return t;var a=n[i];a||(a=new e(i),n[i]=a);for(var o=0;o<i;o++)a[o]=t[o];return a}function _t(t,r){return Hf(t,r,Float32Array,Gw)}function Br(t,r){return Hf(t,r,Int32Array,$w)}function Vo(t,r){return Hf(t,r,Uint32Array,Hw)}function Wf(t,r,e){var n=Uw[e.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(e.type));return n().bind(null,t,r)}function id(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};var r=/([^[]*)(\[[0-9]+\])?/,e=t.match(r);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function ad(t,r,e){for(var n in t){var i=t[n],a=!e||Boolean(e[n]);if(a&&!Ww(i))throw r=r?"".concat(r," "):"",console.error("".concat(r," Bad uniform ").concat(n),i),new Error("".concat(r," Bad uniform ").concat(n))}return!0}function Ww(t){return Array.isArray(t)||ArrayBuffer.isView(t)?Yw(t):isFinite(t)||t===!0||t===!1||t instanceof gt||t instanceof yt?!0:t instanceof xe?Boolean(t.texture):!1}function od(t,r,e){if(Array.isArray(e)||ArrayBuffer.isView(e))if(t[r])for(var n=t[r],i=0,a=e.length;i<a;++i)n[i]=e[i];else t[r]=e.slice();else t[r]=e}function Yw(t){if(t.length===0)return!1;for(var r=Math.min(t.length,16),e=0;e<r;++e)if(!Number.isFinite(t[e]))return!1;return!0}function tt(){var t=null;return function(r,e,n){var i=t!==n;return i&&(r.uniform1i(e,n),t=n),i}}function Ce(t,r,e,n){var i=null,a=null;return function(o,s,u){var f=r(u,e),c=f.length,h=!1;if(i===null)i=new Float32Array(c),a=c,h=!0;else{H(a===c,"Uniform length cannot change.");for(var p=0;p<c;++p)if(f[p]!==i[p]){h=!0;break}}return h&&(n(o,t,s,f),i.set(f)),h}}function it(t,r,e,n){t[r](e,n)}function br(t,r,e,n){t[r](e,!1,n)}var Oe,Xw=5120,qw=5121,Zw=5122,Kw=5123,sd=0,zo=1,Qw=2,Jw=3,Uo=4,ex=5,tx=6,qe=5126,rx=35664,nx=35665,ix=35666,la=5124,ax=35667,ox=35668,sx=35669,ca=5125,ux=36294,fx=36295,lx=36296,cx=35670,hx=35671,px=35672,dx=35673,vx=35674,mx=35675,gx=35676,yx=35685,_x=35686,bx=35687,wx=35688,xx=35689,Tx=35690,Yf=(Oe={},l(Oe,qe,[qe,1,"float"]),l(Oe,rx,[qe,2,"vec2"]),l(Oe,nx,[qe,3,"vec3"]),l(Oe,ix,[qe,4,"vec4"]),l(Oe,la,[la,1,"int"]),l(Oe,ax,[la,2,"ivec2"]),l(Oe,ox,[la,3,"ivec3"]),l(Oe,sx,[la,4,"ivec4"]),l(Oe,ca,[ca,1,"uint"]),l(Oe,ux,[ca,2,"uvec2"]),l(Oe,fx,[ca,3,"uvec3"]),l(Oe,lx,[ca,4,"uvec4"]),l(Oe,cx,[qe,1,"bool"]),l(Oe,hx,[qe,2,"bvec2"]),l(Oe,px,[qe,3,"bvec3"]),l(Oe,dx,[qe,4,"bvec4"]),l(Oe,vx,[qe,8,"mat2"]),l(Oe,yx,[qe,8,"mat2x3"]),l(Oe,_x,[qe,8,"mat2x4"]),l(Oe,mx,[qe,12,"mat3"]),l(Oe,bx,[qe,12,"mat3x2"]),l(Oe,wx,[qe,12,"mat3x4"]),l(Oe,gx,[qe,16,"mat4"]),l(Oe,xx,[qe,16,"mat4x2"]),l(Oe,Tx,[qe,16,"mat4x3"]),Oe);function ud(t){switch(t){case sd:return sd;case zo:return zo;case Jw:return zo;case Qw:return zo;case Uo:return Uo;case ex:return Uo;case tx:return Uo;default:return H(!1),0}}function Xf(t){var r=Yf[t];if(!r)return null;var e=Z(r,2),n=e[0],i=e[1];return{type:n,components:i}}function Go(t,r){switch(t){case Xw:case qw:case Zw:case Kw:t=qe;break;default:}for(var e in Yf){var n=Z(Yf[e],3),i=n[0],a=n[1],o=n[2];if(i===t&&a===r)return{glType:e,name:o}}return null}var fd=function(){function t(r){T(this,t),this.id=r.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(r),this._readVaryingsFromProgram(r)}return S(t,[{key:"getAttributeInfo",value:function(e){var n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}},{key:"getAttributeLocation",value:function(e){var n=this.getAttributeInfo(e);return n?n.location:-1}},{key:"getAttributeAccessor",value:function(e){var n=this.getAttributeInfo(e);return n?n.accessor:null}},{key:"getVaryingInfo",value:function(e){var n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}},{key:"getVaryingIndex",value:function(e){var n=this.getVaryingInfo();return n?n.location:-1}},{key:"getVaryingAccessor",value:function(e){var n=this.getVaryingInfo();return n?n.accessor:null}},{key:"_readAttributesFromProgram",value:function(e){for(var n=e.gl,i=n.getProgramParameter(e.handle,35721),a=0;a<i;a++){var o=n.getActiveAttrib(e.handle,a),s=o.name,u=o.type,f=o.size,c=n.getAttribLocation(e.handle,s);c>=0&&this._addAttribute(c,s,u,f)}this.attributeInfos.sort(function(h,p){return h.location-p.location})}},{key:"_readVaryingsFromProgram",value:function(e){var n=e.gl;if(ie(n)){for(var i=n.getProgramParameter(e.handle,35971),a=0;a<i;a++){var o=n.getTransformFeedbackVarying(e.handle,a),s=o.name,u=o.type,f=o.size;this._addVarying(a,s,u,f)}this.varyingInfos.sort(function(c,h){return c.location-h.location})}}},{key:"_addAttribute",value:function(e,n,i,a){var o=Xf(i),s=o.type,u=o.components,f={type:s,size:a*u};this._inferProperties(e,n,f);var c={location:e,name:n,accessor:new St(f)};this.attributeInfos.push(c),this.attributeInfosByLocation[e]=c,this.attributeInfosByName[c.name]=c}},{key:"_inferProperties",value:function(e,n,i){/instance/i.test(n)&&(i.divisor=1)}},{key:"_addVarying",value:function(e,n,i,a){var o=Xf(i),s=o.type,u=o.components,f=new St({type:s,size:a*u}),c={location:e,name:n,accessor:f};this.varyingInfos.push(c),this.varyingInfosByName[c.name]=c}}]),t}();function Ex(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Px(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Px(t,r){if(t){if(typeof t=="string")return ld(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return ld(t,r)}}function ld(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Sx(t){var r=Ax();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Ax(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cd=4,Ox=35981,Mx=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"],Vr=function(t,r){N(n,t);var e=Sx(n);function n(i){var a;T(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.stubRemovedMethods("Program","v6.0",Mx),a._isCached=!1,a.initialize(o),Object.seal(W(a)),a._setId(o.id),a}return S(n,[{key:r,get:function(){return"Program"}},{key:"initialize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.hash,s=a.vs,u=a.fs,f=a.varyings,c=a.bufferMode,h=c===void 0?Ox:c;return this.hash=o||"",this.vs=typeof s=="string"?new ua(this.gl,{id:"".concat(a.id,"-vs"),source:s}):s,this.fs=typeof u=="string"?new fa(this.gl,{id:"".concat(a.id,"-fs"),source:u}):u,H(this.vs instanceof ua),H(this.fs instanceof fa),this.uniforms={},this._textureUniforms={},f&&f.length>0&&(ke(this.gl),this.varyings=f,this.gl2.transformFeedbackVaryings(this.handle,f,h)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new fd(this),this.setProps(a)}},{key:"delete",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:be(M(n.prototype),"delete",this).call(this,a)}},{key:"setProps",value:function(a){return"uniforms"in a&&this.setUniforms(a.uniforms),this}},{key:"draw",value:function(a){var o=this,s=a.logPriority,u=a.drawMode,f=u===void 0?4:u,c=a.vertexCount,h=a.offset,p=h===void 0?0:h,d=a.start,v=a.end,m=a.isIndexed,g=m===void 0?!1:m,_=a.indexType,w=_===void 0?5123:_,x=a.instanceCount,P=x===void 0?0:x,E=a.isInstanced,A=E===void 0?P>0:E,R=a.vertexArray,D=R===void 0?null:R,j=a.transformFeedback,I=a.framebuffer,V=a.parameters,F=V===void 0?{}:V,G=a.uniforms,B=a.samplers;if((G||B)&&(Q.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(G||{})),Q.priority>=s){var K=I?I.id:"default",C="mode=".concat(Pt(this.gl,f)," verts=").concat(c," ")+"instances=".concat(P," indexType=").concat(Pt(this.gl,w)," ")+"isInstanced=".concat(A," isIndexed=").concat(g," ")+"Framebuffer=".concat(K);Q.log(s,C)()}return H(D),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||c===0||A&&P===0?!1:(D.bindForDraw(c,P,function(){if(I!==void 0&&(F=Object.assign({},F,{framebuffer:I})),j){var k=ud(f);j.begin(k)}o._bindTextures(),Ae(o.gl,F,function(){g&&A?o.gl2.drawElementsInstanced(f,c,w,p,P):g&&ie(o.gl)&&!isNaN(d)&&!isNaN(v)?o.gl2.drawRangeElements(f,d,v,c,w,p):g?o.gl.drawElements(f,c,w,p):A?o.gl2.drawArraysInstanced(f,p,c,P):o.gl.drawArrays(f,p,c)}),j&&j.end()}),!0)}},{key:"setUniforms",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Q.priority>=2&&ad(a,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(var o in a){var s=a[o],u=this._uniformSetters[o];if(u){var f=s,c=!1;if(f instanceof xe&&(f=f.texture),f instanceof gt)if(c=this.uniforms[o]!==s,c){u.textureIndex===void 0&&(u.textureIndex=this._textureIndexCounter++);var h=f,p=u.textureIndex;h.bind(p),f=p,this._textureUniforms[o]=h}else f=u.textureIndex;else this._textureUniforms[o]&&delete this._textureUniforms[o];(u(f)||c)&&od(this.uniforms,o,s)}}return this}},{key:"_areTexturesRenderable",value:function(){var a=!0;for(var o in this._textureUniforms){var s=this._textureUniforms[o];s.update(),a=a&&s.loaded}return a}},{key:"_bindTextures",value:function(){for(var a in this._textureUniforms){var o=this._uniformSetters[a].textureIndex;this._textureUniforms[a].bind(o)}}},{key:"_createHandle",value:function(){return this.gl.createProgram()}},{key:"_deleteHandle",value:function(){this.gl.deleteProgram(this.handle)}},{key:"_getOptionsFromHandle",value:function(a){var o=this.gl.getAttachedShaders(a),s={},u=Ex(o),f;try{for(u.s();!(f=u.n()).done;){var c=f.value,h=this.gl.getShaderParameter(this.handle,35663);switch(h){case 35633:s.vs=new ua({handle:c});break;case 35632:s.fs=new fa({handle:c});break;default:}}}catch(p){u.e(p)}finally{u.f()}return s}},{key:"_getParameter",value:function(a){return this.gl.getProgramParameter(this.handle,a)}},{key:"_setId",value:function(a){if(!a){var o=this._getName();this.id=Pe(o)}}},{key:"_getName",value:function(){var a=this.vs.getName()||this.fs.getName();return a=a.replace(/shader/i,""),a=a?"".concat(a,"-program"):"program",a}},{key:"_compileAndLink",value:function(){var a=this.gl;if(a.attachShader(this.handle,this.vs.handle),a.attachShader(this.handle,this.fs.handle),Q.time(cd,"linkProgram for ".concat(this._getName()))(),a.linkProgram(this.handle),Q.timeEnd(cd,"linkProgram for ".concat(this._getName()))(),a.debug||Q.level>0){var o=a.getProgramParameter(this.handle,35714);if(!o)throw new Error("Error linking: ".concat(a.getProgramInfoLog(this.handle)));a.validateProgram(this.handle);var s=a.getProgramParameter(this.handle,35715);if(!s)throw new Error("Error validating: ".concat(a.getProgramInfoLog(this.handle)))}}},{key:"_readUniformLocationsFromLinkedProgram",value:function(){var a=this.gl;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(var o=0;o<this._uniformCount;o++){var s=this.gl.getActiveUniform(this.handle,o),u=id(s.name),f=u.name,c=a.getUniformLocation(this.handle,f);if(this._uniformSetters[f]=Wf(a,c,s),s.size>1)for(var h=0;h<s.size;h++)c=a.getUniformLocation(this.handle,"".concat(f,"[").concat(h,"]")),this._uniformSetters["".concat(f,"[").concat(h,"]")]=Wf(a,c,s)}this._textureIndexCounter=0}},{key:"getActiveUniforms",value:function(a,o){return this.gl2.getActiveUniforms(this.handle,a,o)}},{key:"getUniformBlockIndex",value:function(a){return this.gl2.getUniformBlockIndex(this.handle,a)}},{key:"getActiveUniformBlockParameter",value:function(a,o){return this.gl2.getActiveUniformBlockParameter(this.handle,a,o)}},{key:"uniformBlockBinding",value:function(a,o){this.gl2.uniformBlockBinding(this.handle,a,o)}}]),n}(Je,Symbol.toStringTag);function kx(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Rx(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Rx(t,r){if(t){if(typeof t=="string")return hd(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return hd(t,r)}}function hd(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Cx(t){var r=Ix();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Ix(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Lx=34918,Dx=34919,jx=35007,Fx=36795,Nx=35976,Bx=35887,Vx=36202,$o=function(t,r){N(n,t);var e=Cx(n);function n(i){var a;T(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.target=null,a._queryPending=!1,a._pollingPromise=null,Object.seal(W(a)),a}return S(n,[{key:r,get:function(){return"Query"}},{key:"beginTimeElapsedQuery",value:function(){return this.begin(jx)}},{key:"beginOcclusionQuery",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.conservative,s=o===void 0?!1:o;return this.begin(s?Vx:Bx)}},{key:"beginTransformFeedbackQuery",value:function(){return this.begin(Nx)}},{key:"begin",value:function(a){return this._queryPending?this:(this.target=a,this.gl2.beginQuery(this.target,this.handle),this)}},{key:"end",value:function(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}},{key:"isResultAvailable",value:function(){if(!this._queryPending)return!1;var a=this.gl2.getQueryParameter(this.handle,Dx);return a&&(this._queryPending=!1),a}},{key:"isTimerDisjoint",value:function(){return this.gl2.getParameter(Fx)}},{key:"getResult",value:function(){return this.gl2.getQueryParameter(this.handle,Lx)}},{key:"getTimerMilliseconds",value:function(){return this.getResult()/1e6}},{key:"createPoll",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;var s=0;return this._pollingPromise=new Promise(function(u,f){var c=function h(){a.isResultAvailable()?(u(a.getResult()),a._pollingPromise=null):s++>o?(f("Timed out"),a._pollingPromise=null):requestAnimationFrame(h)};requestAnimationFrame(c)}),this._pollingPromise}},{key:"_createHandle",value:function(){return n.isSupported(this.gl)?this.gl2.createQuery():null}},{key:"_deleteHandle",value:function(){this.gl2.deleteQuery(this.handle)}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=ie(a),u=Fr(a,Ee.TIMER_QUERY),f=s||u,c=kx(o),h;try{for(c.s();!(h=c.n()).done;){var p=h.value;switch(p){case"queries":f=f&&s;break;case"timers":f=f&&u;break;default:H(!1)}}}catch(d){c.e(d)}finally{c.f()}return f}}]),n}(Je,Symbol.toStringTag);function zx(t){var r=Ux();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Ux(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zr=function(t,r){N(n,t);var e=zx(n);function n(i){var a;T(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ke(i),a=e.call(this,i,o),a.initialize(o),a.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(W(a)),a}return S(n,[{key:r,get:function(){return"TransformFeedback"}},{key:"initialize",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Kt(this.buffers)||this.bind(function(){return a._unbindBuffers()}),this.setProps(o),this}},{key:"setProps",value:function(a){"program"in a&&(this.configuration=a.program&&a.program.configuration),"configuration"in a&&(this.configuration=a.configuration),"bindOnUse"in a&&(a=a.bindOnUse),"buffers"in a&&this.setBuffers(a.buffers)}},{key:"setBuffers",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(function(){for(var s in o)a.setBuffer(s,o[s])}),this}},{key:"setBuffer",value:function(a,o){var s=this._getVaryingIndex(a),u=this._getBufferParams(o),f=u.buffer,c=u.byteSize,h=u.byteOffset;return s<0?(this.unused[a]=f,Q.warn("".concat(this.id," unused varying buffer ").concat(a))(),this):(this.buffers[s]=o,this.bindOnUse||this._bindBuffer(s,f,h,c),this)}},{key:"begin",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(a),this}},{key:"end",value:function(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}},{key:"_getBufferParams",value:function(a){var o,s,u;return a instanceof fe?u=a:(u=a.buffer,s=a.byteSize,o=a.byteOffset),(o!==void 0||s!==void 0)&&(o=o||0,s=s||u.byteLength-o),{buffer:u,byteOffset:o,byteSize:s}}},{key:"_getVaryingInfo",value:function(a){return this.configuration&&this.configuration.getVaryingInfo(a)}},{key:"_getVaryingIndex",value:function(a){if(this.configuration)return this.configuration.getVaryingInfo(a).location;var o=Number(a);return Number.isFinite(o)?o:-1}},{key:"_bindBuffers",value:function(){if(this.bindOnUse)for(var a in this.buffers){var o=this._getBufferParams(this.buffers[a]),s=o.buffer,u=o.byteSize,f=o.byteOffset;this._bindBuffer(a,s,f,u)}}},{key:"_unbindBuffers",value:function(){if(this.bindOnUse)for(var a in this.buffers)this._bindBuffer(a,null)}},{key:"_bindBuffer",value:function(a,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0,f=o&&o.handle;return!f||u===void 0?this.gl.bindBufferBase(35982,a,f):this.gl.bindBufferRange(35982,a,f,s,u),this}},{key:"_createHandle",value:function(){return this.gl.createTransformFeedback()}},{key:"_deleteHandle",value:function(){this.gl.deleteTransformFeedback(this.handle)}},{key:"_bindHandle",value:function(a){this.gl.bindTransformFeedback(36386,this.handle)}}],[{key:"isSupported",value:function(a){return ie(a)}}]),n}(Je,Symbol.toStringTag);var Ho=null;function Gx(t){return(!Ho||Ho.byteLength<t)&&(Ho=new ArrayBuffer(t)),Ho}function pd(t,r){var e=Gx(t.BYTES_PER_ELEMENT*r);return new t(e,0,r)}function dd(t){for(var r=t.target,e=t.source,n=t.start,i=n===void 0?0:n,a=t.count,o=a===void 0?1:a,s=e.length,u=o*s,f=0,c=i;f<s;f++)r[c++]=e[f];for(;f<u;)f<u-f?(r.copyWithin(i+f,i,i+f),f*=2):(r.copyWithin(i+f,i,i+u-f),f=u);return r}function $x(t){var r=Hx();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Hx(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Wx="elements must be GL.ELEMENT_ARRAY_BUFFER",Wo=function(t,r){N(n,t);var e=$x(n);function n(i){var a;T(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.id||o.program&&o.program.id;return a=e.call(this,i,Object.assign({},o,{id:s})),a.buffer=null,a.bufferValue=null,a.isDefaultArray=o.isDefaultArray||!1,a.gl2=i,a.initialize(o),Object.seal(W(a)),a}return S(n,[{key:r,get:function(){return"VertexArrayObject"}},{key:"delete",value:function(){return be(M(n.prototype),"delete",this).call(this),this.buffer&&this.buffer.delete(),this}},{key:"MAX_ATTRIBUTES",get:function(){return n.getMaxAttributes(this.gl)}},{key:"initialize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(a)}},{key:"setProps",value:function(a){return this}},{key:"setElementBuffer",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return H(!o||o.target===34963,Wx),this.bind(function(){a.gl.bindBuffer(34963,o?o.handle:null)}),this}},{key:"setBuffer",value:function(a,o,s){if(o.target===34963)return this.setElementBuffer(o,s);var u=s.size,f=s.type,c=s.stride,h=s.offset,p=s.normalized,d=s.integer,v=s.divisor,m=this.gl,g=this.gl2;return a=Number(a),this.bind(function(){m.bindBuffer(34962,o.handle),d?(H(ie(m)),g.vertexAttribIPointer(a,u,f,c,h)):m.vertexAttribPointer(a,u,f,p,c,h),m.enableVertexAttribArray(a),g.vertexAttribDivisor(a,v||0)}),this}},{key:"enable",value:function(a){var o=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,u=!s&&a===0&&!n.isSupported(this.gl,{constantAttributeZero:!0});return u||(a=Number(a),this.bind(function(){return s?o.gl.enableVertexAttribArray(a):o.gl.disableVertexAttribArray(a)})),this}},{key:"getConstantBuffer",value:function(a,o){var s=this._normalizeConstantArrayValue(o),u=s.byteLength*a,f=s.length*a,c=!this.buffer;if(this.buffer=this.buffer||new fe(this.gl,u),c=c||this.buffer.reallocate(u),c=c||!this._compareConstantArrayValues(s,this.bufferValue),c){var h=pd(o.constructor,f);dd({target:h,source:s,start:0,count:f}),this.buffer.subData(h),this.bufferValue=o}return this.buffer}},{key:"_normalizeConstantArrayValue",value:function(a){return Array.isArray(a)?new Float32Array(a):a}},{key:"_compareConstantArrayValues",value:function(a,o){if(!a||!o||a.length!==o.length||a.constructor!==o.constructor)return!1;for(var s=0;s<a.length;++s)if(a[s]!==o[s])return!1;return!0}},{key:"_createHandle",value:function(){var a=this.gl;return a.createVertexArray()}},{key:"_deleteHandle",value:function(a){return this.gl2.deleteVertexArray(a),[this.elements]}},{key:"_bindHandle",value:function(a){this.gl2.bindVertexArray(a)}},{key:"_getParameter",value:function(a,o){var s=this,u=o.location;return H(Number.isFinite(u)),this.bind(function(){switch(a){case 34373:return s.gl.getVertexAttribOffset(u,a);default:return s.gl.getVertexAttrib(u,a)}})}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return o.constantAttributeZero?ie(a)||Qn()==="Chrome":!0}},{key:"getDefaultArray",value:function(a){return a.luma=a.luma||{},a.luma.defaultVertexArray||(a.luma.defaultVertexArray=new n(a,{handle:null,isDefaultArray:!0})),a.luma.defaultVertexArray}},{key:"getMaxAttributes",value:function(a){return n.MAX_ATTRIBUTES=n.MAX_ATTRIBUTES||a.getParameter(34921),n.MAX_ATTRIBUTES}},{key:"setConstant",value:function(a,o,s){switch(s.constructor){case Float32Array:n._setConstantFloatArray(a,o,s);break;case Int32Array:n._setConstantIntArray(a,o,s);break;case Uint32Array:n._setConstantUintArray(a,o,s);break;default:H(!1)}}},{key:"_setConstantFloatArray",value:function(a,o,s){switch(s.length){case 1:a.vertexAttrib1fv(o,s);break;case 2:a.vertexAttrib2fv(o,s);break;case 3:a.vertexAttrib3fv(o,s);break;case 4:a.vertexAttrib4fv(o,s);break;default:H(!1)}}},{key:"_setConstantIntArray",value:function(a,o,s){switch(H(ie(a)),s.length){case 1:a.vertexAttribI1iv(o,s);break;case 2:a.vertexAttribI2iv(o,s);break;case 3:a.vertexAttribI3iv(o,s);break;case 4:a.vertexAttribI4iv(o,s);break;default:H(!1)}}},{key:"_setConstantUintArray",value:function(a,o,s){switch(H(ie(a)),s.length){case 1:a.vertexAttribI1uiv(o,s);break;case 2:a.vertexAttribI2uiv(o,s);break;case 3:a.vertexAttribI3uiv(o,s);break;case 4:a.vertexAttribI4uiv(o,s);break;default:H(!1)}}}]),n}(Je,Symbol.toStringTag);var Yx="VertexArray: attributes must be Buffers or constants (i.e. typed array)",Xx=/^(.+)__LOCATION_([0-9]+)$/,qx=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"],qf=function(){function t(r){T(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.id||e.program&&e.program.id;this.id=n,this.gl=r,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Wo(r),Co(this,"VertexArray","v6.0",qx),this.initialize(e),Object.seal(this)}return S(t,[{key:"delete",value:function(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}},{key:"initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}},{key:"reset",value:function(){this.elements=null,this.elementsAccessor=null;var e=this.vertexArrayObject.MAX_ATTRIBUTES;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}},{key:"setProps",value:function(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}},{key:"clearDrawParams",value:function(){this.drawParams=null}},{key:"getDrawParams",value:function(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}},{key:"setAttributes",value:function(e){var n=this;return Object.assign(this.attributes,e),this.vertexArrayObject.bind(function(){for(var i in e){var a=e[i];n._setAttribute(i,a)}n.gl.bindBuffer(34962,null)}),this}},{key:"setElementBuffer",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}},{key:"setBuffer",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);var a=this._resolveLocationAndAccessor(e,n,n.accessor,i),o=a.location,s=a.accessor;return o>=0&&(this.values[o]=n,this.accessors[o]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(o,n,s)),this}},{key:"setConstant",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i)),o=a.location,s=a.accessor;return o>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[o]=n,this.accessors[o]=s,this.clearDrawParams(),this.vertexArrayObject.enable(o,!1)),this}},{key:"unbindBuffers",value:function(){var e=this;return this.vertexArrayObject.bind(function(){e.elements&&e.vertexArrayObject.setElementBuffer(null),e.buffer=e.buffer||new fe(e.gl,{accessor:{size:4}});for(var n=0;n<e.vertexArrayObject.MAX_ATTRIBUTES;n++)e.values[n]instanceof fe&&(e.gl.disableVertexAttribArray(n),e.gl.bindBuffer(34962,e.buffer.handle),e.gl.vertexAttribPointer(n,1,5126,!1,0,0))}),this}},{key:"bindBuffers",value:function(){var e=this;return this.vertexArrayObject.bind(function(){e.elements&&e.setElementBuffer(e.elements);for(var n=0;n<e.vertexArrayObject.MAX_ATTRIBUTES;n++){var i=e.values[n];i instanceof fe&&e.setBuffer(n,i)}}),this}},{key:"bindForDraw",value:function(e,n,i){var a=this,o;return this.vertexArrayObject.bind(function(){a._setConstantAttributes(e,n),o=i()}),o}},{key:"_resolveLocationAndAccessor",value:function(e,n,i,a){var o=this,s={location:-1,accessor:null},u=this._getAttributeIndex(e),f=u.location,c=u.name;if(!Number.isFinite(f)||f<0)return this.unused[e]=n,Q.once(3,function(){return"unused value ".concat(e," in ").concat(o.id)})(),s;var h=this._getAttributeInfo(c||f);if(!h)return s;var p=this.accessors[f]||{},d=St.resolve(h.accessor,p,i,a),v=d.size,m=d.type;return H(Number.isFinite(v)&&Number.isFinite(m)),{location:f,accessor:d}}},{key:"_getAttributeInfo",value:function(e){return this.configuration&&this.configuration.getAttributeInfo(e)}},{key:"_getAttributeIndex",value:function(e){var n=Number(e);if(Number.isFinite(n))return{location:n};var i=Xx.exec(e),a=i?i[1]:e,o=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(a)+o,name:a}:{location:-1}}},{key:"_setAttribute",value:function(e,n){if(n instanceof fe)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof fe){var i=n[0],a=n[1];this.setBuffer(e,i,a)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){var o=n;this.setConstant(e,o)}else if(n.buffer instanceof fe){var s=n;this.setBuffer(e,s.buffer,s)}else throw new Error(Yx)}},{key:"_setConstantAttributes",value:function(e,n){var i=Math.max(e|0,n|0),a=this.values[0];ArrayBuffer.isView(a)&&this._setConstantAttributeZero(a,i);for(var o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)a=this.values[o],ArrayBuffer.isView(a)&&this._setConstantAttribute(o,a)}},{key:"_setConstantAttributeZero",value:function(e,n){if(Wo.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}var i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}},{key:"_setConstantAttribute",value:function(e,n){Wo.setConstant(this.gl,e,n)}},{key:"_updateDrawParams",value:function(){for(var e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0},n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}},{key:"_updateDrawParamsForLocation",value:function(e,n){var i=this.values[n],a=this.accessors[n];if(i){var o=a.divisor,s=o>0;if(e.isInstanced=e.isInstanced||s,i instanceof fe){var u=i;if(s){var f=u.getVertexCount(a);e.instanceCount=Math.min(e.instanceCount,f)}else{var c=u.getVertexCount(a);e.vertexCount=Math.min(e.vertexCount,c)}}}}},{key:"setElements",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Q.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}]),t}();function Zx(t,r){for(var e=r.maxElts,n=e===void 0?16:e,i=r.size,a=i===void 0?1:i,o="[",s=0;s<t.length&&s<n;++s)s>0&&(o+=",".concat(s%a===0?" ":"")),o+=gn(t[s],r);var u=t.length>n?"...":"]";return"".concat(o).concat(u)}function gn(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=1e-16,n=r.isInteger,i=n===void 0?!1:n;if(Array.isArray(t)||ArrayBuffer.isView(t))return Zx(t,r);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<e)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);var a=t.toPrecision(2),o=a.indexOf(".0");return o===a.length-2?a.slice(0,-1):a}function Zf(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Kx(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Kx(t,r){if(t){if(typeof t=="string")return vd(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return vd(t,r)}}function vd(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Yo(t){var r=t.header,e=r===void 0?"Uniforms":r,n=t.program,i=t.uniforms,a=t.undefinedOnly,o=a===void 0?!1:a;H(n);var s=".*_.*",u=".*Matrix",f=n._uniformSetters,c={},h=Object.keys(f).sort(),p=0,d=Zf(h),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;!m.match(s)&&!m.match(u)&&Kf({table:c,header:e,uniforms:i,uniformName:m,undefinedOnly:o})&&p++}}catch(I){d.e(I)}finally{d.f()}var g=Zf(h),_;try{for(g.s();!(_=g.n()).done;){var w=_.value;w.match(u)&&Kf({table:c,header:e,uniforms:i,uniformName:w,undefinedOnly:o})&&p++}}catch(I){g.e(I)}finally{g.f()}var x=Zf(h),P;try{for(x.s();!(P=x.n()).done;){var E=P.value;c[E]||Kf({table:c,header:e,uniforms:i,uniformName:E,undefinedOnly:o})&&p++}}catch(I){x.e(I)}finally{x.f()}var A=0,R={};if(!o)for(var D in i){var j=i[D];c[D]||(A++,R[D]=l({Type:"NOT USED: ".concat(j)},e,gn(j)))}return{table:c,count:p,unusedTable:R,unusedCount:A}}function Kf(t){var r=t.table,e=t.header,n=t.uniforms,i=t.uniformName,a=t.undefinedOnly,o=n[i],s=Qx(o);if(!a||!s){var u;return r[i]=(u={},l(u,e,s?gn(o):"N/A"),l(u,"Uniform Type",s?o:"NOT PROVIDED"),u),!0}return!1}function Qx(t){return t!=null}function Qf(t){var r=t.vertexArray,e=t.header,n=e===void 0?"Attributes":e;if(!r.configuration)return{};var i={};r.elements&&(i.ELEMENT_ARRAY_BUFFER=md(r,r.elements,null,n));var a=r.values;for(var o in a){var s=r._getAttributeInfo(o);if(s){var u="".concat(o,": ").concat(s.name),f=r.accessors[s.location];f&&(u="".concat(o,": ").concat(Jx(s.name,f))),i[u]=md(r,a[o],f,n)}}return i}function md(t,r,e,n){var i,a=t.gl;if(!r){var o;return o={},l(o,n,"null"),l(o,"Format ","N/A"),o}var s="NOT PROVIDED",u=1,f=0,c=0,h,p,d;if(e&&(s=e.type,u=e.size,s=String(s).replace("Array",""),h=s.indexOf("nt")!==-1),r instanceof fe){var v,m=r,g=m.getDebugData(),_=g.data,w=g.changed;p=w?"*":"",d=_,c=m.byteLength,f=c/_.BYTES_PER_ELEMENT/u;var x;if(e){var P=e.divisor>0;x="".concat(P?"I ":"P "," ").concat(f," (x").concat(u,"=").concat(c," bytes ").concat(Pt(a,s),")")}else h=!0,x="".concat(c," bytes");return v={},l(v,n,"".concat(p).concat(gn(d,{size:u,isInteger:h}))),l(v,"Format ",x),v}return d=r,u=r.length,s=String(r.constructor.name).replace("Array",""),h=s.indexOf("nt")!==-1,i={},l(i,n,"".concat(gn(d,{size:u,isInteger:h})," (constant)")),l(i,"Format ","".concat(u,"x").concat(s," (constant)")),i}function Jx(t,r){var e=r.type,n=r.size,i=Go(e,n);return i?"".concat(t," (").concat(i.name,")"):t}function gd(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=eT(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function eT(t,r){if(t){if(typeof t=="string")return yd(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return yd(t,r)}}function yd(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Jf(t){var r={},e="Accessors for ".concat(t.id),n=gd(t.attributeInfos),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;if(a){var o=_d(a);r["in ".concat(o)]=l({},e,JSON.stringify(a.accessor))}}}catch(h){n.e(h)}finally{n.f()}var s=gd(t.varyingInfos),u;try{for(s.s();!(u=s.n()).done;){var f=u.value;if(f){var c=_d(f);r["out ".concat(c)]=l({},e,JSON.stringify(f.accessor))}}}catch(h){s.e(h)}finally{s.f()}return r}function _d(t){var r=t.accessor,e=r.type,n=r.size,i=Go(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}var el=Be(Ge());var bd=Ye()&&typeof document<"u",tT=0,Xo=function(){function t(){T(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.onCreateContext,n=e===void 0?function(G){return ii(G)}:e,i=r.onAddHTML,a=i===void 0?null:i,o=r.onInitialize,s=o===void 0?function(){}:o,u=r.onRender,f=u===void 0?function(){}:u,c=r.onFinalize,h=c===void 0?function(){}:c,p=r.onError,d=r.gl,v=d===void 0?null:d,m=r.glOptions,g=m===void 0?{}:m,_=r.debug,w=_===void 0?!1:_,x=r.createFramebuffer,P=x===void 0?!1:x,E=r.autoResizeViewport,A=E===void 0?!0:E,R=r.autoResizeDrawingBuffer,D=R===void 0?!0:R,j=r.stats,I=j===void 0?Et.get("animation-loop-".concat(tT++)):j,V=r.useDevicePixels,F=V===void 0?!0:V;"useDevicePixelRatio"in r&&(Q.deprecated("useDevicePixelRatio","useDevicePixels")(),F=r.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:a,onInitialize:s,onRender:f,onFinalize:h,onError:p,gl:v,glOptions:g,debug:w,createFramebuffer:P},this.gl=v,this.needsRedraw=null,this.timeline=null,this.stats=I,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:A,autoResizeDrawingBuffer:D,useDevicePixels:F}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}return S(t,[{key:"delete",value:function(){this.stop(),this._setDisplay(null)}},{key:"setNeedsRedraw",value:function(e){return H(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}},{key:"setProps",value:function(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}},{key:"start",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;var i=this._getPageLoadPromise().then(function(){return!e._running||e._initialized?null:(e._createWebGLContext(n),e._createFramebuffer(),e._startEventHandling(),e._initializeCallbackData(),e._updateCallbackData(),e._resizeCanvasDrawingBuffer(),e._resizeViewport(),e._gpuTimeQuery=$o.isSupported(e.gl,["timers"])?new $o(e.gl):null,e._initialized=!0,e.onInitialize(e.animationProps))}).then(function(a){e._running&&(e._addCallbackData(a||{}),a!==!1&&e._startLoop())});return this.props.onError&&i.catch(this.props.onError),this}},{key:"redraw",value:function(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}},{key:"stop",value:function(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}},{key:"attachTimeline",value:function(e){return this.timeline=e,this.timeline}},{key:"detachTimeline",value:function(){this.timeline=null}},{key:"waitForRender",value:function(){var e=this;return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(function(n){e._resolveNextFrame=n})),this._nextFramePromise}},{key:"toDataURL",value:function(){var r=de(el.default.mark(function n(){return el.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.setNeedsRedraw("toDataURL"),a.next=3,this.waitForRender();case 3:return a.abrupt("return",this.gl.canvas.toDataURL());case 4:case"end":return a.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"isContextLost",value:function(){return this.gl.isContextLost()}},{key:"onCreateContext",value:function(){var e;return(e=this.props).onCreateContext.apply(e,arguments)}},{key:"onInitialize",value:function(){var e;return(e=this.props).onInitialize.apply(e,arguments)}},{key:"onRender",value:function(){var e;return(e=this.props).onRender.apply(e,arguments)}},{key:"onFinalize",value:function(){var e;return(e=this.props).onFinalize.apply(e,arguments)}},{key:"getHTMLControlValue",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=document.getElementById(e);return i?Number(i.value):n}},{key:"setViewParameters",value:function(){return Q.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}},{key:"_startLoop",value:function(){var e=this,n=function i(){e._running&&(e.redraw(),e._animationFrameId=e._requestAnimationFrame(i))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(n)}},{key:"_getPageLoadPromise",value:function(){return this._pageLoadPromise||(this._pageLoadPromise=bd?new Promise(function(e,n){if(bd&&document.readyState==="complete"){e(document);return}window.addEventListener("load",function(){e(document)})}):Promise.resolve({})),this._pageLoadPromise}},{key:"_setDisplay",value:function(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}},{key:"_cancelAnimationFrame",value:function(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):Of(e)}},{key:"_requestAnimationFrame",value:function(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):Af(e)}},{key:"_renderFrame",value:function(){if(this.display){var e;(e=this.display)._renderFrame.apply(e,arguments);return}this.onRender.apply(this,arguments)}},{key:"_clearNeedsRedraw",value:function(){this.needsRedraw=null}},{key:"_setupFrame",value:function(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}},{key:"_initializeCallbackData",value:function(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}},{key:"_updateCallbackData",value:function(){var e=this._getSizeAndAspect(),n=e.width,i=e.height,a=e.aspect;(n!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),a!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=n,this.animationProps.height=i,this.animationProps.aspect=a,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}},{key:"_finalizeCallbackData",value:function(){this.onFinalize(this.animationProps)}},{key:"_addCallbackData",value:function(e){ne(e)==="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}},{key:"_createWebGLContext",value:function(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?yr(this.props.gl,e):this.onCreateContext(e),!mr(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Mo(this.gl),this._createInfoDiv()}},{key:"_createInfoDiv",value:function(){if(this.gl.canvas&&this.props.onAddHTML){var e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";var n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);var i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}},{key:"_getSizeAndAspect",value:function(){var e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight,i=1,a=this.gl.canvas;return a&&a.clientHeight?i=a.clientWidth/a.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}},{key:"_resizeViewport",value:function(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}},{key:"_resizeCanvasDrawingBuffer",value:function(){this.autoResizeDrawingBuffer&&Sf(this.gl,{useDevicePixels:this.useDevicePixels})}},{key:"_createFramebuffer",value:function(){this.props.createFramebuffer&&(this.framebuffer=new xe(this.gl))}},{key:"_resizeFramebuffer",value:function(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}},{key:"_beginTimers",value:function(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}},{key:"_endTimers",value:function(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}},{key:"_startEventHandling",value:function(){var e=this.gl.canvas;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}},{key:"_onMousemove",value:function(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}},{key:"_onMouseleave",value:function(e){this.animationProps._mousePosition=null}}]),t}();var yn="vs",ha="fs";function $e(t,r){if(!t)throw new Error(r||"shadertools: assertion failed.")}var tl={number:{validate:function(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},array:{validate:function(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function xd(t){var r={};for(var e in t){var n=t[e],i=rT(n);r[e]=i}return r}function rT(t){var r=wd(t);return r==="object"?t?"type"in t?Object.assign({},t,tl[t.type]):"value"in t?(r=wd(t.value),Object.assign({type:r},t,tl[r])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:r,value:t},tl[r])}function wd(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":ne(t)}var nT="vs",iT="fs",qo=function(){function t(r){T(this,t);var e=r.name,n=r.vs,i=r.fs,a=r.dependencies,o=a===void 0?[]:a,s=r.uniforms,u=r.getUniforms,f=r.deprecations,c=f===void 0?[]:f,h=r.defines,p=h===void 0?{}:h,d=r.inject,v=d===void 0?{}:d,m=r.vertexShader,g=r.fragmentShader;$e(typeof e=="string"),this.name=e,this.vs=n||m,this.fs=i||g,this.getModuleUniforms=u,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(c),this.defines=p,this.injections=aT(v),s&&(this.uniforms=xd(s))}return S(t,[{key:"getModuleSource",value:function(e){var n;switch(e){case nT:n=this.vs||"";break;case iT:n=this.fs||"";break;default:$e(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}},{key:"getUniforms",value:function(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}},{key:"getDefines",value:function(){return this.defines}},{key:"checkDeprecations",value:function(e,n){this.deprecations.forEach(function(i){i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}},{key:"_parseDeprecationDefinitions",value:function(e){return e.forEach(function(n){switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}},{key:"_defaultGetUniforms",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n={},i=this.uniforms;for(var a in i){var o=i[a];a in e&&!o.private?(o.validate&&$e(o.validate(e[a],o),"".concat(this.name,": invalid ").concat(a)),n[a]=e[a]):n[a]=o.value}return n}}]),t}();function Zo(t){if(!t.normalized&&(t.normalized=!0,t.uniforms&&!t.getUniforms)){var r=new qo(t);t.getUniforms=r.getUniforms.bind(r)}return t}function aT(t){var r={vs:{},fs:{}};for(var e in t){var n=t[e],i=e.slice(0,2);typeof n=="string"&&(n={order:0,injection:n}),r[i][e]=n}return r}function Td(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=oT(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function oT(t,r){if(t){if(typeof t=="string")return Ed(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Ed(t,r)}}function Ed(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Pd(t){return sT(Ad(t))}function sT(t){var r={},e={};return Sd({modules:t,level:0,moduleMap:r,moduleDepth:e}),Object.keys(e).sort(function(n,i){return e[i]-e[n]}).map(function(n){return r[n]})}function Sd(t){var r=t.modules,e=t.level,n=t.moduleMap,i=t.moduleDepth;if(e>=5)throw new Error("Possible loop in shader dependency graph");var a=Td(r),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n[s.name]=s,(i[s.name]===void 0||i[s.name]<e)&&(i[s.name]=e)}}catch(h){a.e(h)}finally{a.f()}var u=Td(r),f;try{for(u.s();!(f=u.n()).done;){var c=f.value;c.dependencies&&Sd({modules:c.dependencies,level:e+1,moduleMap:n,moduleDepth:i})}}catch(h){u.e(h)}finally{u.f()}}function Ad(t,r){return t.map(function(e){return e instanceof qo||($e(typeof e!="string","Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),$e(e.name,"shader module has no name"),e=new qo(e),e.dependencies=Ad(e.dependencies)),e})}function rl(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=typeof window<"u"?window.navigator||{}:{},e=t.userAgent||r.userAgent||"",n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i}var uT=7936,fT=7937,lT=7938,cT=35724,il={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Ur={};Object.keys(il).forEach(function(t){Ur[t]=t});function hT(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function Od(t){var r=t.getExtension("WEBGL_debug_renderer_info"),e=t.getParameter(r&&r.UNMASKED_VENDOR_WEBGL||uT),n=t.getParameter(r&&r.UNMASKED_RENDERER_WEBGL||fT),i=pT(e,n),a={gpuVendor:i,vendor:e,renderer:n,version:t.getParameter(lT),shadingLanguageVersion:t.getParameter(cT)};return a}function pT(t,r){return t.match(/NVIDIA/i)||r.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||r.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||r.match(/AMD/i)||t.match(/ATI/i)||r.match(/ATI/i)?"AMD":"UNKNOWN GPU"}var nl={};function al(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=il[r];if($e(n,r),!rl(e))return!0;if(r in nl)return nl[r];var i=n[0],a=e.behavior||"enable",o="#extension GL_".concat(i," : ").concat(a,`
void main(void) {}`),s=t.createShader(35633);t.shaderSource(s,o),t.compileShader(s);var u=t.getShaderParameter(s,35713);return t.deleteShader(s),nl[r]=u,u}function dT(t,r){var e=il[r];$e(e,r);var n=hT(t)&&e[1]||e[0],i=typeof n=="string"?Boolean(t.getExtension(n)):n;return $e(i===!1||i===!0),i}function pa(t,r){return r=Array.isArray(r)?r:[r],r.every(function(e){return dT(t,e)})}function Md(t){var r=Od(t);switch(r.gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function kd(t,r,e){var n=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return pa(t,Ur.GLSL_FRAG_DEPTH)&&(n+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),pa(t,Ur.GLSL_DERIVATIVES)&&al(t,Ur.GLSL_DERIVATIVES)&&(n+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),pa(t,Ur.GLSL_FRAG_DATA)&&al(t,Ur.GLSL_FRAG_DATA,{behavior:"require"})&&(n+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),pa(t,Ur.GLSL_TEXTURE_LOD)&&(n+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),n}var Rd=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,Cd=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`;var Ko,vT=(Ko={},l(Ko,yn,Rd),l(Ko,ha,Cd),Ko),da="__LUMA_INJECT_DECLARATIONS__",Id=/void\s+main\s*\([^)]*\)\s*\{\n?/,Ld=/}\n?[^{}]*$/,ol=[];function Qo(t,r,e){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=r===yn,a=function(u){var f=e[u];f.sort(function(d,v){return d.order-v.order}),ol.length=f.length;for(var c=0,h=f.length;c<h;++c)ol[c]=f[c].injection;var p="".concat(ol.join(`
`),`
`);switch(u){case"vs:#decl":i&&(t=t.replace(da,p));break;case"vs:#main-start":i&&(t=t.replace(Id,function(d){return d+p}));break;case"vs:#main-end":i&&(t=t.replace(Ld,function(d){return p+d}));break;case"fs:#decl":i||(t=t.replace(da,p));break;case"fs:#main-start":i||(t=t.replace(Id,function(d){return d+p}));break;case"fs:#main-end":i||(t=t.replace(Ld,function(d){return p+d}));break;default:t=t.replace(u,function(d){return d+p})}};for(var o in e)a(o);return t=t.replace(da,""),n&&(t=t.replace(/\}\s*$/,function(s){return s+vT[r]})),t}function li(t){var r={};return $e(Array.isArray(t)&&t.length>1),t.forEach(function(e){for(var n in e)r[n]=r[n]?"".concat(r[n],`
`).concat(e[n]):e[n]}),r}function mT(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=gT(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function gT(t,r){if(t){if(typeof t=="string")return Dd(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Dd(t,r)}}function Dd(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function ci(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}var jd=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],yT=[].concat(jd,[[ci("attribute"),"in $1"],[ci("varying"),"out $1"]]),_T=[].concat(jd,[[ci("varying"),"in $1"]]),Fd=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],bT=[].concat(Fd,[[ci("in"),"attribute $1"],[ci("out"),"varying $1"]]),wT=[].concat(Fd,[[ci("in"),"varying $1"]]),sl="gl_FragColor",ul=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,xT=/void\s+main\s*\([^)]*\)\s*\{\n?/;function fl(t,r,e){switch(r){case 300:return e?Jo(t,yT):TT(t);case 100:return e?Jo(t,bT):ET(t);default:throw new Error("unknown GLSL version ".concat(r))}}function Jo(t,r){var e=mT(r),n;try{for(e.s();!(n=e.n()).done;){var i=Z(n.value,2),a=i[0],o=i[1];t=t.replace(a,o)}}catch(s){e.e(s)}finally{e.f()}return t}function TT(t){t=Jo(t,_T);var r=t.match(ul);if(r){var e=r[1];t=t.replace(new RegExp("\\b".concat(sl,"\\b"),"g"),e)}else{var n="fragmentColor";t=t.replace(xT,function(i){return"out vec4 ".concat(n,`;
`).concat(i)}).replace(new RegExp("\\b".concat(sl,"\\b"),"g"),n)}return t}function ET(t){t=Jo(t,wT);var r=t.match(ul);if(r){var e=r[1];t=t.replace(ul,"").replace(new RegExp("\\b".concat(e,"\\b"),"g"),sl)}return t}var es;function ll(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=PT(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function PT(t,r){if(t){if(typeof t=="string")return Nd(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Nd(t,r)}}function Nd(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var ST=`

`.concat(da,`

`),Vd=(es={},l(es,yn,"vertex"),l(es,ha,"fragment"),es),AT=`precision highp float;

`;function cl(t,r){var e=r.vs,n=r.fs,i=Pd(r.modules||[]);return{gl:t,vs:Bd(t,Object.assign({},r,{source:e,type:yn,modules:i})),fs:Bd(t,Object.assign({},r,{source:n,type:ha,modules:i})),getUniforms:OT(i)}}function Bd(t,r){var e=r.id,n=r.source,i=r.type,a=r.modules,o=r.defines,s=o===void 0?{}:o,u=r.hookFunctions,f=u===void 0?[]:u,c=r.inject,h=c===void 0?{}:c,p=r.transpileToGLSL100,d=p===void 0?!1:p,v=r.prologue,m=v===void 0?!0:v,g=r.log;$e(typeof n=="string","shader source must be a string");var _=i===yn,w=n.split(`
`),x=100,P="",E=n;w[0].indexOf("#version ")===0?(x=300,P=w[0],E=w.slice(1).join(`
`)):P="#version ".concat(x);var A={};a.forEach(function(oe){Object.assign(A,oe.getDefines())}),Object.assign(A,s);var R=m?"".concat(P,`
`).concat(kT({id:e,source:n,type:i}),`
`).concat(MT({type:i}),`
`).concat(Md(t),`
`).concat(kd(t,x,!_),`
`).concat(RT(A),`
`).concat(_?"":AT,`
`):"".concat(P,`
`),D=IT(f),j={},I={},V={};for(var F in h){var G=typeof h[F]=="string"?{injection:h[F],order:0}:h[F],B=F.match(/^(v|f)s:(#)?([\w-]+)$/);if(B){var K=B[2],C=B[3];K?C==="decl"?I[F]=[G]:V[F]=[G]:j[F]=[G]}else V[F]=[G]}var k=ll(a),U;try{for(k.s();!(U=k.n()).done;){var $=U.value;g&&$.checkDeprecations(E,g);var q=$.getModuleSource(i,x);R+=q;var J=$.injections[i];for(var re in J){var ae=re.match(/^(v|f)s:#([\w-]+)$/);if(ae){var le=ae[2],ge=le==="decl"?I:V;ge[re]=ge[re]||[],ge[re].push(J[re])}else j[re]=j[re]||[],j[re].push(J[re])}}}catch(oe){k.e(oe)}finally{k.f()}return R+=ST,R=Qo(R,i,I),R+=CT(D[i],j),R+=E,R=Qo(R,i,V),R=fl(R,d?100:x,_),R}function OT(t){return function(e){var n={},i=ll(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.getUniforms(e,n);Object.assign(n,s)}}catch(u){i.e(u)}finally{i.f()}return n}}function MT(t){var r=t.type;return`
#define SHADER_TYPE_`.concat(Vd[r].toUpperCase(),`
`)}function kT(t){var r=t.id,e=t.source,n=t.type,i=r&&typeof r=="string"&&e.indexOf("SHADER_NAME")===-1;return i?`
#define SHADER_NAME `.concat(r,"_").concat(Vd[n],`

`):""}function RT(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=0,e="";for(var n in t){r===0&&(e+=`
// APPLICATION DEFINES
`),r++;var i=t[n];(i||Number.isFinite(i))&&(e+="#define ".concat(n.toUpperCase()," ").concat(t[n],`
`))}return r===0&&(e+=`
`),e}function CT(t,r){var e="";for(var n in t){var i=t[n];if(e+="void ".concat(i.signature,` {
`),i.header&&(e+="  ".concat(i.header)),r[n]){var a=r[n];a.sort(function(f,c){return f.order-c.order});var o=ll(a),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;e+="  ".concat(u.injection,`
`)}}catch(f){o.e(f)}finally{o.f()}}i.footer&&(e+="  ".concat(i.footer)),e+=`}
`}return e}function IT(t){var r={vs:{},fs:{}};return t.forEach(function(e){var n;typeof e!="string"?(n=e,e=n.hook):n={},e=e.trim();var i=e.split(":"),a=Z(i,2),o=a[0],s=a[1],u=e.replace(/\(.+/,"");r[o][u]=Object.assign(n,{signature:s})}),r}var LT="void main() {gl_FragColor = vec4(0);}",zd=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,DT=`#version 300 es
`.concat(zd);function ts(t,r){r=Array.isArray(r)?r:[r];var e=t.replace(/^\s+/,"").split(/\s+/),n=Z(e,3),i=n[0],a=n[1],o=n[2];if(!r.includes(i)||!a||!o)return null;var s=o.split(";")[0];return{qualifier:i,type:a,name:s}}function va(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.version,e=r===void 0?100:r,n=t.input,i=t.inputType,a=t.output;if(!n)return e===300?DT:e>300?"#version ".concat(e,`
`).concat(zd):LT;var o=Ud(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(a,`;
void main() {
  `).concat(a," = ").concat(o,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function hl(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return $e(!1),null}}function pl(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return $e(!1),null}}function Ud(t,r){switch(r){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return $e(!1),null}}var jT=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,rs={name:"fp32",vs:jT,fs:null};function ns(t,r){if(!t)throw new Error("math.gl assertion ".concat(r))}var FT=1/Math.PI*180,NT=1/180*Math.PI,He={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function ma(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.precision,n=e===void 0?He.precision:e;return t=BT(t),"".concat(parseFloat(t.toPrecision(n)))}function wr(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function hi(t,r){return dl(t,function(e){return e*NT},r)}function Gr(t,r){return dl(t,function(e){return e*FT},r)}function Te(t,r,e){return dl(t,function(n){return Math.max(r,Math.min(e,n))})}function xr(t,r,e){return wr(t)?t.map(function(n,i){return xr(n,r[i],e)}):e*r+(1-e)*t}function bt(t,r,e){var n=He.EPSILON;e&&(He.EPSILON=e);try{if(t===r)return!0;if(wr(t)&&wr(r)){if(t.length!==r.length)return!1;for(var i=0;i<t.length;++i)if(!bt(t[i],r[i]))return!1;return!0}return t&&t.equals?t.equals(r):r&&r.equals?r.equals(t):typeof t=="number"&&typeof r=="number"?Math.abs(t-r)<=He.EPSILON*Math.max(1,Math.abs(t),Math.abs(r)):!1}finally{He.EPSILON=n}}function BT(t){return Math.round(t/He.EPSILON)*He.EPSILON}function VT(t){return t.clone?t.clone():new Array(t.length)}function dl(t,r,e){if(wr(t)){var n=t;e=e||VT(n);for(var i=0;i<e.length&&i<n.length;++i)e[i]=r(t[i],i,e);return e}return r(t)}function zT(t){var r=UT();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function UT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function GT(t){function r(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return r.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(r,t):r.__proto__=t,r}var is=function(t){N(e,t);var r=zT(e);function e(){return T(this,e),r.apply(this,arguments)}return S(e,[{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"fromArray",value:function(i){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=0;o<this.ELEMENTS;++o)this[o]=i[o+a];return this.check()}},{key:"toArray",value:function(){for(var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=0;o<this.ELEMENTS;++o)i[a+o]=this[o];return i}},{key:"from",value:function(i){return Array.isArray(i)?this.copy(i):this.fromObject(i)}},{key:"to",value:function(i){return i===this?this:wr(i)?this.toArray(i):this.toObject(i)}},{key:"toTarget",value:function(i){return i?this.to(i):this}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(He)}},{key:"formatString",value:function(i){for(var a="",o=0;o<this.ELEMENTS;++o)a+=(o>0?", ":"")+ma(this[o],i);return"".concat(i.printTypes?this.constructor.name:"","[").concat(a,"]")}},{key:"equals",value:function(i){if(!i||this.length!==i.length)return!1;for(var a=0;a<this.ELEMENTS;++a)if(!bt(this[a],i[a]))return!1;return!0}},{key:"exactEquals",value:function(i){if(!i||this.length!==i.length)return!1;for(var a=0;a<this.ELEMENTS;++a)if(this[a]!==i[a])return!1;return!0}},{key:"negate",value:function(){for(var i=0;i<this.ELEMENTS;++i)this[i]=-this[i];return this.check()}},{key:"lerp",value:function(i,a,o){if(o===void 0)return this.lerp(this,i,a);for(var s=0;s<this.ELEMENTS;++s){var u=i[s];this[s]=u+o*(a[s]-u)}return this.check()}},{key:"min",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]=Math.min(i[a],this[a]);return this.check()}},{key:"max",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]=Math.max(i[a],this[a]);return this.check()}},{key:"clamp",value:function(i,a){for(var o=0;o<this.ELEMENTS;++o)this[o]=Math.min(Math.max(this[o],i[o]),a[o]);return this.check()}},{key:"add",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var f=u[s],c=0;c<this.ELEMENTS;++c)this[c]+=f[c];return this.check()}},{key:"subtract",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var f=u[s],c=0;c<this.ELEMENTS;++c)this[c]-=f[c];return this.check()}},{key:"scale",value:function(i){if(typeof i=="number")for(var a=0;a<this.ELEMENTS;++a)this[a]*=i;else for(var o=0;o<this.ELEMENTS&&o<i.length;++o)this[o]*=i[o];return this.check()}},{key:"multiplyByScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]*=i;return this.check()}},{key:"check",value:function(){if(He.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var i=this.length===this.ELEMENTS,a=0;a<this.ELEMENTS;++a)i=i&&Number.isFinite(this[a]);return i}},{key:"sub",value:function(i){return this.subtract(i)}},{key:"setScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]=i;return this.check()}},{key:"addScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]+=i;return this.check()}},{key:"subScalar",value:function(i){return this.addScalar(-i)}},{key:"multiplyScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]*=i;return this.check()}},{key:"divideScalar",value:function(i){return this.multiplyByScalar(1/i)}},{key:"clampScalar",value:function(i,a){for(var o=0;o<this.ELEMENTS;++o)this[o]=Math.min(Math.max(this[o],i),a);return this.check()}},{key:"elements",get:function(){return this}}]),e}(GT(Array));function $T(t,r){if(t.length!==r)return!1;for(var e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}function at(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function as(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(He.debug&&!$T(t,r))throw new Error("math.gl: ".concat(e," some fields set to invalid numbers'"));return t}function HT(t){var r=WT();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function WT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Gd=function(t){N(e,t);var r=HT(e);function e(){return T(this,e),r.apply(this,arguments)}return S(e,[{key:"x",get:function(){return this[0]},set:function(i){this[0]=at(i)}},{key:"y",get:function(){return this[1]},set:function(i){this[1]=at(i)}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var i=0,a=0;a<this.ELEMENTS;++a)i+=this[a]*this[a];return i}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(i){return Math.sqrt(this.distanceSquared(i))}},{key:"distanceSquared",value:function(i){for(var a=0,o=0;o<this.ELEMENTS;++o){var s=this[o]-i[o];a+=s*s}return at(a)}},{key:"dot",value:function(i){for(var a=0,o=0;o<this.ELEMENTS;++o)a+=this[o]*i[o];return at(a)}},{key:"normalize",value:function(){var i=this.magnitude();if(i!==0)for(var a=0;a<this.ELEMENTS;++a)this[a]/=i;return this.check()}},{key:"multiply",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var f=u[s],c=0;c<this.ELEMENTS;++c)this[c]*=f[c];return this.check()}},{key:"divide",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var f=u[s],c=0;c<this.ELEMENTS;++c)this[c]/=f[c];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(i){return this.distance(i)}},{key:"distanceToSquared",value:function(i){return this.distanceSquared(i)}},{key:"getComponent",value:function(i){return ns(i>=0&&i<this.ELEMENTS,"index is out of range"),at(this[i])}},{key:"setComponent",value:function(i,a){return ns(i>=0&&i<this.ELEMENTS,"index is out of range"),this[i]=a,this.check()}},{key:"addVectors",value:function(i,a){return this.copy(i).add(a)}},{key:"subVectors",value:function(i,a){return this.copy(i).subtract(a)}},{key:"multiplyVectors",value:function(i,a){return this.copy(i).multiply(a)}},{key:"addScaledVector",value:function(i,a){return this.add(new this.constructor(i).multiplyScalar(a))}}]),e}(is);var je=1e-6,er=typeof Float32Array<"u"?Float32Array:Array;var v4=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});function YT(){var t=new er(2);return er!=Float32Array&&(t[0]=0,t[1]=0),t}function ga(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t}function XT(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t}function Hd(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t}function Wd(t){var r=t[0],e=t[1];return Math.hypot(r,e)}function Yd(t,r){return t[0]=-r[0],t[1]=-r[1],t}function ss(t,r,e,n){var i=r[0],a=r[1];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t}function Xd(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[4]*i+e[12],t[1]=e[1]*n+e[5]*i+e[13],t}var qd=XT;var m4=function(){var t=YT();return function(r,e,n,i,a,o){var s,u;for(e||(e=2),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],a(t,t,o),r[s]=t[0],r[s+1]=t[1];return r}}();function Zd(t,r,e){var n=r[0],i=r[1],a=e[3]*n+e[7]*i||1;return t[0]=(e[0]*n+e[4]*i)/a,t[1]=(e[1]*n+e[5]*i)/a,t}function us(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[3]*n+e[7]*i+e[11]*a||1;return t[0]=(e[0]*n+e[4]*i+e[8]*a)/o,t[1]=(e[1]*n+e[5]*i+e[9]*a)/o,t[2]=(e[2]*n+e[6]*i+e[10]*a)/o,t}function Kd(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i,t[1]=e[1]*n+e[3]*i,t[2]=r[2],t}function qT(){var t=new er(3);return er!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Qd(t){var r=t[0],e=t[1],n=t[2];return Math.hypot(r,e,n)}function Jd(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t}function ZT(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t}function ev(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t}function KT(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function tv(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[0],s=e[1],u=e[2];return t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o,t}function fs(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[3]*n+e[7]*i+e[11]*a+e[15];return o=o||1,t[0]=(e[0]*n+e[4]*i+e[8]*a+e[12])/o,t[1]=(e[1]*n+e[5]*i+e[9]*a+e[13])/o,t[2]=(e[2]*n+e[6]*i+e[10]*a+e[14])/o,t}function rv(t,r,e){var n=r[0],i=r[1],a=r[2];return t[0]=n*e[0]+i*e[3]+a*e[6],t[1]=n*e[1]+i*e[4]+a*e[7],t[2]=n*e[2]+i*e[5]+a*e[8],t}function nv(t,r,e){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],f=r[2],c=i*f-a*u,h=a*s-n*f,p=n*u-i*s,d=i*p-a*h,v=a*c-n*p,m=n*h-i*c,g=o*2;return c*=g,h*=g,p*=g,d*=2,v*=2,m*=2,t[0]=s+c+d,t[1]=u+h+v,t[2]=f+p+m,t}function iv(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function av(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function ov(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function sv(t,r){var e=t[0],n=t[1],i=t[2],a=r[0],o=r[1],s=r[2],u=Math.sqrt(e*e+n*n+i*i),f=Math.sqrt(a*a+o*o+s*s),c=u*f,h=c&&KT(t,r)/c;return Math.acos(Math.min(Math.max(h,-1),1))}var uv=ZT;var y4=function(){var t=qT();return function(r,e,n,i,a,o){var s,u;for(e||(e=3),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2];return r}}();function QT(t){var r=JT();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function JT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vl=[0,0,0],ls,We=function(t){N(e,t);var r=QT(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return T(this,e),n=r.call(this,-0,-0,-0),arguments.length===1&&wr(i)?n.copy(i):(He.debug&&(at(i),at(a),at(o)),n[0]=i,n[1]=a,n[2]=o),n}return S(e,[{key:"set",value:function(i,a,o){return this[0]=i,this[1]=a,this[2]=o,this.check()}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this.check()}},{key:"fromObject",value:function(i){return He.debug&&(at(i.x),at(i.y),at(i.z)),this[0]=i.x,this[1]=i.y,this[2]=i.z,this.check()}},{key:"toObject",value:function(i){return i.x=this[0],i.y=this[1],i.z=this[2],i}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(i){this[2]=at(i)}},{key:"angle",value:function(i){return sv(this,i)}},{key:"cross",value:function(i){return tv(this,this,i),this.check()}},{key:"rotateX",value:function(i){var a=i.radians,o=i.origin,s=o===void 0?vl:o;return iv(this,this,s,a),this.check()}},{key:"rotateY",value:function(i){var a=i.radians,o=i.origin,s=o===void 0?vl:o;return av(this,this,s,a),this.check()}},{key:"rotateZ",value:function(i){var a=i.radians,o=i.origin,s=o===void 0?vl:o;return ov(this,this,s,a),this.check()}},{key:"transform",value:function(i){return this.transformAsPoint(i)}},{key:"transformAsPoint",value:function(i){return fs(this,this,i),this.check()}},{key:"transformAsVector",value:function(i){return us(this,this,i),this.check()}},{key:"transformByMatrix3",value:function(i){return rv(this,this,i),this.check()}},{key:"transformByMatrix2",value:function(i){return Kd(this,this,i),this.check()}},{key:"transformByQuaternion",value:function(i){return nv(this,this,i),this.check()}}],[{key:"ZERO",get:function(){return ls||(ls=new e(0,0,0),Object.freeze(ls)),ls}}]),e}(Gd);function eE(t){var r=tE();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function tE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fv=function(t){N(e,t);var r=eE(e);function e(){return T(this,e),r.apply(this,arguments)}return S(e,[{key:"toString",value:function(){var i="[";if(He.printRowMajor){i+="row-major:";for(var a=0;a<this.RANK;++a)for(var o=0;o<this.RANK;++o)i+=" ".concat(this[o*this.RANK+a])}else{i+="column-major:";for(var s=0;s<this.ELEMENTS;++s)i+=" ".concat(this[s])}return i+="]",i}},{key:"getElementIndex",value:function(i,a){return a*this.RANK+i}},{key:"getElement",value:function(i,a){return this[a*this.RANK+i]}},{key:"setElement",value:function(i,a,o){return this[a*this.RANK+i]=at(o),this}},{key:"getColumn",value:function(i){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0),o=i*this.RANK,s=0;s<this.RANK;++s)a[s]=this[o+s];return a}},{key:"setColumn",value:function(i,a){for(var o=i*this.RANK,s=0;s<this.RANK;++s)this[o+s]=a[s];return this}}]),e}(is);function rE(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lv(t,r){if(t===r){var e=r[1],n=r[2],i=r[3],a=r[6],o=r[7],s=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=e,t[6]=r[9],t[7]=r[13],t[8]=n,t[9]=a,t[11]=r[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t}function cs(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],f=r[7],c=r[8],h=r[9],p=r[10],d=r[11],v=r[12],m=r[13],g=r[14],_=r[15],w=e*s-n*o,x=e*u-i*o,P=e*f-a*o,E=n*u-i*s,A=n*f-a*s,R=i*f-a*u,D=c*m-h*v,j=c*g-p*v,I=c*_-d*v,V=h*g-p*m,F=h*_-d*m,G=p*_-d*g,B=w*G-x*F+P*V+E*I-A*j+R*D;return B?(B=1/B,t[0]=(s*G-u*F+f*V)*B,t[1]=(i*F-n*G-a*V)*B,t[2]=(m*R-g*A+_*E)*B,t[3]=(p*A-h*R-d*E)*B,t[4]=(u*I-o*G-f*j)*B,t[5]=(e*G-i*I+a*j)*B,t[6]=(g*P-v*R-_*x)*B,t[7]=(c*R-p*P+d*x)*B,t[8]=(o*F-s*I+f*D)*B,t[9]=(n*I-e*F-a*D)*B,t[10]=(v*A-m*P+_*w)*B,t[11]=(h*P-c*A-d*w)*B,t[12]=(s*j-o*V-u*D)*B,t[13]=(e*V-n*j+i*D)*B,t[14]=(m*x-v*E-g*w)*B,t[15]=(c*E-h*x+p*w)*B,t):null}function cv(t){var r=t[0],e=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],f=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],_=r*o-e*a,w=r*s-n*a,x=r*u-i*a,P=e*s-n*o,E=e*u-i*o,A=n*u-i*s,R=f*v-c*d,D=f*m-h*d,j=f*g-p*d,I=c*m-h*v,V=c*g-p*v,F=h*g-p*m;return _*F-w*V+x*I+P*j-E*D+A*R}function _n(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],f=r[6],c=r[7],h=r[8],p=r[9],d=r[10],v=r[11],m=r[12],g=r[13],_=r[14],w=r[15],x=e[0],P=e[1],E=e[2],A=e[3];return t[0]=x*n+P*s+E*h+A*m,t[1]=x*i+P*u+E*p+A*g,t[2]=x*a+P*f+E*d+A*_,t[3]=x*o+P*c+E*v+A*w,x=e[4],P=e[5],E=e[6],A=e[7],t[4]=x*n+P*s+E*h+A*m,t[5]=x*i+P*u+E*p+A*g,t[6]=x*a+P*f+E*d+A*_,t[7]=x*o+P*c+E*v+A*w,x=e[8],P=e[9],E=e[10],A=e[11],t[8]=x*n+P*s+E*h+A*m,t[9]=x*i+P*u+E*p+A*g,t[10]=x*a+P*f+E*d+A*_,t[11]=x*o+P*c+E*v+A*w,x=e[12],P=e[13],E=e[14],A=e[15],t[12]=x*n+P*s+E*h+A*m,t[13]=x*i+P*u+E*p+A*g,t[14]=x*a+P*f+E*d+A*_,t[15]=x*o+P*c+E*v+A*w,t}function bn(t,r,e){var n=e[0],i=e[1],a=e[2],o,s,u,f,c,h,p,d,v,m,g,_;return r===t?(t[12]=r[0]*n+r[4]*i+r[8]*a+r[12],t[13]=r[1]*n+r[5]*i+r[9]*a+r[13],t[14]=r[2]*n+r[6]*i+r[10]*a+r[14],t[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(o=r[0],s=r[1],u=r[2],f=r[3],c=r[4],h=r[5],p=r[6],d=r[7],v=r[8],m=r[9],g=r[10],_=r[11],t[0]=o,t[1]=s,t[2]=u,t[3]=f,t[4]=c,t[5]=h,t[6]=p,t[7]=d,t[8]=v,t[9]=m,t[10]=g,t[11]=_,t[12]=o*n+c*i+v*a+r[12],t[13]=s*n+h*i+m*a+r[13],t[14]=u*n+p*i+g*a+r[14],t[15]=f*n+d*i+_*a+r[15]),t}function pi(t,r,e){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=r[7]*i,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function hv(t,r,e,n){var i=n[0],a=n[1],o=n[2],s=Math.hypot(i,a,o),u,f,c,h,p,d,v,m,g,_,w,x,P,E,A,R,D,j,I,V,F,G,B,K;return s<je?null:(s=1/s,i*=s,a*=s,o*=s,u=Math.sin(e),f=Math.cos(e),c=1-f,h=r[0],p=r[1],d=r[2],v=r[3],m=r[4],g=r[5],_=r[6],w=r[7],x=r[8],P=r[9],E=r[10],A=r[11],R=i*i*c+f,D=a*i*c+o*u,j=o*i*c-a*u,I=i*a*c-o*u,V=a*a*c+f,F=o*a*c+i*u,G=i*o*c+a*u,B=a*o*c-i*u,K=o*o*c+f,t[0]=h*R+m*D+x*j,t[1]=p*R+g*D+P*j,t[2]=d*R+_*D+E*j,t[3]=v*R+w*D+A*j,t[4]=h*I+m*V+x*F,t[5]=p*I+g*V+P*F,t[6]=d*I+_*V+E*F,t[7]=v*I+w*V+A*F,t[8]=h*G+m*B+x*K,t[9]=p*G+g*B+P*K,t[10]=d*G+_*B+E*K,t[11]=v*G+w*B+A*K,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)}function hs(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[4],o=r[5],s=r[6],u=r[7],f=r[8],c=r[9],h=r[10],p=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=a*i+f*n,t[5]=o*i+c*n,t[6]=s*i+h*n,t[7]=u*i+p*n,t[8]=f*i-a*n,t[9]=c*i-o*n,t[10]=h*i-s*n,t[11]=p*i-u*n,t}function pv(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[0],o=r[1],s=r[2],u=r[3],f=r[8],c=r[9],h=r[10],p=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*i-f*n,t[1]=o*i-c*n,t[2]=s*i-h*n,t[3]=u*i-p*n,t[8]=a*n+f*i,t[9]=o*n+c*i,t[10]=s*n+h*i,t[11]=u*n+p*i,t}function ps(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[0],o=r[1],s=r[2],u=r[3],f=r[4],c=r[5],h=r[6],p=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*i+f*n,t[1]=o*i+c*n,t[2]=s*i+h*n,t[3]=u*i+p*n,t[4]=f*i-a*n,t[5]=c*i-o*n,t[6]=h*i-s*n,t[7]=p*i-u*n,t}function dv(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e+e,s=n+n,u=i+i,f=e*o,c=n*o,h=n*s,p=i*o,d=i*s,v=i*u,m=a*o,g=a*s,_=a*u;return t[0]=1-h-v,t[1]=c+_,t[2]=p-g,t[3]=0,t[4]=c-_,t[5]=1-f-v,t[6]=d+m,t[7]=0,t[8]=p+g,t[9]=d-m,t[10]=1-f-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vv(t,r,e,n,i,a,o){var s=1/(e-r),u=1/(i-n),f=1/(a-o);return t[0]=a*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*u,t[6]=0,t[7]=0,t[8]=(e+r)*s,t[9]=(i+n)*u,t[10]=(o+a)*f,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*f,t[15]=0,t}function nE(t,r,e,n,i){var a=1/Math.tan(r/2),o;return t[0]=a/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(n-i),t[10]=(i+n)*o,t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t}var ds=nE;function iE(t,r,e,n,i,a,o){var s=1/(r-e),u=1/(n-i),f=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*f,t[11]=0,t[12]=(r+e)*s,t[13]=(i+n)*u,t[14]=(o+a)*f,t[15]=1,t}var mv=iE;function gv(t,r,e,n){var i,a,o,s,u,f,c,h,p,d,v=r[0],m=r[1],g=r[2],_=n[0],w=n[1],x=n[2],P=e[0],E=e[1],A=e[2];return Math.abs(v-P)<je&&Math.abs(m-E)<je&&Math.abs(g-A)<je?rE(t):(c=v-P,h=m-E,p=g-A,d=1/Math.hypot(c,h,p),c*=d,h*=d,p*=d,i=w*p-x*h,a=x*c-_*p,o=_*h-w*c,d=Math.hypot(i,a,o),d?(d=1/d,i*=d,a*=d,o*=d):(i=0,a=0,o=0),s=h*o-p*a,u=p*i-c*o,f=c*a-h*i,d=Math.hypot(s,u,f),d?(d=1/d,s*=d,u*=d,f*=d):(s=0,u=0,f=0),t[0]=i,t[1]=s,t[2]=c,t[3]=0,t[4]=a,t[5]=u,t[6]=h,t[7]=0,t[8]=o,t[9]=f,t[10]=p,t[11]=0,t[12]=-(i*v+a*m+o*g),t[13]=-(s*v+u*m+f*g),t[14]=-(c*v+h*m+p*g),t[15]=1,t)}function ml(t,r){var e=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],f=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],_=t[15],w=r[0],x=r[1],P=r[2],E=r[3],A=r[4],R=r[5],D=r[6],j=r[7],I=r[8],V=r[9],F=r[10],G=r[11],B=r[12],K=r[13],C=r[14],k=r[15];return Math.abs(e-w)<=je*Math.max(1,Math.abs(e),Math.abs(w))&&Math.abs(n-x)<=je*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(i-P)<=je*Math.max(1,Math.abs(i),Math.abs(P))&&Math.abs(a-E)<=je*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(o-A)<=je*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(s-R)<=je*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(u-D)<=je*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(f-j)<=je*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(c-I)<=je*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(h-V)<=je*Math.max(1,Math.abs(h),Math.abs(V))&&Math.abs(p-F)<=je*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(d-G)<=je*Math.max(1,Math.abs(d),Math.abs(G))&&Math.abs(v-B)<=je*Math.max(1,Math.abs(v),Math.abs(B))&&Math.abs(m-K)<=je*Math.max(1,Math.abs(m),Math.abs(K))&&Math.abs(g-C)<=je*Math.max(1,Math.abs(g),Math.abs(C))&&Math.abs(_-k)<=je*Math.max(1,Math.abs(_),Math.abs(k))}function aE(){var t=new er(4);return er!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function yv(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t}function vs(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3];return t[0]=e[0]*n+e[4]*i+e[8]*a+e[12]*o,t[1]=e[1]*n+e[5]*i+e[9]*a+e[13]*o,t[2]=e[2]*n+e[6]*i+e[10]*a+e[14]*o,t[3]=e[3]*n+e[7]*i+e[11]*a+e[15]*o,t}var N4=function(){var t=aE();return function(r,e,n,i,a,o){var s,u;for(e||(e=4),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],t[3]=r[s+3],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2],r[s+3]=t[3];return r}}();function sE(t){var r=uE();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function uE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var bl;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(bl||(bl={}));var fE=45*Math.PI/180,lE=1,yl=.1,_l=500,cE=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ie=function(t){N(e,t);var r=sE(e);function e(n){var i;return T(this,e),i=r.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(n)?i.copy(n):i.identity(),i}return S(e,[{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}},{key:"INDICES",get:function(){return bl}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this[3]=i[3],this[4]=i[4],this[5]=i[5],this[6]=i[6],this[7]=i[7],this[8]=i[8],this[9]=i[9],this[10]=i[10],this[11]=i[11],this[12]=i[12],this[13]=i[13],this[14]=i[14],this[15]=i[15],this.check()}},{key:"set",value:function(i,a,o,s,u,f,c,h,p,d,v,m,g,_,w,x){return this[0]=i,this[1]=a,this[2]=o,this[3]=s,this[4]=u,this[5]=f,this[6]=c,this[7]=h,this[8]=p,this[9]=d,this[10]=v,this[11]=m,this[12]=g,this[13]=_,this[14]=w,this[15]=x,this.check()}},{key:"setRowMajor",value:function(i,a,o,s,u,f,c,h,p,d,v,m,g,_,w,x){return this[0]=i,this[1]=u,this[2]=p,this[3]=g,this[4]=a,this[5]=f,this[6]=d,this[7]=_,this[8]=o,this[9]=c,this[10]=v,this[11]=w,this[12]=s,this[13]=h,this[14]=m,this[15]=x,this.check()}},{key:"toRowMajor",value:function(i){return i[0]=this[0],i[1]=this[4],i[2]=this[8],i[3]=this[12],i[4]=this[1],i[5]=this[5],i[6]=this[9],i[7]=this[13],i[8]=this[2],i[9]=this[6],i[10]=this[10],i[11]=this[14],i[12]=this[3],i[13]=this[7],i[14]=this[11],i[15]=this[15],i}},{key:"identity",value:function(){return this.copy(cE)}},{key:"fromObject",value:function(i){return this.check()}},{key:"fromQuaternion",value:function(i){return dv(this,i),this.check()}},{key:"frustum",value:function(i){var a=i.left,o=i.right,s=i.bottom,u=i.top,f=i.near,c=f===void 0?yl:f,h=i.far,p=h===void 0?_l:h;return p===1/0?dE(this,a,o,s,u,c):vv(this,a,o,s,u,c,p),this.check()}},{key:"lookAt",value:function(i){var a=i.eye,o=i.center,s=o===void 0?[0,0,0]:o,u=i.up,f=u===void 0?[0,1,0]:u;return gv(this,a,s,f),this.check()}},{key:"ortho",value:function(i){var a=i.left,o=i.right,s=i.bottom,u=i.top,f=i.near,c=f===void 0?yl:f,h=i.far,p=h===void 0?_l:h;return mv(this,a,o,s,u,c,p),this.check()}},{key:"orthographic",value:function(i){var a=i.fovy,o=a===void 0?fE:a,s=i.aspect,u=s===void 0?lE:s,f=i.focalDistance,c=f===void 0?1:f,h=i.near,p=h===void 0?yl:h,d=i.far,v=d===void 0?_l:d;_v(o);var m=o/2,g=c*Math.tan(m),_=g*u;return this.ortho({left:-_,right:_,bottom:-g,top:g,near:p,far:v})}},{key:"perspective",value:function(i){var a=i.fovy,o=a===void 0?45*Math.PI/180:a,s=i.aspect,u=s===void 0?1:s,f=i.near,c=f===void 0?.1:f,h=i.far,p=h===void 0?500:h;return _v(o),ds(this,o,u,c,p),this.check()}},{key:"determinant",value:function(){return cv(this)}},{key:"getScale",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return i[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),i[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),i[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),i}},{key:"getTranslation",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return i[0]=this[12],i[1]=this[13],i[2]=this[14],i}},{key:"getRotation",value:function(i,a){i=i||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],a=a||[-0,-0,-0];var o=this.getScale(a),s=1/o[0],u=1/o[1],f=1/o[2];return i[0]=this[0]*s,i[1]=this[1]*u,i[2]=this[2]*f,i[3]=0,i[4]=this[4]*s,i[5]=this[5]*u,i[6]=this[6]*f,i[7]=0,i[8]=this[8]*s,i[9]=this[9]*u,i[10]=this[10]*f,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}},{key:"getRotationMatrix3",value:function(i,a){i=i||[-0,-0,-0,-0,-0,-0,-0,-0,-0],a=a||[-0,-0,-0];var o=this.getScale(a),s=1/o[0],u=1/o[1],f=1/o[2];return i[0]=this[0]*s,i[1]=this[1]*u,i[2]=this[2]*f,i[3]=this[4]*s,i[4]=this[5]*u,i[5]=this[6]*f,i[6]=this[8]*s,i[7]=this[9]*u,i[8]=this[10]*f,i}},{key:"transpose",value:function(){return lv(this,this),this.check()}},{key:"invert",value:function(){return cs(this,this),this.check()}},{key:"multiplyLeft",value:function(i){return _n(this,i,this),this.check()}},{key:"multiplyRight",value:function(i){return _n(this,this,i),this.check()}},{key:"rotateX",value:function(i){return hs(this,this,i),this.check()}},{key:"rotateY",value:function(i){return pv(this,this,i),this.check()}},{key:"rotateZ",value:function(i){return ps(this,this,i),this.check()}},{key:"rotateXYZ",value:function(i){return this.rotateX(i[0]).rotateY(i[1]).rotateZ(i[2])}},{key:"rotateAxis",value:function(i,a){return hv(this,this,i,a),this.check()}},{key:"scale",value:function(i){return pi(this,this,Array.isArray(i)?i:[i,i,i]),this.check()}},{key:"translate",value:function(i){return bn(this,this,i),this.check()}},{key:"transform",value:function(i,a){return i.length===4?(a=vs(a||[-0,-0,-0,-0],i,this),as(a,4),a):this.transformAsPoint(i,a)}},{key:"transformAsPoint",value:function(i,a){var o=i.length,s;switch(o){case 2:s=Xd(a||[-0,-0],i,this);break;case 3:s=fs(a||[-0,-0,-0],i,this);break;default:throw new Error("Illegal vector")}return as(s,i.length),s}},{key:"transformAsVector",value:function(i,a){var o;switch(i.length){case 2:o=Zd(a||[-0,-0],i,this);break;case 3:o=us(a||[-0,-0,-0],i,this);break;default:throw new Error("Illegal vector")}return as(o,i.length),o}},{key:"transformPoint",value:function(i,a){return this.transformAsPoint(i,a)}},{key:"transformVector",value:function(i,a){return this.transformAsPoint(i,a)}},{key:"transformDirection",value:function(i,a){return this.transformAsVector(i,a)}},{key:"makeRotationX",value:function(i){return this.identity().rotateX(i)}},{key:"makeTranslation",value:function(i,a,o){return this.identity().translate([i,a,o])}}],[{key:"IDENTITY",get:function(){return pE()}},{key:"ZERO",get:function(){return hE()}}]),e}(fv);var ms,gs;function hE(){return ms||(ms=new Ie([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ms)),ms}function pE(){return gs||(gs=new Ie,Object.freeze(gs)),gs}function _v(t){if(t>Math.PI*2)throw Error("expected radians")}function dE(t,r,e,n,i,a){var o=2*a/(e-r),s=2*a/(i-n),u=(e+r)/(e-r),f=(i+n)/(i-n),c=-1,h=-1,p=-2*a;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=f,t[10]=c,t[11]=h,t[12]=0,t[13]=0,t[14]=p,t[15]=0,t}var bv=1e-6,vE=6371e3,ba=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.phi,n=e===void 0?0:e,i=r.theta,a=i===void 0?0:i,o=r.radius,s=o===void 0?1:o,u=r.bearing,f=r.pitch,c=r.altitude,h=r.radiusScale,p=h===void 0?vE:h;T(this,t),l(this,"phi",void 0),l(this,"theta",void 0),l(this,"radius",void 0),l(this,"radiusScale",void 0),this.phi=n,this.theta=a,this.radius=s||c||1,this.radiusScale=p||1,u!==void 0&&(this.bearing=u),f!==void 0&&(this.pitch=f),this.check()}return S(t,[{key:"toString",value:function(){return this.formatString(He)}},{key:"formatString",value:function(e){var n=e.printTypes,i=n===void 0?!1:n,a=ma;return"".concat(i?"Spherical":"","[rho:").concat(a(this.radius),",theta:").concat(a(this.theta),",phi:").concat(a(this.phi),"]")}},{key:"equals",value:function(e){return bt(this.radius,e.radius)&&bt(this.theta,e.theta)&&bt(this.phi,e.phi)}},{key:"exactEquals",value:function(e){return this.radius===e.radius&&this.theta===e.theta&&this.phi===e.phi}},{key:"bearing",get:function(){return 180-Gr(this.phi)},set:function(e){this.phi=Math.PI-hi(e)}},{key:"pitch",get:function(){return Gr(this.theta)},set:function(e){this.theta=hi(e)}},{key:"longitude",get:function(){return Gr(this.phi)}},{key:"latitude",get:function(){return Gr(this.theta)}},{key:"lng",get:function(){return Gr(this.phi)}},{key:"lat",get:function(){return Gr(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}},{key:"set",value:function(e,n,i){return this.radius=e,this.phi=n,this.theta=i,this.check()}},{key:"clone",value:function(){return new t().copy(this)}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this.check()}},{key:"fromLngLatZ",value:function(e){var n=Z(e,3),i=n[0],a=n[1],o=n[2];return this.radius=1+o/this.radiusScale,this.phi=hi(a),this.theta=hi(i),this.check()}},{key:"fromVector3",value:function(e){return this.radius=Qd(e),this.radius>0&&(this.theta=Math.atan2(e[0],e[1]),this.phi=Math.acos(Te(e[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new We(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){return this.phi=Math.max(bv,Math.min(Math.PI-bv,this.phi)),this}},{key:"check",value:function(){if(!Number.isFinite(this.phi)||!Number.isFinite(this.theta)||!(this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}]),t}();var wl=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`;function mE(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=gE(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function gE(t,r){if(t){if(typeof t=="string")return wv(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return wv(t,r)}}function wv(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var yE={lightSources:{}};function xl(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.color,e=r===void 0?[0,0,0]:r,n=t.intensity,i=n===void 0?1:n;return e.map(function(a){return a*i/255})}function _E(t){var r=t.ambientLight,e=t.pointLights,n=e===void 0?[]:e,i=t.directionalLights,a=i===void 0?[]:i,o={};return r?o["lighting_uAmbientLight.color"]=xl(r):o["lighting_uAmbientLight.color"]=[0,0,0],n.forEach(function(s,u){o["lighting_uPointLight[".concat(u,"].color")]=xl(s),o["lighting_uPointLight[".concat(u,"].position")]=s.position,o["lighting_uPointLight[".concat(u,"].attenuation")]=s.attenuation||[1,0,0]}),o.lighting_uPointLightCount=n.length,a.forEach(function(s,u){o["lighting_uDirectionalLight[".concat(u,"].color")]=xl(s),o["lighting_uDirectionalLight[".concat(u,"].direction")]=s.direction}),o.lighting_uDirectionalLightCount=a.length,o}function xv(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:yE;if("lightSources"in t){var r=t.lightSources||{},e=r.ambientLight,n=r.pointLights,i=r.directionalLights,a=e||n&&n.length>0||i&&i.length>0;return a?Object.assign({},_E({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){var o={pointLights:[],directionalLights:[]},s=mE(t.lights||[]),u;try{for(s.s();!(u=s.n()).done;){var f=u.value;switch(f.type){case"ambient":o.ambientLight=f;break;case"directional":o.directionalLights.push(f);break;case"point":o.pointLights.push(f);break;default:}}}catch(c){s.e(c)}finally{s.f()}return xv({lightSources:o})}return{}}var Tl={name:"lights",vs:wl,fs:wl,getUniforms:xv,defines:{MAX_LIGHTS:3}};var bE=new Uint8Array([0,255,255,255]),wE={pickingSelectedColor:null,pickingHighlightColor:bE,pickingActive:!1,pickingAttribute:!1};function xE(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:wE,r={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)r.picking_uSelectedColorValid=0;else{var e=t.pickingSelectedColor.slice(0,3);r.picking_uSelectedColorValid=1,r.picking_uSelectedColor=e}if(t.pickingHighlightColor){var n=Array.from(t.pickingHighlightColor,function(i){return i/255});Number.isFinite(n[3])||(n[3]=1),r.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(r.picking_uActive=Boolean(t.pickingActive),r.picking_uAttribute=Boolean(t.pickingAttribute)),r}var TE=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,EE=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,ys={name:"picking",vs:TE,fs:EE,getUniforms:xE};var El=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`;var PE={};function SE(t){var r=t.ambient,e=r===void 0?.35:r,n=t.diffuse,i=n===void 0?.6:n,a=t.shininess,o=a===void 0?32:a,s=t.specularColor,u=s===void 0?[30,30,30]:s;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:o,lighting_uSpecularColor:u.map(function(f){return f/255})}}function Tv(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:PE;if(!("material"in t))return{};var r=t.material;return r?SE(r):{lighting_uEnabled:!1}}var wa={name:"gouraud-lighting",dependencies:[Tl],vs:El,defines:{LIGHTING_VERTEX:1},getUniforms:Tv},xa={name:"phong-lighting",dependencies:[Tl],fs:El,defines:{LIGHTING_FRAGMENT:1},getUniforms:Tv};var AE=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,Pl={name:"transform",vs:AE,fs:null};function Ev(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=OE(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function OE(t,r){if(t){if(typeof t=="string")return Pv(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Pv(t,r)}}function Pv(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var tr=function(){function t(r){T(this,t),this.gl=r,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}return S(t,[{key:"addDefaultModule",value:function(e){this._defaultModules.find(function(n){return n.name===e.name})||this._defaultModules.push(e),this.stateHash++}},{key:"removeDefaultModule",value:function(e){var n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(function(i){return i.name!==n}),this.stateHash++}},{key:"addShaderHook",value:function(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}},{key:"get",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.vs,a=i===void 0?"":i,o=n.fs,s=o===void 0?"":o,u=n.defines,f=u===void 0?{}:u,c=n.inject,h=c===void 0?{}:c,p=n.varyings,d=p===void 0?[]:p,v=n.bufferMode,m=v===void 0?35981:v,g=n.transpileToGLSL100,_=g===void 0?!1:g,w=this._getModuleList(n.modules),x=this._getHash(a),P=this._getHash(s),E=w.map(function($){return e._getHash($.name)}).sort(),A=d.map(function($){return e._getHash($)}),R=Object.keys(f).sort(),D=Object.keys(h).sort(),j=[],I=[],V=Ev(R),F;try{for(V.s();!(F=V.n()).done;){var G=F.value;j.push(this._getHash(G)),j.push(this._getHash(f[G]))}}catch($){V.e($)}finally{V.f()}var B=Ev(D),K;try{for(B.s();!(K=B.n()).done;){var C=K.value;I.push(this._getHash(C)),I.push(this._getHash(h[C]))}}catch($){B.e($)}finally{B.f()}var k="".concat(x,"/").concat(P,"D").concat(j.join("/"),"M").concat(E.join("/"),"I").concat(I.join("/"),"V").concat(A.join("/"),"H").concat(this.stateHash,"B").concat(m).concat(_?"T":"");if(!this._programCache[k]){var U=cl(this.gl,{vs:a,fs:s,modules:w,inject:h,defines:f,hookFunctions:this._hookFunctions,transpileToGLSL100:_});this._programCache[k]=new Vr(this.gl,{hash:k,vs:U.vs,fs:U.fs,varyings:d,bufferMode:m}),this._getUniforms[k]=U.getUniforms||function($){},this._useCounts[k]=0}return this._useCounts[k]++,this._programCache[k]}},{key:"getUniforms",value:function(e){return this._getUniforms[e.hash]||null}},{key:"release",value:function(e){var n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}},{key:"_getHash",value:function(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}},{key:"_getModuleList",value:function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=new Array(this._defaultModules.length+e.length),i={},a=0,o=0,s=this._defaultModules.length;o<s;++o){var u=this._defaultModules[o],f=u.name;n[a++]=u,i[f]=!0}for(var c=0,h=e.length;c<h;++c){var p=e[c],d=p.name;i[d]||(n[a++]=p,i[d]=!0)}return n.length=a,n}}],[{key:"getDefaultProgramManager",value:function(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new t(e),e.luma.defaultProgramManager}}]),t}();function Sv(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ME(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Sv(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Sv(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var kE={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Av(t,r,e){var n={},i=r.indices;for(var a in r.attributes){var o=r.attributes[a],s=RE(a,e);if(a==="indices")i=o;else if(o.constant)n[s]=o.value;else{var u=o.value,f=ME({},o);delete f.value,n[s]=[new fe(t,u),f],CE(a,f)}}if(i){var c=i.value||i;H(c instanceof Uint16Array||c instanceof Uint32Array,'attribute array for "indices" must be of integer type');var h={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};n.indices=[new fe(t,{data:c,target:34963}),h]}return n}function RE(t,r){var e=r||{},n=e.attributeMap,i=n===void 0?kE:n;return i&&i[t]||t}function CE(t,r){var e;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":e="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":e="vectors";break;default:}switch(e){case"vectors":r.size=r.size||3;break;case"uvs":r.size=r.size||2;break;default:}H(Number.isFinite(r.size),"attribute ".concat(t," needs size"))}var di=2,IE=1e4,LE="Model needs drawMode and vertexCount",Ov=function(){},DE={},$r=function(){function t(r){T(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.id,i=n===void 0?Pe("model"):n;H(mr(r)),this.id=i,this.gl=r,this.id=e.id||Pe("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}return S(t,[{key:"initialize",value:function(e){this.props={},this.programManager=e.programManager||tr.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;var n=e.program,i=n===void 0?null:n,a=e.vs,o=e.fs,s=e.modules,u=e.defines,f=e.inject,c=e.varyings,h=e.bufferMode,p=e.transpileToGLSL100;this.programProps={program:i,vs:a,fs:o,modules:s,defines:u,inject:f,varyings:c,bufferMode:h,transpileToGLSL100:p},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},H(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),LE)}},{key:"setProps",value:function(e){this._setModelProps(e)}},{key:"delete",value:function(){for(var e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}},{key:"getDrawMode",value:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getInstanceCount",value:function(){return this.instanceCount}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getProgram",value:function(){return this.program}},{key:"setProgram",value:function(e){var n=e.program,i=e.vs,a=e.fs,o=e.modules,s=e.defines,u=e.inject,f=e.varyings,c=e.bufferMode,h=e.transpileToGLSL100;this.programProps={program:n,vs:i,fs:a,modules:o,defines:s,inject:u,varyings:f,bufferMode:c,transpileToGLSL100:h},this._programDirty=!0}},{key:"getUniforms",value:function(){return this.uniforms}},{key:"setDrawMode",value:function(e){return this.drawMode=e,this}},{key:"setVertexCount",value:function(e){return H(Number.isFinite(e)),this.vertexCount=e,this}},{key:"setInstanceCount",value:function(e){return H(Number.isFinite(e)),this.instanceCount=e,this}},{key:"setGeometry",value:function(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=Av(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}},{key:"setAttributes",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Kt(e))return this;var n={};for(var i in e){var a=e[i];n[i]=a.getValue?a.getValue():a}return this.vertexArray.setAttributes(n),this}},{key:"setUniforms",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}},{key:"getModuleUniforms",value:function(e){this._checkProgram();var n=this.programManager.getUniforms(this.program);return n?n(e):{}}},{key:"updateModuleSettings",value:function(e){var n=this.getModuleUniforms(e||{});return this.setUniforms(n)}},{key:"clear",value:function(e){return Jt(this.program.gl,e),this}},{key:"draw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();var n=e.moduleSettings,i=n===void 0?null:n,a=e.framebuffer,o=e.uniforms,s=o===void 0?{}:o,u=e.attributes,f=u===void 0?{}:u,c=e.transformFeedback,h=c===void 0?this.transformFeedback:c,p=e.parameters,d=p===void 0?{}:p,v=e.vertexArray,m=v===void 0?this.vertexArray:v;this.setAttributes(f),this.updateModuleSettings(i),this.setUniforms(s);var g;Q.priority>=di&&(g=this._logDrawCallStart(di));var _=this.vertexArray.getDrawParams(),w=this.props,x=w.isIndexed,P=x===void 0?_.isIndexed:x,E=w.indexType,A=E===void 0?_.indexType:E,R=w.indexOffset,D=R===void 0?_.indexOffset:R,j=w.vertexArrayInstanced,I=j===void 0?_.isInstanced:j;I&&!this.isInstanced&&Q.warn("Found instanced attributes on non-instanced model",this.id)();var V=this.isInstanced,F=this.instanceCount,G=this.props,B=G.onBeforeRender,K=B===void 0?Ov:B,C=G.onAfterRender,k=C===void 0?Ov:C;K(),this.program.setUniforms(this.uniforms);var U=this.program.draw(Object.assign(DE,e,{logPriority:g,uniforms:null,framebuffer:a,parameters:d,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:m,transformFeedback:h,isIndexed:P,indexType:A,isInstanced:V,instanceCount:F,offset:P?D:0}));return k(),Q.priority>=di&&this._logDrawCallEnd(g,m,a),U}},{key:"transform",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.discard,i=n===void 0?!0:n,a=e.feedbackBuffers,o=e.unbindModels,s=o===void 0?[]:o,u=e.parameters;a&&this._setFeedbackBuffers(a),i&&(u=Object.assign({},u,l({},35977,i))),s.forEach(function(f){return f.vertexArray.unbindBuffers()});try{this.draw(Object.assign({},e,{parameters:u}))}finally{s.forEach(function(f){return f.vertexArray.bindBuffers()})}return this}},{key:"render",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Q.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}},{key:"_setModelProps",value:function(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}},{key:"_checkProgram",value:function(){var e=this._programDirty||this.programManager.stateHash!==this._programManagerState;if(e){var n=this.programProps.program;if(n)this._managedProgram=!1;else{var i=this.programProps,a=i.vs,o=i.fs,s=i.modules,u=i.inject,f=i.defines,c=i.varyings,h=i.bufferMode,p=i.transpileToGLSL100;n=this.programManager.get({vs:a,fs:o,modules:s,inject:u,defines:f,varyings:c,bufferMode:h,transpileToGLSL100:p}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}H(n instanceof Vr,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new qf(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}}},{key:"_deleteGeometryBuffers",value:function(){for(var e in this.geometryBuffers){var n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof fe&&n.delete()}}},{key:"_setAnimationProps",value:function(e){this.animated&&H(e,"Model.draw(): animated uniforms but no animationProps")}},{key:"_setFeedbackBuffers",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Kt(e))return this;var n=this.program.gl;return this.transformFeedback=this.transformFeedback||new zr(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}},{key:"_logDrawCallStart",value:function(e){var n=e>3?0:IE;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),Q.group(di,">>> DRAWING MODEL ".concat(this.id),{collapsed:Q.level<=2})(),e}},{key:"_logDrawCallEnd",value:function(e,n,i,a){if(e!==void 0){var o=Qf({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),s=Yo({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),u=s.table,f=s.unusedTable,c=s.unusedCount,h=Yo({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0}),p=h.table,d=h.count;d>0&&Q.log("MISSING UNIFORMS",Object.keys(p))(),c>0&&Q.log("UNUSED UNIFORMS",Object.keys(f))();var v=Jf(this.vertexArray.configuration);Q.table(e,o)(),Q.table(e,u)(),Q.table(e+1,v)(),a&&a.log({logLevel:di,message:"Rendered to ".concat(a.id)}),Q.groupEnd(di)()}}}]),t}();function jE(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=FE(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function FE(t,r){if(t){if(typeof t=="string")return Mv(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Mv(t,r)}}function Mv(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var kv=function(){function t(r){T(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}return S(t,[{key:"setupResources",value:function(e){var n=jE(this.bindings),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;this._setupTransformFeedback(a,e)}}catch(o){n.e(o)}finally{n.f()}}},{key:"updateModelProps",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.varyings;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}},{key:"getDrawOptions",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.bindings[this.currentIndex],i=n.sourceBuffers,a=n.transformFeedback,o=Object.assign({},i,e.attributes);return{attributes:o,transformFeedback:a}}},{key:"swap",value:function(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}},{key:"getBuffer",value:function(e){var n=this.bindings[this.currentIndex].feedbackBuffers,i=e?n[e]:null;return i?i instanceof fe?i:i.buffer:null}},{key:"getData",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.varyingName,i=this.getBuffer(n);return i?i.getData():null}},{key:"delete",value:function(){for(var e in this.resources)this.resources[e].delete()}},{key:"_initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&H(ie(this.gl))}},{key:"_getFeedbackBuffers",value:function(e){var n=e.sourceBuffers,i=n===void 0?{}:n,a={};if(this.bindings[this.currentIndex]&&Object.assign(a,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(var o in this.feedbackMap){var s=this.feedbackMap[o];o in i&&(a[s]=o)}Object.assign(a,e.feedbackBuffers);for(var u in a){var f=a[u];if(typeof f=="string"){var c=i[f],h=c.byteLength,p=c.usage,d=c.accessor;a[u]=this._createNewBuffer(u,{byteLength:h,usage:p,accessor:d})}}return a}},{key:"_setupBuffers",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.sourceBuffers,i=n===void 0?null:n;Object.assign(this.feedbackMap,e.feedbackMap);var a=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:i,feedbackBuffers:a})}},{key:"_setupTransformFeedback",value:function(e,n){var i=n.model,a=i.program;e.transformFeedback=new zr(this.gl,{program:a,buffers:e.feedbackBuffers})}},{key:"_updateBindings",value:function(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){var n=this._swapBuffers(this.bindings[this.currentIndex]),i=n.sourceBuffers,a=n.feedbackBuffers,o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceBuffers:i,feedbackBuffers:a})}}},{key:"_updateBinding",value:function(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}},{key:"_swapBuffers",value:function(e){if(!this.feedbackMap)return null;var n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(var a in this.feedbackMap){var o=this.feedbackMap[a];n[a]=e.feedbackBuffers[o],i[o]=e.sourceBuffers[a],H(i[o]instanceof fe)}return{sourceBuffers:n,feedbackBuffers:i}}},{key:"_createNewBuffer",value:function(e,n){var i=new fe(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}}]),t}();var NE="transform_uSampler_",_s="transform_uSize_",Rv="transform_position";function Cv(t){var r=t.vs,e=t.sourceTextureMap,n=t.targetTextureVarying,i=t.targetTexture,a=Object.keys(e),o=a.length,s=null,u={},f=r,c={};if(o>0||n){var h=f.split(`
`),p=h.slice();if(h.forEach(function(_,w,x){if(o>0){var P=UE(_,e);if(P){var E=P.updatedLine,A=P.inject;p[w]=E,c=li([c,A]),Object.assign(u,P.samplerTextureMap),o--}}n&&!s&&(s=zE(_,n))}),n){H(i);var d="".concat(_s).concat(n),v="uniform vec2 ".concat(d,`;
`),m="     vec2 ".concat(Rv," = transform_getPos(").concat(d,`);
     gl_Position = vec4(`).concat(Rv,`, 0, 1.);
`),g={"vs:#decl":v,"vs:#main-start":m};c=li([c,g])}f=p.join(`
`)}return{vs:f,targetTextureType:s,inject:c,samplerTextureMap:u}}function Iv(t){var r=t.sourceTextureMap,e=t.targetTextureVarying,n=t.targetTexture,i={},a,o;e&&(a=n.width,o=n.height,i["".concat(_s).concat(e)]=[a,o]);for(var s in r){var u=r[s];a=u.width,o=u.height,i["".concat(_s).concat(s)]=[a,o]}return i}function BE(t){return ts(t,["attribute","in"])}function VE(t){var r="".concat(NE).concat(t),e="".concat(_s).concat(t),n="  uniform sampler2D ".concat(r,`;
  uniform vec2 `).concat(e,";");return{samplerName:r,sizeName:e,uniformDeclerations:n}}function zE(t,r){var e=ts(t,["varying","out"]);return e&&e.name===r?e.type:null}function UE(t,r){var e={},n=BE(t);if(!n)return null;var i=n.type,a=n.name;if(a&&r[a]){var o="// ".concat(t," => Replaced by Transform with a sampler"),s=VE(a),u=s.samplerName,f=s.sizeName,c=s.uniformDeclerations,h=hl(i),p="  ".concat(i," ").concat(a," = transform_getInput(").concat(u,", ").concat(f,").").concat(h,`;
`);e[u]=a;var d={"vs:#decl":c,"vs:#main-start":p};return{updatedLine:o,inject:d,samplerTextureMap:e}}return null}var vi,GE=(vi={},l(vi,10241,9728),l(vi,10240,9728),l(vi,10242,33071),l(vi,10243,33071),vi),$E="transform_output",Lv=function(){function t(r){T(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}return S(t,[{key:"updateModelProps",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this._processVertexShader(e);return Object.assign({},e,n)}},{key:"getDrawOptions",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.bindings[this.currentIndex],i=n.sourceBuffers,a=n.sourceTextures,o=n.framebuffer,s=n.targetTexture,u=Object.assign({},i,e.attributes),f=Object.assign({},e.uniforms),c=Object.assign({},e.parameters),h=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){u.transform_elementID=this.elementIDBuffer;for(var p in this.samplerTextureMap){var d=this.samplerTextureMap[p];f[p]=a[d]}this._setSourceTextureParameters();var v=Iv({sourceTextureMap:a,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(f,v)}return this.hasTargetTexture&&(h=!1,c.viewport=[0,0,o.width,o.height]),{attributes:u,framebuffer:o,uniforms:f,discard:h,parameters:c}}},{key:"swap",value:function(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}},{key:"getTargetTexture",value:function(){var e=this.bindings[this.currentIndex].targetTexture;return e}},{key:"getData",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.packed,i=n===void 0?!1:n,a=this.bindings[this.currentIndex].framebuffer,o=_r(a);if(!i)return o;for(var s=o.constructor,u=pl(this.targetTextureType),f=new s(o.length*u/4),c=0,h=0;h<o.length;h+=4)for(var p=0;p<u;p++)f[c++]=o[h+p];return f}},{key:"getFramebuffer",value:function(){var e=this.bindings[this.currentIndex];return e.framebuffer}},{key:"delete",value:function(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}},{key:"_initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e._targetTextureVarying,i=e._swapTexture;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}},{key:"_createTargetTexture",value:function(e){var n=e.sourceTextures,i=e.textureOrReference;if(i instanceof Le)return i;var a=n[i];return a?(this._targetRefTexName=i,this._createNewTexture(a)):null}},{key:"_setupTextures",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.sourceBuffers,i=e._sourceTextures,a=i===void 0?{}:i,o=e._targetTexture,s=this._createTargetTexture({sourceTextures:a,textureOrReference:o});this.hasSourceTextures=this.hasSourceTextures||a&&Object.keys(a).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:a,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}},{key:"_updateElementIDBuffer",value:function(e){if(!(typeof e!="number"||this.elementCount>=e)){var n=new Float32Array(e);n.forEach(function(i,a,o){o[a]=a}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new fe(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}}},{key:"_updateBindings",value:function(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){var n=this._swapTextures(this.bindings[this.currentIndex]),i=n.sourceTextures,a=n.targetTexture,o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceTextures:i,targetTexture:a})}}},{key:"_updateBinding",value:function(e,n){var i=n.sourceBuffers,a=n.sourceTextures,o=n.targetTexture;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,a),Object.assign(e.sourceBuffers,i),o){e.targetTexture=o;var s=o.width,u=o.height,f=e,c=f.framebuffer;c?(c.update({attachments:l({},36064,o),resizeAttachments:!1}),c.resize({width:s,height:u})):e.framebuffer=new xe(this.gl,{id:"transform-framebuffer",width:s,height:u,attachments:l({},36064,o)})}return e}},{key:"_setSourceTextureParameters",value:function(){var e=this.currentIndex,n=this.bindings[e].sourceTextures;for(var i in n)n[i].setParameters(GE)}},{key:"_swapTextures",value:function(e){if(!this._swapTexture)return null;var n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;var i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}},{key:"_createNewTexture",value:function(e){var n,i=ui(e,{parameters:(n={},l(n,10241,9728),l(n,10240,9728),l(n,10242,33071),l(n,10243,33071),n),pixelStore:l({},37440,!1)});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=i,i}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}},{key:"_processVertexShader",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.bindings[this.currentIndex],i=n.sourceTextures,a=n.targetTexture,o=Cv({vs:e.vs,sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:a}),s=o.vs,u=o.uniforms,f=o.targetTextureType,c=o.inject,h=o.samplerTextureMap,p=li([e.inject||{},c]);this.targetTextureType=f,this.samplerTextureMap=h;var d=e._fs||va({version:fi(s),input:this.targetTextureVarying,inputType:f,output:$E}),v=this.hasSourceTextures||this.targetTextureVarying?[Pl].concat(e.modules||[]):e.modules;return{vs:s,fs:d,modules:v,uniforms:u,inject:p}}}]),t}();function Ta(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=HE(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function HE(t,r){if(t){if(typeof t=="string")return Dv(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Dv(t,r)}}function Dv(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var rr=function(){function t(r){T(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}return S(t,[{key:"delete",value:function(){var e=this.model,n=this.bufferTransform,i=this.textureTransform;e&&e.delete(),n&&n.delete(),i&&i.delete()}},{key:"run",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.clearRenderTarget,i=n===void 0?!0:n,a=this._updateDrawOptions(e);i&&a.framebuffer&&a.framebuffer.clear({color:!0}),this.model.transform(a)}},{key:"swap",value:function(){var e=!1,n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=Ta(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;e=e||o.swap()}}catch(s){i.e(s)}finally{i.f()}H(e,"Nothing to swap")}},{key:"getBuffer",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}},{key:"getData",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=Ta(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.getData(e);if(s)return s}}catch(u){i.e(u)}finally{i.f()}return null}},{key:"getFramebuffer",value:function(){return this.textureTransform&&this.textureTransform.getFramebuffer()}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);var n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=Ta(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.update(e)}}catch(s){i.e(s)}finally{i.f()}}},{key:"_initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.gl;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new $r(n,Object.assign({},e,{fs:e.fs||va({version:fi(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}},{key:"_updateModelProps",value:function(e){var n=Object.assign({},e),i=[this.bufferTransform,this.textureTransform].filter(Boolean),a=Ta(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n=s.updateModelProps(n)}}catch(u){a.e(u)}finally{a.f()}return n}},{key:"_buildResourceTransforms",value:function(e,n){WE(n)&&(this.bufferTransform=new kv(e,n)),YE(n)&&(this.textureTransform=new Lv(e,n)),H(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}},{key:"_updateDrawOptions",value:function(e){var n=Object.assign({},e),i=[this.bufferTransform,this.textureTransform].filter(Boolean),a=Ta(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n=Object.assign(n,s.getDrawOptions(n))}}catch(u){a.e(u)}finally{a.f()}return n}}],[{key:"isSupported",value:function(e){return ie(e)}}]),t}();function WE(t){return!!(!Kt(t.feedbackBuffers)||!Kt(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function YE(t){return!!(!Kt(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}function jv(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function XE(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?jv(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):jv(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Fv={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ot=function(){function t(){T(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.id,n=e===void 0?Pe("geometry"):e,i=r.drawMode,a=i===void 0?Fv.TRIANGLES:i,o=r.attributes,s=o===void 0?{}:o,u=r.indices,f=u===void 0?null:u,c=r.vertexCount,h=c===void 0?null:c;this.id=n,this.drawMode=a|0,this.attributes={},this.userData={},this._setAttributes(s,f),this.vertexCount=h||this._calculateVertexCount(this.attributes,this.indices)}return S(t,[{key:"mode",get:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getAttributes",value:function(){return this.indices?XE({indices:this.indices},this.attributes):this.attributes}},{key:"_print",value:function(e){return"Geometry ".concat(this.id," attribute ").concat(e)}},{key:"_setAttributes",value:function(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(var i in e){var a=e[i];a=ArrayBuffer.isView(a)?{value:a}:a,H(ArrayBuffer.isView(a.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!a.size&&(a.size=3),i==="indices"?(H(!this.indices),this.indices=a):this.attributes[i]=a}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}},{key:"_calculateVertexCount",value:function(e,n){if(n)return n.value.length;var i=1/0;for(var a in e){var o=e[a],s=o.value,u=o.size,f=o.constant;!f&&s&&u>=1&&(i=Math.min(i,s.length/u))}return H(Number.isFinite(i)),i}}],[{key:"DRAW_MODE",get:function(){return Fv}}]),t}();function Nv(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function bs(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Nv(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Nv(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function qE(t){var r=ZE();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function ZE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var KE={x:[2,0,1],y:[0,1,2],z:[1,2,0]},Hr=function(t){N(e,t);var r=qE(e);function e(){T(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Pe("truncated-code-geometry"):i,o=QE(n),s=o.indices,u=o.attributes;return r.call(this,bs(bs({},n),{},{id:a,indices:s,attributes:bs(bs({},u),n.attributes)}))}return e}(ot);function QE(t){for(var r=t.bottomRadius,e=r===void 0?0:r,n=t.topRadius,i=n===void 0?0:n,a=t.height,o=a===void 0?1:a,s=t.nradial,u=s===void 0?10:s,f=t.nvertical,c=f===void 0?10:f,h=t.verticalAxis,p=h===void 0?"y":h,d=t.topCap,v=d===void 0?!1:d,m=t.bottomCap,g=m===void 0?!1:m,_=(v?2:0)+(g?2:0),w=(u+1)*(c+1+_),x=Math.atan2(e-i,o),P=Math.sin,E=Math.cos,A=Math.PI,R=E(x),D=P(x),j=v?-2:0,I=c+(g?2:0),V=u+1,F=new Uint16Array(u*(c+_)*6),G=KE[p],B=new Float32Array(w*3),K=new Float32Array(w*3),C=new Float32Array(w*2),k=0,U=0,$=j;$<=I;$++){var q=$/c,J=o*q,re=void 0;$<0?(J=0,q=1,re=e):$>c?(J=o,q=1,re=i):re=e+(i-e)*($/c),($===-2||$===c+2)&&(re=0,q=0),J-=o/2;for(var ae=0;ae<V;ae++){var le=P(ae*A*2/u),ge=E(ae*A*2/u);B[k+G[0]]=le*re,B[k+G[1]]=J,B[k+G[2]]=ge*re,K[k+G[0]]=$<0||$>c?0:le*R,K[k+G[1]]=$<0?-1:$>c?1:D,K[k+G[2]]=$<0||$>c?0:ge*R,C[U+0]=ae/u,C[U+1]=q,U+=2,k+=3}}for(var oe=0;oe<c+_;oe++)for(var ye=0;ye<u;ye++){var se=(oe*u+ye)*6;F[se+0]=V*(oe+0)+0+ye,F[se+1]=V*(oe+0)+1+ye,F[se+2]=V*(oe+1)+1+ye,F[se+3]=V*(oe+0)+0+ye,F[se+4]=V*(oe+1)+1+ye,F[se+5]=V*(oe+1)+0+ye}return{indices:F,attributes:{POSITION:{size:3,value:B},NORMAL:{size:3,value:K},TEXCOORD_0:{size:2,value:C}}}}function Bv(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Vv(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Bv(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Bv(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function JE(t){var r=eP();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function eP(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ws=function(t){N(e,t);var r=JE(e);function e(){T(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Pe("cone-geometry"):i,o=n.radius,s=o===void 0?1:o,u=n.cap,f=u===void 0?!0:u;return r.call(this,Vv(Vv({},n),{},{id:a,topRadius:0,topCap:Boolean(f),bottomCap:Boolean(f),bottomRadius:s}))}return e}(Hr);function zv(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function xs(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?zv(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):zv(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function tP(t){var r=rP();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function rP(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var nP=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),iP=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),aP=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),oP=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),sP={POSITION:{size:3,value:new Float32Array(iP)},NORMAL:{size:3,value:new Float32Array(aP)},TEXCOORD_0:{size:2,value:new Float32Array(oP)}},Ts=function(t){N(e,t);var r=tP(e);function e(){T(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Pe("cube-geometry"):i;return r.call(this,xs(xs({},n),{},{id:a,indices:{size:1,value:new Uint16Array(nP)},attributes:xs(xs({},sP),n.attributes)}))}return e}(ot);function Uv(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Gv(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Uv(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Uv(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function uP(t){var r=fP();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function fP(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Es=function(t){N(e,t);var r=uP(e);function e(){T(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Pe("cylinder-geometry"):i,o=n.radius,s=o===void 0?1:o;return r.call(this,Gv(Gv({},n),{},{id:a,bottomRadius:s,topRadius:s}))}return e}(Hr);function $v(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ps(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?$v(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):$v(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function lP(t){var r=cP();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function cP(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hP=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],pP=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1],Ss=function(t){N(e,t);var r=lP(e);function e(){T(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Pe("ico-sphere-geometry"):i,o=dP(n),s=o.indices,u=o.attributes;return r.call(this,Ps(Ps({},n),{},{id:a,indices:s,attributes:Ps(Ps({},u),n.attributes)}))}return e}(ot);function dP(t){var r=t.iterations,e=r===void 0?0:r,n=Math.PI,i=n*2,a=[].concat(hP),o=[].concat(pP);a.push(),o.push();for(var s=function(){var jt={};return function(Ft,Nt){Ft*=3,Nt*=3;var Yn=Ft<Nt?Ft:Nt,ht=Ft>Nt?Ft:Nt,Yi="".concat(Yn,"|").concat(ht);if(Yi in jt)return jt[Yi];var Qu=a[Ft],Ju=a[Ft+1],ef=a[Ft+2],tf=a[Nt],co=a[Nt+1],ho=a[Nt+2],on=(Qu+tf)/2,sn=(Ju+co)/2,hr=(ef+ho)/2,un=Math.sqrt(on*on+sn*sn+hr*hr);return on/=un,sn/=un,hr/=un,a.push(on,sn,hr),jt[Yi]=a.length/3-1}}(),u=0;u<e;u++){for(var f=[],c=0;c<o.length;c+=3){var h=s(o[c+0],o[c+1]),p=s(o[c+1],o[c+2]),d=s(o[c+2],o[c+0]);f.push(d,o[c+0],h,h,o[c+1],p,p,o[c+2],d,h,p,d)}o=f}for(var v=new Array(a.length),m=new Array(a.length/3*2),g=o.length,_=g-3;_>=0;_-=3){var w=o[_+0],x=o[_+1],P=o[_+2],E=w*3,A=x*3,R=P*3,D=w*2,j=x*2,I=P*2,V=a[E+0],F=a[E+1],G=a[E+2],B=Math.acos(G/Math.sqrt(V*V+F*F+G*G)),K=Math.atan2(F,V)+n,C=B/n,k=1-K/i,U=a[A+0],$=a[A+1],q=a[A+2],J=Math.acos(q/Math.sqrt(U*U+$*$+q*q)),re=Math.atan2($,U)+n,ae=J/n,le=1-re/i,ge=a[R+0],oe=a[R+1],ye=a[R+2],se=Math.acos(ye/Math.sqrt(ge*ge+oe*oe+ye*ye)),Fe=Math.atan2(oe,ge)+n,Rr=se/n,Yt=1-Fe/i,nn=[ge-U,oe-$,ye-q],an=[V-U,F-$,G-q],Ke=new We(nn).cross(an).normalize(),we=void 0;(k===0||le===0||Yt===0)&&(k===0||k>.5)&&(le===0||le>.5)&&(Yt===0||Yt>.5)&&(a.push(a[E+0],a[E+1],a[E+2]),we=a.length/3-1,o.push(we),m[we*2+0]=1,m[we*2+1]=C,v[we*3+0]=Ke.x,v[we*3+1]=Ke.y,v[we*3+2]=Ke.z,a.push(a[A+0],a[A+1],a[A+2]),we=a.length/3-1,o.push(we),m[we*2+0]=1,m[we*2+1]=ae,v[we*3+0]=Ke.x,v[we*3+1]=Ke.y,v[we*3+2]=Ke.z,a.push(a[R+0],a[R+1],a[R+2]),we=a.length/3-1,o.push(we),m[we*2+0]=1,m[we*2+1]=Rr,v[we*3+0]=Ke.x,v[we*3+1]=Ke.y,v[we*3+2]=Ke.z),v[E+0]=v[A+0]=v[R+0]=Ke.x,v[E+1]=v[A+1]=v[R+1]=Ke.y,v[E+2]=v[A+2]=v[R+2]=Ke.z,m[D+0]=k,m[D+1]=C,m[j+0]=le,m[j+1]=ae,m[I+0]=Yt,m[I+1]=Rr}return{indices:{size:1,value:new Uint16Array(o)},attributes:{POSITION:{size:3,value:new Float32Array(a)},NORMAL:{size:3,value:new Float32Array(v)},TEXCOORD_0:{size:2,value:new Float32Array(m)}}}}function Hv(t){var r=t.indices,e=t.attributes;if(!r)return t;var n=r.value.length,i={};for(var a in e){var o=e[a],s=o.constant,u=o.value,f=o.size;if(!(s||!f)){for(var c=new u.constructor(n*f),h=0;h<n;++h)for(var p=r.value[h],d=0;d<f;d++)c[h*f+d]=u[p*f+d];i[a]={size:f,value:c}}}return{attributes:Object.assign({},e,i)}}function Wv(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function As(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Wv(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Wv(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function vP(t){var r=mP();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function mP(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Os=function(t){N(e,t);var r=vP(e);function e(){T(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Pe("plane-geometry"):i,o=gP(n),s=o.indices,u=o.attributes;return r.call(this,As(As({},n),{},{id:a,indices:s,attributes:As(As({},u),n.attributes)}))}return e}(ot);function gP(t){var r=t.type,e=r===void 0?"x,y":r,n=t.offset,i=n===void 0?0:n,a=t.flipCull,o=a===void 0?!1:a,s=t.unpack,u=s===void 0?!1:s,f=e.split(","),c=t["".concat(f[0],"len")]||1,h=t["".concat(f[1],"len")]||1,p=t["n".concat(f[0])]||1,d=t["n".concat(f[1])]||1,v=(p+1)*(d+1),m=new Float32Array(v*3),g=new Float32Array(v*3),_=new Float32Array(v*2);o&&(c=-c);for(var w=0,x=0,P=0;P<=d;P++)for(var E=0;E<=p;E++){var A=E/p,R=P/d;switch(_[w+0]=o?1-A:A,_[w+1]=R,e){case"x,y":m[x+0]=c*A-c*.5,m[x+1]=h*R-h*.5,m[x+2]=i,g[x+0]=0,g[x+1]=0,g[x+2]=o?1:-1;break;case"x,z":m[x+0]=c*A-c*.5,m[x+1]=i,m[x+2]=h*R-h*.5,g[x+0]=0,g[x+1]=o?1:-1,g[x+2]=0;break;case"y,z":m[x+0]=i,m[x+1]=c*A-c*.5,m[x+2]=h*R-h*.5,g[x+0]=o?1:-1,g[x+1]=0,g[x+2]=0;break;default:throw new Error("PlaneGeometry: unknown type")}w+=2,x+=3}for(var D=p+1,j=new Uint16Array(p*d*6),I=0;I<d;I++)for(var V=0;V<p;V++){var F=(I*p+V)*6;j[F+0]=(I+0)*D+V,j[F+1]=(I+1)*D+V,j[F+2]=(I+0)*D+V+1,j[F+3]=(I+1)*D+V,j[F+4]=(I+1)*D+V+1,j[F+5]=(I+0)*D+V+1}var G={indices:{size:1,value:j},attributes:{POSITION:{size:3,value:m},NORMAL:{size:3,value:g},TEXCOORD_0:{size:2,value:_}}};return u?Hv(G):G}function Yv(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ms(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Yv(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Yv(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function yP(t){var r=_P();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function _P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ks=function(t){N(e,t);var r=yP(e);function e(){T(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Pe("sphere-geometry"):i,o=bP(n),s=o.indices,u=o.attributes;return r.call(this,Ms(Ms({},n),{},{id:a,indices:s,attributes:Ms(Ms({},u),n.attributes)}))}return e}(ot);function bP(t){var r=t.nlat,e=r===void 0?10:r,n=t.nlong,i=n===void 0?10:n,a=t.radius,o=a===void 0?1:a,s=0,u=Math.PI,f=u-s,c=0,h=2*Math.PI,p=h-c,d=(e+1)*(i+1);if(typeof o=="number"){var v=o;o=function(oe,ye,se,Fe,Rr){return v}}for(var m=new Float32Array(d*3),g=new Float32Array(d*3),_=new Float32Array(d*2),w=d>65535?Uint32Array:Uint16Array,x=new w(e*i*6),P=0;P<=e;P++)for(var E=0;E<=i;E++){var A=E/i,R=P/e,D=E+P*(i+1),j=D*2,I=D*3,V=p*A,F=f*R,G=Math.sin(V),B=Math.cos(V),K=Math.sin(F),C=Math.cos(F),k=B*K,U=C,$=G*K,q=o(k,U,$,A,R);m[I+0]=q*k,m[I+1]=q*U,m[I+2]=q*$,g[I+0]=k,g[I+1]=U,g[I+2]=$,_[j+0]=A,_[j+1]=1-R}for(var J=i+1,re=0;re<i;re++)for(var ae=0;ae<e;ae++){var le=(re*e+ae)*6;x[le+0]=ae*J+re,x[le+1]=ae*J+re+1,x[le+2]=(ae+1)*J+re,x[le+3]=(ae+1)*J+re,x[le+4]=ae*J+re+1,x[le+5]=(ae+1)*J+re+1}return{indices:{size:1,value:x},attributes:{POSITION:{size:3,value:m},NORMAL:{size:3,value:g},TEXCOORD_0:{size:2,value:_}}}}function Sl(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=wP(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function wP(t,r){if(t){if(typeof t=="string")return Xv(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Xv(t,r)}}function Xv(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var xP=1,TP=1,Wr=function(){function t(){T(this,t),this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}return S(t,[{key:"addChannel",value:function(e){var n=e.delay,i=n===void 0?0:n,a=e.duration,o=a===void 0?Number.POSITIVE_INFINITY:a,s=e.rate,u=s===void 0?1:s,f=e.repeat,c=f===void 0?1:f,h=xP++,p={time:0,delay:i,duration:o,rate:u,repeat:c};return this._setChannelTime(p,this.time),this.channels.set(h,p),h}},{key:"removeChannel",value:function(e){this.channels.delete(e);var n=Sl(this.animations),i;try{for(n.s();!(i=n.n()).done;){var a=Z(i.value,2),o=a[0],s=a[1];s.channel===e&&this.detachAnimation(o)}}catch(u){n.e(u)}finally{n.f()}}},{key:"isFinished",value:function(e){var n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}},{key:"getTime",value:function(e){if(e===void 0)return this.time;var n=this.channels.get(e);return n===void 0?-1:n.time}},{key:"setTime",value:function(e){this.time=Math.max(0,e);var n=this.channels.values(),i=Sl(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;this._setChannelTime(o,this.time)}}catch(d){i.e(d)}finally{i.f()}var s=this.animations.values(),u=Sl(s),f;try{for(u.s();!(f=u.n()).done;){var c=f.value,h=c.animation,p=c.channel;h.setTime(this.getTime(p))}}catch(d){u.e(d)}finally{u.f()}}},{key:"play",value:function(){this.playing=!0}},{key:"pause",value:function(){this.playing=!1,this.lastEngineTime=-1}},{key:"reset",value:function(){this.setTime(0)}},{key:"attachAnimation",value:function(e,n){var i=TP++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}},{key:"detachAnimation",value:function(e){this.animations.delete(e)}},{key:"update",value:function(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}},{key:"_setChannelTime",value:function(e,n){var i=n-e.delay,a=e.duration*e.repeat;i>=a?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}]),t}();function EP(t){var r=PP();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function PP(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var SP=`attribute vec2 aClipSpacePosition;
attribute vec2 aTexCoord;
attribute vec2 aCoordinate;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main(void) {
  gl_Position = vec4(aClipSpacePosition, 0., 1.);
  position = aClipSpacePosition;
  coordinate = aCoordinate;
  uv = aTexCoord;
}
`,qv=[-1,-1,1,-1,-1,1,1,1],Rs=function(t){N(e,t);var r=EP(e);function e(n,i){var a;T(this,e);var o=qv.map(function(s){return s===-1?0:s});return a=r.call(this,n,Object.assign({},i,{vs:SP,geometry:new ot({drawMode:5,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(qv)},aTexCoord:{size:2,value:new Float32Array(o)},aCoordinate:{size:2,value:new Float32Array(o)}}})})),a.setVertexCount(4),a}return e}($r);var xc={};xo(xc,{fetchFile:()=>yi,load:()=>Xr,parse:()=>Rn,registerLoaders:()=>La});var Kl=Be(Ge());function Yr(t,r){if(!t)throw new Error(r||"loader assertion failed.")}var nr={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},AP=nr.self||nr.window||nr.global||{},OP=nr.window||nr.self||nr.global||{},MP=nr.global||nr.self||nr.window||{},kP=nr.document||{};var wn=Boolean((typeof process>"u"?"undefined":ne(process))!=="object"||String(process)!=="[object process]"||process.browser);var Zv=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),RP=Zv&&parseFloat(Zv[1])||0;var Kv="3.4.13";function st(t,r){if(!t)throw new Error(r||"loaders.gl assertion failed.")}var ir={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},P6=ir.self||ir.window||ir.global||{},S6=ir.window||ir.self||ir.global||{},A6=ir.global||ir.self||ir.window||{},O6=ir.document||{};var xn=(typeof process>"u"?"undefined":ne(process))!=="object"||String(process)!=="[object process]"||process.browser;var Jv=typeof window<"u"&&typeof window.orientation<"u",Qv=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),M6=Qv&&parseFloat(Qv[1])||0;var em=function(){function t(r,e){var n=this;T(this,t),l(this,"name",void 0),l(this,"workerThread",void 0),l(this,"isRunning",!0),l(this,"result",void 0),l(this,"_resolve",function(){}),l(this,"_reject",function(){}),this.name=r,this.workerThread=e,this.result=new Promise(function(i,a){n._resolve=i,n._reject=a})}return S(t,[{key:"postMessage",value:function(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}},{key:"done",value:function(e){st(this.isRunning),this.isRunning=!1,this._resolve(e)}},{key:"error",value:function(e){st(this.isRunning),this.isRunning=!1,this._reject(e)}}]),t}();var Cs=function(){function t(){T(this,t)}return S(t,[{key:"terminate",value:function(){}}]),t}();var Ol=new Map;function tm(t){st(t.source&&!t.url||!t.source&&t.url);var r=Ol.get(t.source||t.url);return r||(t.url&&(r=CP(t.url),Ol.set(t.url,r)),t.source&&(r=rm(t.source),Ol.set(t.source,r))),st(r),r}function CP(t){if(!t.startsWith("http"))return t;var r=IP(t);return rm(r)}function rm(t){var r=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(r)}function IP(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function Ml(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=arguments.length>2?arguments[2]:void 0,n=e||new Set;if(t){if(nm(t))n.add(t);else if(nm(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(r&&ne(t)==="object")for(var i in t)Ml(t[i],r,n)}}return e===void 0?Array.from(n):[]}function nm(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}var kl=function(){},Ea=function(){function t(r){T(this,t),l(this,"name",void 0),l(this,"source",void 0),l(this,"url",void 0),l(this,"terminated",!1),l(this,"worker",void 0),l(this,"onMessage",void 0),l(this,"onError",void 0),l(this,"_loadableURL","");var e=r.name,n=r.source,i=r.url;st(n||i),this.name=e,this.source=n,this.url=i,this.onMessage=kl,this.onError=function(a){return console.log(a)},this.worker=xn?this._createBrowserWorker():this._createNodeWorker()}return S(t,[{key:"destroy",value:function(){this.onMessage=kl,this.onError=kl,this.worker.terminate(),this.terminated=!0}},{key:"isRunning",get:function(){return Boolean(this.onMessage)}},{key:"postMessage",value:function(e,n){n=n||Ml(e),this.worker.postMessage(e,n)}},{key:"_getErrorFromErrorEvent",value:function(e){var n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}},{key:"_createBrowserWorker",value:function(){var e=this;this._loadableURL=tm({source:this.source,url:this.url});var n=new Worker(this._loadableURL,{name:this.name});return n.onmessage=function(i){i.data?e.onMessage(i.data):e.onError(new Error("No data received"))},n.onerror=function(i){e.onError(e._getErrorFromErrorEvent(i)),e.terminated=!0},n.onmessageerror=function(i){return console.error(i)},n}},{key:"_createNodeWorker",value:function(){var e=this,n;if(this.url){var i=this.url.includes(":/")||this.url.startsWith("/"),a=i?this.url:"./".concat(this.url);n=new Cs(a,{eval:!1})}else if(this.source)n=new Cs(this.source,{eval:!0});else throw new Error("no worker");return n.on("message",function(o){e.onMessage(o)}),n.on("error",function(o){e.onError(o)}),n.on("exit",function(o){}),n}}],[{key:"isSupported",value:function(){return typeof Worker<"u"&&xn||typeof Cs<"u"&&!xn}}]),t}();var Pa=Be(Ge());function im(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function am(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?im(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):im(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var om=function(){function t(r){T(this,t),l(this,"name","unnamed"),l(this,"source",void 0),l(this,"url",void 0),l(this,"maxConcurrency",1),l(this,"maxMobileConcurrency",1),l(this,"onDebug",function(){}),l(this,"reuseWorkers",!0),l(this,"props",{}),l(this,"jobQueue",[]),l(this,"idleQueue",[]),l(this,"count",0),l(this,"isDestroyed",!1),this.source=r.source,this.url=r.url,this.setProps(r)}return S(t,[{key:"destroy",value:function(){this.idleQueue.forEach(function(e){return e.destroy()}),this.isDestroyed=!0}},{key:"setProps",value:function(e){this.props=am(am({},this.props),e),e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}},{key:"startJob",value:function(){var r=de(Pa.default.mark(function n(i){var a=this,o,s,u,f=arguments;return Pa.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return o=f.length>1&&f[1]!==void 0?f[1]:function(p,d,v){return p.done(v)},s=f.length>2&&f[2]!==void 0?f[2]:function(p,d){return p.error(d)},u=new Promise(function(p){return a.jobQueue.push({name:i,onMessage:o,onError:s,onStart:p}),a}),this._startQueuedJob(),h.next=6,u;case 6:return h.abrupt("return",h.sent);case 7:case"end":return h.stop()}},n,this)}));function e(n){return r.apply(this,arguments)}return e}()},{key:"_startQueuedJob",value:function(){var r=de(Pa.default.mark(function n(){var i,a,o;return Pa.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.jobQueue.length){u.next=2;break}return u.abrupt("return");case 2:if(i=this._getAvailableWorker(),i){u.next=5;break}return u.abrupt("return");case 5:if(a=this.jobQueue.shift(),!a){u.next=18;break}return this.onDebug({message:"Starting job",name:a.name,workerThread:i,backlog:this.jobQueue.length}),o=new em(a.name,i),i.onMessage=function(f){return a.onMessage(o,f.type,f.payload)},i.onError=function(f){return a.onError(o,f)},a.onStart(o),u.prev=12,u.next=15,o.result;case 15:return u.prev=15,this.returnWorkerToQueue(i),u.finish(15);case 18:case"end":return u.stop()}},n,this,[[12,,15,18]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"returnWorkerToQueue",value:function(e){var n=this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency();n?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Ea({name:e,source:this.source,url:this.url})}return null}},{key:"_getMaxConcurrency",value:function(){return Jv?this.maxMobileConcurrency:this.maxConcurrency}}],[{key:"isSupported",value:function(){return Ea.isSupported()}}]),t}();function sm(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=LP(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function LP(t,r){if(t){if(typeof t=="string")return um(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return um(t,r)}}function um(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function fm(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Rl(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?fm(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):fm(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var DP={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:function(){}},Sa=function(){function t(r){T(this,t),l(this,"props",void 0),l(this,"workerPools",new Map),this.props=Rl({},DP),this.setProps(r),this.workerPools=new Map}return S(t,[{key:"destroy",value:function(){var e=sm(this.workerPools.values()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.destroy()}}catch(a){e.e(a)}finally{e.f()}this.workerPools=new Map}},{key:"setProps",value:function(e){this.props=Rl(Rl({},this.props),e);var n=sm(this.workerPools.values()),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.setProps(this._getWorkerPoolProps())}}catch(o){n.e(o)}finally{n.f()}}},{key:"getWorkerPool",value:function(e){var n=e.name,i=e.source,a=e.url,o=this.workerPools.get(n);return o||(o=new om({name:n,source:i,url:a}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,o)),o}},{key:"_getWorkerPoolProps",value:function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}],[{key:"isSupported",value:function(){return Ea.isSupported()}},{key:"getWorkerFarm",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t._workerFarm=t._workerFarm||new t({}),t._workerFarm.setProps(e),t._workerFarm}}]),t}();l(Sa,"_workerFarm",void 0);var jP="latest";function Cl(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r[t.id]||{},n="".concat(t.id,"-worker.js"),i=e.workerUrl;if(!i&&t.id==="compression"&&(i=r.workerUrl),r._workerType==="test"&&(i="modules/".concat(t.module,"/dist/").concat(n)),!i){var a=t.version;a==="latest"&&(a=jP);var o=a?"@".concat(a):"";i="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(n)}return st(i),i}function Tn(t){var r;if(typeof Symbol<"u"&&(Symbol.asyncIterator&&(r=t[Symbol.asyncIterator]),r==null&&Symbol.iterator&&(r=t[Symbol.iterator])),r==null&&(r=t["@@asyncIterator"]),r==null&&(r=t["@@iterator"]),r==null)throw new TypeError("Object is not async iterable");return r.call(t)}function Il(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kv;st(t,"no worker provided");var e=t.version;return!(!r||!e)}var Aa=Be(Ge());function jl(t,r){return!Sa.isSupported()||!xn&&!(r!=null&&r._nodeWorkers)?!1:t.worker&&r?.worker}function Fl(t,r,e,n,i){return Ll.apply(this,arguments)}function Ll(){return Ll=de(Aa.default.mark(function t(r,e,n,i,a){var o,s,u,f,c,h;return Aa.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return o=r.id,s=Cl(r,n),u=Sa.getWorkerFarm(n),f=u.getWorkerPool({name:o,url:s}),n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{})),d.next=8,f.startJob("process-on-worker",FP.bind(null,a));case 8:return c=d.sent,c.postMessage("process",{input:e,options:n,context:i}),d.next=12,c.result;case 12:return h=d.sent,d.next=15,h.result;case 15:return d.abrupt("return",d.sent);case 16:case"end":return d.stop()}},t)})),Ll.apply(this,arguments)}function FP(t,r,e,n){return Dl.apply(this,arguments)}function Dl(){return Dl=de(Aa.default.mark(function t(r,e,n,i){var a,o,s,u,f;return Aa.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:h.t0=n,h.next=h.t0==="done"?3:h.t0==="error"?5:h.t0==="process"?7:20;break;case 3:return e.done(i),h.abrupt("break",21);case 5:return e.error(new Error(i.error)),h.abrupt("break",21);case 7:return a=i.id,o=i.input,s=i.options,h.prev=8,h.next=11,r(o,s);case 11:u=h.sent,e.postMessage("done",{id:a,result:u}),h.next=19;break;case 15:h.prev=15,h.t1=h.catch(8),f=h.t1 instanceof Error?h.t1.message:"unknown error",e.postMessage("error",{id:a,error:f});case 19:return h.abrupt("break",21);case 20:console.warn("parse-with-worker unknown message ".concat(n));case 21:case"end":return h.stop()}},t,null,[[8,15]])})),Dl.apply(this,arguments)}function NP(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=BP(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function BP(t,r){if(t){if(typeof t=="string")return lm(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return lm(t,r)}}function lm(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Nl(t,r,e){if(e=e||t.byteLength,t.byteLength<e||r.byteLength<e)return!1;for(var n=new Uint8Array(t),i=new Uint8Array(r),a=0;a<n.length;++a)if(n[a]!==i[a])return!1;return!0}function Bl(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];var n=r.map(function(c){return c instanceof ArrayBuffer?new Uint8Array(c):c}),i=n.reduce(function(c,h){return c+h.byteLength},0),a=new Uint8Array(i),o=0,s=NP(n),u;try{for(s.s();!(u=s.n()).done;){var f=u.value;a.set(f,o),o+=f.byteLength}}catch(c){s.e(c)}finally{s.f()}return a.buffer}function Oa(t){this.wrapped=t}function En(t){return new Oa(t)}function Pn(t){var r,e;function n(o,s){return new Promise(function(u,f){var c={key:o,arg:s,resolve:u,reject:f,next:null};e?e=e.next=c:(r=e=c,i(o,s))})}function i(o,s){try{var u=t[o](s),f=u.value,c=f instanceof Oa;Promise.resolve(c?f.wrapped:f).then(function(h){if(c){i(o==="return"?"return":"next",h);return}a(u.done?"return":"normal",h)},function(h){i("throw",h)})}catch(h){a("throw",h)}}function a(o,s){switch(o){case"return":r.resolve({value:s,done:!0});break;case"throw":r.reject(s);break;default:r.resolve({value:s,done:!1});break}r=r.next,r?i(r.key,r.arg):e=null}this._invoke=n,typeof t.return!="function"&&(this.return=void 0)}Pn.prototype[typeof Symbol=="function"&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this};Pn.prototype.next=function(t){return this._invoke("next",t)};Pn.prototype.throw=function(t){return this._invoke("throw",t)};Pn.prototype.return=function(t){return this._invoke("return",t)};function mi(t){return function(){return new Pn(t.apply(this,arguments))}}var Vl=Be(Ge());function Ul(t){return zl.apply(this,arguments)}function zl(){return zl=de(Vl.default.mark(function t(r){var e,n,i,a,o,s,u;return Vl.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=[],n=!1,i=!1,c.prev=3,o=Tn(r);case 5:return c.next=7,o.next();case 7:if(!(n=!(s=c.sent).done)){c.next=13;break}u=s.value,e.push(u);case 10:n=!1,c.next=5;break;case 13:c.next=19;break;case 15:c.prev=15,c.t0=c.catch(3),i=!0,a=c.t0;case 19:if(c.prev=19,c.prev=20,!(n&&o.return!=null)){c.next=24;break}return c.next=24,o.return();case 24:if(c.prev=24,!i){c.next=27;break}throw a;case 27:return c.finish(24);case 28:return c.finish(19);case 29:return c.abrupt("return",Bl.apply(void 0,e));case 30:case"end":return c.stop()}},t,null,[[3,15,19,29],[20,,24,28]])})),zl.apply(this,arguments)}var VP="",cm={};function Gl(t){for(var r in cm)if(t.startsWith(r)){var e=cm[r];t=t.replace(r,e)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(VP).concat(t)),t}function hm(t){return t&&ne(t)==="object"&&t.isBuffer}function Is(t){if(hm(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){var r=t,e=new TextEncoder().encode(r);return e.buffer}if(t&&ne(t)==="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}var Sn={};xo(Sn,{dirname:()=>UP,filename:()=>zP,join:()=>GP,resolve:()=>$P});function pm(){var t;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();var r=(t=window.location)===null||t===void 0?void 0:t.pathname;return r?.slice(0,r.lastIndexOf("/")+1)||""}function zP(t){var r=t?t.lastIndexOf("/"):-1;return r>=0?t.substr(r+1):""}function UP(t){var r=t?t.lastIndexOf("/"):-1;return r>=0?t.substr(0,r):""}function GP(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];var n="/";return r=r.map(function(i,a){return a&&(i=i.replace(new RegExp("^".concat(n)),"")),a!==r.length-1&&(i=i.replace(new RegExp("".concat(n,"$")),"")),i}),r.join(n)}function $P(){for(var t=[],r=0;r<arguments.length;r++)t[r]=r<0||arguments.length<=r?void 0:arguments[r];for(var e="",n=!1,i,a=t.length-1;a>=-1&&!n;a--){var o=void 0;a>=0?o=t[a]:(i===void 0&&(i=pm()),o=i),o.length!==0&&(e="".concat(o,"/").concat(e),n=o.charCodeAt(0)===Ma)}return e=HP(e,!n),n?"/".concat(e):e.length>0?e:"."}var Ma=47,$l=46;function HP(t,r){for(var e="",n=-1,i=0,a,o=!1,s=0;s<=t.length;++s){if(s<t.length)a=t.charCodeAt(s);else{if(a===Ma)break;a=Ma}if(a===Ma){if(!(n===s-1||i===1))if(n!==s-1&&i===2){if(e.length<2||!o||e.charCodeAt(e.length-1)!==$l||e.charCodeAt(e.length-2)!==$l){if(e.length>2){for(var u=e.length-1,f=u;f>=0&&e.charCodeAt(f)!==Ma;--f);if(f!==u){e=f===-1?"":e.slice(0,f),n=s,i=0,o=!1;continue}}else if(e.length===2||e.length===1){e="",n=s,i=0,o=!1;continue}}r&&(e.length>0?e+="/..":e="..",o=!0)}else{var c=t.slice(n+1,s);e.length>0?e+="/".concat(c):e=c,o=!1}n=s,i=0}else a===$l&&i!==-1?++i:i=-1}return e}var Tr=Be(Ge());var WP=function(r){return typeof r=="boolean"},ka=function(r){return typeof r=="function"},An=function(r){return r!==null&&ne(r)==="object"},Hl=function(r){return An(r)&&r.constructor==={}.constructor};var dm=function(r){return r&&typeof r[Symbol.iterator]=="function"},vm=function(r){return r&&typeof r[Symbol.asyncIterator]=="function"};var At=function(r){return typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json};var Ot=function(r){return typeof Blob<"u"&&r instanceof Blob},mm=function(r){return r&&ne(r)==="object"&&r.isBuffer};var YP=function(r){return typeof ReadableStream<"u"&&r instanceof ReadableStream||An(r)&&ka(r.tee)&&ka(r.cancel)&&ka(r.getReader)};var XP=function(r){return An(r)&&ka(r.read)&&ka(r.pipe)&&WP(r.readable)},Ls=function(r){return YP(r)||XP(r)};var qP=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,ZP=/^([-\w.]+\/[-\w.+]+)/;function gm(t){var r=ZP.exec(t);return r?r[1]:t}function Wl(t){var r=qP.exec(t);return r?r[1]:""}var ym=/\?.*/;function _m(t){var r=t.match(ym);return r&&r[0]}function gi(t){return t.replace(ym,"")}function On(t){if(At(t)){var r=t;return r.url}if(Ot(t)){var e=t;return e.name||""}return typeof t=="string"?t:""}function Ra(t){if(At(t)){var r=t,e=r.headers.get("content-type")||"",n=gi(r.url);return gm(e)||Wl(n)}if(Ot(t)){var i=t;return i.type||""}return typeof t=="string"?Wl(t):""}function bm(t){if(At(t)){var r=t;return r.headers["content-length"]||-1}if(Ot(t)){var e=t;return e.size}return typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function Ds(t){return Yl.apply(this,arguments)}function Yl(){return Yl=de(Tr.default.mark(function t(r){var e,n,i,a,o,s;return Tr.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!At(r)){f.next=2;break}return f.abrupt("return",r);case 2:return e={},n=bm(r),n>=0&&(e["content-length"]=String(n)),i=On(r),a=Ra(r),a&&(e["content-type"]=a),f.next=10,QP(r);case 10:return o=f.sent,o&&(e["x-first-bytes"]=o),typeof r=="string"&&(r=new TextEncoder().encode(r)),s=new Response(r,{headers:e}),Object.defineProperty(s,"url",{value:i}),f.abrupt("return",s);case 16:case"end":return f.stop()}},t)})),Yl.apply(this,arguments)}function wm(t){return Xl.apply(this,arguments)}function Xl(){return Xl=de(Tr.default.mark(function t(r){var e;return Tr.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(r.ok){i.next=5;break}return i.next=3,KP(r);case 3:throw e=i.sent,new Error(e);case 5:case"end":return i.stop()}},t)})),Xl.apply(this,arguments)}function KP(t){return ql.apply(this,arguments)}function ql(){return ql=de(Tr.default.mark(function t(r){var e,n,i;return Tr.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(e="Failed to fetch resource ".concat(r.url," (").concat(r.status,"): "),o.prev=1,n=r.headers.get("Content-Type"),i=r.statusText,!n.includes("application/json")){o.next=11;break}return o.t0=i,o.t1=" ",o.next=9,r.text();case 9:o.t2=o.sent,i=o.t0+=o.t1.concat.call(o.t1,o.t2);case 11:e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e,o.next=17;break;case 15:o.prev=15,o.t3=o.catch(1);case 17:return o.abrupt("return",e);case 18:case"end":return o.stop()}},t,null,[[1,15]])})),ql.apply(this,arguments)}function QP(t){return Zl.apply(this,arguments)}function Zl(){return Zl=de(Tr.default.mark(function t(r){var e,n,i,a;return Tr.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(e=5,typeof r!="string"){s.next=3;break}return s.abrupt("return","data:,".concat(r.slice(0,e)));case 3:if(!(r instanceof Blob)){s.next=8;break}return n=r.slice(0,5),s.next=7,new Promise(function(u){var f=new FileReader;f.onload=function(c){var h;return u(c==null||(h=c.target)===null||h===void 0?void 0:h.result)},f.readAsDataURL(n)});case 7:return s.abrupt("return",s.sent);case 8:if(!(r instanceof ArrayBuffer)){s.next=12;break}return i=r.slice(0,e),a=JP(i),s.abrupt("return","data:base64,".concat(a));case 12:return s.abrupt("return",null);case 13:case"end":return s.stop()}},t)})),Zl.apply(this,arguments)}function JP(t){for(var r="",e=new Uint8Array(t),n=0;n<e.byteLength;n++)r+=String.fromCharCode(e[n]);return btoa(r)}function yi(t,r){return Ql.apply(this,arguments)}function Ql(){return Ql=de(Kl.default.mark(function t(r,e){var n;return Kl.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(typeof r!="string"){a.next=7;break}return r=Gl(r),n=e,e!=null&&e.fetch&&typeof e?.fetch!="function"&&(n=e.fetch),a.next=6,fetch(r,n);case 6:return a.abrupt("return",a.sent);case 7:return a.next=9,Ds(r);case 9:return a.abrupt("return",a.sent);case 10:case"end":return a.stop()}},t)})),Ql.apply(this,arguments)}function Jl(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;let r=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=t||r;return!!(e&&e.indexOf("Electron")>=0)}function zt(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Jl()}var eS=globalThis.self||globalThis.window||globalThis.global,_i=globalThis.window||globalThis.self||globalThis.global,tS=globalThis.document||{},Mn=globalThis.process||{},rS=globalThis.console,OG=globalThis.navigator||{};var js=typeof __VERSION__<"u"?__VERSION__:"untranspiled source",RG=zt();function nS(t){try{let r=window[t],e="__storage_test__";return r.setItem(e,e),r.removeItem(e),r}catch{return null}}var Fs=class{constructor(r,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";l(this,"storage",void 0),l(this,"id",void 0),l(this,"config",void 0),this.storage=nS(n),this.id=r,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(r){if(Object.assign(this.config,r),this.storage){let e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let r={};if(this.storage){let e=this.storage.getItem(this.id);r=e?JSON.parse(e):{}}return Object.assign(this.config,r),this}};function xm(t){let r;return t<10?r="".concat(t.toFixed(2),"ms"):t<100?r="".concat(t.toFixed(1),"ms"):t<1e3?r="".concat(t.toFixed(0),"ms"):r="".concat((t/1e3).toFixed(2),"s"),r}function Tm(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,e=Math.max(r-t.length,0);return"".concat(" ".repeat(e)).concat(t)}function Ns(t,r,e){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600,i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>n&&(e=Math.min(e,n/t.width));let a=t.width*e,o=t.height*e,s=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(a,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(r," %c+"),s]}var Bs;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Bs||(Bs={}));var iS=10;function Em(t){return typeof t!="string"?t:(t=t.toUpperCase(),Bs[t]||Bs.WHITE)}function Pm(t,r,e){if(!zt&&typeof t=="string"){if(r){let n=Em(r);t="\x1B[".concat(n,"m").concat(t,"\x1B[39m")}if(e){let n=Em(e);t="\x1B[".concat(n+iS,"m").concat(t,"\x1B[49m")}}return t}function Sm(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"],e=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(e),i=t;for(let a of n){let o=i[a];typeof o=="function"&&(r.find(s=>a===s)||(i[a]=o.bind(t)))}}function bi(t,r){if(!t)throw new Error(r||"Assertion failed")}function kn(){let t;if(zt()&&_i.performance){var r,e;t=_i===null||_i===void 0||(r=_i.performance)===null||r===void 0||(e=r.now)===null||e===void 0?void 0:e.call(r)}else if("hrtime"in Mn){var n;let i=Mn===null||Mn===void 0||(n=Mn.hrtime)===null||n===void 0?void 0:n.call(Mn);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}var wi={debug:zt()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},aS={enabled:!0,level:0};function Mt(){}var Am={},Om={once:!0},ar=class{constructor(){let{id:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};l(this,"id",void 0),l(this,"VERSION",js),l(this,"_startTs",kn()),l(this,"_deltaTs",kn()),l(this,"_storage",void 0),l(this,"userData",{}),l(this,"LOG_THROTTLE_TIMEOUT",0),this.id=r,this.userData={},this._storage=new Fs("__probe-".concat(this.id,"__"),aS),this.timeStamp("".concat(this.id," started")),Sm(this),Object.seal(this)}set level(r){this.setLevel(r)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((kn()-this._startTs).toPrecision(10))}getDelta(){return Number((kn()-this._deltaTs).toPrecision(10))}set priority(r){this.level=r}get priority(){return this.level}getPriority(){return this.level}enable(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:r}),this}setLevel(r){return this._storage.setConfiguration({level:r}),this}get(r){return this._storage.config[r]}set(r,e){this._storage.setConfiguration({[r]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(r,e){bi(r,e)}warn(r){return this._getLogFunction(0,r,wi.warn,arguments,Om)}error(r){return this._getLogFunction(0,r,wi.error,arguments)}deprecated(r,e){return this.warn("`".concat(r,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(r,e){return this.error("`".concat(r,"` has been removed. Use `").concat(e,"` instead"))}probe(r,e){return this._getLogFunction(r,e,wi.log,arguments,{time:!0,once:!0})}log(r,e){return this._getLogFunction(r,e,wi.debug,arguments)}info(r,e){return this._getLogFunction(r,e,console.info,arguments)}once(r,e){return this._getLogFunction(r,e,wi.debug||wi.info,arguments,Om)}table(r,e,n){return e?this._getLogFunction(r,e,console.table||Mt,n&&[n],{tag:fS(e)}):Mt}image(r){let{logLevel:e,priority:n,image:i,message:a="",scale:o=1}=r;return this._shouldLog(e||n)?zt()?uS({image:i,message:a,scale:o}):sS({image:i,message:a,scale:o}):Mt}time(r,e){return this._getLogFunction(r,e,console.time?console.time:console.info)}timeEnd(r,e){return this._getLogFunction(r,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(r,e){return this._getLogFunction(r,e,console.timeStamp||Mt)}group(r,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1},i=Mm({logLevel:r,message:e,opts:n}),{collapsed:a}=n;return i.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(r,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(r,e,Object.assign({},n,{collapsed:!0}))}groupEnd(r){return this._getLogFunction(r,"",console.groupEnd||Mt)}withGroup(r,e,n){this.group(r,e)();try{n()}finally{this.groupEnd(r)()}}trace(){console.trace&&console.trace()}_shouldLog(r){return this.isEnabled()&&this.getLevel()>=km(r)}_getLogFunction(r,e,n,i,a){if(this._shouldLog(r)){a=Mm({logLevel:r,message:e,args:i,opts:a}),n=n||a.method,bi(n),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=kn();let o=a.tag||a.message;if(a.once&&o)if(!Am[o])Am[o]=kn();else return Mt;return e=oS(this.id,a.message,a),n.bind(console,e,...a.args)}return Mt}};l(ar,"VERSION",js);function km(t){if(!t)return 0;let r;switch(typeof t){case"number":r=t;break;case"object":r=t.logLevel||t.priority||0;break;default:return 0}return bi(Number.isFinite(r)&&r>=0),r}function Mm(t){let{logLevel:r,message:e}=t;t.logLevel=km(r);let n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==e;);switch(typeof r){case"string":case"function":e!==void 0&&n.unshift(e),t.message=r;break;case"object":Object.assign(t,r);break;default:}typeof t.message=="function"&&(t.message=t.message());let i=typeof t.message;return bi(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function oS(t,r,e){if(typeof r=="string"){let n=e.time?Tm(xm(e.total)):"";r=e.time?"".concat(t,": ").concat(n,"  ").concat(r):"".concat(t,": ").concat(r),r=Pm(r,e.color,e.background)}return r}function sS(t){let{image:r,message:e="",scale:n=1}=t;return console.warn("removed"),Mt}function uS(t){let{image:r,message:e="",scale:n=1}=t;if(typeof r=="string"){let a=new Image;return a.onload=()=>{let o=Ns(a,e,n);console.log(...o)},a.src=r,Mt}let i=r.nodeName||"";if(i.toLowerCase()==="img")return console.log(...Ns(r,e,n)),Mt;if(i.toLowerCase()==="canvas"){let a=new Image;return a.onload=()=>console.log(...Ns(a,e,n)),a.src=r.toDataURL(),Mt}return Mt}function fS(t){for(let r in t)for(let e in t[r])return e||"untitled";return"empty"}var i8=new ar({id:"@probe.gl/log"});var ec=new ar({id:"loaders.gl"}),Rm=function(){function t(){T(this,t)}return S(t,[{key:"log",value:function(){return function(){}}},{key:"info",value:function(){return function(){}}},{key:"warn",value:function(){return function(){}}},{key:"error",value:function(){return function(){}}}]),t}(),Cm=function(){function t(){T(this,t),l(this,"console",void 0),this.console=console}return S(t,[{key:"log",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.log).bind.apply(e,[this.console].concat(i))}},{key:"info",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.info).bind.apply(e,[this.console].concat(i))}},{key:"warn",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.warn).bind.apply(e,[this.console].concat(i))}},{key:"error",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.error).bind.apply(e,[this.console].concat(i))}}]),t}();var tc={fetch:null,mimeType:void 0,nothrow:!1,log:new Cm,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:wn,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Im={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Nm(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=lS(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function lS(t,r){if(t){if(typeof t=="string")return Lm(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Lm(t,r)}}function Lm(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Dm(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Vs(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Dm(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Dm(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function rc(){globalThis.loaders=globalThis.loaders||{};var t=globalThis.loaders;return t._state=t._state||{},t._state}var nc=function(){var r=rc();return r.globalOptions=r.globalOptions||Vs({},tc),r.globalOptions};function Bm(t,r,e,n){return e=e||[],e=Array.isArray(e)?e:[e],cS(t,e),pS(r,t,n)}function cS(t,r){jm(t,null,tc,Im,r);var e=Nm(r),n;try{for(e.s();!(n=e.n()).done;){var i=n.value,a=t&&t[i.id]||{},o=i.options&&i.options[i.id]||{},s=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};jm(a,i.id,o,s,r)}}catch(u){e.e(u)}finally{e.f()}}function jm(t,r,e,n,i){var a=r||"Top level",o=r?"".concat(r,"."):"";for(var s in t){var u=!r&&An(t[s]),f=s==="baseUri"&&!r,c=s==="workerUrl"&&r;if(!(s in e)&&!f&&!c){if(s in n)ec.warn("".concat(a," loader option '").concat(o).concat(s,"' no longer supported, use '").concat(n[s],"'"))();else if(!u){var h=hS(s,i);ec.warn("".concat(a," loader option '").concat(o).concat(s,"' not recognized. ").concat(h))()}}}}function hS(t,r){var e=t.toLowerCase(),n="",i=Nm(r),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;for(var s in o.options){if(t===s)return"Did you mean '".concat(o.id,".").concat(s,"'?");var u=s.toLowerCase(),f=e.startsWith(u)||u.startsWith(e);f&&(n=n||"Did you mean '".concat(o.id,".").concat(s,"'?"))}}}catch(c){i.e(c)}finally{i.f()}return n}function pS(t,r,e){var n=t.options||{},i=Vs({},n);return dS(i,e),i.log===null&&(i.log=new Rm),Fm(i,nc()),Fm(i,r),i}function Fm(t,r){for(var e in r)if(e in r){var n=r[e];Hl(n)&&Hl(t[e])?t[e]=Vs(Vs({},t[e]),r[e]):t[e]=r[e]}}function dS(t,r){r&&!("baseUri"in t)&&(t.baseUri=r)}function Vm(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function zs(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Vm(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Vm(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Ca(t){var r;if(!t)return!1;Array.isArray(t)&&(t=t[0]);var e=Array.isArray((r=t)===null||r===void 0?void 0:r.extensions);return e}function Ia(t){var r,e;Yr(t,"null loader"),Yr(Ca(t),"invalid loader");var n;return Array.isArray(t)&&(n=t[1],t=t[0],t=zs(zs({},t),{},{options:zs(zs({},t.options),n)})),((r=t)!==null&&r!==void 0&&r.parseTextSync||(e=t)!==null&&e!==void 0&&e.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}function vS(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=mS(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function mS(t,r){if(t){if(typeof t=="string")return zm(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return zm(t,r)}}function zm(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Um=function(){var r=rc();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function La(t){var r=Um();t=Array.isArray(t)?t:[t];var e=vS(t),n;try{var i=function(){var o=n.value,s=Ia(o);r.find(function(u){return s===u})||r.unshift(s)};for(e.s();!(n=e.n()).done;)i()}catch(a){e.e(a)}finally{e.f()}}function Gm(){return Um()}var ac=Be(Ge());var $m=new ar({id:"loaders.gl"});function Hm(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Wm(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Hm(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Hm(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Da(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=gS(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function gS(t,r){if(t){if(typeof t=="string")return Ym(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Ym(t,r)}}function Ym(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var yS=/\.([^.]+)$/;function Zm(t){return oc.apply(this,arguments)}function oc(){return oc=de(ac.default.mark(function t(r){var e,n,i,a,o=arguments;return ac.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(e=o.length>1&&o[1]!==void 0?o[1]:[],n=o.length>2?o[2]:void 0,i=o.length>3?o[3]:void 0,Km(r)){u.next=5;break}return u.abrupt("return",null);case 5:if(a=Xm(r,e,Wm(Wm({},n),{},{nothrow:!0}),i),!a){u.next=8;break}return u.abrupt("return",a);case 8:if(!Ot(r)){u.next=13;break}return u.next=11,r.slice(0,10).arrayBuffer();case 11:r=u.sent,a=Xm(r,e,n,i);case 13:if(!(!a&&!(n!=null&&n.nothrow))){u.next=15;break}throw new Error(Qm(r));case 15:return u.abrupt("return",a);case 16:case"end":return u.stop()}},t)})),oc.apply(this,arguments)}function Xm(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!Km(t))return null;if(r&&!Array.isArray(r))return Ia(r);var i=[];if(r&&(i=i.concat(r)),!(e!=null&&e.ignoreRegisteredLoaders)){var a;(a=i).push.apply(a,ue(Gm()))}bS(i);var o=_S(t,i,e,n);if(!o&&!(e!=null&&e.nothrow))throw new Error(Qm(t));return o}function _S(t,r,e,n){var i=On(t),a=Ra(t),o=gi(i)||n?.url,s=null,u="";if(e!=null&&e.mimeType&&(s=ic(r,e?.mimeType),u="match forced by supplied MIME type ".concat(e?.mimeType)),s=s||wS(r,o),u=u||(s?"matched url ".concat(o):""),s=s||ic(r,a),u=u||(s?"matched MIME type ".concat(a):""),s=s||TS(r,t),u=u||(s?"matched initial data ".concat(Jm(t)):""),s=s||ic(r,e?.fallbackMimeType),u=u||(s?"matched fallback MIME type ".concat(a):""),u){var f;$m.log(1,"selectLoader selected ".concat((f=s)===null||f===void 0?void 0:f.name,": ").concat(u,"."))}return s}function Km(t){return!(t instanceof Response&&t.status===204)}function Qm(t){var r=On(t),e=Ra(t),n="No valid loader found (";n+=r?"".concat(Sn.filename(r),", "):"no url provided, ",n+="MIME type: ".concat(e?'"'.concat(e,'"'):"not provided",", ");var i=t?Jm(t):"";return n+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",n+=")",n}function bS(t){var r=Da(t),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;Ia(n)}}catch(i){r.e(i)}finally{r.f()}}function wS(t,r){var e=r&&yS.exec(r),n=e&&e[1];return n?xS(t,n):null}function xS(t,r){r=r.toLowerCase();var e=Da(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value,a=Da(i.extensions),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;if(s.toLowerCase()===r)return i}}catch(u){a.e(u)}finally{a.f()}}}catch(u){e.e(u)}finally{e.f()}return null}function ic(t,r){var e=Da(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(i.mimeTypes&&i.mimeTypes.includes(r)||r==="application/x.".concat(i.id))return i}}catch(a){e.e(a)}finally{e.f()}return null}function TS(t,r){if(!r)return null;var e=Da(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(typeof r=="string"){if(ES(r,i))return i}else if(ArrayBuffer.isView(r)){if(qm(r.buffer,r.byteOffset,i))return i}else if(r instanceof ArrayBuffer){var a=0;if(qm(r,a,i))return i}}}catch(o){e.e(o)}finally{e.f()}return null}function ES(t,r){if(r.testText)return r.testText(t);var e=Array.isArray(r.tests)?r.tests:[r.tests];return e.some(function(n){return t.startsWith(n)})}function qm(t,r,e){var n=Array.isArray(e.tests)?e.tests:[e.tests];return n.some(function(i){return PS(t,r,e,i)})}function PS(t,r,e,n){if(n instanceof ArrayBuffer)return Nl(n,t,n.byteLength);switch(ne(n)){case"function":return n(t,e);case"string":var i=sc(t,r,n.length);return n===i;default:return!1}}function Jm(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;if(typeof t=="string")return t.slice(0,r);if(ArrayBuffer.isView(t))return sc(t.buffer,t.byteOffset,r);if(t instanceof ArrayBuffer){var e=0;return sc(t,e,r)}return""}function sc(t,r,e){if(t.byteLength<r+e)return"";for(var n=new DataView(t),i="",a=0;a<e;a++)i+=String.fromCharCode(n.getUint8(r+a));return i}var Fa=Be(Ge());var mc=Be(Ge());var uc=Be(Ge()),SS=uc.default.mark(fc),AS=256*1024;function fc(t,r){var e,n,i,a,o;return uc.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:e=r?.chunkSize||AS,n=0,i=new TextEncoder;case 3:if(!(n<t.length)){u.next=11;break}return a=Math.min(t.length-n,e),o=t.slice(n,n+a),n+=a,u.next=9,i.encode(o);case 9:u.next=3;break;case 11:case"end":return u.stop()}},SS)}var lc=Be(Ge()),OS=256*1024;function eg(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return lc.default.mark(function e(){var n,i,a,o,s,u,f;return lc.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:n=r.chunkSize,i=n===void 0?OS:n,a=0;case 2:if(!(a<t.byteLength)){h.next=13;break}return o=Math.min(t.byteLength-a,i),s=new ArrayBuffer(o),u=new Uint8Array(t,a,o),f=new Uint8Array(s),f.set(u),a+=o,h.next=11,s;case 11:h.next=2;break;case 13:case"end":return h.stop()}},e)})()}var cc=Be(Ge()),MS=1024*1024;function tg(t,r){return hc.apply(this,arguments)}function hc(){return hc=mi(cc.default.mark(function t(r,e){var n,i,a,o;return cc.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:n=e?.chunkSize||MS,i=0;case 2:if(!(i<r.size)){u.next=12;break}return a=i+n,u.next=6,En(r.slice(i,a).arrayBuffer());case 6:return o=u.sent,i=a,u.next=10,o;case 10:u.next=2;break;case 12:case"end":return u.stop()}},t)})),hc.apply(this,arguments)}var ja=Be(Ge());function vc(t,r){return wn?kS(t,r):RS(t,r)}function kS(t,r){return pc.apply(this,arguments)}function pc(){return pc=mi(ja.default.mark(function t(r,e){var n,i,a,o,s,u;return ja.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:n=r.getReader(),c.prev=1;case 2:return a=i||n.read(),e!=null&&e._streamReadAhead&&(i=n.read()),c.next=7,En(a);case 7:if(o=c.sent,s=o.done,u=o.value,!s){c.next=12;break}return c.abrupt("return");case 12:return c.next=14,Is(u);case 14:c.next=2;break;case 16:c.next=21;break;case 18:c.prev=18,c.t0=c.catch(1),n.releaseLock();case 21:case"end":return c.stop()}},t,null,[[1,18]])})),pc.apply(this,arguments)}function RS(t,r){return dc.apply(this,arguments)}function dc(){return dc=mi(ja.default.mark(function t(r,e){var n,i,a,o,s,u;return ja.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:n=!1,i=!1,c.prev=2,o=Tn(r);case 4:return c.next=6,En(o.next());case 6:if(!(n=!(s=c.sent).done)){c.next=13;break}return u=s.value,c.next=10,Is(u);case 10:n=!1,c.next=4;break;case 13:c.next=19;break;case 15:c.prev=15,c.t0=c.catch(2),i=!0,a=c.t0;case 19:if(c.prev=19,c.prev=20,!(n&&o.return!=null)){c.next=24;break}return c.next=24,En(o.return());case 24:if(c.prev=24,!i){c.next=27;break}throw a;case 27:return c.finish(24);case 28:return c.finish(19);case 29:case"end":return c.stop()}},t,null,[[2,15,19,29],[20,,24,28]])})),dc.apply(this,arguments)}function rg(t,r){if(typeof t=="string")return fc(t,r);if(t instanceof ArrayBuffer)return eg(t,r);if(Ot(t))return tg(t,r);if(Ls(t))return vc(t,r);if(At(t)){var e=t;return vc(e.body,r)}throw new Error("makeIterator")}var ng="Cannot convert supplied data type";function CS(t,r,e){if(r.text&&typeof t=="string")return t;if(mm(t)&&(t=t.buffer),t instanceof ArrayBuffer){var n=t;if(r.text&&!r.binary){var i=new TextDecoder("utf8");return i.decode(n)}return n}if(ArrayBuffer.isView(t)){if(r.text&&!r.binary){var a=new TextDecoder("utf8");return a.decode(t)}var o=t.buffer,s=t.byteLength||t.length;return(t.byteOffset!==0||s!==o.byteLength)&&(o=o.slice(t.byteOffset,t.byteOffset+s)),o}throw new Error(ng)}function ig(t,r,e){return gc.apply(this,arguments)}function gc(){return gc=de(mc.default.mark(function t(r,e,n){var i,a;return mc.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(i=r instanceof ArrayBuffer||ArrayBuffer.isView(r),!(typeof r=="string"||i)){s.next=3;break}return s.abrupt("return",CS(r,e,n));case 3:if(!Ot(r)){s.next=7;break}return s.next=6,Ds(r);case 6:r=s.sent;case 7:if(!At(r)){s.next=21;break}return a=r,s.next=11,wm(a);case 11:if(!e.binary){s.next=17;break}return s.next=14,a.arrayBuffer();case 14:s.t0=s.sent,s.next=20;break;case 17:return s.next=19,a.text();case 19:s.t0=s.sent;case 20:return s.abrupt("return",s.t0);case 21:if(Ls(r)&&(r=rg(r,n)),!(dm(r)||vm(r))){s.next=24;break}return s.abrupt("return",Ul(r));case 24:throw new Error(ng);case 25:case"end":return s.stop()}},t)})),gc.apply(this,arguments)}function Us(t,r){var e=nc(),n=t||e;return typeof n.fetch=="function"?n.fetch:An(n.fetch)?function(i){return yi(i,n)}:r!=null&&r.fetch?r?.fetch:yi}function ag(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function IS(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?ag(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ag(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function og(t,r,e){if(e)return e;var n=IS({fetch:Us(r,t)},t);if(n.url){var i=gi(n.url);n.baseUrl=i,n.queryString=_m(n.url),n.filename=Sn.filename(i),n.baseUrl=Sn.dirname(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function sg(t,r){if(!r&&t&&!Array.isArray(t))return t;var e;if(t&&(e=Array.isArray(t)?t:[t]),r&&r.loaders){var n=Array.isArray(r.loaders)?r.loaders:[r.loaders];e=e?[].concat(ue(e),ue(n)):n}return e&&e.length?e:null}function Rn(t,r,e,n){return yc.apply(this,arguments)}function yc(){return yc=de(Fa.default.mark(function t(r,e,n,i){var a,o,s,u;return Fa.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return st(!i||ne(i)==="object"),e&&!Array.isArray(e)&&!Ca(e)&&(i=void 0,n=e,e=void 0),c.next=4,r;case 4:return r=c.sent,n=n||{},a=On(r),o=e,s=sg(o,i),c.next=11,Zm(r,s,n);case 11:if(u=c.sent,u){c.next=14;break}return c.abrupt("return",null);case 14:return n=Bm(n,u,s,a),i=og({url:a,parse:Rn,loaders:s},n,i||null),c.next=18,LS(u,r,n,i);case 18:return c.abrupt("return",c.sent);case 19:case"end":return c.stop()}},t)})),yc.apply(this,arguments)}function LS(t,r,e,n){return _c.apply(this,arguments)}function _c(){return _c=de(Fa.default.mark(function t(r,e,n,i){var a,o,s,u,f,c,h,p;return Fa.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return Il(r),At(e)&&(a=e,o=a.ok,s=a.redirected,u=a.status,f=a.statusText,c=a.type,h=a.url,p=Object.fromEntries(a.headers.entries()),i.response={headers:p,ok:o,redirected:s,status:u,statusText:f,type:c,url:h}),v.next=4,ig(e,r,n);case 4:if(e=v.sent,!(r.parseTextSync&&typeof e=="string")){v.next=8;break}return n.dataType="text",v.abrupt("return",r.parseTextSync(e,n,i,r));case 8:if(!jl(r,n)){v.next=12;break}return v.next=11,Fl(r,e,n,i,Rn);case 11:return v.abrupt("return",v.sent);case 12:if(!(r.parseText&&typeof e=="string")){v.next=16;break}return v.next=15,r.parseText(e,n,i,r);case 15:return v.abrupt("return",v.sent);case 16:if(!r.parse){v.next=20;break}return v.next=19,r.parse(e,n,i,r);case 19:return v.abrupt("return",v.sent);case 20:throw st(!r.parseSync),new Error("".concat(r.id," loader - no parser found and worker is disabled"));case 22:case"end":return v.stop()}},t)})),_c.apply(this,arguments)}var bc=Be(Ge());function Xr(t,r,e,n){return wc.apply(this,arguments)}function wc(){return wc=de(bc.default.mark(function t(r,e,n,i){var a,o;return bc.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!Array.isArray(e)&&!Ca(e)&&(i=void 0,n=e,e=void 0),a=Us(n),o=r,typeof r!="string"){u.next=7;break}return u.next=6,a(r);case 6:o=u.sent;case 7:if(!Ot(r)){u.next=11;break}return u.next=10,a(r);case 10:o=u.sent;case 11:return u.next=13,Rn(o,e,n);case 13:return u.abrupt("return",u.sent);case 14:case"end":return u.stop()}},t)})),wc.apply(this,arguments)}var ug="3.4.13";var Dc=Be(Ge());var DS=globalThis._parseImageNode,Tc=typeof Image<"u",Ec=typeof ImageBitmap<"u",jS=Boolean(DS),Pc=wn?!0:jS;function fg(t){switch(t){case"auto":return Ec||Tc||Pc;case"imagebitmap":return Ec;case"image":return Tc;case"data":return Pc;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function lg(){if(Ec)return"imagebitmap";if(Tc)return"image";if(Pc)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function FS(t){var r=NS(t);if(!r)throw new Error("Not an image");return r}function cg(t){switch(FS(t)){case"data":return t;case"image":case"imagebitmap":var r=document.createElement("canvas"),e=r.getContext("2d");if(!e)throw new Error("getImageData");return r.width=t.width,r.height=t.height,e.drawImage(t,0,0),e.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function NS(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&ne(t)==="object"&&t.data&&t.width&&t.height?"data":null}var Na=Be(Ge());var BS=/^data:image\/svg\+xml/,VS=/\.svg((\?|#).*)?$/;function Gs(t){return t&&(BS.test(t)||VS.test(t))}function hg(t,r){if(Gs(r)){var e=new TextDecoder,n=e.decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(a){throw new Error(a.message)}var i="data:image/svg+xml;base64,".concat(btoa(n));return i}return Sc(t,r)}function Sc(t,r){if(Gs(r))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}function Ba(t,r,e){return Ac.apply(this,arguments)}function Ac(){return Ac=de(Na.default.mark(function t(r,e,n){var i,a,o;return Na.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return i=hg(r,n),a=self.URL||self.webkitURL,o=typeof i!="string"&&a.createObjectURL(i),u.prev=3,u.next=6,zS(o||i,e);case 6:return u.abrupt("return",u.sent);case 7:return u.prev=7,o&&a.revokeObjectURL(o),u.finish(7);case 10:case"end":return u.stop()}},t,null,[[3,,7,10]])})),Ac.apply(this,arguments)}function zS(t,r){return Oc.apply(this,arguments)}function Oc(){return Oc=de(Na.default.mark(function t(r,e){var n;return Na.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(n=new Image,n.src=r,!(e.image&&e.image.decode&&n.decode)){a.next=6;break}return a.next=5,n.decode();case 5:return a.abrupt("return",n);case 6:return a.next=8,new Promise(function(o,s){try{n.onload=function(){return o(n)},n.onerror=function(u){return s(new Error("Could not load image ".concat(r,": ").concat(u)))}}catch(u){s(u)}});case 8:return a.abrupt("return",a.sent);case 9:case"end":return a.stop()}},t)})),Oc.apply(this,arguments)}var Va=Be(Ge());var US={},pg=!0;function Rc(t,r,e){return Mc.apply(this,arguments)}function Mc(){return Mc=de(Va.default.mark(function t(r,e,n){var i,a,o;return Va.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!Gs(n)){u.next=7;break}return u.next=3,Ba(r,e,n);case 3:a=u.sent,i=a,u.next=8;break;case 7:i=Sc(r,n);case 8:return o=e&&e.imagebitmap,u.next=11,GS(i,o);case 11:return u.abrupt("return",u.sent);case 12:case"end":return u.stop()}},t)})),Mc.apply(this,arguments)}function GS(t){return kc.apply(this,arguments)}function kc(){return kc=de(Va.default.mark(function t(r){var e,n=arguments;return Va.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e=n.length>1&&n[1]!==void 0?n[1]:null,($S(e)||!pg)&&(e=null),!e){a.next=13;break}return a.prev=3,a.next=6,createImageBitmap(r,e);case 6:return a.abrupt("return",a.sent);case 9:a.prev=9,a.t0=a.catch(3),console.warn(a.t0),pg=!1;case 13:return a.next=15,createImageBitmap(r);case 15:return a.abrupt("return",a.sent);case 16:case"end":return a.stop()}},t,null,[[3,9]])})),kc.apply(this,arguments)}function $S(t){for(var r in t||US)return!1;return!0}var Cc=Be(Ge());function dg(t){return!XS(t,"ftyp",4)||!(t[8]&96)?null:HS(t)}function HS(t){var r=WS(t,8,12).replace("\0"," ").trim();switch(r){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function WS(t,r,e){return String.fromCharCode.apply(String,ue(t.slice(r,e)))}function YS(t){return ue(t).map(function(r){return r.charCodeAt(0)})}function XS(t,r){for(var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=YS(r),i=0;i<n.length;++i)if(n[i]!==t[i+e])return!1;return!0}var or=!1,za=!0;function $s(t){var r=Ua(t);return ZS(r)||JS(r)||KS(r)||QS(r)||qS(r)}function qS(t){var r=new Uint8Array(t instanceof DataView?t.buffer:t),e=dg(r);return e?{mimeType:e.mimeType,width:0,height:0}:null}function ZS(t){var r=Ua(t),e=r.byteLength>=24&&r.getUint32(0,or)===2303741511;return e?{mimeType:"image/png",width:r.getUint32(16,or),height:r.getUint32(20,or)}:null}function KS(t){var r=Ua(t),e=r.byteLength>=10&&r.getUint32(0,or)===1195984440;return e?{mimeType:"image/gif",width:r.getUint16(6,za),height:r.getUint16(8,za)}:null}function QS(t){var r=Ua(t),e=r.byteLength>=14&&r.getUint16(0,or)===16973&&r.getUint32(2,za)===r.byteLength;return e?{mimeType:"image/bmp",width:r.getUint32(18,za),height:r.getUint32(22,za)}:null}function JS(t){var r=Ua(t),e=r.byteLength>=3&&r.getUint16(0,or)===65496&&r.getUint8(2)===255;if(!e)return null;for(var n=eA(),i=n.tableMarkers,a=n.sofMarkers,o=2;o+9<r.byteLength;){var s=r.getUint16(o,or);if(a.has(s))return{mimeType:"image/jpeg",height:r.getUint16(o+5,or),width:r.getUint16(o+7,or)};if(!i.has(s))return null;o+=2,o+=r.getUint16(o,or)}return null}function eA(){for(var t=new Set([65499,65476,65484,65501,65534]),r=65504;r<65520;++r)t.add(r);var e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}function Ua(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}function Lc(t,r){return Ic.apply(this,arguments)}function Ic(){return Ic=de(Cc.default.mark(function t(r,e){var n,i,a;return Cc.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=$s(r)||{},i=n.mimeType,a=globalThis._parseImageNode,Yr(a),s.next=5,a(r,i);case 5:return s.abrupt("return",s.sent);case 6:case"end":return s.stop()}},t)})),Ic.apply(this,arguments)}function Fc(t,r,e){return jc.apply(this,arguments)}function jc(){return jc=de(Dc.default.mark(function t(r,e,n){var i,a,o,s,u,f;return Dc.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:e=e||{},i=e.image||{},a=i.type||"auto",o=n||{},s=o.url,u=tA(a),h.t0=u,h.next=h.t0==="imagebitmap"?8:h.t0==="image"?12:h.t0==="data"?16:20;break;case 8:return h.next=10,Rc(r,e,s);case 10:return f=h.sent,h.abrupt("break",21);case 12:return h.next=14,Ba(r,e,s);case 14:return f=h.sent,h.abrupt("break",21);case 16:return h.next=18,Lc(r,e);case 18:return f=h.sent,h.abrupt("break",21);case 20:Yr(!1);case 21:return a==="data"&&(f=cg(f)),h.abrupt("return",f);case 23:case"end":return h.stop()}},t)})),jc.apply(this,arguments)}function tA(t){switch(t){case"auto":case"data":return lg();default:return fg(t),t}}var rA=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],nA=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],iA={image:{type:"auto",decode:!0}},Nc={id:"image",module:"images",name:"Images",version:ug,mimeTypes:nA,extensions:rA,parse:Fc,tests:[function(t){return Boolean($s(new DataView(t)))}],options:iA};var he=new Lr({id:"deck"});var Bc={};function Hs(t){Bc=t}function ze(t,r,e,n){he.level>0&&Bc[t]&&Bc[t].call(null,r,e,n)}function aA(t){var r=t[0],e=t[t.length-1];return r==="{"&&e==="}"||r==="["&&e==="]"}var vg={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:aA,parseTextSync:JSON.parse};function mg(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function gg(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?mg(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):mg(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function oA(){var t="8.9.32",r=globalThis.deck&&globalThis.deck.VERSION;if(r&&r!==t)throw new Error("deck.gl - multiple versions detected: ".concat(r," vs ").concat(t));return r||(he.log(1,"deck.gl ".concat(t))(),globalThis.deck=gg(gg({},globalThis.deck),{},{VERSION:t,version:t,log:he,_registerLoggers:Hs}),La([vg,[Nc,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}var Ws=oA();var me={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(me,"IDENTITY",{get:function(){return he.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0}});var ut={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ga={common:0,meters:1,pixels:2},Vc={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},yg={DRAW:"draw",MASK:"mask",TERRAIN:"terrain"};var sA=[255,255,255],uA=1,fA=0,Ys=function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};T(this,t),l(this,"id",void 0),l(this,"color",void 0),l(this,"intensity",void 0),l(this,"type","ambient");var e=r.color,n=e===void 0?sA:e,i=r.intensity,a=i===void 0?uA:i;this.id=r.id||"ambient-".concat(fA++),this.color=n,this.intensity=a};var lA=[255,255,255],cA=1,hA=[0,0,-1],pA=0,Cn=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};T(this,t),l(this,"id",void 0),l(this,"color",void 0),l(this,"intensity",void 0),l(this,"type","directional"),l(this,"direction",void 0),l(this,"shadow",void 0);var e=r.color,n=e===void 0?lA:e,i=r.intensity,a=i===void 0?cA:i,o=r.direction,s=o===void 0?hA:o,u=r._shadow,f=u===void 0?!1:u;this.id=r.id||"directional-".concat(pA++),this.color=n,this.intensity=a,this.type="directional",this.direction=new We(s).normalize().toArray(),this.shadow=f}return S(t,[{key:"getProjectedLight",value:function(e){return this}}]),t}();function _g(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function dA(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?_g(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):_g(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Xs=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};T(this,t),l(this,"id",void 0),l(this,"gl",void 0),l(this,"props",void 0);var n=e.id;this.id=n,this.gl=r,this.props=dA({},e)}return S(t,[{key:"setProps",value:function(e){Object.assign(this.props,e)}},{key:"render",value:function(e){}},{key:"cleanup",value:function(){}}]),t}();function zc(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=vA(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function vA(t,r){if(t){if(typeof t=="string")return bg(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return bg(t,r)}}function bg(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function mA(t){var r=gA();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function gA(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var qr=function(t){N(e,t);var r=mA(e);function e(){var n;T(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),l(W(n),"_lastRenderIndex",-1),n}return S(e,[{key:"render",value:function(i){var a=this.gl;return Xe(a,{framebuffer:i.target}),this._drawLayers(i)}},{key:"_drawLayers",value:function(i){var a=i.target,o=i.moduleParameters,s=i.viewports,u=i.views,f=i.onViewportActive,c=i.clearStack,h=c===void 0?!0:c,p=i.clearCanvas,d=p===void 0?!0:p;i.pass=i.pass||"unknown";var v=this.gl;d&&_A(v,a),h&&(this._lastRenderIndex=-1);var m=[],g=zc(s),_;try{for(g.s();!(_=g.n()).done;){var w=_.value,x=u&&u[w.id];f?.(w);var P=this._getDrawLayerParams(w,i),E=w.subViewports||[w],A=zc(E),R;try{for(A.s();!(R=A.n()).done;){var D=R.value,j=this._drawLayersInViewport(v,{target:a,moduleParameters:o,viewport:D,view:x,pass:i.pass,layers:i.layers},P);m.push(j)}}catch(I){A.e(I)}finally{A.f()}}}catch(I){g.e(I)}finally{g.f()}return m}},{key:"_getDrawLayerParams",value:function(i,a){for(var o=a.layers,s=a.pass,u=a.isPicking,f=u===void 0?!1:u,c=a.layerFilter,h=a.cullRect,p=a.effects,d=a.moduleParameters,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,m=[],g=wg(this._lastRenderIndex+1),_={layer:o[0],viewport:i,isPicking:f,renderPass:s,cullRect:h},w={},x=0;x<o.length;x++){var P=o[x],E=this._shouldDrawLayer(P,_,c,w),A={shouldDrawLayer:E};E&&!v&&(A.layerRenderIndex=g(P,E),A.moduleParameters=this._getModuleParameters(P,p,s,d),A.layerParameters=this.getLayerParameters(P,x,i)),m[x]=A}return m}},{key:"_drawLayersInViewport",value:function(i,a,o){var s=a.layers,u=a.moduleParameters,f=a.pass,c=a.target,h=a.viewport,p=a.view,d=yA(i,{moduleParameters:u,target:c,viewport:h});if(p&&p.props.clear){var v=p.props.clear===!0?{color:!0,depth:!0}:p.props.clear;Ae(i,{scissorTest:!0,scissor:d},function(){return Jt(i,v)})}var m={totalCount:s.length,visibleCount:0,compositeCount:0,pickableCount:0};Xe(i,{viewport:d});for(var g=0;g<s.length;g++){var _=s[g],w=o[g],x=w.shouldDrawLayer,P=w.layerRenderIndex,E=w.moduleParameters,A=w.layerParameters;if(x&&_.props.pickable&&m.pickableCount++,_.isComposite)m.compositeCount++;else if(x){m.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,P),E.viewport=h;try{_._drawLayer({moduleParameters:E,uniforms:{layerIndex:P},parameters:A})}catch(R){_.raiseError(R,"drawing ".concat(_," to ").concat(f))}}}return m}},{key:"shouldDrawLayer",value:function(i){return!0}},{key:"getModuleParameters",value:function(i,a){return null}},{key:"getLayerParameters",value:function(i,a,o){return i.props.parameters}},{key:"_shouldDrawLayer",value:function(i,a,o,s){var u=i.props.visible&&this.shouldDrawLayer(i);if(!u)return!1;a.layer=i;for(var f=i.parent;f;){if(!f.props.visible||!f.filterSubLayer(a))return!1;a.layer=f,f=f.parent}if(o){var c=a.layer.id;if(c in s||(s[c]=o(a)),!s[c])return!1}return i.activateViewport(a.viewport),!0}},{key:"_getModuleParameters",value:function(i,a,o,s){var u,f=Object.assign(Object.create(((u=i.internalState)===null||u===void 0?void 0:u.propsInTransition)||i.props),{autoWrapLongitude:i.wrapLongitude,viewport:i.context.viewport,mousePosition:i.context.mousePosition,pickingActive:0,devicePixelRatio:mt(this.gl)});if(a){var c=zc(a),h;try{for(c.s();!(h=c.n()).done;){var p,d=h.value;Object.assign(f,(p=d.getModuleParameters)===null||p===void 0?void 0:p.call(d,i))}}catch(v){c.e(v)}finally{c.f()}}return Object.assign(f,this.getModuleParameters(i,a),s)}}]),e}(Xs);function wg(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e={},n=function i(a,o){var s=a.props._offset,u=a.id,f=a.parent&&a.parent.id,c;if(f&&!(f in r)&&i(a.parent,!1),f in e){var h=e[f]=e[f]||wg(r[f],r);c=h(a,o),e[u]=h}else Number.isFinite(s)?(c=s+(r[f]||0),e[u]=null):c=t;return o&&c>=t&&(t=c+1),r[u]=c,c};return n}function yA(t,r){var e=r.moduleParameters,n=r.target,i=r.viewport,a=n&&n.id!=="default-framebuffer",o=e&&e.devicePixelRatio||mt(t),s=a?n.height:t.drawingBufferHeight,u=i;return[u.x*o,s-(u.y+u.height)*o,u.width*o,u.height*o]}function _A(t,r){var e=r?r.width:t.drawingBufferWidth,n=r?r.height:t.drawingBufferHeight;Xe(t,{viewport:[0,0,e,n]}),t.clear(16640)}function xg(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Tg(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?xg(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):xg(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function bA(t){var r=wA();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function wA(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Eg=function(t){N(e,t);var r=bA(e);function e(n,i){var a,o,s;return T(this,e),s=r.call(this,n,i),l(W(s),"shadowMap",void 0),l(W(s),"depthBuffer",void 0),l(W(s),"fbo",void 0),s.shadowMap=new Le(n,{width:1,height:1,parameters:(a={},l(a,10241,9729),l(a,10240,9729),l(a,10242,33071),l(a,10243,33071),a)}),s.depthBuffer=new yt(n,{format:33189,width:1,height:1}),s.fbo=new xe(n,{id:"shadowmap",width:1,height:1,attachments:(o={},l(o,36064,s.shadowMap),l(o,36096,s.depthBuffer),o)}),s}return S(e,[{key:"render",value:function(i){var a=this,o=this.fbo;Ae(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},function(){var s=i.viewports[0],u=mt(a.gl),f=s.width*u,c=s.height*u;(f!==o.width||c!==o.height)&&o.resize({width:f,height:c}),be(M(e.prototype),"render",a).call(a,Tg(Tg({},i),{},{target:o,pass:"shadow"}))})}},{key:"shouldDrawLayer",value:function(i){return i.props.shadowEnabled!==!1}},{key:"getModuleParameters",value:function(){return{drawToShadowMap:!0}}},{key:"delete",value:function(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}]),e}(qr);var Pg="#define SMOOTH_EDGE_RADIUS 0.5",xA=`
`.concat(Pg,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),TA=`
`.concat(Pg,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),Sg={name:"geometry",vs:xA,fs:TA};var EA=Object.keys(me).map(function(t){return"const int COORDINATE_SYSTEM_".concat(t," = ").concat(me[t],";")}).join(""),PA=Object.keys(ut).map(function(t){return"const int PROJECTION_MODE_".concat(t," = ").concat(ut[t],";")}).join(""),SA=Object.keys(Ga).map(function(t){return"const int UNIT_".concat(t.toUpperCase()," = ").concat(Ga[t],";")}).join(""),Ag="".concat(EA,`
`).concat(PA,`
`).concat(SA,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);var Er=typeof Float32Array<"u"?Float32Array:Array;var bH=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});function Gc(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],f=r[7],c=r[8],h=r[9],p=r[10],d=r[11],v=r[12],m=r[13],g=r[14],_=r[15],w=e*s-n*o,x=e*u-i*o,P=e*f-a*o,E=n*u-i*s,A=n*f-a*s,R=i*f-a*u,D=c*m-h*v,j=c*g-p*v,I=c*_-d*v,V=h*g-p*m,F=h*_-d*m,G=p*_-d*g,B=w*G-x*F+P*V+E*I-A*j+R*D;return B?(B=1/B,t[0]=(s*G-u*F+f*V)*B,t[1]=(i*F-n*G-a*V)*B,t[2]=(m*R-g*A+_*E)*B,t[3]=(p*A-h*R-d*E)*B,t[4]=(u*I-o*G-f*j)*B,t[5]=(e*G-i*I+a*j)*B,t[6]=(g*P-v*R-_*x)*B,t[7]=(c*R-p*P+d*x)*B,t[8]=(o*F-s*I+f*D)*B,t[9]=(n*I-e*F-a*D)*B,t[10]=(v*A-m*P+_*w)*B,t[11]=(h*P-c*A-d*w)*B,t[12]=(s*j-o*V-u*D)*B,t[13]=(e*V-n*j+i*D)*B,t[14]=(m*x-v*E-g*w)*B,t[15]=(c*E-h*x+p*w)*B,t):null}function In(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],f=r[6],c=r[7],h=r[8],p=r[9],d=r[10],v=r[11],m=r[12],g=r[13],_=r[14],w=r[15],x=e[0],P=e[1],E=e[2],A=e[3];return t[0]=x*n+P*s+E*h+A*m,t[1]=x*i+P*u+E*p+A*g,t[2]=x*a+P*f+E*d+A*_,t[3]=x*o+P*c+E*v+A*w,x=e[4],P=e[5],E=e[6],A=e[7],t[4]=x*n+P*s+E*h+A*m,t[5]=x*i+P*u+E*p+A*g,t[6]=x*a+P*f+E*d+A*_,t[7]=x*o+P*c+E*v+A*w,x=e[8],P=e[9],E=e[10],A=e[11],t[8]=x*n+P*s+E*h+A*m,t[9]=x*i+P*u+E*p+A*g,t[10]=x*a+P*f+E*d+A*_,t[11]=x*o+P*c+E*v+A*w,x=e[12],P=e[13],E=e[14],A=e[15],t[12]=x*n+P*s+E*h+A*m,t[13]=x*i+P*u+E*p+A*g,t[14]=x*a+P*f+E*d+A*_,t[15]=x*o+P*c+E*v+A*w,t}function Og(t,r,e){var n=e[0],i=e[1],a=e[2],o,s,u,f,c,h,p,d,v,m,g,_;return r===t?(t[12]=r[0]*n+r[4]*i+r[8]*a+r[12],t[13]=r[1]*n+r[5]*i+r[9]*a+r[13],t[14]=r[2]*n+r[6]*i+r[10]*a+r[14],t[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(o=r[0],s=r[1],u=r[2],f=r[3],c=r[4],h=r[5],p=r[6],d=r[7],v=r[8],m=r[9],g=r[10],_=r[11],t[0]=o,t[1]=s,t[2]=u,t[3]=f,t[4]=c,t[5]=h,t[6]=p,t[7]=d,t[8]=v,t[9]=m,t[10]=g,t[11]=_,t[12]=o*n+c*i+v*a+r[12],t[13]=s*n+h*i+m*a+r[13],t[14]=u*n+p*i+g*a+r[14],t[15]=f*n+d*i+_*a+r[15]),t}function Mg(t,r,e){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=r[7]*i,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function AA(){var t=new Er(4);return Er!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ig(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t}function Ln(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3];return t[0]=e[0]*n+e[4]*i+e[8]*a+e[12]*o,t[1]=e[1]*n+e[5]*i+e[9]*a+e[13]*o,t[2]=e[2]*n+e[6]*i+e[10]*a+e[14]*o,t[3]=e[3]*n+e[7]*i+e[11]*a+e[15]*o,t}var wH=function(){var t=AA();return function(r,e,n,i,a,o){var s,u;for(e||(e=4),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],t[3]=r[s+3],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2],r[s+3]=t[3];return r}}();function OA(t,r){if(t===r)return!0;if(Array.isArray(t)){var e=t.length;if(!r||r.length!==e)return!1;for(var n=0;n<e;n++)if(t[n]!==r[n])return!1;return!0}return!1}function kt(t){var r={},e;return function(n){for(var i in n)if(!OA(n[i],r[i])){e=t(n),r=n;break}return e}}var Lg=[0,0,0,0],MA=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Dg=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],kA=[0,0,0],jg=[0,0,0],RA=kt(IA);function Hc(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:jg;e.length<3&&(e=[e[0],e[1],0]);var n=e,i,a=!0;switch(r===me.LNGLAT_OFFSETS||r===me.METER_OFFSETS?i=e:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case ut.WEB_MERCATOR:(r===me.LNGLAT||r===me.CARTESIAN)&&(i=[0,0,0],a=!1);break;case ut.WEB_MERCATOR_AUTO_OFFSET:r===me.LNGLAT?n=i:r===me.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(n),n[0]-=e[0],n[1]-=e[1],n[2]-=e[2]);break;case ut.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case ut.GLOBE:a=!1,i=null;break;default:a=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:a}}function CA(t,r,e){var n=t.viewMatrixUncentered,i=t.projectionMatrix,a=t.viewMatrix,o=t.viewProjectionMatrix,s=Lg,u=Lg,f=t.cameraPosition,c=Hc(t,r,e),h=c.geospatialOrigin,p=c.shaderCoordinateOrigin,d=c.offsetMode;return d&&(u=t.projectPosition(h||p),f=[f[0]-u[0],f[1]-u[1],f[2]-u[2]],u[3]=1,s=Ln([],u,o),a=n||a,o=In([],i,a),o=In([],o,MA)),{viewMatrix:a,viewProjectionMatrix:o,projectionCenter:s,originCommon:u,cameraPosCommon:f,shaderCoordinateOrigin:p,geospatialOrigin:h}}function qs(t){var r=t.viewport,e=t.devicePixelRatio,n=e===void 0?1:e,i=t.modelMatrix,a=i===void 0?null:i,o=t.coordinateSystem,s=o===void 0?me.DEFAULT:o,u=t.coordinateOrigin,f=u===void 0?jg:u,c=t.autoWrapLongitude,h=c===void 0?!1:c;s===me.DEFAULT&&(s=r.isGeospatial?me.LNGLAT:me.CARTESIAN);var p=RA({viewport:r,devicePixelRatio:n,coordinateSystem:s,coordinateOrigin:f});return p.project_uWrapLongitude=h,p.project_uModelMatrix=a||Dg,p}function IA(t){var r=t.viewport,e=t.devicePixelRatio,n=t.coordinateSystem,i=t.coordinateOrigin,a=CA(r,n,i),o=a.projectionCenter,s=a.viewProjectionMatrix,u=a.originCommon,f=a.cameraPosCommon,c=a.shaderCoordinateOrigin,h=a.geospatialOrigin,p=r.getDistanceScales(),d=[r.width*e,r.height*e],v=Ln([],[0,0,-r.focalDistance,1],r.projectionMatrix)[3]||1,m={project_uCoordinateSystem:n,project_uProjectionMode:r.projectionMode,project_uCoordinateOrigin:c,project_uCommonOrigin:u.slice(0,3),project_uCenter:o,project_uPseudoMeters:Boolean(r._pseudoMeters),project_uViewportSize:d,project_uDevicePixelRatio:e,project_uFocalDistance:v,project_uCommonUnitsPerMeter:p.unitsPerMeter,project_uCommonUnitsPerWorldUnit:p.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:kA,project_uScale:r.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:Dg,project_uCameraPosition:f};if(h){var g=r.getDistanceScales(h);switch(n){case me.METER_OFFSETS:m.project_uCommonUnitsPerWorldUnit=g.unitsPerMeter,m.project_uCommonUnitsPerWorldUnit2=g.unitsPerMeter2;break;case me.LNGLAT:case me.LNGLAT_OFFSETS:r._pseudoMeters||(m.project_uCommonUnitsPerMeter=g.unitsPerMeter),m.project_uCommonUnitsPerWorldUnit=g.unitsPerDegree,m.project_uCommonUnitsPerWorldUnit2=g.unitsPerDegree2;break;case me.CARTESIAN:m.project_uCommonUnitsPerWorldUnit=[1,1,g.unitsPerMeter[2]],m.project_uCommonUnitsPerWorldUnit2=[0,0,g.unitsPerMeter2[2]];break;default:break}}return m}var LA={};function DA(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:LA;return"viewport"in t?qs(t):{}}var Zr={name:"project",dependencies:[rs,Sg],vs:Ag,getUniforms:DA};function xi(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Kr(t,r){var e=vs([],r,t);return yv(e,e,1/e[3]),e}function Wc(t,r){var e=t%r;return e<0?r+e:e}function Fg(t,r,e){return e*r+(1-e)*t}function $a(t,r,e){return t<r?r:t>e?e:t}function jA(t){return Math.log(t)*Math.LOG2E}var Ti=Math.log2||jA;function Rt(t,r){if(!t)throw new Error(r||"@math.gl/web-mercator: assertion failed.")}var Ut=Math.PI,Ng=Ut/4,Ct=Ut/180,Yc=180/Ut,Ei=512,Zs=4003e4,Pi=85.051129,Xc=1.5;function Si(t){return Math.pow(2,t)}function Ks(t){return Ti(t)}function ct(t){var r=Z(t,2),e=r[0],n=r[1];Rt(Number.isFinite(e)),Rt(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var i=e*Ct,a=n*Ct,o=Ei*(i+Ut)/(2*Ut),s=Ei*(Ut+Math.log(Math.tan(Ng+a*.5)))/(2*Ut);return[o,s]}function rt(t){var r=Z(t,2),e=r[0],n=r[1],i=e/Ei*(2*Ut)-Ut,a=2*(Math.atan(Math.exp(n/Ei*(2*Ut)-Ut))-Ng);return[i*Yc,a*Yc]}function Ha(t){var r=t.latitude;Rt(Number.isFinite(r));var e=Math.cos(r*Ct);return Ks(Zs*e)-9}function Wa(t){var r=Math.cos(t*Ct);return Ei/Zs/r}function Dn(t){var r=t.latitude,e=t.longitude,n=t.highPrecision,i=n===void 0?!1:n;Rt(Number.isFinite(r)&&Number.isFinite(e));var a=Ei,o=Math.cos(r*Ct),s=a/360,u=s/o,f=a/Zs/o,c={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[s,u,f],degreesPerUnit:[1/s,1/u,1/f]};if(i){var h=Ct*Math.tan(r*Ct)/o,p=s*h/2,d=a/Zs*h,v=d/u*f;c.unitsPerDegree2=[0,p,d],c.unitsPerMeter2=[v,0,v]}return c}function Ya(t,r){var e=Z(t,3),n=e[0],i=e[1],a=e[2],o=Z(r,3),s=o[0],u=o[1],f=o[2],c=Dn({longitude:n,latitude:i,highPrecision:!0}),h=c.unitsPerMeter,p=c.unitsPerMeter2,d=ct(t);d[0]+=s*(h[0]+p[0]*u),d[1]+=u*(h[1]+p[1]*u);var v=rt(d),m=(a||0)+(f||0);return Number.isFinite(a)||Number.isFinite(f)?[v[0],v[1],m]:v}function Xa(t){var r=t.height,e=t.pitch,n=t.bearing,i=t.altitude,a=t.scale,o=t.center,s=xi();bn(s,s,[0,0,-i]),hs(s,s,-e*Ct),ps(s,s,n*Ct);var u=a/r;return pi(s,s,[u,u,u]),o&&bn(s,s,ev([],o)),s}function Qs(t){var r=t.width,e=t.height,n=t.altitude,i=t.pitch,a=i===void 0?0:i,o=t.offset,s=t.center,u=t.scale,f=t.nearZMultiplier,c=f===void 0?1:f,h=t.farZMultiplier,p=h===void 0?1:h,d=t.fovy,v=d===void 0?Pr(Xc):d;n!==void 0&&(v=Pr(n));var m=v*Ct,g=a*Ct,_=Qr(v),w=_;s&&(w+=s[2]*u/Math.cos(g)/e);var x=m*(.5+(o?o[1]:0)/e),P=Math.sin(x)*w/Math.sin($a(Math.PI/2-g-x,.01,Math.PI-.01)),E=Math.sin(g)*P+w,A=w*10,R=Math.min(E*p,A);return{fov:m,aspect:r/e,focalDistance:_,near:c,far:R}}function qc(t){var r=Qs(t),e=r.fov,n=r.aspect,i=r.near,a=r.far,o=ds([],e,n,i,a);return o}function Pr(t){return 2*Math.atan(.5/t)*Yc}function Qr(t){return .5/Math.tan(.5*t*Ct)}function jn(t,r){var e=Z(t,3),n=e[0],i=e[1],a=e[2],o=a===void 0?0:a;return Rt(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),Kr(r,[n,i,o,1])}function pt(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=Z(t,3),i=n[0],a=n[1],o=n[2];if(Rt(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o)){var s=Kr(r,[i,a,o,1]);return s}var u=Kr(r,[i,a,0,1]),f=Kr(r,[i,a,1,1]),c=u[2],h=f[2],p=c===h?0:((e||0)-c)/(h-c);return ss([],u,f,p)}function Ai(t){var r=t.width,e=t.height,n=t.bounds,i=t.minExtent,a=i===void 0?0:i,o=t.maxZoom,s=o===void 0?24:o,u=t.offset,f=u===void 0?[0,0]:u,c=Z(n,2),h=Z(c[0],2),p=h[0],d=h[1],v=Z(c[1],2),m=v[0],g=v[1],_=FA(t.padding),w=ct([p,$a(g,-Pi,Pi)]),x=ct([m,$a(d,-Pi,Pi)]),P=[Math.max(Math.abs(x[0]-w[0]),a),Math.max(Math.abs(x[1]-w[1]),a)],E=[r-_.left-_.right-Math.abs(f[0])*2,e-_.top-_.bottom-Math.abs(f[1])*2];Rt(E[0]>0&&E[1]>0);var A=E[0]/P[0],R=E[1]/P[1],D=(_.right-_.left)/2/A,j=(_.bottom-_.top)/2/R,I=[(x[0]+w[0])/2+D,(x[1]+w[1])/2+j],V=rt(I),F=Math.min(s,Ti(Math.abs(Math.min(A,R))));return Rt(Number.isFinite(F)),{longitude:V[0],latitude:V[1],zoom:F}}function FA(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Rt(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}var Bg=Math.PI/180;function Oi(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=t.width,n=t.height,i=t.unproject,a={targetZ:r},o=i([0,n],a),s=i([e,n],a),u,f,c=t.fovy?.5*t.fovy*Bg:Math.atan(.5/t.altitude),h=(90-t.pitch)*Bg;return c>h-.01?(u=Vg(t,0,r),f=Vg(t,e,r)):(u=i([0,0],a),f=i([e,0],a)),[o,s,f,u]}function Vg(t,r,e){var n=t.pixelUnprojectionMatrix,i=Kr(n,[r,0,1,1]),a=Kr(n,[r,t.height,1,1]),o=e*t.distanceScales.unitsPerMeter[2],s=(o-i[2])/(a[2]-i[2]),u=ss([],i,a,s),f=rt(u);return f.push(e),f}var zg=function(){function t(){var r=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{width:1,height:1};T(this,t),l(this,"latitude",void 0),l(this,"longitude",void 0),l(this,"zoom",void 0),l(this,"pitch",void 0),l(this,"bearing",void 0),l(this,"altitude",void 0),l(this,"fovy",void 0),l(this,"meterOffset",void 0),l(this,"center",void 0),l(this,"width",void 0),l(this,"height",void 0),l(this,"scale",void 0),l(this,"distanceScales",void 0),l(this,"viewMatrix",void 0),l(this,"projectionMatrix",void 0),l(this,"viewProjectionMatrix",void 0),l(this,"pixelProjectionMatrix",void 0),l(this,"pixelUnprojectionMatrix",void 0),l(this,"equals",function(F){return F instanceof t?F.width===r.width&&F.height===r.height&&ml(F.projectionMatrix,r.projectionMatrix)&&ml(F.viewMatrix,r.viewMatrix):!1}),l(this,"project",function(F){var G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},B=G.topLeft,K=B===void 0?!0:B,C=r.projectPosition(F),k=jn(C,r.pixelProjectionMatrix),U=Z(k,2),$=U[0],q=U[1],J=K?q:r.height-q;return F.length===2?[$,J]:[$,J,k[2]]}),l(this,"unproject",function(F){var G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},B=G.topLeft,K=B===void 0?!0:B,C=G.targetZ,k=C===void 0?void 0:C,U=Z(F,3),$=U[0],q=U[1],J=U[2],re=K?q:r.height-q,ae=k&&k*r.distanceScales.unitsPerMeter[2],le=pt([$,re,J],r.pixelUnprojectionMatrix,ae),ge=r.unprojectPosition(le),oe=Z(ge,3),ye=oe[0],se=oe[1],Fe=oe[2];return Number.isFinite(J)?[ye,se,Fe]:Number.isFinite(k)?[ye,se,k]:[ye,se]}),l(this,"projectPosition",function(F){var G=ct(F),B=Z(G,2),K=B[0],C=B[1],k=(F[2]||0)*r.distanceScales.unitsPerMeter[2];return[K,C,k]}),l(this,"unprojectPosition",function(F){var G=rt(F),B=Z(G,2),K=B[0],C=B[1],k=(F[2]||0)*r.distanceScales.metersPerUnit[2];return[K,C,k]});var n=e.width,i=e.height,a=e.altitude,o=a===void 0?null:a,s=e.fovy,u=s===void 0?null:s,f=e.latitude,c=f===void 0?0:f,h=e.longitude,p=h===void 0?0:h,d=e.zoom,v=d===void 0?0:d,m=e.pitch,g=m===void 0?0:m,_=e.bearing,w=_===void 0?0:_,x=e.position,P=x===void 0?null:x,E=e.nearZMultiplier,A=E===void 0?.02:E,R=e.farZMultiplier,D=R===void 0?1.01:R;n=n||1,i=i||1,u===null&&o===null?(o=Xc,u=Pr(o)):u===null?u=Pr(o):o===null&&(o=Qr(u));var j=Si(v);o=Math.max(.75,o);var I=Dn({longitude:p,latitude:c}),V=ct([p,c]);V.push(0),P&&Jd(V,V,uv([],P,I.unitsPerMeter)),this.projectionMatrix=qc({width:n,height:i,scale:j,center:V,pitch:g,fovy:u,nearZMultiplier:A,farZMultiplier:D}),this.viewMatrix=Xa({height:i,scale:j,center:V,pitch:g,bearing:w,altitude:o}),this.width=n,this.height=i,this.scale=j,this.latitude=c,this.longitude=p,this.zoom=v,this.pitch=g,this.bearing=w,this.altitude=o,this.fovy=u,this.center=V,this.meterOffset=P||[0,0,0],this.distanceScales=I,this._initMatrices(),Object.freeze(this)}return S(t,[{key:"_initMatrices",value:function(){var e=this.width,n=this.height,i=this.projectionMatrix,a=this.viewMatrix,o=xi();_n(o,o,i),_n(o,o,a),this.viewProjectionMatrix=o;var s=xi();pi(s,s,[e/2,-n/2,1]),bn(s,s,[1,-1,0]),_n(s,s,o);var u=cs(xi(),s);if(!u)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=u}},{key:"projectFlat",value:function(e){return ct(e)}},{key:"unprojectFlat",value:function(e){return rt(e)}},{key:"getMapCenterByLngLatPosition",value:function(e){var n=e.lngLat,i=e.pos,a=pt(i,this.pixelUnprojectionMatrix),o=ct(n),s=ga([],o,Yd([],a)),u=ga([],this.center,s);return rt(u)}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=this.width,a=this.height,o=Ai(Object.assign({width:i,height:a,bounds:e},n)),s=o.longitude,u=o.latitude,f=o.zoom;return new t({width:i,height:a,longitude:s,latitude:u,zoom:f})}},{key:"getBounds",value:function(e){var n=this.getBoundingRegion(e),i=Math.min.apply(Math,ue(n.map(function(u){return u[0]}))),a=Math.max.apply(Math,ue(n.map(function(u){return u[0]}))),o=Math.min.apply(Math,ue(n.map(function(u){return u[1]}))),s=Math.max.apply(Math,ue(n.map(function(u){return u[1]})));return[[i,o],[a,s]]}},{key:"getBoundingRegion",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Oi(this,e.z||0)}},{key:"getLocationAtPoint",value:function(e){var n=e.lngLat,i=e.pos;return this.getMapCenterByLngLatPosition({lngLat:n,pos:i})}}]),t}();var Ug=512;function Js(t){var r=t.width,e=t.height,n=t.pitch,i=n===void 0?0:n,a=t.longitude,o=t.latitude,s=t.zoom,u=t.bearing,f=u===void 0?0:u;(a<-180||a>180)&&(a=Wc(a+180,360)-180),(f<-180||f>180)&&(f=Wc(f+180,360)-180);var c=Ti(e/Ug);if(s<=c)s=c,o=0;else{var h=e/2/Math.pow(2,s),p=rt([0,h])[1];if(o<p)o=p;else{var d=rt([0,Ug-h])[1];o>d&&(o=d)}}return{width:r,height:e,longitude:a,latitude:o,zoom:s,pitch:i,bearing:f}}function Gg(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function $g(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Gg(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Gg(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function NA(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=BA(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function BA(t,r){if(t){if(typeof t=="string")return Hg(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Hg(t,r)}}function Hg(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Wg=.01,VA=["longitude","latitude","zoom"],Yg={curve:1.414,speed:1.2};function eu(t,r,e,n){var i=Xg(t,r,n),a=i.startZoom,o=i.startCenterXY,s=i.uDelta,u=i.w0,f=i.u1,c=i.S,h=i.rho,p=i.rho2,d=i.r0;if(f<Wg){var v={},m=NA(VA),g;try{for(m.s();!(g=m.n()).done;){var _=g.value,w=t[_],x=r[_];v[_]=Fg(w,x,e)}}catch(V){m.e(V)}finally{m.f()}return v}var P=e*c,E=Math.cosh(d)/Math.cosh(d+h*P),A=u*((Math.cosh(d)*Math.tanh(d+h*P)-Math.sinh(d))/p)/f,R=1/E,D=a+Ks(R),j=Hd([],s,A);ga(j,j,o);var I=rt(j);return{longitude:I[0],latitude:I[1],zoom:D}}function Zc(t,r,e){var n=$g($g({},Yg),e),i=n.screenSpeed,a=n.speed,o=n.maxDuration,s=Xg(t,r,n),u=s.S,f=s.rho,c=1e3*u,h;return Number.isFinite(i)?h=c/(i/f):h=c/a,Number.isFinite(o)&&h>o?0:h}function Xg(t,r,e){e=Object.assign({},Yg,e);var n=e.curve,i=t.zoom,a=[t.longitude,t.latitude],o=Si(i),s=r.zoom,u=[r.longitude,r.latitude],f=Si(s-i),c=ct(a),h=ct(u),p=qd([],h,c),d=Math.max(t.width,t.height),v=d/f,m=Wd(p)*o,g=Math.max(m,Wg),_=n*n,w=(v*v-d*d+_*_*g*g)/(2*d*_*g),x=(v*v-d*d-_*_*g*g)/(2*v*_*g),P=Math.log(Math.sqrt(w*w+1)-w),E=Math.log(Math.sqrt(x*x+1)-x),A=(E-P)/n;return{startZoom:i,startCenterXY:c,uDelta:p,w0:d,u1:m,S:A,rho:n,rho2:_,r0:P,r1:E}}function zA(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=UA(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function UA(t,r){if(t){if(typeof t=="string")return qg(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return qg(t,r)}}function qg(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var GA=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,$A=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,HA=kt(ZA),WA=kt(KA),YA=[0,0,0,1],XA=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function qA(t,r){var e=Z(t,3),n=e[0],i=e[1],a=e[2],o=pt([n,i,a],r);return Number.isFinite(a)?o:[o[0],o[1],0]}function ZA(t){var r=t.viewport,e=t.center;return new Ie(r.viewProjectionMatrix).invert().transform(e)}function KA(t){var r=t.viewport,e=t.shadowMatrices,n=[],i=r.pixelUnprojectionMatrix,a=r.isGeospatial?void 0:1,o=[[0,0,a],[r.width,0,a],[0,r.height,a],[r.width,r.height,a],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map(function(c){return qA(c,i)}),s=zA(e),u;try{var f=function(){var h=u.value,p=h.clone().translate(new We(r.center).negate()),d=o.map(function(m){return p.transform(m)}),v=new Ie().ortho({left:Math.min.apply(Math,ue(d.map(function(m){return m[0]}))),right:Math.max.apply(Math,ue(d.map(function(m){return m[0]}))),bottom:Math.min.apply(Math,ue(d.map(function(m){return m[1]}))),top:Math.max.apply(Math,ue(d.map(function(m){return m[1]}))),near:Math.min.apply(Math,ue(d.map(function(m){return-m[2]}))),far:Math.max.apply(Math,ue(d.map(function(m){return-m[2]})))});n.push(v.multiplyRight(h))};for(s.s();!(u=s.n()).done;)f()}catch(c){s.e(c)}finally{s.f()}return n}function QA(t,r){var e=t.shadowEnabled,n=e===void 0?!0:e;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};for(var i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||YA,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},a=HA({viewport:t.viewport,center:r.project_uCenter}),o=[],s=WA({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice(),u=0;u<t.shadowMatrices.length;u++){var f=s[u],c=f.clone().translate(new We(t.viewport.center).negate());r.project_uCoordinateSystem===me.LNGLAT&&r.project_uProjectionMode===ut.WEB_MERCATOR?(s[u]=c,o[u]=a):(s[u]=f.clone().multiplyRight(XA),o[u]=c.transform(a))}for(var h=0;h<s.length;h++)i["shadow_uViewProjectionMatrices[".concat(h,"]")]=s[h],i["shadow_uProjectCenters[".concat(h,"]")]=o[h],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(h)]=t.shadowMaps[h]:i["shadow_uShadowMap".concat(h)]=t.dummyShadowMap;return i}var Fn={name:"shadow",dependencies:[Zr],vs:GA,fs:$A,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in r&&(r.drawToShadowMap||r.shadowMaps&&r.shadowMaps.length>0)?QA(r,e):{}}};function Zg(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=JA(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function JA(t,r){if(t){if(typeof t=="string")return Kg(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Kg(t,r)}}function Kg(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var eO={color:[255,255,255],intensity:1},Qg=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],tO=[0,0,0,200/255],qa=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};T(this,t),l(this,"id","lighting-effect"),l(this,"props",void 0),l(this,"shadowColor",tO),l(this,"shadow",void 0),l(this,"ambientLight",void 0),l(this,"directionalLights",void 0),l(this,"pointLights",void 0),l(this,"shadowPasses",[]),l(this,"shadowMaps",[]),l(this,"dummyShadowMap",null),l(this,"programManager",void 0),l(this,"shadowMatrices",void 0),this.setProps(r)}return S(t,[{key:"setProps",value:function(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(var n in e){var i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(function(a){return a.shadow}),this.props=e}},{key:"preRender",value:function(e,n){var i=n.layers,a=n.layerFilter,o=n.viewports,s=n.onViewportActive,u=n.views;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=tr.getDefaultProgramManager(e),Fn&&this.programManager.addDefaultModule(Fn)),this.dummyShadowMap||(this.dummyShadowMap=new Le(e,{width:1,height:1}));for(var f=0;f<this.shadowPasses.length;f++){var c=this.shadowPasses[f];c.render({layers:i,layerFilter:a,viewports:o,onViewportActive:s,views:u,moduleParameters:{shadowLightId:f,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}}},{key:"getModuleParameters",value:function(e){var n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(function(i){return i.getProjectedLight({layer:e})}),pointLights:this.pointLights.map(function(i){return i.getProjectedLight({layer:e})})},n}},{key:"cleanup",value:function(){var e=Zg(this.shadowPasses),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Fn),this.programManager=null)}},{key:"_calculateMatrices",value:function(){var e=[],n=Zg(this.directionalLights),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=new Ie().lookAt({eye:new We(a.direction).negate()});e.push(o)}}catch(s){n.e(s)}finally{n.f()}return e}},{key:"_createShadowPasses",value:function(e){for(var n=0;n<this.directionalLights.length;n++){var i=new Eg(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}},{key:"_applyDefaultLights",value:function(){var e=this.ambientLight,n=this.pointLights,i=this.directionalLights;!e&&n.length===0&&i.length===0&&(this.ambientLight=new Ys(eO),this.directionalLights.push(new Cn(Qg[0]),new Cn(Qg[1])))}}]),t}();var rO=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};T(this,t),l(this,"_pool",[]),l(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(r)}return S(t,[{key:"setOptions",value:function(e){Object.assign(this.opts,e)}},{key:"allocate",value:function(e,n,i){var a=i.size,o=a===void 0?1:a,s=i.type,u=i.padding,f=u===void 0?0:u,c=i.copy,h=c===void 0?!1:c,p=i.initialize,d=p===void 0?!1:p,v=i.maxCount,m=s||e&&e.constructor||Float32Array,g=n*o+f;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new m(e.buffer,0,g)}var _=1/0;v&&(_=v*o+f);var w=this._allocate(m,g,d,_);return e&&h?w.set(e):d||w.fill(0,0,4),this._release(e),w}},{key:"release",value:function(e){this._release(e)}},{key:"_allocate",value:function(e,n,i,a){var o=Math.max(Math.ceil(n*this.opts.overAlloc),1);o>a&&(o=a);var s=this._pool,u=e.BYTES_PER_ELEMENT*o,f=s.findIndex(function(h){return h.byteLength>=u});if(f>=0){var c=new e(s.splice(f,1)[0],0,o);return i&&c.fill(0),c}return new e(o)}},{key:"_release",value:function(e){if(ArrayBuffer.isView(e)){var n=this._pool,i=e.buffer,a=i.byteLength,o=n.findIndex(function(s){return s.byteLength>=a});o<0?n.push(i):(o>0||n.length<this.opts.poolSize)&&n.splice(o,0,i),n.length>this.opts.poolSize&&n.shift()}}}]),t}(),Gt=new rO;function nO(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=iO(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function iO(t,r){if(t){if(typeof t=="string")return Jg(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Jg(t,r)}}function Jg(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function ki(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Nn(t,r){var e=t%r;return e<0?r+e:e}function ty(t){return[t[12],t[13],t[14]]}function ry(t){return{left:Mi(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Mi(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Mi(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Mi(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Mi(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Mi(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}var ey=new We;function Mi(t,r,e,n){ey.set(t,r,e);var i=ey.len();return{distance:n/i,normal:new We(-t/i,-r/i,-e/i)}}function Kc(t){return t-Math.fround(t)}var Za;function tu(t,r){var e=r.size,n=e===void 0?1:e,i=r.startIndex,a=i===void 0?0:i,o=r.endIndex!==void 0?r.endIndex:t.length,s=(o-a)/n;Za=Gt.allocate(Za,s,{type:Float32Array,size:n*2});for(var u=a,f=0;u<o;){for(var c=0;c<n;c++){var h=t[u++];Za[f+c]=h,Za[f+c+n]=Kc(h)}f+=n*2}return Za.subarray(0,s*n*2)}function ny(t){var r=null,e=!1,n=nO(t),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a&&(r?(e||(r=[[r[0][0],r[0][1]],[r[1][0],r[1][1]]],e=!0),r[0][0]=Math.min(r[0][0],a[0][0]),r[0][1]=Math.min(r[0][1],a[0][1]),r[1][0]=Math.max(r[1][0],a[1][0]),r[1][1]=Math.max(r[1][1],a[1][1])):r=a)}}catch(o){n.e(o)}finally{n.f()}return r}var aO=Math.PI/180,oO=ki(),iy=[0,0,0],sO={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function uO(t){var r=t.width,e=t.height,n=t.orthographic,i=t.fovyRadians,a=t.focalDistance,o=t.padding,s=t.near,u=t.far,f=r/e,c=n?new Ie().orthographic({fovy:i,aspect:f,focalDistance:a,near:s,far:u}):new Ie().perspective({fovy:i,aspect:f,near:s,far:u});if(o){var h=o.left,p=h===void 0?0:h,d=o.right,v=d===void 0?0:d,m=o.top,g=m===void 0?0:m,_=o.bottom,w=_===void 0?0:_,x=Te((p+r-v)/2,0,r)-r/2,P=Te((g+e-w)/2,0,e)-e/2;c[8]-=x*2/r,c[9]+=P*2/e}return c}var nt=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};T(this,t),l(this,"id",void 0),l(this,"x",void 0),l(this,"y",void 0),l(this,"width",void 0),l(this,"height",void 0),l(this,"padding",void 0),l(this,"isGeospatial",void 0),l(this,"zoom",void 0),l(this,"focalDistance",void 0),l(this,"position",void 0),l(this,"modelMatrix",void 0),l(this,"distanceScales",void 0),l(this,"scale",void 0),l(this,"center",void 0),l(this,"cameraPosition",void 0),l(this,"projectionMatrix",void 0),l(this,"viewMatrix",void 0),l(this,"viewMatrixUncentered",void 0),l(this,"viewMatrixInverse",void 0),l(this,"viewProjectionMatrix",void 0),l(this,"pixelProjectionMatrix",void 0),l(this,"pixelUnprojectionMatrix",void 0),l(this,"resolution",void 0),l(this,"_frustumPlanes",{}),this.id=r.id||this.constructor.displayName||"viewport",this.x=r.x||0,this.y=r.y||0,this.width=r.width||1,this.height=r.height||1,this.zoom=r.zoom||0,this.padding=r.padding,this.distanceScales=r.distanceScales||sO,this.focalDistance=r.focalDistance||1,this.position=r.position||iy,this.modelMatrix=r.modelMatrix||null;var e=r.longitude,n=r.latitude;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(r),this._initMatrices(r),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return S(t,[{key:"subViewports",get:function(){return null}},{key:"metersPerPixel",get:function(){return this.distanceScales.metersPerUnit[2]/this.scale}},{key:"projectionMode",get:function(){return this.isGeospatial?this.zoom<12?ut.WEB_MERCATOR:ut.WEB_MERCATOR_AUTO_OFFSET:ut.IDENTITY}},{key:"equals",value:function(e){return e instanceof t?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&bt(e.projectionMatrix,this.projectionMatrix)&&bt(e.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=this.projectPosition(e),s=jn(o,this.pixelProjectionMatrix),u=Z(s,2),f=u[0],c=u[1],h=a?c:this.height-c;return e.length===2?[f,h]:[f,h,s[2]]}},{key:"unproject",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=n.targetZ,s=Z(e,3),u=s[0],f=s[1],c=s[2],h=a?f:this.height-f,p=o&&o*this.distanceScales.unitsPerMeter[2],d=pt([u,h,c],this.pixelUnprojectionMatrix,p),v=this.unprojectPosition(d),m=Z(v,3),g=m[0],_=m[1],w=m[2];return Number.isFinite(c)?[g,_,w]:Number.isFinite(o)?[g,_,o]:[g,_]}},{key:"projectPosition",value:function(e){var n=this.projectFlat(e),i=Z(n,2),a=i[0],o=i[1],s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[a,o,s]}},{key:"unprojectPosition",value:function(e){var n=this.unprojectFlat(e),i=Z(n,2),a=i[0],o=i[1],s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[a,o,s]}},{key:"projectFlat",value:function(e){if(this.isGeospatial){var n=ct(e);return n[1]=Te(n[1],-318,830),n}return e}},{key:"unprojectFlat",value:function(e){return this.isGeospatial?rt(e):e}},{key:"getBounds",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n={targetZ:e.z||0},i=this.unproject([0,0],n),a=this.unproject([this.width,0],n),o=this.unproject([0,this.height],n),s=this.unproject([this.width,this.height],n);return[Math.min(i[0],a[0],o[0],s[0]),Math.min(i[1],a[1],o[1],s[1]),Math.max(i[0],a[0],o[0],s[0]),Math.max(i[1],a[1],o[1],s[1])]}},{key:"getDistanceScales",value:function(e){return e?Dn({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}},{key:"containsPixel",value:function(e){var n=e.x,i=e.y,a=e.width,o=a===void 0?1:a,s=e.height,u=s===void 0?1:s;return n<this.x+this.width&&this.x<n+o&&i<this.y+this.height&&this.y<i+u}},{key:"getFrustumPlanes",value:function(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,ry(this.viewProjectionMatrix)),this._frustumPlanes)}},{key:"panByPosition",value:function(e,n){return null}},{key:"_initProps",value:function(e){var n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=Ha({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Dn({latitude:i,longitude:n}));var a=Math.pow(2,this.zoom);this.scale=a;var o=e.position,s=e.modelMatrix,u=iy;if(o&&(u=s?new Ie(s).transformAsVector(o,[]):o),this.isGeospatial){var f=this.projectPosition([n,i,0]);this.center=new We(u).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(u)}},{key:"_initMatrices",value:function(e){var n=e.viewMatrix,i=n===void 0?oO:n,a=e.projectionMatrix,o=a===void 0?null:a,s=e.orthographic,u=s===void 0?!1:s,f=e.fovyRadians,c=e.fovy,h=c===void 0?75:c,p=e.near,d=p===void 0?.1:p,v=e.far,m=v===void 0?1e3:v,g=e.padding,_=g===void 0?null:g,w=e.focalDistance,x=w===void 0?1:w;this.viewMatrixUncentered=i,this.viewMatrix=new Ie().multiplyRight(i).translate(new We(this.center).negate()),this.projectionMatrix=o||uO({width:this.width,height:this.height,orthographic:u,fovyRadians:f||h*aO,focalDistance:x,padding:_,near:d,far:m});var P=ki();In(P,P,this.projectionMatrix),In(P,P,this.viewMatrix),this.viewProjectionMatrix=P,this.viewMatrixInverse=Gc([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=ty(this.viewMatrixInverse);var E=ki(),A=ki();Mg(E,E,[this.width/2,-this.height/2,1]),Og(E,E,[1,-1,0]),In(A,E,this.viewProjectionMatrix),this.pixelProjectionMatrix=A,this.pixelUnprojectionMatrix=Gc(ki(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||he.warn("Pixel project matrix not invertible")()}}]),t}();l(nt,"displayName","Viewport");function fO(){var t=new Er(2);return Er!=Float32Array&&(t[0]=0,t[1]=0),t}function Ri(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t}function ru(t,r){return t[0]=-r[0],t[1]=-r[1],t}var QW=function(){var t=fO();return function(r,e,n,i,a,o){var s,u;for(e||(e=2),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],a(t,t,o),r[s]=t[0],r[s+1]=t[1];return r}}();function oy(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ci(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?oy(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):oy(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function lO(t){var r=cO();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function cO(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Bn=function(t){N(e,t);var r=lO(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};T(this,e);var a=i.latitude,o=a===void 0?0:a,s=i.longitude,u=s===void 0?0:s,f=i.zoom,c=f===void 0?0:f,h=i.pitch,p=h===void 0?0:h,d=i.bearing,v=d===void 0?0:d,m=i.nearZMultiplier,g=m===void 0?.1:m,_=i.farZMultiplier,w=_===void 0?1.01:_,x=i.nearZ,P=i.farZ,E=i.orthographic,A=E===void 0?!1:E,R=i.projectionMatrix,D=i.repeat,j=D===void 0?!1:D,I=i.worldOffset,V=I===void 0?0:I,F=i.position,G=i.padding,B=i.legacyMeterSizes,K=B===void 0?!1:B,C=i.width,k=i.height,U=i.altitude,$=U===void 0?1.5:U,q=Math.pow(2,c);C=C||1,k=k||1;var J,re=null;if(R)$=R[5]/2,J=Pr($);else{i.fovy?(J=i.fovy,$=Qr(J)):J=Pr($);var ae;if(G){var le=G.top,ge=le===void 0?0:le,oe=G.bottom,ye=oe===void 0?0:oe;ae=[0,Te((ge+k-ye)/2,0,k)-k/2]}re=Qs({width:C,height:k,scale:q,center:F&&[0,0,F[2]*Wa(o)],offset:ae,pitch:p,fovy:J,nearZMultiplier:g,farZMultiplier:w}),Number.isFinite(x)&&(re.near=x),Number.isFinite(P)&&(re.far=P)}var se=Xa({height:k,pitch:p,bearing:v,scale:q,altitude:$});if(V){var Fe=new Ie().translate([512*V,0,0]);se=Fe.multiplyLeft(se)}return n=r.call(this,Ci(Ci(Ci({},i),{},{width:C,height:k,viewMatrix:se,longitude:u,latitude:o,zoom:c},re),{},{fovy:J,focalDistance:$})),l(W(n),"longitude",void 0),l(W(n),"latitude",void 0),l(W(n),"pitch",void 0),l(W(n),"bearing",void 0),l(W(n),"altitude",void 0),l(W(n),"fovy",void 0),l(W(n),"orthographic",void 0),l(W(n),"_subViewports",void 0),l(W(n),"_pseudoMeters",void 0),n.latitude=o,n.longitude=u,n.zoom=c,n.pitch=p,n.bearing=v,n.altitude=$,n.fovy=J,n.orthographic=A,n._subViewports=j?[]:null,n._pseudoMeters=K,Object.freeze(W(n)),n}return S(e,[{key:"subViewports",get:function(){if(this._subViewports&&!this._subViewports.length)for(var i=this.getBounds(),a=Math.floor((i[0]+180)/360),o=Math.ceil((i[2]-180)/360),s=a;s<=o;s++){var u=s?new e(Ci(Ci({},this),{},{worldOffset:s})):this;this._subViewports.push(u)}return this._subViewports}},{key:"projectPosition",value:function(i){if(this._pseudoMeters)return be(M(e.prototype),"projectPosition",this).call(this,i);var a=this.projectFlat(i),o=Z(a,2),s=o[0],u=o[1],f=(i[2]||0)*Wa(i[1]);return[s,u,f]}},{key:"unprojectPosition",value:function(i){if(this._pseudoMeters)return be(M(e.prototype),"unprojectPosition",this).call(this,i);var a=this.unprojectFlat(i),o=Z(a,2),s=o[0],u=o[1],f=(i[2]||0)/Wa(u);return[s,u,f]}},{key:"addMetersToLngLat",value:function(i,a){return Ya(i,a)}},{key:"panByPosition",value:function(i,a){var o=pt(a,this.pixelUnprojectionMatrix),s=this.projectFlat(i),u=Ri([],s,ru([],o)),f=Ri([],this.center,u),c=this.unprojectFlat(f),h=Z(c,2),p=h[0],d=h[1];return{longitude:p,latitude:d}}},{key:"getBounds",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=Oi(this,i.z||0);return[Math.min(a[0][0],a[1][0],a[2][0],a[3][0]),Math.min(a[0][1],a[1][1],a[2][1],a[3][1]),Math.max(a[0][0],a[1][0],a[2][0],a[3][0]),Math.max(a[0][1],a[1][1],a[2][1],a[3][1])]}},{key:"fitBounds",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,s=this.height,u=Ai(Ci({width:o,height:s,bounds:i},a)),f=u.longitude,c=u.latitude,h=u.zoom;return new e({width:o,height:s,longitude:f,latitude:c,zoom:h})}}]),e}(nt);l(Bn,"displayName","WebMercatorViewport");function hO(){var t=new Er(3);return Er!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function pO(t){var r=t[0],e=t[1],n=t[2];return Math.hypot(r,e,n)}function dO(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t}function vO(t){var r=t[0],e=t[1],n=t[2];return r*r+e*e+n*n}function sy(t,r,e,n){var i=r[0],a=r[1],o=r[2];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t[2]=o+n*(e[2]-o),t}var nu=dO;var uy=pO,iu=vO,h7=function(){var t=hO();return function(r,e,n,i,a,o){var s,u;for(e||(e=3),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2];return r}}();var ly=[0,0,0];function Qc(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=r.projectPosition(t);if(e&&r instanceof Bn){var i=Z(t,3),a=i[0],o=i[1],s=i[2],u=s===void 0?0:s,f=r.getDistanceScales([a,o]);n[2]=u*f.unitsPerMeter[2]}return n}function mO(t){var r=t.viewport,e=t.modelMatrix,n=t.coordinateOrigin,i=t.coordinateSystem,a=t.fromCoordinateSystem,o=t.fromCoordinateOrigin;return i===me.DEFAULT&&(i=r.isGeospatial?me.LNGLAT:me.CARTESIAN),a===void 0&&(a=i),o===void 0&&(o=n),{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:e,fromCoordinateSystem:a,fromCoordinateOrigin:o}}function Jc(t,r){var e=r.viewport,n=r.modelMatrix,i=r.coordinateSystem,a=r.coordinateOrigin,o=r.offsetMode,s=Z(t,3),u=s[0],f=s[1],c=s[2],h=c===void 0?0:c;if(n){var p=Ln([],[u,f,h,1],n),d=Z(p,3);u=d[0],f=d[1],h=d[2]}switch(i){case me.LNGLAT:return Qc([u,f,h],e,o);case me.LNGLAT_OFFSETS:return Qc([u+a[0],f+a[1],h+(a[2]||0)],e,o);case me.METER_OFFSETS:return Qc(Ya(a,[u,f,h]),e,o);case me.CARTESIAN:default:return e.isGeospatial?[u+a[0],f+a[1],h+a[2]]:e.projectPosition([u,f,h])}}function au(t,r){var e=mO(r),n=e.viewport,i=e.coordinateSystem,a=e.coordinateOrigin,o=e.modelMatrix,s=e.fromCoordinateSystem,u=e.fromCoordinateOrigin,f=r.autoOffset,c=f===void 0?!0:f,h=c?Hc(n,i,a):{},p=h.geospatialOrigin,d=p===void 0?ly:p,v=h.shaderCoordinateOrigin,m=v===void 0?ly:v,g=h.offsetMode,_=g===void 0?!1:g,w=Jc(t,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:u,offsetMode:_});if(_){var x=n.projectPosition(d||m);nu(w,w,x)}return w}function cy(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function gO(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?cy(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):cy(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var yO=[255,255,255],_O=1,bO=[0,0,1],wO=[0,0,1],xO=0,ou=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};T(this,t),l(this,"id",void 0),l(this,"color",void 0),l(this,"intensity",void 0),l(this,"type","point"),l(this,"position",void 0),l(this,"attenuation",void 0),l(this,"projectedLight",void 0);var e=r.color,n=e===void 0?yO:e,i=r.intensity,a=i===void 0?_O:i,o=r.position,s=o===void 0?wO:o;this.id=r.id||"point-".concat(xO++),this.color=n,this.intensity=a,this.type="point",this.position=s,this.attenuation=TO(r),this.projectedLight=gO({},this)}return S(t,[{key:"getProjectedLight",value:function(e){var n=e.layer,i=this.projectedLight,a=n.context.viewport,o=n.props,s=o.coordinateSystem,u=o.coordinateOrigin,f=au(this.position,{viewport:a,coordinateSystem:s,coordinateOrigin:u,fromCoordinateSystem:a.isGeospatial?me.LNGLAT:me.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return i.color=this.color,i.intensity=this.intensity,i.position=f,i}}]),t}();function TO(t){return t.attenuation?t.attenuation:"intensity"in t?[0,0,t.intensity||0]:bO}function EO(t){var r=PO();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function PO(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hy=function(t){N(e,t);var r=EO(e);function e(){return T(this,e),r.apply(this,arguments)}return S(e,[{key:"getProjectedLight",value:function(i){var a=i.layer,o=this.projectedLight,s=a.context.viewport,u=a.props,f=u.coordinateSystem,c=u.coordinateOrigin,h=u.modelMatrix,p=qs({viewport:s,modelMatrix:h,coordinateSystem:f,coordinateOrigin:c}),d=p.project_uCameraPosition;return o.color=this.color,o.intensity=this.intensity,o.position=d,o}}]),e}(ou);var Vn=Math.PI/180,SO=1e3*60*60*24,AO=2440588,OO=2451545,su=Vn*23.4397,MO=357.5291,kO=.98560028,RO=280.147,CO=360.9856235;function py(t,r,e){var n=Vn*-e,i=Vn*r,a=LO(t),o=UO(a),s=BO(a,n)-o.rightAscension;return{azimuth:FO(s,i,o.declination),altitude:NO(s,i,o.declination)}}function uu(t,r,e){var n=py(t,r,e),i=n.azimuth,a=n.altitude;return[Math.sin(i)*Math.cos(a),Math.cos(i)*Math.cos(a),-Math.sin(a)]}function IO(t){var r=typeof t=="number"?t:t.getTime();return r/SO-.5+AO}function LO(t){return IO(t)-OO}function DO(t,r){var e=t;return Math.atan2(Math.sin(e)*Math.cos(su)-Math.tan(r)*Math.sin(su),Math.cos(e))}function jO(t,r){var e=t;return Math.asin(Math.sin(r)*Math.cos(su)+Math.cos(r)*Math.sin(su)*Math.sin(e))}function FO(t,r,e){var n=t,i=r,a=e;return Math.atan2(Math.sin(n),Math.cos(n)*Math.sin(i)-Math.tan(a)*Math.cos(i))}function NO(t,r,e){var n=t,i=r,a=e;return Math.asin(Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos(n))}function BO(t,r){return Vn*(RO+CO*t)-r}function VO(t){return Vn*(MO+kO*t)}function zO(t){var r=t,e=Vn*(1.9148*Math.sin(r)+.02*Math.sin(2*r)+3e-4*Math.sin(3*r)),n=Vn*102.9372;return r+e+n+Math.PI}function UO(t){var r=VO(t),e=zO(r);return{declination:jO(e,0),rightAscension:DO(e,0)}}function GO(t){var r=$O();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function $O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var dy=function(t){N(e,t);var r=GO(e);function e(n){var i;return T(this,e),i=r.call(this,n),l(W(i),"timestamp",void 0),i.timestamp=n.timestamp,i}return S(e,[{key:"getProjectedLight",value:function(i){var a=i.layer,o=a.context.viewport,s=o.resolution&&o.resolution>0;if(s){var u=uu(this.timestamp,0,0),f=Z(u,3),c=f[0],h=f[1],p=f[2];this.direction=[c,-p,h]}else{var d=o.latitude,v=o.longitude;this.direction=uu(this.timestamp,d,v)}return this}}]),e}(Cn);function HO(t){var r=WO();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function WO(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var eh=function(t){N(e,t);var r=HO(e);function e(n,i){var a;T(this,e),a=r.call(this,n,i),l(W(a),"model",void 0);var o=i.module,s=i.fs,u=i.id;return a.model=new Rs(n,{id:u,fs:s,modules:[o]}),a}return S(e,[{key:"render",value:function(i){var a=this,o=this.gl;Xe(o,{viewport:[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}),Ae(o,{framebuffer:i.outputBuffer,clearColor:[0,0,0,0]},function(){return a._renderPass(o,i)})}},{key:"delete",value:function(){this.model.delete(),this.model=null}},{key:"_renderPass",value:function(i,a){var o=a.inputBuffer;Jt(i,{color:!0}),this.model.draw({moduleSettings:a.moduleSettings,uniforms:{texture:o,texSize:[o.width,o.height]},parameters:{depthWrite:!1,depthTest:!1}})}}]),e}(Xs);function YO(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=XO(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function XO(t,r){if(t){if(typeof t=="string")return vy(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return vy(t,r)}}function vy(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var gy=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};T(this,t),l(this,"id",void 0),l(this,"props",void 0),l(this,"module",void 0),l(this,"passes",void 0),this.id="".concat(r.name,"-pass"),this.props=e,Zo(r),this.module=r}return S(t,[{key:"setProps",value:function(e){this.props=e}},{key:"preRender",value:function(){}},{key:"postRender",value:function(e,n){var i=this.passes||qO(e,this.module,this.id);this.passes=i;for(var a=n.target,o=n.inputBuffer,s=n.swapBuffer,u=0;u<this.passes.length;u++){a&&u===this.passes.length-1&&(s=a),this.passes[u].render({inputBuffer:o,outputBuffer:s,moduleSettings:this.props});var f=s;s=o,o=f}return o}},{key:"cleanup",value:function(){if(this.passes){var e=YO(this.passes),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.passes=void 0}}}]),t}();function qO(t,r,e){if(!r.passes){var n=my(r),i=new eh(t,{id:e,module:r,fs:n});return[i]}return r.passes.map(function(a,o){var s=my(r,a),u="".concat(e,"-").concat(o);return new eh(t,{id:u,module:r,fs:s})})}var ZO=function(r){return`uniform sampler2D texture;
uniform vec2 texSize;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main() {
  vec2 texCoord = coordinate;

  gl_FragColor = texture2D(texture, texCoord);
  gl_FragColor = `.concat(r,`(gl_FragColor, texSize, texCoord);
}
`)},KO=function(r){return`uniform sampler2D texture;
uniform vec2 texSize;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main() {
  vec2 texCoord = coordinate;

  gl_FragColor = `.concat(r,`(texture, texSize, texCoord);
}
`)};function my(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t;if(r.filter){var e=typeof r.filter=="string"?r.filter:"".concat(t.name,"_filterColor");return ZO(e)}if(r.sampler){var n=typeof r.sampler=="string"?r.sampler:"".concat(t.name,"_sampleColor");return KO(n)}return null}function yy(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function th(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?yy(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):yy(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function QO(t){var r=JO();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function JO(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _y={blendFunc:[1,0,32771,0],blendEquation:32774},Ii=function(t){N(e,t);var r=QO(e);function e(){var n;T(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),l(W(n),"pickZ",void 0),l(W(n),"_colorEncoderState",null),n}return S(e,[{key:"render",value:function(i){return"pickingFBO"in i?this._drawPickingBuffer(i):be(M(e.prototype),"render",this).call(this,i)}},{key:"_drawPickingBuffer",value:function(i){var a=this,o=i.layers,s=i.layerFilter,u=i.views,f=i.viewports,c=i.onViewportActive,h=i.pickingFBO,p=i.deviceRect,d=p.x,v=p.y,m=p.width,g=p.height,_=i.cullRect,w=i.effects,x=i.pass,P=x===void 0?"picking":x,E=i.pickZ,A=i.moduleParameters,R=this.gl;this.pickZ=E;var D=this._resetColorEncoder(E),j=Ae(R,th(th({scissorTest:!0,scissor:[d,v,m,g],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]},_y),{},{blend:!E}),function(){return be(M(e.prototype),"render",a).call(a,{target:h,layers:o,layerFilter:s,views:u,viewports:f,onViewportActive:c,cullRect:_,effects:w?.filter(function(V){return V.useInPicking}),pass:P,isPicking:!0,moduleParameters:A})});this._colorEncoderState=null;var I=D&&t2.bind(null,D);return{decodePickingColor:I,stats:j}}},{key:"shouldDrawLayer",value:function(i){var a=i.props,o=a.pickable,s=a.operation;return o&&s.includes("draw")||s.includes("terrain")||s.includes("mask")}},{key:"getModuleParameters",value:function(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}},{key:"getLayerParameters",value:function(i,a,o){var s=th({},i.props.parameters),u=i.props,f=u.pickable,c=u.operation;return this._colorEncoderState?f&&c.includes("draw")&&(Object.assign(s,_y),s.blend=!0,s.blendColor=e2(this._colorEncoderState,i,o)):s.blend=!1,c.includes("terrain")&&(s.blend=!1),s}},{key:"_resetColorEncoder",value:function(i){return this._colorEncoderState=i?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}]),e}(qr);function e2(t,r,e){var n=t.byLayer,i=t.byAlpha,a,o=n.get(r);return o?(o.viewports.push(e),a=o.a):(a=n.size+1,a<=255?(o={a,layer:r,viewports:[e]},n.set(r,o),i[a]=o):(he.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function t2(t,r){var e=t.byAlpha[r[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(r)}}var Jr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Li=Symbol.for("component"),It=Symbol.for("propTypes"),fu=Symbol.for("deprecatedProps"),Sr=Symbol.for("asyncPropDefaults"),sr=Symbol.for("asyncPropOriginal"),$t=Symbol.for("asyncPropResolved");function en(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};return Array.isArray(t)?by(t,r,[]):r(t)?[t]:[]}function by(t,r,e){for(var n=-1;++n<t.length;){var i=t[n];Array.isArray(i)?by(i,r,e):r(i)&&e.push(i)}return e}function lu(t){for(var r=t.target,e=t.source,n=t.start,i=n===void 0?0:n,a=t.count,o=a===void 0?1:a,s=e.length,u=o*s,f=0,c=i;f<s;f++)r[c++]=e[f];for(;f<u;)f<u-f?(r.copyWithin(i+f,i,i+f),f*=2):(r.copyWithin(i+f,i,i+u-f),f=u);return r}function r2(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=n2(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function n2(t,r){if(t){if(typeof t=="string")return wy(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return wy(t,r)}}function wy(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var xy=function(){function t(r,e,n){T(this,t),l(this,"id",void 0),l(this,"context",void 0),l(this,"isLoaded",void 0),l(this,"persistent",void 0),l(this,"_loadCount",0),l(this,"_subscribers",new Set),l(this,"_data",void 0),l(this,"_loader",void 0),l(this,"_error",void 0),l(this,"_content",void 0),this.id=r,this.context=n,this.setData(e)}return S(t,[{key:"subscribe",value:function(e){this._subscribers.add(e)}},{key:"unsubscribe",value:function(e){this._subscribers.delete(e)}},{key:"inUse",value:function(){return this._subscribers.size>0}},{key:"delete",value:function(){}},{key:"getData",value:function(){var e=this;return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(function(){return e.getData()})}},{key:"setData",value:function(e,n){var i=this;if(!(e===this._data&&!n)){this._data=e;var a=++this._loadCount,o=e;typeof e=="string"&&(o=Xr(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(function(c){i._loadCount===a&&(i.isLoaded=!0,i._error=void 0,i._content=c)}).catch(function(c){i._loadCount===a&&(i.isLoaded=!0,i._error=c||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);var s=r2(this._subscribers),u;try{for(s.s();!(u=s.n()).done;){var f=u.value;f.onChange(this.getData())}}catch(c){s.e(c)}finally{s.f()}}}}]),t}();var Ty=function(){function t(r){var e=r.gl,n=r.protocol;T(this,t),l(this,"protocol",void 0),l(this,"_context",void 0),l(this,"_resources",void 0),l(this,"_consumers",void 0),l(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}return S(t,[{key:"contains",value:function(e){return e.startsWith(this.protocol)?!0:e in this._resources}},{key:"add",value:function(e){var n=e.resourceId,i=e.data,a=e.forceUpdate,o=a===void 0?!1:a,s=e.persistent,u=s===void 0?!0:s,f=this._resources[n];f?f.setData(i,o):(f=new xy(n,i,this._context),this._resources[n]=f),f.persistent=u}},{key:"remove",value:function(e){var n=this._resources[e];n&&(n.delete(),delete this._resources[e])}},{key:"unsubscribe",value:function(e){var n=e.consumerId,i=this._consumers[n];if(i){for(var a in i){var o=i[a],s=this._resources[o.resourceId];s&&s.unsubscribe(o)}delete this._consumers[n],this.prune()}}},{key:"subscribe",value:function(e){var n=e.resourceId,i=e.onChange,a=e.consumerId,o=e.requestId,s=o===void 0?"default":o,u=this._resources,f=this.protocol;n.startsWith(f)&&(n=n.replace(f,""),u[n]||this.add({resourceId:n,data:null,persistent:!1}));var c=u[n];if(this._track(a,s,c,i),c)return c.getData()}},{key:"prune",value:function(){var e=this;this._pruneRequest||(this._pruneRequest=setTimeout(function(){return e._prune()},0))}},{key:"finalize",value:function(){for(var e in this._resources)this._resources[e].delete()}},{key:"_track",value:function(e,n,i,a){var o=this._consumers,s=o[e]=o[e]||{},u=s[n]||{},f=u.resourceId&&this._resources[u.resourceId];f&&(f.unsubscribe(u),this.prune()),i&&(s[n]=u,u.onChange=a,u.resourceId=i.id,i.subscribe(u))}},{key:"_prune",value:function(){this._pruneRequest=null;for(var e=0,n=Object.keys(this._resources);e<n.length;e++){var i=n[e],a=this._resources[i];!a.persistent&&!a.inUse()&&(a.delete(),delete this._resources[i])}}}]),t}();var i2=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,rh={name:"project32",dependencies:[Zr],vs:i2};function Ey(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function a2(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Ey(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Ey(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var nh=a2({inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},ys);function Py(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=o2(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function o2(t,r){if(t){if(typeof t=="string")return Sy(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Sy(t,r)}}function Sy(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var s2=[Zr],u2=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Ay(t){var r=tr.getDefaultProgramManager(t),e=Py(s2),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;r.addDefaultModule(i)}}catch(u){e.e(u)}finally{e.f()}var a=Py(u2),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;r.addShaderHook(s)}}catch(u){a.e(u)}finally{a.f()}return r}function Ka(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=f2(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function f2(t,r){if(t){if(typeof t=="string")return Oy(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Oy(t,r)}}function Oy(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var l2="layerManager.setLayers",c2="layerManager.activateViewport",cu=function(){function t(r){var e=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.deck,a=n.stats,o=n.viewport,s=n.timeline;T(this,t),l(this,"layers",void 0),l(this,"context",void 0),l(this,"resourceManager",void 0),l(this,"_lastRenderedLayers",[]),l(this,"_needsRedraw",!1),l(this,"_needsUpdate",!1),l(this,"_nextLayers",null),l(this,"_debug",!1),l(this,"activateViewport",function(u){ze(c2,e,u),u&&(e.context.viewport=u)}),this.layers=[],this.resourceManager=new Ty({gl:r,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:r,deck:i,programManager:r&&Ay(r),stats:a||new pn({id:"deck.gl"}),viewport:o||new nt({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new Wr,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}return S(t,[{key:"finalize",value:function(){this.resourceManager.finalize();var e=Ka(this.layers),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;this._finalizeLayer(i)}}catch(a){e.e(a)}finally{e.f()}}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);var i=Ka(this.layers),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.getNeedsRedraw(e);n=n||s}}catch(u){i.e(u)}finally{i.f()}return n}},{key:"needsUpdate",value:function(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}},{key:"setNeedsRedraw",value:function(e){this._needsRedraw=this._needsRedraw||e}},{key:"setNeedsUpdate",value:function(e){this._needsUpdate=this._needsUpdate||e}},{key:"getLayers",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.layerIds;return n?this.layers.filter(function(i){return n.find(function(a){return i.id.indexOf(a)===0})}):this.layers}},{key:"setProps",value:function(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}},{key:"setLayers",value:function(e,n){ze(l2,this,n,e),this._lastRenderedLayers=e;var i=en(e,Boolean),a=Ka(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.context=this.context}}catch(u){a.e(u)}finally{a.f()}this._updateLayers(this.layers,i)}},{key:"updateLayers",value:function(){var e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}},{key:"_handleError",value:function(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}},{key:"_updateLayers",value:function(e,n){var i={},a=Ka(e),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;i[s.id]?he.warn("Multiple old layers with same id ".concat(s.id))():i[s.id]=s}}catch(d){a.e(d)}finally{a.f()}var u=[];this._updateSublayersRecursively(n,i,u),this._finalizeOldLayers(i);for(var f=!1,c=0,h=u;c<h.length;c++){var p=h[c];if(p.hasUniformTransition()){f="Uniform transition in ".concat(p);break}}this._needsUpdate=f,this.layers=u}},{key:"_updateSublayersRecursively",value:function(e,n,i){var a=Ka(e),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.context=this.context;var u=n[s.id];u===null&&he.warn("Multiple new layers with same id ".concat(s.id))(),n[s.id]=null;var f=null;try{this._debug&&u!==s&&s.validateProps(),u?(this._transferLayerState(u,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),f=s.isComposite?s.getSubLayers():null}catch(c){this._handleError("matching",c,s)}f&&this._updateSublayersRecursively(f,n,i)}}catch(c){a.e(c)}finally{a.f()}}},{key:"_finalizeOldLayers",value:function(e){for(var n in e){var i=e[n];i&&this._finalizeLayer(i)}}},{key:"_initializeLayer",value:function(e){try{e._initialize(),e.lifecycle=Jr.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}},{key:"_transferLayerState",value:function(e,n){n._transferState(e),n.lifecycle=Jr.MATCHED,n!==e&&(e.lifecycle=Jr.AWAITING_GC)}},{key:"_updateLayer",value:function(e){try{e._update()}catch(n){this._handleError("update",n,e)}}},{key:"_finalizeLayer",value:function(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Jr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Jr.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}]),t}();function Ze(t,r,e){if(t===r)return!0;if(!e||!t||!r)return!1;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var n=0;n<t.length;n++)if(!Ze(t[n],r[n],e-1))return!1;return!0}if(Array.isArray(r))return!1;if(ne(t)==="object"&&ne(r)==="object"){var i=Object.keys(t),a=Object.keys(r);if(i.length!==a.length)return!1;for(var o=0,s=i;o<s.length;o++){var u=s[o];if(!r.hasOwnProperty(u)||!Ze(t[u],r[u],e-1))return!1}return!0}return!1}function My(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Qa(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?My(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):My(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var ky=function(){function t(r){T(this,t),l(this,"width",void 0),l(this,"height",void 0),l(this,"views",void 0),l(this,"viewState",void 0),l(this,"controllers",void 0),l(this,"timeline",void 0),l(this,"_viewports",void 0),l(this,"_viewportMap",void 0),l(this,"_isUpdating",void 0),l(this,"_needsRedraw",void 0),l(this,"_needsUpdate",void 0),l(this,"_eventManager",void 0),l(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=r.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=r.eventManager,this._eventCallbacks={onViewStateChange:r.onViewStateChange,onInteractionStateChange:r.onInteractionStateChange},Object.seal(this),this.setProps(r)}return S(t,[{key:"finalize",value:function(){for(var e in this.controllers){var n=this.controllers[e];n&&n.finalize()}this.controllers={}}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}},{key:"setNeedsUpdate",value:function(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}},{key:"updateViewStates",value:function(){for(var e in this.controllers){var n=this.controllers[e];n&&n.updateTransition()}}},{key:"getViewports",value:function(e){return e?this._viewports.filter(function(n){return n.containsPixel(e)}):this._viewports}},{key:"getViews",value:function(){var e={};return this.views.forEach(function(n){e[n.id]=n}),e}},{key:"getView",value:function(e){return this.views.find(function(n){return n.id===e})}},{key:"getViewState",value:function(e){var n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}},{key:"getViewport",value:function(e){return this._viewportMap[e]}},{key:"unproject",value:function(e,n){for(var i=this.getViewports(),a={x:e[0],y:e[1]},o=i.length-1;o>=0;--o){var s=i[o];if(s.containsPixel(a)){var u=e.slice();return u[0]-=s.x,u[1]-=s.y,s.unproject(u,n)}}return null}},{key:"setProps",value:function(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}},{key:"_update",value:function(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}},{key:"_setSize",value:function(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}},{key:"_setViews",value:function(e){e=en(e,Boolean);var n=this._diffViews(e,this.views);n&&this.setNeedsUpdate("views changed"),this.views=e}},{key:"_setViewState",value:function(e){if(e){var n=!Ze(e,this.viewState,3);n&&this.setNeedsUpdate("viewState changed"),this.viewState=e}else he.warn("missing `viewState` or `initialViewState`")()}},{key:"_onViewStateChange",value:function(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange(Qa(Qa({},n),{},{viewId:e}))}},{key:"_createController",value:function(e,n){var i=this,a=n.type,o=new a({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:function(u){var f;return(f=i.getView(e.id))===null||f===void 0?void 0:f.makeViewport({viewState:u,width:i.width,height:i.height})}});return o}},{key:"_updateController",value:function(e,n,i,a){var o=e.controller;if(o&&i){var s=Qa(Qa(Qa({},n),o),{},{id:e.id,x:i.x,y:i.y,width:i.width,height:i.height});return(!a||a.constructor!==o.type)&&(a=this._createController(e,s)),a&&a.setProps(s),a}return null}},{key:"_rebuildViewports",value:function(){var e=this.views,n=this.controllers;this._viewports=[],this.controllers={};for(var i=!1,a=e.length;a--;){var o=e[a],s=this.getViewState(o),u=o.makeViewport({viewState:s,width:this.width,height:this.height}),f=n[o.id],c=Boolean(o.controller);c&&!f&&(i=!0),(i||!c)&&f&&(f.finalize(),f=null),this.controllers[o.id]=this._updateController(o,s,u,f),u&&this._viewports.unshift(u)}for(var h in n){var p=n[h];p&&!this.controllers[h]&&p.finalize()}this._buildViewportMap()}},{key:"_buildViewportMap",value:function(){var e=this;this._viewportMap={},this._viewports.forEach(function(n){n.id&&(e._viewportMap[n.id]=e._viewportMap[n.id]||n)})}},{key:"_diffViews",value:function(e,n){return e.length!==n.length?!0:e.some(function(i,a){return!e[a].equals(n[a])})}}]),t}();var h2=/([0-9]+\.?[0-9]*)(%|px)/;function Ar(t){switch(ne(t)){case"number":return{position:t,relative:!1};case"string":var r=h2.exec(t);if(r&&r.length>=3){var e=r[2]==="%",n=parseFloat(r[1]);return{position:e?n/100:n,relative:e}}default:throw new Error("Could not parse position string ".concat(t))}}function Or(t,r){return t.relative?Math.round(t.position*r):t.position}function Se(t,r){if(!t)throw new Error(r||"deck.gl: assertion failed.")}function Ry(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function zn(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Ry(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Ry(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Lt=function(){function t(r){T(this,t),l(this,"id",void 0),l(this,"viewportInstance",void 0),l(this,"_x",void 0),l(this,"_y",void 0),l(this,"_width",void 0),l(this,"_height",void 0),l(this,"_padding",void 0),l(this,"props",void 0);var e=r||{},n=e.id,i=e.x,a=i===void 0?0:i,o=e.y,s=o===void 0?0:o,u=e.width,f=u===void 0?"100%":u,c=e.height,h=c===void 0?"100%":c,p=e.padding,d=p===void 0?null:p,v=e.viewportInstance;Se(!v||v instanceof nt),this.viewportInstance=v,this.id=n||this.constructor.displayName||"view",this.props=zn(zn({},r),{},{id:this.id}),this._x=Ar(a),this._y=Ar(s),this._width=Ar(f),this._height=Ar(h),this._padding=d&&{left:Ar(d.left||0),right:Ar(d.right||0),top:Ar(d.top||0),bottom:Ar(d.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}return S(t,[{key:"equals",value:function(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Ze(this.props,e.props,2)}},{key:"makeViewport",value:function(e){var n=e.width,i=e.height,a=e.viewState;if(this.viewportInstance)return this.viewportInstance;a=this.filterViewState(a);var o=this.getDimensions({width:n,height:i});return!o.height||!o.width?null:new this.ViewportType(zn(zn(zn({},a),this.props),o))}},{key:"getViewStateId",value:function(){var e=this.props.viewState;return typeof e=="string"?e:e?.id||this.id}},{key:"filterViewState",value:function(e){if(this.props.viewState&&ne(this.props.viewState)==="object"){if(!this.props.viewState.id)return this.props.viewState;var n=zn({},e);for(var i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}},{key:"getDimensions",value:function(e){var n=e.width,i=e.height,a={x:Or(this._x,n),y:Or(this._y,i),width:Or(this._width,n),height:Or(this._height,i)};return this._padding&&(a.padding={left:Or(this._padding.left,n),top:Or(this._padding.top,i),right:Or(this._padding.right,n),bottom:Or(this._padding.bottom,i)}),a}},{key:"controller",get:function(){var e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:zn({type:this.ControllerType},e):null}}]),t}();var ur=function(){function t(r){T(this,t),l(this,"_inProgress",void 0),l(this,"_handle",void 0),l(this,"_timeline",void 0),l(this,"time",void 0),l(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=r,this.time=0,this.settings={duration:0}}return S(t,[{key:"inProgress",get:function(){return this._inProgress}},{key:"start",value:function(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}},{key:"end",value:function(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}},{key:"cancel",value:function(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}},{key:"update",value:function(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){var i=this._timeline,a=this.settings;this._handle=i.addChannel({delay:i.getTime(),duration:a.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}},{key:"_onUpdate",value:function(){}}]),t}();function Cy(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function hu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Cy(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Cy(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Iy=function(){},Ja={BREAK:1,SNAP_TO_END:2,IGNORE:3},p2=function(r){return r},d2=Ja.BREAK,Ly=function(){function t(r){var e=this;T(this,t),l(this,"getControllerState",void 0),l(this,"props",void 0),l(this,"propsInTransition",void 0),l(this,"transition",void 0),l(this,"onViewStateChange",void 0),l(this,"onStateChange",void 0),l(this,"_onTransitionUpdate",function(n){var i=n.time,a=n.settings,o=a.interpolator,s=a.startProps,u=a.endProps,f=a.duration,c=a.easing,h=c(i/f),p=o.interpolateProps(s,u,h);e.propsInTransition=e.getControllerState(hu(hu({},e.props),p)).getViewportProps(),e.onViewStateChange({viewState:e.propsInTransition,oldViewState:e.props})}),this.getControllerState=r.getControllerState,this.propsInTransition=null,this.transition=new ur(r.timeline),this.onViewStateChange=r.onViewStateChange||Iy,this.onStateChange=r.onStateChange||Iy}return S(t,[{key:"finalize",value:function(){this.transition.cancel()}},{key:"getViewportInTransition",value:function(){return this.propsInTransition}},{key:"processViewStateChange",value:function(e){var n=!1,i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){var a=i;if(this.transition.inProgress){var o=this.transition.settings,s=o.interruption,u=o.endProps;a=hu(hu({},i),s===Ja.SNAP_TO_END?u:this.propsInTransition||i)}this._triggerTransition(a,e),n=!0}else this.transition.cancel();return n}},{key:"updateTransition",value:function(){this.transition.update()}},{key:"_isTransitionEnabled",value:function(e){var n=e.transitionDuration,i=e.transitionInterpolator;return(n>0||n==="auto")&&Boolean(i)}},{key:"_isUpdateDueToCurrentTransition",value:function(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(e,n){return this.transition.inProgress?this.transition.settings.interruption===Ja.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}},{key:"_triggerTransition",value:function(e,n){var i=this.getControllerState(e),a=this.getControllerState(n).shortestPathFrom(i),o=n.transitionInterpolator,s=o.getDuration?o.getDuration(e,n):n.transitionDuration;if(s!==0){var u=o.initializeProps(e,a);this.propsInTransition={};var f={duration:s,easing:n.transitionEasing||p2,interpolator:o,interruption:n.transitionInterruption||d2,startProps:u.start,endProps:u.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}}},{key:"_onTransitionEnd",value:function(e){var n=this;return function(i){n.propsInTransition=null,n.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(i)}}}]),t}();function Dy(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=v2(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function v2(t,r){if(t){if(typeof t=="string")return jy(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return jy(t,r)}}function jy(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Di=function(){function t(r){T(this,t),l(this,"_propsToCompare",void 0),l(this,"_propsToExtract",void 0),l(this,"_requiredProps",void 0);var e=r.compare,n=r.extract,i=r.required;this._propsToCompare=e,this._propsToExtract=n||e,this._requiredProps=i}return S(t,[{key:"arePropsEqual",value:function(e,n){var i=Dy(this._propsToCompare),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!(o in e)||!(o in n)||!bt(e[o],n[o]))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}},{key:"initializeProps",value:function(e,n){var i={},a={},o=Dy(this._propsToExtract),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;(u in e||u in n)&&(i[u]=e[u],a[u]=n[u])}}catch(f){o.e(f)}finally{o.f()}return this._checkRequiredProps(i),this._checkRequiredProps(a),{start:i,end:a}}},{key:"getDuration",value:function(e,n){return n.transitionDuration}},{key:"_checkRequiredProps",value:function(e){this._requiredProps&&this._requiredProps.forEach(function(n){var i=e[n];Se(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}]),t}();function Fy(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ny(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Fy(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Fy(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function m2(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=g2(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function g2(t,r){if(t){if(typeof t=="string")return By(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return By(t,r)}}function By(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function y2(t){var r=_2();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function _2(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var b2=["longitude","latitude","zoom","bearing","pitch"],w2=["longitude","latitude","zoom"],dt=function(t){N(e,t);var r=y2(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};T(this,e);var a=Array.isArray(i)?i:i.transitionProps,o=Array.isArray(i)?{}:i;return o.transitionProps=Array.isArray(a)?{compare:a,required:a}:a||{compare:b2,required:w2},n=r.call(this,o.transitionProps),l(W(n),"opts",void 0),n.opts=o,n}return S(e,[{key:"initializeProps",value:function(i,a){var o=be(M(e.prototype),"initializeProps",this).call(this,i,a),s=this.opts,u=s.makeViewport,f=s.around;if(u&&f){var c=u(i),h=u(a),p=c.unproject(f);o.start.around=f,Object.assign(o.end,{around:h.project(p),aroundPosition:p,width:a.width,height:a.height})}return o}},{key:"interpolateProps",value:function(i,a,o){var s={},u=m2(this._propsToExtract),f;try{for(u.s();!(f=u.n()).done;){var c=f.value;s[c]=xr(i[c]||0,a[c]||0,o)}}catch(p){u.e(p)}finally{u.f()}if(a.aroundPosition&&this.opts.makeViewport){var h=this.opts.makeViewport(Ny(Ny({},a),s));Object.assign(s,h.panByPosition(a.aroundPosition,xr(i.around,a.around,o)))}return s}}]),e}(Di);function Vy(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ne(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Vy(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Vy(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var tn={transitionDuration:0},x2=300,pu=function(r){return 1-(1-r)*(1-r)},ji={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Un={},Dt=function(){function t(r){var e=this;T(this,t),l(this,"props",void 0),l(this,"state",{}),l(this,"transitionManager",void 0),l(this,"eventManager",void 0),l(this,"onViewStateChange",void 0),l(this,"onStateChange",void 0),l(this,"makeViewport",void 0),l(this,"_controllerState",void 0),l(this,"_events",{}),l(this,"_interactionState",{isDragging:!1}),l(this,"_customEvents",[]),l(this,"_eventStartBlocked",null),l(this,"_panMove",!1),l(this,"invertPan",!1),l(this,"dragMode","rotate"),l(this,"inertia",0),l(this,"scrollZoom",!0),l(this,"dragPan",!0),l(this,"dragRotate",!0),l(this,"doubleClickZoom",!0),l(this,"touchZoom",!0),l(this,"touchRotate",!1),l(this,"keyboard",!0),this.transitionManager=new Ly(Ne(Ne({},r),{},{getControllerState:function(i){return new e.ControllerState(i)},onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)})),this.handleEvent=this.handleEvent.bind(this),this.eventManager=r.eventManager,this.onViewStateChange=r.onViewStateChange||function(){},this.onStateChange=r.onStateChange||function(){},this.makeViewport=r.makeViewport}return S(t,[{key:"events",set:function(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}},{key:"finalize",value:function(){for(var e in this._events)if(this._events[e]){var n;(n=this.eventManager)===null||n===void 0||n.off(e,this.handleEvent)}this.transitionManager.finalize()}},{key:"handleEvent",value:function(e){this._controllerState=void 0;var n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}},{key:"controllerState",get:function(){return this._controllerState=this._controllerState||new this.ControllerState(Ne(Ne({makeViewport:this.makeViewport},this.props),this.state)),this._controllerState}},{key:"getCenter",value:function(e){var n=this.props,i=n.x,a=n.y,o=e.offsetCenter;return[o.x-i,o.y-a]}},{key:"isPointInBounds",value:function(e,n){var i=this.props,a=i.width,o=i.height;if(n&&n.handled)return!1;var s=e[0]>=0&&e[0]<=a&&e[1]>=0&&e[1]<=o;return s&&n&&n.stopPropagation(),s}},{key:"isFunctionKeyPressed",value:function(e){var n=e.srcEvent;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}},{key:"isDragging",value:function(){return this._interactionState.isDragging||!1}},{key:"blockEvents",value:function(e){var n=this,i=setTimeout(function(){n._eventStartBlocked===i&&(n._eventStartBlocked=null)},e);this._eventStartBlocked=i}},{key:"setProps",value:function(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);var n=e.inertia;this.inertia=Number.isFinite(n)?n:n===!0?x2:0;var i=e.scrollZoom,a=i===void 0?!0:i,o=e.dragPan,s=o===void 0?!0:o,u=e.dragRotate,f=u===void 0?!0:u,c=e.doubleClickZoom,h=c===void 0?!0:c,p=e.touchZoom,d=p===void 0?!0:p,v=e.touchRotate,m=v===void 0?!1:v,g=e.keyboard,_=g===void 0?!0:g,w=Boolean(this.onViewStateChange);this.toggleEvents(ji.WHEEL,w&&a),this.toggleEvents(ji.PAN,w),this.toggleEvents(ji.PINCH,w&&(d||m)),this.toggleEvents(ji.TRIPLE_PAN,w&&m),this.toggleEvents(ji.DOUBLE_TAP,w&&h),this.toggleEvents(ji.KEYBOARD,w&&_),this.scrollZoom=a,this.dragPan=s,this.dragRotate=f,this.doubleClickZoom=h,this.touchZoom=d,this.touchRotate=m,this.keyboard=_}},{key:"updateTransition",value:function(){this.transitionManager.updateTransition()}},{key:"toggleEvents",value:function(e,n){var i=this;this.eventManager&&e.forEach(function(a){i._events[a]!==n&&(i._events[a]=n,n?i.eventManager.on(a,i.handleEvent):i.eventManager.off(a,i.handleEvent))})}},{key:"updateViewport",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=Ne(Ne({},e.getViewportProps()),n),o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),o){var s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:a,interactionState:this._interactionState,oldViewState:s})}}},{key:"_onTransition",value:function(e){this.onViewStateChange(Ne(Ne({},e),{},{interactionState:this._interactionState}))}},{key:"_setInteractionState",value:function(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}},{key:"_onPanStart",value:function(e){var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);var a=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(a,tn,{isDragging:!0}),!0}},{key:"_onPan",value:function(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}},{key:"_onPanEnd",value:function(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}},{key:"_onPanMove",value:function(e){if(!this.dragPan)return!1;var n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,tn,{isDragging:!0,isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(e){var n=this.inertia;if(this.dragPan&&n&&e.velocity){var i=this.getCenter(e),a=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],o=this.controllerState.pan({pos:a}).panEnd();this.updateViewport(o,Ne(Ne({},this._getTransitionProps()),{},{transitionDuration:n,transitionEasing:pu}),{isDragging:!1,isPanning:!0})}else{var s=this.controllerState.panEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1})}return!0}},{key:"_onPanRotate",value:function(e){if(!this.dragRotate)return!1;var n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,tn,{isDragging:!0,isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(e){var n=this.inertia;if(this.dragRotate&&n&&e.velocity){var i=this.getCenter(e),a=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],o=this.controllerState.rotate({pos:a}).rotateEnd();this.updateViewport(o,Ne(Ne({},this._getTransitionProps()),{},{transitionDuration:n,transitionEasing:pu}),{isDragging:!1,isRotating:!0})}else{var s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}},{key:"_onWheel",value:function(e){if(!this.scrollZoom)return!1;var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();var i=this.scrollZoom===!0?{}:this.scrollZoom,a=i.speed,o=a===void 0?.01:a,s=i.smooth,u=s===void 0?!1:s,f=e.delta,c=2/(1+Math.exp(-Math.abs(f*o)));f<0&&c!==0&&(c=1/c);var h=this.controllerState.zoom({pos:n,scale:c});return this.updateViewport(h,Ne(Ne({},this._getTransitionProps({around:n})),{},{transitionDuration:u?250:1}),{isZooming:!0,isPanning:!0}),!0}},{key:"_onTriplePanStart",value:function(e){var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,tn,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(e){if(!this.touchRotate||!this.isDragging())return!1;var n=this.getCenter(e);n[0]-=e.deltaX;var i=this.controllerState.rotate({pos:n});return this.updateViewport(i,tn,{isDragging:!0,isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(e){if(!this.isDragging())return!1;var n=this.inertia;if(this.touchRotate&&n&&e.velocityY){var i=this.getCenter(e),a=[i[0],i[1]+=e.velocityY*n/2],o=this.controllerState.rotate({pos:a});this.updateViewport(o,Ne(Ne({},this._getTransitionProps()),{},{transitionDuration:n,transitionEasing:pu}),{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{var s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}},{key:"_onPinchStart",value:function(e){var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Un._startPinchRotation=e.rotation,Un._lastPinchEvent=e,this.updateViewport(i,tn,{isDragging:!0}),!0}},{key:"_onPinch",value:function(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;var n=this.controllerState;if(this.touchZoom){var i=e.scale,a=this.getCenter(e);n=n.zoom({pos:a,scale:i})}if(this.touchRotate){var o=e.rotation;n=n.rotate({deltaAngleX:Un._startPinchRotation-o})}return this.updateViewport(n,tn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Un._lastPinchEvent=e,!0}},{key:"_onPinchEnd",value:function(e){if(!this.isDragging())return!1;var n=this.inertia,i=Un._lastPinchEvent;if(this.touchZoom&&n&&i&&e.scale!==i.scale){var a=this.getCenter(e),o=this.controllerState.rotateEnd(),s=Math.log2(e.scale),u=(s-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),f=Math.pow(2,s+u*n/2);o=o.zoom({pos:a,scale:f}).zoomEnd(),this.updateViewport(o,Ne(Ne({},this._getTransitionProps({around:a})),{},{transitionDuration:n,transitionEasing:pu}),{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{var c=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(c,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Un._startPinchRotation=null,Un._lastPinchEvent=null,!0}},{key:"_onDoubleTap",value:function(e){if(!this.doubleClickZoom)return!1;var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.isFunctionKeyPressed(e),a=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(a,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}},{key:"_onKeyDown",value:function(e){if(!this.keyboard)return!1;var n=this.isFunctionKeyPressed(e),i=this.keyboard===!0?{}:this.keyboard,a=i.zoomSpeed,o=i.moveSpeed,s=i.rotateSpeedX,u=i.rotateSpeedY,f=this.controllerState,c,h={};switch(e.srcEvent.code){case"Minus":c=n?f.zoomOut(a).zoomOut(a):f.zoomOut(a),h.isZooming=!0;break;case"Equal":c=n?f.zoomIn(a).zoomIn(a):f.zoomIn(a),h.isZooming=!0;break;case"ArrowLeft":n?(c=f.rotateLeft(s),h.isRotating=!0):(c=f.moveLeft(o),h.isPanning=!0);break;case"ArrowRight":n?(c=f.rotateRight(s),h.isRotating=!0):(c=f.moveRight(o),h.isPanning=!0);break;case"ArrowUp":n?(c=f.rotateUp(u),h.isRotating=!0):(c=f.moveUp(o),h.isPanning=!0);break;case"ArrowDown":n?(c=f.rotateDown(u),h.isRotating=!0):(c=f.moveDown(o),h.isPanning=!0);break;default:return!1}return this.updateViewport(c,this._getTransitionProps(),h),!0}},{key:"_getTransitionProps",value:function(e){var n=this.transition;return!n||!n.transitionInterpolator?tn:e?Ne(Ne({},n),{},{transitionInterpolator:new dt(Ne(Ne(Ne({},e),n.transitionInterpolator.opts),{},{makeViewport:this.controllerState.makeViewport}))}):n}}]),t}();var Fi=function(){function t(r,e){T(this,t),l(this,"_viewportProps",void 0),l(this,"_state",void 0),this._viewportProps=this.applyConstraints(r),this._state=e}return S(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}}]),t}();function zy(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Mr(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?zy(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):zy(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Gy(t){var r=T2();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function T2(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Uy=5,E2=1.2,ih=function(t){N(e,t);var r=Gy(e);function e(n){var i;T(this,e);var a=n.width,o=n.height,s=n.latitude,u=n.longitude,f=n.zoom,c=n.bearing,h=c===void 0?0:c,p=n.pitch,d=p===void 0?0:p,v=n.altitude,m=v===void 0?1.5:v,g=n.position,_=g===void 0?[0,0,0]:g,w=n.maxZoom,x=w===void 0?20:w,P=n.minZoom,E=P===void 0?0:P,A=n.maxPitch,R=A===void 0?60:A,D=n.minPitch,j=D===void 0?0:D,I=n.startPanLngLat,V=n.startZoomLngLat,F=n.startRotatePos,G=n.startBearing,B=n.startPitch,K=n.startZoom,C=n.normalize,k=C===void 0?!0:C;return Se(Number.isFinite(u)),Se(Number.isFinite(s)),Se(Number.isFinite(f)),i=r.call(this,{width:a,height:o,latitude:s,longitude:u,zoom:f,bearing:h,pitch:d,altitude:m,maxZoom:x,minZoom:E,maxPitch:R,minPitch:j,normalize:k,position:_},{startPanLngLat:I,startZoomLngLat:V,startRotatePos:F,startBearing:G,startPitch:B,startZoom:K}),l(W(i),"makeViewport",void 0),i.makeViewport=n.makeViewport,i}return S(e,[{key:"panStart",value:function(i){var a=i.pos;return this._getUpdatedState({startPanLngLat:this._unproject(a)})}},{key:"pan",value:function(i){var a=i.pos,o=i.startPos,s=this.getState().startPanLngLat||this._unproject(o);if(!s)return this;var u=this.makeViewport(this.getViewportProps()),f=u.panByPosition(s,a);return this._getUpdatedState(f)}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanLngLat:null})}},{key:"rotateStart",value:function(i){var a=i.pos;return this._getUpdatedState({startRotatePos:a,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}},{key:"rotate",value:function(i){var a=i.pos,o=i.deltaAngleX,s=o===void 0?0:o,u=i.deltaAngleY,f=u===void 0?0:u,c=this.getState(),h=c.startRotatePos,p=c.startBearing,d=c.startPitch;if(!h||p===void 0||d===void 0)return this;var v;return a?v=this._getNewRotation(a,h,d,p):v={bearing:p+s,pitch:d+f},this._getUpdatedState(v)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(i){var a=i.pos;return this._getUpdatedState({startZoomLngLat:this._unproject(a),startZoom:this.getViewportProps().zoom})}},{key:"zoom",value:function(i){var a=i.pos,o=i.startPos,s=i.scale,u=this.getState(),f=u.startZoom,c=u.startZoomLngLat;if(c||(f=this.getViewportProps().zoom,c=this._unproject(o)||this._unproject(a)),!c)return this;var h=this.getViewportProps(),p=h.maxZoom,d=h.minZoom,v=f+Math.log2(s);v=Te(v,d,p);var m=this.makeViewport(Mr(Mr({},this.getViewportProps()),{},{zoom:v}));return this._getUpdatedState(Mr({zoom:v},m.panByPosition(c,a)))}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}},{key:"zoomIn",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(i)}},{key:"zoomOut",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/i)}},{key:"moveLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([i,0])}},{key:"moveRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-i,0])}},{key:"moveUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,i])}},{key:"moveDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-i])}},{key:"rotateLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-i})}},{key:"rotateRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+i})}},{key:"rotateUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+i})}},{key:"rotateDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-i})}},{key:"shortestPathFrom",value:function(i){var a=i.getViewportProps(),o=Mr({},this.getViewportProps()),s=o.bearing,u=o.longitude;return Math.abs(s-a.bearing)>180&&(o.bearing=s<0?s+360:s-360),Math.abs(u-a.longitude)>180&&(o.longitude=u<0?u+360:u-360),o}},{key:"applyConstraints",value:function(i){var a=i.maxZoom,o=i.minZoom,s=i.zoom;i.zoom=Te(s,o,a);var u=i.maxPitch,f=i.minPitch,c=i.pitch;i.pitch=Te(c,f,u);var h=i.normalize,p=h===void 0?!0:h;return p&&Object.assign(i,Js(i)),i}},{key:"_zoomFromCenter",value:function(i){var a=this.getViewportProps(),o=a.width,s=a.height;return this.zoom({pos:[o/2,s/2],scale:i})}},{key:"_panFromCenter",value:function(i){var a=this.getViewportProps(),o=a.width,s=a.height;return this.pan({startPos:[o/2,s/2],pos:[o/2+i[0],s/2+i[1]]})}},{key:"_getUpdatedState",value:function(i){return new this.constructor(Mr(Mr(Mr({makeViewport:this.makeViewport},this.getViewportProps()),this.getState()),i))}},{key:"_unproject",value:function(i){var a=this.makeViewport(this.getViewportProps());return i&&a.unproject(i)}},{key:"_getNewRotation",value:function(i,a,o,s){var u=i[0]-a[0],f=i[1]-a[1],c=i[1],h=a[1],p=this.getViewportProps(),d=p.width,v=p.height,m=u/d,g=0;f>0?Math.abs(v-h)>Uy&&(g=f/(h-v)*E2):f<0&&h>Uy&&(g=1-c/h),g=Te(g,-1,1);var _=this.getViewportProps(),w=_.minPitch,x=_.maxPitch,P=s+180*m,E=o;return g>0?E=o+g*(x-o):g<0&&(E=o-g*(w-o)),{pitch:E,bearing:P}}}]),e}(Fi),du=function(t){N(e,t);var r=Gy(e);function e(){var n;T(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),l(W(n),"ControllerState",ih),l(W(n),"transition",{transitionDuration:300,transitionInterpolator:new dt({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),l(W(n),"dragMode","pan"),n}return S(e,[{key:"setProps",value:function(i){i.position=i.position||[0,0,0];var a=this.props;be(M(e.prototype),"setProps",this).call(this,i);var o=!a||a.height!==i.height;o&&this.updateViewport(new this.ControllerState(Mr(Mr({makeViewport:this.makeViewport},i),this.state)))}}]),e}(Dt);function P2(t){var r=S2();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function S2(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var eo=function(t){N(e,t);var r=P2(e);function e(){return T(this,e),r.apply(this,arguments)}return S(e,[{key:"ViewportType",get:function(){return Bn}},{key:"ControllerType",get:function(){return du}}]),e}(Lt);l(eo,"displayName","MapView");function ah(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=A2(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function A2(t,r){if(t){if(typeof t=="string")return $y(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return $y(t,r)}}function $y(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var O2=new qa;function M2(t,r){var e,n,i=(e=t.order)!==null&&e!==void 0?e:1/0,a=(n=r.order)!==null&&n!==void 0?n:1/0;return i-a}var Hy=function(){function t(){T(this,t),l(this,"effects",void 0),l(this,"_resolvedEffects",[]),l(this,"_defaultEffects",[]),l(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}return S(t,[{key:"addDefaultEffect",value:function(e){var n=this._defaultEffects;if(!n.find(function(a){return a.id===e.id})){var i=n.findIndex(function(a){return M2(a,e)>0});i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}},{key:"setProps",value:function(e){"effects"in e&&(Ze(e.effects,this.effects,1)||this._setEffects(e.effects))}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}},{key:"getEffects",value:function(){return this._resolvedEffects}},{key:"_setEffects",value:function(e){var n={},i=ah(this.effects),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n[o.id]=o}}catch(d){i.e(d)}finally{i.f()}var s=[],u=ah(e),f;try{for(u.s();!(f=u.n()).done;){var c=f.value,h=n[c.id];h&&h!==c?h.setProps?(h.setProps(c.props),s.push(h)):(h.cleanup(),s.push(c)):s.push(c),delete n[c.id]}}catch(d){u.e(d)}finally{u.f()}for(var p in n)n[p].cleanup();this.effects=s,this._resolvedEffects=s.concat(this._defaultEffects),e.some(function(d){return d instanceof qa})||this._resolvedEffects.push(O2),this._needsRedraw="effects changed"}},{key:"finalize",value:function(){var e=ah(this._resolvedEffects),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.cleanup()}}catch(a){e.e(a)}finally{e.f()}this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}]),t}();function k2(t){var r=R2();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function R2(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Wy=function(t){N(e,t);var r=k2(e);function e(){return T(this,e),r.apply(this,arguments)}return S(e,[{key:"shouldDrawLayer",value:function(i){var a=i.props.operation;return a.includes("draw")||a.includes("terrain")}}]),e}(qr);function vu(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=C2(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function C2(t,r){if(t){if(typeof t=="string")return Yy(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Yy(t,r)}}function Yy(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Xy(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ni(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Xy(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Xy(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var I2="deckRenderer.renderLayers",mu=function(){function t(r){T(this,t),l(this,"gl",void 0),l(this,"layerFilter",void 0),l(this,"drawPickingColors",void 0),l(this,"drawLayersPass",void 0),l(this,"pickLayersPass",void 0),l(this,"renderCount",void 0),l(this,"_needsRedraw",void 0),l(this,"renderBuffers",void 0),l(this,"lastPostProcessEffect",void 0),this.gl=r,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Wy(r),this.pickLayersPass=new Ii(r),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}return S(t,[{key:"setProps",value:function(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}},{key:"renderLayers",value:function(e){if(e.viewports.length){var n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i=Ni(Ni({layerFilter:this.layerFilter,isPicking:this.drawPickingColors},e),{},{target:e.target||xe.getDefaultFramebuffer(this.gl)});i.effects&&this._preRender(i.effects,i);var a=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,o=n.render(Ni(Ni({},i),{},{target:a}));i.effects&&this._postRender(i.effects,i),this.renderCount++,ze(I2,this,o,e)}}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}},{key:"finalize",value:function(){var e=this.renderBuffers,n=vu(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.delete()}}catch(o){n.e(o)}finally{n.f()}e.length=0}},{key:"_preRender",value:function(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};var i=vu(e),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n.preRenderStats[o.id]=o.preRender(this.gl,n),o.postRender&&(this.lastPostProcessEffect=o.id)}}catch(s){i.e(s)}finally{i.f()}this.lastPostProcessEffect&&this._resizeRenderBuffers()}},{key:"_resizeRenderBuffers",value:function(){var e=this.renderBuffers;e.length===0&&e.push(new xe(this.gl),new xe(this.gl));var n=vu(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.resize()}}catch(o){n.e(o)}finally{n.f()}}},{key:"_postRender",value:function(e,n){var i=this.renderBuffers,a=Ni(Ni({},n),{},{inputBuffer:i[0],swapBuffer:i[1],target:null}),o=vu(e),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;if(u.postRender){if(u.id===this.lastPostProcessEffect){a.target=n.target,u.postRender(this.gl,a);break}var f=u.postRender(this.gl,a);a.inputBuffer=f,a.swapBuffer=f===i[0]?i[1]:i[0]}}}catch(c){o.e(c)}finally{o.f()}}}]),t}();function qy(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function gu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?qy(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):qy(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var L2={pickedColor:null,pickedObjectIndex:-1};function Zy(t){for(var r=t.pickedColors,e=t.decodePickingColor,n=t.deviceX,i=t.deviceY,a=t.deviceRadius,o=t.deviceRect,s=o.x,u=o.y,f=o.width,c=o.height,h=a*a,p=-1,d=0,v=0;v<c;v++){var m=v+u-i,g=m*m;if(g>h)d+=4*f;else for(var _=0;_<f;_++){var w=r[d+3]-1;if(w>=0){var x=_+s-n,P=x*x+g;P<=h&&(h=P,p=d)}d+=4}}if(p>=0){var E=r.slice(p,p+4),A=e(E);if(A){var R=Math.floor(p/4/f),D=p/4-R*f;return gu(gu({},A),{},{pickedColor:E,pickedX:s+D,pickedY:u+R})}he.error("Picked non-existent layer. Is picking buffer corrupt?")()}return L2}function Ky(t){var r=t.pickedColors,e=t.decodePickingColor,n=new Map;if(r)for(var i=0;i<r.length;i+=4){var a=r[i+3]-1;if(a>=0){var o=r.slice(i,i+4),s=o.join(",");if(!n.has(s)){var u=e(o);u?n.set(s,gu(gu({},u),{},{color:o})):he.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function Qy(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function D2(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Qy(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Qy(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function oh(t){var r=t.pickInfo,e=t.viewports,n=t.pixelRatio,i=t.x,a=t.y,o=t.z,s=e[0];e.length>1&&(s=j2(r?.pickedViewports||e,{x:i,y:a}));var u;if(s){var f=[i-s.x,a-s.y];o!==void 0&&(f[2]=o),u=s.unproject(f)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:i,y:a,pixel:[i,a],coordinate:u,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:n}}function Jy(t){var r=t.pickInfo,e=t.lastPickedInfo,n=t.mode,i=t.layers,a=r.pickedColor,o=r.pickedLayer,s=r.pickedObjectIndex,u=o?[o]:[];if(n==="hover"){var f=e.index,c=e.layerId,h=o?o.props.id:null;if(h!==c||s!==f){if(h!==c){var p=i.find(function(m){return m.props.id===c});p&&u.unshift(p)}e.layerId=h,e.index=s,e.info=null}}var d=oh(t),v=new Map;return v.set(null,d),u.forEach(function(m){var g=D2({},d);m===o&&(g.color=a,g.index=s,g.picked=!0),g=sh({layer:m,info:g,mode:n});var _=g.layer;m===o&&n==="hover"&&(e.info=g),v.set(_.id,g),n==="hover"&&_.updateAutoHighlight(g)}),v}function sh(t){for(var r=t.layer,e=t.info,n=t.mode;r&&e;){var i=e.layer||null;e.sourceLayer=i,e.layer=r,e=r.getPickingInfo({info:e,mode:n,sourceLayer:i}),r=r.parent}return e}function j2(t,r){for(var e=t.length-1;e>=0;e--){var n=t[e];if(n.containsPixel(r))return n}return t[0]}function uh(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=F2(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function F2(t,r){if(t){if(typeof t=="string")return e0(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return e0(t,r)}}function e0(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function t0(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function yu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?t0(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):t0(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var r0=function(){function t(r){T(this,t),l(this,"gl",void 0),l(this,"pickingFBO",void 0),l(this,"depthFBO",void 0),l(this,"pickLayersPass",void 0),l(this,"layerFilter",void 0),l(this,"lastPickedInfo",void 0),l(this,"_pickable",!0),this.gl=r,this.pickLayersPass=new Ii(r),this.lastPickedInfo={index:-1,layerId:null,info:null}}return S(t,[{key:"setProps",value:function(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}},{key:"finalize",value:function(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}},{key:"pickObject",value:function(e){return this._pickClosestObject(e)}},{key:"pickObjects",value:function(e){return this._pickVisibleObjects(e)}},{key:"getLastPickedObject",value:function(e){var n=e.x,i=e.y,a=e.layers,o=e.viewports,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info,u=s&&s.layer&&s.layer.id,f=s&&s.viewport&&s.viewport.id,c=u?a.find(function(v){return v.id===u}):null,h=f&&o.find(function(v){return v.id===f})||o[0],p=h&&h.unproject([n-h.x,i-h.y]),d={x:n,y:i,viewport:h,coordinate:p,layer:c};return yu(yu({},s),d)}},{key:"_resizeBuffer",value:function(){var e,n,i=this.gl;if(!this.pickingFBO&&(this.pickingFBO=new xe(i),xe.isSupported(i,{colorBufferFloat:!0}))){var a=new xe(i);a.attach(l({},36064,new Le(i,{format:ie(i)?34836:6408,type:5126}))),this.depthFBO=a}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}},{key:"_getPickable",value:function(e){var n=this;if(this._pickable===!1)return null;var i=e.filter(function(a){return n.pickLayersPass.shouldDrawLayer(a)&&!a.isComposite});return i.length?i:null}},{key:"_pickClosestObject",value:function(e){var n=e.layers,i=e.views,a=e.viewports,o=e.x,s=e.y,u=e.radius,f=u===void 0?0:u,c=e.depth,h=c===void 0?1:c,p=e.mode,d=p===void 0?"query":p,v=e.unproject3D,m=e.onViewportActive,g=e.effects,_=this._getPickable(n),w=mt(this.gl);if(!_)return{result:[],emptyInfo:oh({viewports:a,x:o,y:s,pixelRatio:w})};this._resizeBuffer();for(var x=ni(this.gl,[o,s],!0),P=[x.x+Math.floor(x.width/2),x.y+Math.floor(x.height/2)],E=Math.round(f*w),A=this.pickingFBO,R=A.width,D=A.height,j=this._getPickingRect({deviceX:P[0],deviceY:P[1],deviceRadius:E,deviceWidth:R,deviceHeight:D}),I={x:o-f,y:s-f,width:f*2+1,height:f*2+1},V,F=[],G=new Set,B=0;B<h;B++){var K=void 0;if(j){var C=this._drawAndSample({layers:_,views:i,viewports:a,onViewportActive:m,deviceRect:j,cullRect:I,effects:g,pass:"picking:".concat(d)});K=Zy(yu(yu({},C),{},{deviceX:P[0],deviceY:P[1],deviceRadius:E,deviceRect:j}))}else K={pickedColor:null,pickedObjectIndex:-1};var k=void 0;if(K.pickedLayer&&v&&this.depthFBO){var U=this._drawAndSample({layers:[K.pickedLayer],views:i,viewports:a,onViewportActive:m,deviceRect:{x:K.pickedX,y:K.pickedY,width:1,height:1},cullRect:I,effects:g,pass:"picking:".concat(d,":z")},!0),$=U.pickedColors;$[3]&&(k=$[0])}K.pickedLayer&&B+1<h&&(G.add(K.pickedLayer),K.pickedLayer.disablePickingIndex(K.pickedObjectIndex)),V=Jy({pickInfo:K,lastPickedInfo:this.lastPickedInfo,mode:d,layers:_,viewports:a,x:o,y:s,z:k,pixelRatio:w});var q=uh(V.values()),J;try{for(q.s();!(J=q.n()).done;){var re=J.value;re.layer&&F.push(re)}}catch(oe){q.e(oe)}finally{q.f()}if(!K.pickedColor)break}var ae=uh(G),le;try{for(ae.s();!(le=ae.n()).done;){var ge=le.value;ge.restorePickingColors()}}catch(oe){ae.e(oe)}finally{ae.f()}return{result:F,emptyInfo:V.get(null)}}},{key:"_pickVisibleObjects",value:function(e){var n=e.layers,i=e.views,a=e.viewports,o=e.x,s=e.y,u=e.width,f=u===void 0?1:u,c=e.height,h=c===void 0?1:c,p=e.mode,d=p===void 0?"query":p,v=e.maxObjects,m=v===void 0?null:v,g=e.onViewportActive,_=e.effects,w=this._getPickable(n);if(!w)return[];this._resizeBuffer();for(var x=mt(this.gl),P=ni(this.gl,[o,s],!0),E=P.x,A=P.y+P.height,R=ni(this.gl,[o+f,s+h],!0),D=R.x+R.width,j=R.y,I={x:E,y:j,width:D-E,height:A-j},V=this._drawAndSample({layers:w,views:i,viewports:a,onViewportActive:g,deviceRect:I,cullRect:{x:o,y:s,width:f,height:h},effects:_,pass:"picking:".concat(d)}),F=Ky(V),G=new Map,B=Number.isFinite(m),K=0;K<F.length&&!(B&&m&&G.size>=m);K++){var C=F[K],k={color:C.pickedColor,layer:null,index:C.pickedObjectIndex,picked:!0,x:o,y:s,pixelRatio:x};k=sh({layer:C.pickedLayer,info:k,mode:d}),G.has(k.object)||G.set(k.object,k)}return Array.from(G.values())}},{key:"_drawAndSample",value:function(e){var n=e.layers,i=e.views,a=e.viewports,o=e.onViewportActive,s=e.deviceRect,u=e.cullRect,f=e.effects,c=e.pass,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,p=h?this.depthFBO:this.pickingFBO,d={layers:n,layerFilter:this.layerFilter,views:i,viewports:a,onViewportActive:o,pickingFBO:p,deviceRect:s,cullRect:u,effects:f,pass:c,pickZ:h,preRenderStats:{}},v=uh(f),m;try{for(v.s();!(m=v.n()).done;){var g=m.value;g.useInPicking&&(d.preRenderStats[g.id]=g.preRender(this.gl,d))}}catch(D){v.e(D)}finally{v.f()}var _=this.pickLayersPass.render(d),w=_.decodePickingColor,x=s.x,P=s.y,E=s.width,A=s.height,R=new(h?Float32Array:Uint8Array)(E*A*4);return _r(p,{sourceX:x,sourceY:P,sourceWidth:E,sourceHeight:A,target:R}),{pickedColors:R,decodePickingColor:w}}},{key:"_getPickingRect",value:function(e){var n=e.deviceX,i=e.deviceY,a=e.deviceRadius,o=e.deviceWidth,s=e.deviceHeight,u=Math.max(0,n-a),f=Math.max(0,i-a),c=Math.min(o,n+a+1)-u,h=Math.min(s,i+a+1)-f;return c<=0||h<=0?null:{x:u,y:f,width:c,height:h}}}]),t}();var N2={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},n0=function(){function t(r){T(this,t),l(this,"el",null),l(this,"isVisible",!1);var e=r.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,N2),e.appendChild(this.el))}return S(t,[{key:"setTooltip",value:function(e,n,i){var a=this.el;if(a){if(typeof e=="string")a.innerText=e;else if(e)e.text&&(a.innerText=e.text),e.html&&(a.innerHTML=e.html),e.className&&(a.className=e.className);else{this.isVisible=!1,a.style.display="none";return}this.isVisible=!0,a.style.display="block",a.style.transform="translate(".concat(n,"px, ").concat(i,"px)"),e&&ne(e)==="object"&&"style"in e&&Object.assign(a.style,e.style)}}},{key:"remove",value:function(){this.el&&(this.el.remove(),this.el=null)}}]),t}();var to=Be(i0());var a0=1,o0=2,fh=4,B2={mousedown:a0,mousemove:o0,mouseup:fh};function V2(t,r){for(var e=0;e<t.length;e++)if(r(t[e]))return!0;return!1}function s0(t){var r=t.prototype.handler;t.prototype.handler=function(n){var i=this.store;n.button>0&&n.type==="pointerdown"&&(V2(i,function(a){return a.pointerId===n.pointerId})||i.push(n)),r.call(this,n)}}function u0(t){t.prototype.handler=function(e){var n=B2[e.type];n&a0&&e.button>=0&&(this.pressed=!0),n&o0&&e.which===0&&(n=fh),this.pressed&&(n&fh&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}s0(to.default.PointerEventInput);u0(to.default.MouseInput);var f0=to.default.Manager,Ht=to.default;function l0(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function z2(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?l0(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):l0(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var rn=function t(r,e,n){T(this,t),this.element=r,this.callback=e,this.options=z2({enable:!0},n)};var c0=Ht?[[Ht.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Ht.Rotate,{enable:!1}],[Ht.Pinch,{enable:!1}],[Ht.Swipe,{enable:!1}],[Ht.Pan,{threshold:0,enable:!1}],[Ht.Press,{enable:!1}],[Ht.Tap,{event:"doubletap",taps:2,enable:!1}],[Ht.Tap,{event:"anytap",enable:!1}],[Ht.Tap,{enable:!1}]]:null,lh={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},h0={doubletap:["tap"]},p0={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Bi={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},d0={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},ch={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"};var m0=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Gn=typeof window<"u"?window:global;var bu=!1;try{v0={get passive(){return bu=!0,!0}},Gn.addEventListener("test",null,v0),Gn.removeEventListener("test",null)}catch{bu=!1}var v0;function U2(t){var r=G2();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function G2(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $2=m0.indexOf("firefox")!==-1,H2=Bi.WHEEL_EVENTS,g0="wheel",y0=4.000244140625,W2=40,Y2=.25,_0=function(t){N(e,t);var r=U2(e);function e(n,i,a){var o;return T(this,e),o=r.call(this,n,i,a),o.handleEvent=function(s){if(o.options.enable){var u=s.deltaY;Gn.WheelEvent&&($2&&s.deltaMode===Gn.WheelEvent.DOM_DELTA_PIXEL&&(u/=Gn.devicePixelRatio),s.deltaMode===Gn.WheelEvent.DOM_DELTA_LINE&&(u*=W2)),u!==0&&u%y0===0&&(u=Math.floor(u/y0)),s.shiftKey&&u&&(u=u*Y2),o.callback({type:g0,center:{x:s.clientX,y:s.clientY},delta:-u,srcEvent:s,pointerType:"mouse",target:s.target})}},o.events=(o.options.events||[]).concat(H2),o.events.forEach(function(s){return n.addEventListener(s,o.handleEvent,bu?{passive:!1}:!1)}),o}return S(e,[{key:"destroy",value:function(){var i=this;this.events.forEach(function(a){return i.element.removeEventListener(a,i.handleEvent)})}},{key:"enableEventType",value:function(i,a){i===g0&&(this.options.enable=a)}}]),e}(rn);function X2(t){var r=q2();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function q2(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Z2=Bi.MOUSE_EVENTS,b0="pointermove",w0="pointerover",x0="pointerout",T0="pointerenter",E0="pointerleave",P0=function(t){N(e,t);var r=X2(e);function e(n,i,a){var o;T(this,e),o=r.call(this,n,i,a),o.handleEvent=function(u){o.handleOverEvent(u),o.handleOutEvent(u),o.handleEnterEvent(u),o.handleLeaveEvent(u),o.handleMoveEvent(u)},o.pressed=!1;var s=o.options.enable;return o.enableMoveEvent=s,o.enableLeaveEvent=s,o.enableEnterEvent=s,o.enableOutEvent=s,o.enableOverEvent=s,o.events=(o.options.events||[]).concat(Z2),o.events.forEach(function(u){return n.addEventListener(u,o.handleEvent)}),o}return S(e,[{key:"destroy",value:function(){var i=this;this.events.forEach(function(a){return i.element.removeEventListener(a,i.handleEvent)})}},{key:"enableEventType",value:function(i,a){i===b0&&(this.enableMoveEvent=a),i===w0&&(this.enableOverEvent=a),i===x0&&(this.enableOutEvent=a),i===T0&&(this.enableEnterEvent=a),i===E0&&(this.enableLeaveEvent=a)}},{key:"handleOverEvent",value:function(i){this.enableOverEvent&&i.type==="mouseover"&&this._emit(w0,i)}},{key:"handleOutEvent",value:function(i){this.enableOutEvent&&i.type==="mouseout"&&this._emit(x0,i)}},{key:"handleEnterEvent",value:function(i){this.enableEnterEvent&&i.type==="mouseenter"&&this._emit(T0,i)}},{key:"handleLeaveEvent",value:function(i){this.enableLeaveEvent&&i.type==="mouseleave"&&this._emit(E0,i)}},{key:"handleMoveEvent",value:function(i){if(this.enableMoveEvent)switch(i.type){case"mousedown":i.button>=0&&(this.pressed=!0);break;case"mousemove":i.which===0&&(this.pressed=!1),this.pressed||this._emit(b0,i);break;case"mouseup":this.pressed=!1;break;default:}}},{key:"_emit",value:function(i,a){this.callback({type:i,center:{x:a.clientX,y:a.clientY},srcEvent:a,pointerType:"mouse",target:a.target})}}]),e}(rn);function K2(t){var r=Q2();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Q2(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var J2=Bi.KEY_EVENTS,S0="keydown",A0="keyup",O0=function(t){N(e,t);var r=K2(e);function e(n,i,a){var o;return T(this,e),o=r.call(this,n,i,a),o.handleEvent=function(s){var u=s.target||s.srcElement;u.tagName==="INPUT"&&u.type==="text"||u.tagName==="TEXTAREA"||(o.enableDownEvent&&s.type==="keydown"&&o.callback({type:S0,srcEvent:s,key:s.key,target:s.target}),o.enableUpEvent&&s.type==="keyup"&&o.callback({type:A0,srcEvent:s,key:s.key,target:s.target}))},o.enableDownEvent=o.options.enable,o.enableUpEvent=o.options.enable,o.events=(o.options.events||[]).concat(J2),n.tabIndex=o.options.tabIndex||0,n.style.outline="none",o.events.forEach(function(s){return n.addEventListener(s,o.handleEvent)}),o}return S(e,[{key:"destroy",value:function(){var i=this;this.events.forEach(function(a){return i.element.removeEventListener(a,i.handleEvent)})}},{key:"enableEventType",value:function(i,a){i===S0&&(this.enableDownEvent=a),i===A0&&(this.enableUpEvent=a)}}]),e}(rn);function eM(t){var r=tM();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function tM(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var M0="contextmenu",k0=function(t){N(e,t);var r=eM(e);function e(n,i,a){var o;return T(this,e),o=r.call(this,n,i,a),o.handleEvent=function(s){o.options.enable&&o.callback({type:M0,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},n.addEventListener("contextmenu",o.handleEvent),o}return S(e,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(i,a){i===M0&&(this.options.enable=a)}}]),e}(rn);var hh=1,wu=2,ph=4,rM={pointerdown:hh,pointermove:wu,pointerup:ph,mousedown:hh,mousemove:wu,mouseup:ph},nM=1,iM=2,aM=3,oM=0,sM=1,uM=2,fM=1,lM=2,cM=4;function R0(t){var r=rM[t.srcEvent.type];if(!r)return null;var e=t.srcEvent,n=e.buttons,i=e.button,a=e.which,o=!1,s=!1,u=!1;return r===ph||r===wu&&!Number.isFinite(n)?(o=a===nM,s=a===iM,u=a===aM):r===wu?(o=Boolean(n&fM),s=Boolean(n&cM),u=Boolean(n&lM)):r===hh&&(o=i===oM,s=i===sM,u=i===uM),{leftButton:o,middleButton:s,rightButton:u}}function C0(t,r){var e=t.center;if(!e)return null;var n=r.getBoundingClientRect(),i=n.width/r.offsetWidth||1,a=n.height/r.offsetHeight||1,o={x:(e.x-n.left-r.clientLeft)/i,y:(e.y-n.top-r.clientTop)/a};return{center:e,offsetCenter:o}}function I0(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function fr(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?I0(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):I0(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var dh={srcElement:"root",priority:0},L0=function(){function t(r){var e=this;T(this,t),this.handleEvent=function(n){if(!e.isEmpty()){for(var i=e._normalizeEvent(n),a=n.srcEvent.target;a&&a!==i.rootElement;){if(e._emit(i,a),i.handled)return;a=a.parentNode}e._emit(i,"root")}},this.eventManager=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}return S(t,[{key:"isEmpty",value:function(){return!this._active}},{key:"add",value:function(e,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,s=this.handlers,u=this.handlersByElement,f=dh;typeof i=="string"||i&&i.addEventListener?f=fr(fr({},dh),{},{srcElement:i}):i&&(f=fr(fr({},dh),i));var c=u.get(f.srcElement);c||(c=[],u.set(f.srcElement,c));var h={type:e,handler:n,srcElement:f.srcElement,priority:f.priority};a&&(h.once=!0),o&&(h.passive=!0),s.push(h),this._active=this._active||!h.passive;for(var p=c.length-1;p>=0&&!(c[p].priority>=h.priority);)p--;c.splice(p+1,0,h)}},{key:"remove",value:function(e,n){for(var i=this.handlers,a=this.handlersByElement,o=i.length-1;o>=0;o--){var s=i[o];if(s.type===e&&s.handler===n){i.splice(o,1);var u=a.get(s.srcElement);u.splice(u.indexOf(s),1),u.length===0&&a.delete(s.srcElement)}}this._active=i.some(function(f){return!f.passive})}},{key:"_emit",value:function(e,n){var i=this.handlersByElement.get(n);if(i){for(var a=!1,o=function(){e.handled=!0},s=function(){e.handled=!0,a=!0},u=[],f=0;f<i.length;f++){var c=i[f],h=c.type,p=c.handler,d=c.once;if(p(fr(fr({},e),{},{type:h,stopPropagation:o,stopImmediatePropagation:s})),d&&u.push(i[f]),a)break}for(var v=0;v<u.length;v++){var m=u[v],g=m.type,_=m.handler;this.remove(g,_)}}}},{key:"_normalizeEvent",value:function(e){var n=this.eventManager.getElement();return fr(fr(fr(fr({},e),R0(e)),C0(e,n)),{},{preventDefault:function(){e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n})}}]),t}();function D0(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=hM(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function hM(t,r){if(t){if(typeof t=="string")return j0(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return j0(t,r)}}function j0(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function F0(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function N0(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?F0(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):F0(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var pM={events:null,recognizers:null,recognizerOptions:{},Manager:f0,touchAction:"none",tabIndex:0},vh=function(){function t(){var r=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0;T(this,t),this._onBasicInput=function(a){var o=a.srcEvent,s=p0[o.type];s&&r.manager.emit(s,a)},this._onOtherEvent=function(a){r.manager.emit(a.type,a)},this.options=N0(N0({},pM),n),this.events=new Map,this.setElement(e);var i=this.options.events;i&&this.on(i)}return S(t,[{key:"getElement",value:function(){return this.element}},{key:"setElement",value:function(e){var n=this;if(this.element&&this.destroy(),this.element=e,!!e){var i=this.options,a=i.Manager;this.manager=new a(e,{touchAction:i.touchAction,recognizers:i.recognizers||c0}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(lh).forEach(function(v){var m=n.manager.get(v);m&&lh[v].forEach(function(g){m.recognizeWith(g)})});for(var o in i.recognizerOptions){var s=this.manager.get(o);if(s){var u=i.recognizerOptions[o];delete u.enable,s.set(u)}}this.wheelInput=new _0(e,this._onOtherEvent,{enable:!1}),this.moveInput=new P0(e,this._onOtherEvent,{enable:!1}),this.keyInput=new O0(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new k0(e,this._onOtherEvent,{enable:!1});var f=D0(this.events),c;try{for(f.s();!(c=f.n()).done;){var h=Z(c.value,2),p=h[0],d=h[1];d.isEmpty()||(this._toggleRecognizer(d.recognizerName,!0),this.manager.on(p,d.handleEvent))}}catch(v){f.e(v)}finally{f.f()}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(e,n,i){this._addEventHandler(e,n,i,!1)}},{key:"once",value:function(e,n,i){this._addEventHandler(e,n,i,!0)}},{key:"watch",value:function(e,n,i){this._addEventHandler(e,n,i,!1,!0)}},{key:"off",value:function(e,n){this._removeEventHandler(e,n)}},{key:"_toggleRecognizer",value:function(e,n){var i=this.manager;if(i){var a=i.get(e);if(a&&a.options.enable!==n){a.set({enable:n});var o=h0[e];o&&!this.options.recognizers&&o.forEach(function(s){var u=i.get(s);n?(u.requireFailure(e),a.dropRequireFailure(s)):u.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}}},{key:"_addEventHandler",value:function(e,n,i,a,o){if(typeof e!="string"){i=n;for(var s in e)this._addEventHandler(s,e[s],i,a,o);return}var u=this.manager,f=this.events,c=ch[e]||e,h=f.get(c);h||(h=new L0(this),f.set(c,h),h.recognizerName=d0[c]||c,u&&u.on(c,h.handleEvent)),h.add(e,n,i,a,o),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}},{key:"_removeEventHandler",value:function(e,n){if(typeof e!="string"){for(var i in e)this._removeEventHandler(i,e[i]);return}var a=this.events,o=ch[e]||e,s=a.get(o);if(s&&(s.remove(e,n),s.isEmpty())){var u=s.recognizerName,f=!1,c=D0(a.values()),h;try{for(c.s();!(h=c.n()).done;){var p=h.value;if(p.recognizerName===u&&!p.isEmpty()){f=!0;break}}}catch(d){c.e(d)}finally{c.f()}f||this._toggleRecognizer(u,!1)}}}]),t}();function B0(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=dM(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function dM(t,r){if(t){if(typeof t=="string")return V0(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return V0(t,r)}}function V0(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function z0(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function kr(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?z0(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):z0(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function $n(){}var vM=function(r){var e=r.isDragging;return e?"grabbing":"grab"},U0={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:$n,onResize:$n,onViewStateChange:$n,onInteractionStateChange:$n,onBeforeRender:$n,onAfterRender:$n,onLoad:$n,onError:function(r){return he.error(r.message,r.cause)()},onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:vM,getTooltip:null,debug:!1,drawPickingColors:!1},Vi=function(){function t(r){var e=this;T(this,t),l(this,"props",void 0),l(this,"width",0),l(this,"height",0),l(this,"userData",{}),l(this,"canvas",null),l(this,"viewManager",null),l(this,"layerManager",null),l(this,"effectManager",null),l(this,"deckRenderer",null),l(this,"deckPicker",null),l(this,"eventManager",null),l(this,"tooltip",null),l(this,"metrics",void 0),l(this,"animationLoop",void 0),l(this,"stats",void 0),l(this,"viewState",void 0),l(this,"cursorState",void 0),l(this,"_needsRedraw",void 0),l(this,"_pickRequest",void 0),l(this,"_lastPointerDownInfo",null),l(this,"_metricsCounter",void 0),l(this,"_onPointerMove",function(n){var i=e._pickRequest;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;var a=n.offsetCenter;if(!a)return;i.x=a.x,i.y=a.y,i.radius=e.props.pickingRadius}e.layerManager&&(e.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),l(this,"_onEvent",function(n){var i=Vc[n.type],a=n.offsetCenter;if(!(!i||!a||!e.layerManager)){var o=e.layerManager.getLayers(),s=e.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:o,viewports:e.getViewports(a)},e._lastPointerDownInfo),u=s.layer,f=u&&(u[i.handler]||u.props[i.handler]),c=e.props[i.handler],h=!1;f&&(h=f.call(u,s,n)),!h&&c&&c(s,n)}}),l(this,"_onPointerDown",function(n){var i=n.offsetCenter,a=e._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:e.props.pickingRadius});e._lastPointerDownInfo=a.result[0]||a.emptyInfo}),this.props=kr(kr({},U0),r),r=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},r.viewState&&r.initialViewState&&he.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Qn()==="IE"&&he.warn("IE 11 is not supported")(),this.viewState=r.initialViewState,r.gl||typeof document<"u"&&(this.canvas=this._createCanvas(r)),this.animationLoop=this._createAnimationLoop(r),this.stats=new pn({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(r),r._typedArrayManagerProps&&Gt.setOptions(r._typedArrayManagerProps),this.animationLoop.start()}return S(t,[{key:"finalize",value:function(){var e,n,i,a,o,s,u,f;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(a=this.effectManager)===null||a===void 0||a.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(s=this.deckPicker)===null||s===void 0||s.finalize(),this.deckPicker=null,(u=this.eventManager)===null||u===void 0||u.destroy(),this.eventManager=null,(f=this.tooltip)===null||f===void 0||f.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var c;(c=this.canvas.parentElement)===null||c===void 0||c.removeChild(this.canvas),this.canvas=null}}},{key:"setProps",value:function(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&he.removed("onLayerHover","onHover")(),"onLayerClick"in e&&he.removed("onLayerClick","onClick")(),e.initialViewState&&!Ze(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);var n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";var n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);var i=this.viewManager.needsRedraw(e),a=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return n=n||i||a||o||s,n}},{key:"redraw",value:function(e){if(this.layerManager){var n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}}},{key:"isInitialized",get:function(){return this.viewManager!==null}},{key:"getViews",value:function(){return Se(this.viewManager),this.viewManager.views}},{key:"getViewports",value:function(e){return Se(this.viewManager),this.viewManager.getViewports(e)}},{key:"getCanvas",value:function(){return this.canvas}},{key:"pickObject",value:function(e){var n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}},{key:"pickMultipleObjects",value:function(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}},{key:"pickObjects",value:function(e){return this._pick("pickObjects","pickObjects Time",e)}},{key:"_addResources",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(var i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}},{key:"_removeResources",value:function(e){var n=B0(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;this.layerManager.resourceManager.remove(a)}}catch(o){n.e(o)}finally{n.f()}}},{key:"_addDefaultEffect",value:function(e){this.effectManager.addDefaultEffect(e)}},{key:"_pick",value:function(e,n,i){Se(this.deckPicker);var a=this.stats;a.get("Pick Count").incrementCount(),a.get(n).timeStart();var o=this.deckPicker[e](kr({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects()},i));return a.get(n).timeEnd(),o}},{key:"_createCanvas",value:function(e){var n=e.canvas;if(typeof n=="string"&&(n=document.getElementById(n),Se(n)),!n){n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay";var i=e.parent||document.body;i.appendChild(n)}return Object.assign(n.style,e.style),n}},{key:"_setCanvasSize",value:function(e){if(this.canvas){var n=e.width,i=e.height;if(n||n===0){var a=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=a}if(i||i===0){var o,s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((o=e.style)===null||o===void 0?void 0:o.position)||"absolute",this.canvas.style.height=s}}}},{key:"_updateCanvasSize",value:function(){var e,n,i=this.canvas;if(i){var a=(e=i.clientWidth)!==null&&e!==void 0?e:i.width,o=(n=i.clientHeight)!==null&&n!==void 0?n:i.height;if(a!==this.width||o!==this.height){var s,u;this.width=a,this.height=o,(s=this.viewManager)===null||s===void 0||s.setProps({width:a,height:o}),(u=this.layerManager)===null||u===void 0||u.activateViewport(this.getViewports()[0]),this.props.onResize({width:a,height:o})}}}},{key:"_createAnimationLoop",value:function(e){var n=this,i=e.width,a=e.height,o=e.gl,s=e.glOptions,u=e.debug,f=e.onError,c=e.onBeforeRender,h=e.onAfterRender,p=e.useDevicePixels;return new Xo({width:i,height:a,useDevicePixels:p,autoResizeDrawingBuffer:!o,autoResizeViewport:!1,gl:o,onCreateContext:function(v){return ii(kr(kr(kr({},s),v),{},{canvas:n.canvas,debug:u,onContextLost:function(){return n._onContextLost()}}))},onInitialize:function(v){return n._setGLContext(v.gl)},onRender:this._onRenderFrame.bind(this),onBeforeRender:c,onAfterRender:h,onError:f})}},{key:"_getViewState",value:function(){return this.props.viewState||this.viewState}},{key:"_getViews",value:function(){var e=this.props.views||[new eo({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}},{key:"_onContextLost",value:function(){var e=this.props.onError;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}},{key:"_pickAndCallback",value:function(){var e=this._pickRequest;if(e.event){var n=this._pick("pickObject","pickObject Time",e),i=n.result,a=n.emptyInfo;this.cursorState.isHovering=i.length>0;var o=a,s=!1,u=B0(i),f;try{for(u.s();!(f=u.n()).done;){var c,h=f.value;o=h,s=((c=h.layer)===null||c===void 0?void 0:c.onHover(h,e.event))||s}}catch(d){u.e(d)}finally{u.f()}if(!s&&this.props.onHover&&this.props.onHover(o,e.event),this.props.getTooltip&&this.tooltip){var p=this.props.getTooltip(o);this.tooltip.setTooltip(p,o.x,o.y)}e.event=null}}},{key:"_updateCursor",value:function(){var e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}},{key:"_setGLContext",value:function(e){if(!this.layerManager){this.canvas||(this.canvas=e.canvas,yr(e,{enable:!0,copyState:!0})),this.tooltip=new n0(this.canvas),Xe(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);var n=new Wr;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new vh(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(var i in Vc)this.eventManager.on(i,this._onEvent);this.viewManager=new ky({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});var a=this.viewManager.getViewports()[0];this.layerManager=new cu(e,{deck:this,stats:this.stats,viewport:a,timeline:n}),this.effectManager=new Hy,this.deckRenderer=new mu(e),this.deckPicker=new r0(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}}},{key:"_drawLayers",value:function(e,n){var i=this.layerManager.context.gl;Xe(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers(kr({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects()},n)),this.props.onAfterRender({gl:i})}},{key:"_onRenderFrame",value:function(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),he.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}},{key:"_onViewStateChange",value:function(e){var n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState=kr(kr({},this.viewState),{},l({},e.viewId,n)),this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}},{key:"_onInteractionStateChange",value:function(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}},{key:"_getFrameStats",value:function(){var e=this.stats;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();var n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}},{key:"_getMetrics",value:function(){var e=this.metrics,n=this.stats;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();var i=Et.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}]),t}();l(Vi,"defaultProps",U0);l(Vi,"VERSION",Ws);function G0(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function $0(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?G0(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):G0(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var xu=function(){function t(r,e){T(this,t),l(this,"opts",void 0),l(this,"source",void 0),this.opts=e,this.source=r}return S(t,[{key:"value",get:function(){return this.source.value}},{key:"getValue",value:function(){var e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];var i=this.source.value,a=n.size,o=i;if(i&&i.length!==a){o=new Float32Array(a);for(var s=n.elementOffset||0,u=0;u<a;++u)o[u]=i[s+u]}return o}},{key:"getAccessor",value:function(){return $0($0({},this.source.getAccessor()),this.opts)}}]),t}();function H0(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function W0(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function lr(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?W0(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):W0(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Tu(t){return t.stride||t.size*t.bytesPerElement}function Y0(t,r){r.offset&&he.removed("shaderAttribute.offset","vertexOffset, elementOffset")();var e=Tu(t),n=r.vertexOffset!==void 0?r.vertexOffset:t.vertexOffset||0,i=r.elementOffset||0,a=n*e+i*t.bytesPerElement+(t.offset||0);return lr(lr({},r),{},{offset:a,stride:e})}function mM(t,r){var e=Y0(t,r);return{high:e,low:lr(lr({},e),{},{offset:e.offset+t.size*4})}}var X0=function(){function t(r,e,n){T(this,t),l(this,"gl",void 0),l(this,"id",void 0),l(this,"size",void 0),l(this,"settings",void 0),l(this,"value",void 0),l(this,"doublePrecision",void 0),l(this,"_buffer",void 0),l(this,"state",void 0),this.gl=r,this.id=e.id||"",this.size=e.size||1;var i=e.logicalType||e.type,a=i===5130,o=e.defaultValue;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);var s;a?s=5126:!i&&e.isIndexed?s=r&&sa(r,Ee.ELEMENT_INDEX_UINT32)?5125:5123:s=i||5126;var u=H0(i||s||5126);this.doublePrecision=a,a&&e.fp64===!1&&(u=Float32Array),this.value=null,this.settings=lr(lr({},e),{},{defaultType:u,defaultValue:o,logicalType:i,type:s,size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT}),this.state=lr(lr({},n),{},{externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}),this._buffer=null}return S(t,[{key:"isConstant",get:function(){return this.state.constant}},{key:"buffer",get:function(){if(!this._buffer){var e=this.settings,n=e.isIndexed,i=e.type;this._buffer=new fe(this.gl,{id:this.id,target:n?34963:34962,accessor:{type:i}})}return this._buffer}},{key:"byteOffset",get:function(){var e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Tu(e):0}},{key:"numInstances",get:function(){return this.state.numInstances},set:function(e){this.state.numInstances=e}},{key:"delete",value:function(){this._buffer&&(this._buffer.delete(),this._buffer=null),Gt.release(this.state.allocatedValue)}},{key:"getShaderAttributes",value:function(e,n){if(this.doublePrecision){var i={},a=this.value instanceof Float64Array,o=mM(this.getAccessor(),n||{});return i[e]=new xu(this,o.high),i["".concat(e,"64Low")]=a?new xu(this,o.low):new Float32Array(this.size),i}if(n){var s=Y0(this.getAccessor(),n);return l({},e,new xu(this,s))}return l({},e,this)}},{key:"getBuffer",value:function(){return this.state.constant?null:this.state.externalBuffer||this._buffer}},{key:"getValue",value:function(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}},{key:"getAccessor",value:function(){return this.state.bufferAccessor}},{key:"getBounds",value:function(){if(this.state.bounds)return this.state.bounds;var e=null;if(this.state.constant&&this.value){var n=Array.from(this.value);e=[n,n]}else{var i=this.value,a=this.numInstances,o=this.size,s=a*o;if(i&&s&&i.length>=s){for(var u=new Array(o).fill(1/0),f=new Array(o).fill(-1/0),c=0;c<s;)for(var h=0;h<o;h++){var p=i[c++];p<u[h]&&(u[h]=p),p>f[h]&&(f[h]=p)}e=[u,f]}}return this.state.bounds=e,e}},{key:"setData",value:function(e){var n=this.state,i;ArrayBuffer.isView(e)?i={value:e}:e instanceof fe?i={buffer:e}:i=e;var a=lr(lr({},this.settings),i);if(n.bufferAccessor=a,n.bounds=null,i.constant){var o=i.value;o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o));var s=!n.constant||!this._areValuesEqual(o,this.value);if(!s)return!1;n.externalBuffer=null,n.constant=!0,this.value=o}else if(i.buffer){var u=i.buffer;n.externalBuffer=u,n.constant=!1,this.value=i.value||null;var f=i.value instanceof Float64Array;a.type=i.type||u.accessor.type,a.bytesPerElement=u.accessor.BYTES_PER_ELEMENT*(f?2:1),a.stride=Tu(a)}else if(i.value){this._checkExternalBuffer(i);var c=i.value;n.externalBuffer=null,n.constant=!1,this.value=c,a.bytesPerElement=c.BYTES_PER_ELEMENT,a.stride=Tu(a);var h=this.buffer,p=this.byteOffset;this.doublePrecision&&c instanceof Float64Array&&(c=tu(c,a));var d=c.byteLength+p+a.stride*2;h.byteLength<d&&h.reallocate(d),h.setAccessor(null),h.subData({data:c,offset:p}),a.type=i.type||h.accessor.type}return!0}},{key:"updateSubBuffer",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;var n=this.value,i=e.startOffset,a=i===void 0?0:i,o=e.endOffset;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?tu(n,{size:this.size,startIndex:a,endIndex:o}):n.subarray(a,o),offset:a*n.BYTES_PER_ELEMENT+this.byteOffset})}},{key:"allocate",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=this.state,a=i.allocatedValue,o=Gt.allocate(a,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=o;var s=this.buffer,u=this.byteOffset;return s.byteLength<o.byteLength+u&&(s.reallocate(o.byteLength+u),n&&a&&s.subData({data:a instanceof Float64Array?tu(a,this):a,offset:u})),i.allocatedValue=o,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}},{key:"_checkExternalBuffer",value:function(e){var n=e.value;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));var i=this.settings.defaultType,a=!1;if(this.doublePrecision&&(a=n.BYTES_PER_ELEMENT<4),a)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&he.warn("Attribute ".concat(this.id," is normalized"))()}},{key:"normalizeConstant",value:function(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(function(n){return(n+128)/255*2-1});case 5122:return new Float32Array(e).map(function(n){return(n+32768)/65535*2-1});case 5121:return new Float32Array(e).map(function(n){return n/255});case 5123:return new Float32Array(e).map(function(n){return n/65535});default:return e}}},{key:"_normalizeValue",value:function(e,n,i){var a=this.settings,o=a.defaultValue,s=a.size;if(Number.isFinite(e))return n[i]=e,n;if(!e){for(var u=s;--u>=0;)n[i+u]=o[u];return n}switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:for(var f=s;--f>=0;)n[i+f]=Number.isFinite(e[f])?e[f]:o[f]}return n}},{key:"_areValuesEqual",value:function(e,n){if(!e||!n)return!1;for(var i=this.size,a=0;a<i;a++)if(e[a]!==n[a])return!1;return!0}}]),t}();var q0=[],Z0=[];function zi(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=q0,i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&(Z0.length=t.length,n=Z0):n=q0,(r>0||Number.isFinite(e))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(r,e),i.index=r-1),{iterable:n,objectInfo:i}}function Eu(t){return t&&t[Symbol.asyncIterator]}function Pu(t,r){var e=r.size,n=r.stride,i=r.offset,a=r.startIndices,o=r.nested,s=t.BYTES_PER_ELEMENT,u=n?n/s:e,f=i?i/s:0,c=Math.floor((t.length-f)/u);return function(h,p){var d=p.index,v=p.target;if(!a){for(var m=d*u+f,g=0;g<e;g++)v[g]=t[m+g];return v}var _=a[d],w=a[d+1]||c,x;if(o){x=new Array(w-_);for(var P=_;P<w;P++){var E=P*u+f;v=new Array(e);for(var A=0;A<e;A++)v[A]=t[E+A];x[P-_]=v}}else if(u===e)x=t.subarray(_*e+f,w*e+f);else{x=new t.constructor((w-_)*e);for(var R=0,D=_;D<w;D++)for(var j=D*u+f,I=0;I<e;I++)x[R++]=t[j+I]}return x}}var K0=[],ro=[[0,1/0]];function Q0(t,r){if(t===ro||(r[0]<0&&(r[0]=0),r[0]>=r[1]))return t;for(var e=[],n=t.length,i=0,a=0;a<n;a++){var o=t[a];o[1]<r[0]?(e.push(o),i=a+1):o[0]>r[1]?e.push(o):r=[Math.min(o[0],r[0]),Math.max(o[1],r[1])]}return e.splice(i,0,r),e}function mh(t){var r=t.source,e=t.target,n=t.start,i=n===void 0?0:n,a=t.size,o=t.getData,s=t.end||e.length,u=r.length,f=s-i;if(u>f){e.set(r.subarray(0,f),i);return}if(e.set(r,i),!!o)for(var c=u;c<f;)for(var h=o(c,r),p=0;p<a;p++)e[i+c]=h[p]||0,c++}function J0(t){var r=t.source,e=t.target,n=t.size,i=t.getData,a=t.sourceStartIndices,o=t.targetStartIndices;if(!Array.isArray(o))return mh({source:r,target:e,size:n,getData:i}),e;for(var s=0,u=0,f=i&&function(v,m){return i(v+u,m)},c=Math.min(a.length,o.length),h=1;h<c;h++){var p=a[h]*n,d=o[h]*n;mh({source:r.subarray(s,p),target:e,start:u,end:d,size:n,getData:f}),s=p,u=d}return u<e.length&&mh({source:[],target:e,start:u,size:n,getData:f}),e}function e_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Su(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?e_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):e_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var yM={interpolation:{duration:0,easing:function(r){return r}},spring:{stiffness:.05,damping:.5}};function Au(t,r){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});var e=t.type||"interpolation";return Su(Su(Su(Su({},yM[e]),r),t),{},{type:e})}function Ou(t,r){var e=r.getBuffer();return e?[e,{divisor:0,size:r.size,normalized:r.settings.normalized}]:r.value}function Mu(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function ku(t){t.push(t.shift())}function no(t,r){var e=t.doublePrecision,n=t.settings,i=t.value,a=t.size,o=e&&i instanceof Float64Array?2:1;return(n.noAlloc?i.length:r*a)*o}function Ru(t){var r=t.buffer,e=t.numInstances,n=t.attribute,i=t.fromLength,a=t.fromStartIndices,o=t.getData,s=o===void 0?function(P){return P}:o,u=n.doublePrecision&&n.value instanceof Float64Array?2:1,f=n.size*u,c=n.byteOffset,h=n.startIndices,p=a&&h,d=no(n,e),v=n.isConstant;if(!(!p&&i>=d)){var m=v?n.value:n.getBuffer().getData({srcByteOffset:c});if(n.settings.normalized&&!v){var g=s;s=function(E,A){return n.normalizeConstant(g(E,A))}}var _=v?function(P,E){return s(m,E)}:function(P,E){return s(m.subarray(P,P+f),E)},w=r.getData({length:i}),x=new Float32Array(d);J0({source:w,target:x,sourceStartIndices:a,targetStartIndices:h,size:f,getData:_}),r.byteLength<x.byteLength+c&&r.reallocate(x.byteLength+c),r.subData({data:x,offset:c})}}function Cu(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=_M(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function _M(t,r){if(t){if(typeof t=="string")return t_(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return t_(t,r)}}function t_(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function bM(t){var r=wM();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function wM(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ui=function(t){N(e,t);var r=bM(e);function e(n,i){var a;return T(this,e),a=r.call(this,n,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:ro}),l(W(a),"constant",!1),a.settings.update=i.update||(i.accessor?a._autoUpdater:void 0),Object.seal(a.settings),Object.seal(a.state),a._validateAttributeUpdaters(),a}return S(e,[{key:"startIndices",get:function(){return this.state.startIndices},set:function(i){this.state.startIndices=i}},{key:"needsUpdate",value:function(){return this.state.needsUpdate}},{key:"needsRedraw",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=i.clearChangedFlags,o=a===void 0?!1:a,s=this.state.needsRedraw;return this.state.needsRedraw=s&&!o,s}},{key:"getUpdateTriggers",value:function(){var i=this.settings.accessor;return[this.id].concat(typeof i!="function"&&i||[])}},{key:"supportsTransition",value:function(){return Boolean(this.settings.transition)}},{key:"getTransitionSetting",value:function(i){if(!i||!this.supportsTransition())return null;var a=this.settings.accessor,o=this.settings.transition,s=Array.isArray(a)?i[a.find(function(u){return i[u]})]:i[a];return Au(s,o)}},{key:"setNeedsUpdate",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,a=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||i,this.setNeedsRedraw(i),a){var o=a.startRow,s=o===void 0?0:o,u=a.endRow,f=u===void 0?1/0:u;this.state.updateRanges=Q0(this.state.updateRanges,[s,f])}else this.state.updateRanges=ro}},{key:"clearNeedsUpdate",value:function(){this.state.needsUpdate=!1,this.state.updateRanges=K0}},{key:"setNeedsRedraw",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||i}},{key:"allocate",value:function(i){var a=this.state,o=this.settings;return o.noAlloc?!1:o.update?(be(M(e.prototype),"allocate",this).call(this,i,a.updateRanges!==ro),!0):!1}},{key:"updateBuffer",value:function(i){var a=i.numInstances,o=i.data,s=i.props,u=i.context;if(!this.needsUpdate())return!1;var f=this.state.updateRanges,c=this.settings,h=c.update,p=c.noAlloc,d=!0;if(h){var v=Cu(f),m;try{for(v.s();!(m=v.n()).done;){var g=Z(m.value,2),_=g[0],w=g[1];h.call(u,this,{data:o,startRow:_,endRow:w,props:s,numInstances:a})}}catch(I){v.e(I)}finally{v.f()}if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else{var x=Cu(f),P;try{for(x.s();!(P=x.n()).done;){var E=Z(P.value,2),A=E[0],R=E[1],D=Number.isFinite(A)?this.getVertexOffset(A):0,j=Number.isFinite(R)?this.getVertexOffset(R):p||!Number.isFinite(a)?this.value.length:a*this.size;be(M(e.prototype),"updateSubBuffer",this).call(this,{startOffset:D,endOffset:j})}}catch(I){x.e(I)}finally{x.f()}}this._checkAttributeArray()}else d=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),d}},{key:"setConstantValue",value:function(i){if(i===void 0||typeof i=="function")return!1;var a=this.setData({constant:!0,value:i});return a&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}},{key:"setExternalBuffer",value:function(i){var a=this.state;return i?(this.clearNeedsUpdate(),a.lastExternalBuffer===i||(a.lastExternalBuffer=i,this.setNeedsRedraw(),this.setData(i)),!0):(a.lastExternalBuffer=null,!1)}},{key:"setBinaryValue",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=this.state,s=this.settings;if(!i)return o.binaryValue=null,o.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(o.binaryValue===i)return this.clearNeedsUpdate(),!0;o.binaryValue=i,this.setNeedsRedraw();var u=s.transform||a!==this.startIndices;if(u){ArrayBuffer.isView(i)&&(i={value:i});var f=i;Se(ArrayBuffer.isView(f.value),"invalid ".concat(s.accessor));var c=Boolean(f.size)&&f.size!==this.size;return o.binaryAccessor=Pu(f.value,{size:f.size||this.size,stride:f.stride,offset:f.offset,startIndices:a,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(i),!0}},{key:"getVertexOffset",value:function(i){var a=this.startIndices,o=a?i<a.length?a[i]:this.numInstances:i;return o*this.size}},{key:"getShaderAttributes",value:function(){var i=this.settings.shaderAttributes||l({},this.id,null),a={};for(var o in i)Object.assign(a,be(M(e.prototype),"getShaderAttributes",this).call(this,o,i[o]));return a}},{key:"_autoUpdater",value:function(i,a){var o=a.data,s=a.startRow,u=a.endRow,f=a.props,c=a.numInstances;if(!i.constant){var h=i.settings,p=i.state,d=i.value,v=i.size,m=i.startIndices,g=h.accessor,_=h.transform,w=p.binaryAccessor||(typeof g=="function"?g:f[g]);Se(typeof w=="function",'accessor "'.concat(g,'" is not a function'));var x=i.getVertexOffset(s),P=zi(o,s,u),E=P.iterable,A=P.objectInfo,R=Cu(E),D;try{for(R.s();!(D=R.n()).done;){var j=D.value;A.index++;var I=w(j,A);if(_&&(I=_.call(this,I)),m){var V=(A.index<m.length-1?m[A.index+1]:c)-m[A.index];if(I&&Array.isArray(I[0])){var F=x,G=Cu(I),B;try{for(G.s();!(B=G.n()).done;){var K=B.value;i._normalizeValue(K,d,F),F+=v}}catch(C){G.e(C)}finally{G.f()}}else I&&I.length>v?d.set(I,x):(i._normalizeValue(I,A.target,0),lu({target:d,source:A.target,start:x,count:V}));x+=V*v}else i._normalizeValue(I,d,x),x+=v}}catch(C){R.e(C)}finally{R.f()}}}},{key:"_validateAttributeUpdaters",value:function(){var i=this.settings,a=i.noAlloc||typeof i.update=="function";if(!a)throw new Error("Attribute ".concat(this.id," missing update or accessor"))}},{key:"_checkAttributeArray",value:function(){var i=this.value,a=Math.min(4,this.size);if(i&&i.length>=a){var o=!0;switch(a){case 4:o=o&&Number.isFinite(i[3]);case 3:o=o&&Number.isFinite(i[2]);case 2:o=o&&Number.isFinite(i[1]);case 1:o=o&&Number.isFinite(i[0]);break;default:o=!1}if(!o)throw new Error("Illegal attribute generated for ".concat(this.id))}}}]),e}(X0);function r_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function xM(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?r_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):r_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function n_(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=TM(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function TM(t,r){if(t){if(typeof t=="string")return i_(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return i_(t,r)}}function i_(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var a_=function(){function t(r){var e=r.gl,n=r.attribute,i=r.timeline;T(this,t),l(this,"gl",void 0),l(this,"type","interpolation"),l(this,"attributeInTransition",void 0),l(this,"settings",void 0),l(this,"attribute",void 0),l(this,"transition",void 0),l(this,"currentStartIndices",void 0),l(this,"currentLength",void 0),l(this,"transform",void 0),l(this,"buffers",void 0),this.gl=e,this.transition=new ur(i),this.attribute=n,this.attributeInTransition=new Ui(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=PM(e,n);var a={byteLength:0,usage:35050};this.buffers=[new fe(e,a),new fe(e,a)]}return S(t,[{key:"inProgress",get:function(){return this.transition.inProgress}},{key:"start",value:function(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;var i=this.gl,a=this.buffers,o=this.attribute;ku(a);var s={numInstances:n,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter},u=n_(a),f;try{for(u.s();!(f=u.n()).done;){var c=f.value;Ru(xM({buffer:c},s))}}catch(h){u.e(h)}finally{u.f()}this.currentStartIndices=o.startIndices,this.currentLength=no(o,n),this.attributeInTransition.setData({buffer:a[1],value:o.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:a[0],aTo:Ou(i,o)},feedbackBuffers:{vCurrent:a[1]}})}},{key:"update",value:function(){var e=this.transition.update();if(e){var n=this.settings,i=n.duration,a=n.easing,o=this.transition.time,s=o/i;a&&(s=a(s)),this.transform.run({uniforms:{time:s}})}return e}},{key:"cancel",value:function(){this.transition.cancel(),this.transform.delete();var e=n_(this.buffers),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.buffers.length=0}}]),t}();var EM=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function PM(t,r){var e=Mu(r.size);return new rr(t,{vs:EM,defines:{ATTRIBUTE_TYPE:e},varyings:["vCurrent"]})}function o_(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=SM(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function SM(t,r){if(t){if(typeof t=="string")return s_(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return s_(t,r)}}function s_(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function u_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function io(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?u_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):u_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var f_=function(){function t(r){var e=r.gl,n=r.attribute,i=r.timeline;T(this,t),l(this,"gl",void 0),l(this,"type","spring"),l(this,"attributeInTransition",void 0),l(this,"settings",void 0),l(this,"attribute",void 0),l(this,"transition",void 0),l(this,"currentStartIndices",void 0),l(this,"currentLength",void 0),l(this,"texture",void 0),l(this,"framebuffer",void 0),l(this,"transform",void 0),l(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new ur(i),this.attribute=n,this.attributeInTransition=new Ui(e,io(io({},n.settings),{},{normalized:!1})),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=OM(e),this.framebuffer=MM(e,this.texture),this.transform=AM(e,n,this.framebuffer);var a={byteLength:0,usage:35050};this.buffers=[new fe(e,a),new fe(e,a),new fe(e,a)]}return S(t,[{key:"inProgress",get:function(){return this.transition.inProgress}},{key:"start",value:function(e,n){var i=this.gl,a=this.buffers,o=this.attribute,s={numInstances:n,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter},u=o_(a),f;try{for(u.s();!(f=u.n()).done;){var c=f.value;Ru(io({buffer:c},s))}}catch(h){u.e(h)}finally{u.f()}this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=no(o,n),this.attributeInTransition.setData({buffer:a[1],value:o.value}),this.transition.start(io(io({},e),{},{duration:1/0})),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:Ou(i,o)}})}},{key:"update",value:function(){var e=this.buffers,n=this.transform,i=this.framebuffer,a=this.transition,o=a.update();if(!o)return!1;var s=this.settings;n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:s.stiffness,damping:s.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),ku(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value});var u=_r(i)[0]>0;return u||a.end(),!0}},{key:"cancel",value:function(){this.transition.cancel(),this.transform.delete();var e=o_(this.buffers),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}]),t}();function AM(t,r,e){var n=Mu(r.size);return new rr(t,{framebuffer:e,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:n},varyings:["vNext"]})}function OM(t){return new Le(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function MM(t,r){return new xe(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:l({},36064,r)})}var kM={interpolation:a_,spring:f_},l_=function(){function t(r,e){var n=e.id,i=e.timeline;T(this,t),l(this,"id",void 0),l(this,"isSupported",void 0),l(this,"gl",void 0),l(this,"timeline",void 0),l(this,"transitions",void 0),l(this,"needsRedraw",void 0),l(this,"numInstances",void 0),this.id=n,this.gl=r,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=rr.isSupported(r)}return S(t,[{key:"finalize",value:function(){for(var e in this.transitions)this._removeTransition(e)}},{key:"update",value:function(e){var n=e.attributes,i=e.transitions,a=e.numInstances;this.numInstances=a||1;for(var o in n){var s=n[o],u=s.getTransitionSetting(i);u&&this._updateAttribute(o,s,u)}for(var f in this.transitions){var c=n[f];(!c||!c.getTransitionSetting(i))&&this._removeTransition(f)}}},{key:"hasAttribute",value:function(e){var n=this.transitions[e];return n&&n.inProgress}},{key:"getAttributes",value:function(){var e={};for(var n in this.transitions){var i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}},{key:"run",value:function(){if(!this.isSupported||this.numInstances===0)return!1;for(var e in this.transitions){var n=this.transitions[e].update();n&&(this.needsRedraw=!0)}var i=this.needsRedraw;return this.needsRedraw=!1,i}},{key:"_removeTransition",value:function(e){this.transitions[e].cancel(),delete this.transitions[e]}},{key:"_updateAttribute",value:function(e,n,i){var a=this.transitions[e],o=!a||a.type!==i.type;if(o){if(!this.isSupported){he.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}a&&this._removeTransition(e);var s=kM[i.type];s?this.transitions[e]=new s({attribute:n,timeline:this.timeline,gl:this.gl}):(he.error("unsupported transition type '".concat(i.type,"'"))(),o=!1)}(o||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}]),t}();function c_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function gh(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?c_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):c_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function RM(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=CM(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function CM(t,r){if(t){if(typeof t=="string")return h_(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return h_(t,r)}}function h_(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var p_="attributeManager.invalidate",IM="attributeManager.updateStart",LM="attributeManager.updateEnd",DM="attribute.updateStart",jM="attribute.allocate",FM="attribute.updateEnd",Iu=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.id,i=n===void 0?"attribute-manager":n,a=e.stats,o=e.timeline;T(this,t),l(this,"id",void 0),l(this,"gl",void 0),l(this,"attributes",void 0),l(this,"updateTriggers",void 0),l(this,"needsRedraw",void 0),l(this,"userData",void 0),l(this,"stats",void 0),l(this,"attributeTransitionManager",void 0),l(this,"mergeBoundsMemoized",kt(ny)),this.id=i,this.gl=r,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=a,this.attributeTransitionManager=new l_(r,{id:"".concat(i,"-transitions"),timeline:o}),Object.seal(this)}return S(t,[{key:"finalize",value:function(){for(var e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}},{key:"getNeedsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}},{key:"setNeedsRedraw",value:function(){this.needsRedraw=!0}},{key:"add",value:function(e){this._add(e)}},{key:"addInstanced",value:function(e){this._add(e,{instanced:1})}},{key:"remove",value:function(e){var n=RM(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;this.attributes[a]!==void 0&&(this.attributes[a].delete(),delete this.attributes[a])}}catch(o){n.e(o)}finally{n.f()}}},{key:"invalidate",value:function(e,n){var i=this._invalidateTrigger(e,n);ze(p_,this,e,i)}},{key:"invalidateAll",value:function(e){for(var n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);ze(p_,this,"all")}},{key:"update",value:function(e){var n=e.data,i=e.numInstances,a=e.startIndices,o=a===void 0?null:a,s=e.transitions,u=e.props,f=u===void 0?{}:u,c=e.buffers,h=c===void 0?{}:c,p=e.context,d=p===void 0?{}:p,v=!1;ze(IM,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(var m in this.attributes){var g=this.attributes[m],_=g.settings.accessor;g.startIndices=o,g.numInstances=i,f[m]&&he.removed("props.".concat(m),"data.attributes.".concat(m))(),g.setExternalBuffer(h[m])||g.setBinaryValue(typeof _=="string"?h[_]:void 0,n.startIndices)||typeof _=="string"&&!h[_]&&g.setConstantValue(f[_])||g.needsUpdate()&&(v=!0,this._updateAttribute({attribute:g,numInstances:i,data:n,props:f,context:d})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}v&&ze(LM,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:s})}},{key:"updateTransition",value:function(){var e=this.attributeTransitionManager,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getBounds",value:function(e){var n=this,i=e.map(function(a){var o;return(o=n.attributes[a])===null||o===void 0?void 0:o.getBounds()});return this.mergeBoundsMemoized(i)}},{key:"getChangedAttributes",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1},n=this.attributes,i=this.attributeTransitionManager,a=gh({},i.getAttributes());for(var o in n){var s=n[o];s.needsRedraw(e)&&!i.hasAttribute(o)&&(a[o]=s)}return a}},{key:"getShaderAttributes",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e||(e=this.getAttributes());var i={};for(var a in e)n[a]||Object.assign(i,e[a].getShaderAttributes());return i}},{key:"_add",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var i in e){var a=e[i];this.attributes[i]=this._createAttribute(i,a,n)}this._mapUpdateTriggersToAttributes()}},{key:"_createAttribute",value:function(e,n,i){var a=gh(gh({},n),{},{id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0});return new Ui(this.gl,a)}},{key:"_mapUpdateTriggersToAttributes",value:function(){var e=this,n={},i=function(s){var u=e.attributes[s];u.getUpdateTriggers().forEach(function(f){n[f]||(n[f]=[]),n[f].push(s)})};for(var a in this.attributes)i(a);this.updateTriggers=n}},{key:"_invalidateTrigger",value:function(e,n){var i=this.attributes,a=this.updateTriggers,o=a[e];return o&&o.forEach(function(s){var u=i[s];u&&u.setNeedsUpdate(u.id,n)}),o}},{key:"_updateAttribute",value:function(e){var n=e.attribute,i=e.numInstances;if(ze(DM,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&ze(jM,n,i);var a=n.updateBuffer(e);a&&(this.needsRedraw=!0,ze(FM,n,i))}}]),t}();function NM(t){var r=BM();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function BM(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var d_=function(t){N(e,t);var r=NM(e);function e(){return T(this,e),r.apply(this,arguments)}return S(e,[{key:"value",get:function(){return this._value}},{key:"_onUpdate",value:function(){var i=this.time,a=this.settings,o=a.fromValue,s=a.toValue,u=a.duration,f=a.easing,c=f(i/u);this._value=xr(o,s,c)}}]),e}(ur);function VM(t){var r=zM();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function zM(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var v_=1e-5;function m_(t,r,e,n,i){var a=r-t,o=e-r,s=o*i,u=-a*n;return s+u+a+r}function UM(t,r,e,n,i){if(Array.isArray(e)){for(var a=[],o=0;o<e.length;o++)a[o]=m_(t[o],r[o],e[o],n,i);return a}return m_(t,r,e,n,i)}function g_(t,r){if(Array.isArray(t)){for(var e=0,n=0;n<t.length;n++){var i=t[n]-r[n];e+=i*i}return Math.sqrt(e)}return Math.abs(t-r)}var y_=function(t){N(e,t);var r=VM(e);function e(){return T(this,e),r.apply(this,arguments)}return S(e,[{key:"value",get:function(){return this._currValue}},{key:"_onUpdate",value:function(){var i=this.settings,a=i.fromValue,o=i.toValue,s=i.damping,u=i.stiffness,f=this._prevValue,c=f===void 0?a:f,h=this._currValue,p=h===void 0?a:h,d=UM(c,p,o,s,u),v=g_(d,o),m=g_(d,p);v<v_&&m<v_&&(d=o,this.end()),this._prevValue=p,this._currValue=d}}]),e}(ur);function __(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=GM(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function GM(t,r){if(t){if(typeof t=="string")return b_(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return b_(t,r)}}function b_(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function w_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function x_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?w_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):w_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var $M={interpolation:d_,spring:y_},T_=function(){function t(r){T(this,t),this.transitions=new Map,this.timeline=r}return S(t,[{key:"active",get:function(){return this.transitions.size>0}},{key:"add",value:function(e,n,i,a){var o=this.transitions;if(o.has(e)){var s=o.get(e),u=s.value,f=u===void 0?s.settings.fromValue:u;n=f,this.remove(e)}if(a=Au(a),!!a){var c=$M[a.type];if(!c){he.error("unsupported transition type '".concat(a.type,"'"))();return}var h=new c(this.timeline);h.start(x_(x_({},a),{},{fromValue:n,toValue:i})),o.set(e,h)}}},{key:"remove",value:function(e){var n=this.transitions;n.has(e)&&(n.get(e).cancel(),n.delete(e))}},{key:"update",value:function(){var e={},n=__(this.transitions),i;try{for(n.s();!(i=n.n()).done;){var a=Z(i.value,2),o=a[0],s=a[1];s.update(),e[o]=s.value,s.inProgress||this.remove(o)}}catch(u){n.e(u)}finally{n.f()}return e}},{key:"clear",value:function(){var e=__(this.transitions.keys()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;this.remove(i)}}catch(a){e.e(a)}finally{e.f()}}}]),t}();function P_(t){var r=t[It];for(var e in r){var n=r[e],i=n.validate;if(i&&!i(t[e],n))throw new Error("Invalid prop ".concat(e,": ").concat(t[e]))}}function S_(t,r){var e=Lu({newProps:t,oldProps:r,propTypes:t[It],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=WM(t,r),i=!1;return n||(i=YM(t,r)),{dataChanged:n,propsChanged:e,updateTriggersChanged:i,extensionsChanged:XM(t,r),transitionsChanged:HM(t,r)}}function HM(t,r){if(!t.transitions)return!1;var e={},n=t[It],i=!1;for(var a in t.transitions){var o=n[a],s=o&&o.type,u=s==="number"||s==="color"||s==="array";u&&yh(t[a],r[a],o)&&(e[a]=!0,i=!0)}return i?e:!1}function Lu(t){var r=t.newProps,e=t.oldProps,n=t.ignoreProps,i=n===void 0?{}:n,a=t.propTypes,o=a===void 0?{}:a,s=t.triggerName,u=s===void 0?"props":s;if(e===r)return!1;if(ne(r)!=="object"||r===null||ne(e)!=="object"||e===null)return"".concat(u," changed shallowly");for(var f=0,c=Object.keys(r);f<c.length;f++){var h=c[f];if(!(h in i)){if(!(h in e))return"".concat(u,".").concat(h," added");var p=yh(r[h],e[h],o[h]);if(p)return"".concat(u,".").concat(h," ").concat(p)}}for(var d=0,v=Object.keys(e);d<v.length;d++){var m=v[d];if(!(m in i)){if(!(m in r))return"".concat(u,".").concat(m," dropped");if(!Object.hasOwnProperty.call(r,m)){var g=yh(r[m],e[m],o[m]);if(g)return"".concat(u,".").concat(m," ").concat(g)}}}return!1}function yh(t,r,e){var n=e&&e.equal;return n&&!n(t,r,e)||!n&&(n=t&&r&&t.equals,n&&!n.call(t,r))?"changed deeply":!n&&r!==t?"changed shallowly":null}function WM(t,r){if(r===null)return"oldProps is null, initial diff";var e=!1,n=t.dataComparator,i=t._dataDiff;return n?n(t.data,r.data)||(e="Data comparator detected a change"):t.data!==r.data&&(e="A new data container was supplied"),e&&i&&(e=i(t.data,r.data)||e),e}function YM(t,r){if(r===null)return{all:!0};if("all"in t.updateTriggers){var e=E_(t,r,"all");if(e)return{all:!0}}var n={},i=!1;for(var a in t.updateTriggers)if(a!=="all"){var o=E_(t,r,a);o&&(n[a]=!0,i=!0)}return i?n:!1}function XM(t,r){if(r===null)return!0;var e=r.extensions,n=t.extensions;if(n===e)return!1;if(!e||!n||n.length!==e.length)return!0;for(var i=0;i<n.length;i++)if(!n[i].equals(e[i]))return!0;return!1}function E_(t,r,e){var n=t.updateTriggers[e];n=n??{};var i=r.updateTriggers[e];i=i??{};var a=Lu({oldProps:i,newProps:n,triggerName:e});return a}var qM="count(): argument not an object",ZM="count(): argument not a container";function Du(t){if(!QM(t))throw new Error(qM);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(KM(t))return Object.keys(t).length;throw new Error(ZM)}function KM(t){return t!==null&&ne(t)==="object"&&t.constructor===Object}function QM(t){return t!==null&&ne(t)==="object"}function A_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ao(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?A_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):A_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function ju(t,r){if(!r)return t;var e=ao(ao({},t),r);if("defines"in r&&(e.defines=ao(ao({},t.defines),r.defines)),"modules"in r&&(e.modules=(t.modules||[]).concat(r.modules),r.modules.some(function(o){return o.name==="project64"}))){var n=e.modules.findIndex(function(o){return o.name==="project32"});n>=0&&e.modules.splice(n,1)}if("inject"in r)if(!t.inject)e.inject=r.inject;else{var i=ao({},t.inject);for(var a in r.inject)i[a]=(i[a]||"")+r.inject[a];e.inject=i}return e}var Gi;function O_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function oo(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?O_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):O_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var JM=(Gi={},l(Gi,10241,9987),l(Gi,10240,9729),l(Gi,10242,33071),l(Gi,10243,33071),Gi),_h={};function M_(t,r,e,n){if(e instanceof Le)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});var i=null;e.compressed&&(i=l({},10241,e.data.length>1?9985:9729));var a=new Le(r,oo(oo({},e),{},{parameters:oo(oo(oo({},JM),i),n)}));return _h[a.id]=t,a}function k_(t,r){!r||!(r instanceof Le)||_h[r.id]===t&&(r.delete(),delete _h[r.id])}function R_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function uo(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?R_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):R_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var ek={boolean:{validate:function(r,e){return!0},equal:function(r,e,n){return Boolean(r)===Boolean(e)}},number:{validate:function(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate:function(r,e){return e.optional&&!r||bh(r)&&(r.length===3||r.length===4)},equal:function(r,e,n){return Ze(r,e,1)}},accessor:{validate:function(r,e){var n=Fu(r);return n==="function"||n===Fu(e.value)},equal:function(r,e,n){return typeof e=="function"?!0:Ze(r,e,1)}},array:{validate:function(r,e){return e.optional&&!r||bh(r)},equal:function(r,e,n){var i=n.compare,a=Number.isInteger(i)?i:i?1:0;return i?Ze(r,e,a):r===e}},object:{equal:function(r,e,n){if(n.ignore)return!0;var i=n.compare,a=Number.isInteger(i)?i:i?1:0;return i?Ze(r,e,a):r===e}},function:{validate:function(r,e){return e.optional&&!r||typeof r=="function"},equal:function(r,e,n){var i=!n.compare&&n.ignore!==!1;return i||r===e}},data:{transform:function(r,e,n){var i=n.props.dataTransform;return i&&r?i(r):r}},image:{transform:function(r,e,n){var i=n.context;return!i||!i.gl?null:M_(n.id,i.gl,r,uo(uo({},e.parameters),n.props.textureParameters))},release:function(r,e,n){k_(n.id,r)}}};function C_(t){for(var r={},e={},n={},i=0,a=Object.entries(t);i<a.length;i++){var o=Z(a[i],2),s=o[0],u=o[1],f=u?.deprecatedFor;if(f)n[s]=Array.isArray(f)?f:[f];else{var c=tk(s,u);r[s]=c,e[s]=c.value}}return{propTypes:r,defaultProps:e,deprecatedProps:n}}function tk(t,r){switch(Fu(r)){case"object":return so(t,r);case"array":return so(t,{type:"array",value:r,compare:!1});case"boolean":return so(t,{type:"boolean",value:r});case"number":return so(t,{type:"number",value:r});case"function":return so(t,{type:"function",value:r,compare:!0});default:return{name:t,type:"unknown",value:r}}}function so(t,r){return"type"in r?uo(uo({name:t},ek[r.type]),r):"value"in r?uo({name:t,type:Fu(r.value)},r):{name:t,type:"object",value:r}}function bh(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Fu(t){return bh(t)?"array":t===null?"null":ne(t)}function xh(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=rk(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function rk(t,r){if(t){if(typeof t=="string")return I_(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return I_(t,r)}}function I_(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function L_(t,r){for(var e,n=r.length-1;n>=0;n--){var i=r[n];"extensions"in i&&(e=i.extensions)}var a=wh(t.constructor,e),o=Object.create(a);o[Li]=t,o[sr]={},o[$t]={};for(var s=0;s<r.length;++s){var u=r[s];for(var f in u)o[f]=u[f]}return Object.freeze(o),o}var nk="_mergedDefaultProps";function wh(t,r){var e=nk;if(r){var n=xh(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.constructor;o&&(e+=":".concat(o.extensionName||o.name))}}catch(u){n.e(u)}finally{n.f()}}var s=D_(t,e);return s||(t[e]=ik(t,r||[]))}function ik(t,r){var e=t.prototype;if(!e)return null;var n=Object.getPrototypeOf(t),i=wh(n),a=D_(t,"defaultProps")||{},o=C_(a),s=Object.assign(Object.create(null),i,o.defaultProps),u=Object.assign(Object.create(null),i?.[It],o.propTypes),f=Object.assign(Object.create(null),i?.[fu],o.deprecatedProps),c=xh(r),h;try{for(c.s();!(h=c.n()).done;){var p=h.value,d=wh(p.constructor);d&&(Object.assign(s,d),Object.assign(u,d[It]),Object.assign(f,d[fu]))}}catch(v){c.e(v)}finally{c.f()}return ak(s,t),sk(s,u),ok(s,f),s[It]=u,s[fu]=f,r.length===0&&!Th(t,"_propTypes")&&(t._propTypes=u),s}function ak(t,r){var e=fk(r);Object.defineProperties(t,{id:{writable:!0,value:e}})}function ok(t,r){var e=function(a){Object.defineProperty(t,a,{enumerable:!1,set:function(s){var u="".concat(this.id,": ").concat(a),f=xh(r[a]),c;try{for(f.s();!(c=f.n()).done;){var h=c.value;Th(this,h)||(this[h]=s)}}catch(p){f.e(p)}finally{f.f()}he.deprecated(u,r[a].join("/"))()}})};for(var n in r)e(n)}function sk(t,r){var e={},n={};for(var i in r){var a=r[i],o=a.name,s=a.value;a.async&&(e[o]=s,n[o]=uk(o))}t[Sr]=e,t[sr]={},Object.defineProperties(t,n)}function uk(t){return{enumerable:!0,set:function(e){typeof e=="string"||e instanceof Promise||Eu(e)?this[sr][t]=e:this[$t][t]=e},get:function(){if(this[$t]){if(t in this[$t]){var e=this[$t][t];return e||this[Sr][t]}if(t in this[sr]){var n=this[Li]&&this[Li].internalState;if(n&&n.hasAsyncProp(t))return n.getAsyncProp(t)||this[Sr][t]}}return this[Sr][t]}}}function Th(t,r){return Object.prototype.hasOwnProperty.call(t,r)}function D_(t,r){return Th(t,r)&&t[r]}function fk(t){var r=t.componentName;return r||he.warn("".concat(t.name,".componentName not specified"))(),r||t.name}function j_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Eh(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?j_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):j_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var lk=0,Nu=function(){function t(){T(this,t),l(this,"id",void 0),l(this,"props",void 0),l(this,"count",void 0);for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];this.props=L_(this,e),this.id=this.props.id,this.count=lk++}return S(t,[{key:"clone",value:function(e){var n=this.props,i={};for(var a in n[Sr])a in n[$t]?i[a]=n[$t][a]:a in n[sr]&&(i[a]=n[sr][a]);return new this.constructor(Eh(Eh(Eh({},n),i),e))}}]),t}();l(Nu,"componentName","Component");l(Nu,"defaultProps",{});var Ph=Be(Ge());var ck=Object.freeze({}),F_=function(){function t(r){T(this,t),l(this,"component",void 0),l(this,"onAsyncPropUpdated",void 0),l(this,"asyncProps",void 0),l(this,"oldProps",void 0),l(this,"oldAsyncProps",void 0),this.component=r,this.asyncProps={},this.onAsyncPropUpdated=function(){},this.oldProps=null,this.oldAsyncProps=null}return S(t,[{key:"finalize",value:function(){for(var e in this.asyncProps){var n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}},{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps||ck}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}},{key:"hasAsyncProp",value:function(e){return e in this.asyncProps}},{key:"getAsyncProp",value:function(e){var n=this.asyncProps[e];return n&&n.resolvedValue}},{key:"isAsyncPropLoading",value:function(e){if(e){var n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(var i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}},{key:"reloadAsyncProp",value:function(e,n){this._watchPromise(e,Promise.resolve(n))}},{key:"setAsyncProps",value:function(e){this.component=e[Li]||this.component;var n=e[$t]||{},i=e[sr]||e,a=e[Sr]||{};for(var o in n){var s=n[o];this._createAsyncPropData(o,a[o]),this._updateAsyncProp(o,s),n[o]=this.getAsyncProp(o)}for(var u in i){var f=i[u];this._createAsyncPropData(u,a[u]),this._updateAsyncProp(u,f)}}},{key:"_fetch",value:function(e,n){return null}},{key:"_onResolve",value:function(e,n){}},{key:"_onError",value:function(e,n){}},{key:"_updateAsyncProp",value:function(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(Eu(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}},{key:"_freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(var e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}},{key:"_didAsyncInputValueChange",value:function(e,n){var i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}},{key:"_setPropValue",value:function(e,n){this._freezeAsyncOldProps();var i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}},{key:"_setAsyncPropValue",value:function(e,n,i){var a=this.asyncProps[e];a&&i>=a.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),a.resolvedValue=n,a.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}},{key:"_watchPromise",value:function(e,n){var i=this,a=this.asyncProps[e];if(a){a.pendingLoadCount++;var o=a.pendingLoadCount;n.then(function(s){i.component&&(s=i._postProcessValue(a,s),i._setAsyncPropValue(e,s,o),i._onResolve(e,s))}).catch(function(s){i._onError(e,s)})}}},{key:"_resolveAsyncIterable",value:function(){var r=de(Ph.default.mark(function n(i,a){var o,s,u,f,c,h,p,d,v,m,g;return Ph.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(i==="data"){w.next=3;break}return this._setPropValue(i,a),w.abrupt("return");case 3:if(o=this.asyncProps[i],o){w.next=6;break}return w.abrupt("return");case 6:o.pendingLoadCount++,s=o.pendingLoadCount,u=[],f=0,c=!1,h=!1,w.prev=12,d=Tn(a);case 14:return w.next=16,d.next();case 16:if(!(c=!(v=w.sent).done)){w.next=28;break}if(m=v.value,this.component){w.next=20;break}return w.abrupt("return");case 20:g=this.component.props.dataTransform,g?u=g(m,u):u=u.concat(m),Object.defineProperty(u,"__diff",{enumerable:!1,value:[{startRow:f,endRow:u.length}]}),f=u.length,this._setAsyncPropValue(i,u,s);case 25:c=!1,w.next=14;break;case 28:w.next=34;break;case 30:w.prev=30,w.t0=w.catch(12),h=!0,p=w.t0;case 34:if(w.prev=34,w.prev=35,!(c&&d.return!=null)){w.next=39;break}return w.next=39,d.return();case 39:if(w.prev=39,!h){w.next=42;break}throw p;case 42:return w.finish(39);case 43:return w.finish(34);case 44:this._onResolve(i,u);case 45:case"end":return w.stop()}},n,this,[[12,30,34,44],[35,,39,43]])}));function e(n,i){return r.apply(this,arguments)}return e}()},{key:"_postProcessValue",value:function(e,n){var i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}},{key:"_createAsyncPropData",value:function(e,n){var i=this.asyncProps[e];if(!i){var a=this.component&&this.component.props[It];this.asyncProps[e]={type:a&&a[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}]),t}();function hk(t){var r=pk();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function pk(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var N_=function(t){N(e,t);var r=hk(e);function e(n){var i,a=n.attributeManager,o=n.layer;return T(this,e),i=r.call(this,o),l(W(i),"attributeManager",void 0),l(W(i),"needsRedraw",void 0),l(W(i),"needsUpdate",void 0),l(W(i),"subLayers",void 0),l(W(i),"usesPickingColorCache",void 0),l(W(i),"hasPickingBuffer",void 0),l(W(i),"changeFlags",void 0),l(W(i),"viewport",void 0),l(W(i),"uniformTransitions",void 0),l(W(i),"propsInTransition",void 0),i.attributeManager=a,i.needsRedraw=!0,i.needsUpdate=!0,i.subLayers=null,i.usesPickingColorCache=!1,i}return S(e,[{key:"layer",get:function(){return this.component}},{key:"_fetch",value:function(i,a){var o=this.layer,s=o?.props.fetch;return s?s(a,{propName:i,layer:o}):be(M(e.prototype),"_fetch",this).call(this,i,a)}},{key:"_onResolve",value:function(i,a){var o=this.layer;if(o){var s=o.props.onDataLoad;i==="data"&&s&&s(a,{propName:i,layer:o})}}},{key:"_onError",value:function(i,a){var o=this.layer;o&&o.raiseError(a,"loading ".concat(i," of ").concat(this.layer))}}]),e}(F_);function Wt(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=dk(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function dk(t,r){if(t){if(typeof t=="string")return B_(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return B_(t,r)}}function B_(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function vk(t){var r=mk();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function mk(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function V_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function fo(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?V_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):V_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var gk="layer.changeFlag",yk="layer.initialize",_k="layer.update",bk="layer.finalize",wk="layer.matched",z_=Math.pow(2,24)-1,xk=Object.freeze([]),Tk=kt(function(t){var r=t.oldViewport,e=t.viewport;return r.equals(e)}),cr=new Uint8ClampedArray(0),Ek={data:{type:"data",value:xk,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:function(r){return r&&r.__diff},optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:function(r,e){var n=e.propName,i=e.layer,a=e.loaders,o=e.loadOptions,s=e.signal,u=i.context.resourceManager;if(o=o||i.getLoadOptions(),a=a||i.props.loaders,s){var f;o=fo(fo({},o),{},{fetch:fo(fo({},(f=o)===null||f===void 0?void 0:f.fetch),{},{signal:s})})}var c=u.contains(r);return!c&&!o&&(u.add({resourceId:r,data:Xr(r,a),persistent:!1}),c=!0),c?u.subscribe({resourceId:r,onChange:function(p){var d;return(d=i.internalState)===null||d===void 0?void 0:d.reloadAsyncProp(n,p)},consumerId:i.id,requestId:n}):Xr(r,a,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:me.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:function(r){var e=r.layerIndex;return[0,-e*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},$i=function(t){N(e,t);var r=vk(e);function e(){var n;T(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),l(W(n),"internalState",null),l(W(n),"lifecycle",Jr.NO_STATE),l(W(n),"context",void 0),l(W(n),"state",void 0),l(W(n),"parent",null),n}return S(e,[{key:"root",get:function(){for(var i=this;i.parent;)i=i.parent;return i}},{key:"toString",value:function(){var i=this.constructor.layerName||this.constructor.name;return"".concat(i,"({id: '").concat(this.props.id,"'})")}},{key:"project",value:function(i){Se(this.internalState);var a=this.internalState.viewport||this.context.viewport,o=Jc(i,{viewport:a,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),s=jn(o,a.pixelProjectionMatrix),u=Z(s,3),f=u[0],c=u[1],h=u[2];return i.length===2?[f,c]:[f,c,h]}},{key:"unproject",value:function(i){Se(this.internalState);var a=this.internalState.viewport||this.context.viewport;return a.unproject(i)}},{key:"projectPosition",value:function(i,a){Se(this.internalState);var o=this.internalState.viewport||this.context.viewport;return au(i,fo({viewport:o,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem},a))}},{key:"isComposite",get:function(){return!1}},{key:"setState",value:function(i){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,i),this.setNeedsRedraw()}},{key:"setNeedsRedraw",value:function(){this.internalState&&(this.internalState.needsRedraw=!0)}},{key:"setNeedsUpdate",value:function(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}},{key:"isLoaded",get:function(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}},{key:"wrapLongitude",get:function(){return this.props.wrapLongitude}},{key:"isPickable",value:function(){return this.props.pickable&&this.props.visible}},{key:"getModels",value:function(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}},{key:"setModuleParameters",value:function(i){var a=Wt(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.updateModuleSettings(i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"getAttributeManager",value:function(){return this.internalState&&this.internalState.attributeManager}},{key:"getCurrentLayer",value:function(){return this.internalState&&this.internalState.layer}},{key:"getLoadOptions",value:function(){return this.props.loadOptions}},{key:"use64bitPositions",value:function(){var i=this.props.coordinateSystem;return i===me.DEFAULT||i===me.LNGLAT||i===me.CARTESIAN}},{key:"onHover",value:function(i,a){return this.props.onHover&&this.props.onHover(i,a)||!1}},{key:"onClick",value:function(i,a){return this.props.onClick&&this.props.onClick(i,a)||!1}},{key:"nullPickingColor",value:function(){return[0,0,0]}},{key:"encodePickingColor",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return a[0]=i+1&255,a[1]=i+1>>8&255,a[2]=i+1>>8>>8&255,a}},{key:"decodePickingColor",value:function(i){Se(i instanceof Uint8Array);var a=Z(i,3),o=a[0],s=a[1],u=a[2],f=o+s*256+u*65536-1;return f}},{key:"getNumInstances",value:function(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Du(this.props.data)}},{key:"getStartIndices",value:function(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}},{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["positions","instancePositions"])}},{key:"getShaders",value:function(i){var a=Wt(this.props.extensions),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;i=ju(i,s.getShaders.call(this,s))}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"shouldUpdateState",value:function(i){return i.changeFlags.propsOrDataChanged}},{key:"updateState",value:function(i){var a=this,o=this.getAttributeManager(),s=i.changeFlags.dataChanged;if(s&&o)if(Array.isArray(s)){var u=Wt(s),f;try{for(u.s();!(f=u.n()).done;){var c=f.value;o.invalidateAll(c)}}catch(w){u.e(w)}finally{u.f()}}else o.invalidateAll();if(o){var h=i.props,p=this.internalState.hasPickingBuffer,d=Number.isInteger(h.highlightedObjectIndex)||h.pickable||h.extensions.some(function(w){return w.getNeedsPickingBuffer.call(a,w)});if(p!==d){this.internalState.hasPickingBuffer=d;var v=o.attributes,m=v.pickingColors,g=v.instancePickingColors,_=m||g;_&&(d&&_.constant&&(_.constant=!1,o.invalidate(_.id)),!_.value&&!d&&(_.constant=!0,_.value=[0,0,0]))}}}},{key:"finalizeState",value:function(i){var a=Wt(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.delete()}}catch(f){a.e(f)}finally{a.f()}var u=this.getAttributeManager();u&&u.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}},{key:"draw",value:function(i){var a=Wt(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.draw(i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"getPickingInfo",value:function(i){var a=i.info,o=i.mode,s=i.sourceLayer,u=a.index;return u>=0&&Array.isArray(this.props.data)&&(a.object=this.props.data[u]),a}},{key:"raiseError",value:function(i,a){var o,s;if(a&&(i=new Error("".concat(a,": ").concat(i.message),{cause:i})),!((o=(s=this.props).onError)!==null&&o!==void 0&&o.call(s,i))){var u,f;(u=this.context)===null||u===void 0||(f=u.onError)===null||f===void 0||f.call(u,i,this)}}},{key:"getNeedsRedraw",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(i)}},{key:"needsUpdate",value:function(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}},{key:"hasUniformTransition",value:function(){var i;return((i=this.internalState)===null||i===void 0?void 0:i.uniformTransitions.active)||!1}},{key:"activateViewport",value:function(i){if(this.internalState){var a=this.internalState.viewport;this.internalState.viewport=i,(!a||!Tk({oldViewport:a,viewport:i}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}}},{key:"invalidateAttribute",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all",a=this.getAttributeManager();a&&(i==="all"?a.invalidateAll():a.invalidate(i))}},{key:"updateAttributes",value:function(i){var a=Wt(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;this._setModelAttributes(s,i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"_updateAttributes",value:function(){var i=this.getAttributeManager();if(i){var a=this.props,o=this.getNumInstances(),s=this.getStartIndices();i.update({data:a.data,numInstances:o,startIndices:s,props:a,transitions:a.transitions,buffers:a.data.attributes,context:this});var u=i.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(u)}}},{key:"_updateAttributeTransition",value:function(){var i=this.getAttributeManager();i&&i.updateTransition()}},{key:"_updateUniformTransition",value:function(){var i=this.internalState.uniformTransitions;if(i.active){var a=i.update(),o=Object.create(this.props);for(var s in a)Object.defineProperty(o,s,{value:a[s]});return o}return this.props}},{key:"calculateInstancePickingColors",value:function(i,a){var o=a.numInstances;if(!i.constant){var s=Math.floor(cr.length/3);if(this.internalState.usesPickingColorCache=!0,s<o){o>z_&&he.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),cr=Gt.allocate(cr,o,{size:3,copy:!0,maxCount:Math.max(o,z_)});for(var u=Math.floor(cr.length/3),f=[],c=s;c<u;c++)this.encodePickingColor(c,f),cr[c*3+0]=f[0],cr[c*3+1]=f[1],cr[c*3+2]=f[2]}i.value=cr.subarray(0,o*3)}}},{key:"_setModelAttributes",value:function(i,a){var o=this.getAttributeManager(),s=i.userData.excludeAttributes||{},u=o.getShaderAttributes(a,s);i.setAttributes(u)}},{key:"disablePickingIndex",value:function(i){var a=this.props.data;if(!("attributes"in a)){this._disablePickingIndex(i);return}var o=this.getAttributeManager().attributes,s=o.pickingColors,u=o.instancePickingColors,f=s||u,c=f&&a.attributes&&a.attributes[f.id];if(c&&c.value)for(var h=c.value,p=this.encodePickingColor(i),d=0;d<a.length;d++){var v=f.getVertexOffset(d);h[v]===p[0]&&h[v+1]===p[1]&&h[v+2]===p[2]&&this._disablePickingIndex(d)}else this._disablePickingIndex(i)}},{key:"_disablePickingIndex",value:function(i){var a=this.getAttributeManager().attributes,o=a.pickingColors,s=a.instancePickingColors,u=o||s;if(u){var f=u.getVertexOffset(i),c=u.getVertexOffset(i+1);u.buffer.subData({data:new Uint8Array(c-f),offset:f})}}},{key:"restorePickingColors",value:function(){var i=this.getAttributeManager().attributes,a=i.pickingColors,o=i.instancePickingColors,s=a||o;s&&(this.internalState.usesPickingColorCache&&s.value.buffer!==cr.buffer&&(s.value=cr.subarray(0,s.value.length)),s.updateSubBuffer({startOffset:0}))}},{key:"_initialize",value:function(){Se(!this.internalState),Se(Number.isFinite(this.props.coordinateSystem)),ze(yk,this);var i=this._getAttributeManager();i&&i.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new N_({attributeManager:i,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:function(){return he.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),i}}),this.internalState.uniformTransitions=new T_(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);var a=Wt(this.props.extensions),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.initializeState.call(this,this.context,s)}}catch(u){a.e(u)}finally{a.f()}this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}},{key:"_transferState",value:function(i){ze(wk,this,this===i);var a=i.state,o=i.internalState;this!==i&&(this.internalState=o,this.state=a,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}},{key:"_update",value:function(){var i=this.needsUpdate();if(ze(_k,this,i),!!i){var a=this.props,o=this.context,s=this.internalState,u=o.viewport,f=this._updateUniformTransition();s.propsInTransition=f,o.viewport=s.viewport||u,this.props=f;try{var c=this._getUpdateParams(),h=this.getModels();if(o.gl)this.updateState(c);else try{this.updateState(c)}catch{}var p=Wt(this.props.extensions),d;try{for(p.s();!(d=p.n()).done;){var v=d.value;v.updateState.call(this,c,v)}}catch(g){p.e(g)}finally{p.f()}var m=this.getModels()[0]!==h[0];this._postUpdate(c,m)}finally{o.viewport=u,this.props=a,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}}},{key:"_finalize",value:function(){ze(bk,this),this.finalizeState(this.context);var i=Wt(this.props.extensions),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.finalizeState.call(this,this.context,o)}}catch(s){i.e(s)}finally{i.f()}}},{key:"_drawLayer",value:function(i){var a=this,o=i.moduleParameters,s=o===void 0?null:o,u=i.uniforms,f=u===void 0?{}:u,c=i.parameters,h=c===void 0?{}:c;this._updateAttributeTransition();var p=this.props,d=this.context;this.props=this.internalState.propsInTransition||p;var v=this.props.opacity;f.opacity=Math.pow(v,1/2.2);try{s&&this.setModuleParameters(s);var m=this.props.getPolygonOffset,g=m&&m(f)||[0,0];Xe(d.gl,{polygonOffset:g}),Ae(d.gl,h,function(){var _={moduleParameters:s,uniforms:f,parameters:h,context:d},w=Wt(a.props.extensions),x;try{for(w.s();!(x=w.n()).done;){var P=x.value;P.draw.call(a,_,P)}}catch(E){w.e(E)}finally{w.f()}a.draw(_)})}finally{this.props=p}}},{key:"getChangeFlags",value:function(){var i;return(i=this.internalState)===null||i===void 0?void 0:i.changeFlags}},{key:"setChangeFlags",value:function(i){if(this.internalState){var a=this.internalState.changeFlags;for(var o in i)if(i[o]){var s=!1;switch(o){case"dataChanged":var u=i[o],f=a[o];u&&Array.isArray(f)&&(a.dataChanged=Array.isArray(u)?f.concat(u):u,s=!0);default:a[o]||(a[o]=i[o],s=!0)}s&&ze(gk,this,o,i)}var c=Boolean(a.dataChanged||a.updateTriggersChanged||a.propsChanged||a.extensionsChanged);a.propsOrDataChanged=c,a.somethingChanged=c||a.viewportChanged||a.stateChanged}}},{key:"_clearChangeFlags",value:function(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}},{key:"_diffProps",value:function(i,a){var o=S_(i,a);if(o.updateTriggersChanged)for(var s in o.updateTriggersChanged)o.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(o.transitionsChanged)for(var u in o.transitionsChanged){var f;this.internalState.uniformTransitions.add(u,a[u],i[u],(f=i.transitions)===null||f===void 0?void 0:f[u])}return this.setChangeFlags(o)}},{key:"validateProps",value:function(){P_(this.props)}},{key:"updateAutoHighlight",value:function(i){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(i)}},{key:"_updateAutoHighlight",value:function(i){var a={pickingSelectedColor:i.picked?i.color:null},o=this.props.highlightColor;i.picked&&typeof o=="function"&&(a.pickingHighlightColor=o(i)),this.setModuleParameters(a),this.setNeedsRedraw()}},{key:"_getAttributeManager",value:function(){var i=this.context;return new Iu(i.gl,{id:this.props.id,stats:i.stats,timeline:i.timeline})}},{key:"_postUpdate",value:function(i,a){var o=i.props,s=i.oldProps;this.setNeedsRedraw(),this._updateAttributes();var u=this.state.model;u?.setInstanceCount(this.getNumInstances());var f=o.autoHighlight,c=o.highlightedObjectIndex,h=o.highlightColor;if(a||s.autoHighlight!==f||s.highlightedObjectIndex!==c||s.highlightColor!==h){var p={};f||(p.pickingSelectedColor=null),Array.isArray(h)&&(p.pickingHighlightColor=h),(a||c!==s.highlightedObjectIndex)&&(p.pickingSelectedColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setModuleParameters(p)}}},{key:"_getUpdateParams",value:function(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}},{key:"_getNeedsRedraw",value:function(i){if(!this.internalState)return!1;var a=!1;a=a||this.internalState.needsRedraw&&this.id;var o=this.getAttributeManager(),s=o?o.getNeedsRedraw(i):!1;if(a=a||s,a){var u=Wt(this.props.extensions),f;try{for(u.s();!(f=u.n()).done;){var c=f.value;c.onNeedsRedraw.call(this,c)}}catch(h){u.e(h)}finally{u.f()}}return this.internalState.needsRedraw=this.internalState.needsRedraw&&!i.clearRedrawFlags,a}},{key:"_onAsyncPropUpdated",value:function(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}],[{key:"componentName",get:function(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}}]),e}(Nu);l($i,"defaultProps",Ek);l($i,"layerName","Layer");function Sh(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Pk(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Pk(t,r){if(t){if(typeof t=="string")return U_(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return U_(t,r)}}function U_(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function G_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function $_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?G_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):G_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Sk(t){var r=Ak();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Ak(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ok="compositeLayer.renderLayers",Ah=function(t){N(e,t);var r=Sk(e);function e(){return T(this,e),r.apply(this,arguments)}return S(e,[{key:"isComposite",get:function(){return!0}},{key:"isLoaded",get:function(){return be(M(e.prototype),"isLoaded",this)&&this.getSubLayers().every(function(i){return i.isLoaded})}},{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(i){}},{key:"setState",value:function(i){be(M(e.prototype),"setState",this).call(this,i),this.setNeedsUpdate()}},{key:"getPickingInfo",value:function(i){var a=i.info,o=a.object,s=o&&o.__source&&o.__source.parent&&o.__source.parent.id===this.id;return s&&(a.object=o.__source.object,a.index=o.__source.index),a}},{key:"filterSubLayer",value:function(i){return!0}},{key:"shouldRenderSubLayer",value:function(i,a){return a&&a.length}},{key:"getSubLayerClass",value:function(i,a){var o=this.props._subLayerProps;return o&&o[i]&&o[i].type||a}},{key:"getSubLayerRow",value:function(i,a,o){return i.__source={parent:this,object:a,index:o},i}},{key:"getSubLayerAccessor",value:function(i){if(typeof i=="function"){var a={index:-1,data:this.props.data,target:[]};return function(o,s){return o&&o.__source?(a.index=o.__source.index,i(o.__source.object,a)):i(o,s)}}return i}},{key:"getSubLayerProps",value:function(){var i,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=this.props,s=o.opacity,u=o.pickable,f=o.visible,c=o.parameters,h=o.getPolygonOffset,p=o.highlightedObjectIndex,d=o.autoHighlight,v=o.highlightColor,m=o.coordinateSystem,g=o.coordinateOrigin,_=o.wrapLongitude,w=o.positionFormat,x=o.modelMatrix,P=o.extensions,E=o.fetch,A=o.operation,R=o._subLayerProps,D={id:"",updateTriggers:{},opacity:s,pickable:u,visible:f,parameters:c,getPolygonOffset:h,highlightedObjectIndex:p,autoHighlight:d,highlightColor:v,coordinateSystem:m,coordinateOrigin:g,wrapLongitude:_,positionFormat:w,modelMatrix:x,extensions:P,fetch:E,operation:A},j=R&&a.id&&R[a.id],I=j&&j.updateTriggers,V=a.id||"sublayer";if(j){var F=this.props[It],G=a.type?a.type._propTypes:{};for(var B in j){var K=G[B]||F[B];K&&K.type==="accessor"&&(j[B]=this.getSubLayerAccessor(j[B]))}}Object.assign(D,a,j),D.id="".concat(this.props.id,"-").concat(V),D.updateTriggers=$_($_({all:(i=this.props.updateTriggers)===null||i===void 0?void 0:i.all},a.updateTriggers),I);var C=Sh(P),k;try{for(C.s();!(k=C.n()).done;){var U=k.value,$=U.getSubLayerProps.call(this,U);$&&Object.assign(D,$,{updateTriggers:Object.assign(D.updateTriggers,$.updateTriggers)})}}catch(q){C.e(q)}finally{C.f()}return D}},{key:"_updateAutoHighlight",value:function(i){var a=Sh(this.getSubLayers()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.updateAutoHighlight(i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"_getAttributeManager",value:function(){return null}},{key:"_postUpdate",value:function(i,a){var o=this.internalState.subLayers,s=!o||this.needsUpdate();if(s){var u=this.renderLayers();o=en(u,Boolean),this.internalState.subLayers=o}ze(Ok,this,s,o);var f=Sh(o),c;try{for(f.s();!(c=f.n()).done;){var h=c.value;h.parent=this}}catch(p){f.e(p)}finally{f.f()}}}]),e}($i);l(Ah,"layerName","CompositeLayer");function H_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function W_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?H_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):H_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Mk(t){var r=kk();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function kk(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Bu=Math.PI/180,Y_=180/Math.PI,Vu=6370972,Hi=256;function Rk(){var t=Hi/Vu,r=Math.PI/180*Hi;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[r,r,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/r,1/r,1/t]}}var zu=function(t){N(e,t);var r=Mk(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};T(this,e);var a=i.latitude,o=a===void 0?0:a,s=i.longitude,u=s===void 0?0:s,f=i.zoom,c=f===void 0?0:f,h=i.nearZMultiplier,p=h===void 0?.1:h,d=i.farZMultiplier,v=d===void 0?2:d,m=i.resolution,g=m===void 0?10:m,_=i.height,w=i.altitude,x=w===void 0?1.5:w;_=_||1,x=Math.max(.75,x);var P=new Ie().lookAt({eye:[0,-x,0],up:[0,0,1]}),E=Math.pow(2,c);P.rotateX(o*Bu),P.rotateZ(-u*Bu),P.scale(E/_);var A=Math.atan(.5/x),R=Hi*2*E/_;return n=r.call(this,W_(W_({},i),{},{height:_,viewMatrix:P,longitude:u,latitude:o,zoom:c,distanceScales:Rk(),fovyRadians:A*2,focalDistance:x,near:p,far:Math.min(2,1/R+1)*x*v})),l(W(n),"longitude",void 0),l(W(n),"latitude",void 0),l(W(n),"resolution",void 0),n.latitude=o,n.longitude=u,n.resolution=g,n}return S(e,[{key:"projectionMode",get:function(){return ut.GLOBE}},{key:"getDistanceScales",value:function(){return this.distanceScales}},{key:"getBounds",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a={targetZ:i.z||0},o=this.unproject([0,this.height/2],a),s=this.unproject([this.width/2,0],a),u=this.unproject([this.width,this.height/2],a),f=this.unproject([this.width/2,this.height],a);return u[0]<this.longitude&&(u[0]+=360),o[0]>this.longitude&&(o[0]-=360),[Math.min(o[0],u[0],s[0],f[0]),Math.min(o[1],u[1],s[1],f[1]),Math.max(o[0],u[0],s[0],f[0]),Math.max(o[1],u[1],s[1],f[1])]}},{key:"unproject",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=a.topLeft,s=o===void 0?!0:o,u=a.targetZ,f=Z(i,3),c=f[0],h=f[1],p=f[2],d=s?h:this.height-h,v=this.pixelUnprojectionMatrix,m;if(Number.isFinite(p))m=Oh(v,[c,d,p,1]);else{var g=Oh(v,[c,d,-1,1]),_=Oh(v,[c,d,1,1]),w=((u||0)/Vu+1)*Hi,x=iu(nu([],g,_)),P=iu(g),E=iu(_),A=(4*P*E-Math.pow(x-P-E,2))/16,R=4*A/x,D=Math.sqrt(P-R),j=Math.sqrt(Math.max(0,w*w-R)),I=(D-j)/Math.sqrt(x);m=sy([],g,_,I)}var V=this.unprojectPosition(m),F=Z(V,3),G=F[0],B=F[1],K=F[2];return Number.isFinite(p)?[G,B,K]:Number.isFinite(u)?[G,B,u]:[G,B]}},{key:"projectPosition",value:function(i){var a=Z(i,3),o=a[0],s=a[1],u=a[2],f=u===void 0?0:u,c=o*Bu,h=s*Bu,p=Math.cos(h),d=(f/Vu+1)*Hi;return[Math.sin(c)*p*d,-Math.cos(c)*p*d,Math.sin(h)*d]}},{key:"unprojectPosition",value:function(i){var a=Z(i,3),o=a[0],s=a[1],u=a[2],f=uy(i),c=Math.asin(u/f),h=Math.atan2(o,-s),p=h*Y_,d=c*Y_,v=(f/Hi-1)*Vu;return[p,d,v]}},{key:"projectFlat",value:function(i){return i}},{key:"unprojectFlat",value:function(i){return i}},{key:"panByPosition",value:function(i,a){var o=this.unproject(a);return{longitude:i[0]-o[0]+this.longitude,latitude:i[1]-o[1]+this.latitude}}}]),e}(nt);function Oh(t,r){var e=Ln([],r,t);return Ig(e,e,1/e[3]),e}function X_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function q_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?X_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):X_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Ck(t){var r=Ik();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Ik(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Mh=Math.PI/180;function Lk(t){var r=t.height,e=t.focalDistance,n=t.orbitAxis,i=t.rotationX,a=t.rotationOrbit,o=t.zoom,s=n==="Z"?[0,0,1]:[0,1,0],u=n==="Z"?[0,-e,0]:[0,0,e],f=new Ie().lookAt({eye:u,up:s});f.rotateX(i*Mh),n==="Z"?f.rotateZ(a*Mh):f.rotateY(a*Mh);var c=Math.pow(2,o)/r;return f.scale(c),f}var Uu=function(t){N(e,t);var r=Ck(e);function e(n){var i;T(this,e);var a=n.height,o=n.projectionMatrix,s=n.fovy,u=s===void 0?50:s,f=n.orbitAxis,c=f===void 0?"Z":f,h=n.target,p=h===void 0?[0,0,0]:h,d=n.rotationX,v=d===void 0?0:d,m=n.rotationOrbit,g=m===void 0?0:m,_=n.zoom,w=_===void 0?0:_,x=o?o[5]/2:Qr(u);return i=r.call(this,q_(q_({},n),{},{longitude:void 0,viewMatrix:Lk({height:a||1,focalDistance:x,orbitAxis:c,rotationX:v,rotationOrbit:g,zoom:w}),fovy:u,focalDistance:x,position:p,zoom:w})),l(W(i),"projectedCenter",void 0),i.projectedCenter=i.project(i.center),i}return S(e,[{key:"unproject",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=a.topLeft,s=o===void 0?!0:o,u=Z(i,3),f=u[0],c=u[1],h=u[2],p=h===void 0?this.projectedCenter[2]:h,d=s?c:this.height-c,v=pt([f,d,p],this.pixelUnprojectionMatrix),m=Z(v,3),g=m[0],_=m[1],w=m[2];return[g,_,w]}},{key:"panByPosition",value:function(i,a){var o=this.project(i),s=[this.width/2+o[0]-a[0],this.height/2+o[1]-a[1],this.projectedCenter[2]];return{target:this.unproject(s)}}}]),e}(nt);function Z_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function K_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Z_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Z_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Dk(t){var r=jk();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function jk(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Fk=new Ie().lookAt({eye:[0,0,1]});function Nk(t){var r=t.width,e=t.height,n=t.near,i=t.far,a=t.padding,o=-r/2,s=r/2,u=-e/2,f=e/2;if(a){var c=a.left,h=c===void 0?0:c,p=a.right,d=p===void 0?0:p,v=a.top,m=v===void 0?0:v,g=a.bottom,_=g===void 0?0:g,w=Te((h+r-d)/2,0,r)-r/2,x=Te((m+e-_)/2,0,e)-e/2;o-=w,s-=w,u+=x,f+=x}return new Ie().ortho({left:o,right:s,bottom:u,top:f,near:n,far:i})}var Gu=function(t){N(e,t);var r=Dk(e);function e(n){T(this,e);var i=n.width,a=n.height,o=n.near,s=o===void 0?.1:o,u=n.far,f=u===void 0?1e3:u,c=n.zoom,h=c===void 0?0:c,p=n.target,d=p===void 0?[0,0,0]:p,v=n.padding,m=v===void 0?null:v,g=n.flipY,_=g===void 0?!0:g,w=Array.isArray(h)?h[0]:h,x=Array.isArray(h)?h[1]:h,P=Math.min(w,x),E=Math.pow(2,P),A;if(w!==x){var R=Math.pow(2,w),D=Math.pow(2,x);A={unitsPerMeter:[R/E,D/E,1],metersPerUnit:[E/R,E/D,1]}}return r.call(this,K_(K_({},n),{},{longitude:void 0,position:d,viewMatrix:Fk.clone().scale([E,E*(_?-1:1),E]),projectionMatrix:Nk({width:i||1,height:a||1,padding:m,near:s,far:f}),zoom:P,distanceScales:A}))}return S(e,[{key:"projectFlat",value:function(i){var a=Z(i,2),o=a[0],s=a[1],u=this.distanceScales.unitsPerMeter;return[o*u[0],s*u[1]]}},{key:"unprojectFlat",value:function(i){var a=Z(i,2),o=a[0],s=a[1],u=this.distanceScales.metersPerUnit;return[o*u[0],s*u[1]]}},{key:"panByPosition",value:function(i,a){var o=pt(a,this.pixelUnprojectionMatrix),s=this.projectFlat(i),u=Ri([],s,ru([],o)),f=Ri([],this.center,u);return{target:this.unprojectFlat(f)}}}]),e}(nt);function Q_(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function J_(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Q_(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Q_(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Bk(t){var r=Vk();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Vk(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $u=function(t){N(e,t);var r=Bk(e);function e(n){var i;T(this,e);var a=n.longitude,o=n.latitude,s=n.modelMatrix,u=n.bearing,f=u===void 0?0:u,c=n.pitch,h=c===void 0?0:c,p=n.up,d=p===void 0?[0,0,1]:p,v=new ba({bearing:f,pitch:h===-90?1e-4:90+h}),m=v.toVector3().normalize(),g=s?new Ie(s).transformAsVector(m):m,_=Number.isFinite(o)?Ha({latitude:o}):0,w=Math.pow(2,_),x=new Ie().lookAt({eye:[0,0,0],center:g,up:d}).scale(w);return i=r.call(this,J_(J_({},n),{},{zoom:_,viewMatrix:x})),l(W(i),"longitude",void 0),l(W(i),"latitude",void 0),i.latitude=o,i.longitude=a,i}return e}(nt);function eb(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Hu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?eb(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):eb(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function tb(t){var r=zk();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function zk(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var lo=20,Uk=function(t){N(e,t);var r=tb(e);function e(n){T(this,e);var i=n.width,a=n.height,o=n.position,s=o===void 0?[0,0,0]:o,u=n.bearing,f=u===void 0?0:u,c=n.pitch,h=c===void 0?0:c,p=n.longitude,d=p===void 0?null:p,v=n.latitude,m=v===void 0?null:v,g=n.maxPitch,_=g===void 0?90:g,w=n.minPitch,x=w===void 0?-90:w,P=n.startRotatePos,E=n.startBearing,A=n.startPitch,R=n.startZoomPosition;return r.call(this,{width:i,height:a,position:s,bearing:f,pitch:h,longitude:d,latitude:m,maxPitch:_,minPitch:x},{startRotatePos:P,startBearing:E,startPitch:A,startZoomPosition:R})}return S(e,[{key:"panStart",value:function(){return this}},{key:"pan",value:function(){return this}},{key:"panEnd",value:function(){return this}},{key:"rotateStart",value:function(i){var a=i.pos;return this._getUpdatedState({startRotatePos:a,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}},{key:"rotate",value:function(i){var a=i.pos,o=i.deltaAngleX,s=o===void 0?0:o,u=i.deltaAngleY,f=u===void 0?0:u,c=this.getState(),h=c.startRotatePos,p=c.startBearing,d=c.startPitch,v=this.getViewportProps(),m=v.width,g=v.height;if(!h||p===void 0||d===void 0)return this;var _;if(a){var w=(a[0]-h[0])/m,x=(a[1]-h[1])/g;_={bearing:p-w*180,pitch:d-x*90}}else _={bearing:p-s,pitch:d-f};return this._getUpdatedState(_)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}},{key:"zoom",value:function(i){var a=i.scale,o=this.getState(),s=o.startZoomPosition;s||(s=this.getViewportProps().position);var u=this.getDirection();return this._move(u,Math.log2(a)*lo,s)}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null})}},{key:"moveLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:lo,a=this.getDirection(!0);return this._move(a.rotateZ({radians:Math.PI/2}),i)}},{key:"moveRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:lo,a=this.getDirection(!0);return this._move(a.rotateZ({radians:-Math.PI/2}),i)}},{key:"moveUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:lo,a=this.getDirection(!0);return this._move(a,i)}},{key:"moveDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:lo,a=this.getDirection(!0);return this._move(a.negate(),i)}},{key:"rotateLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-i})}},{key:"rotateRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+i})}},{key:"rotateUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+i})}},{key:"rotateDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-i})}},{key:"zoomIn",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this.zoom({scale:i})}},{key:"zoomOut",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this.zoom({scale:1/i})}},{key:"shortestPathFrom",value:function(i){var a=i.getViewportProps(),o=Hu({},this.getViewportProps()),s=o.bearing,u=o.longitude;return Math.abs(s-a.bearing)>180&&(o.bearing=s<0?s+360:s-360),u!==null&&a.longitude!==null&&Math.abs(u-a.longitude)>180&&(o.longitude=u<0?u+360:u-360),o}},{key:"_move",value:function(i,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getViewportProps().position,s=i.scale(a);return this._getUpdatedState({position:new We(o).add(s)})}},{key:"getDirection",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=new ba({bearing:this.getViewportProps().bearing,pitch:i?90:90+this.getViewportProps().pitch}),o=a.toVector3().normalize();return o}},{key:"_getUpdatedState",value:function(i){return new e(Hu(Hu(Hu({},this.getViewportProps()),this.getState()),i))}},{key:"applyConstraints",value:function(i){var a=i.pitch,o=i.maxPitch,s=i.minPitch,u=i.longitude,f=i.bearing;return i.pitch=Te(a,s,o),u!==null&&(u<-180||u>180)&&(i.longitude=Nn(u+180,360)-180),(f<-180||f>180)&&(i.bearing=Nn(f+180,360)-180),i}}]),e}(Fi),Wu=function(t){N(e,t);var r=tb(e);function e(){var n;T(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),l(W(n),"ControllerState",Uk),l(W(n),"transition",{transitionDuration:300,transitionInterpolator:new dt(["position","pitch","bearing"])}),n}return e}(Dt);function Gk(t){var r=$k();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function $k(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kh=function(t){N(e,t);var r=Gk(e);function e(){return T(this,e),r.apply(this,arguments)}return S(e,[{key:"ViewportType",get:function(){return $u}},{key:"ControllerType",get:function(){return Wu}}]),e}(Lt);l(kh,"displayName","FirstPersonView");function rb(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Hn(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?rb(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):rb(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function nb(t){var r=Hk();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Hk(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Rh=function(t){N(e,t);var r=nb(e);function e(n){var i;T(this,e);var a=n.width,o=n.height,s=n.rotationX,u=s===void 0?0:s,f=n.rotationOrbit,c=f===void 0?0:f,h=n.target,p=h===void 0?[0,0,0]:h,d=n.zoom,v=d===void 0?0:d,m=n.minRotationX,g=m===void 0?-90:m,_=n.maxRotationX,w=_===void 0?90:_,x=n.minZoom,P=x===void 0?-1/0:x,E=n.maxZoom,A=E===void 0?1/0:E,R=n.startPanPosition,D=n.startRotatePos,j=n.startRotationX,I=n.startRotationOrbit,V=n.startZoomPosition,F=n.startZoom;return i=r.call(this,{width:a,height:o,rotationX:u,rotationOrbit:c,target:p,zoom:v,minRotationX:g,maxRotationX:w,minZoom:P,maxZoom:A},{startPanPosition:R,startRotatePos:D,startRotationX:j,startRotationOrbit:I,startZoomPosition:V,startZoom:F}),l(W(i),"makeViewport",void 0),i.makeViewport=n.makeViewport,i}return S(e,[{key:"panStart",value:function(i){var a=i.pos;return this._getUpdatedState({startPanPosition:this._unproject(a)})}},{key:"pan",value:function(i){var a=i.pos,o=i.startPosition,s=this.getState().startPanPosition||o;if(!s)return this;var u=this.makeViewport(this.getViewportProps()),f=u.panByPosition(s,a);return this._getUpdatedState(f)}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null})}},{key:"rotateStart",value:function(i){var a=i.pos;return this._getUpdatedState({startRotatePos:a,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}},{key:"rotate",value:function(i){var a=i.pos,o=i.deltaAngleX,s=o===void 0?0:o,u=i.deltaAngleY,f=u===void 0?0:u,c=this.getState(),h=c.startRotatePos,p=c.startRotationX,d=c.startRotationOrbit,v=this.getViewportProps(),m=v.width,g=v.height;if(!h||p===void 0||d===void 0)return this;var _;if(a){var w=(a[0]-h[0])/m,x=(a[1]-h[1])/g;(p<-90||p>90)&&(w*=-1),_={rotationX:p+x*180,rotationOrbit:d+w*180}}else _={rotationX:p+f,rotationOrbit:d+s};return this._getUpdatedState(_)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}},{key:"shortestPathFrom",value:function(i){var a=i.getViewportProps(),o=Hn({},this.getViewportProps()),s=o.rotationOrbit;return Math.abs(s-a.rotationOrbit)>180&&(o.rotationOrbit=s<0?s+360:s-360),o}},{key:"zoomStart",value:function(i){var a=i.pos;return this._getUpdatedState({startZoomPosition:this._unproject(a),startZoom:this.getViewportProps().zoom})}},{key:"zoom",value:function(i){var a=i.pos,o=i.startPos,s=i.scale,u=this.getState(),f=u.startZoom,c=u.startZoomPosition;if(c||(f=this.getViewportProps().zoom,c=this._unproject(o)||this._unproject(a)),!c)return this;var h=this._calculateNewZoom({scale:s,startZoom:f}),p=this.makeViewport(Hn(Hn({},this.getViewportProps()),{},{zoom:h}));return this._getUpdatedState(Hn({zoom:h},p.panByPosition(c,a)))}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}},{key:"zoomIn",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:i})})}},{key:"zoomOut",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/i})})}},{key:"moveLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([-i,0])}},{key:"moveRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([i,0])}},{key:"moveUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([0,-i])}},{key:"moveDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([0,i])}},{key:"rotateLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-i})}},{key:"rotateRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+i})}},{key:"rotateUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-i})}},{key:"rotateDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+i})}},{key:"_unproject",value:function(i){var a=this.makeViewport(this.getViewportProps());return i&&a.unproject(i)}},{key:"_calculateNewZoom",value:function(i){var a=i.scale,o=i.startZoom,s=this.getViewportProps(),u=s.maxZoom,f=s.minZoom;o===void 0&&(o=this.getViewportProps().zoom);var c=o+Math.log2(a);return Te(c,f,u)}},{key:"_panFromCenter",value:function(i){var a=this.getViewportProps(),o=a.width,s=a.height,u=a.target;return this.pan({startPosition:u,pos:[o/2+i[0],s/2+i[1]]})}},{key:"_getUpdatedState",value:function(i){return new this.constructor(Hn(Hn(Hn({makeViewport:this.makeViewport},this.getViewportProps()),this.getState()),i))}},{key:"applyConstraints",value:function(i){var a=i.maxZoom,o=i.minZoom,s=i.zoom,u=i.maxRotationX,f=i.minRotationX,c=i.rotationOrbit;return i.zoom=Array.isArray(s)?[Te(s[0],o,a),Te(s[1],o,a)]:Te(s,o,a),i.rotationX=Te(i.rotationX,f,u),(c<-180||c>180)&&(i.rotationOrbit=Nn(c+180,360)-180),i}}]),e}(Fi),Yu=function(t){N(e,t);var r=nb(e);function e(){var n;T(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),l(W(n),"ControllerState",Rh),l(W(n),"transition",{transitionDuration:300,transitionInterpolator:new dt({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}),n}return e}(Dt);function Wk(t){var r=Yk();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Yk(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ch=function(t){N(e,t);var r=Wk(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return T(this,e),n=r.call(this,i),n.props.orbitAxis=i.orbitAxis||"Z",n}return S(e,[{key:"ViewportType",get:function(){return Uu}},{key:"ControllerType",get:function(){return Yu}}]),e}(Lt);l(Ch,"displayName","OrbitView");function ib(t){var r=Xk();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Xk(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var qk=function(t){N(e,t);var r=ib(e);function e(n){var i;return T(this,e),i=r.call(this,n),l(W(i),"zoomAxis",void 0),i.zoomAxis=n.zoomAxis||"all",i}return S(e,[{key:"_calculateNewZoom",value:function(i){var a=i.scale,o=i.startZoom,s=this.getViewportProps(),u=s.maxZoom,f=s.minZoom;o===void 0&&(o=this.getViewportProps().zoom);var c=Math.log2(a);if(Array.isArray(o)){var h=o,p=Z(h,2),d=p[0],v=p[1];switch(this.zoomAxis){case"X":d=Te(d+c,f,u);break;case"Y":v=Te(v+c,f,u);break;default:var m=Math.min(d+c,v+c);m<f&&(c+=f-m),m=Math.max(d+c,v+c),m>u&&(c+=u-m),d+=c,v+=c}return[d,v]}return Te(o+c,f,u)}}]),e}(Rh),Xu=function(t){N(e,t);var r=ib(e);function e(){var n;T(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),l(W(n),"ControllerState",qk),l(W(n),"transition",{transitionDuration:300,transitionInterpolator:new dt(["target","zoom"])}),l(W(n),"dragMode","pan"),n}return S(e,[{key:"_onPanRotate",value:function(){return!1}}]),e}(Dt);function Zk(t){var r=Kk();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Kk(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ih=function(t){N(e,t);var r=Zk(e);function e(){return T(this,e),r.apply(this,arguments)}return S(e,[{key:"ViewportType",get:function(){return Gu}},{key:"ControllerType",get:function(){return Xu}}]),e}(Lt);l(Ih,"displayName","OrthographicView");function ab(t){var r=Qk();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function Qk(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Jk=function(t){N(e,t);var r=ab(e);function e(){return T(this,e),r.apply(this,arguments)}return S(e,[{key:"applyConstraints",value:function(i){var a=i.maxZoom,o=i.minZoom,s=i.zoom;i.zoom=Te(s,o,a);var u=i.longitude,f=i.latitude;return(u<-180||u>180)&&(i.longitude=Nn(u+180,360)-180),i.latitude=Te(f,-89,89),i}}]),e}(ih),qu=function(t){N(e,t);var r=ab(e);function e(){var n;T(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),l(W(n),"ControllerState",Jk),l(W(n),"transition",{transitionDuration:300,transitionInterpolator:new dt(["longitude","latitude","zoom"])}),l(W(n),"dragMode","pan"),n}return S(e,[{key:"setProps",value:function(i){be(M(e.prototype),"setProps",this).call(this,i),this.dragRotate=!1,this.touchRotate=!1}}]),e}(Dt);function eR(t){var r=tR();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function tR(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Lh=function(t){N(e,t);var r=eR(e);function e(){return T(this,e),r.apply(this,arguments)}return S(e,[{key:"ViewportType",get:function(){return zu}},{key:"ControllerType",get:function(){return qu}}]),e}(Lt);l(Lh,"displayName","GlobeView");var Zu=function(){function t(r){T(this,t),l(this,"opts",void 0),r&&(this.opts=r)}return S(t,[{key:"equals",value:function(e){return this===e?!0:this.constructor===e.constructor&&Ze(this.opts,e.opts,1)}},{key:"getShaders",value:function(e){return null}},{key:"getSubLayerProps",value:function(e){var n=e.constructor,i=n.defaultProps,a={updateTriggers:{}};for(var o in i)if(o in this.props){var s=i[o],u=this.props[o];a[o]=u,s&&s.type==="accessor"&&(a.updateTriggers[o]=this.props.updateTriggers[o],typeof u=="function"&&(a[o]=this.getSubLayerAccessor(u)))}return a}},{key:"initializeState",value:function(e,n){}},{key:"updateState",value:function(e,n){}},{key:"onNeedsRedraw",value:function(e){}},{key:"getNeedsPickingBuffer",value:function(e){return!1}},{key:"draw",value:function(e,n){}},{key:"finalizeState",value:function(e,n){}}],[{key:"componentName",get:function(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}}]),t}();l(Zu,"defaultProps",{});l(Zu,"extensionName","LayerExtension");function ob(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function sb(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?ob(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ob(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function rR(t){var r=nR();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function nR(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Dh={bearing:0,pitch:0,position:[0,0,0]},iR={speed:1.2,curve:1.414},ub=function(t){N(e,t);var r=rR(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return T(this,e),n=r.call(this,{compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),l(W(n),"opts",void 0),n.opts=sb(sb({},iR),i),n}return S(e,[{key:"interpolateProps",value:function(i,a,o){var s=eu(i,a,o,this.opts);for(var u in Dh)s[u]=xr(i[u]||Dh[u],a[u]||Dh[u],o);return s}},{key:"getDuration",value:function(i,a){var o=a.transitionDuration;return o==="auto"&&(o=Zc(i,a,this.opts)),o}}]),e}(Di);function fb(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=aR(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function aR(t,r){if(t){if(typeof t=="string")return lb(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return lb(t,r)}}function lb(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var cb=function(){function t(r){T(this,t),l(this,"opts",void 0),l(this,"typedArrayManager",void 0),l(this,"indexStarts",[0]),l(this,"vertexStarts",[0]),l(this,"vertexCount",0),l(this,"instanceCount",0),l(this,"attributes",void 0),l(this,"_attributeDefs",void 0),l(this,"data",void 0),l(this,"getGeometry",void 0),l(this,"geometryBuffer",void 0),l(this,"buffers",void 0),l(this,"positionSize",void 0),l(this,"normalize",void 0);var e=r.attributes,n=e===void 0?{}:e;this.typedArrayManager=Gt,this.attributes={},this._attributeDefs=n,this.opts=r,this.updateGeometry(r)}return S(t,[{key:"updateGeometry",value:function(e){Object.assign(this.opts,e);var n=this.opts,i=n.data,a=n.buffers,o=a===void 0?{}:a,s=n.getGeometry,u=n.geometryBuffer,f=n.positionFormat,c=n.dataChanged,h=n.normalize,p=h===void 0?!0:h;if(this.data=i,this.getGeometry=s,this.positionSize=u&&u.size||(f==="XY"?2:3),this.buffers=o,this.normalize=p,u&&(Se(i.startIndices),this.getGeometry=this.getGeometryFromBuffer(u),p||(o.positions=u)),this.geometryBuffer=o.positions,Array.isArray(c)){var d=fb(c),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;this._rebuildGeometry(m)}}catch(g){d.e(g)}finally{d.f()}}else this._rebuildGeometry()}},{key:"updatePartialGeometry",value:function(e){var n=e.startRow,i=e.endRow;this._rebuildGeometry({startRow:n,endRow:i})}},{key:"getGeometryFromBuffer",value:function(e){var n=e.value||e;return ArrayBuffer.isView(n)?Pu(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}},{key:"_allocate",value:function(e,n){var i=this.attributes,a=this.buffers,o=this._attributeDefs,s=this.typedArrayManager;for(var u in o)if(u in a)s.release(i[u]),i[u]=null;else{var f=o[u];f.copy=n,i[u]=s.allocate(i[u],e,f)}}},{key:"_forEachGeometry",value:function(e,n,i){var a=this.data,o=this.getGeometry,s=zi(a,n,i),u=s.iterable,f=s.objectInfo,c=fb(u),h;try{for(c.s();!(h=c.n()).done;){var p=h.value;f.index++;var d=o?o(p,f):null;e(d,f.index)}}catch(v){c.e(v)}finally{c.f()}}},{key:"_rebuildGeometry",value:function(e){var n=this;if(this.data){var i=this.indexStarts,a=this.vertexStarts,o=this.instanceCount,s=this.data,u=this.geometryBuffer,f=e||{},c=f.startRow,h=c===void 0?0:c,p=f.endRow,d=p===void 0?1/0:p,v={};if(e||(i=[0],a=[0]),this.normalize||!u)this._forEachGeometry(function(P,E){var A=P&&n.normalizeGeometry(P);v[E]=A,a[E+1]=a[E]+(A?n.getGeometrySize(A):0)},h,d),o=a[a.length-1];else if(a=s.startIndices,o=a[s.length]||0,ArrayBuffer.isView(u))o=o||u.length/this.positionSize;else if(u instanceof fe){var m=u.accessor.stride||this.positionSize*4;o=o||u.byteLength/m}else if(u.buffer){var g=u.stride||this.positionSize*4;o=o||u.buffer.byteLength/g}else if(u.value){var _=u.value,w=u.stride/_.BYTES_PER_ELEMENT||this.positionSize;o=o||_.length/w}this._allocate(o,Boolean(e)),this.indexStarts=i,this.vertexStarts=a,this.instanceCount=o;var x={};this._forEachGeometry(function(P,E){var A=v[E]||P;x.vertexStart=a[E],x.indexStart=i[E];var R=E<a.length-1?a[E+1]:o;x.geometrySize=R-a[E],x.geometryIndex=E,n.updateGeometryAttributes(A,x)},h,d),this.vertexCount=i[i.length-1]}}}]),t}();var Me=Be(_b());var pae=typeof window<"u"?window:global;var Wn=typeof document<"u"?document:{};function uR(){}function fR(t){t&&console.error(t.error)}var wb={container:Me.default.object,gl:Me.default.object,mapboxApiAccessToken:Me.default.string,mapboxApiUrl:Me.default.string,attributionControl:Me.default.bool,preserveDrawingBuffer:Me.default.bool,reuseMaps:Me.default.bool,transformRequest:Me.default.func,mapOptions:Me.default.object,mapStyle:Me.default.oneOfType([Me.default.string,Me.default.object]),visible:Me.default.bool,asyncRender:Me.default.bool,onLoad:Me.default.func,onError:Me.default.func,width:Me.default.number,height:Me.default.number,viewState:Me.default.object,longitude:Me.default.number,latitude:Me.default.number,zoom:Me.default.number,bearing:Me.default.number,pitch:Me.default.number,altitude:Me.default.number},Ku={container:Wn.body,mapboxApiAccessToken:lR(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",visible:!0,asyncRender:!1,onLoad:uR,onError:fR,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function lR(){var t=null;if(typeof window<"u"&&window.location){var r=window.location.search.match(/access_token=([^&\/]*)/);t=r&&r[1]}return!t&&typeof process<"u"&&(t=t||process.env.MapboxAccessToken||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN),t||"no-token"}function bb(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";t.debug&&Me.default.checkPropTypes(wb,t,"prop",r)}var Wi=function(){function t(r){var e=this;if(T(this,t),l(this,"mapboxgl",void 0),l(this,"props",Ku),l(this,"_map",null),l(this,"width",0),l(this,"height",0),l(this,"_fireLoadEvent",function(){e.props.onLoad({type:"load",target:e._map})}),!r.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=r.mapboxgl,t.initialized||(t.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(r)}return S(t,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(e){return this._update(this.props,e),this}},{key:"resize",value:function(){return this._map.resize(),this}},{key:"redraw",value:function(){var e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(e){this._map=t.savedMap;var n=this._map.getContainer(),i=e.container;for(i.classList.add("mapboxgl-map");n.childNodes.length>0;)i.appendChild(n.childNodes[0]);this._map._container=i,t.savedMap=null,e.mapStyle&&this._map.setStyle(e.mapStyle,{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(e){if(e.reuseMaps&&t.savedMap)this._reuse(e);else{if(e.gl){var n=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=n,e.gl}}var i={container:e.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:e.mapStyle,interactive:!1,trackResize:!1,attributionControl:e.attributionControl,preserveDrawingBuffer:e.preserveDrawingBuffer};e.transformRequest&&(i.transformRequest=e.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},i,e.mapOptions)),this._map.once("load",e.onLoad),this._map.on("error",e.onError)}return this}},{key:"_destroy",value:function(){this._map&&(t.savedMap?this._map.remove():(t.savedMap=this._map,this._map.off("load",this.props.onLoad),this._map.off("error",this.props.onError),this._map.off("styledata",this._fireLoadEvent)),this._map=null)}},{key:"_initialize",value:function(e){var n=this;e=Object.assign({},Ku,e),bb(e,"Mapbox"),this.mapboxgl.accessToken=e.mapboxApiAccessToken||Ku.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=e.mapboxApiUrl,this._create(e);var i=e,a=i.container;Object.defineProperty(a,"offsetWidth",{get:function(){return n.width}}),Object.defineProperty(a,"clientWidth",{get:function(){return n.width}}),Object.defineProperty(a,"offsetHeight",{get:function(){return n.height}}),Object.defineProperty(a,"clientHeight",{get:function(){return n.height}});var o=this._map.getCanvas();o&&(o.style.outline="none"),this._updateMapViewport({},e),this._updateMapSize({},e),this.props=e}},{key:"_update",value:function(e,n){if(this._map){n=Object.assign({},this.props,n),bb(n,"Mapbox");var i=this._updateMapViewport(e,n),a=this._updateMapSize(e,n);!n.asyncRender&&(i||a)&&this.redraw(),this.props=n}}},{key:"_updateMapSize",value:function(e,n){var i=e.width!==n.width||e.height!==n.height;return i&&(this.width=n.width,this.height=n.height,this.resize()),i}},{key:"_updateMapViewport",value:function(e,n){var i=this._getViewState(e),a=this._getViewState(n),o=a.latitude!==i.latitude||a.longitude!==i.longitude||a.zoom!==i.zoom||a.pitch!==i.pitch||a.bearing!==i.bearing||a.altitude!==i.altitude;return o&&(this._map.jumpTo(this._viewStateToMapboxProps(a)),a.altitude!==i.altitude&&(this._map.transform.altitude=a.altitude)),o}},{key:"_getViewState",value:function(e){var n=e.viewState||e,i=n.longitude,a=n.latitude,o=n.zoom,s=n.pitch,u=s===void 0?0:s,f=n.bearing,c=f===void 0?0:f,h=n.altitude,p=h===void 0?1.5:h;return{longitude:i,latitude:a,zoom:o,pitch:u,bearing:c,altitude:p}}},{key:"_checkStyleSheet",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof Wn>"u"))try{var n=Wn.createElement("div");n.className="mapboxgl-map",n.style.display="none",Wn.body.append(n);var i=window.getComputedStyle(n).position!=="static";if(!i){var a=Wn.createElement("link");a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(e,"/mapbox-gl.css")),Wn.head.append(a)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(e){return{center:[e.longitude,e.latitude],zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}}}]),t}();l(Wi,"initialized",!1);l(Wi,"propTypes",wb);l(Wi,"defaultProps",Ku);l(Wi,"savedMap",null);function xb(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function jh(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?xb(Object(e),!0).forEach(function(n){l(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):xb(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function cR(t){var r=hR();return function(){var n=M(t),i;if(r){var a=M(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return z(this,i)}}function hR(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Tb={position:"absolute",left:0,top:0,width:"100%",height:"100%"};function pR(t){var r=t.container,e=r===void 0?document.body:r;if(typeof e=="string"&&(e=document.getElementById(e)),!e)throw Error("Deck: container not found");var n=window.getComputedStyle(e);n.position==="static"&&(e.style.position="relative");var i=document.createElement("div");e.appendChild(i),Object.assign(i.style,Tb);var a=document.createElement("canvas");return e.appendChild(a),Object.assign(a.style,Tb),{container:e,mapCanvas:i,deckCanvas:a}}var Eb=function(t){N(e,t);var r=cR(e);function e(n){var i;if(T(this,e),typeof document>"u")throw Error("Deck can only be used in the browser");var a=pR(n),o=a.mapCanvas,s=a.deckCanvas,u=n.viewState||n.initialViewState,f=Number.isFinite(u&&u.latitude),c=n.map,h=c===void 0?globalThis.mapboxgl||globalThis.maplibregl:c;return i=r.call(this,jh({canvas:s},n)),l(W(i),"_map",void 0),h&&h.Map?i._map=f&&new Wi(jh(jh({},n),{},{viewState:u,container:o,mapboxgl:h})):i._map=h,i}return S(e,[{key:"getMapboxMap",value:function(){return this._map&&this._map.getMap()}},{key:"finalize",value:function(){this._map&&this._map.finalize(),be(M(e.prototype),"finalize",this).call(this)}},{key:"setProps",value:function(i){"mapStyle"in i&&this._map&&this._map._map.setStyle(i.mapStyle),be(M(e.prototype),"setProps",this).call(this,i)}},{key:"_drawLayers",value:function(i,a){if(this._map){var o=this.getViewports()[0];this._map.setProps({width:o.width,height:o.height,viewState:o})}be(M(e.prototype),"_drawLayers",this).call(this,i,a)}}]),e}(Vi);globalThis.luma=globalThis.luma||{};globalThis.loaders=globalThis.loaders||{};Object.assign(globalThis.luma,Al);Object.assign(globalThis.loaders,xc);return Qb(dR);})();
      return __exports__;
      });
